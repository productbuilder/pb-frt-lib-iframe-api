import{Color as Color$1,Vector2 as Vector2$1,Vector3 as Vector3$1,Vector4 as Vector4$1,Matrix3 as Matrix3$1,Matrix4 as Matrix4$1,EventDispatcher as EventDispatcher$2,MathUtils as MathUtils$1,LinearSRGBColorSpace as LinearSRGBColorSpace$1,SRGBColorSpace as SRGBColorSpace$1,TangentSpaceNormalMap as TangentSpaceNormalMap$1,ObjectSpaceNormalMap as ObjectSpaceNormalMap$1,StaticDrawUsage as StaticDrawUsage$1,InterleavedBuffer as InterleavedBuffer$1,InterleavedBufferAttribute as InterleavedBufferAttribute$1,DynamicDrawUsage as DynamicDrawUsage$1,InstancedInterleavedBuffer as InstancedInterleavedBuffer$1,DepthTexture as DepthTexture$1,NearestFilter as NearestFilter$1,LessCompare as LessCompare$1,ShaderMaterial as ShaderMaterial$1,NoColorSpace as NoColorSpace$1,Material as Material$1,sRGBEncoding as sRGBEncoding$1,LinearEncoding as LinearEncoding$1,Float16BufferAttribute as Float16BufferAttribute$1,REVISION as REVISION$1,NoToneMapping as NoToneMapping$1,LinearToneMapping as LinearToneMapping$1,ReinhardToneMapping as ReinhardToneMapping$1,CineonToneMapping as CineonToneMapping$1,ACESFilmicToneMapping as ACESFilmicToneMapping$1,FramebufferTexture as FramebufferTexture$1,LinearMipmapLinearFilter as LinearMipmapLinearFilter$1,UnsignedIntType as UnsignedIntType$1,DepthFormat as DepthFormat$1,PointLight as PointLight$1,DirectionalLight as DirectionalLight$1,SpotLight as SpotLight$1,AmbientLight as AmbientLight$1,HemisphereLight as HemisphereLight$1,Loader as Loader$1,FileLoader as FileLoader$1,LineBasicMaterial as LineBasicMaterial$1,MeshNormalMaterial as MeshNormalMaterial$1,MeshBasicMaterial as MeshBasicMaterial$1,MeshLambertMaterial as MeshLambertMaterial$1,MeshPhongMaterial as MeshPhongMaterial$1,MeshStandardMaterial as MeshStandardMaterial$1,MeshPhysicalMaterial as MeshPhysicalMaterial$1,PointsMaterial as PointsMaterial$1,SpriteMaterial as SpriteMaterial$1,MaterialLoader as MaterialLoader$1,ObjectLoader as ObjectLoader$1,DataTextureLoader as DataTextureLoader$1,HalfFloatType as HalfFloatType$1,FloatType as FloatType$1,RGBAFormat as RGBAFormat$1,RedFormat as RedFormat$1,LinearFilter as LinearFilter$1,DataUtils as DataUtils$1,TrianglesDrawMode as TrianglesDrawMode$1,TriangleFanDrawMode as TriangleFanDrawMode$1,TriangleStripDrawMode as TriangleStripDrawMode$1,Quaternion as Quaternion$1,LoaderUtils as LoaderUtils$1,InstancedMesh as InstancedMesh$1,Object3D as Object3D$1,TextureLoader as TextureLoader$1,ImageBitmapLoader as ImageBitmapLoader$1,BufferAttribute as BufferAttribute$1,RepeatWrapping as RepeatWrapping$1,DoubleSide as DoubleSide$1,PropertyBinding as PropertyBinding$1,BufferGeometry as BufferGeometry$1,SkinnedMesh as SkinnedMesh$1,Mesh as Mesh$1,LineSegments as LineSegments$1,Line as Line$1,LineLoop as LineLoop$1,Points as Points$1,Group as Group$1,PerspectiveCamera as PerspectiveCamera$1,OrthographicCamera as OrthographicCamera$1,Skeleton as Skeleton$1,AnimationClip as AnimationClip$1,Bone as Bone$1,InterpolateLinear as InterpolateLinear$1,NearestMipmapNearestFilter as NearestMipmapNearestFilter$1,LinearMipmapNearestFilter as LinearMipmapNearestFilter$1,NearestMipmapLinearFilter as NearestMipmapLinearFilter$1,ClampToEdgeWrapping as ClampToEdgeWrapping$1,MirroredRepeatWrapping as MirroredRepeatWrapping$1,InterpolateDiscrete as InterpolateDiscrete$1,FrontSide as FrontSide$1,Texture as Texture$1,VectorKeyframeTrack as VectorKeyframeTrack$1,NumberKeyframeTrack as NumberKeyframeTrack$1,QuaternionKeyframeTrack as QuaternionKeyframeTrack$1,Box3 as Box3$1,Sphere as Sphere$1,Interpolant as Interpolant$1,Float32BufferAttribute as Float32BufferAttribute$1,UniformsUtils as UniformsUtils$1,WebGLRenderTarget as WebGLRenderTarget$1,NoBlending as NoBlending$1,Clock as Clock$1,ShaderChunk as ShaderChunk$1,RawShaderMaterial as RawShaderMaterial$1,AdditiveBlending as AdditiveBlending$1,UniformsLib as UniformsLib$1,ShaderLib as ShaderLib$1,InstancedBufferGeometry as InstancedBufferGeometry$1,WireframeGeometry as WireframeGeometry$1,Line3 as Line3$1,PlaneGeometry as PlaneGeometry$1,Uniform as Uniform$1,Scene as Scene$1,WebGLRenderer as WebGLRenderer$1,CompressedTexture as CompressedTexture$1,Source as Source$1}from"three";const REVISION="155",MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,CullFaceFrontBack=3,BasicShadowMap=0,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,TwoPassDoubleSide=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipMapNearestFilter=1004,NearestMipmapLinearFilter=1005,NearestMipMapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipMapNearestFilter=1007,LinearMipmapLinearFilter=1008,LinearMipMapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedInt248Type=1020,AlphaFormat=1021,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,RED_RGTC1_Format=36283,SIGNED_RED_RGTC1_Format=36284,RED_GREEN_RGTC2_Format=36285,SIGNED_RED_GREEN_RGTC2_Format=36286,LoopOnce=2200,LoopRepeat=2201,LoopPingPong=2202,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,NormalAnimationBlendMode=2500,AdditiveAnimationBlendMode=2501,TrianglesDrawMode=0,TriangleStripDrawMode=1,TriangleFanDrawMode=2,LinearEncoding=3e3,sRGBEncoding=3001,BasicDepthPacking=3200,RGBADepthPacking=3201,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,NoColorSpace="",SRGBColorSpace="srgb",LinearSRGBColorSpace="srgb-linear",DisplayP3ColorSpace="display-p3",ZeroStencilOp=0,KeepStencilOp=7680,ReplaceStencilOp=7681,IncrementStencilOp=7682,DecrementStencilOp=7683,IncrementWrapStencilOp=34055,DecrementWrapStencilOp=34056,InvertStencilOp=5386,NeverStencilFunc=512,LessStencilFunc=513,EqualStencilFunc=514,LessEqualStencilFunc=515,GreaterStencilFunc=516,NotEqualStencilFunc=517,GreaterEqualStencilFunc=518,AlwaysStencilFunc=519,NeverCompare=512,LessCompare=513,EqualCompare=514,LessEqualCompare=515,GreaterCompare=516,NotEqualCompare=517,GreaterEqualCompare=518,AlwaysCompare=519,StaticDrawUsage=35044,DynamicDrawUsage=35048,StreamDrawUsage=35040,StaticReadUsage=35045,DynamicReadUsage=35049,StreamReadUsage=35041,StaticCopyUsage=35046,DynamicCopyUsage=35050,StreamCopyUsage=35042,GLSL1="100",GLSL3="300 es",_SRGBAFormat=1035,WebGLCoordinateSystem=2e3,WebGPUCoordinateSystem=2001;class EventDispatcher{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}hasEventListener(e,t){var r;return void 0!==this._listeners&&void 0!==(r=this._listeners)[e]&&-1!==r[e].indexOf(t)}removeEventListener(e,t){var r;void 0!==this._listeners&&void 0!==(e=this._listeners[e])&&-1!==(r=e.indexOf(t))&&e.splice(r,1)}dispatchEvent(r){if(void 0!==this._listeners){var e=this._listeners[r.type];if(void 0!==e){r.target=this;var i=e.slice(0);for(let e=0,t=i.length;e<t;e++)i[e].call(this,r);r.target=null}}}}const _lut=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let _seed=1234567;const DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI;function generateUUID(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(_lut[255&e]+_lut[e>>8&255]+_lut[e>>16&255]+_lut[e>>24&255]+"-"+_lut[255&t]+_lut[t>>8&255]+"-"+_lut[t>>16&15|64]+_lut[t>>24&255]+"-"+_lut[63&r|128]+_lut[r>>8&255]+"-"+_lut[r>>16&255]+_lut[r>>24&255]+_lut[255&i]+_lut[i>>8&255]+_lut[i>>16&255]+_lut[i>>24&255]).toLowerCase()}function clamp(e,t,r){return Math.max(t,Math.min(r,e))}function euclideanModulo(e,t){return(e%t+t)%t}function mapLinear(e,t,r,i,n){return i+(e-t)*(n-i)/(r-t)}function inverseLerp(e,t,r){return e!==t?(r-e)/(t-e):0}function lerp(e,t,r){return(1-r)*e+r*t}function damp(e,t,r,i){return lerp(e,t,1-Math.exp(-r*i))}function pingpong(e,t=1){return t-Math.abs(euclideanModulo(e,2*t)-t)}function smoothstep(e,t,r){return e<=t?0:r<=e?1:(e=(e-t)/(r-t))*e*(3-2*e)}function smootherstep(e,t,r){return e<=t?0:r<=e?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)}function randInt(e,t){return e+Math.floor(Math.random()*(t-e+1))}function randFloat(e,t){return e+Math.random()*(t-e)}function randFloatSpread(e){return e*(.5-Math.random())}function seededRandom(e){void 0!==e&&(_seed=e);e=_seed+=1831565813,e=Math.imul(e^e>>>15,1|e);return(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296}function degToRad(e){return e*DEG2RAD}function radToDeg(e){return e*RAD2DEG}function isPowerOfTwo(e){return 0==(e&e-1)&&0!==e}function ceilPowerOfTwo(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function floorPowerOfTwo(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function setQuaternionFromProperEuler(e,t,r,i,n){var a=Math.cos,o=Math.sin,s=a(r/2),l=o(r/2),c=a((t+i)/2),d=o((t+i)/2),h=a((t-i)/2),u=o((t-i)/2),A=a((i-t)/2),p=o((i-t)/2);switch(n){case"XYX":e.set(s*d,l*h,l*u,s*c);break;case"YZY":e.set(l*u,s*d,l*h,s*c);break;case"ZXZ":e.set(l*h,l*u,s*d,s*c);break;case"XZX":e.set(s*d,l*p,l*A,s*c);break;case"YXY":e.set(l*A,s*d,l*p,s*c);break;case"ZYZ":e.set(l*p,l*A,s*d,s*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function denormalize(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function normalize(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const MathUtils={DEG2RAD:DEG2RAD,RAD2DEG:RAD2DEG,generateUUID:generateUUID,clamp:clamp,euclideanModulo:euclideanModulo,mapLinear:mapLinear,inverseLerp:inverseLerp,lerp:lerp,damp:damp,pingpong:pingpong,smoothstep:smoothstep,smootherstep:smootherstep,randInt:randInt,randFloat:randFloat,randFloatSpread:randFloatSpread,seededRandom:seededRandom,degToRad:degToRad,radToDeg:radToDeg,isPowerOfTwo:isPowerOfTwo,ceilPowerOfTwo:ceilPowerOfTwo,floorPowerOfTwo:floorPowerOfTwo,setQuaternionFromProperEuler:setQuaternionFromProperEuler,normalize:normalize,denormalize:denormalize};class Vector2{constructor(e=0,t=0){Vector2.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){var t=this.x,r=this.y,e=e.elements;return this.x=e[0]*t+e[3]*r+e[6],this.y=e[1]*t+e[4]*r+e[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());return 0===t?Math.PI/2:(e=this.dot(e)/t,Math.acos(clamp(e,-1,1)))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){var r=Math.cos(t),t=Math.sin(t),i=this.x-e.x,n=this.y-e.y;return this.x=i*r-n*t+e.x,this.y=i*t+n*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Matrix3{constructor(e,t,r,i,n,a,o,s,l){Matrix3.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,r,i,n,a,o,s,l)}set(e,t,r,i,n,a,o,s,l){var c=this.elements;return c[0]=e,c[1]=i,c[2]=o,c[3]=t,c[4]=n,c[5]=s,c[6]=r,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){var t=this.elements,e=e.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){e=e.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){var e=e.elements,t=t.elements,r=this.elements,i=e[0],n=e[3],a=e[6],o=e[1],s=e[4],l=e[7],c=e[2],d=e[5],e=e[8],h=t[0],u=t[3],A=t[6],p=t[1],m=t[4],f=t[7],g=t[2],v=t[5],t=t[8];return r[0]=i*h+n*p+a*g,r[3]=i*u+n*m+a*v,r[6]=i*A+n*f+a*t,r[1]=o*h+s*p+l*g,r[4]=o*u+s*m+l*v,r[7]=o*A+s*f+l*t,r[2]=c*h+d*p+e*g,r[5]=c*u+d*m+e*v,r[8]=c*A+d*f+e*t,this}multiplyScalar(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){var e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],s=e[6],l=e[7],e=e[8];return t*a*e-t*o*l-r*n*e+r*o*s+i*n*l-i*a*s}invert(){var e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],d=c*a-o*l,h=o*s-c*n,u=l*n-a*s,A=t*d+r*h+i*u;return 0==A?this.set(0,0,0,0,0,0,0,0,0):(e[0]=d*(d=1/A),e[1]=(i*l-c*r)*d,e[2]=(o*r-i*a)*d,e[3]=h*d,e[4]=(c*t-i*s)*d,e[5]=(i*n-o*t)*d,e[6]=u*d,e[7]=(r*s-l*t)*d,e[8]=(a*t-r*n)*d,this)}transpose(){var e=this.elements,t=e[1];return e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,n,a,o){var s=Math.cos(n),n=Math.sin(n);return this.set(r*s,r*n,-r*(s*a+n*o)+a+e,-i*n,i*s,-i*(-n*a+s*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(_m3.makeScale(e,t)),this}rotate(e){return this.premultiply(_m3.makeRotation(-e)),this}translate(e,t){return this.premultiply(_m3.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,e,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){var t=this.elements,r=e.elements;for(let e=0;e<9;e++)if(t[e]!==r[e])return!1;return!0}fromArray(t,r=0){for(let e=0;e<9;e++)this.elements[e]=t[e+r];return this}toArray(e=[],t=0){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const _m3=new Matrix3;function arrayNeedsUint32(t){for(let e=t.length-1;0<=e;--e)if(65535<=t[e])return!0;return!1}const TYPED_ARRAYS={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function getTypedArray(e,t){return new TYPED_ARRAYS[e](t)}function createElementNS(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}const _cache={};function warnOnce(e){e in _cache||(_cache[e]=!0,console.warn(e))}function SRGBToLinear(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function LinearToSRGB(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const LINEAR_SRGB_TO_LINEAR_DISPLAY_P3=(new Matrix3).fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),LINEAR_DISPLAY_P3_TO_LINEAR_SRGB=(new Matrix3).fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);function DisplayP3ToLinearSRGB(e){return e.convertSRGBToLinear().applyMatrix3(LINEAR_DISPLAY_P3_TO_LINEAR_SRGB)}function LinearSRGBToDisplayP3(e){return e.applyMatrix3(LINEAR_SRGB_TO_LINEAR_DISPLAY_P3).convertLinearToSRGB()}const TO_LINEAR={[LinearSRGBColorSpace]:e=>e,[SRGBColorSpace]:e=>e.convertSRGBToLinear(),[DisplayP3ColorSpace]:DisplayP3ToLinearSRGB},FROM_LINEAR={[LinearSRGBColorSpace]:e=>e,[SRGBColorSpace]:e=>e.convertLinearToSRGB(),[DisplayP3ColorSpace]:LinearSRGBToDisplayP3},ColorManagement={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(e){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!e},get workingColorSpace(){return LinearSRGBColorSpace},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,r){if(!1===this.enabled||t===r||!t||!r)return e;var i=TO_LINEAR[t],n=FROM_LINEAR[r];if(void 0===i||void 0===n)throw new Error(`Unsupported color space conversion, "${t}" to "${r}".`);return n(i(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}};let _canvas;class ImageUtils{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;var r;return 2048<(t=e instanceof HTMLCanvasElement?e:((_canvas=void 0===_canvas?createElementNS("canvas"):_canvas).width=e.width,_canvas.height=e.height,r=_canvas.getContext("2d"),e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),_canvas)).width||2048<t.height?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var t=createElementNS("canvas"),r=(t.width=e.width,t.height=e.height,t.getContext("2d")),i=(r.drawImage(e,0,0,e.width,e.height),r.getImageData(0,0,e.width,e.height)),n=i.data;for(let e=0;e<n.length;e++)n[e]=255*SRGBToLinear(n[e]/255);return r.putImageData(i,0,0),t}if(e.data){var a=e.data.slice(0);for(let e=0;e<a.length;e++)a instanceof Uint8Array||a instanceof Uint8ClampedArray?a[e]=Math.floor(255*SRGBToLinear(a[e]/255)):a[e]=SRGBToLinear(a[e]);return{data:a,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let sourceId=0;class Source{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:sourceId++}),this.uuid=generateUUID(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];var i={uuid:this.uuid,url:""},n=this.data;if(null!==n){let r;if(Array.isArray(n)){r=[];for(let e=0,t=n.length;e<t;e++)n[e].isDataTexture?r.push(serializeImage(n[e].image)):r.push(serializeImage(n[e]))}else r=serializeImage(n);i.url=r}return t||(e.images[this.uuid]=i),i}}function serializeImage(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?ImageUtils.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let textureId=0;class Texture extends EventDispatcher{constructor(e=Texture.DEFAULT_IMAGE,t=Texture.DEFAULT_MAPPING,r=ClampToEdgeWrapping,i=ClampToEdgeWrapping,n=LinearFilter,a=LinearMipmapLinearFilter,o=RGBAFormat,s=UnsignedByteType,l=Texture.DEFAULT_ANISOTROPY,c=NoColorSpace){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:textureId++}),this.uuid=generateUUID(),this.name="",this.source=new Source(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=n,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=s,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof c?this.colorSpace=c:(warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=c===sRGBEncoding?SRGBColorSpace:NoColorSpace),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){var t,r=void 0===e||"string"==typeof e;return r||void 0===e.textures[this.uuid]?(t={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment},0<Object.keys(this.userData).length&&(t.userData=this.userData),r||(e.textures[this.uuid]=t),t):e.textures[this.uuid]}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping===UVMapping){if(e.applyMatrix3(this.matrix),e.x<0||1<e.x)switch(this.wrapS){case RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case MirroredRepeatWrapping:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||1<e.y)switch(this.wrapT){case RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case MirroredRepeatWrapping:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}this.flipY&&(e.y=1-e.y)}return e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===SRGBColorSpace?sRGBEncoding:LinearEncoding}set encoding(e){warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===sRGBEncoding?SRGBColorSpace:NoColorSpace}}Texture.DEFAULT_IMAGE=null,Texture.DEFAULT_MAPPING=UVMapping,Texture.DEFAULT_ANISOTROPY=1;class Vector4{constructor(e=0,t=0,r=0,i=1){Vector4.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){var t=this.x,r=this.y,i=this.z,n=this.w,e=e.elements;return this.x=e[0]*t+e[4]*r+e[8]*i+e[12]*n,this.y=e[1]*t+e[5]*r+e[9]*i+e[13]*n,this.z=e[2]*t+e[6]*r+e[10]*i+e[14]*n,this.w=e[3]*t+e[7]*r+e[11]*i+e[15]*n,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(t){let e,r,i,n;var a,o,s,l,c,d,t=t.elements,h=t[0],u=t[4],A=t[8],p=t[1],m=t[5],f=t[9],g=t[2],v=t[6],t=t[10];if(Math.abs(u-p)<.01&&Math.abs(A-g)<.01&&Math.abs(f-v)<.01)Math.abs(u+p)<.1&&Math.abs(A+g)<.1&&Math.abs(f+v)<.1&&Math.abs(h+m+t-3)<.1?this.set(1,0,0,0):(e=Math.PI,s=(t+1)/2,l=(u+p)/4,c=(A+g)/4,d=(f+v)/4,(o=(m+1)/2)<(a=(h+1)/2)&&s<a?n=a<.01?(r=0,i=.707106781):(r=Math.sqrt(a),i=l/r,c/r):s<o?n=o<.01?(r=.707106781,i=0,.707106781):(i=Math.sqrt(o),r=l/i,d/i):s<.01?(r=.707106781,i=.707106781,n=0):(n=Math.sqrt(s),r=c/n,i=d/n),this.set(r,i,n,e));else{let e=Math.sqrt((v-f)*(v-f)+(A-g)*(A-g)+(p-u)*(p-u));Math.abs(e)<.001&&(e=1),this.x=(v-f)/e,this.y=(A-g)/e,this.z=(p-u)/e,this.w=Math.acos((h+m+t-1)/2)}return this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class RenderTarget extends EventDispatcher{constructor(e=1,t=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Vector4(0,0,e,t),this.scissorTest=!1,this.viewport=new Vector4(0,0,e,t);e={width:e,height:t,depth:1};void 0!==r.encoding&&(warnOnce("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),r.colorSpace=r.encoding===sRGBEncoding?SRGBColorSpace:NoColorSpace),this.texture=new Texture(e,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.internalFormat=void 0!==r.internalFormat?r.internalFormat:null,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:LinearFilter,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0!==r.stencilBuffer&&r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null,this.samples=void 0!==r.samples?r.samples:0}setSize(e,t,r=1){this.width===e&&this.height===t&&this.depth===r||(this.width=e,this.height=t,this.depth=r,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;var t=Object.assign({},e.texture.image);return this.texture.source=new Source(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class WebGLRenderTarget extends RenderTarget{constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class DataArrayTexture extends Texture{constructor(e=null,t=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class WebGLArrayRenderTarget extends WebGLRenderTarget{constructor(e=1,t=1,r=1){super(e,t),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new DataArrayTexture(null,e,t,r),this.texture.isRenderTargetTexture=!0}}class Data3DTexture extends Texture{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class WebGL3DRenderTarget extends WebGLRenderTarget{constructor(e=1,t=1,r=1){super(e,t),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new Data3DTexture(null,e,t,r),this.texture.isRenderTargetTexture=!0}}class WebGLMultipleRenderTargets extends WebGLRenderTarget{constructor(e=1,t=1,r=1,i={}){super(e,t,i),this.isWebGLMultipleRenderTargets=!0;var n=this.texture;this.texture=[];for(let e=0;e<r;e++)this.texture[e]=n.clone(),this.texture[e].isRenderTargetTexture=!0}setSize(r,i,n=1){if(this.width!==r||this.height!==i||this.depth!==n){this.width=r,this.height=i,this.depth=n;for(let e=0,t=this.texture.length;e<t;e++)this.texture[e].image.width=r,this.texture[e].image.height=i,this.texture[e].image.depth=n;this.dispose()}this.viewport.set(0,0,r,i),this.scissor.set(0,0,r,i)}copy(r){this.dispose(),this.width=r.width,this.height=r.height,this.depth=r.depth,this.scissor.copy(r.scissor),this.scissorTest=r.scissorTest,this.viewport.copy(r.viewport),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,null!==r.depthTexture&&(this.depthTexture=r.depthTexture.clone());for(let e=this.texture.length=0,t=r.texture.length;e<t;e++)this.texture[e]=r.texture[e].clone(),this.texture[e].isRenderTargetTexture=!0;return this}}class Quaternion{constructor(e=0,t=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=i}static slerpFlat(e,t,r,i,n,a,o){let s=r[i+0],l=r[i+1],c=r[i+2],d=r[i+3];var r=n[a+0],i=n[a+1],h=n[a+2],n=n[a+3];if(0===o)e[t+0]=s,e[t+1]=l,e[t+2]=c,e[t+3]=d;else if(1===o)e[t+0]=r,e[t+1]=i,e[t+2]=h,e[t+3]=n;else{if(d!==n||s!==r||l!==i||c!==h){let e=1-o;var a=s*r+l*i+c*h+d*n,u=0<=a?1:-1,A=1-a*a,a=(A>Number.EPSILON&&(A=Math.sqrt(A),a=Math.atan2(A,a*u),e=Math.sin(e*a)/A,o=Math.sin(o*a)/A),o*u);s=s*e+r*a,l=l*e+i*a,c=c*e+h*a,d=d*e+n*a,e===1-o&&(A=1/Math.sqrt(s*s+l*l+c*c+d*d),s*=A,l*=A,c*=A,d*=A)}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=d}}static multiplyQuaternionsFlat(e,t,r,i,n,a){var o=r[i],s=r[i+1],l=r[i+2],r=r[i+3],i=n[a],c=n[a+1],d=n[a+2],n=n[a+3];return e[t]=o*n+r*i+s*d-l*c,e[t+1]=s*n+r*c+l*i-o*d,e[t+2]=l*n+r*d+o*c-s*i,e[t+3]=r*n-o*i-s*c-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){var r=e._x,i=e._y,n=e._z,a=e._order,e=Math.cos,o=Math.sin,s=e(r/2),l=e(i/2),c=e(n/2),d=o(r/2),h=o(i/2),u=o(n/2);switch(a){case"XYZ":this._x=d*l*c+s*h*u,this._y=s*h*c-d*l*u,this._z=s*l*u+d*h*c,this._w=s*l*c-d*h*u;break;case"YXZ":this._x=d*l*c+s*h*u,this._y=s*h*c-d*l*u,this._z=s*l*u-d*h*c,this._w=s*l*c+d*h*u;break;case"ZXY":this._x=d*l*c-s*h*u,this._y=s*h*c+d*l*u,this._z=s*l*u+d*h*c,this._w=s*l*c-d*h*u;break;case"ZYX":this._x=d*l*c-s*h*u,this._y=s*h*c+d*l*u,this._z=s*l*u-d*h*c,this._w=s*l*c+d*h*u;break;case"YZX":this._x=d*l*c+s*h*u,this._y=s*h*c+d*l*u,this._z=s*l*u-d*h*c,this._w=s*l*c-d*h*u;break;case"XZY":this._x=d*l*c-s*h*u,this._y=s*h*c-d*l*u,this._z=s*l*u+d*h*c,this._w=s*l*c+d*h*u;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){var t=t/2,r=Math.sin(t);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(t),this._onChangeCallback(),this}setFromRotationMatrix(e){var e=e.elements,t=e[0],r=e[4],i=e[8],n=e[1],a=e[5],o=e[9],s=e[2],l=e[6],e=e[10],c=t+a+e;return 0<c?(c=.5/Math.sqrt(c+1),this._w=.25/c,this._x=(l-o)*c,this._y=(i-s)*c,this._z=(n-r)*c):a<t&&e<t?(c=2*Math.sqrt(1+t-a-e),this._w=(l-o)/c,this._x=.25*c,this._y=(r+n)/c,this._z=(i+s)/c):e<a?(c=2*Math.sqrt(1+a-t-e),this._w=(i-s)/c,this._x=(r+n)/c,this._y=.25*c,this._z=(o+l)/c):(c=2*Math.sqrt(1+e-t-a),this._w=(n-r)/c,this._x=(i+s)/c,this._y=(o+l)/c,this._z=.25*c),this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x),this._w=r,this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(clamp(this.dot(e),-1,1)))}rotateTowards(e,t){var r=this.angleTo(e);return 0!==r&&(t=Math.min(1,t/r),this.slerp(e,t)),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x=this._x*(e=1/e),this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){var r=e._x,i=e._y,n=e._z,e=e._w,a=t._x,o=t._y,s=t._z,t=t._w;return this._x=r*t+e*a+i*s-n*o,this._y=i*t+e*o+n*a-r*s,this._z=n*t+e*s+r*o-i*a,this._w=e*t-r*a-i*o-n*s,this._onChangeCallback(),this}slerp(t,r){if(0!==r){if(1===r)return this.copy(t);var i,n,a=this._x,o=this._y,s=this._z,l=this._w;let e=l*t._w+a*t._x+o*t._y+s*t._z;e<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,e=-e):this.copy(t),1<=e?(this._w=l,this._x=a,this._y=o,this._z=s):((t=1-e*e)<=Number.EPSILON?(this._w=(i=1-r)*l+r*this._w,this._x=i*a+r*this._x,this._y=i*o+r*this._y,this._z=i*s+r*this._z,this.normalize()):(i=Math.sqrt(t),t=Math.atan2(i,e),n=Math.sin((1-r)*t)/i,r=Math.sin(r*t)/i,this._w=l*n+this._w*r,this._x=a*n+this._x*r,this._y=o*n+this._y*r,this._z=s*n+this._z*r),this._onChangeCallback())}return this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){var e=Math.random(),t=Math.sqrt(1-e),e=Math.sqrt(e),r=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(t*Math.cos(r),e*Math.sin(i),e*Math.cos(i),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Vector3{constructor(e=0,t=0,r=0){Vector3.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return void 0===r&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(_quaternion$4.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(_quaternion$4.setFromAxisAngle(e,t))}applyMatrix3(e){var t=this.x,r=this.y,i=this.z,e=e.elements;return this.x=e[0]*t+e[3]*r+e[6]*i,this.y=e[1]*t+e[4]*r+e[7]*i,this.z=e[2]*t+e[5]*r+e[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){var t=this.x,r=this.y,i=this.z,e=e.elements,n=1/(e[3]*t+e[7]*r+e[11]*i+e[15]);return this.x=(e[0]*t+e[4]*r+e[8]*i+e[12])*n,this.y=(e[1]*t+e[5]*r+e[9]*i+e[13])*n,this.z=(e[2]*t+e[6]*r+e[10]*i+e[14])*n,this}applyQuaternion(e){var t=this.x,r=this.y,i=this.z,n=e.x,a=e.y,o=e.z,e=e.w,s=e*t+a*i-o*r,l=e*r+o*t-n*i,c=e*i+n*r-a*t,t=-n*t-a*r-o*i;return this.x=s*e+t*-n+l*-o-c*-a,this.y=l*e+t*-a+c*-n-s*-o,this.z=c*e+t*-o+s*-a-l*-n,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){var t=this.x,r=this.y,i=this.z,e=e.elements;return this.x=e[0]*t+e[4]*r+e[8]*i,this.y=e[1]*t+e[5]*r+e[9]*i,this.z=e[2]*t+e[6]*r+e[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){var r=e.x,i=e.y,e=e.z,n=t.x,a=t.y,t=t.z;return this.x=i*t-e*a,this.y=e*n-r*t,this.z=r*a-i*n,this}projectOnVector(e){var t=e.lengthSq();return 0===t?this.set(0,0,0):(t=e.dot(this)/t,this.copy(e).multiplyScalar(t))}projectOnPlane(e){return _vector$b.copy(this).projectOnVector(e),this.sub(_vector$b)}reflect(e){return this.sub(_vector$b.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());return 0===t?Math.PI/2:(e=this.dot(e)/t,Math.acos(clamp(e,-1,1)))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){var t=this.x-e.x,r=this.y-e.y,e=this.z-e.z;return t*t+r*r+e*e}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){var i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){e=e.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),e=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=e,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){var e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,r=Math.sqrt(1-e**2);return this.x=r*Math.cos(t),this.y=r*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _vector$b=new Vector3,_quaternion$4=new Quaternion;class Box3{constructor(e=new Vector3(1/0,1/0,1/0),t=new Vector3(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(r){this.makeEmpty();for(let e=0,t=r.length;e<t;e+=3)this.expandByPoint(_vector$a.fromArray(r,e));return this}setFromBufferAttribute(r){this.makeEmpty();for(let e=0,t=r.count;e<t;e++)this.expandByPoint(_vector$a.fromBufferAttribute(r,e));return this}setFromPoints(r){this.makeEmpty();for(let e=0,t=r.length;e<t;e++)this.expandByPoint(r[e]);return this}setFromCenterAndSize(e,t){t=_vector$a.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(t),this.max.copy(e).add(t),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(r,i=!1){if(r.updateWorldMatrix(!1,!1),void 0!==r.boundingBox)null===r.boundingBox&&r.computeBoundingBox(),_box$3.copy(r.boundingBox),_box$3.applyMatrix4(r.matrixWorld),this.union(_box$3);else{var e=r.geometry;if(void 0!==e)if(i&&void 0!==e.attributes&&void 0!==e.attributes.position){var n=e.attributes.position;for(let e=0,t=n.count;e<t;e++)_vector$a.fromBufferAttribute(n,e).applyMatrix4(r.matrixWorld),this.expandByPoint(_vector$a)}else null===e.boundingBox&&e.computeBoundingBox(),_box$3.copy(e.boundingBox),_box$3.applyMatrix4(r.matrixWorld),this.union(_box$3)}var a=r.children;for(let e=0,t=a.length;e<t;e++)this.expandByObject(a[e],i);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,_vector$a),_vector$a.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return r=0<e.normal.x?(t=e.normal.x*this.min.x,e.normal.x*this.max.x):(t=e.normal.x*this.max.x,e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){return!this.isEmpty()&&(this.getCenter(_center),_extents.subVectors(this.max,_center),_v0$2.subVectors(e.a,_center),_v1$7.subVectors(e.b,_center),_v2$4.subVectors(e.c,_center),_f0.subVectors(_v1$7,_v0$2),_f1.subVectors(_v2$4,_v1$7),_f2.subVectors(_v0$2,_v2$4),!!satForAxes([0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0],_v0$2,_v1$7,_v2$4,_extents))&&!!satForAxes([1,0,0,0,1,0,0,0,1],_v0$2,_v1$7,_v2$4,_extents)&&(_triangleNormal.crossVectors(_f0,_f1),satForAxes([_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],_v0$2,_v1$7,_v2$4,_extents))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,_vector$a).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(_vector$a).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(_points)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const _points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],_vector$a=new Vector3,_box$3=new Box3,_v0$2=new Vector3,_v1$7=new Vector3,_v2$4=new Vector3,_f0=new Vector3,_f1=new Vector3,_f2=new Vector3,_center=new Vector3,_extents=new Vector3,_triangleNormal=new Vector3,_testAxis=new Vector3;function satForAxes(r,i,n,a,o){for(let e=0,t=r.length-3;e<=t;e+=3){_testAxis.fromArray(r,e);var s=o.x*Math.abs(_testAxis.x)+o.y*Math.abs(_testAxis.y)+o.z*Math.abs(_testAxis.z),l=i.dot(_testAxis),c=n.dot(_testAxis),d=a.dot(_testAxis);if(Math.max(-Math.max(l,c,d),Math.min(l,c,d))>s)return!1}return!0}const _box$2=new Box3,_v1$6=new Vector3,_v2$3=new Vector3;class Sphere{constructor(e=new Vector3,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(r,e){var i=this.center;void 0!==e?i.copy(e):_box$2.setFromPoints(r).getCenter(i);let n=0;for(let e=0,t=r.length;e<t;e++)n=Math.max(n,i.distanceToSquared(r[e]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){var r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?e.makeEmpty():(e.set(this.center,this.center),e.expandByScalar(this.radius)),e}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){var t;return this.isEmpty()?(this.center.copy(e),this.radius=0):(_v1$6.subVectors(e,this.center),(e=_v1$6.lengthSq())>this.radius*this.radius&&(t=.5*((e=Math.sqrt(e))-this.radius),this.center.addScaledVector(_v1$6,t/e),this.radius+=t)),this}union(e){return e.isEmpty()||(this.isEmpty()?this.copy(e):!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(_v2$3.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(_v1$6.copy(e.center).add(_v2$3)),this.expandByPoint(_v1$6.copy(e.center).sub(_v2$3)))),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const _vector$9=new Vector3,_segCenter=new Vector3,_segDir=new Vector3,_diff=new Vector3,_edge1=new Vector3,_edge2=new Vector3,_normal$1=new Vector3;class Ray{constructor(e=new Vector3,t=new Vector3(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,_vector$9)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);e=t.dot(this.direction);return e<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,e)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){var t=_vector$9.subVectors(e,this.origin).dot(this.direction);return(t<0?this.origin:(_vector$9.copy(this.origin).addScaledVector(this.direction,t),_vector$9)).distanceToSquared(e)}distanceSqToSegment(e,t,r,i){_segCenter.copy(e).add(t).multiplyScalar(.5),_segDir.copy(t).sub(e).normalize(),_diff.copy(this.origin).sub(_segCenter);var e=.5*e.distanceTo(t),t=-this.direction.dot(_segDir),n=_diff.dot(this.direction),a=-_diff.dot(_segDir),o=_diff.lengthSq(),s=Math.abs(1-t*t);let l,c,d,h;return d=0<s?(l=t*a-n,c=t*n-a,h=e*s,0<=l?c>=-h?c<=h?(s=1/s,l*=s,c*=s,l*(l+t*c+2*n)+c*(t*l+c+2*a)+o):(c=e,-(l=Math.max(0,-(t*c+n)))*l+c*(c+2*a)+o):(c=-e,-(l=Math.max(0,-(t*c+n)))*l+c*(c+2*a)+o):c<=-h?(l=Math.max(0,-(-t*e+n)),c=0<l?-e:Math.min(Math.max(-e,-a),e),-l*l+c*(c+2*a)+o):c<=h?(l=0,(c=Math.min(Math.max(-e,-a),e))*(c+2*a)+o):(l=Math.max(0,-(t*e+n)),c=0<l?e:Math.min(Math.max(-e,-a),e),-l*l+c*(c+2*a)+o)):(c=0<t?-e:e,-(l=Math.max(0,-(t*c+n)))*l+c*(c+2*a)+o),r&&r.copy(this.origin).addScaledVector(this.direction,l),i&&i.copy(_segCenter).addScaledVector(_segDir,c),d}intersectSphere(e,t){_vector$9.subVectors(e.center,this.origin);var r=_vector$9.dot(this.direction),i=_vector$9.dot(_vector$9)-r*r,e=e.radius*e.radius;return e<i||(i=r-(e=Math.sqrt(e-i)),(r=r+e)<0)?null:i<0?this.at(r,t):this.at(i,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){var t=e.normal.dot(this.direction);return 0===t?0===e.distanceToPoint(this.origin)?0:null:0<=(e=-(this.origin.dot(e.normal)+e.constant)/t)?e:null}intersectPlane(e,t){e=this.distanceToPlane(e);return null===e?null:this.at(e,t)}intersectsPlane(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,i,n,a,o,s;var l=1/this.direction.x,c=1/this.direction.y,d=1/this.direction.z,h=this.origin;return i=0<=l?(r=(e.min.x-h.x)*l,(e.max.x-h.x)*l):(r=(e.max.x-h.x)*l,(e.min.x-h.x)*l),a=0<=c?(n=(e.min.y-h.y)*c,(e.max.y-h.y)*c):(n=(e.max.y-h.y)*c,(e.min.y-h.y)*c),r>a||n>i||((n>r||isNaN(r))&&(r=n),(a<i||isNaN(i))&&(i=a),s=0<=d?(o=(e.min.z-h.z)*d,(e.max.z-h.z)*d):(o=(e.max.z-h.z)*d,(e.min.z-h.z)*d),r>s)||o>i||((o>r||r!=r)&&(r=o),(i=s<i||i!=i?s:i)<0)?null:this.at(0<=r?r:i,t)}intersectsBox(e){return null!==this.intersectBox(e,_vector$9)}intersectTriangle(e,t,r,i,n){_edge1.subVectors(t,e),_edge2.subVectors(r,e),_normal$1.crossVectors(_edge1,_edge2);let a=this.direction.dot(_normal$1),o;if(0<a){if(i)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}_diff.subVectors(this.origin,e);t=o*this.direction.dot(_edge2.crossVectors(_diff,_edge2));return t<0||(r=o*this.direction.dot(_edge1.cross(_diff)))<0||t+r>a||(i=-o*_diff.dot(_normal$1))<0?null:this.at(i/a,n)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Matrix4{constructor(e,t,r,i,n,a,o,s,l,c,d,h,u,A,p,m){Matrix4.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,r,i,n,a,o,s,l,c,d,h,u,A,p,m)}set(e,t,r,i,n,a,o,s,l,c,d,h,u,A,p,m){var f=this.elements;return f[0]=e,f[4]=t,f[8]=r,f[12]=i,f[1]=n,f[5]=a,f[9]=o,f[13]=s,f[2]=l,f[6]=c,f[10]=d,f[14]=h,f[3]=u,f[7]=A,f[11]=p,f[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Matrix4).fromArray(this.elements)}copy(e){var t=this.elements,e=e.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],this}copyPosition(e){var t=this.elements,e=e.elements;return t[12]=e[12],t[13]=e[13],t[14]=e[14],this}setFromMatrix3(e){e=e.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){var t=this.elements,r=e.elements,i=1/_v1$5.setFromMatrixColumn(e,0).length(),n=1/_v1$5.setFromMatrixColumn(e,1).length(),e=1/_v1$5.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*n,t[5]=r[5]*n,t[6]=r[6]*n,t[7]=0,t[8]=r[8]*e,t[9]=r[9]*e,t[10]=r[10]*e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){var t,r,i,n,a=this.elements,o=e.x,s=e.y,l=e.z,c=Math.cos(o),o=Math.sin(o),d=Math.cos(s),s=Math.sin(s),h=Math.cos(l),l=Math.sin(l);return"XYZ"===e.order?(r=c*h,i=c*l,n=o*h,t=o*l,a[0]=d*h,a[4]=-d*l,a[8]=s,a[1]=i+n*s,a[5]=r-t*s,a[9]=-o*d,a[2]=t-r*s,a[6]=n+i*s,a[10]=c*d):"YXZ"===e.order?(t=d*l,r=s*h,a[0]=(n=d*h)+(i=s*l)*o,a[4]=r*o-t,a[8]=c*s,a[1]=c*l,a[5]=c*h,a[9]=-o,a[2]=t*o-r,a[6]=i+n*o,a[10]=c*d):"ZXY"===e.order?(t=d*l,r=s*h,a[0]=(i=d*h)-(n=s*l)*o,a[4]=-c*l,a[8]=r+t*o,a[1]=t+r*o,a[5]=c*h,a[9]=n-i*o,a[2]=-c*s,a[6]=o,a[10]=c*d):"ZYX"===e.order?(t=c*h,r=c*l,n=o*h,i=o*l,a[0]=d*h,a[4]=n*s-r,a[8]=t*s+i,a[1]=d*l,a[5]=i*s+t,a[9]=r*s-n,a[2]=-s,a[6]=o*d,a[10]=c*d):"YZX"===e.order?(i=c*d,t=c*s,r=o*d,n=o*s,a[0]=d*h,a[4]=n-i*l,a[8]=r*l+t,a[1]=l,a[5]=c*h,a[9]=-o*h,a[2]=-s*h,a[6]=t*l+r,a[10]=i-n*l):"XZY"===e.order&&(t=c*d,r=c*s,i=o*d,n=o*s,a[0]=d*h,a[4]=-l,a[8]=s*h,a[1]=t*l+n,a[5]=c*h,a[9]=r*l-i,a[2]=i*l-r,a[6]=o*h,a[10]=n*l+t),a[3]=0,a[7]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this}makeRotationFromQuaternion(e){return this.compose(_zero,e,_one)}lookAt(e,t,r){var i=this.elements;return _z.subVectors(e,t),0===_z.lengthSq()&&(_z.z=1),_z.normalize(),_x.crossVectors(r,_z),0===_x.lengthSq()&&(1===Math.abs(r.z)?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(r,_z)),_x.normalize(),_y.crossVectors(_z,_x),i[0]=_x.x,i[4]=_y.x,i[8]=_z.x,i[1]=_x.y,i[5]=_y.y,i[9]=_z.y,i[2]=_x.z,i[6]=_y.z,i[10]=_z.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){var e=e.elements,t=t.elements,r=this.elements,i=e[0],n=e[4],a=e[8],o=e[12],s=e[1],l=e[5],c=e[9],d=e[13],h=e[2],u=e[6],A=e[10],p=e[14],m=e[3],f=e[7],g=e[11],e=e[15],v=t[0],_=t[4],y=t[8],E=t[12],T=t[1],x=t[5],b=t[9],w=t[13],C=t[2],S=t[6],M=t[10],B=t[14],N=t[3],R=t[7],L=t[11],t=t[15];return r[0]=i*v+n*T+a*C+o*N,r[4]=i*_+n*x+a*S+o*R,r[8]=i*y+n*b+a*M+o*L,r[12]=i*E+n*w+a*B+o*t,r[1]=s*v+l*T+c*C+d*N,r[5]=s*_+l*x+c*S+d*R,r[9]=s*y+l*b+c*M+d*L,r[13]=s*E+l*w+c*B+d*t,r[2]=h*v+u*T+A*C+p*N,r[6]=h*_+u*x+A*S+p*R,r[10]=h*y+u*b+A*M+p*L,r[14]=h*E+u*w+A*B+p*t,r[3]=m*v+f*T+g*C+e*N,r[7]=m*_+f*x+g*S+e*R,r[11]=m*y+f*b+g*M+e*L,r[15]=m*E+f*w+g*B+e*t,this}multiplyScalar(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){var e=this.elements,t=e[0],r=e[4],i=e[8],n=e[12],a=e[1],o=e[5],s=e[9],l=e[13],c=e[2],d=e[6],h=e[10],u=e[14];return e[3]*(+n*s*d-i*l*d-n*o*h+r*l*h+i*o*u-r*s*u)+e[7]*(+t*s*u-t*l*h+n*a*h-i*a*u+i*l*c-n*s*c)+e[11]*(+t*l*d-t*o*u-n*a*d+r*a*u+n*o*c-r*l*c)+e[15]*(-i*o*c-t*s*d+t*o*h+i*a*d-r*a*h+r*s*c)}transpose(){var e=this.elements,t=e[1];return e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){var i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){var e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],d=e[9],h=e[10],u=e[11],A=e[12],p=e[13],m=e[14],f=e[15],g=d*m*l-p*h*l+p*s*u-o*m*u-d*s*f+o*h*f,v=A*h*l-c*m*l-A*s*u+a*m*u+c*s*f-a*h*f,_=c*p*l-A*d*l+A*o*u-a*p*u-c*o*f+a*d*f,y=A*d*s-c*p*s-A*o*h+a*p*h+c*o*m-a*d*m,E=t*g+r*v+i*_+n*y;return 0==E?this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0):(e[0]=g*(g=1/E),e[1]=(p*h*n-d*m*n-p*i*u+r*m*u+d*i*f-r*h*f)*g,e[2]=(o*m*n-p*s*n+p*i*l-r*m*l-o*i*f+r*s*f)*g,e[3]=(d*s*n-o*h*n-d*i*l+r*h*l+o*i*u-r*s*u)*g,e[4]=v*g,e[5]=(c*m*n-A*h*n+A*i*u-t*m*u-c*i*f+t*h*f)*g,e[6]=(A*s*n-a*m*n-A*i*l+t*m*l+a*i*f-t*s*f)*g,e[7]=(a*h*n-c*s*n+c*i*l-t*h*l-a*i*u+t*s*u)*g,e[8]=_*g,e[9]=(A*d*n-c*p*n-A*r*u+t*p*u+c*r*f-t*d*f)*g,e[10]=(a*p*n-A*o*n+A*r*l-t*p*l-a*r*f+t*o*f)*g,e[11]=(c*o*n-a*d*n-c*r*l+t*d*l+a*r*u-t*o*u)*g,e[12]=y*g,e[13]=(c*p*i-A*d*i+A*r*h-t*p*h-c*r*m+t*d*m)*g,e[14]=(A*o*i-a*p*i-A*r*s+t*p*s+a*r*m-t*o*m)*g,e[15]=(a*d*i-c*o*i+c*r*s-t*d*s-a*r*h+t*o*h)*g,this)}scale(e){var t=this.elements,r=e.x,i=e.y,e=e.z;return t[0]*=r,t[4]*=i,t[8]*=e,t[1]*=r,t[5]*=i,t[9]*=e,t[2]*=r,t[6]*=i,t[10]*=e,t[3]*=r,t[7]*=i,t[11]*=e,this}getMaxScaleOnAxis(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,e))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){var t=Math.cos(e),e=Math.sin(e);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this}makeRotationY(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this}makeRotationZ(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){var r=Math.cos(t),t=Math.sin(t),i=1-r,n=e.x,a=e.y,e=e.z,o=i*n,s=i*a;return this.set(o*n+r,o*a-t*e,o*e+t*a,0,o*a+t*e,s*a+r,s*e-t*n,0,o*e-t*a,s*e+t*n,i*e*e+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,n,a){return this.set(1,r,n,0,e,1,a,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){var i=this.elements,n=t._x,a=t._y,o=t._z,t=t._w,s=n+n,l=a+a,c=o+o,d=n*s,h=n*l,n=n*c,u=a*l,a=a*c,o=o*c,s=t*s,l=t*l,t=t*c,c=r.x,A=r.y,r=r.z;return i[0]=(1-(u+o))*c,i[1]=(h+t)*c,i[2]=(n-l)*c,i[3]=0,i[4]=(h-t)*A,i[5]=(1-(d+o))*A,i[6]=(a+s)*A,i[7]=0,i[8]=(n+l)*r,i[9]=(a-s)*r,i[10]=(1-(d+u))*r,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){var i=this.elements;let n=_v1$5.set(i[0],i[1],i[2]).length();var a=_v1$5.set(i[4],i[5],i[6]).length(),o=_v1$5.set(i[8],i[9],i[10]).length(),e=(this.determinant()<0&&(n=-n),e.x=i[12],e.y=i[13],e.z=i[14],_m1$2.copy(this),1/n),i=1/a,s=1/o;return _m1$2.elements[0]*=e,_m1$2.elements[1]*=e,_m1$2.elements[2]*=e,_m1$2.elements[4]*=i,_m1$2.elements[5]*=i,_m1$2.elements[6]*=i,_m1$2.elements[8]*=s,_m1$2.elements[9]*=s,_m1$2.elements[10]*=s,t.setFromRotationMatrix(_m1$2),r.x=n,r.y=a,r.z=o,this}makePerspective(e,t,r,i,n,a,o=WebGLCoordinateSystem){var s=this.elements,l=2*n/(t-e),c=2*n/(r-i),t=(t+e)/(t-e),e=(r+i)/(r-i);let d,h;if(o===WebGLCoordinateSystem)d=-(a+n)/(a-n),h=-2*a*n/(a-n);else{if(o!==WebGPUCoordinateSystem)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);d=-a/(a-n),h=-a*n/(a-n)}return s[0]=l,s[4]=0,s[8]=t,s[12]=0,s[1]=0,s[5]=c,s[9]=e,s[13]=0,s[2]=0,s[6]=0,s[10]=d,s[14]=h,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,r,i,n,a,o=WebGLCoordinateSystem){var s=this.elements,l=1/(t-e),c=1/(r-i),d=1/(a-n),t=(t+e)*l,e=(r+i)*c;let h,u;if(o===WebGLCoordinateSystem)h=(a+n)*d,u=-2*d;else{if(o!==WebGPUCoordinateSystem)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);h=n*d,u=-1*d}return s[0]=2*l,s[4]=0,s[8]=0,s[12]=-t,s[1]=0,s[5]=2*c,s[9]=0,s[13]=-e,s[2]=0,s[6]=0,s[10]=u,s[14]=-h,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){var t=this.elements,r=e.elements;for(let e=0;e<16;e++)if(t[e]!==r[e])return!1;return!0}fromArray(t,r=0){for(let e=0;e<16;e++)this.elements[e]=t[e+r];return this}toArray(e=[],t=0){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const _v1$5=new Vector3,_m1$2=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y=new Vector3,_z=new Vector3,_matrix=new Matrix4,_quaternion$3=new Quaternion;class Euler{constructor(e=0,t=0,r=0,i=Euler.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){var e=e.elements,i=e[0],n=e[4],a=e[8],o=e[1],s=e[5],l=e[9],c=e[2],d=e[6],h=e[10];switch(t){case"XYZ":this._y=Math.asin(clamp(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,h),this._z=Math.atan2(-n,i)):(this._x=Math.atan2(d,s),this._z=0);break;case"YXZ":this._x=Math.asin(-clamp(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(a,h),this._z=Math.atan2(o,s)):(this._y=Math.atan2(-c,i),this._z=0);break;case"ZXY":this._x=Math.asin(clamp(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-c,h),this._z=Math.atan2(-n,s)):(this._y=0,this._z=Math.atan2(o,i));break;case"ZYX":this._y=Math.asin(-clamp(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(d,h),this._z=Math.atan2(o,i)):(this._x=0,this._z=Math.atan2(-n,s));break;case"YZX":this._z=Math.asin(clamp(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,s),this._y=Math.atan2(-c,i)):(this._x=0,this._y=Math.atan2(a,h));break;case"XZY":this._z=Math.asin(-clamp(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(d,s),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-l,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===r&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return _matrix.makeRotationFromQuaternion(e),this.setFromRotationMatrix(_matrix,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return _quaternion$3.setFromEuler(this),this.setFromQuaternion(_quaternion$3,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Euler.DEFAULT_ORDER="XYZ";class Layers{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let _object3DId=0;const _v1$4=new Vector3,_q1=new Quaternion,_m1$1=new Matrix4,_target=new Vector3,_position$3=new Vector3,_scale$2=new Vector3,_quaternion$2=new Quaternion,_xAxis=new Vector3(1,0,0),_yAxis=new Vector3(0,1,0),_zAxis=new Vector3(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"};class Object3D extends EventDispatcher{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DEFAULT_UP.clone();var e=new Vector3;const t=new Euler,r=new Quaternion;var i=new Vector3(1,1,1);t._onChange(function(){r.setFromEuler(t,!1)}),r._onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return _q1.setFromAxisAngle(e,t),this.quaternion.multiply(_q1),this}rotateOnWorldAxis(e,t){return _q1.setFromAxisAngle(e,t),this.quaternion.premultiply(_q1),this}rotateX(e){return this.rotateOnAxis(_xAxis,e)}rotateY(e){return this.rotateOnAxis(_yAxis,e)}rotateZ(e){return this.rotateOnAxis(_zAxis,e)}translateOnAxis(e,t){return _v1$4.copy(e).applyQuaternion(this.quaternion),this.position.add(_v1$4.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(_xAxis,e)}translateY(e){return this.translateOnAxis(_yAxis,e)}translateZ(e){return this.translateOnAxis(_zAxis,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(_m1$1.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?_target.copy(e):_target.set(e,t,r);e=this.parent;this.updateWorldMatrix(!0,!1),_position$3.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1.lookAt(_position$3,_target,this.up):_m1$1.lookAt(_target,_position$3,this.up),this.quaternion.setFromRotationMatrix(_m1$1),e&&(_m1$1.extractRotation(e.matrixWorld),_q1.setFromRotationMatrix(_m1$1),this.quaternion.premultiply(_q1.invert()))}add(e){if(1<arguments.length)for(let e=0;e<arguments.length;e++)this.add(arguments[e]);else e===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",e):e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),(e.parent=this).children.push(e),e.dispatchEvent(_addedEvent)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e);return this}remove(e){if(1<arguments.length)for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);else{var t=this.children.indexOf(e);-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(_removedEvent))}return this}removeFromParent(){var e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){var t=this.children[e];t.parent=null,t.dispatchEvent(_removedEvent)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),_m1$1.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),_m1$1.multiply(e.parent.matrixWorld)),e.applyMatrix4(_m1$1),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(r,i){if(this[r]===i)return this;for(let e=0,t=this.children.length;e<t;e++){var n=this.children[e].getObjectByProperty(r,i);if(void 0!==n)return n}}getObjectsByProperty(r,i){let n=[];this[r]===i&&n.push(this);for(let e=0,t=this.children.length;e<t;e++){var a=this.children[e].getObjectsByProperty(r,i);0<a.length&&(n=n.concat(a))}return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,e,_scale$2),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,_quaternion$2,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(r){r(this);var i=this.children;for(let e=0,t=i.length;e<t;e++)i[e].traverse(r)}traverseVisible(r){if(!1!==this.visible){r(this);var i=this.children;for(let e=0,t=i.length;e<t;e++)i[e].traverseVisible(r)}}traverseAncestors(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(r){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||r)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),r=!(this.matrixWorldNeedsUpdate=!1));var i=this.children;for(let e=0,t=i.length;e<t;e++){var n=i[e];!0!==n.matrixWorldAutoUpdate&&!0!==r||n.updateMatrixWorld(r)}}updateWorldMatrix(e,t){var r=this.parent;if(!0===e&&null!==r&&!0===r.matrixWorldAutoUpdate&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){var i=this.children;for(let e=0,t=i.length;e<t;e++){var n=i[e];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(r){var e,t,i,n,a,o,s=void 0===r||"string"==typeof r,l={},c=(s&&(r={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},l.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"}),{});function d(e,t){return void 0===e[t.uuid]&&(e[t.uuid]=t.toJSON(r)),t.uuid}if(c.uuid=this.uuid,c.type=this.type,""!==this.name&&(c.name=this.name),!0===this.castShadow&&(c.castShadow=!0),!0===this.receiveShadow&&(c.receiveShadow=!0),!1===this.visible&&(c.visible=!1),!1===this.frustumCulled&&(c.frustumCulled=!1),0!==this.renderOrder&&(c.renderOrder=this.renderOrder),0<Object.keys(this.userData).length&&(c.userData=this.userData),c.layers=this.layers.mask,c.matrix=this.matrix.toArray(),c.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(c.matrixAutoUpdate=!1),this.isInstancedMesh&&(c.type="InstancedMesh",c.count=this.count,c.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor)&&(c.instanceColor=this.instanceColor.toJSON()),this.isScene)this.background&&(this.background.isColor?c.background=this.background.toJSON():this.background.isTexture&&(c.background=this.background.toJSON(r).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(c.environment=this.environment.toJSON(r).uuid);else if(this.isMesh||this.isLine||this.isPoints){c.geometry=d(r.geometries,this.geometry);var h=this.geometry.parameters;if(void 0!==h&&void 0!==h.shapes){var u=h.shapes;if(Array.isArray(u))for(let e=0,t=u.length;e<t;e++){var A=u[e];d(r.shapes,A)}else d(r.shapes,u)}}if(this.isSkinnedMesh&&(c.bindMode=this.bindMode,c.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton)&&(d(r.skeletons,this.skeleton),c.skeleton=this.skeleton.uuid),void 0!==this.material)if(Array.isArray(this.material)){var p=[];for(let e=0,t=this.material.length;e<t;e++)p.push(d(r.materials,this.material[e]));c.material=p}else c.material=d(r.materials,this.material);if(0<this.children.length){c.children=[];for(let e=0;e<this.children.length;e++)c.children.push(this.children[e].toJSON(r).object)}if(0<this.animations.length){c.animations=[];for(let e=0;e<this.animations.length;e++){var m=this.animations[e];c.animations.push(d(r.animations,m))}}return s&&(h=f(r.geometries),s=f(r.materials),e=f(r.textures),t=f(r.images),i=f(r.shapes),n=f(r.skeletons),a=f(r.animations),o=f(r.nodes),0<h.length&&(l.geometries=h),0<s.length&&(l.materials=s),0<e.length&&(l.textures=e),0<t.length&&(l.images=t),0<i.length&&(l.shapes=i),0<n.length&&(l.skeletons=n),0<a.length&&(l.animations=a),0<o.length)&&(l.nodes=o),l.object=c,l;function f(e){var t=[];for(const i in e){var r=e[i];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){var r=t.children[e];this.add(r.clone())}return this}}Object3D.DEFAULT_UP=new Vector3(0,1,0),Object3D.DEFAULT_MATRIX_AUTO_UPDATE=!0,Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const _v0$1=new Vector3,_v1$3=new Vector3,_v2$2=new Vector3,_v3$1=new Vector3,_vab=new Vector3,_vac=new Vector3,_vbc=new Vector3,_vap=new Vector3,_vbp=new Vector3,_vcp=new Vector3;let warnedGetUV=!1;class Triangle{constructor(e=new Vector3,t=new Vector3,r=new Vector3){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),_v0$1.subVectors(e,t),i.cross(_v0$1);r=i.lengthSq();return 0<r?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,r,i,n){_v0$1.subVectors(i,t),_v1$3.subVectors(r,t),_v2$2.subVectors(e,t);var i=_v0$1.dot(_v0$1),r=_v0$1.dot(_v1$3),e=_v0$1.dot(_v2$2),t=_v1$3.dot(_v1$3),a=_v1$3.dot(_v2$2),o=i*t-r*r;return 0==o?n.set(-2,-1,-1):n.set(1-(t=(t*e-r*a)*(n=1/o))-(o=(i*a-r*e)*n),o,t)}static containsPoint(e,t,r,i){return this.getBarycoord(e,t,r,i,_v3$1),0<=_v3$1.x&&0<=_v3$1.y&&_v3$1.x+_v3$1.y<=1}static getUV(e,t,r,i,n,a,o,s){return!1===warnedGetUV&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),warnedGetUV=!0),this.getInterpolation(e,t,r,i,n,a,o,s)}static getInterpolation(e,t,r,i,n,a,o,s){return this.getBarycoord(e,t,r,i,_v3$1),s.setScalar(0),s.addScaledVector(n,_v3$1.x),s.addScaledVector(a,_v3$1.y),s.addScaledVector(o,_v3$1.z),s}static isFrontFacing(e,t,r,i){return _v0$1.subVectors(r,t),_v1$3.subVectors(e,t),_v0$1.cross(_v1$3).dot(i)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),.5*_v0$1.cross(_v1$3).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Triangle.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Triangle.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,r,i,n){return!1===warnedGetUV&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),warnedGetUV=!0),Triangle.getInterpolation(e,this.a,this.b,this.c,t,r,i,n)}getInterpolation(e,t,r,i,n){return Triangle.getInterpolation(e,this.a,this.b,this.c,t,r,i,n)}containsPoint(e){return Triangle.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Triangle.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){var r=this.a,i=this.b,n=this.c;let a,o;_vab.subVectors(i,r),_vac.subVectors(n,r),_vap.subVectors(e,r);var s=_vab.dot(_vap),l=_vac.dot(_vap);if(s<=0&&l<=0)return t.copy(r);_vbp.subVectors(e,i);var c=_vab.dot(_vbp),d=_vac.dot(_vbp);if(0<=c&&d<=c)return t.copy(i);var h=s*d-c*l;if(h<=0&&0<=s&&c<=0)return a=s/(s-c),t.copy(r).addScaledVector(_vab,a);_vcp.subVectors(e,n);var e=_vab.dot(_vcp),u=_vac.dot(_vcp);return 0<=u&&e<=u?t.copy(n):(s=e*l-s*u)<=0&&0<=l&&u<=0?(o=l/(l-u),t.copy(r).addScaledVector(_vac,o)):(l=c*u-e*d)<=0&&0<=d-c&&0<=e-u?(_vbc.subVectors(n,i),o=(d-c)/(d-c+(e-u)),t.copy(i).addScaledVector(_vbc,o)):(n=1/(l+s+h),a=s*n,o=h*n,t.copy(r).addScaledVector(_vab,a).addScaledVector(_vac,o))}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let materialId=0;class Material extends EventDispatcher{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:materialId++}),this.uuid=generateUUID(),this.name="",this.type="Material",this.blending=NormalBlending,this.side=FrontSide,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){0<this._alphaTest!=0<e&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const i in e){var t,r=e[i];void 0===r?console.warn(`THREE.Material: parameter '${i}' has value of undefined.`):void 0===(t=this[i])?console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`):t&&t.isColor?t.set(r):t&&t.isVector3&&r&&r.isVector3?t.copy(r):this[i]=r}}toJSON(e){var t=void 0===e||"string"==typeof e,r=(t&&(e={textures:{},images:{}}),{metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}});function i(e){var t=[];for(const i in e){var r=e[i];delete r.metadata,t.push(r)}return t}return r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),void 0!==this.sheen&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(r.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(r.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(r.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine)&&(r.combine=this.combine),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(r.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(r.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(r.size=this.size),null!==this.shadowSide&&(r.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(r.blending=this.blending),this.side!==FrontSide&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.colorWrite=this.colorWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),0<this.alphaTest&&(r.alphaTest=this.alphaTest),!0===this.alphaHash&&(r.alphaHash=this.alphaHash),!0===this.alphaToCoverage&&(r.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(r.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(r.wireframe=this.wireframe),1<this.wireframeLinewidth&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(r.flatShading=this.flatShading),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),!1===this.fog&&(r.fog=!1),0<Object.keys(this.userData).length&&(r.userData=this.userData),t&&(t=i(e.textures),e=i(e.images),0<t.length&&(r.textures=t),0<e.length)&&(r.images=e),r}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes;let r=null;if(null!==t){var i=t.length;r=new Array(i);for(let e=0;e!==i;++e)r[e]=t[e].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}const _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(e,t,r){return r<0&&(r+=1),1<r&&--r,r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}class Color{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,r)}set(e,t,r){var i;return void 0===t&&void 0===r?(i=e)&&i.isColor?this.copy(i):"number"==typeof i?this.setHex(i):"string"==typeof i&&this.setStyle(i):this.setRGB(e,t,r),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=SRGBColorSpace){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,ColorManagement.toWorkingColorSpace(this,t),this}setRGB(e,t,r,i=ColorManagement.workingColorSpace){return this.r=e,this.g=t,this.b=r,ColorManagement.toWorkingColorSpace(this,i),this}setHSL(e,t,r,i=ColorManagement.workingColorSpace){return e=euclideanModulo(e,1),t=clamp(t,0,1),r=clamp(r,0,1),0===t?this.r=this.g=this.b=r:(this.r=hue2rgb(t=2*r-(r=r<=.5?r*(1+t):r+t-r*t),r,e+1/3),this.g=hue2rgb(t,r,e),this.b=hue2rgb(t,r,e-1/3)),ColorManagement.toWorkingColorSpace(this,i),this}setStyle(t,r=SRGBColorSpace){function i(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}if(o=/^(\w+)\(([^\)]*)\)/.exec(t)){let e;var n=o[1],a=o[2];switch(n){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(e[4]),this.setRGB(Math.min(255,parseInt(e[1],10))/255,Math.min(255,parseInt(e[2],10))/255,Math.min(255,parseInt(e[3],10))/255,r);if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(e[4]),this.setRGB(Math.min(100,parseInt(e[1],10))/100,Math.min(100,parseInt(e[2],10))/100,Math.min(100,parseInt(e[3],10))/100,r);break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(e[4]),this.setHSL(parseFloat(e[1])/360,parseFloat(e[2])/100,parseFloat(e[3])/100,r);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(o=/^\#([A-Fa-f\d]+)$/.exec(t)){var n=o[1],o=n.length;if(3===o)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,r);if(6===o)return this.setHex(parseInt(n,16),r);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&0<t.length)return this.setColorName(t,r);return this}setColorName(e,t=SRGBColorSpace){var r=_colorKeywords[e.toLowerCase()];return void 0!==r?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=SRGBToLinear(e.r),this.g=SRGBToLinear(e.g),this.b=SRGBToLinear(e.b),this}copyLinearToSRGB(e){return this.r=LinearToSRGB(e.r),this.g=LinearToSRGB(e.g),this.b=LinearToSRGB(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=SRGBColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),e),65536*Math.round(clamp(255*_color.r,0,255))+256*Math.round(clamp(255*_color.g,0,255))+Math.round(clamp(255*_color.b,0,255))}getHexString(e=SRGBColorSpace){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=ColorManagement.workingColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),t);var r=_color.r,i=_color.g,n=_color.b,t=Math.max(r,i,n),a=Math.min(r,i,n);let o,s;var l=(a+t)/2;if(a===t)o=0,s=0;else{var c=t-a;switch(s=l<=.5?c/(t+a):c/(2-t-a),t){case r:o=(i-n)/c+(i<n?6:0);break;case i:o=(n-r)/c+2;break;case n:o=(r-i)/c+4}o/=6}return e.h=o,e.s=s,e.l=l,e}getRGB(e,t=ColorManagement.workingColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),t),e.r=_color.r,e.g=_color.g,e.b=_color.b,e}getStyle(e=SRGBColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),e);var t=_color.r,r=_color.g,i=_color.b;return e!==SRGBColorSpace?`color(${e} ${t.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*r)},${Math.round(255*i)})`}offsetHSL(e,t,r){return this.getHSL(_hslA),_hslA.h+=e,_hslA.s+=t,_hslA.l+=r,this.setHSL(_hslA.h,_hslA.s,_hslA.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(_hslA),e.getHSL(_hslB);var e=lerp(_hslA.h,_hslB.h,t),r=lerp(_hslA.s,_hslB.s,t),t=lerp(_hslA.l,_hslB.l,t);return this.setHSL(e,r,t),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){var t=this.r,r=this.g,i=this.b,e=e.elements;return this.r=e[0]*t+e[3]*r+e[6]*i,this.g=e[1]*t+e[4]*r+e[7]*i,this.b=e[2]*t+e[5]*r+e[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const _color=new Color;Color.NAMES=_colorKeywords;class MeshBasicMaterial extends Material{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const _tables=_generateTables();function _generateTables(){var e=new ArrayBuffer(4),t=new Float32Array(e),e=new Uint32Array(e),r=new Uint32Array(512),i=new Uint32Array(512);for(let e=0;e<256;++e){var n=e-127;n<-27?(r[e]=0,r[256|e]=32768,i[e]=24,i[256|e]=24):n<-14?(r[e]=1024>>-n-14,r[256|e]=1024>>-n-14|32768,i[e]=-n-1,i[256|e]=-n-1):n<=15?(r[e]=15+n<<10,r[256|e]=15+n<<10|32768,i[e]=13,i[256|e]=13):n<128?(r[e]=31744,r[256|e]=64512,i[e]=24,i[256|e]=24):(r[e]=31744,r[256|e]=64512,i[e]=13,i[256|e]=13)}var a=new Uint32Array(2048),o=new Uint32Array(64),s=new Uint32Array(64);for(let r=1;r<1024;++r){let e=r<<13,t=0;for(;0==(8388608&e);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,a[r]=e|t}for(let e=1024;e<2048;++e)a[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)o[e]=e<<23;o[31]=1199570944,o[32]=2147483648;for(let e=33;e<63;++e)o[e]=2147483648+(e-32<<23);o[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(s[e]=1024);return{floatView:t,uint32View:e,baseTable:r,shiftTable:i,mantissaTable:a,exponentTable:o,offsetTable:s}}function toHalfFloat(e){65504<Math.abs(e)&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=clamp(e,-65504,65504),_tables.floatView[0]=e;var e=_tables.uint32View[0],t=e>>23&511;return _tables.baseTable[t]+((8388607&e)>>_tables.shiftTable[t])}function fromHalfFloat(e){var t=e>>10;return _tables.uint32View[0]=_tables.mantissaTable[_tables.offsetTable[t]+(1023&e)]+_tables.exponentTable[t],_tables.floatView[0]}const DataUtils={toHalfFloat:toHalfFloat,fromHalfFloat:fromHalfFloat},_vector$8=new Vector3,_vector2$1=new Vector2;class BufferAttribute{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=r,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.gpuType=FloatType,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(r,i,n){r*=this.itemSize,n*=i.itemSize;for(let e=0,t=this.itemSize;e<t;e++)this.array[r+e]=i.array[n+e];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(r){if(2===this.itemSize)for(let e=0,t=this.count;e<t;e++)_vector2$1.fromBufferAttribute(this,e),_vector2$1.applyMatrix3(r),this.setXY(e,_vector2$1.x,_vector2$1.y);else if(3===this.itemSize)for(let e=0,t=this.count;e<t;e++)_vector$8.fromBufferAttribute(this,e),_vector$8.applyMatrix3(r),this.setXYZ(e,_vector$8.x,_vector$8.y,_vector$8.z);return this}applyMatrix4(r){for(let e=0,t=this.count;e<t;e++)_vector$8.fromBufferAttribute(this,e),_vector$8.applyMatrix4(r),this.setXYZ(e,_vector$8.x,_vector$8.y,_vector$8.z);return this}applyNormalMatrix(r){for(let e=0,t=this.count;e<t;e++)_vector$8.fromBufferAttribute(this,e),_vector$8.applyNormalMatrix(r),this.setXYZ(e,_vector$8.x,_vector$8.y,_vector$8.z);return this}transformDirection(r){for(let e=0,t=this.count;e<t;e++)_vector$8.fromBufferAttribute(this,e),_vector$8.transformDirection(r),this.setXYZ(e,_vector$8.x,_vector$8.y,_vector$8.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return r=this.normalized?denormalize(r,this.array):r}setComponent(e,t,r){return this.normalized&&(r=normalize(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return t=this.normalized?denormalize(t,this.array):t}setX(e,t){return this.normalized&&(t=normalize(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return t=this.normalized?denormalize(t,this.array):t}setY(e,t){return this.normalized&&(t=normalize(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return t=this.normalized?denormalize(t,this.array):t}setZ(e,t){return this.normalized&&(t=normalize(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return t=this.normalized?denormalize(t,this.array):t}setW(e,t){return this.normalized&&(t=normalize(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=normalize(t,this.array),r=normalize(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=normalize(t,this.array),r=normalize(r,this.array),i=normalize(i,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,n){return e*=this.itemSize,this.normalized&&(t=normalize(t,this.array),r=normalize(r,this.array),i=normalize(i,this.array),n=normalize(n,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=n,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){var e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==StaticDrawUsage&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}class Int8BufferAttribute extends BufferAttribute{constructor(e,t,r){super(new Int8Array(e),t,r)}}class Uint8BufferAttribute extends BufferAttribute{constructor(e,t,r){super(new Uint8Array(e),t,r)}}class Uint8ClampedBufferAttribute extends BufferAttribute{constructor(e,t,r){super(new Uint8ClampedArray(e),t,r)}}class Int16BufferAttribute extends BufferAttribute{constructor(e,t,r){super(new Int16Array(e),t,r)}}class Uint16BufferAttribute extends BufferAttribute{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class Int32BufferAttribute extends BufferAttribute{constructor(e,t,r){super(new Int32Array(e),t,r)}}class Uint32BufferAttribute extends BufferAttribute{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class Float16BufferAttribute extends BufferAttribute{constructor(e,t,r){super(new Uint16Array(e),t,r),this.isFloat16BufferAttribute=!0}getX(e){let t=fromHalfFloat(this.array[e*this.itemSize]);return t=this.normalized?denormalize(t,this.array):t}setX(e,t){return this.normalized&&(t=normalize(t,this.array)),this.array[e*this.itemSize]=toHalfFloat(t),this}getY(e){let t=fromHalfFloat(this.array[e*this.itemSize+1]);return t=this.normalized?denormalize(t,this.array):t}setY(e,t){return this.normalized&&(t=normalize(t,this.array)),this.array[e*this.itemSize+1]=toHalfFloat(t),this}getZ(e){let t=fromHalfFloat(this.array[e*this.itemSize+2]);return t=this.normalized?denormalize(t,this.array):t}setZ(e,t){return this.normalized&&(t=normalize(t,this.array)),this.array[e*this.itemSize+2]=toHalfFloat(t),this}getW(e){let t=fromHalfFloat(this.array[e*this.itemSize+3]);return t=this.normalized?denormalize(t,this.array):t}setW(e,t){return this.normalized&&(t=normalize(t,this.array)),this.array[e*this.itemSize+3]=toHalfFloat(t),this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=normalize(t,this.array),r=normalize(r,this.array)),this.array[e+0]=toHalfFloat(t),this.array[e+1]=toHalfFloat(r),this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=normalize(t,this.array),r=normalize(r,this.array),i=normalize(i,this.array)),this.array[e+0]=toHalfFloat(t),this.array[e+1]=toHalfFloat(r),this.array[e+2]=toHalfFloat(i),this}setXYZW(e,t,r,i,n){return e*=this.itemSize,this.normalized&&(t=normalize(t,this.array),r=normalize(r,this.array),i=normalize(i,this.array),n=normalize(n,this.array)),this.array[e+0]=toHalfFloat(t),this.array[e+1]=toHalfFloat(r),this.array[e+2]=toHalfFloat(i),this.array[e+3]=toHalfFloat(n),this}}class Float32BufferAttribute extends BufferAttribute{constructor(e,t,r){super(new Float32Array(e),t,r)}}class Float64BufferAttribute extends BufferAttribute{constructor(e,t,r){super(new Float64Array(e),t,r)}}let _id$1=0;const _m1=new Matrix4,_obj=new Object3D,_offset=new Vector3,_box$1=new Box3,_boxMorphTargets=new Box3,_vector$7=new Vector3;class BufferGeometry extends EventDispatcher{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_id$1++}),this.uuid=generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(arrayNeedsUint32(e)?Uint32BufferAttribute:Uint16BufferAttribute)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){var t=this.attributes.position,t=(void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0),this.attributes.normal),r=(void 0!==t&&(r=(new Matrix3).getNormalMatrix(e),t.applyNormalMatrix(r),t.needsUpdate=!0),this.attributes.tangent);return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return _m1.makeRotationFromQuaternion(e),this.applyMatrix4(_m1),this}rotateX(e){return _m1.makeRotationX(e),this.applyMatrix4(_m1),this}rotateY(e){return _m1.makeRotationY(e),this.applyMatrix4(_m1),this}rotateZ(e){return _m1.makeRotationZ(e),this.applyMatrix4(_m1),this}translate(e,t,r){return _m1.makeTranslation(e,t,r),this.applyMatrix4(_m1),this}scale(e,t,r){return _m1.makeScale(e,t,r),this.applyMatrix4(_m1),this}lookAt(e){return _obj.lookAt(e),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this}setFromPoints(r){var i=[];for(let e=0,t=r.length;e<t;e++){var n=r[e];i.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Float32BufferAttribute(i,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Box3);var e=this.attributes.position,r=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));else{if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),r)for(let e=0,t=r.length;e<t;e++){var i=r[e];_box$1.setFromBufferAttribute(i),this.morphTargetsRelative?(_vector$7.addVectors(this.boundingBox.min,_box$1.min),this.boundingBox.expandByPoint(_vector$7),_vector$7.addVectors(this.boundingBox.max,_box$1.max),this.boundingBox.expandByPoint(_vector$7)):(this.boundingBox.expandByPoint(_box$1.min),this.boundingBox.expandByPoint(_box$1.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);var i=this.attributes.position,n=this.morphAttributes.position;if(i&&i.isGLBufferAttribute)console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Vector3,1/0);else if(i){var a=this.boundingSphere.center;if(_box$1.setFromBufferAttribute(i),n)for(let e=0,t=n.length;e<t;e++){var o=n[e];_boxMorphTargets.setFromBufferAttribute(o),this.morphTargetsRelative?(_vector$7.addVectors(_box$1.min,_boxMorphTargets.min),_box$1.expandByPoint(_vector$7),_vector$7.addVectors(_box$1.max,_boxMorphTargets.max),_box$1.expandByPoint(_vector$7)):(_box$1.expandByPoint(_boxMorphTargets.min),_box$1.expandByPoint(_boxMorphTargets.max))}_box$1.getCenter(a);let r=0;for(let e=0,t=i.count;e<t;e++)_vector$7.fromBufferAttribute(i,e),r=Math.max(r,a.distanceToSquared(_vector$7));if(n)for(let e=0,t=n.length;e<t;e++){var s=n[e],l=this.morphTargetsRelative;for(let e=0,t=s.count;e<t;e++)_vector$7.fromBufferAttribute(s,e),l&&(_offset.fromBufferAttribute(i,e),_vector$7.add(_offset)),r=Math.max(r,a.distanceToSquared(_vector$7))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){var e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");else{var i=e.array;const p=t.position.array,m=t.normal.array,f=t.uv.array;var n,a,o,s,l=p.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*l),4));const g=this.getAttribute("tangent").array,v=[],_=[];for(let e=0;e<l;e++)v[e]=new Vector3,_[e]=new Vector3;const y=new Vector3,E=new Vector3,T=new Vector3,x=new Vector2,b=new Vector2,w=new Vector2,C=new Vector3,S=new Vector3;let r=this.groups;for(let e=0,t=(r=0===r.length?[{start:0,count:i.length}]:r).length;e<t;++e){var c=r[e],d=c.start;for(let e=d,t=d+c.count;e<t;e+=3)n=i[e+0],a=i[e+1],o=i[e+2],s=void 0,y.fromArray(p,3*n),E.fromArray(p,3*a),T.fromArray(p,3*o),x.fromArray(f,2*n),b.fromArray(f,2*a),w.fromArray(f,2*o),E.sub(y),T.sub(y),b.sub(x),w.sub(x),s=1/(b.x*w.y-w.x*b.y),isFinite(s)&&(C.copy(E).multiplyScalar(w.y).addScaledVector(T,-b.y).multiplyScalar(s),S.copy(T).multiplyScalar(b.x).addScaledVector(E,-w.x).multiplyScalar(s),v[n].add(C),v[a].add(C),v[o].add(C),_[n].add(S),_[a].add(S),_[o].add(S))}const M=new Vector3,B=new Vector3,N=new Vector3,R=new Vector3;for(let e=0,t=r.length;e<t;++e){var h=r[e],u=h.start;for(let e=u,t=u+h.count;e<t;e+=3)A(i[e+0]),A(i[e+1]),A(i[e+2])}function A(e){N.fromArray(m,3*e),R.copy(N);var t=v[e],t=(M.copy(t),M.sub(N.multiplyScalar(N.dot(t))).normalize(),B.crossVectors(R,t),B.dot(_[e])),t=t<0?-1:1;g[4*e]=M.x,g[4*e+1]=M.y,g[4*e+2]=M.z,g[4*e+3]=t}}}computeVertexNormals(){var i=this.index,n=this.getAttribute("position");if(void 0!==n){let r=this.getAttribute("normal");if(void 0===r)r=new BufferAttribute(new Float32Array(3*n.count),3),this.setAttribute("normal",r);else for(let e=0,t=r.count;e<t;e++)r.setXYZ(e,0,0,0);var a=new Vector3,o=new Vector3,s=new Vector3,l=new Vector3,c=new Vector3,d=new Vector3,h=new Vector3,u=new Vector3;if(i)for(let e=0,t=i.count;e<t;e+=3){var A=i.getX(e+0),p=i.getX(e+1),m=i.getX(e+2);a.fromBufferAttribute(n,A),o.fromBufferAttribute(n,p),s.fromBufferAttribute(n,m),h.subVectors(s,o),u.subVectors(a,o),h.cross(u),l.fromBufferAttribute(r,A),c.fromBufferAttribute(r,p),d.fromBufferAttribute(r,m),l.add(h),c.add(h),d.add(h),r.setXYZ(A,l.x,l.y,l.z),r.setXYZ(p,c.x,c.y,c.z),r.setXYZ(m,d.x,d.y,d.z)}else for(let e=0,t=n.count;e<t;e+=3)a.fromBufferAttribute(n,e+0),o.fromBufferAttribute(n,e+1),s.fromBufferAttribute(n,e+2),h.subVectors(s,o),u.subVectors(a,o),h.cross(u),r.setXYZ(e+0,h.x,h.y,h.z),r.setXYZ(e+1,h.x,h.y,h.z),r.setXYZ(e+2,h.x,h.y,h.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){var r=this.attributes.normal;for(let e=0,t=r.count;e<t;e++)_vector$7.fromBufferAttribute(r,e),_vector$7.normalize(),r.setXYZ(e,_vector$7.x,_vector$7.y,_vector$7.z)}toNonIndexed(){function r(r,i){var n=r.array,a=r.itemSize,e=r.normalized,o=new n.constructor(i.length*a);let s=0,l=0;for(let e=0,t=i.length;e<t;e++){s=r.isInterleavedBufferAttribute?i[e]*r.data.stride+r.offset:i[e]*a;for(let e=0;e<a;e++)o[l++]=n[s++]}return new BufferAttribute(o,a,e)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var i=new BufferGeometry,n=this.index.array,e=this.attributes;for(const h in e){var t=r(e[h],n);i.setAttribute(h,t)}var a=this.morphAttributes;for(const u in a){var o=[],s=a[u];for(let e=0,t=s.length;e<t;e++){var l=r(s[e],n);o.push(l)}i.morphAttributes[u]=o}i.morphTargetsRelative=this.morphTargetsRelative;var c=this.groups;for(let e=0,t=c.length;e<t;e++){var d=c[e];i.addGroup(d.start,d.count,d.materialIndex)}return i}toJSON(){var r={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),0<Object.keys(this.userData).length&&(r.userData=this.userData),void 0!==this.parameters){var e=this.parameters;for(const c in e)void 0!==e[c]&&(r[c]=e[c])}else{r.data={attributes:{}};var t=this.index,i=(null!==t&&(r.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)}),this.attributes);for(const d in i){var n=i[d];r.data.attributes[d]=n.toJSON(r.data)}var a={};let e=!1;for(const h in this.morphAttributes){var o=this.morphAttributes[h],s=[];for(let e=0,t=o.length;e<t;e++){var l=o[e];s.push(l.toJSON(r.data))}0<s.length&&(a[h]=s,e=!0)}e&&(r.data.morphAttributes=a,r.data.morphTargetsRelative=this.morphTargetsRelative);t=this.groups,t=(0<t.length&&(r.data.groups=JSON.parse(JSON.stringify(t))),this.boundingSphere);null!==t&&(r.data.boundingSphere={center:t.center.toArray(),radius:t.radius})}return r}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var r={},t=(this.name=e.name,e.index),i=(null!==t&&this.setIndex(t.clone(r)),e.attributes);for(const d in i){var n=i[d];this.setAttribute(d,n.clone(r))}var a=e.morphAttributes;for(const h in a){var o=[],s=a[h];for(let e=0,t=s.length;e<t;e++)o.push(s[e].clone(r));this.morphAttributes[h]=o}this.morphTargetsRelative=e.morphTargetsRelative;var l=e.groups;for(let e=0,t=l.length;e<t;e++){var c=l[e];this.addGroup(c.start,c.count,c.materialIndex)}t=e.boundingBox,null!==t&&(this.boundingBox=t.clone()),t=e.boundingSphere;return null!==t&&(this.boundingSphere=t.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const _inverseMatrix$3=new Matrix4,_ray$3=new Ray,_sphere$5=new Sphere,_sphereHitAt=new Vector3,_vA$1=new Vector3,_vB$1=new Vector3,_vC$1=new Vector3,_tempA=new Vector3,_morphA=new Vector3,_uvA$1=new Vector2,_uvB$1=new Vector2,_uvC$1=new Vector2,_normalA=new Vector3,_normalB=new Vector3,_normalC=new Vector3,_intersectionPoint=new Vector3,_intersectionPointWorld=new Vector3;class Mesh extends Object3D{constructor(e=new BufferGeometry,t=new MeshBasicMaterial){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(0<t.length){var r=e[t[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){var i=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}getVertexPosition(r,i){var e=this.geometry,t=e.attributes.position,n=e.morphAttributes.position,a=e.morphTargetsRelative,o=(i.fromBufferAttribute(t,r),this.morphTargetInfluences);if(n&&o){_morphA.set(0,0,0);for(let e=0,t=n.length;e<t;e++){var s=o[e],l=n[e];0!==s&&(_tempA.fromBufferAttribute(l,r),a?_morphA.addScaledVector(_tempA,s):_morphA.addScaledVector(_tempA.sub(i),s))}i.add(_morphA)}return i}raycast(e,t){var r=this.geometry,i=this.material,n=this.matrixWorld;if(void 0!==i){if(null===r.boundingSphere&&r.computeBoundingSphere(),_sphere$5.copy(r.boundingSphere),_sphere$5.applyMatrix4(n),_ray$3.copy(e.ray).recast(e.near),!1===_sphere$5.containsPoint(_ray$3.origin)){if(null===_ray$3.intersectSphere(_sphere$5,_sphereHitAt))return;if(_ray$3.origin.distanceToSquared(_sphereHitAt)>(e.far-e.near)**2)return}_inverseMatrix$3.copy(n).invert(),_ray$3.copy(e.ray).applyMatrix4(_inverseMatrix$3),null!==r.boundingBox&&!1===_ray$3.intersectsBox(r.boundingBox)||this._computeIntersections(e,t,_ray$3)}}_computeIntersections(r,i,n){let a;var e=this.geometry,o=this.material,s=e.index,l=e.attributes.position,c=e.attributes.uv,d=e.attributes.uv1,h=e.attributes.normal,u=e.groups,A=e.drawRange;if(null!==s)if(Array.isArray(o))for(let e=0,t=u.length;e<t;e++){var p=u[e],m=o[p.materialIndex];for(let e=Math.max(p.start,A.start),t=Math.min(s.count,Math.min(p.start+p.count,A.start+A.count));e<t;e+=3){var f=s.getX(e),g=s.getX(e+1),v=s.getX(e+2);(a=checkGeometryIntersection(this,m,r,n,c,d,h,f,g,v))&&(a.faceIndex=Math.floor(e/3),a.face.materialIndex=p.materialIndex,i.push(a))}}else for(let e=Math.max(0,A.start),t=Math.min(s.count,A.start+A.count);e<t;e+=3){var _=s.getX(e),y=s.getX(e+1),E=s.getX(e+2);(a=checkGeometryIntersection(this,o,r,n,c,d,h,_,y,E))&&(a.faceIndex=Math.floor(e/3),i.push(a))}else if(void 0!==l)if(Array.isArray(o))for(let e=0,t=u.length;e<t;e++){var T=u[e],x=o[T.materialIndex];for(let e=Math.max(T.start,A.start),t=Math.min(l.count,Math.min(T.start+T.count,A.start+A.count));e<t;e+=3){var b=e,w=e+1,C=e+2;(a=checkGeometryIntersection(this,x,r,n,c,d,h,b,w,C))&&(a.faceIndex=Math.floor(e/3),a.face.materialIndex=T.materialIndex,i.push(a))}}else for(let e=Math.max(0,A.start),t=Math.min(l.count,A.start+A.count);e<t;e+=3){var S=e,M=e+1,B=e+2;(a=checkGeometryIntersection(this,o,r,n,c,d,h,S,M,B))&&(a.faceIndex=Math.floor(e/3),i.push(a))}}}function checkIntersection(e,t,r,i,n,a,o,s){let l;if(null===(l=t.side===BackSide?i.intersectTriangle(o,a,n,!0,s):i.intersectTriangle(n,a,o,t.side===FrontSide,s)))return null;_intersectionPointWorld.copy(s),_intersectionPointWorld.applyMatrix4(e.matrixWorld);i=r.ray.origin.distanceTo(_intersectionPointWorld);return i<r.near||i>r.far?null:{distance:i,point:_intersectionPointWorld.clone(),object:e}}function checkGeometryIntersection(e,t,r,i,n,a,o,s,l,c){e.getVertexPosition(s,_vA$1),e.getVertexPosition(l,_vB$1),e.getVertexPosition(c,_vC$1);e=checkIntersection(e,t,r,i,_vA$1,_vB$1,_vC$1,_intersectionPoint);return e&&(n&&(_uvA$1.fromBufferAttribute(n,s),_uvB$1.fromBufferAttribute(n,l),_uvC$1.fromBufferAttribute(n,c),e.uv=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2)),a&&(_uvA$1.fromBufferAttribute(a,s),_uvB$1.fromBufferAttribute(a,l),_uvC$1.fromBufferAttribute(a,c),e.uv1=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2),e.uv2=e.uv1),o&&(_normalA.fromBufferAttribute(o,s),_normalB.fromBufferAttribute(o,l),_normalC.fromBufferAttribute(o,c),e.normal=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_normalA,_normalB,_normalC,new Vector3),0<e.normal.dot(i.direction))&&e.normal.multiplyScalar(-1),t={a:s,b:l,c:c,normal:new Vector3,materialIndex:0},Triangle.getNormal(_vA$1,_vB$1,_vC$1,t.normal),e.face=t),e}class BoxGeometry extends BufferGeometry{constructor(e=1,t=1,r=1,i=1,n=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:n,depthSegments:a};const S=this,M=(i=Math.floor(i),n=Math.floor(n),a=Math.floor(a),[]),B=[],N=[],R=[];let L=0,U=0;function o(r,i,n,a,o,e,t,s,l,c,d){var h=e/l,u=t/c,A=e/2,p=t/2,m=s/2,f=l+1,g=c+1;let v=0,_=0;var y=new Vector3;for(let t=0;t<g;t++){var E=t*u-p;for(let e=0;e<f;e++){var T=e*h-A;y[r]=T*a,y[i]=E*o,y[n]=m,B.push(y.x,y.y,y.z),y[r]=0,y[i]=0,y[n]=0<s?1:-1,N.push(y.x,y.y,y.z),R.push(e/l),R.push(1-t/c),v+=1}}for(let t=0;t<c;t++)for(let e=0;e<l;e++){var x=L+e+f*t,b=L+e+f*(t+1),w=L+(e+1)+f*(t+1),C=L+(e+1)+f*t;M.push(x,b,C),M.push(b,w,C),_+=6}S.addGroup(U,_,d),U+=_,L+=v}o("z","y","x",-1,-1,r,t,e,a,n,0),o("z","y","x",1,-1,r,t,-e,a,n,1),o("x","z","y",1,1,e,r,t,i,a,2),o("x","z","y",1,-1,e,r,-t,i,a,3),o("x","y","z",1,-1,e,t,r,i,n,4),o("x","y","z",-1,-1,e,t,-r,i,n,5),this.setIndex(M),this.setAttribute("position",new Float32BufferAttribute(B,3)),this.setAttribute("normal",new Float32BufferAttribute(N,3)),this.setAttribute("uv",new Float32BufferAttribute(R,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new BoxGeometry(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function cloneUniforms(e){var t={};for(const i in e){t[i]={};for(const n in e[i]){var r=e[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[i][n]=null):t[i][n]=r.clone():Array.isArray(r)?t[i][n]=r.slice():t[i][n]=r}}return t}function mergeUniforms(t){var r={};for(let e=0;e<t.length;e++){var i=cloneUniforms(t[e]);for(const n in i)r[n]=i[n]}return r}function cloneUniformsGroups(t){var r=[];for(let e=0;e<t.length;e++)r.push(t[e].clone());return r}function getUnlitUniformColorSpace(e){return null===e.getRenderTarget()?e.outputColorSpace:LinearSRGBColorSpace}const UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};var default_vertex="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",default_fragment="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";class ShaderMaterial extends Material{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=cloneUniforms(e.uniforms),this.uniformsGroups=cloneUniformsGroups(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){var t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){var r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}0<Object.keys(this.defines).length&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;var i={};for(const a in this.extensions)!0===this.extensions[a]&&(i[a]=!0);return 0<Object.keys(i).length&&(t.extensions=i),t}}class Camera extends Object3D{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4,this.coordinateSystem=WebGLCoordinateSystem}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class PerspectiveCamera extends Camera{constructor(e=50,t=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){e=.5*this.getFilmHeight()/e;this.fov=2*RAD2DEG*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){var e=Math.tan(.5*DEG2RAD*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*RAD2DEG*Math.atan(Math.tan(.5*DEG2RAD*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,r,i,n,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){var e=this.near;let t=e*Math.tan(.5*DEG2RAD*this.fov)/this.zoom,r=2*t,i=this.aspect*r,n=-.5*i;var a,o=this.view,s=(null!==this.view&&this.view.enabled&&(s=o.fullWidth,a=o.fullHeight,n+=o.offsetX*i/s,t-=o.offsetY*r/a,i*=o.width/s,r*=o.height/a),this.filmOffset);0!==s&&(n+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+i,t,t-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){e=super.toJSON(e);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const fov=-90,aspect=1;class CubeCamera extends Object3D{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null;r=new PerspectiveCamera(fov,aspect,e,t),r.layers=this.layers,this.add(r),r=new PerspectiveCamera(fov,aspect,e,t),r.layers=this.layers,this.add(r),r=new PerspectiveCamera(fov,aspect,e,t),r.layers=this.layers,this.add(r),r=new PerspectiveCamera(fov,aspect,e,t),r.layers=this.layers,this.add(r),r=new PerspectiveCamera(fov,aspect,e,t),r.layers=this.layers,this.add(r),r=new PerspectiveCamera(fov,aspect,e,t);r.layers=this.layers,this.add(r)}updateCoordinateSystem(){var e=this.coordinateSystem,t=this.children.concat(),[r,i,n,a,o,s]=t;for(const l of t)this.remove(l);if(e===WebGLCoordinateSystem)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),n.up.set(0,0,-1),n.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),s.up.set(0,1,0);else{if(e!==WebGPUCoordinateSystem)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),n.up.set(0,0,1),n.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),s.up.set(0,-1,0)}s.lookAt(0,0,-1);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();var r=this.renderTarget,[i,n,a,o,s,l]=(this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem()),this.children),c=e.getRenderTarget(),d=e.xr.enabled,h=(e.xr.enabled=!1,r.texture.generateMipmaps);r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(t,i),e.setRenderTarget(r,1),e.render(t,n),e.setRenderTarget(r,2),e.render(t,a),e.setRenderTarget(r,3),e.render(t,o),e.setRenderTarget(r,4),e.render(t,s),r.texture.generateMipmaps=h,e.setRenderTarget(r,5),e.render(t,l),e.setRenderTarget(c),e.xr.enabled=d,r.texture.needsPMREMUpdate=!0}}class CubeTexture extends Texture{constructor(e,t,r,i,n,a,o,s,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:CubeReflectionMapping,r,i,n,a,o,s,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;e={width:e,height:e,depth:1},e=[e,e,e,e,e,e];void 0!==t.encoding&&(warnOnce("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===sRGBEncoding?SRGBColorSpace:NoColorSpace),this.texture=new CubeTexture(e,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:LinearFilter}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new BoxGeometry(5,5,5),r=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:BackSide,blending:NoBlending}),i=(r.uniforms.tEquirect.value=t,new Mesh(i,r)),r=t.minFilter;return t.minFilter===LinearMipmapLinearFilter&&(t.minFilter=LinearFilter),new CubeCamera(1,10,this).update(e,i),t.minFilter=r,i.geometry.dispose(),i.material.dispose(),this}clear(t,r,i,n){var e=t.getRenderTarget();for(let e=0;e<6;e++)t.setRenderTarget(this,e),t.clear(r,i,n);t.setRenderTarget(e)}}const _vector1=new Vector3,_vector2=new Vector3,_normalMatrix=new Matrix3;class Plane{constructor(e=new Vector3(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){r=_vector1.subVectors(r,t).cross(_vector2.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){var r=e.delta(_vector1),i=this.normal.dot(r);return 0===i?0===this.distanceToPoint(e.start)?t.copy(e.start):null:(i=-(e.start.dot(this.normal)+this.constant)/i)<0||1<i?null:t.copy(e.start).addScaledVector(r,i)}intersectsLine(e){var t=this.distanceToPoint(e.start),e=this.distanceToPoint(e.end);return t<0&&0<e||e<0&&0<t}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){t=t||_normalMatrix.getNormalMatrix(e),e=this.coplanarPoint(_vector1).applyMatrix4(e),t=this.normal.applyMatrix3(t).normalize();return this.constant=-e.dot(t),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const _sphere$4=new Sphere,_vector$6=new Vector3;class Frustum{constructor(e=new Plane,t=new Plane,r=new Plane,i=new Plane,n=new Plane,a=new Plane){this.planes=[e,t,r,i,n,a]}set(e,t,r,i,n,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(r),o[3].copy(i),o[4].copy(n),o[5].copy(a),this}copy(t){var r=this.planes;for(let e=0;e<6;e++)r[e].copy(t.planes[e]);return this}setFromProjectionMatrix(e,t=WebGLCoordinateSystem){var r=this.planes,e=e.elements,i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],l=e[5],c=e[6],d=e[7],h=e[8],u=e[9],A=e[10],p=e[11],m=e[12],f=e[13],g=e[14],e=e[15];if(r[0].setComponents(o-i,d-s,p-h,e-m).normalize(),r[1].setComponents(o+i,d+s,p+h,e+m).normalize(),r[2].setComponents(o+n,d+l,p+u,e+f).normalize(),r[3].setComponents(o-n,d-l,p-u,e-f).normalize(),r[4].setComponents(o-a,d-c,p-A,e-g).normalize(),t===WebGLCoordinateSystem)r[5].setComponents(o+a,d+c,p+A,e+g).normalize();else{if(t!==WebGPUCoordinateSystem)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);r[5].setComponents(a,c,A,g).normalize()}return this}intersectsObject(e){var t;return(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),_sphere$4.copy(e.boundingSphere)):(null===(t=e.geometry).boundingSphere&&t.computeBoundingSphere(),_sphere$4.copy(t.boundingSphere))).applyMatrix4(e.matrixWorld),this.intersectsSphere(_sphere$4)}intersectsSprite(e){return _sphere$4.center.set(0,0,0),_sphere$4.radius=.7071067811865476,_sphere$4.applyMatrix4(e.matrixWorld),this.intersectsSphere(_sphere$4)}intersectsSphere(e){var t=this.planes,r=e.center,i=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(r)<i)return!1;return!0}intersectsBox(t){var r=this.planes;for(let e=0;e<6;e++){var i=r[e];if(_vector$6.x=(0<i.normal.x?t.max:t.min).x,_vector$6.y=(0<i.normal.y?t.max:t.min).y,_vector$6.z=(0<i.normal.z?t.max:t.min).z,i.distanceToPoint(_vector$6)<0)return!1}return!0}containsPoint(t){var r=this.planes;for(let e=0;e<6;e++)if(r[e].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function WebGLAnimation(){let r=null,e=!1,i=null,n=null;function a(e,t){i(e,t),n=r.requestAnimationFrame(a)}return{start:function(){!0!==e&&null!==i&&(n=r.requestAnimationFrame(a),e=!0)},stop:function(){r.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(e){i=e},setContext:function(e){r=e}}}function WebGLAttributes(s,e){const l=e.isWebGL2,c=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),c.get(e)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);var t=c.get(e);t&&(s.deleteBuffer(t.buffer),c.delete(e))},update:function(e,t){var r,i,n,a,o;e.isGLBufferAttribute?(!(r=c.get(e))||r.version<e.version)&&c.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}):(e.isInterleavedBufferAttribute&&(e=e.data),void 0===(r=c.get(e))?c.set(e,function(e,t){var r=e.array,i=e.usage,n=s.createBuffer();s.bindBuffer(t,n),s.bufferData(t,r,i),e.onUploadCallback();let a;if(r instanceof Float32Array)a=s.FLOAT;else if(r instanceof Uint16Array)if(e.isFloat16BufferAttribute){if(!l)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");a=s.HALF_FLOAT}else a=s.UNSIGNED_SHORT;else if(r instanceof Int16Array)a=s.SHORT;else if(r instanceof Uint32Array)a=s.UNSIGNED_INT;else if(r instanceof Int32Array)a=s.INT;else if(r instanceof Int8Array)a=s.BYTE;else{if(!(r instanceof Uint8Array||r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);a=s.UNSIGNED_BYTE}return{buffer:n,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,t)):r.version<e.version&&(i=r.buffer,t=t,a=(n=e).array,o=n.updateRange,s.bindBuffer(t,i),-1===o.count?s.bufferSubData(t,0,a):(l?s.bufferSubData(t,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):s.bufferSubData(t,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1),n.onUploadCallback(),r.version=e.version))}}}class PlaneGeometry extends BufferGeometry{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};var n=e/2,a=t/2,o=Math.floor(r),s=Math.floor(i),l=o+1,c=s+1,d=e/o,h=t/s,u=[],A=[],p=[],m=[];for(let t=0;t<c;t++){var f=t*h-a;for(let e=0;e<l;e++){var g=e*d-n;A.push(g,-f,0),p.push(0,0,1),m.push(e/o),m.push(1-t/s)}}for(let t=0;t<s;t++)for(let e=0;e<o;e++){var v=e+l*t,_=e+l*(t+1),y=e+1+l*(t+1),E=e+1+l*t;u.push(v,_,E),u.push(_,y,E)}this.setIndex(u),this.setAttribute("position",new Float32BufferAttribute(A,3)),this.setAttribute("normal",new Float32BufferAttribute(p,3)),this.setAttribute("uv",new Float32BufferAttribute(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new PlaneGeometry(e.width,e.height,e.widthSegments,e.heightSegments)}}var alphahash_fragment="#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment="#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment="#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment="#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex="vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex="vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs="float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment="#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment="#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex="#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment="#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment="#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex="#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex="#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common="#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment="#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex="vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment="vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment="#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment="#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_vertex="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex="#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex="#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment="#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment="#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment="#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment="LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment="varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin="uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",envmap_physical_pars_fragment="#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",lights_toon_fragment="ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment="varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment="varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tanisotropyV /= material.anisotropy;\n\tmaterial.anisotropy = saturate( material.anisotropy );\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment="struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps="#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometry.viewDir, geometry.normal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end="#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment="#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, vMapUv );\n#endif",map_pars_fragment="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment="#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex="#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin="float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps="#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment="#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex="#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex="#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin="#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps="#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment="#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment="#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment="#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex="vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment="#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment="#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment="#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex="#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex="#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment="#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment="#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment="#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment="#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment="#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex="#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex="#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex="#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif";const vertex$h="varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",fragment$h="uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",vertex$g="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",fragment$g="#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",vertex$f="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",fragment$f="uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",vertex$e="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",fragment$e="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",vertex$d="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",fragment$d="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",vertex$c="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",fragment$c="uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",vertex$b="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",fragment$b="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",vertex$a="#include <common>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",fragment$a="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vertex$9="#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",fragment$9="#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vertex$8="#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",fragment$8="#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vertex$7="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",fragment$7="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",vertex$6="#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",fragment$6="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vertex$5="#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",fragment$5="#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vertex$4="#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",fragment$4="#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",vertex$3="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",fragment$3="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",vertex$2="#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",fragment$2="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",vertex$1="uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",fragment$1="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",ShaderChunk={alphahash_fragment:alphahash_fragment,alphahash_pars_fragment:alphahash_pars_fragment,alphamap_fragment:alphamap_fragment,alphamap_pars_fragment:alphamap_pars_fragment,alphatest_fragment:alphatest_fragment,alphatest_pars_fragment:alphatest_pars_fragment,aomap_fragment:aomap_fragment,aomap_pars_fragment:aomap_pars_fragment,begin_vertex:begin_vertex,beginnormal_vertex:beginnormal_vertex,bsdfs:bsdfs,iridescence_fragment:iridescence_fragment,bumpmap_pars_fragment:bumpmap_pars_fragment,clipping_planes_fragment:clipping_planes_fragment,clipping_planes_pars_fragment:clipping_planes_pars_fragment,clipping_planes_pars_vertex:clipping_planes_pars_vertex,clipping_planes_vertex:clipping_planes_vertex,color_fragment:color_fragment,color_pars_fragment:color_pars_fragment,color_pars_vertex:color_pars_vertex,color_vertex:color_vertex,common:common,cube_uv_reflection_fragment:cube_uv_reflection_fragment,defaultnormal_vertex:defaultnormal_vertex,displacementmap_pars_vertex:displacementmap_pars_vertex,displacementmap_vertex:displacementmap_vertex,emissivemap_fragment:emissivemap_fragment,emissivemap_pars_fragment:emissivemap_pars_fragment,colorspace_fragment:colorspace_fragment,colorspace_pars_fragment:colorspace_pars_fragment,envmap_fragment:envmap_fragment,envmap_common_pars_fragment:envmap_common_pars_fragment,envmap_pars_fragment:envmap_pars_fragment,envmap_pars_vertex:envmap_pars_vertex,envmap_physical_pars_fragment:envmap_physical_pars_fragment,envmap_vertex:envmap_vertex,fog_vertex:fog_vertex,fog_pars_vertex:fog_pars_vertex,fog_fragment:fog_fragment,fog_pars_fragment:fog_pars_fragment,gradientmap_pars_fragment:gradientmap_pars_fragment,lightmap_fragment:lightmap_fragment,lightmap_pars_fragment:lightmap_pars_fragment,lights_lambert_fragment:lights_lambert_fragment,lights_lambert_pars_fragment:lights_lambert_pars_fragment,lights_pars_begin:lights_pars_begin,lights_toon_fragment:lights_toon_fragment,lights_toon_pars_fragment:lights_toon_pars_fragment,lights_phong_fragment:lights_phong_fragment,lights_phong_pars_fragment:lights_phong_pars_fragment,lights_physical_fragment:lights_physical_fragment,lights_physical_pars_fragment:lights_physical_pars_fragment,lights_fragment_begin:lights_fragment_begin,lights_fragment_maps:lights_fragment_maps,lights_fragment_end:lights_fragment_end,logdepthbuf_fragment:logdepthbuf_fragment,logdepthbuf_pars_fragment:logdepthbuf_pars_fragment,logdepthbuf_pars_vertex:logdepthbuf_pars_vertex,logdepthbuf_vertex:logdepthbuf_vertex,map_fragment:map_fragment,map_pars_fragment:map_pars_fragment,map_particle_fragment:map_particle_fragment,map_particle_pars_fragment:map_particle_pars_fragment,metalnessmap_fragment:metalnessmap_fragment,metalnessmap_pars_fragment:metalnessmap_pars_fragment,morphcolor_vertex:morphcolor_vertex,morphnormal_vertex:morphnormal_vertex,morphtarget_pars_vertex:morphtarget_pars_vertex,morphtarget_vertex:morphtarget_vertex,normal_fragment_begin:normal_fragment_begin,normal_fragment_maps:normal_fragment_maps,normal_pars_fragment:normal_pars_fragment,normal_pars_vertex:normal_pars_vertex,normal_vertex:normal_vertex,normalmap_pars_fragment:normalmap_pars_fragment,clearcoat_normal_fragment_begin:clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps:clearcoat_normal_fragment_maps,clearcoat_pars_fragment:clearcoat_pars_fragment,iridescence_pars_fragment:iridescence_pars_fragment,opaque_fragment:opaque_fragment,packing:packing,premultiplied_alpha_fragment:premultiplied_alpha_fragment,project_vertex:project_vertex,dithering_fragment:dithering_fragment,dithering_pars_fragment:dithering_pars_fragment,roughnessmap_fragment:roughnessmap_fragment,roughnessmap_pars_fragment:roughnessmap_pars_fragment,shadowmap_pars_fragment:shadowmap_pars_fragment,shadowmap_pars_vertex:shadowmap_pars_vertex,shadowmap_vertex:shadowmap_vertex,shadowmask_pars_fragment:shadowmask_pars_fragment,skinbase_vertex:skinbase_vertex,skinning_pars_vertex:skinning_pars_vertex,skinning_vertex:skinning_vertex,skinnormal_vertex:skinnormal_vertex,specularmap_fragment:specularmap_fragment,specularmap_pars_fragment:specularmap_pars_fragment,tonemapping_fragment:tonemapping_fragment,tonemapping_pars_fragment:tonemapping_pars_fragment,transmission_fragment:transmission_fragment,transmission_pars_fragment:transmission_pars_fragment,uv_pars_fragment:uv_pars_fragment,uv_pars_vertex:uv_pars_vertex,uv_vertex:uv_vertex,worldpos_vertex:worldpos_vertex,background_vert:vertex$h,background_frag:fragment$h,backgroundCube_vert:vertex$g,backgroundCube_frag:fragment$g,cube_vert:vertex$f,cube_frag:fragment$f,depth_vert:vertex$e,depth_frag:fragment$e,distanceRGBA_vert:vertex$d,distanceRGBA_frag:fragment$d,equirect_vert:vertex$c,equirect_frag:fragment$c,linedashed_vert:vertex$b,linedashed_frag:fragment$b,meshbasic_vert:vertex$a,meshbasic_frag:fragment$a,meshlambert_vert:vertex$9,meshlambert_frag:fragment$9,meshmatcap_vert:vertex$8,meshmatcap_frag:fragment$8,meshnormal_vert:vertex$7,meshnormal_frag:fragment$7,meshphong_vert:vertex$6,meshphong_frag:fragment$6,meshphysical_vert:vertex$5,meshphysical_frag:fragment$5,meshtoon_vert:vertex$4,meshtoon_frag:fragment$4,points_vert:vertex$3,points_frag:fragment$3,shadow_vert:vertex$2,shadow_frag:fragment$2,sprite_vert:vertex$1,sprite_frag:fragment$1},UniformsLib={common:{diffuse:{value:new Color(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Matrix3}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Matrix3}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Matrix3}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Matrix3},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Matrix3},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Matrix3},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Matrix3}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Matrix3}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Matrix3}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(16777215)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.meshnormal_vert,fragmentShader:ShaderChunk.meshnormal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.backgroundCube_vert,fragmentShader:ShaderChunk.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}},_rgb=(ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Matrix3},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Matrix3},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Matrix3},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Matrix3},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Matrix3},sheen:{value:0},sheenColor:{value:new Color(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Matrix3},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Matrix3},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Matrix3},transmissionSamplerSize:{value:new Vector2},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Matrix3},attenuationDistance:{value:0},attenuationColor:{value:new Color(0)},specularColor:{value:new Color(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Matrix3},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Matrix3},anisotropyVector:{value:new Vector2},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Matrix3}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},{r:0,b:0,g:0});function WebGLBackground(a,o,s,l,c,e,d){const h=new Color(0);let u=!0===e?0:1,A,p,m=null,f=0,g=null;function v(e,t){e.getRGB(_rgb,getUnlitUniformColorSpace(a)),l.buffers.color.setClear(_rgb.r,_rgb.g,_rgb.b,t,d)}return{getClearColor:function(){return h},setClearColor:function(e,t=1){h.set(e),u=t,v(h,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,v(h,u)},render:function(e,t){let r=!1,i=!0===t.isScene?t.background:null;var n;switch(i&&i.isTexture&&(n=0<t.backgroundBlurriness,i=(n?s:o).get(i)),null===i?v(h,u):i&&i.isColor&&(v(i,1),r=!0),a.xr.getEnvironmentBlendMode()){case"opaque":r=!0;break;case"additive":l.buffers.color.setClear(0,0,0,1,d),r=!0;break;case"alpha-blend":l.buffers.color.setClear(0,0,0,0,d),r=!0}(a.autoClear||r)&&a.clear(a.autoClearColor,a.autoClearDepth,a.autoClearStencil),i&&(i.isCubeTexture||i.mapping===CubeUVReflectionMapping)?(void 0===p&&((p=new Mesh(new BoxGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.backgroundCube.uniforms),vertexShader:ShaderLib.backgroundCube.vertexShader,fragmentShader:ShaderLib.backgroundCube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),p.geometry.deleteAttribute("uv"),p.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(p.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),c.update(p)),p.material.uniforms.envMap.value=i,p.material.uniforms.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,p.material.uniforms.backgroundBlurriness.value=t.backgroundBlurriness,p.material.uniforms.backgroundIntensity.value=t.backgroundIntensity,p.material.toneMapped=i.colorSpace!==SRGBColorSpace,m===i&&f===i.version&&g===a.toneMapping||(p.material.needsUpdate=!0,m=i,f=i.version,g=a.toneMapping),p.layers.enableAll(),e.unshift(p,p.geometry,p.material,0,0,null)):i&&i.isTexture&&(void 0===A&&((A=new Mesh(new PlaneGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(A.material,"map",{get:function(){return this.uniforms.t2D.value}}),c.update(A)),A.material.uniforms.t2D.value=i,A.material.uniforms.backgroundIntensity.value=t.backgroundIntensity,A.material.toneMapped=i.colorSpace!==SRGBColorSpace,!0===i.matrixAutoUpdate&&i.updateMatrix(),A.material.uniforms.uvTransform.value.copy(i.matrix),m===i&&f===i.version&&g===a.toneMapping||(A.material.needsUpdate=!0,m=i,f=i.version,g=a.toneMapping),A.layers.enableAll(),e.unshift(A,A.geometry,A.material,0,0,null))}}}function WebGLBindingStates(y,E,T,x){const n=y.getParameter(y.MAX_VERTEX_ATTRIBS),p=x.isWebGL2?null:E.get("OES_vertex_array_object"),m=x.isWebGL2||null!==p,f={},e=b(null);let g=e,v=!1;function _(e){if(x.isWebGL2)return y.bindVertexArray(e);p.bindVertexArrayOES(e)}function a(e){if(x.isWebGL2)return y.deleteVertexArray(e);p.deleteVertexArrayOES(e)}function b(e){var t=[],r=[],i=[];for(let e=0;e<n;e++)t[e]=0,r[e]=0,i[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:r,attributeDivisors:i,object:e,attributes:{},index:null}}function w(){var r=g.newAttributes;for(let e=0,t=r.length;e<t;e++)r[e]=0}function C(e){S(e,0)}function S(e,t){var r=g.newAttributes,i=g.enabledAttributes,n=g.attributeDivisors;r[e]=1,0===i[e]&&(y.enableVertexAttribArray(e),i[e]=1),n[e]!==t&&((x.isWebGL2?y:E.get("ANGLE_instanced_arrays"))[x.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](e,t),n[e]=t)}function M(){var r=g.newAttributes,i=g.enabledAttributes;for(let e=0,t=i.length;e<t;e++)i[e]!==r[e]&&(y.disableVertexAttribArray(e),i[e]=0)}function B(e,t,r,i,n,a,o){!0===o?y.vertexAttribIPointer(e,t,r,n,a):y.vertexAttribPointer(e,t,r,i,n,a)}function o(){t(),v=!0,g!==e&&_((g=e).object)}function t(){e.geometry=null,e.program=null,e.wireframe=!1}return{setup:function(e,t,r,i,n){let a=!1;if(m){var o=function(e,t,r){r=!0===r.wireframe;let i=f[e.id];void 0===i&&(i={},f[e.id]=i);let n=i[t.id];void 0===n&&(n={},i[t.id]=n);let a=n[r];void 0===a&&(a=b(x.isWebGL2?y.createVertexArray():p.createVertexArrayOES()),n[r]=a);return a}(i,r,t);if(g!==o&&_((g=o).object),a=function(t,e,r,i){var n=g.attributes,a=e.attributes;let o=0;var s=r.getAttributes();for(const c in s)if(0<=s[c].location){var l=n[c];let e=a[c];if(void 0===e&&("instanceMatrix"===c&&t.instanceMatrix&&(e=t.instanceMatrix),"instanceColor"===c)&&t.instanceColor&&(e=t.instanceColor),void 0===l)return!0;if(l.attribute!==e)return!0;if(e&&l.data!==e.data)return!0;o++}return g.attributesNum!==o||g.index!==i}(e,i,r,n)){var s=e,o=r,l=n,c={},d=i.attributes;let t=0;var h=o.getAttributes();for(const A in h)if(0<=h[A].location){let e=d[A];void 0===e&&("instanceMatrix"===A&&s.instanceMatrix&&(e=s.instanceMatrix),"instanceColor"===A)&&s.instanceColor&&(e=s.instanceColor);var u={};(u.attribute=e)&&e.data&&(u.data=e.data),c[A]=u,t++}g.attributes=c,g.attributesNum=t,g.index=l}}else{o=!0===t.wireframe;g.geometry===i.id&&g.program===r.id&&g.wireframe===o||(g.geometry=i.id,g.program=r.id,g.wireframe=o,a=!0)}null!==n&&T.update(n,y.ELEMENT_ARRAY_BUFFER),(a||v)&&(v=!1,function(e,t,r,i){if(!1===x.isWebGL2&&(e.isInstancedMesh||i.isInstancedBufferGeometry)&&null===E.get("ANGLE_instanced_arrays"))return;w();var n=i.attributes,a=r.getAttributes(),o=t.defaultAttributeValues;for(const _ in a){var s=a[_];if(0<=s.location){let t=n[_];if(void 0!==(t=void 0===t&&("instanceMatrix"===_&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===_)&&e.instanceColor?e.instanceColor:t)){var l=t.normalized,c=t.itemSize,d=T.get(t);if(void 0!==d){var h=d.buffer,u=d.type,A=d.bytesPerElement,p=!0===x.isWebGL2&&(u===y.INT||u===y.UNSIGNED_INT||t.gpuType===IntType);if(t.isInterleavedBufferAttribute){var m=t.data,f=m.stride,g=t.offset;if(m.isInstancedInterleavedBuffer){for(let e=0;e<s.locationSize;e++)S(s.location+e,m.meshPerAttribute);!0!==e.isInstancedMesh&&void 0===i._maxInstanceCount&&(i._maxInstanceCount=m.meshPerAttribute*m.count)}else for(let e=0;e<s.locationSize;e++)C(s.location+e);y.bindBuffer(y.ARRAY_BUFFER,h);for(let e=0;e<s.locationSize;e++)B(s.location+e,c/s.locationSize,u,l,f*A,(g+c/s.locationSize*e)*A,p)}else{if(t.isInstancedBufferAttribute){for(let e=0;e<s.locationSize;e++)S(s.location+e,t.meshPerAttribute);!0!==e.isInstancedMesh&&void 0===i._maxInstanceCount&&(i._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<s.locationSize;e++)C(s.location+e);y.bindBuffer(y.ARRAY_BUFFER,h);for(let e=0;e<s.locationSize;e++)B(s.location+e,c/s.locationSize,u,l,c*A,c/s.locationSize*e*A,p)}}}else if(void 0!==o){var v=o[_];if(void 0!==v)switch(v.length){case 2:y.vertexAttrib2fv(s.location,v);break;case 3:y.vertexAttrib3fv(s.location,v);break;case 4:y.vertexAttrib4fv(s.location,v);break;default:y.vertexAttrib1fv(s.location,v)}}}}M()}(e,t,r,i),null!==n)&&y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,T.get(n).buffer)},reset:o,resetDefaultState:t,dispose:function(){o();for(const r in f){var e=f[r];for(const i in e){var t=e[i];for(const n in t)a(t[n].object),delete t[n];delete e[i]}delete f[r]}},releaseStatesOfGeometry:function(e){if(void 0!==f[e.id]){var t=f[e.id];for(const i in t){var r=t[i];for(const n in r)a(r[n].object),delete r[n];delete t[i]}delete f[e.id]}},releaseStatesOfProgram:function(e){for(const i in f){var t=f[i];if(void 0!==t[e.id]){var r=t[e.id];for(const n in r)a(r[n].object),delete r[n];delete t[e.id]}}},initAttributes:w,enableAttribute:C,disableUnusedAttributes:M}}function WebGLBufferRenderer(a,o,s,e){const l=e.isWebGL2;let c;this.setMode=function(e){c=e},this.render=function(e,t){a.drawArrays(c,e,t),s.update(t,c,1)},this.renderInstances=function(r,i,n){if(0!==n){let e,t;if(l)e=a,t="drawArraysInstanced";else if(e=o.get("ANGLE_instanced_arrays"),t="drawArraysInstancedANGLE",null===e)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");e[t](c,r,i,n),s.update(i,c,n)}}}function WebGLCapabilities(t,r,e){let i;function n(e){if("highp"===e){if(0<t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision&&0<t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision)return"highp";e="mediump"}return"mediump"===e&&0<t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision&&0<t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision?"mediump":"lowp"}var a="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===t.constructor.name;let o=void 0!==e.precision?e.precision:"highp";var s=n(o),s=(s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s),a||r.has("WEBGL_draw_buffers")),e=!0===e.logarithmicDepthBuffer,l=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),c=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=t.getParameter(t.MAX_TEXTURE_SIZE),h=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),u=t.getParameter(t.MAX_VERTEX_ATTRIBS),A=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),p=t.getParameter(t.MAX_VARYING_VECTORS),m=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),f=0<c,g=a||r.has("OES_texture_float"),v=f&&g,_=a?t.getParameter(t.MAX_SAMPLES):0;return{isWebGL2:a,drawBuffers:s,getMaxAnisotropy:function(){var e;return i=void 0===i?!0===r.has("EXT_texture_filter_anisotropic")?(e=r.get("EXT_texture_filter_anisotropic"),t.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT)):0:i},getMaxPrecision:n,precision:o,logarithmicDepthBuffer:e,maxTextures:l,maxVertexTextures:c,maxTextureSize:d,maxCubemapSize:h,maxAttributes:u,maxVertexUniforms:A,maxVaryings:p,maxFragmentUniforms:m,vertexTextures:f,floatFragmentTextures:g,floatVertexTextures:v,maxSamples:_}}function WebGLClipping(l){const c=this;let d=null,h=0,u=!1,A=!1;const s=new Plane,p=new Matrix3,m={value:null,needsUpdate:!1};function f(r,e,i,t){var n=null!==r?r.length:0;let a=null;if(0!==n){if(a=m.value,!0!==t||null===a){var t=i+4*n,o=e.matrixWorldInverse;p.getNormalMatrix(o),(null===a||a.length<t)&&(a=new Float32Array(t));for(let e=0,t=i;e!==n;++e,t+=4)s.copy(r[e]).applyMatrix4(o,p),s.normal.toArray(a,t),a[t+3]=s.constant}m.value=a,m.needsUpdate=!0}return c.numPlanes=n,c.numIntersection=0,a}this.uniform=m,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){var r=0!==e.length||t||0!==h||u;return u=t,h=e.length,r},this.beginShadows=function(){A=!0,f(null)},this.endShadows=function(){A=!1},this.setGlobalState=function(e,t){d=f(e,t,0)},this.setState=function(e,t,r){var i=e.clippingPlanes,n=e.clipIntersection,a=e.clipShadows,e=l.get(e);if(!u||null===i||0===i.length||A&&!a)A?f(null):(m.value!==d&&(m.value=d,m.needsUpdate=0<h),c.numPlanes=h,c.numIntersection=0);else{var a=A?0:h,o=4*a,s=e.clippingState||null;m.value=s,s=f(i,t,o,r);for(let e=0;e!==o;++e)s[e]=d[e];e.clippingState=s,this.numIntersection=n?this.numPlanes:0,this.numPlanes+=a}}}function WebGLCubeMaps(r){let i=new WeakMap;function n(e,t){return t===EquirectangularReflectionMapping?e.mapping=CubeReflectionMapping:t===EquirectangularRefractionMapping&&(e.mapping=CubeRefractionMapping),e}function a(e){var e=e.target,t=(e.removeEventListener("dispose",a),i.get(e));void 0!==t&&(i.delete(e),t.dispose())}return{get:function(e){if(e&&e.isTexture&&!1===e.isRenderTargetTexture){var t=e.mapping;if(t===EquirectangularReflectionMapping||t===EquirectangularRefractionMapping)return i.has(e)?n(i.get(e).texture,e.mapping):(t=e.image)&&0<t.height?((t=new WebGLCubeRenderTarget(t.height/2)).fromEquirectangularTexture(r,e),i.set(e,t),e.addEventListener("dispose",a),n(t.texture,e.mapping)):null}return e},dispose:function(){i=new WeakMap}}}class OrthographicCamera extends Camera{constructor(e=-1,t=1,r=1,i=-1,n=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=n,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,n,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let n=r-e,a=r+e,o=i+t,s=i-t;null!==this.view&&this.view.enabled&&(r=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom,n+=r*this.view.offsetX,a=n+r*this.view.width,o-=e*this.view.offsetY,s=o-e*this.view.height),this.projectionMatrix.makeOrthographic(n,a,o,s,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){e=super.toJSON(e);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}const LOD_MIN=4,EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582],MAX_SAMPLES=20,_flatCamera=new OrthographicCamera,_clearColor=new Color;let _oldTarget=null;const PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI,_axisDirections=[new Vector3(1,1,1),new Vector3(-1,1,1),new Vector3(1,1,-1),new Vector3(-1,1,-1),new Vector3(0,PHI,INV_PHI),new Vector3(0,PHI,-INV_PHI),new Vector3(INV_PHI,0,PHI),new Vector3(-INV_PHI,0,PHI),new Vector3(PHI,INV_PHI,0),new Vector3(-PHI,INV_PHI,0)];class PMREMGenerator{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,i=100){_oldTarget=this._renderer.getRenderTarget(),this._setSize(256);var n=this._allocateTargets();return n.depthBuffer=!0,this._sceneToCubeUV(e,r,i,n),0<t&&this._blur(n,0,0,t),this._applyPMREM(n),this._cleanup(n),n}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=_getCubemapMaterial(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=_getEquirectMaterial(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(_oldTarget),e.scissorTest=!1,_setViewport(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===CubeReflectionMapping||e.mapping===CubeRefractionMapping?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),_oldTarget=this._renderer.getRenderTarget();t=t||this._allocateTargets();return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(){var e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:LinearFilter,minFilter:LinearFilter,generateMipmaps:!1,type:HalfFloatType,format:RGBAFormat,colorSpace:LinearSRGBColorSpace,depthBuffer:!1},i=_createRenderTarget(e,t,r);return null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.width===e&&this._pingPongRenderTarget.height===t||(null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=_createRenderTarget(e,t,r),r=this["_lodMax"],{sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=_createPlanes(r),this._blurMaterial=_getBlurShader(r,e,t)),i}_compileMaterial(e){e=new Mesh(this._lodPlanes[0],e);this._renderer.compile(e,_flatCamera)}_sceneToCubeUV(t,e,r,i){var n=new PerspectiveCamera(90,1,e,r),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,e=s.autoClear,r=s.toneMapping,l=(s.getClearColor(_clearColor),s.toneMapping=NoToneMapping,s.autoClear=!1,new MeshBasicMaterial({name:"PMREM.Background",side:BackSide,depthWrite:!1,depthTest:!1})),c=new Mesh(new BoxGeometry,l);let d=!1;var h=t.background;h?h.isColor&&(l.color.copy(h),t.background=null,d=!0):(l.color.copy(_clearColor),d=!0);for(let e=0;e<6;e++){var u=e%3,A=(0==u?(n.up.set(0,a[e],0),n.lookAt(o[e],0,0)):1==u?(n.up.set(0,0,a[e]),n.lookAt(0,o[e],0)):(n.up.set(0,a[e],0),n.lookAt(0,0,o[e])),this._cubeSize);_setViewport(i,u*A,2<e?A:0,A,A),s.setRenderTarget(i),d&&s.render(c,n),s.render(t,n)}c.geometry.dispose(),c.material.dispose(),s.toneMapping=r,s.autoClear=e,t.background=h}_textureToCubeUV(e,t){var r=this._renderer,i=e.mapping===CubeReflectionMapping||e.mapping===CubeRefractionMapping,i=(i?(null===this._cubemapMaterial&&(this._cubemapMaterial=_getCubemapMaterial()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=_getEquirectMaterial()),i?this._cubemapMaterial:this._equirectMaterial),n=new Mesh(this._lodPlanes[0],i),i=(i.uniforms.envMap.value=e,this._cubeSize);_setViewport(t,0,0,3*i,2*i),r.setRenderTarget(t),r.render(n,_flatCamera)}_applyPMREM(t){var e=this._renderer,r=e.autoClear;e.autoClear=!1;for(let e=1;e<this._lodPlanes.length;e++){var i=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),n=_axisDirections[(e-1)%_axisDirections.length];this._blur(t,e-1,e,i,n)}e.autoClear=r}_blur(e,t,r,i,n){var a=this._pingPongRenderTarget;this._halfBlur(e,a,t,r,i,"latitudinal",n),this._halfBlur(a,e,r,r,i,"longitudinal",n)}_halfBlur(e,t,r,i,n,a,o){var s=this._renderer,l=this._blurMaterial,c=("latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!"),new Mesh(this._lodPlanes[i],l)),l=l.uniforms,d=this._sizeLods[r]-1,d=isFinite(n)?Math.PI/(2*d):2*Math.PI/(2*MAX_SAMPLES-1),h=n/d,u=isFinite(n)?1+Math.floor(3*h):MAX_SAMPLES,A=(u>MAX_SAMPLES&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${u} samples when the maximum is set to `+MAX_SAMPLES),[]);let p=0;for(let e=0;e<MAX_SAMPLES;++e){const f=e/h;var m=Math.exp(-f*f/2);A.push(m),0===e?p+=m:e<u&&(p+=2*m)}for(let e=0;e<A.length;e++)A[e]=A[e]/p;l.envMap.value=e.texture,l.samples.value=u,l.weights.value=A,l.latitudinal.value="latitudinal"===a,o&&(l.poleAxis.value=o);n=this._lodMax,l.dTheta.value=d,l.mipInt.value=n-r,e=this._sizeLods[i];const f=3*e*(i>n-LOD_MIN?i-n+LOD_MIN:0);a=4*(this._cubeSize-e);_setViewport(t,f,a,3*e,2*e),s.setRenderTarget(t),s.render(c,_flatCamera)}}function _createPlanes(r){var i=[],n=[],a=[];let o=r;var e=r-LOD_MIN+1+EXTRA_LOD_SIGMA.length;for(let t=0;t<e;t++){var s=Math.pow(2,o);n.push(s);let e=1/s;t>r-LOD_MIN?e=EXTRA_LOD_SIGMA[t-r+LOD_MIN-1]:0===t&&(e=0),a.push(e);var s=1/(s-2),l=-s,s=1+s,c=[l,l,s,l,s,s,l,l,s,s,l,s],d=new Float32Array(108),h=new Float32Array(72),u=new Float32Array(36);for(let e=0;e<6;e++){var A=e%3*2/3-1,p=2<e?0:-1,A=(d.set([A,p,0,A+2/3,p,0,A+2/3,1+p,0,A,p,0,A+2/3,1+p,0,A,1+p,0],18*e),h.set(c,12*e),[e,e,e,e,e,e]);u.set(A,6*e)}l=new BufferGeometry;l.setAttribute("position",new BufferAttribute(d,3)),l.setAttribute("uv",new BufferAttribute(h,2)),l.setAttribute("faceIndex",new BufferAttribute(u,1)),i.push(l),o>LOD_MIN&&o--}return{lodPlanes:i,sizeLods:n,sigmas:a}}function _createRenderTarget(e,t,r){e=new WebGLRenderTarget(e,t,r);return e.texture.mapping=CubeUVReflectionMapping,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function _setViewport(e,t,r,i,n){e.viewport.set(t,r,i,n),e.scissor.set(t,r,i,n)}function _getBlurShader(e,t,r){var i=new Float32Array(MAX_SAMPLES),n=new Vector3(0,1,0);return new ShaderMaterial({name:"SphericalGaussianBlur",defines:{n:MAX_SAMPLES,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/r,CUBEUV_MAX_MIP:e+".0"},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getEquirectMaterial(){return new ShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCubemapMaterial(){return new ShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCommonVertexShader(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function WebGLCubeUVMaps(n){let a=new WeakMap,o=null;function s(e){var e=e.target,t=(e.removeEventListener("dispose",s),a.get(e));void 0!==t&&(a.delete(e),t.dispose())}return{get:function(e){if(e&&e.isTexture){var t,r=e.mapping,i=r===EquirectangularReflectionMapping||r===EquirectangularRefractionMapping,r=r===CubeReflectionMapping||r===CubeRefractionMapping;if(i||r)return e.isRenderTargetTexture&&!0===e.needsPMREMUpdate?(e.needsPMREMUpdate=!1,t=a.get(e),null===o&&(o=new PMREMGenerator(n)),t=i?o.fromEquirectangular(e,t):o.fromCubemap(e,t),a.set(e,t),t.texture):a.has(e)?a.get(e).texture:(t=e.image,i&&t&&0<t.height||r&&t&&function(t){let r=0;for(let e=0;e<6;e++)void 0!==t[e]&&r++;return 6===r}(t)?(null===o&&(o=new PMREMGenerator(n)),r=i?o.fromEquirectangular(e):o.fromCubemap(e),a.set(e,r),e.addEventListener("dispose",s),r.texture):null)}return e},dispose:function(){a=new WeakMap,null!==o&&(o.dispose(),o=null)}}}function WebGLExtensions(r){const i={};function n(e){if(void 0!==i[e])return i[e];let t;switch(e){case"WEBGL_depth_texture":t=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":t=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":t=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":t=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:t=r.getExtension(e)}return i[e]=t}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){var t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function WebGLGeometries(o,u,a,s){const l={},A=new WeakMap;function c(e){var t=e.target;null!==t.index&&u.remove(t.index);for(const i in t.attributes)u.remove(t.attributes[i]);for(const n in t.morphAttributes){var r=t.morphAttributes[n];for(let e=0,t=r.length;e<t;e++)u.remove(r[e])}t.removeEventListener("dispose",c),delete l[t.id];e=A.get(t);e&&(u.remove(e),A.delete(t)),s.releaseStatesOfGeometry(t),!0===t.isInstancedBufferGeometry&&delete t._maxInstanceCount,a.memory.geometries--}function i(e){var r=[],i=e.index,t=e.attributes.position;let n=0;if(null!==i){var a=i.array;n=i.version;for(let e=0,t=a.length;e<t;e+=3){var o=a[e+0],s=a[e+1],l=a[e+2];r.push(o,s,s,l,l,o)}}else{if(void 0===t)return;i=t.array;n=t.version;for(let e=0,t=i.length/3-1;e<t;e+=3){var c=e+0,d=e+1,h=e+2;r.push(c,d,d,h,h,c)}}t=new(arrayNeedsUint32(r)?Uint32BufferAttribute:Uint16BufferAttribute)(r,1),t.version=n,i=A.get(e);i&&u.remove(i),A.set(e,t)}return{get:function(e,t){return!0!==l[t.id]&&(t.addEventListener("dispose",c),l[t.id]=!0,a.memory.geometries++),t},update:function(e){var t=e.attributes;for(const n in t)u.update(t[n],o.ARRAY_BUFFER);var r=e.morphAttributes;for(const a in r){var i=r[a];for(let e=0,t=i.length;e<t;e++)u.update(i[e],o.ARRAY_BUFFER)}},getWireframeAttribute:function(e){var t,r=A.get(e);return(!r||null!==(t=e.index)&&r.version<t.version)&&i(e),A.get(e)}}}function WebGLIndexedBufferRenderer(a,o,s,e){const l=e.isWebGL2;let c;let d,h;this.setMode=function(e){c=e},this.setIndex=function(e){d=e.type,h=e.bytesPerElement},this.render=function(e,t){a.drawElements(c,t,d,e*h),s.update(t,c,1)},this.renderInstances=function(r,i,n){if(0!==n){let e,t;if(l)e=a,t="drawElementsInstanced";else if(e=o.get("ANGLE_instanced_arrays"),t="drawElementsInstancedANGLE",null===e)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");e[t](c,i,d,r*h,n),s.update(i,c,n)}}}function WebGLInfo(i){const n={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:n,programs:null,autoReset:!0,reset:function(){n.calls=0,n.triangles=0,n.points=0,n.lines=0},update:function(e,t,r){switch(n.calls++,t){case i.TRIANGLES:n.triangles+=r*(e/3);break;case i.LINES:n.lines+=r*(e/2);break;case i.LINE_STRIP:n.lines+=r*(e-1);break;case i.LINE_LOOP:n.lines+=r*e;break;case i.POINTS:n.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",t)}}}}function numericalSort(e,t){return e[0]-t[0]}function absNumericalSort(e,t){return Math.abs(t[1])-Math.abs(e[1])}function WebGLMorphtargets(S,M,r){const B={},N=new Float32Array(8),R=new WeakMap,L=new Vector4,U=[];for(let e=0;e<8;e++)U[e]=[e,0];return{update:function(e,n,a){var o=e.morphTargetInfluences;if(!0===M.isWebGL2){var e=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,s=void 0!==e?e.length:0;let i=R.get(n);if(void 0===i||i.count!==s){void 0!==i&&i.texture.dispose();var l=void 0!==n.morphAttributes.position,c=void 0!==n.morphAttributes.normal,d=void 0!==n.morphAttributes.color,h=n.morphAttributes.position||[],u=n.morphAttributes.normal||[],A=n.morphAttributes.color||[];let e=!0==d?3:!0==c?2:!0==l?1:0,t=n.attributes.position.count*e,r=1;t>M.maxTextureSize&&(r=Math.ceil(t/M.maxTextureSize),t=M.maxTextureSize);var p=new Float32Array(t*r*4*s);const C=new DataArrayTexture(p,t,r,s);C.type=FloatType,C.needsUpdate=!0;var m=4*e;for(let e=0;e<s;e++){var f=h[e],g=u[e],v=A[e],_=t*r*4*e;for(let e=0;e<f.count;e++){var y=e*m;!0==l&&(L.fromBufferAttribute(f,e),p[_+y]=L.x,p[_+y+1]=L.y,p[_+y+2]=L.z,p[_+y+3]=0),!0==c&&(L.fromBufferAttribute(g,e),p[_+y+4]=L.x,p[_+y+5]=L.y,p[_+y+6]=L.z,p[_+y+7]=0),!0==d&&(L.fromBufferAttribute(v,e),p[_+y+8]=L.x,p[_+y+9]=L.y,p[_+y+10]=L.z,p[_+y+11]=4===v.itemSize?L.w:1)}}i={count:s,texture:C,size:new Vector2(t,r)},R.set(n,i),n.addEventListener("dispose",function e(){C.dispose(),R.delete(n),n.removeEventListener("dispose",e)})}let t=0;for(let e=0;e<o.length;e++)t+=o[e];e=n.morphTargetsRelative?1:1-t;a.getUniforms().setValue(S,"morphTargetBaseInfluence",e),a.getUniforms().setValue(S,"morphTargetInfluences",o),a.getUniforms().setValue(S,"morphTargetsTexture",i.texture,r),a.getUniforms().setValue(S,"morphTargetsTextureSize",i.size)}else{var i=void 0===o?0:o.length;let t=B[n.id];if(void 0===t||t.length!==i){t=[];for(let e=0;e<i;e++)t[e]=[e,0];B[n.id]=t}for(let e=0;e<i;e++){var E=t[e];E[0]=e,E[1]=o[e]}t.sort(absNumericalSort);for(let e=0;e<8;e++)e<i&&t[e][1]?(U[e][0]=t[e][0],U[e][1]=t[e][1]):(U[e][0]=Number.MAX_SAFE_INTEGER,U[e][1]=0);U.sort(numericalSort);var T=n.morphAttributes.position,x=n.morphAttributes.normal;let r=0;for(let e=0;e<8;e++){var b=U[e],w=b[0],b=b[1];w!==Number.MAX_SAFE_INTEGER&&b?(T&&n.getAttribute("morphTarget"+e)!==T[w]&&n.setAttribute("morphTarget"+e,T[w]),x&&n.getAttribute("morphNormal"+e)!==x[w]&&n.setAttribute("morphNormal"+e,x[w]),N[e]=b,r+=b):(T&&!0===n.hasAttribute("morphTarget"+e)&&n.deleteAttribute("morphTarget"+e),x&&!0===n.hasAttribute("morphNormal"+e)&&n.deleteAttribute("morphNormal"+e),N[e]=0)}e=n.morphTargetsRelative?1:1-r;a.getUniforms().setValue(S,"morphTargetBaseInfluence",e),a.getUniforms().setValue(S,"morphTargetInfluences",N)}}}}function WebGLObjects(i,n,a,o){let s=new WeakMap;function l(e){e=e.target;e.removeEventListener("dispose",l),a.remove(e.instanceMatrix),null!==e.instanceColor&&a.remove(e.instanceColor)}return{update:function(e){var t=o.render.frame,r=e.geometry,r=n.get(e,r);return s.get(r)!==t&&(n.update(r),s.set(r,t)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",l)&&e.addEventListener("dispose",l),s.get(e)!==t)&&(a.update(e.instanceMatrix,i.ARRAY_BUFFER),null!==e.instanceColor&&a.update(e.instanceColor,i.ARRAY_BUFFER),s.set(e,t)),e.isSkinnedMesh&&(e=e.skeleton,s.get(e)!==t)&&(e.update(),s.set(e,t)),r},dispose:function(){s=new WeakMap}}}const emptyTexture=new Texture,emptyArrayTexture=new DataArrayTexture,empty3dTexture=new Data3DTexture,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(r,i,n){var e=r[0];if(e<=0||0<e)return r;var t=i*n;let a=arrayCacheF32[t];if(void 0===a&&(a=new Float32Array(t),arrayCacheF32[t]=a),0!==i){e.toArray(a,0);for(let e=1,t=0;e!==i;++e)t+=n,r[e].toArray(a,t)}return a}function arraysEqual(r,i){if(r.length!==i.length)return!1;for(let e=0,t=r.length;e<t;e++)if(r[e]!==i[e])return!1;return!0}function copyArray(r,i){for(let e=0,t=i.length;e<t;e++)r[e]=i[e]}function allocTexUnits(t,r){let i=arrayCacheI32[r];void 0===i&&(i=new Int32Array(r),arrayCacheI32[r]=i);for(let e=0;e!==r;++e)i[e]=t.allocateTextureUnit();return i}function setValueV1f(e,t){var r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function setValueV2f(e,t){var r=this.cache;void 0!==t.x?r[0]===t.x&&r[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y):arraysEqual(r,t)||(e.uniform2fv(this.addr,t),copyArray(r,t))}function setValueV3f(e,t){var r=this.cache;void 0!==t.x?r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z):void 0!==t.r?r[0]===t.r&&r[1]===t.g&&r[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b):arraysEqual(r,t)||(e.uniform3fv(this.addr,t),copyArray(r,t))}function setValueV4f(e,t){var r=this.cache;void 0!==t.x?r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w):arraysEqual(r,t)||(e.uniform4fv(this.addr,t),copyArray(r,t))}function setValueM2(e,t){var r=this.cache,i=t.elements;void 0===i?arraysEqual(r,t)||(e.uniformMatrix2fv(this.addr,!1,t),copyArray(r,t)):arraysEqual(r,i)||(mat2array.set(i),e.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(r,i))}function setValueM3(e,t){var r=this.cache,i=t.elements;void 0===i?arraysEqual(r,t)||(e.uniformMatrix3fv(this.addr,!1,t),copyArray(r,t)):arraysEqual(r,i)||(mat3array.set(i),e.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(r,i))}function setValueM4(e,t){var r=this.cache,i=t.elements;void 0===i?arraysEqual(r,t)||(e.uniformMatrix4fv(this.addr,!1,t),copyArray(r,t)):arraysEqual(r,i)||(mat4array.set(i),e.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(r,i))}function setValueV1i(e,t){var r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function setValueV2i(e,t){var r=this.cache;void 0!==t.x?r[0]===t.x&&r[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y):arraysEqual(r,t)||(e.uniform2iv(this.addr,t),copyArray(r,t))}function setValueV3i(e,t){var r=this.cache;void 0!==t.x?r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z):arraysEqual(r,t)||(e.uniform3iv(this.addr,t),copyArray(r,t))}function setValueV4i(e,t){var r=this.cache;void 0!==t.x?r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w):arraysEqual(r,t)||(e.uniform4iv(this.addr,t),copyArray(r,t))}function setValueV1ui(e,t){var r=this.cache;r[0]!==t&&(e.uniform1ui(this.addr,t),r[0]=t)}function setValueV2ui(e,t){var r=this.cache;void 0!==t.x?r[0]===t.x&&r[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y):arraysEqual(r,t)||(e.uniform2uiv(this.addr,t),copyArray(r,t))}function setValueV3ui(e,t){var r=this.cache;void 0!==t.x?r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z):arraysEqual(r,t)||(e.uniform3uiv(this.addr,t),copyArray(r,t))}function setValueV4ui(e,t){var r=this.cache;void 0!==t.x?r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w):arraysEqual(r,t)||(e.uniform4uiv(this.addr,t),copyArray(r,t))}function setValueT1(e,t,r){var i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture2D(t||emptyTexture,n)}function setValueT3D1(e,t,r){var i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture3D(t||empty3dTexture,n)}function setValueT6(e,t,r){var i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTextureCube(t||emptyCubeTexture,n)}function setValueT2DArray1(e,t,r){var i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture2DArray(t||emptyArrayTexture,n)}function getSingularSetter(e){switch(e){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 36294:return setValueV2ui;case 36295:return setValueV3ui;case 36296:return setValueV4ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(e,t){e.uniform1fv(this.addr,t)}function setValueV2fArray(e,t){t=flatten(t,this.size,2);e.uniform2fv(this.addr,t)}function setValueV3fArray(e,t){t=flatten(t,this.size,3);e.uniform3fv(this.addr,t)}function setValueV4fArray(e,t){t=flatten(t,this.size,4);e.uniform4fv(this.addr,t)}function setValueM2Array(e,t){t=flatten(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,t)}function setValueM3Array(e,t){t=flatten(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,t)}function setValueM4Array(e,t){t=flatten(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,t)}function setValueV1iArray(e,t){e.uniform1iv(this.addr,t)}function setValueV2iArray(e,t){e.uniform2iv(this.addr,t)}function setValueV3iArray(e,t){e.uniform3iv(this.addr,t)}function setValueV4iArray(e,t){e.uniform4iv(this.addr,t)}function setValueV1uiArray(e,t){e.uniform1uiv(this.addr,t)}function setValueV2uiArray(e,t){e.uniform2uiv(this.addr,t)}function setValueV3uiArray(e,t){e.uniform3uiv(this.addr,t)}function setValueV4uiArray(e,t){e.uniform4uiv(this.addr,t)}function setValueT1Array(e,t,r){var i=this.cache,n=t.length,a=allocTexUnits(r,n);arraysEqual(i,a)||(e.uniform1iv(this.addr,a),copyArray(i,a));for(let e=0;e!==n;++e)r.setTexture2D(t[e]||emptyTexture,a[e])}function setValueT3DArray(e,t,r){var i=this.cache,n=t.length,a=allocTexUnits(r,n);arraysEqual(i,a)||(e.uniform1iv(this.addr,a),copyArray(i,a));for(let e=0;e!==n;++e)r.setTexture3D(t[e]||empty3dTexture,a[e])}function setValueT6Array(e,t,r){var i=this.cache,n=t.length,a=allocTexUnits(r,n);arraysEqual(i,a)||(e.uniform1iv(this.addr,a),copyArray(i,a));for(let e=0;e!==n;++e)r.setTextureCube(t[e]||emptyCubeTexture,a[e])}function setValueT2DArrayArray(e,t,r){var i=this.cache,n=t.length,a=allocTexUnits(r,n);arraysEqual(i,a)||(e.uniform1iv(this.addr,a),copyArray(i,a));for(let e=0;e!==n;++e)r.setTexture2DArray(t[e]||emptyArrayTexture,a[e])}function getPureArraySetter(e){switch(e){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 5125:return setValueV1uiArray;case 36294:return setValueV2uiArray;case 36295:return setValueV3uiArray;case 36296:return setValueV4uiArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35679:case 36299:case 36307:return setValueT3DArray;case 35680:case 36300:case 36308:case 36293:return setValueT6Array;case 36289:case 36303:case 36311:case 36292:return setValueT2DArrayArray}}class SingleUniform{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=getSingularSetter(t.type)}}class PureArrayUniform{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=getPureArraySetter(t.type)}}class StructuredUniform{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(r,i,n){var a=this.seq;for(let e=0,t=a.length;e!==t;++e){var o=a[e];o.setValue(r,i[o.id],n)}}}const RePathPart=/(\w+)(\])?(\[|\.)?/g;function addUniform(e,t){e.seq.push(t),e.map[t.id]=t}function parseUniform(e,r,i){var n=e.name,a=n.length;for(RePathPart.lastIndex=0;;){var o=RePathPart.exec(n),s=RePathPart.lastIndex;let t=o[1];var l="]"===o[2],o=o[3];if(l&&(t|=0),void 0===o||"["===o&&s+2===a){addUniform(i,new(void 0===o?SingleUniform:PureArrayUniform)(t,e,r));break}{let e=i.map[t];void 0===e&&addUniform(i,e=new StructuredUniform(t)),i=e}}}class WebGLUniforms{constructor(t,r){this.seq=[],this.map={};var i=t.getProgramParameter(r,t.ACTIVE_UNIFORMS);for(let e=0;e<i;++e){var n=t.getActiveUniform(r,e);parseUniform(n,t.getUniformLocation(r,n.name),this)}}setValue(e,t,r,i){t=this.map[t];void 0!==t&&t.setValue(e,r,i)}setOptional(e,t,r){t=t[r];void 0!==t&&this.setValue(e,r,t)}static upload(r,i,n,a){for(let e=0,t=i.length;e!==t;++e){var o=i[e],s=n[o.id];!1!==s.needsUpdate&&o.setValue(r,s.value,a)}}static seqWithValue(r,i){var n=[];for(let e=0,t=r.length;e!==t;++e){var a=r[e];a.id in i&&n.push(a)}return n}}function WebGLShader(e,t,r){t=e.createShader(t);return e.shaderSource(t,r),e.compileShader(t),t}let programIdCount=0;function handleSource(t,r){var i=t.split("\n"),n=[],t=Math.max(r-6,0),a=Math.min(r+6,i.length);for(let e=t;e<a;e++){var o=e+1;n.push(`${o===r?">":" "} ${o}: `+i[e])}return n.join("\n")}function getEncodingComponents(e){switch(e){case LinearSRGBColorSpace:return["Linear","( value )"];case SRGBColorSpace:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),["Linear","( value )"]}}function getShaderErrors(e,t,r){var i=e.getShaderParameter(t,e.COMPILE_STATUS),n=e.getShaderInfoLog(t).trim();return i&&""===n?"":(i=/ERROR: 0:(\d+)/.exec(n))?(i=parseInt(i[1]),r.toUpperCase()+"\n\n"+n+"\n\n"+handleSource(e.getShaderSource(t),i)):n}function getTexelEncodingFunction(e,t){t=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function getToneMappingFunction(e,t){let r;switch(t){case LinearToneMapping:r="Linear";break;case ReinhardToneMapping:r="Reinhard";break;case CineonToneMapping:r="OptimizedCineon";break;case ACESFilmicToneMapping:r="ACESFilmic";break;case CustomToneMapping:r="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),r="Linear"}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function generateExtensions(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join("\n")}function generateDefines(e){var t=[];for(const i in e){var r=e[i];!1!==r&&t.push("#define "+i+" "+r)}return t.join("\n")}function fetchAttributeLocations(r,i){var n={},e=r.getProgramParameter(i,r.ACTIVE_ATTRIBUTES);for(let t=0;t<e;t++){var a=r.getActiveAttrib(i,t),o=a.name;let e=1;a.type===r.FLOAT_MAT2&&(e=2),a.type===r.FLOAT_MAT3&&(e=3),a.type===r.FLOAT_MAT4&&(e=4),n[o]={type:a.type,location:r.getAttribLocation(i,o),locationSize:e}}return n}function filterEmptyLine(e){return""!==e}function replaceLightNums(e,t){var r=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,r).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function replaceClippingPlaneNums(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(e){return e.replace(includePattern,includeReplacer)}const shaderChunkMap=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function includeReplacer(e,t){let r=ShaderChunk[t];if(void 0===r){var i=shaderChunkMap.get(t);if(void 0===i)throw new Error("Can not resolve #include <"+t+">");r=ShaderChunk[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,i)}return resolveIncludes(r)}const unrollLoopPattern=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(e){return e.replace(unrollLoopPattern,loopReplacer)}function loopReplacer(e,t,r,i){let n="";for(let e=parseInt(t);e<parseInt(r);e++)n+=i.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return n}function generatePrecision(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function generateShadowMapTypeDefine(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===PCFShadowMap?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===PCFSoftShadowMap?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===VSMShadowMap&&(t="SHADOWMAP_TYPE_VSM"),t}function generateEnvMapTypeDefine(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:t="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:t="ENVMAP_TYPE_CUBE_UV"}return t}function generateEnvMapModeDefine(e){let t="ENVMAP_MODE_REFLECTION";return t=e.envMap&&e.envMapMode===CubeRefractionMapping?"ENVMAP_MODE_REFRACTION":t}function generateEnvMapBlendingDefine(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case MultiplyOperation:t="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:t="ENVMAP_BLENDING_MIX";break;case AddOperation:t="ENVMAP_BLENDING_ADD"}return t}function generateCubeUVSize(e){var t,e=e.envMapCubeUVHeight;return null===e?null:(t=Math.log2(e)-2,e=1/e,{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:e,maxMip:t})}function WebGLProgram(r,e,t,i){const n=r.getContext();var a=t.defines,o=t.vertexShader,s=t.fragmentShader,l=generateShadowMapTypeDefine(t),c=generateEnvMapTypeDefine(t),d=generateEnvMapModeDefine(t),h=generateEnvMapBlendingDefine(t),u=generateCubeUVSize(t),A=t.isWebGL2?"":generateExtensions(t),a=generateDefines(a);const p=n.createProgram();let m,f,g=t.glslVersion?"#version "+t.glslVersion+"\n":"";t.isRawShaderMaterial?(0<(m=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,a].filter(filterEmptyLine).join("\n")).length&&(m+="\n"),0<(f=[A,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,a].filter(filterEmptyLine).join("\n")).length&&(f+="\n")):(m=[generatePrecision(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,a,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+d:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&!1===t.flatShading?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&!1===t.flatShading?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",0<t.morphTargetsCount&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",0<t.morphTargetsCount&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",0<t.morphTargetsCount&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(filterEmptyLine).join("\n"),f=[A,generatePrecision(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,a,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+d:"",t.envMap?"#define "+h:"",u?"#define CUBEUV_TEXEL_WIDTH "+u.texelWidth:"",u?"#define CUBEUV_TEXEL_HEIGHT "+u.texelHeight:"",u?"#define CUBEUV_MAX_MIP "+u.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&!1===t.flatShading?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",t.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",t.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",ShaderChunk.colorspace_pars_fragment,getTexelEncodingFunction("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter(filterEmptyLine).join("\n")),o=replaceClippingPlaneNums(replaceLightNums(resolveIncludes(o),t),t),s=replaceClippingPlaneNums(replaceLightNums(resolveIncludes(s),t),t),o=unrollLoops(o),s=unrollLoops(s),t.isWebGL2&&!0!==t.isRawShaderMaterial&&(g="#version 300 es\n",m=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+m,f=["#define varying in",t.glslVersion===GLSL3?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===GLSL3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+f);A=g+m+o,a=g+f+s,c=WebGLShader(n,n.VERTEX_SHADER,A),d=WebGLShader(n,n.FRAGMENT_SHADER,a);if(n.attachShader(p,c),n.attachShader(p,d),void 0!==t.index0AttributeName?n.bindAttribLocation(p,0,t.index0AttributeName):!0===t.morphTargets&&n.bindAttribLocation(p,0,"position"),n.linkProgram(p),r.debug.checkShaderErrors){h=n.getProgramInfoLog(p).trim(),u=n.getShaderInfoLog(c).trim(),l=n.getShaderInfoLog(d).trim();let e=!0,t=!0;!1===n.getProgramParameter(p,n.LINK_STATUS)?(e=!1,"function"==typeof r.debug.onShaderError?r.debug.onShaderError(n,p,c,d):(o=getShaderErrors(n,c,"vertex"),s=getShaderErrors(n,d,"fragment"),console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(p,n.VALIDATE_STATUS)+"\n\nProgram Info Log: "+h+"\n"+o+"\n"+s))):""!==h?console.warn("THREE.WebGLProgram: Program Info Log:",h):""!==u&&""!==l||(t=!1),t&&(this.diagnostics={runnable:e,programLog:h,vertexShader:{log:u,prefix:m},fragmentShader:{log:l,prefix:f}})}n.deleteShader(c),n.deleteShader(d);let v;this.getUniforms=function(){return v=void 0===v?new WebGLUniforms(n,p):v};let _;return this.getAttributes=function(){return _=void 0===_?fetchAttributeLocations(n,p):_},this.destroy=function(){i.releaseStatesOfProgram(this),n.deleteProgram(p),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=programIdCount++,this.cacheKey=e,this.usedTimes=1,this.program=p,this.vertexShader=c,this.fragmentShader=d,this}let _id=0;class WebGLShaderCache{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){var t=e.vertexShader,r=e.fragmentShader,t=this._getShaderStage(t),r=this._getShaderStage(r),e=this._getShaderCacheForMaterial(e);return!1===e.has(t)&&(e.add(t),t.usedTimes++),!1===e.has(r)&&(e.add(r),r.usedTimes++),this}remove(e){for(const t of this.materialCache.get(e))t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){var t=this.materialCache;let r=t.get(e);return void 0===r&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){var t=this.shaderCache;let r=t.get(e);return void 0===r&&(r=new WebGLShaderStage(e),t.set(e,r)),r}}class WebGLShaderStage{constructor(e){this.id=_id++,this.code=e,this.usedTimes=0}}function WebGLPrograms(te,re,ie,ne,ae,t,oe){const a=new Layers,se=new WebGLShaderCache,o=[],le=ae.isWebGL2,ce=ae.logarithmicDepthBuffer,de=ae.vertexTextures;let he=ae.precision;const ue={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function Ae(e){return 0===e?"uv":"uv"+e}return{getParameters:function(e,t,P,r,i){var n=r.fog,a=i.geometry,r=e.isMeshStandardMaterial?r.environment:null,O=(r=(e.isMeshStandardMaterial?ie:re).get(e.envMap||r))&&r.mapping===CubeUVReflectionMapping?r.image.height:null,o=ue[e.type];null!==e.precision&&(he=ae.getMaxPrecision(e.precision))!==e.precision&&console.warn("THREE.WebGLProgram.getParameters:",e.precision,"not supported, using",he,"instead.");var s=void 0!==(s=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color)?s.length:0;let l=0;void 0!==a.morphAttributes.position&&(l=1),void 0!==a.morphAttributes.normal&&(l=2),void 0!==a.morphAttributes.color&&(l=3);let c,d,h,u;o?(A=ShaderLib[o],c=A.vertexShader,d=A.fragmentShader):(c=e.vertexShader,d=e.fragmentShader,se.update(e),h=se.getVertexShaderID(e),u=se.getFragmentShaderID(e));var A=te.getRenderTarget(),p=!0===i.isInstancedMesh,m=!!e.map,D=!!e.matcap,f=!!r,g=!!e.aoMap,v=!!e.lightMap,_=!!e.bumpMap,y=!!e.normalMap,E=!!e.displacementMap,T=!!e.emissiveMap,x=!!e.metalnessMap,b=!!e.roughnessMap,w=0<e.anisotropy,C=0<e.clearcoat,S=0<e.iridescence,M=0<e.sheen,B=0<e.transmission,N=w&&!!e.anisotropyMap,R=C&&!!e.clearcoatMap,L=C&&!!e.clearcoatNormalMap,U=C&&!!e.clearcoatRoughnessMap,H=S&&!!e.iridescenceMap,k=S&&!!e.iridescenceThicknessMap,V=M&&!!e.sheenColorMap,Q=M&&!!e.sheenRoughnessMap,G=!!e.specularMap,z=!!e.specularColorMap,$=!!e.specularIntensityMap,W=B&&!!e.transmissionMap,K=B&&!!e.thicknessMap,j=!!e.gradientMap,I=!!e.alphaMap,X=0<e.alphaTest,Y=!!e.alphaHash,F=!!e.extensions,q=!!a.attributes.uv1,J=!!a.attributes.uv2,Z=!!a.attributes.uv3;let ee=NoToneMapping;return!e.toneMapped||null!==A&&!0!==A.isXRRenderTarget||(ee=te.toneMapping),{isWebGL2:le,shaderID:o,shaderType:e.type,shaderName:e.name,vertexShader:c,fragmentShader:d,defines:e.defines,customVertexShaderID:h,customFragmentShaderID:u,isRawShaderMaterial:!0===e.isRawShaderMaterial,glslVersion:e.glslVersion,precision:he,instancing:p,instancingColor:p&&null!==i.instanceColor,supportsVertexTextures:de,outputColorSpace:null===A?te.outputColorSpace:!0===A.isXRRenderTarget?A.texture.colorSpace:LinearSRGBColorSpace,map:m,matcap:D,envMap:f,envMapMode:f&&r.mapping,envMapCubeUVHeight:O,aoMap:g,lightMap:v,bumpMap:_,normalMap:y,displacementMap:de&&E,emissiveMap:T,normalMapObjectSpace:y&&e.normalMapType===ObjectSpaceNormalMap,normalMapTangentSpace:y&&e.normalMapType===TangentSpaceNormalMap,metalnessMap:x,roughnessMap:b,anisotropy:w,anisotropyMap:N,clearcoat:C,clearcoatMap:R,clearcoatNormalMap:L,clearcoatRoughnessMap:U,iridescence:S,iridescenceMap:H,iridescenceThicknessMap:k,sheen:M,sheenColorMap:V,sheenRoughnessMap:Q,specularMap:G,specularColorMap:z,specularIntensityMap:$,transmission:B,transmissionMap:W,thicknessMap:K,gradientMap:j,opaque:!1===e.transparent&&e.blending===NormalBlending,alphaMap:I,alphaTest:X,alphaHash:Y,combine:e.combine,mapUv:m&&Ae(e.map.channel),aoMapUv:g&&Ae(e.aoMap.channel),lightMapUv:v&&Ae(e.lightMap.channel),bumpMapUv:_&&Ae(e.bumpMap.channel),normalMapUv:y&&Ae(e.normalMap.channel),displacementMapUv:E&&Ae(e.displacementMap.channel),emissiveMapUv:T&&Ae(e.emissiveMap.channel),metalnessMapUv:x&&Ae(e.metalnessMap.channel),roughnessMapUv:b&&Ae(e.roughnessMap.channel),anisotropyMapUv:N&&Ae(e.anisotropyMap.channel),clearcoatMapUv:R&&Ae(e.clearcoatMap.channel),clearcoatNormalMapUv:L&&Ae(e.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:U&&Ae(e.clearcoatRoughnessMap.channel),iridescenceMapUv:H&&Ae(e.iridescenceMap.channel),iridescenceThicknessMapUv:k&&Ae(e.iridescenceThicknessMap.channel),sheenColorMapUv:V&&Ae(e.sheenColorMap.channel),sheenRoughnessMapUv:Q&&Ae(e.sheenRoughnessMap.channel),specularMapUv:G&&Ae(e.specularMap.channel),specularColorMapUv:z&&Ae(e.specularColorMap.channel),specularIntensityMapUv:$&&Ae(e.specularIntensityMap.channel),transmissionMapUv:W&&Ae(e.transmissionMap.channel),thicknessMapUv:K&&Ae(e.thicknessMap.channel),alphaMapUv:I&&Ae(e.alphaMap.channel),vertexTangents:!!a.attributes.tangent&&(y||w),vertexColors:e.vertexColors,vertexAlphas:!0===e.vertexColors&&!!a.attributes.color&&4===a.attributes.color.itemSize,vertexUv1s:q,vertexUv2s:J,vertexUv3s:Z,pointsUvs:!0===i.isPoints&&!!a.attributes.uv&&(m||I),fog:!!n,useFog:!0===e.fog,fogExp2:n&&n.isFogExp2,flatShading:!0===e.flatShading,sizeAttenuation:!0===e.sizeAttenuation,logarithmicDepthBuffer:ce,skinning:!0===i.isSkinnedMesh,morphTargets:void 0!==a.morphAttributes.position,morphNormals:void 0!==a.morphAttributes.normal,morphColors:void 0!==a.morphAttributes.color,morphTargetsCount:s,morphTextureStride:l,numDirLights:t.directional.length,numPointLights:t.point.length,numSpotLights:t.spot.length,numSpotLightMaps:t.spotLightMap.length,numRectAreaLights:t.rectArea.length,numHemiLights:t.hemi.length,numDirLightShadows:t.directionalShadowMap.length,numPointLightShadows:t.pointShadowMap.length,numSpotLightShadows:t.spotShadowMap.length,numSpotLightShadowsWithMaps:t.numSpotLightShadowsWithMaps,numClippingPlanes:oe.numPlanes,numClipIntersection:oe.numIntersection,dithering:e.dithering,shadowMapEnabled:te.shadowMap.enabled&&0<P.length,shadowMapType:te.shadowMap.type,toneMapping:ee,useLegacyLights:te._useLegacyLights,premultipliedAlpha:e.premultipliedAlpha,doubleSided:e.side===DoubleSide,flipSided:e.side===BackSide,useDepthPacking:0<=e.depthPacking,depthPacking:e.depthPacking||0,index0AttributeName:e.index0AttributeName,extensionDerivatives:F&&!0===e.extensions.derivatives,extensionFragDepth:F&&!0===e.extensions.fragDepth,extensionDrawBuffers:F&&!0===e.extensions.drawBuffers,extensionShaderTextureLOD:F&&!0===e.extensions.shaderTextureLOD,rendererExtensionFragDepth:le||ne.has("EXT_frag_depth"),rendererExtensionDrawBuffers:le||ne.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:le||ne.has("EXT_shader_texture_lod"),customProgramCacheKey:e.customProgramCacheKey()}},getProgramCacheKey:function(e){var t,r,i=[];if(e.shaderID?i.push(e.shaderID):(i.push(e.customVertexShaderID),i.push(e.customFragmentShaderID)),void 0!==e.defines)for(const n in e.defines)i.push(n),i.push(e.defines[n]);return!1===e.isRawShaderMaterial&&((t=i).push((r=e).precision),t.push(r.outputColorSpace),t.push(r.envMapMode),t.push(r.envMapCubeUVHeight),t.push(r.mapUv),t.push(r.alphaMapUv),t.push(r.lightMapUv),t.push(r.aoMapUv),t.push(r.bumpMapUv),t.push(r.normalMapUv),t.push(r.displacementMapUv),t.push(r.emissiveMapUv),t.push(r.metalnessMapUv),t.push(r.roughnessMapUv),t.push(r.anisotropyMapUv),t.push(r.clearcoatMapUv),t.push(r.clearcoatNormalMapUv),t.push(r.clearcoatRoughnessMapUv),t.push(r.iridescenceMapUv),t.push(r.iridescenceThicknessMapUv),t.push(r.sheenColorMapUv),t.push(r.sheenRoughnessMapUv),t.push(r.specularMapUv),t.push(r.specularColorMapUv),t.push(r.specularIntensityMapUv),t.push(r.transmissionMapUv),t.push(r.thicknessMapUv),t.push(r.combine),t.push(r.fogExp2),t.push(r.sizeAttenuation),t.push(r.morphTargetsCount),t.push(r.morphAttributeCount),t.push(r.numDirLights),t.push(r.numPointLights),t.push(r.numSpotLights),t.push(r.numSpotLightMaps),t.push(r.numHemiLights),t.push(r.numRectAreaLights),t.push(r.numDirLightShadows),t.push(r.numPointLightShadows),t.push(r.numSpotLightShadows),t.push(r.numSpotLightShadowsWithMaps),t.push(r.shadowMapType),t.push(r.toneMapping),t.push(r.numClippingPlanes),t.push(r.numClipIntersection),t.push(r.depthPacking),t=i,r=e,a.disableAll(),r.isWebGL2&&a.enable(0),r.supportsVertexTextures&&a.enable(1),r.instancing&&a.enable(2),r.instancingColor&&a.enable(3),r.matcap&&a.enable(4),r.envMap&&a.enable(5),r.normalMapObjectSpace&&a.enable(6),r.normalMapTangentSpace&&a.enable(7),r.clearcoat&&a.enable(8),r.iridescence&&a.enable(9),r.alphaTest&&a.enable(10),r.vertexColors&&a.enable(11),r.vertexAlphas&&a.enable(12),r.vertexUv1s&&a.enable(13),r.vertexUv2s&&a.enable(14),r.vertexUv3s&&a.enable(15),r.vertexTangents&&a.enable(16),r.anisotropy&&a.enable(17),t.push(a.mask),a.disableAll(),r.fog&&a.enable(0),r.useFog&&a.enable(1),r.flatShading&&a.enable(2),r.logarithmicDepthBuffer&&a.enable(3),r.skinning&&a.enable(4),r.morphTargets&&a.enable(5),r.morphNormals&&a.enable(6),r.morphColors&&a.enable(7),r.premultipliedAlpha&&a.enable(8),r.shadowMapEnabled&&a.enable(9),r.useLegacyLights&&a.enable(10),r.doubleSided&&a.enable(11),r.flipSided&&a.enable(12),r.useDepthPacking&&a.enable(13),r.dithering&&a.enable(14),r.transmission&&a.enable(15),r.sheen&&a.enable(16),r.opaque&&a.enable(17),r.pointsUvs&&a.enable(18),t.push(a.mask),i.push(te.outputColorSpace)),i.push(e.customProgramCacheKey),i.join()},getUniforms:function(e){var t=ue[e.type];let r;return r=t?(t=ShaderLib[t],UniformsUtils.clone(t.uniforms)):e.uniforms},acquireProgram:function(e,r){let i;for(let e=0,t=o.length;e<t;e++){var n=o[e];if(n.cacheKey===r){++(i=n).usedTimes;break}}return void 0===i&&(i=new WebGLProgram(te,r,e,t),o.push(i)),i},releaseProgram:function(e){var t;0==--e.usedTimes&&(t=o.indexOf(e),o[t]=o[o.length-1],o.pop(),e.destroy())},releaseShaderCache:function(e){se.remove(e)},programs:o,dispose:function(){se.dispose()}}}function WebGLProperties(){let i=new WeakMap;return{get:function(e){let t=i.get(e);return void 0===t&&(t={},i.set(e,t)),t},remove:function(e){i.delete(e)},update:function(e,t,r){i.get(e)[t]=r},dispose:function(){i=new WeakMap}}}function painterSortStable(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function reversePainterSortStable(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function WebGLRenderList(){const s=[];let l=0;const o=[],c=[],d=[];function h(e,t,r,i,n,a){let o=s[l];return void 0===o?(o={id:e.id,object:e,geometry:t,material:r,groupOrder:i,renderOrder:e.renderOrder,z:n,group:a},s[l]=o):(o.id=e.id,o.object=e,o.geometry=t,o.material=r,o.groupOrder=i,o.renderOrder=e.renderOrder,o.z=n,o.group=a),l++,o}return{opaque:o,transmissive:c,transparent:d,init:function(){l=0,o.length=0,c.length=0,d.length=0},push:function(e,t,r,i,n,a){e=h(e,t,r,i,n,a),(0<r.transmission?c:!0===r.transparent?d:o).push(e)},unshift:function(e,t,r,i,n,a){e=h(e,t,r,i,n,a),(0<r.transmission?c:!0===r.transparent?d:o).unshift(e)},finish:function(){for(let e=l,t=s.length;e<t;e++){var r=s[e];if(null===r.id)break;r.id=null,r.object=null,r.geometry=null,r.material=null,r.group=null}},sort:function(e,t){1<o.length&&o.sort(e||painterSortStable),1<c.length&&c.sort(t||reversePainterSortStable),1<d.length&&d.sort(t||reversePainterSortStable)}}}function WebGLRenderLists(){let n=new WeakMap;return{get:function(e,t){var r=n.get(e);let i;return void 0===r?(i=new WebGLRenderList,n.set(e,[i])):t>=r.length?(i=new WebGLRenderList,r.push(i)):i=r[t],i},dispose:function(){n=new WeakMap}}}function UniformsCache(){const r={};return{get:function(e){if(void 0!==r[e.id])return r[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Vector3,color:new Color};break;case"SpotLight":t={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":t={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3}}return r[e.id]=t}}}function ShadowUniformsCache(){const r={};return{get:function(e){if(void 0!==r[e.id])return r[e.id];let t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3}}return r[e.id]=t}}}let nextVersion=0;function shadowCastingAndTexturingLightsFirst(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function WebGLLights(t,C){const S=new UniformsCache,M=ShadowUniformsCache(),B={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let e=0;e<9;e++)B.probe.push(new Vector3);const A=new Vector3,p=new Matrix4,m=new Matrix4;return{setup:function(r,e){let i=0,n=0,a=0;for(let e=0;e<9;e++)B.probe[e].set(0,0,0);let o=0,s=0,l=0,c=0,d=0,h=0,u=0,A=0,p=0,m=0;r.sort(shadowCastingAndTexturingLightsFirst);var f=!0===e?Math.PI:1;for(let e=0,t=r.length;e<t;e++){var g,v,_,y,E=r[e],T=E.color,x=E.intensity,b=E.distance,w=E.shadow&&E.shadow.map?E.shadow.map.texture:null;if(E.isAmbientLight)i+=T.r*x*f,n+=T.g*x*f,a+=T.b*x*f;else if(E.isLightProbe)for(let e=0;e<9;e++)B.probe[e].addScaledVector(E.sh.coefficients[e],x);else E.isDirectionalLight?((_=S.get(E)).color.copy(E.color).multiplyScalar(E.intensity*f),E.castShadow&&(g=E.shadow,(v=M.get(E)).shadowBias=g.bias,v.shadowNormalBias=g.normalBias,v.shadowRadius=g.radius,v.shadowMapSize=g.mapSize,B.directionalShadow[o]=v,B.directionalShadowMap[o]=w,B.directionalShadowMatrix[o]=E.shadow.matrix,h++),B.directional[o]=_,o++):E.isSpotLight?((g=S.get(E)).position.setFromMatrixPosition(E.matrixWorld),g.color.copy(T).multiplyScalar(x*f),g.distance=b,g.coneCos=Math.cos(E.angle),g.penumbraCos=Math.cos(E.angle*(1-E.penumbra)),g.decay=E.decay,B.spot[l]=g,v=E.shadow,E.map&&(B.spotLightMap[p]=E.map,p++,v.updateMatrices(E),E.castShadow)&&m++,B.spotLightMatrix[l]=v.matrix,E.castShadow&&((_=M.get(E)).shadowBias=v.bias,_.shadowNormalBias=v.normalBias,_.shadowRadius=v.radius,_.shadowMapSize=v.mapSize,B.spotShadow[l]=_,B.spotShadowMap[l]=w,A++),l++):E.isRectAreaLight?((b=S.get(E)).color.copy(T).multiplyScalar(x),b.halfWidth.set(.5*E.width,0,0),b.halfHeight.set(0,.5*E.height,0),B.rectArea[c]=b,c++):E.isPointLight?((T=S.get(E)).color.copy(E.color).multiplyScalar(E.intensity*f),T.distance=E.distance,T.decay=E.decay,E.castShadow&&(b=E.shadow,(y=M.get(E)).shadowBias=b.bias,y.shadowNormalBias=b.normalBias,y.shadowRadius=b.radius,y.shadowMapSize=b.mapSize,y.shadowCameraNear=b.camera.near,y.shadowCameraFar=b.camera.far,B.pointShadow[s]=y,B.pointShadowMap[s]=w,B.pointShadowMatrix[s]=E.shadow.matrix,u++),B.point[s]=T,s++):E.isHemisphereLight&&((b=S.get(E)).skyColor.copy(E.color).multiplyScalar(x*f),b.groundColor.copy(E.groundColor).multiplyScalar(x*f),B.hemi[d]=b,d++)}0<c&&(C.isWebGL2||!0===t.has("OES_texture_float_linear")?(B.rectAreaLTC1=UniformsLib.LTC_FLOAT_1,B.rectAreaLTC2=UniformsLib.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(B.rectAreaLTC1=UniformsLib.LTC_HALF_1,B.rectAreaLTC2=UniformsLib.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),B.ambient[0]=i,B.ambient[1]=n,B.ambient[2]=a,(e=B.hash).directionalLength===o&&e.pointLength===s&&e.spotLength===l&&e.rectAreaLength===c&&e.hemiLength===d&&e.numDirectionalShadows===h&&e.numPointShadows===u&&e.numSpotShadows===A&&e.numSpotMaps===p||(B.directional.length=o,B.spot.length=l,B.rectArea.length=c,B.point.length=s,B.hemi.length=d,B.directionalShadow.length=h,B.directionalShadowMap.length=h,B.pointShadow.length=u,B.pointShadowMap.length=u,B.spotShadow.length=A,B.spotShadowMap.length=A,B.directionalShadowMatrix.length=h,B.pointShadowMatrix.length=u,B.spotLightMatrix.length=A+p-m,B.spotLightMap.length=p,B.numSpotLightShadowsWithMaps=m,e.directionalLength=o,e.pointLength=s,e.spotLength=l,e.rectAreaLength=c,e.hemiLength=d,e.numDirectionalShadows=h,e.numPointShadows=u,e.numSpotShadows=A,e.numSpotMaps=p,B.version=nextVersion++)},setupView:function(r,e){let i=0,n=0,a=0,o=0,s=0;var l=e.matrixWorldInverse;for(let e=0,t=r.length;e<t;e++){var c,d,h,u=r[e];u.isDirectionalLight?((c=B.directional[i]).direction.setFromMatrixPosition(u.matrixWorld),A.setFromMatrixPosition(u.target.matrixWorld),c.direction.sub(A),c.direction.transformDirection(l),i++):u.isSpotLight?((c=B.spot[a]).position.setFromMatrixPosition(u.matrixWorld),c.position.applyMatrix4(l),c.direction.setFromMatrixPosition(u.matrixWorld),A.setFromMatrixPosition(u.target.matrixWorld),c.direction.sub(A),c.direction.transformDirection(l),a++):u.isRectAreaLight?((d=B.rectArea[o]).position.setFromMatrixPosition(u.matrixWorld),d.position.applyMatrix4(l),m.identity(),p.copy(u.matrixWorld),p.premultiply(l),m.extractRotation(p),d.halfWidth.set(.5*u.width,0,0),d.halfHeight.set(0,.5*u.height,0),d.halfWidth.applyMatrix4(m),d.halfHeight.applyMatrix4(m),o++):u.isPointLight?((d=B.point[n]).position.setFromMatrixPosition(u.matrixWorld),d.position.applyMatrix4(l),n++):u.isHemisphereLight&&((h=B.hemi[s]).direction.setFromMatrixPosition(u.matrixWorld),h.direction.transformDirection(l),s++)}},state:B}}function WebGLRenderState(e,t){const r=new WebGLLights(e,t),i=[],n=[];return{init:function(){i.length=0,n.length=0},state:{lightsArray:i,shadowsArray:n,lights:r},setupLights:function(e){r.setup(i,e)},setupLightsView:function(e){r.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){n.push(e)}}}function WebGLRenderStates(n,a){let o=new WeakMap;return{get:function(e,t=0){var r=o.get(e);let i;return void 0===r?(i=new WebGLRenderState(n,a),o.set(e,[i])):t>=r.length?(i=new WebGLRenderState(n,a),r.push(i)):i=r[t],i},dispose:function(){o=new WeakMap}}}class MeshDepthMaterial extends Material{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class MeshDistanceMaterial extends Material{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const vertex="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragment="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function WebGLShadowMap(f,g,e){let v=new Frustum;const _=new Vector2,y=new Vector2,E=new Vector4,o=new MeshDepthMaterial({depthPacking:RGBADepthPacking}),s=new MeshDistanceMaterial,l={},T=e.maxTextureSize,c={[FrontSide]:BackSide,[BackSide]:FrontSide,[DoubleSide]:DoubleSide},x=new ShaderMaterial({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vertex,fragmentShader:fragment}),b=x.clone();b.defines.HORIZONTAL_PASS=1;e=new BufferGeometry;e.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const w=new Mesh(e,x),C=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap;let S=this.type;function M(r,i,e,t){let n=null;r=!0===e.isPointLight?r.customDistanceMaterial:r.customDepthMaterial;if(void 0!==r)n=r;else if(n=!0===e.isPointLight?s:o,f.localClippingEnabled&&!0===i.clipShadows&&Array.isArray(i.clippingPlanes)&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&0<i.alphaTest||i.map&&0<i.alphaTest){var r=n.uuid,a=i.uuid;let e=l[r],t=(void 0===e&&(e={},l[r]=e),e[a]);void 0===t&&(t=n.clone(),e[a]=t),n=t}return n.visible=i.visible,n.wireframe=i.wireframe,t===VSMShadowMap?n.side=null!==i.shadowSide?i.shadowSide:i.side:n.side=null!==i.shadowSide?i.shadowSide:c[i.side],n.alphaMap=i.alphaMap,n.alphaTest=i.alphaTest,n.map=i.map,n.clipShadows=i.clipShadows,n.clippingPlanes=i.clippingPlanes,n.clipIntersection=i.clipIntersection,n.displacementMap=i.displacementMap,n.displacementScale=i.displacementScale,n.displacementBias=i.displacementBias,n.wireframeLinewidth=i.wireframeLinewidth,n.linewidth=i.linewidth,!0===e.isPointLight&&!0===n.isMeshDistanceMaterial&&(f.properties.get(n).light=e),n}this.render=function(r,i,n){if(!1!==C.enabled&&(!1!==C.autoUpdate||!1!==C.needsUpdate)&&0!==r.length){var e=f.getRenderTarget(),t=f.getActiveCubeFace(),a=f.getActiveMipmapLevel(),o=f.state,s=(o.setBlending(NoBlending),o.buffers.color.setClear(1,1,1,1),o.buffers.depth.setTest(!0),o.setScissorTest(!1),S!==VSMShadowMap&&this.type===VSMShadowMap),l=S===VSMShadowMap&&this.type!==VSMShadowMap;for(let e=0,t=r.length;e<t;e++){var c=r[e],d=c.shadow;if(void 0===d)console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");else if(!1!==d.autoUpdate||!1!==d.needsUpdate){_.copy(d.mapSize);var h,u,A=d.getFrameExtents(),p=(_.multiply(A),y.copy(d.mapSize),(_.x>T||_.y>T)&&(_.x>T&&(y.x=Math.floor(T/A.x),_.x=y.x*A.x,d.mapSize.x=y.x),_.y>T)&&(y.y=Math.floor(T/A.y),_.y=y.y*A.y,d.mapSize.y=y.y),null!==d.map&&!0!=s&&!0!=l||(A=this.type!==VSMShadowMap?{minFilter:NearestFilter,magFilter:NearestFilter}:{},null!==d.map&&d.map.dispose(),d.map=new WebGLRenderTarget(_.x,_.y,A),d.map.texture.name=c.name+".shadowMap",d.camera.updateProjectionMatrix()),f.setRenderTarget(d.map),f.clear(),d.getViewportCount());for(let e=0;e<p;e++){var m=d.getViewport(e);E.set(y.x*m.x,y.y*m.y,y.x*m.z,y.y*m.w),o.viewport(E),d.updateMatrices(c,e),v=d.getFrustum(),!function r(i,n,a,o,s){if(!1===i.visible)return;const e=i.layers.test(n.layers);if(e&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&s===VSMShadowMap)&&(!i.frustumCulled||v.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,i.matrixWorld);const c=g.update(i),d=i.material;if(Array.isArray(d)){const h=c.groups;for(let e=0,t=h.length;e<t;e++){const u=h[e],A=d[u.materialIndex];if(A&&A.visible){const p=M(i,A,o,s);f.renderBufferDirect(a,null,c,p,i,u)}}}else if(d.visible){const t=M(i,d,o,s);f.renderBufferDirect(a,null,c,t,i,null)}}const l=i.children;for(let e=0,t=l.length;e<t;e++)r(l[e],n,a,o,s)}(i,n,d.camera,c,this.type)}!0!==d.isPointLightShadow&&this.type===VSMShadowMap&&(u=h=A=void 0,A=d,h=n,u=g.update(w),x.defines.VSM_SAMPLES!==A.blurSamples&&(x.defines.VSM_SAMPLES=A.blurSamples,b.defines.VSM_SAMPLES=A.blurSamples,x.needsUpdate=!0,b.needsUpdate=!0),null===A.mapPass&&(A.mapPass=new WebGLRenderTarget(_.x,_.y)),x.uniforms.shadow_pass.value=A.map.texture,x.uniforms.resolution.value=A.mapSize,x.uniforms.radius.value=A.radius,f.setRenderTarget(A.mapPass),f.clear(),f.renderBufferDirect(h,null,u,x,w,null),b.uniforms.shadow_pass.value=A.mapPass.texture,b.uniforms.resolution.value=A.mapSize,b.uniforms.radius.value=A.radius,f.setRenderTarget(A.map),f.clear(),f.renderBufferDirect(h,null,u,b,w,null)),d.needsUpdate=!1}}S=this.type,C.needsUpdate=!1,f.setRenderTarget(e,t,a)}}}function WebGLState(d,P,O){const o=O.isWebGL2;const i=new function(){let t=!1;const a=new Vector4;let r=null;const o=new Vector4(0,0,0,0);return{setMask:function(e){r===e||t||(d.colorMask(e,e,e,e),r=e)},setLocked:function(e){t=e},setClear:function(e,t,r,i,n){!0===n&&(e*=i,t*=i,r*=i),a.set(e,t,r,i),!1===o.equals(a)&&(d.clearColor(e,t,r,i),o.copy(a))},reset:function(){t=!1,r=null,o.set(-1,0,0,0)}}},n=new function(){let t=!1,r=null,i=null,n=null;return{setTest:function(e){(e?R:L)(d.DEPTH_TEST)},setMask:function(e){r===e||t||(d.depthMask(e),r=e)},setFunc:function(e){if(i!==e){switch(e){case NeverDepth:d.depthFunc(d.NEVER);break;case AlwaysDepth:d.depthFunc(d.ALWAYS);break;case LessDepth:d.depthFunc(d.LESS);break;case LessEqualDepth:d.depthFunc(d.LEQUAL);break;case EqualDepth:d.depthFunc(d.EQUAL);break;case GreaterEqualDepth:d.depthFunc(d.GEQUAL);break;case GreaterDepth:d.depthFunc(d.GREATER);break;case NotEqualDepth:d.depthFunc(d.NOTEQUAL);break;default:d.depthFunc(d.LEQUAL)}i=e}},setLocked:function(e){t=e},setClear:function(e){n!==e&&(d.clearDepth(e),n=e)},reset:function(){t=!1,r=null,i=null,n=null}}},a=new function(){let t=!1,r=null,i=null,n=null,a=null,o=null,s=null,l=null,c=null;return{setTest:function(e){t||(e?R:L)(d.STENCIL_TEST)},setMask:function(e){r===e||t||(d.stencilMask(e),r=e)},setFunc:function(e,t,r){i===e&&n===t&&a===r||(d.stencilFunc(e,t,r),i=e,n=t,a=r)},setOp:function(e,t,r){o===e&&s===t&&l===r||(d.stencilOp(e,t,r),o=e,s=t,l=r)},setLocked:function(e){t=e},setClear:function(e){c!==e&&(d.clearStencil(e),c=e)},reset:function(){t=!1,r=null,i=null,n=null,a=null,o=null,s=null,l=null,c=null}}},D=new WeakMap,s=new WeakMap;let t={},r={},l=new WeakMap,H=[],c=null,h=!1,u=null,A=null,p=null,m=null,f=null,g=null,v=null,_=!1,y=null,E=null,T=null,x=null,b=null;const k=d.getParameter(d.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let w=!1,e=0;var C=d.getParameter(d.VERSION);-1!==C.indexOf("WebGL")?(e=parseFloat(/^WebGL (\d)/.exec(C)[1]),w=1<=e):-1!==C.indexOf("OpenGL ES")&&(e=parseFloat(/^OpenGL ES (\d)/.exec(C)[1]),w=2<=e);let S=null,M={};var C=d.getParameter(d.SCISSOR_BOX),V=d.getParameter(d.VIEWPORT);const Q=(new Vector4).fromArray(C),G=(new Vector4).fromArray(V);function B(t,r,i,n){var a=new Uint8Array(4),e=d.createTexture();d.bindTexture(t,e),d.texParameteri(t,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texParameteri(t,d.TEXTURE_MAG_FILTER,d.NEAREST);for(let e=0;e<i;e++)!o||t!==d.TEXTURE_3D&&t!==d.TEXTURE_2D_ARRAY?d.texImage2D(r+e,0,d.RGBA,1,1,0,d.RGBA,d.UNSIGNED_BYTE,a):d.texImage3D(r,0,d.RGBA,1,1,n,0,d.RGBA,d.UNSIGNED_BYTE,a);return e}const N={};function R(e){!0!==t[e]&&(d.enable(e),t[e]=!0)}function L(e){!1!==t[e]&&(d.disable(e),t[e]=!1)}N[d.TEXTURE_2D]=B(d.TEXTURE_2D,d.TEXTURE_2D,1),N[d.TEXTURE_CUBE_MAP]=B(d.TEXTURE_CUBE_MAP,d.TEXTURE_CUBE_MAP_POSITIVE_X,6),o&&(N[d.TEXTURE_2D_ARRAY]=B(d.TEXTURE_2D_ARRAY,d.TEXTURE_2D_ARRAY,1,1),N[d.TEXTURE_3D]=B(d.TEXTURE_3D,d.TEXTURE_3D,1,1)),i.setClear(0,0,0,1),n.setClear(1),a.setClear(0),R(d.DEPTH_TEST),n.setFunc(LessEqualDepth),z(!1),$(CullFaceBack),R(d.CULL_FACE),F(NoBlending);const U={[AddEquation]:d.FUNC_ADD,[SubtractEquation]:d.FUNC_SUBTRACT,[ReverseSubtractEquation]:d.FUNC_REVERSE_SUBTRACT},I=(o?(U[MinEquation]=d.MIN,U[MaxEquation]=d.MAX):null!==(C=P.get("EXT_blend_minmax"))&&(U[MinEquation]=C.MIN_EXT,U[MaxEquation]=C.MAX_EXT),{[ZeroFactor]:d.ZERO,[OneFactor]:d.ONE,[SrcColorFactor]:d.SRC_COLOR,[SrcAlphaFactor]:d.SRC_ALPHA,[SrcAlphaSaturateFactor]:d.SRC_ALPHA_SATURATE,[DstColorFactor]:d.DST_COLOR,[DstAlphaFactor]:d.DST_ALPHA,[OneMinusSrcColorFactor]:d.ONE_MINUS_SRC_COLOR,[OneMinusSrcAlphaFactor]:d.ONE_MINUS_SRC_ALPHA,[OneMinusDstColorFactor]:d.ONE_MINUS_DST_COLOR,[OneMinusDstAlphaFactor]:d.ONE_MINUS_DST_ALPHA});function F(e,t,r,i,n,a,o,s){if(e===NoBlending)!0===h&&(L(d.BLEND),h=!1);else if(!1===h&&(R(d.BLEND),h=!0),e!==CustomBlending){if(e!==u||s!==_){if(A===AddEquation&&f===AddEquation||(d.blendEquation(d.FUNC_ADD),A=AddEquation,f=AddEquation),s)switch(e){case NormalBlending:d.blendFuncSeparate(d.ONE,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:d.blendFunc(d.ONE,d.ONE);break;case SubtractiveBlending:d.blendFuncSeparate(d.ZERO,d.ONE_MINUS_SRC_COLOR,d.ZERO,d.ONE);break;case MultiplyBlending:d.blendFuncSeparate(d.ZERO,d.SRC_COLOR,d.ZERO,d.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case NormalBlending:d.blendFuncSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:d.blendFunc(d.SRC_ALPHA,d.ONE);break;case SubtractiveBlending:d.blendFuncSeparate(d.ZERO,d.ONE_MINUS_SRC_COLOR,d.ZERO,d.ONE);break;case MultiplyBlending:d.blendFunc(d.ZERO,d.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}p=null,m=null,g=null,v=null,u=e,_=s}}else n=n||t,a=a||r,o=o||i,t===A&&n===f||(d.blendEquationSeparate(U[t],U[n]),A=t,f=n),r===p&&i===m&&a===g&&o===v||(d.blendFuncSeparate(I[r],I[i],I[a],I[o]),p=r,m=i,g=a,v=o),u=e,_=!1}function z(e){y!==e&&(e?d.frontFace(d.CW):d.frontFace(d.CCW),y=e)}function $(e){e!==CullFaceNone?(R(d.CULL_FACE),e!==E&&(e===CullFaceBack?d.cullFace(d.BACK):e===CullFaceFront?d.cullFace(d.FRONT):d.cullFace(d.FRONT_AND_BACK))):L(d.CULL_FACE),E=e}function W(e,t,r){e?(R(d.POLYGON_OFFSET_FILL),x===t&&b===r||(d.polygonOffset(t,r),x=t,b=r)):L(d.POLYGON_OFFSET_FILL)}return{buffers:{color:i,depth:n,stencil:a},enable:R,disable:L,bindFramebuffer:function(e,t){return r[e]!==t&&(d.bindFramebuffer(e,t),r[e]=t,o&&(e===d.DRAW_FRAMEBUFFER&&(r[d.FRAMEBUFFER]=t),e===d.FRAMEBUFFER)&&(r[d.DRAW_FRAMEBUFFER]=t),!0)},drawBuffers:function(e,r){let i=H,t=!1;if(e)if(void 0===(i=l.get(r))&&(i=[],l.set(r,i)),e.isWebGLMultipleRenderTargets){r=e.texture;if(i.length!==r.length||i[0]!==d.COLOR_ATTACHMENT0){for(let e=0,t=r.length;e<t;e++)i[e]=d.COLOR_ATTACHMENT0+e;i.length=r.length,t=!0}}else i[0]!==d.COLOR_ATTACHMENT0&&(i[0]=d.COLOR_ATTACHMENT0,t=!0);else i[0]!==d.BACK&&(i[0]=d.BACK,t=!0);t&&(O.isWebGL2?d.drawBuffers(i):P.get("WEBGL_draw_buffers").drawBuffersWEBGL(i))},useProgram:function(e){return c!==e&&(d.useProgram(e),c=e,!0)},setBlending:F,setMaterial:function(e,t){(e.side===DoubleSide?L:R)(d.CULL_FACE);let r=e.side===BackSide;z(r=t?!r:r),e.blending===NormalBlending&&!1===e.transparent?F(NoBlending):F(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),n.setFunc(e.depthFunc),n.setTest(e.depthTest),n.setMask(e.depthWrite),i.setMask(e.colorWrite),t=e.stencilWrite,a.setTest(t),t&&(a.setMask(e.stencilWriteMask),a.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),a.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),W(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),(!0===e.alphaToCoverage?R:L)(d.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:z,setCullFace:$,setLineWidth:function(e){e!==T&&(w&&d.lineWidth(e),T=e)},setPolygonOffset:W,setScissorTest:function(e){(e?R:L)(d.SCISSOR_TEST)},activeTexture:function(e){void 0===e&&(e=d.TEXTURE0+k-1),S!==e&&(d.activeTexture(e),S=e)},bindTexture:function(e,t,r){void 0===r&&(r=null===S?d.TEXTURE0+k-1:S);let i=M[r];void 0===i&&(i={type:void 0,texture:void 0},M[r]=i),i.type===e&&i.texture===t||(S!==r&&(d.activeTexture(r),S=r),d.bindTexture(e,t||N[e]),i.type=e,i.texture=t)},unbindTexture:function(){var e=M[S];void 0!==e&&void 0!==e.type&&(d.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{d.compressedTexImage2D.apply(d,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{d.compressedTexImage3D.apply(d,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{d.texImage2D.apply(d,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{d.texImage3D.apply(d,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(e,t){let r=s.get(t);void 0===r&&(r=new WeakMap,s.set(t,r)),void 0===r.get(e)&&(t=d.getUniformBlockIndex(t,e.name),r.set(e,t))},uniformBlockBinding:function(e,t){var r=s.get(t).get(e);D.get(t)!==r&&(d.uniformBlockBinding(t,r,e.__bindingPointIndex),D.set(t,r))},texStorage2D:function(){try{d.texStorage2D.apply(d,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{d.texStorage3D.apply(d,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{d.texSubImage2D.apply(d,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{d.texSubImage3D.apply(d,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{d.compressedTexSubImage2D.apply(d,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{d.compressedTexSubImage3D.apply(d,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(e){!1===Q.equals(e)&&(d.scissor(e.x,e.y,e.z,e.w),Q.copy(e))},viewport:function(e){!1===G.equals(e)&&(d.viewport(e.x,e.y,e.z,e.w),G.copy(e))},reset:function(){d.disable(d.BLEND),d.disable(d.CULL_FACE),d.disable(d.DEPTH_TEST),d.disable(d.POLYGON_OFFSET_FILL),d.disable(d.SCISSOR_TEST),d.disable(d.STENCIL_TEST),d.disable(d.SAMPLE_ALPHA_TO_COVERAGE),d.blendEquation(d.FUNC_ADD),d.blendFunc(d.ONE,d.ZERO),d.blendFuncSeparate(d.ONE,d.ZERO,d.ONE,d.ZERO),d.colorMask(!0,!0,!0,!0),d.clearColor(0,0,0,0),d.depthMask(!0),d.depthFunc(d.LESS),d.clearDepth(1),d.stencilMask(4294967295),d.stencilFunc(d.ALWAYS,0,4294967295),d.stencilOp(d.KEEP,d.KEEP,d.KEEP),d.clearStencil(0),d.cullFace(d.BACK),d.frontFace(d.CCW),d.polygonOffset(0,0),d.activeTexture(d.TEXTURE0),d.bindFramebuffer(d.FRAMEBUFFER,null),!0===o&&(d.bindFramebuffer(d.DRAW_FRAMEBUFFER,null),d.bindFramebuffer(d.READ_FRAMEBUFFER,null)),d.useProgram(null),d.lineWidth(1),d.scissor(0,0,d.canvas.width,d.canvas.height),d.viewport(0,0,d.canvas.width,d.canvas.height),t={},S=null,M={},r={},l=new WeakMap,H=[],c=null,h=!1,u=null,A=null,p=null,m=null,f=null,g=null,v=null,_=!1,y=null,E=null,T=null,x=null,b=null,Q.set(0,0,d.canvas.width,d.canvas.height),G.set(0,0,d.canvas.width,d.canvas.height),i.reset(),n.reset(),a.reset()}}}function WebGLTextures(_,o,y,E,m,T,f){const x=m.isWebGL2,t=m.maxTextures,O=m.maxCubemapSize,D=m.maxTextureSize,H=m.maxSamples,h=o.has("WEBGL_multisampled_render_to_texture")?o.get("WEBGL_multisampled_render_to_texture"):null,k="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),a=new WeakMap;let s;const l=new WeakMap;let r=!1;try{r="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function c(e,t){return r?new OffscreenCanvas(e,t):createElementNS("canvas")}function b(e,t,r,i){let n=1;return(n=e.width>i||e.height>i?i/Math.max(e.width,e.height):n)<1||!0===t?"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?(t=(i=t?floorPowerOfTwo:Math.floor)(n*e.width),i=i(n*e.height),void 0===s&&(s=c(t,i)),(r=r?c(t,i):s).width=t,r.height=i,r.getContext("2d").drawImage(e,0,0,t,i),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+t+"x"+i+")."),r):("data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e):e}function w(e){return isPowerOfTwo(e.width)&&isPowerOfTwo(e.height)}function C(e,t){return e.generateMipmaps&&t&&e.minFilter!==NearestFilter&&e.minFilter!==LinearFilter}function S(e){_.generateMipmap(e)}function M(e,t,r,i,n=!1){if(!1===x)return t;if(null!==e){if(void 0!==_[e])return _[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let a=t;return t===_.RED&&(r===_.FLOAT&&(a=_.R32F),r===_.HALF_FLOAT&&(a=_.R16F),r===_.UNSIGNED_BYTE)&&(a=_.R8),t===_.RED_INTEGER&&(r===_.UNSIGNED_BYTE&&(a=_.R8UI),r===_.UNSIGNED_SHORT&&(a=_.R16UI),r===_.UNSIGNED_INT&&(a=_.R32UI),r===_.BYTE&&(a=_.R8I),r===_.SHORT&&(a=_.R16I),r===_.INT)&&(a=_.R32I),t===_.RG&&(r===_.FLOAT&&(a=_.RG32F),r===_.HALF_FLOAT&&(a=_.RG16F),r===_.UNSIGNED_BYTE)&&(a=_.RG8),(a=t===_.RGBA&&(r===_.FLOAT&&(a=_.RGBA32F),r===_.HALF_FLOAT&&(a=_.RGBA16F),r===_.UNSIGNED_BYTE&&(a=i===SRGBColorSpace&&!1===n?_.SRGB8_ALPHA8:_.RGBA8),r===_.UNSIGNED_SHORT_4_4_4_4&&(a=_.RGBA4),r===_.UNSIGNED_SHORT_5_5_5_1)?_.RGB5_A1:a)!==_.R16F&&a!==_.R32F&&a!==_.RG16F&&a!==_.RG32F&&a!==_.RGBA16F&&a!==_.RGBA32F||o.get("EXT_color_buffer_float"),a}function B(e,t,r){return!0===C(e,r)||e.isFramebufferTexture&&e.minFilter!==NearestFilter&&e.minFilter!==LinearFilter?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&0<e.mipmaps.length?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function i(e){return e===NearestFilter||e===NearestMipmapNearestFilter||e===NearestMipmapLinearFilter?_.NEAREST:_.LINEAR}function d(e){var t,r,i,n,e=e.target;e.removeEventListener("dispose",d),t=e,void 0!==(r=E.get(t)).__webglInit&&(i=t.source,(n=l.get(i))&&((r=n[r.__cacheKey]).usedTimes--,0===r.usedTimes&&u(t),0===Object.keys(n).length)&&l.delete(i),E.remove(t)),e.isVideoTexture&&a.delete(e)}function g(e){var e=e.target,r=(e.removeEventListener("dispose",g),e.texture),i=E.get(e),t=E.get(r);if(void 0!==t.__webglTexture&&(_.deleteTexture(t.__webglTexture),f.memory.textures--),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(let t=0;t<6;t++){if(Array.isArray(i.__webglFramebuffer[t]))for(let e=0;e<i.__webglFramebuffer[t].length;e++)_.deleteFramebuffer(i.__webglFramebuffer[t][e]);else _.deleteFramebuffer(i.__webglFramebuffer[t]);i.__webglDepthbuffer&&_.deleteRenderbuffer(i.__webglDepthbuffer[t])}else{if(Array.isArray(i.__webglFramebuffer))for(let e=0;e<i.__webglFramebuffer.length;e++)_.deleteFramebuffer(i.__webglFramebuffer[e]);else _.deleteFramebuffer(i.__webglFramebuffer);if(i.__webglDepthbuffer&&_.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&_.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer)for(let e=0;e<i.__webglColorRenderbuffer.length;e++)i.__webglColorRenderbuffer[e]&&_.deleteRenderbuffer(i.__webglColorRenderbuffer[e]);i.__webglDepthRenderbuffer&&_.deleteRenderbuffer(i.__webglDepthRenderbuffer)}if(e.isWebGLMultipleRenderTargets)for(let e=0,t=r.length;e<t;e++){var n=E.get(r[e]);n.__webglTexture&&(_.deleteTexture(n.__webglTexture),f.memory.textures--),E.remove(r[e])}E.remove(r),E.remove(e)}function u(e){var t=E.get(e),e=(_.deleteTexture(t.__webglTexture),e.source);delete l.get(e)[t.__cacheKey],f.memory.textures--}let n=0;function A(e,t){var r,i=E.get(e);if(e.isVideoTexture&&(r=e,n=f.render.frame,a.get(r)!==n)&&(a.set(r,n),r.update()),!1===e.isRenderTargetTexture&&0<e.version&&i.__version!==e.version){var n=e.image;if(null===n)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==n.complete)return void R(i,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}y.bindTexture(_.TEXTURE_2D,i.__webglTexture,_.TEXTURE0+t)}const p={[RepeatWrapping]:_.REPEAT,[ClampToEdgeWrapping]:_.CLAMP_TO_EDGE,[MirroredRepeatWrapping]:_.MIRRORED_REPEAT},v={[NearestFilter]:_.NEAREST,[NearestMipmapNearestFilter]:_.NEAREST_MIPMAP_NEAREST,[NearestMipmapLinearFilter]:_.NEAREST_MIPMAP_LINEAR,[LinearFilter]:_.LINEAR,[LinearMipmapNearestFilter]:_.LINEAR_MIPMAP_NEAREST,[LinearMipmapLinearFilter]:_.LINEAR_MIPMAP_LINEAR},V={[NeverCompare]:_.NEVER,[AlwaysCompare]:_.ALWAYS,[LessCompare]:_.LESS,[LessEqualCompare]:_.LEQUAL,[EqualCompare]:_.EQUAL,[GreaterEqualCompare]:_.GEQUAL,[GreaterCompare]:_.GREATER,[NotEqualCompare]:_.NOTEQUAL};function N(e,t,r){r?(_.texParameteri(e,_.TEXTURE_WRAP_S,p[t.wrapS]),_.texParameteri(e,_.TEXTURE_WRAP_T,p[t.wrapT]),e!==_.TEXTURE_3D&&e!==_.TEXTURE_2D_ARRAY||_.texParameteri(e,_.TEXTURE_WRAP_R,p[t.wrapR]),_.texParameteri(e,_.TEXTURE_MAG_FILTER,v[t.magFilter]),_.texParameteri(e,_.TEXTURE_MIN_FILTER,v[t.minFilter])):(_.texParameteri(e,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(e,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),e!==_.TEXTURE_3D&&e!==_.TEXTURE_2D_ARRAY||_.texParameteri(e,_.TEXTURE_WRAP_R,_.CLAMP_TO_EDGE),t.wrapS===ClampToEdgeWrapping&&t.wrapT===ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),_.texParameteri(e,_.TEXTURE_MAG_FILTER,i(t.magFilter)),_.texParameteri(e,_.TEXTURE_MIN_FILTER,i(t.minFilter)),t.minFilter!==NearestFilter&&t.minFilter!==LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.compareFunction&&(_.texParameteri(e,_.TEXTURE_COMPARE_MODE,_.COMPARE_REF_TO_TEXTURE),_.texParameteri(e,_.TEXTURE_COMPARE_FUNC,V[t.compareFunction])),!0===o.has("EXT_texture_filter_anisotropic")&&(r=o.get("EXT_texture_filter_anisotropic"),t.magFilter===NearestFilter||t.minFilter!==NearestMipmapLinearFilter&&t.minFilter!==LinearMipmapLinearFilter||t.type===FloatType&&!1===o.has("OES_texture_float_linear")||!1===x&&t.type===HalfFloatType&&!1===o.has("OES_texture_half_float_linear")||(1<t.anisotropy||E.get(t).__currentAnisotropy)&&(_.texParameterf(e,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,m.getMaxAnisotropy())),E.get(t).__currentAnisotropy=t.anisotropy))}function Q(e,t){let r=!1;void 0===e.__webglInit&&(e.__webglInit=!0,t.addEventListener("dispose",d));var i=t.source;let n=l.get(i);void 0===n&&(n={},l.set(i,n));(i=[]).push((a=t).wrapS),i.push(a.wrapT),i.push(a.wrapR||0),i.push(a.magFilter),i.push(a.minFilter),i.push(a.anisotropy),i.push(a.internalFormat),i.push(a.format),i.push(a.type),i.push(a.generateMipmaps),i.push(a.premultiplyAlpha),i.push(a.flipY),i.push(a.unpackAlignment),i.push(a.colorSpace);var a=i.join();return a!==e.__cacheKey&&(void 0===n[a]&&(n[a]={texture:_.createTexture(),usedTimes:0},f.memory.textures++,r=!0),n[a].usedTimes++,void 0!==(i=n[e.__cacheKey])&&(n[e.__cacheKey].usedTimes--,0===i.usedTimes)&&u(t),e.__cacheKey=a,e.__webglTexture=n[a].texture),r}function R(e,a,t){let o=_.TEXTURE_2D;(a.isDataArrayTexture||a.isCompressedArrayTexture)&&(o=_.TEXTURE_2D_ARRAY),a.isData3DTexture&&(o=_.TEXTURE_3D);var s=Q(e,a),l=a.source,c=(y.bindTexture(o,e.__webglTexture,_.TEXTURE0+t),E.get(l));if(l.version!==c.__version||!0===s){y.activeTexture(_.TEXTURE0+t),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,a.flipY),_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),_.pixelStorei(_.UNPACK_ALIGNMENT,a.unpackAlignment),_.pixelStorei(_.UNPACK_COLORSPACE_CONVERSION_WEBGL,_.NONE);t=a;var d,t=!x&&(t.wrapS!==ClampToEdgeWrapping||t.wrapT!==ClampToEdgeWrapping||t.minFilter!==NearestFilter&&t.minFilter!==LinearFilter)&&!1===w(a.image),t=w(d=G(a,b(a.image,t,!1,D)))||x,h=T.convert(a.format,a.colorSpace);let i=T.convert(a.type),n=M(a.internalFormat,h,i,a.colorSpace);N(o,a,t);let r;var u=a.mipmaps,A=x&&!0!==a.isVideoTexture,s=void 0===c.__version||!0===s,p=B(a,d,t);if(a.isDepthTexture)n=_.DEPTH_COMPONENT,x?n=a.type===FloatType?_.DEPTH_COMPONENT32F:a.type===UnsignedIntType?_.DEPTH_COMPONENT24:a.type===UnsignedInt248Type?_.DEPTH24_STENCIL8:_.DEPTH_COMPONENT16:a.type===FloatType&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),a.format===DepthFormat&&n===_.DEPTH_COMPONENT&&a.type!==UnsignedShortType&&a.type!==UnsignedIntType&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),a.type=UnsignedIntType,i=T.convert(a.type)),a.format===DepthStencilFormat&&n===_.DEPTH_COMPONENT&&(n=_.DEPTH_STENCIL,a.type!==UnsignedInt248Type)&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),a.type=UnsignedInt248Type,i=T.convert(a.type)),s&&(A?y.texStorage2D(_.TEXTURE_2D,1,n,d.width,d.height):y.texImage2D(_.TEXTURE_2D,0,n,d.width,d.height,0,h,i,null));else if(a.isDataTexture)if(0<u.length&&t){A&&s&&y.texStorage2D(_.TEXTURE_2D,p,n,u[0].width,u[0].height);for(let e=0,t=u.length;e<t;e++)r=u[e],A?y.texSubImage2D(_.TEXTURE_2D,e,0,0,r.width,r.height,h,i,r.data):y.texImage2D(_.TEXTURE_2D,e,n,r.width,r.height,0,h,i,r.data);a.generateMipmaps=!1}else A?(s&&y.texStorage2D(_.TEXTURE_2D,p,n,d.width,d.height),y.texSubImage2D(_.TEXTURE_2D,0,0,0,d.width,d.height,h,i,d.data)):y.texImage2D(_.TEXTURE_2D,0,n,d.width,d.height,0,h,i,d.data);else if(a.isCompressedTexture)if(a.isCompressedArrayTexture){A&&s&&y.texStorage3D(_.TEXTURE_2D_ARRAY,p,n,u[0].width,u[0].height,d.depth);for(let e=0,t=u.length;e<t;e++)r=u[e],a.format!==RGBAFormat?null!==h?A?y.compressedTexSubImage3D(_.TEXTURE_2D_ARRAY,e,0,0,0,r.width,r.height,d.depth,h,r.data,0,0):y.compressedTexImage3D(_.TEXTURE_2D_ARRAY,e,n,r.width,r.height,d.depth,0,r.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):A?y.texSubImage3D(_.TEXTURE_2D_ARRAY,e,0,0,0,r.width,r.height,d.depth,h,i,r.data):y.texImage3D(_.TEXTURE_2D_ARRAY,e,n,r.width,r.height,d.depth,0,h,i,r.data)}else{A&&s&&y.texStorage2D(_.TEXTURE_2D,p,n,u[0].width,u[0].height);for(let e=0,t=u.length;e<t;e++)r=u[e],a.format!==RGBAFormat?null!==h?A?y.compressedTexSubImage2D(_.TEXTURE_2D,e,0,0,r.width,r.height,h,r.data):y.compressedTexImage2D(_.TEXTURE_2D,e,n,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):A?y.texSubImage2D(_.TEXTURE_2D,e,0,0,r.width,r.height,h,i,r.data):y.texImage2D(_.TEXTURE_2D,e,n,r.width,r.height,0,h,i,r.data)}else if(a.isDataArrayTexture)A?(s&&y.texStorage3D(_.TEXTURE_2D_ARRAY,p,n,d.width,d.height,d.depth),y.texSubImage3D(_.TEXTURE_2D_ARRAY,0,0,0,0,d.width,d.height,d.depth,h,i,d.data)):y.texImage3D(_.TEXTURE_2D_ARRAY,0,n,d.width,d.height,d.depth,0,h,i,d.data);else if(a.isData3DTexture)A?(s&&y.texStorage3D(_.TEXTURE_3D,p,n,d.width,d.height,d.depth),y.texSubImage3D(_.TEXTURE_3D,0,0,0,0,d.width,d.height,d.depth,h,i,d.data)):y.texImage3D(_.TEXTURE_3D,0,n,d.width,d.height,d.depth,0,h,i,d.data);else if(a.isFramebufferTexture){if(s)if(A)y.texStorage2D(_.TEXTURE_2D,p,n,d.width,d.height);else{let t=d.width,r=d.height;for(let e=0;e<p;e++)y.texImage2D(_.TEXTURE_2D,e,n,t,r,0,h,i,null),t>>=1,r>>=1}}else if(0<u.length&&t){A&&s&&y.texStorage2D(_.TEXTURE_2D,p,n,u[0].width,u[0].height);for(let e=0,t=u.length;e<t;e++)r=u[e],A?y.texSubImage2D(_.TEXTURE_2D,e,0,0,h,i,r):y.texImage2D(_.TEXTURE_2D,e,n,h,i,r);a.generateMipmaps=!1}else A?(s&&y.texStorage2D(_.TEXTURE_2D,p,n,d.width,d.height),y.texSubImage2D(_.TEXTURE_2D,0,0,0,h,i,d)):y.texImage2D(_.TEXTURE_2D,0,n,h,i,d);C(a,t)&&S(o),c.__version=l.version,a.onUpdate&&a.onUpdate(a)}e.__version=a.version}function L(e,t,r,i,n,a){var o,s,l=T.convert(r.format,r.colorSpace),c=T.convert(r.type),d=M(r.internalFormat,l,c,r.colorSpace);E.get(t).__hasExternalTextures||(o=Math.max(1,t.width>>a),s=Math.max(1,t.height>>a),n===_.TEXTURE_3D||n===_.TEXTURE_2D_ARRAY?y.texImage3D(n,a,d,o,s,t.depth,0,l,c,null):y.texImage2D(n,a,d,o,s,0,l,c,null)),y.bindFramebuffer(_.FRAMEBUFFER,e),P(t)?h.framebufferTexture2DMultisampleEXT(_.FRAMEBUFFER,i,n,E.get(r).__webglTexture,0,F(t)):(n===_.TEXTURE_2D||n>=_.TEXTURE_CUBE_MAP_POSITIVE_X&&n<=_.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&_.framebufferTexture2D(_.FRAMEBUFFER,i,n,E.get(r).__webglTexture,a),y.bindFramebuffer(_.FRAMEBUFFER,null)}function U(t,r,i){if(_.bindRenderbuffer(_.RENDERBUFFER,t),r.depthBuffer&&!r.stencilBuffer){let e=_.DEPTH_COMPONENT16;i||P(r)?((n=r.depthTexture)&&n.isDepthTexture&&(n.type===FloatType?e=_.DEPTH_COMPONENT32F:n.type===UnsignedIntType&&(e=_.DEPTH_COMPONENT24)),n=F(r),P(r)?h.renderbufferStorageMultisampleEXT(_.RENDERBUFFER,n,e,r.width,r.height):_.renderbufferStorageMultisample(_.RENDERBUFFER,n,e,r.width,r.height)):_.renderbufferStorage(_.RENDERBUFFER,e,r.width,r.height),_.framebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_ATTACHMENT,_.RENDERBUFFER,t)}else if(r.depthBuffer&&r.stencilBuffer){var n=F(r);i&&!1===P(r)?_.renderbufferStorageMultisample(_.RENDERBUFFER,n,_.DEPTH24_STENCIL8,r.width,r.height):P(r)?h.renderbufferStorageMultisampleEXT(_.RENDERBUFFER,n,_.DEPTH24_STENCIL8,r.width,r.height):_.renderbufferStorage(_.RENDERBUFFER,_.DEPTH_STENCIL,r.width,r.height),_.framebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_STENCIL_ATTACHMENT,_.RENDERBUFFER,t)}else{var a=!0===r.isWebGLMultipleRenderTargets?r.texture:[r.texture];for(let e=0;e<a.length;e++){var o=a[e],s=T.convert(o.format,o.colorSpace),l=T.convert(o.type),s=M(o.internalFormat,s,l,o.colorSpace),l=F(r);i&&!1===P(r)?_.renderbufferStorageMultisample(_.RENDERBUFFER,l,s,r.width,r.height):P(r)?h.renderbufferStorageMultisampleEXT(_.RENDERBUFFER,l,s,r.width,r.height):_.renderbufferStorage(_.RENDERBUFFER,s,r.width,r.height)}}_.bindRenderbuffer(_.RENDERBUFFER,null)}function I(t){var r=E.get(t),e=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(e)throw new Error("target.depthTexture not supported in Cube render targets");var i=r.__webglFramebuffer,n=t;if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(y.bindFramebuffer(_.FRAMEBUFFER,i),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");E.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),A(n.depthTexture,0);var i=E.get(n.depthTexture).__webglTexture,a=F(n);if(n.depthTexture.format===DepthFormat)P(n)?h.framebufferTexture2DMultisampleEXT(_.FRAMEBUFFER,_.DEPTH_ATTACHMENT,_.TEXTURE_2D,i,0,a):_.framebufferTexture2D(_.FRAMEBUFFER,_.DEPTH_ATTACHMENT,_.TEXTURE_2D,i,0);else{if(n.depthTexture.format!==DepthStencilFormat)throw new Error("Unknown depthTexture format");P(n)?h.framebufferTexture2DMultisampleEXT(_.FRAMEBUFFER,_.DEPTH_STENCIL_ATTACHMENT,_.TEXTURE_2D,i,0,a):_.framebufferTexture2D(_.FRAMEBUFFER,_.DEPTH_STENCIL_ATTACHMENT,_.TEXTURE_2D,i,0)}}else if(e){r.__webglDepthbuffer=[];for(let e=0;e<6;e++)y.bindFramebuffer(_.FRAMEBUFFER,r.__webglFramebuffer[e]),r.__webglDepthbuffer[e]=_.createRenderbuffer(),U(r.__webglDepthbuffer[e],t,!1)}else y.bindFramebuffer(_.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=_.createRenderbuffer(),U(r.__webglDepthbuffer,t,!1);y.bindFramebuffer(_.FRAMEBUFFER,null)}function F(e){return Math.min(H,e.samples)}function P(e){var t=E.get(e);return x&&0<e.samples&&!0===o.has("WEBGL_multisampled_render_to_texture")&&!1!==t.__useRenderToTexture}function G(e,t){var r=e.colorSpace,i=e.format,n=e.type;return!0!==e.isCompressedTexture&&e.format!==_SRGBAFormat&&r!==LinearSRGBColorSpace&&r!==NoColorSpace&&(r===SRGBColorSpace?!1===x?!0===o.has("EXT_sRGB")&&i===RGBAFormat?(e.format=_SRGBAFormat,e.minFilter=LinearFilter,e.generateMipmaps=!1):t=ImageUtils.sRGBToLinear(t):i===RGBAFormat&&n===UnsignedByteType||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",r)),t}this.allocateTextureUnit=function(){var e=n;return e>=t&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+t),n+=1,e},this.resetTextureUnits=function(){n=0},this.setTexture2D=A,this.setTexture2DArray=function(e,t){var r=E.get(e);0<e.version&&r.__version!==e.version?R(r,e,t):y.bindTexture(_.TEXTURE_2D_ARRAY,r.__webglTexture,_.TEXTURE0+t)},this.setTexture3D=function(e,t){var r=E.get(e);0<e.version&&r.__version!==e.version?R(r,e,t):y.bindTexture(_.TEXTURE_3D,r.__webglTexture,_.TEXTURE0+t)},this.setTextureCube=function(t,e){var r=E.get(t);if(0<t.version&&r.__version!==t.version){var i=r,n=t,t=e;if(6===n.image.length){var a=Q(i,n),o=n.source,s=(y.bindTexture(_.TEXTURE_CUBE_MAP,i.__webglTexture,_.TEXTURE0+t),E.get(o));if(o.version!==s.__version||!0===a){y.activeTexture(_.TEXTURE0+t),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,n.flipY),_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),_.pixelStorei(_.UNPACK_ALIGNMENT,n.unpackAlignment),_.pixelStorei(_.UNPACK_COLORSPACE_CONVERSION_WEBGL,_.NONE);var l=n.isCompressedTexture||n.image[0].isCompressedTexture,c=n.image[0]&&n.image[0].isDataTexture,d=[];for(let e=0;e<6;e++)d[e]=l||c?c?n.image[e].image:n.image[e]:b(n.image[e],!1,!0,O),d[e]=G(n,d[e]);var t=d[0],h=w(t)||x,u=T.convert(n.format,n.colorSpace),A=T.convert(n.type),p=M(n.internalFormat,u,A,n.colorSpace),m=x&&!0!==n.isVideoTexture,a=void 0===s.__version||!0===a;let e=B(n,t,h);N(_.TEXTURE_CUBE_MAP,n,h);let r;if(l){m&&a&&y.texStorage2D(_.TEXTURE_CUBE_MAP,e,p,t.width,t.height);for(let t=0;t<6;t++){r=d[t].mipmaps;for(let e=0;e<r.length;e++){var f=r[e];n.format!==RGBAFormat?null!==u?m?y.compressedTexSubImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+t,e,0,0,f.width,f.height,u,f.data):y.compressedTexImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+t,e,p,f.width,f.height,0,f.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):m?y.texSubImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+t,e,0,0,f.width,f.height,u,A,f.data):y.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+t,e,p,f.width,f.height,0,u,A,f.data)}}}else{r=n.mipmaps,m&&a&&(0<r.length&&e++,y.texStorage2D(_.TEXTURE_CUBE_MAP,e,p,d[0].width,d[0].height));for(let t=0;t<6;t++)if(c){m?y.texSubImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,d[t].width,d[t].height,u,A,d[t].data):y.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,p,d[t].width,d[t].height,0,u,A,d[t].data);for(let e=0;e<r.length;e++){var g=r[e].image[t].image;m?y.texSubImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+t,e+1,0,0,g.width,g.height,u,A,g.data):y.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+t,e+1,p,g.width,g.height,0,u,A,g.data)}}else{m?y.texSubImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,u,A,d[t]):y.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,p,u,A,d[t]);for(let e=0;e<r.length;e++){var v=r[e];m?y.texSubImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+t,e+1,0,0,u,A,v.image[t]):y.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+t,e+1,p,u,A,v.image[t])}}}C(n,h)&&S(_.TEXTURE_CUBE_MAP),s.__version=o.version,n.onUpdate&&n.onUpdate(n)}i.__version=n.version}}else y.bindTexture(_.TEXTURE_CUBE_MAP,r.__webglTexture,_.TEXTURE0+e)},this.rebindTextures=function(e,t,r){var i=E.get(e);void 0!==t&&L(i.__webglFramebuffer,e,e.texture,_.COLOR_ATTACHMENT0,_.TEXTURE_2D,0),void 0!==r&&I(e)},this.setupRenderTarget=function(r){const i=r.texture;var n=E.get(r),e=E.get(i),t=(r.addEventListener("dispose",g),!0!==r.isWebGLMultipleRenderTargets&&(void 0===e.__webglTexture&&(e.__webglTexture=_.createTexture()),e.__version=i.version,f.memory.textures++),!0===r.isWebGLCubeRenderTarget),a=!0===r.isWebGLMultipleRenderTargets,o=w(r)||x;if(t){n.__webglFramebuffer=[];for(let t=0;t<6;t++)if(x&&i.mipmaps&&0<i.mipmaps.length){n.__webglFramebuffer[t]=[];for(let e=0;e<i.mipmaps.length;e++)n.__webglFramebuffer[t][e]=_.createFramebuffer()}else n.__webglFramebuffer[t]=_.createFramebuffer()}else{if(x&&i.mipmaps&&0<i.mipmaps.length){n.__webglFramebuffer=[];for(let e=0;e<i.mipmaps.length;e++)n.__webglFramebuffer[e]=_.createFramebuffer()}else n.__webglFramebuffer=_.createFramebuffer();if(a)if(m.drawBuffers){var s=r.texture;for(let e=0,t=s.length;e<t;e++){var l=E.get(s[e]);void 0===l.__webglTexture&&(l.__webglTexture=_.createTexture(),f.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(x&&0<r.samples&&!1===P(r)){var c=a?i:[i];n.__webglMultisampledFramebuffer=_.createFramebuffer(),n.__webglColorRenderbuffer=[],y.bindFramebuffer(_.FRAMEBUFFER,n.__webglMultisampledFramebuffer);for(let e=0;e<c.length;e++){const i=c[e];n.__webglColorRenderbuffer[e]=_.createRenderbuffer(),_.bindRenderbuffer(_.RENDERBUFFER,n.__webglColorRenderbuffer[e]);var d=T.convert(i.format,i.colorSpace),h=T.convert(i.type),d=M(i.internalFormat,d,h,i.colorSpace,!0===r.isXRRenderTarget),h=F(r);_.renderbufferStorageMultisample(_.RENDERBUFFER,h,d,r.width,r.height),_.framebufferRenderbuffer(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0+e,_.RENDERBUFFER,n.__webglColorRenderbuffer[e])}_.bindRenderbuffer(_.RENDERBUFFER,null),r.depthBuffer&&(n.__webglDepthRenderbuffer=_.createRenderbuffer(),U(n.__webglDepthRenderbuffer,r,!0)),y.bindFramebuffer(_.FRAMEBUFFER,null)}}if(t){y.bindTexture(_.TEXTURE_CUBE_MAP,e.__webglTexture),N(_.TEXTURE_CUBE_MAP,i,o);for(let t=0;t<6;t++)if(x&&i.mipmaps&&0<i.mipmaps.length)for(let e=0;e<i.mipmaps.length;e++)L(n.__webglFramebuffer[t][e],r,i,_.COLOR_ATTACHMENT0,_.TEXTURE_CUBE_MAP_POSITIVE_X+t,e);else L(n.__webglFramebuffer[t],r,i,_.COLOR_ATTACHMENT0,_.TEXTURE_CUBE_MAP_POSITIVE_X+t,0);C(i,o)&&S(_.TEXTURE_CUBE_MAP)}else if(a){var u=r.texture;for(let e=0,t=u.length;e<t;e++){var A=u[e],p=E.get(A);y.bindTexture(_.TEXTURE_2D,p.__webglTexture),N(_.TEXTURE_2D,A,o),L(n.__webglFramebuffer,r,A,_.COLOR_ATTACHMENT0+e,_.TEXTURE_2D,0),C(A,o)&&S(_.TEXTURE_2D)}}else{let t=_.TEXTURE_2D;if((r.isWebGL3DRenderTarget||r.isWebGLArrayRenderTarget)&&(x?t=r.isWebGL3DRenderTarget?_.TEXTURE_3D:_.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),y.bindTexture(t,e.__webglTexture),N(t,i,o),x&&i.mipmaps&&0<i.mipmaps.length)for(let e=0;e<i.mipmaps.length;e++)L(n.__webglFramebuffer[e],r,i,_.COLOR_ATTACHMENT0,t,e);else L(n.__webglFramebuffer,r,i,_.COLOR_ATTACHMENT0,t,0);C(i,o)&&S(t)}y.unbindTexture(),r.depthBuffer&&I(r)},this.updateRenderTargetMipmap=function(r){var i=w(r)||x,n=!0===r.isWebGLMultipleRenderTargets?r.texture:[r.texture];for(let e=0,t=n.length;e<t;e++){var a,o=n[e];C(o,i)&&(a=r.isWebGLCubeRenderTarget?_.TEXTURE_CUBE_MAP:_.TEXTURE_2D,o=E.get(o).__webglTexture,y.bindTexture(a,o),S(a),y.unbindTexture())}},this.updateMultisampleRenderTarget=function(r){if(x&&0<r.samples&&!1===P(r)){var i=r.isWebGLMultipleRenderTargets?r.texture:[r.texture],n=r.width,a=r.height;let t=_.COLOR_BUFFER_BIT;var o=[],s=r.stencilBuffer?_.DEPTH_STENCIL_ATTACHMENT:_.DEPTH_ATTACHMENT,l=E.get(r),c=!0===r.isWebGLMultipleRenderTargets;if(c)for(let e=0;e<i.length;e++)y.bindFramebuffer(_.FRAMEBUFFER,l.__webglMultisampledFramebuffer),_.framebufferRenderbuffer(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0+e,_.RENDERBUFFER,null),y.bindFramebuffer(_.FRAMEBUFFER,l.__webglFramebuffer),_.framebufferTexture2D(_.DRAW_FRAMEBUFFER,_.COLOR_ATTACHMENT0+e,_.TEXTURE_2D,null,0);y.bindFramebuffer(_.READ_FRAMEBUFFER,l.__webglMultisampledFramebuffer),y.bindFramebuffer(_.DRAW_FRAMEBUFFER,l.__webglFramebuffer);for(let e=0;e<i.length;e++){o.push(_.COLOR_ATTACHMENT0+e),r.depthBuffer&&o.push(s);var d=void 0!==l.__ignoreDepthValues&&l.__ignoreDepthValues;!1===d&&(r.depthBuffer&&(t|=_.DEPTH_BUFFER_BIT),r.stencilBuffer)&&(t|=_.STENCIL_BUFFER_BIT),c&&_.framebufferRenderbuffer(_.READ_FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.RENDERBUFFER,l.__webglColorRenderbuffer[e]),!0===d&&(_.invalidateFramebuffer(_.READ_FRAMEBUFFER,[s]),_.invalidateFramebuffer(_.DRAW_FRAMEBUFFER,[s])),c&&(d=E.get(i[e]).__webglTexture,_.framebufferTexture2D(_.DRAW_FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_2D,d,0)),_.blitFramebuffer(0,0,n,a,0,0,n,a,t,_.NEAREST),k&&_.invalidateFramebuffer(_.READ_FRAMEBUFFER,o)}if(y.bindFramebuffer(_.READ_FRAMEBUFFER,null),y.bindFramebuffer(_.DRAW_FRAMEBUFFER,null),c)for(let e=0;e<i.length;e++){y.bindFramebuffer(_.FRAMEBUFFER,l.__webglMultisampledFramebuffer),_.framebufferRenderbuffer(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0+e,_.RENDERBUFFER,l.__webglColorRenderbuffer[e]);var h=E.get(i[e]).__webglTexture;y.bindFramebuffer(_.FRAMEBUFFER,l.__webglFramebuffer),_.framebufferTexture2D(_.DRAW_FRAMEBUFFER,_.COLOR_ATTACHMENT0+e,_.TEXTURE_2D,h,0)}y.bindFramebuffer(_.DRAW_FRAMEBUFFER,l.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=I,this.setupFrameBufferTexture=L,this.useMultisampledRTT=P}function WebGLUtils(i,n,e){const a=e.isWebGL2;return{convert:function(e,t=NoColorSpace){let r;if(e===UnsignedByteType)return i.UNSIGNED_BYTE;if(e===UnsignedShort4444Type)return i.UNSIGNED_SHORT_4_4_4_4;if(e===UnsignedShort5551Type)return i.UNSIGNED_SHORT_5_5_5_1;if(e===ByteType)return i.BYTE;if(e===ShortType)return i.SHORT;if(e===UnsignedShortType)return i.UNSIGNED_SHORT;if(e===IntType)return i.INT;if(e===UnsignedIntType)return i.UNSIGNED_INT;if(e===FloatType)return i.FLOAT;if(e===HalfFloatType)return a?i.HALF_FLOAT:null!==(r=n.get("OES_texture_half_float"))?r.HALF_FLOAT_OES:null;if(e===AlphaFormat)return i.ALPHA;if(e===RGBAFormat)return i.RGBA;if(e===LuminanceFormat)return i.LUMINANCE;if(e===LuminanceAlphaFormat)return i.LUMINANCE_ALPHA;if(e===DepthFormat)return i.DEPTH_COMPONENT;if(e===DepthStencilFormat)return i.DEPTH_STENCIL;if(e===_SRGBAFormat)return null!==(r=n.get("EXT_sRGB"))?r.SRGB_ALPHA_EXT:null;if(e===RedFormat)return i.RED;if(e===RedIntegerFormat)return i.RED_INTEGER;if(e===RGFormat)return i.RG;if(e===RGIntegerFormat)return i.RG_INTEGER;if(e===RGBAIntegerFormat)return i.RGBA_INTEGER;if(e===RGB_S3TC_DXT1_Format||e===RGBA_S3TC_DXT1_Format||e===RGBA_S3TC_DXT3_Format||e===RGBA_S3TC_DXT5_Format)if(t===SRGBColorSpace){if(null===(r=n.get("WEBGL_compressed_texture_s3tc_srgb")))return null;if(e===RGB_S3TC_DXT1_Format)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===RGBA_S3TC_DXT1_Format)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===RGBA_S3TC_DXT3_Format)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===RGBA_S3TC_DXT5_Format)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(r=n.get("WEBGL_compressed_texture_s3tc")))return null;if(e===RGB_S3TC_DXT1_Format)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===RGBA_S3TC_DXT1_Format)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===RGBA_S3TC_DXT3_Format)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===RGBA_S3TC_DXT5_Format)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===RGB_PVRTC_4BPPV1_Format||e===RGB_PVRTC_2BPPV1_Format||e===RGBA_PVRTC_4BPPV1_Format||e===RGBA_PVRTC_2BPPV1_Format){if(null===(r=n.get("WEBGL_compressed_texture_pvrtc")))return null;if(e===RGB_PVRTC_4BPPV1_Format)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===RGB_PVRTC_2BPPV1_Format)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===RGBA_PVRTC_4BPPV1_Format)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===RGBA_PVRTC_2BPPV1_Format)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===RGB_ETC1_Format)return null!==(r=n.get("WEBGL_compressed_texture_etc1"))?r.COMPRESSED_RGB_ETC1_WEBGL:null;if(e===RGB_ETC2_Format||e===RGBA_ETC2_EAC_Format){if(null===(r=n.get("WEBGL_compressed_texture_etc")))return null;if(e===RGB_ETC2_Format)return t===SRGBColorSpace?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(e===RGBA_ETC2_EAC_Format)return t===SRGBColorSpace?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(e===RGBA_ASTC_4x4_Format||e===RGBA_ASTC_5x4_Format||e===RGBA_ASTC_5x5_Format||e===RGBA_ASTC_6x5_Format||e===RGBA_ASTC_6x6_Format||e===RGBA_ASTC_8x5_Format||e===RGBA_ASTC_8x6_Format||e===RGBA_ASTC_8x8_Format||e===RGBA_ASTC_10x5_Format||e===RGBA_ASTC_10x6_Format||e===RGBA_ASTC_10x8_Format||e===RGBA_ASTC_10x10_Format||e===RGBA_ASTC_12x10_Format||e===RGBA_ASTC_12x12_Format){if(null===(r=n.get("WEBGL_compressed_texture_astc")))return null;if(e===RGBA_ASTC_4x4_Format)return t===SRGBColorSpace?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===RGBA_ASTC_5x4_Format)return t===SRGBColorSpace?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===RGBA_ASTC_5x5_Format)return t===SRGBColorSpace?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===RGBA_ASTC_6x5_Format)return t===SRGBColorSpace?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===RGBA_ASTC_6x6_Format)return t===SRGBColorSpace?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===RGBA_ASTC_8x5_Format)return t===SRGBColorSpace?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===RGBA_ASTC_8x6_Format)return t===SRGBColorSpace?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===RGBA_ASTC_8x8_Format)return t===SRGBColorSpace?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===RGBA_ASTC_10x5_Format)return t===SRGBColorSpace?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===RGBA_ASTC_10x6_Format)return t===SRGBColorSpace?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===RGBA_ASTC_10x8_Format)return t===SRGBColorSpace?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===RGBA_ASTC_10x10_Format)return t===SRGBColorSpace?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===RGBA_ASTC_12x10_Format)return t===SRGBColorSpace?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===RGBA_ASTC_12x12_Format)return t===SRGBColorSpace?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(e===RGBA_BPTC_Format){if(null===(r=n.get("EXT_texture_compression_bptc")))return null;if(e===RGBA_BPTC_Format)return t===SRGBColorSpace?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(e===RED_RGTC1_Format||e===SIGNED_RED_RGTC1_Format||e===RED_GREEN_RGTC2_Format||e===SIGNED_RED_GREEN_RGTC2_Format){if(null===(r=n.get("EXT_texture_compression_rgtc")))return null;if(e===RGBA_BPTC_Format)return r.COMPRESSED_RED_RGTC1_EXT;if(e===SIGNED_RED_RGTC1_Format)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===RED_GREEN_RGTC2_Format)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===SIGNED_RED_GREEN_RGTC2_Format)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return e===UnsignedInt248Type?a?i.UNSIGNED_INT_24_8:null!==(r=n.get("WEBGL_depth_texture"))?r.UNSIGNED_INT_24_8_WEBGL:null:void 0!==i[e]?i[e]:null}}}class ArrayCamera extends PerspectiveCamera{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Group extends Object3D{constructor(){super(),this.isGroup=!0,this.type="Group"}}const _moveEvent={type:"move"};class WebXRController{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vector3,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vector3),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vector3,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vector3),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){var t=this._hand;if(t)for(const r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,r){let i=null,n=null,a=null;var o=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){a=!0;for(const A of e.hand.values()){var c=t.getJointPose(A,r),d=this._getHandJoint(l,A);null!==c&&(d.matrix.fromArray(c.transform.matrix),d.matrix.decompose(d.position,d.rotation,d.scale),d.matrixWorldNeedsUpdate=!0,d.jointRadius=c.radius),d.visible=null!==c}var h=l.joints["index-finger-tip"],u=l.joints["thumb-tip"],h=h.position.distanceTo(u.position);l.inputState.pinching&&.025<h?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&h<=.015&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&null!==(n=t.getPose(e.gripSpace,r))&&(s.matrix.fromArray(n.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,n.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(n.linearVelocity)):s.hasLinearVelocity=!1,n.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(n.angularVelocity)):s.hasAngularVelocity=!1);null!==o&&null!==(i=null===(i=t.getPose(e.targetRaySpace,r))&&null!==n?n:i)&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(_moveEvent))}return null!==o&&(o.visible=null!==i),null!==s&&(s.visible=null!==n),null!==l&&(l.visible=null!==a),this}_getHandJoint(e,t){var r;return void 0===e.joints[t.jointName]&&((r=new Group).matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)),e.joints[t.jointName]}}class DepthTexture extends Texture{constructor(e,t,r,i,n,a,o,s,l,c){if((c=void 0!==c?c:DepthFormat)!==DepthFormat&&c!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super(null,i,n,a,o,s,c,r=void 0===(r=void 0===r&&c===DepthFormat?UnsignedIntType:r)&&c===DepthStencilFormat?UnsignedInt248Type:r,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==o?o:NearestFilter,this.minFilter=void 0!==s?s:NearestFilter,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){e=super.toJSON(e);return null!==this.compareFunction&&(e.compareFunction=this.compareFunction),e}}class WebXRManager extends EventDispatcher{constructor(s,n){super();const l=this;let m=null,a=1,c=null,t="local-floor",r=1,d=null,h=null,u=null,A=null,p=null,f=null;const o=n.getContextAttributes();let e=null,g=null;const v=[],_=[],y=new PerspectiveCamera,E=(y.layers.enable(1),y.viewport=new Vector4,new PerspectiveCamera),T=(E.layers.enable(2),E.viewport=new Vector4,[y,E]),x=new ArrayCamera;x.layers.enable(1),x.layers.enable(2);let b=null,w=null;function C(e){var t=_.indexOf(e.inputSource);-1!==t&&void 0!==(t=v[t])&&(t.update(e.inputSource,e.frame,d||c),t.dispatchEvent({type:e.type,data:e.inputSource}))}function S(){m.removeEventListener("select",C),m.removeEventListener("selectstart",C),m.removeEventListener("selectend",C),m.removeEventListener("squeeze",C),m.removeEventListener("squeezestart",C),m.removeEventListener("squeezeend",C),m.removeEventListener("end",S),m.removeEventListener("inputsourceschange",M);for(let e=0;e<v.length;e++){var t=_[e];null!==t&&(_[e]=null,v[e].disconnect(t))}b=null,w=null,s.setRenderTarget(e),p=null,A=null,u=null,m=null,g=null,U.stop(),l.isPresenting=!1,l.dispatchEvent({type:"sessionend"})}function M(r){for(let e=0;e<r.removed.length;e++){var t=r.removed[e],i=_.indexOf(t);0<=i&&(_[i]=null,v[i].disconnect(t))}for(let e=0;e<r.added.length;e++){var n=r.added[e];let t=_.indexOf(n);if(-1===t){for(let e=0;e<v.length;e++){if(e>=_.length){_.push(n),t=e;break}if(null===_[e]){_[e]=n,t=e;break}}if(-1===t)break}var a=v[t];a&&a.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=v[e];return void 0===t&&(t=new WebXRController,v[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=v[e];return void 0===t&&(t=new WebXRController,v[e]=t),t.getGripSpace()},this.getHand=function(e){let t=v[e];return void 0===t&&(t=new WebXRController,v[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){a=e,!0===l.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){t=e,!0===l.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return d||c},this.setReferenceSpace=function(e){d=e},this.getBaseLayer=function(){return null!==A?A:p},this.getBinding=function(){return u},this.getFrame=function(){return f},this.getSession=function(){return m},this.setSession=async function(i){if(null!==(m=i)){if(e=s.getRenderTarget(),m.addEventListener("select",C),m.addEventListener("selectstart",C),m.addEventListener("selectend",C),m.addEventListener("squeeze",C),m.addEventListener("squeezestart",C),m.addEventListener("squeezeend",C),m.addEventListener("end",S),m.addEventListener("inputsourceschange",M),!0!==o.xrCompatible&&await n.makeXRCompatible(),void 0===m.renderState.layers||!1===s.capabilities.isWebGL2){i={antialias:void 0!==m.renderState.layers||o.antialias,alpha:!0,depth:o.depth,stencil:o.stencil,framebufferScaleFactor:a};p=new XRWebGLLayer(m,n,i),m.updateRenderState({baseLayer:p}),g=new WebGLRenderTarget(p.framebufferWidth,p.framebufferHeight,{format:RGBAFormat,type:UnsignedByteType,colorSpace:s.outputColorSpace,stencilBuffer:o.stencil})}else{let e=null,t=null,r=null;o.depth&&(r=o.stencil?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT24,e=o.stencil?DepthStencilFormat:DepthFormat,t=o.stencil?UnsignedInt248Type:UnsignedIntType);i={colorFormat:n.RGBA8,depthFormat:r,scaleFactor:a};u=new XRWebGLBinding(m,n),A=u.createProjectionLayer(i),m.updateRenderState({layers:[A]}),g=new WebGLRenderTarget(A.textureWidth,A.textureHeight,{format:RGBAFormat,type:UnsignedByteType,depthTexture:new DepthTexture(A.textureWidth,A.textureHeight,t,void 0,void 0,void 0,void 0,void 0,void 0,e),stencilBuffer:o.stencil,colorSpace:s.outputColorSpace,samples:o.antialias?4:0}),s.properties.get(g).__ignoreDepthValues=A.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(r),d=null,c=await m.requestReferenceSpace(t),U.setContext(m),U.start(),l.isPresenting=!0,l.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==m)return m.environmentBlendMode};const B=new Vector3,N=new Vector3;function R(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null!==m){x.near=E.near=y.near=e.near,x.far=E.far=y.far=e.far,b===x.near&&w===x.far||(m.updateRenderState({depthNear:x.near,depthFar:x.far}),b=x.near,w=x.far);var t,r,i,n,a,o,s,l,c=e.parent,d=x.cameras;R(x,c);for(let e=0;e<d.length;e++)R(d[e],c);2===d.length?(t=x,r=y,h=E,B.setFromMatrixPosition(r.matrixWorld),N.setFromMatrixPosition(h.matrixWorld),A=B.distanceTo(N),i=r.projectionMatrix.elements,h=h.projectionMatrix.elements,n=i[14]/(i[10]-1),a=i[14]/(i[10]+1),o=(i[9]+1)/i[5],s=(i[9]-1)/i[5],i=(i[8]-1)/i[0],h=(h[8]+1)/h[0],u=n*i,l=n*h,i=(h=A/(h-i))*-i,r.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(i),t.translateZ(h),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert(),r=n+h,n=a+h,t.projectionMatrix.makePerspective(u-i,A-i+l,o*a/n*r,s*a/n*r,r,n),t.projectionMatrixInverse.copy(t.projectionMatrix).invert()):x.projectionMatrix.copy(y.projectionMatrix);var h=e,u=x,A=c,p=(null===A?h.matrix.copy(u.matrixWorld):(h.matrix.copy(A.matrixWorld),h.matrix.invert(),h.matrix.multiply(u.matrixWorld)),h.matrix.decompose(h.position,h.quaternion,h.scale),h.updateMatrixWorld(!0),h.children);for(let e=0,t=p.length;e<t;e++)p[e].updateMatrixWorld(!0);h.projectionMatrix.copy(u.projectionMatrix),h.projectionMatrixInverse.copy(u.projectionMatrixInverse),h.isPerspectiveCamera&&(h.fov=2*RAD2DEG*Math.atan(1/h.projectionMatrix.elements[5]),h.zoom=1)}},this.getCamera=function(){return x},this.getFoveation=function(){if(null!==A||null!==p)return r},this.setFoveation=function(e){r=e,null!==A&&(A.fixedFoveation=e),null!==p&&void 0!==p.fixedFoveation&&(p.fixedFoveation=e)};let L=null;const U=new WebGLAnimation;U.setAnimationLoop(function(e,t){if(h=t.getViewerPose(d||c),f=t,null!==h){var n=h.views;null!==p&&(s.setRenderTargetFramebuffer(g,p.framebuffer),s.setRenderTarget(g));let i=!1;n.length!==x.cameras.length&&(x.cameras.length=0,i=!0);for(let r=0;r<n.length;r++){var a,o=n[r];let e=null,t=(null!==p?e=p.getViewport(o):(a=u.getViewSubImage(A,o),e=a.viewport,0===r&&(s.setRenderTargetTextures(g,a.colorTexture,A.ignoreDepthValues?void 0:a.depthStencilTexture),s.setRenderTarget(g))),T[r]);void 0===t&&((t=new PerspectiveCamera).layers.enable(r),t.viewport=new Vector4,T[r]=t),t.matrix.fromArray(o.transform.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale),t.projectionMatrix.fromArray(o.projectionMatrix),t.projectionMatrixInverse.copy(t.projectionMatrix).invert(),t.viewport.set(e.x,e.y,e.width,e.height),0===r&&(x.matrix.copy(t.matrix),x.matrix.decompose(x.position,x.quaternion,x.scale)),!0===i&&x.cameras.push(t)}}for(let e=0;e<v.length;e++){var r=_[e],i=v[e];null!==r&&void 0!==i&&i.update(r,t,d||c)}L&&L(e,t),t.detectedPlanes&&l.dispatchEvent({type:"planesdetected",data:t}),f=null}),this.setAnimationLoop=function(e){L=e},this.dispose=function(){}}}function WebGLMaterials(i,h){function u(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function A(e,t){e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map,u(t.map,e.mapTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,u(t.alphaMap,e.alphaMapTransform)),t.bumpMap&&(e.bumpMap.value=t.bumpMap,u(t.bumpMap,e.bumpMapTransform),e.bumpScale.value=t.bumpScale,t.side===BackSide)&&(e.bumpScale.value*=-1),t.normalMap&&(e.normalMap.value=t.normalMap,u(t.normalMap,e.normalMapTransform),e.normalScale.value.copy(t.normalScale),t.side===BackSide)&&e.normalScale.value.negate(),t.displacementMap&&(e.displacementMap.value=t.displacementMap,u(t.displacementMap,e.displacementMapTransform),e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap,u(t.emissiveMap,e.emissiveMapTransform)),t.specularMap&&(e.specularMap.value=t.specularMap,u(t.specularMap,e.specularMapTransform)),0<t.alphaTest&&(e.alphaTest.value=t.alphaTest);var r=h.get(t).envMap;r&&(e.envMap.value=r,e.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,e.reflectivity.value=t.reflectivity,e.ior.value=t.ior,e.refractionRatio.value=t.refractionRatio),t.lightMap&&(e.lightMap.value=t.lightMap,r=!0===i._useLegacyLights?Math.PI:1,e.lightMapIntensity.value=t.lightMapIntensity*r,u(t.lightMap,e.lightMapTransform)),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity,u(t.aoMap,e.aoMapTransform))}return{refreshFogUniforms:function(e,t){t.color.getRGB(e.fogColor.value,getUnlitUniformColorSpace(i)),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,t,r,i,n){var a,o,s,l,c,d;t.isMeshBasicMaterial||t.isMeshLambertMaterial?A(e,t):t.isMeshToonMaterial?(A(e,t),c=e,(d=t).gradientMap&&(c.gradientMap.value=d.gradientMap)):t.isMeshPhongMaterial?(A(e,t),c=t,(d=e).specular.value.copy(c.specular),d.shininess.value=Math.max(c.shininess,1e-4)):t.isMeshStandardMaterial?(A(e,t),s=t,(l=e).metalness.value=s.metalness,s.metalnessMap&&(l.metalnessMap.value=s.metalnessMap,u(s.metalnessMap,l.metalnessMapTransform)),l.roughness.value=s.roughness,s.roughnessMap&&(l.roughnessMap.value=s.roughnessMap,u(s.roughnessMap,l.roughnessMapTransform)),h.get(s).envMap&&(l.envMapIntensity.value=s.envMapIntensity),t.isMeshPhysicalMaterial&&(l=t,s=n,(n=e).ior.value=l.ior,0<l.sheen&&(n.sheenColor.value.copy(l.sheenColor).multiplyScalar(l.sheen),n.sheenRoughness.value=l.sheenRoughness,l.sheenColorMap&&(n.sheenColorMap.value=l.sheenColorMap,u(l.sheenColorMap,n.sheenColorMapTransform)),l.sheenRoughnessMap)&&(n.sheenRoughnessMap.value=l.sheenRoughnessMap,u(l.sheenRoughnessMap,n.sheenRoughnessMapTransform)),0<l.clearcoat&&(n.clearcoat.value=l.clearcoat,n.clearcoatRoughness.value=l.clearcoatRoughness,l.clearcoatMap&&(n.clearcoatMap.value=l.clearcoatMap,u(l.clearcoatMap,n.clearcoatMapTransform)),l.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap.value=l.clearcoatRoughnessMap,u(l.clearcoatRoughnessMap,n.clearcoatRoughnessMapTransform)),l.clearcoatNormalMap)&&(n.clearcoatNormalMap.value=l.clearcoatNormalMap,u(l.clearcoatNormalMap,n.clearcoatNormalMapTransform),n.clearcoatNormalScale.value.copy(l.clearcoatNormalScale),l.side===BackSide)&&n.clearcoatNormalScale.value.negate(),0<l.iridescence&&(n.iridescence.value=l.iridescence,n.iridescenceIOR.value=l.iridescenceIOR,n.iridescenceThicknessMinimum.value=l.iridescenceThicknessRange[0],n.iridescenceThicknessMaximum.value=l.iridescenceThicknessRange[1],l.iridescenceMap&&(n.iridescenceMap.value=l.iridescenceMap,u(l.iridescenceMap,n.iridescenceMapTransform)),l.iridescenceThicknessMap)&&(n.iridescenceThicknessMap.value=l.iridescenceThicknessMap,u(l.iridescenceThicknessMap,n.iridescenceThicknessMapTransform)),0<l.transmission&&(n.transmission.value=l.transmission,n.transmissionSamplerMap.value=s.texture,n.transmissionSamplerSize.value.set(s.width,s.height),l.transmissionMap&&(n.transmissionMap.value=l.transmissionMap,u(l.transmissionMap,n.transmissionMapTransform)),n.thickness.value=l.thickness,l.thicknessMap&&(n.thicknessMap.value=l.thicknessMap,u(l.thicknessMap,n.thicknessMapTransform)),n.attenuationDistance.value=l.attenuationDistance,n.attenuationColor.value.copy(l.attenuationColor)),0<l.anisotropy&&(n.anisotropyVector.value.set(l.anisotropy*Math.cos(l.anisotropyRotation),l.anisotropy*Math.sin(l.anisotropyRotation)),l.anisotropyMap)&&(n.anisotropyMap.value=l.anisotropyMap,u(l.anisotropyMap,n.anisotropyMapTransform)),n.specularIntensity.value=l.specularIntensity,n.specularColor.value.copy(l.specularColor),l.specularColorMap&&(n.specularColorMap.value=l.specularColorMap,u(l.specularColorMap,n.specularColorMapTransform)),l.specularIntensityMap)&&(n.specularIntensityMap.value=l.specularIntensityMap,u(l.specularIntensityMap,n.specularIntensityMapTransform))):t.isMeshMatcapMaterial?(A(e,t),s=e,(l=t).matcap&&(s.matcap.value=l.matcap)):t.isMeshDepthMaterial?A(e,t):t.isMeshDistanceMaterial?(A(e,t),n=e,o=t,o=h.get(o).light,n.referencePosition.value.setFromMatrixPosition(o.matrixWorld),n.nearDistance.value=o.shadow.camera.near,n.farDistance.value=o.shadow.camera.far):t.isMeshNormalMaterial?A(e,t):t.isLineBasicMaterial?(n=t,(o=e).diffuse.value.copy(n.color),o.opacity.value=n.opacity,n.map&&(o.map.value=n.map,u(n.map,o.mapTransform)),t.isLineDashedMaterial&&(n=t,(a=e).dashSize.value=n.dashSize,a.totalSize.value=n.dashSize+n.gapSize,a.scale.value=n.scale)):t.isPointsMaterial?(a=t,n=r,r=i,(i=e).diffuse.value.copy(a.color),i.opacity.value=a.opacity,i.size.value=a.size*n,i.scale.value=.5*r,a.map&&(i.map.value=a.map,u(a.map,i.uvTransform)),a.alphaMap&&(i.alphaMap.value=a.alphaMap,u(a.alphaMap,i.alphaMapTransform)),0<a.alphaTest&&(i.alphaTest.value=a.alphaTest)):t.isSpriteMaterial?(n=t,(r=e).diffuse.value.copy(n.color),r.opacity.value=n.opacity,r.rotation.value=n.rotation,n.map&&(r.map.value=n.map,u(n.map,r.mapTransform)),n.alphaMap&&(r.alphaMap.value=n.alphaMap,u(n.alphaMap,r.alphaMapTransform)),0<n.alphaTest&&(r.alphaTest.value=n.alphaTest)):t.isShadowMaterial?(e.color.value.copy(t.color),e.opacity.value=t.opacity):t.isShaderMaterial&&(t.uniformsNeedUpdate=!1)}}}function WebGLUniformsGroups(y,E,e,T){let x={},b={},w=[];const C=e.isWebGL2?y.getParameter(y.MAX_UNIFORM_BUFFER_BINDINGS):0;function S(e){var t={boundary:0,storage:0};return"number"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function M(e){var e=e.target,t=(e.removeEventListener("dispose",M),w.indexOf(e.__bindingPointIndex));w.splice(t,1),y.deleteBuffer(x[e.id]),delete x[e.id],delete b[e.id]}return{bind:function(e,t){t=t.program,T.uniformBlockBinding(e,t)},update:function(e,t){var r;if(void 0===(r=x[e.id])){{var n=e;var a=n.uniforms;let r=0;let i=0;for(let e=0,t=a.length;e<t;e++){var o,s=a[e],l={boundary:0,storage:0},c=Array.isArray(s.value)?s.value:[s.value];for(let e=0,t=c.length;e<t;e++){var d=S(c[e]);l.boundary+=d.boundary,l.storage+=d.storage}s.__data=new Float32Array(l.storage/Float32Array.BYTES_PER_ELEMENT),s.__offset=r,0<e&&(o=16-(i=r%16),0!==i)&&o-l.boundary<0&&(r+=16-i,s.__offset=r),r+=l.storage}0<(i=r%16)&&(r+=16-i);n.__size=r,n.__cache={}}n=e,h=function(){for(let e=0;e<C;e++)if(-1===w.indexOf(e))return w.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}(),n.__bindingPointIndex=h,u=y.createBuffer(),i=n.__size,n=n.usage,y.bindBuffer(y.UNIFORM_BUFFER,u),y.bufferData(y.UNIFORM_BUFFER,i,n),y.bindBuffer(y.UNIFORM_BUFFER,null),y.bindBufferBase(y.UNIFORM_BUFFER,h,u),r=u,x[e.id]=r,e.addEventListener("dispose",M)}var i=t.program,n=(T.updateUBOMapping(e,i),E.render.frame);if(b[e.id]!==n){var h=e,u=x[h.id],A=h.uniforms,p=h.__cache;y.bindBuffer(y.UNIFORM_BUFFER,u);for(let e=0,t=A.length;e<t;e++){var m=A[e];if(!0===function(e,t,r){e=e.value;{if(void 0===r[t]){if("number"==typeof e)r[t]=e;else{var i=Array.isArray(e)?e:[e],n=[];for(let e=0;e<i.length;e++)n.push(i[e].clone());r[t]=n}return!0}if("number"==typeof e){if(r[t]!==e)return r[t]=e,!0}else{var a=Array.isArray(r[t])?r[t]:[r[t]],o=Array.isArray(e)?e:[e];for(let e=0;e<a.length;e++){var s=a[e];if(!1===s.equals(o[e]))return s.copy(o[e]),!0}}}return!1}(m,e,p)){var f=m.__offset,g=Array.isArray(m.value)?m.value:[m.value];let t=0;for(let e=0;e<g.length;e++){var v=g[e],_=S(v);"number"==typeof v?(m.__data[0]=v,y.bufferSubData(y.UNIFORM_BUFFER,f+t,m.__data)):v.isMatrix3?(m.__data[0]=v.elements[0],m.__data[1]=v.elements[1],m.__data[2]=v.elements[2],m.__data[3]=v.elements[0],m.__data[4]=v.elements[3],m.__data[5]=v.elements[4],m.__data[6]=v.elements[5],m.__data[7]=v.elements[0],m.__data[8]=v.elements[6],m.__data[9]=v.elements[7],m.__data[10]=v.elements[8],m.__data[11]=v.elements[0]):(v.toArray(m.__data,t),t+=_.storage/Float32Array.BYTES_PER_ELEMENT)}y.bufferSubData(y.UNIFORM_BUFFER,f,m.__data)}}y.bindBuffer(y.UNIFORM_BUFFER,null),b[e.id]=n}},dispose:function(){for(const e in x)y.deleteBuffer(x[e]);w=[],x={},b={}}}}function createCanvasElement(){var e=createElementNS("canvas");return e.style.display="block",e}class WebGLRenderer{constructor(e={}){const{canvas:n=createCanvasElement(),context:r=null,depth:E=!0,stencil:T=!0,alpha:x=!1,antialias:b=!1,premultipliedAlpha:Q=!0,preserveDrawingBuffer:G=!1,powerPreference:z="default",failIfMajorPerformanceCaveat:$=!1}=e;this.isWebGLRenderer=!0;let W;W=null!==r?r.getContextAttributes().alpha:x;const l=new Uint32Array(4),c=new Int32Array(4);let p=null,w=null;const a=[],o=[],C=(this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=SRGBColorSpace,this._useLegacyLights=!1,this.toneMapping=NoToneMapping,this.toneMappingExposure=1,this);let K=!1,j=0,X=0,S=null,M=-1,B=null;const g=new Vector4,Y=new Vector4;let q=null;const J=new Color(0);let Z=0,i=n.width,N=n.height,R=1,ee=null,te=null;const d=new Vector4(0,0,i,N),re=new Vector4(0,0,i,N);let ie=!1;const ne=new Frustum;let ae=!1,oe=!1,L=null;const se=new Matrix4,le=new Vector2,U=new Vector3,ce={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function de(){return null===S?R:1}let I=r;function he(t,r){for(let e=0;e<t.length;e++){var i=t[e],i=n.getContext(i,r);if(null!==i)return i}return null}try{var ue={alpha:!0,depth:E,stencil:T,antialias:b,premultipliedAlpha:Q,preserveDrawingBuffer:G,powerPreference:z,failIfMajorPerformanceCaveat:$};if("setAttribute"in n&&n.setAttribute("data-engine","three.js r"+REVISION),n.addEventListener("webglcontextlost",be,!1),n.addEventListener("webglcontextrestored",we,!1),n.addEventListener("webglcontextcreationerror",Ce,!1),null===I){var Ae=["webgl2","webgl","experimental-webgl"];if(!0===C.isWebGL1Renderer&&Ae.shift(),null===(I=he(Ae,ue)))throw he(Ae)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}"undefined"!=typeof WebGLRenderingContext&&I instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===I.getShaderPrecisionFormat&&(I.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}let v,F,P,s,O,D,H,k,pe,me,m,h,fe,ge,ve,V,u,A,_e,ye,Ee,_,f,Te;function xe(){v=new WebGLExtensions(I),F=new WebGLCapabilities(I,v,e),v.init(F),_=new WebGLUtils(I,v,F),P=new WebGLState(I,v,F),s=new WebGLInfo(I),O=new WebGLProperties,D=new WebGLTextures(I,v,P,O,F,_,s),H=new WebGLCubeMaps(C),k=new WebGLCubeUVMaps(C),pe=new WebGLAttributes(I,F),f=new WebGLBindingStates(I,v,pe,F),me=new WebGLGeometries(I,pe,s,f),m=new WebGLObjects(I,me,pe,s),_e=new WebGLMorphtargets(I,F,D),V=new WebGLClipping(O),h=new WebGLPrograms(C,H,k,v,F,f,V),fe=new WebGLMaterials(C,O),ge=new WebGLRenderLists,ve=new WebGLRenderStates(v,F),A=new WebGLBackground(C,H,k,P,m,W,Q),u=new WebGLShadowMap(C,m,F),Te=new WebGLUniformsGroups(I,s,F,P),ye=new WebGLBufferRenderer(I,v,s,F),Ee=new WebGLIndexedBufferRenderer(I,v,s,F),s.programs=h.programs,C.capabilities=F,C.extensions=v,C.properties=O,C.renderLists=ge,C.shadowMap=u,C.state=P,C.info=s}xe();const y=new WebXRManager(C,I);function be(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),K=!0}function we(){console.log("THREE.WebGLRenderer: Context Restored."),K=!1;var e=s.autoReset,t=u.enabled,r=u.autoUpdate,i=u.needsUpdate,n=u.type;xe(),s.autoReset=e,u.enabled=t,u.autoUpdate=r,u.needsUpdate=i,u.type=n}function Ce(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Se(e){var e=e.target,t=(e.removeEventListener("dispose",Se),e=e),r=O.get(t).programs;void 0!==r&&(r.forEach(function(e){h.releaseProgram(e)}),t.isShaderMaterial)&&h.releaseShaderCache(t),O.remove(e)}this.xr=y,this.getContext=function(){return I},this.getContextAttributes=function(){return I.getContextAttributes()},this.forceContextLoss=function(){var e=v.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=v.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return R},this.setPixelRatio=function(e){void 0!==e&&(R=e,this.setSize(i,N,!1))},this.getSize=function(e){return e.set(i,N)},this.setSize=function(e,t,r=!0){y.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(i=e,N=t,n.width=Math.floor(e*R),n.height=Math.floor(t*R),!0===r&&(n.style.width=e+"px",n.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return e.set(i*R,N*R).floor()},this.setDrawingBufferSize=function(e,t,r){i=e,N=t,R=r,n.width=Math.floor(e*r),n.height=Math.floor(t*r),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(g)},this.getViewport=function(e){return e.copy(d)},this.setViewport=function(e,t,r,i){e.isVector4?d.set(e.x,e.y,e.z,e.w):d.set(e,t,r,i),P.viewport(g.copy(d).multiplyScalar(R).floor())},this.getScissor=function(e){return e.copy(re)},this.setScissor=function(e,t,r,i){e.isVector4?re.set(e.x,e.y,e.z,e.w):re.set(e,t,r,i),P.scissor(Y.copy(re).multiplyScalar(R).floor())},this.getScissorTest=function(){return ie},this.setScissorTest=function(e){P.setScissorTest(ie=e)},this.setOpaqueSort=function(e){ee=e},this.setTransparentSort=function(e){te=e},this.getClearColor=function(e){return e.copy(A.getClearColor())},this.setClearColor=function(){A.setClearColor.apply(A,arguments)},this.getClearAlpha=function(){return A.getClearAlpha()},this.setClearAlpha=function(){A.setClearAlpha.apply(A,arguments)},this.clear=function(t=!0,e=!0,r=!0){let i=0;if(t){let e=!1;var n,a,o,s;null!==S&&(t=S.texture.format,e=t===RGBAIntegerFormat||t===RGIntegerFormat||t===RedIntegerFormat),e?(t=(t=S.texture.type)===UnsignedByteType||t===UnsignedIntType||t===UnsignedShortType||t===UnsignedInt248Type||t===UnsignedShort4444Type||t===UnsignedShort5551Type,s=A.getClearColor(),n=A.getClearAlpha(),a=s.r,o=s.g,s=s.b,t?(l[0]=a,l[1]=o,l[2]=s,l[3]=n,I.clearBufferuiv(I.COLOR,0,l)):(c[0]=a,c[1]=o,c[2]=s,c[3]=n,I.clearBufferiv(I.COLOR,0,c))):i|=I.COLOR_BUFFER_BIT}e&&(i|=I.DEPTH_BUFFER_BIT),r&&(i|=I.STENCIL_BUFFER_BIT),I.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",be,!1),n.removeEventListener("webglcontextrestored",we,!1),n.removeEventListener("webglcontextcreationerror",Ce,!1),ge.dispose(),ve.dispose(),O.dispose(),H.dispose(),k.dispose(),m.dispose(),f.dispose(),Te.dispose(),h.dispose(),y.dispose(),y.removeEventListener("sessionstart",Be),y.removeEventListener("sessionend",Ne),L&&(L.dispose(),L=null),t.stop()},this.renderBufferDirect=function(e,r,i,n,a,o){null===r&&(r=ce);var s=a.isMesh&&a.matrixWorld.determinant()<0,e=function(e,t,r,i,n){!0!==t.isScene&&(t=ce);D.resetTextureUnits();var a=t.fog,o=i.isMeshStandardMaterial?t.environment:null,s=null===S?C.outputColorSpace:!0===S.isXRRenderTarget?S.texture.colorSpace:LinearSRGBColorSpace,o=(i.isMeshStandardMaterial?k:H).get(i.envMap||o),l=!0===i.vertexColors&&!!r.attributes.color&&4===r.attributes.color.itemSize,c=!!r.attributes.tangent&&(!!i.normalMap||0<i.anisotropy),d=!!r.morphAttributes.position,h=!!r.morphAttributes.normal,u=!!r.morphAttributes.color;let A=NoToneMapping;!i.toneMapped||null!==S&&!0!==S.isXRRenderTarget||(A=C.toneMapping);var p=r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color,p=void 0!==p?p.length:0,m=O.get(i),f=w.state.lights;!0!==ae||!0!==oe&&e===B||(T=e===B&&i.id===M,V.setState(i,e,T));let g=!1;i.version===m.__version?(m.needsLights&&m.lightsStateVersion!==f.state.version||m.outputColorSpace!==s||n.isInstancedMesh&&!1===m.instancing||!n.isInstancedMesh&&!0===m.instancing||n.isSkinnedMesh&&!1===m.skinning||!n.isSkinnedMesh&&!0===m.skinning||n.isInstancedMesh&&!0===m.instancingColor&&null===n.instanceColor||n.isInstancedMesh&&!1===m.instancingColor&&null!==n.instanceColor||m.envMap!==o||!0===i.fog&&m.fog!==a||void 0!==m.numClippingPlanes&&(m.numClippingPlanes!==V.numPlanes||m.numIntersection!==V.numIntersection)||m.vertexAlphas!==l||m.vertexTangents!==c||m.morphTargets!==d||m.morphNormals!==h||m.morphColors!==u||m.toneMapping!==A||!0===F.isWebGL2&&m.morphTargetsCount!==p)&&(g=!0):(g=!0,m.__version=i.version);let v=m.currentProgram;!0===g&&(v=Ie(i,t,n));let _=!1,y=!1,E=!1;var T=v.getUniforms(),f=m.uniforms;P.useProgram(v.program)&&(_=!0,y=!0,E=!0);i.id!==M&&(M=i.id,y=!0);(_||B!==e)&&(T.setValue(I,"projectionMatrix",e.projectionMatrix),F.logarithmicDepthBuffer&&T.setValue(I,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),B!==e&&(B=e,y=!0,E=!0),(i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap)&&void 0!==(s=T.map.cameraPosition)&&s.setValue(I,U.setFromMatrixPosition(e.matrixWorld)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&T.setValue(I,"isOrthographic",!0===e.isOrthographicCamera),i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||n.isSkinnedMesh)&&T.setValue(I,"viewMatrix",e.matrixWorldInverse);n.isSkinnedMesh&&(T.setOptional(I,n,"bindMatrix"),T.setOptional(I,n,"bindMatrixInverse"),l=n.skeleton)&&(F.floatVertexTextures?(null===l.boneTexture&&l.computeBoneTexture(),T.setValue(I,"boneTexture",l.boneTexture,D),T.setValue(I,"boneTextureSize",l.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."));c=r.morphAttributes;(void 0!==c.position||void 0!==c.normal||void 0!==c.color&&!0===F.isWebGL2)&&_e.update(n,r,v);!y&&m.receiveShadow===n.receiveShadow||(m.receiveShadow=n.receiveShadow,T.setValue(I,"receiveShadow",n.receiveShadow));i.isMeshGouraudMaterial&&null!==i.envMap&&(f.envMap.value=o,f.flipEnvMap.value=o.isCubeTexture&&!1===o.isRenderTargetTexture?-1:1);y&&(T.setValue(I,"toneMappingExposure",C.toneMappingExposure),m.needsLights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(f,E),a&&!0===i.fog&&fe.refreshFogUniforms(f,a),fe.refreshMaterialUniforms(f,i,R,N,L),WebGLUniforms.upload(I,m.uniformsList,f,D));i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(WebGLUniforms.upload(I,m.uniformsList,f,D),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&T.setValue(I,"center",n.center);if(T.setValue(I,"modelViewMatrix",n.modelViewMatrix),T.setValue(I,"normalMatrix",n.normalMatrix),T.setValue(I,"modelMatrix",n.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){var x,b=i.uniformsGroups;for(let e=0,t=b.length;e<t;e++)F.isWebGL2?(x=b[e],Te.update(x,v),Te.bind(x,v)):console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return v}(e,r,i,n,a);P.setMaterial(n,s);let l=i.index,t=1;if(!0===n.wireframe){if(void 0===(l=me.getWireframeAttribute(i)))return;t=2}r=i.drawRange,s=i.attributes.position;let c=r.start*t,d=(r.start+r.count)*t;null!==o&&(c=Math.max(c,o.start*t),d=Math.min(d,(o.start+o.count)*t)),null!==l?(c=Math.max(c,0),d=Math.min(d,l.count)):null!=s&&(c=Math.max(c,0),d=Math.min(d,s.count));r=d-c;if(!(r<0||r==1/0)){f.setup(a,n,e,i,l);let t=ye;if(null!==l&&(o=pe.get(l),(t=Ee).setIndex(o)),a.isMesh)!0===n.wireframe?(P.setLineWidth(n.wireframeLinewidth*de()),t.setMode(I.LINES)):t.setMode(I.TRIANGLES);else if(a.isLine){let e=n.linewidth;void 0===e&&(e=1),P.setLineWidth(e*de()),a.isLineSegments?t.setMode(I.LINES):a.isLineLoop?t.setMode(I.LINE_LOOP):t.setMode(I.LINE_STRIP)}else a.isPoints?t.setMode(I.POINTS):a.isSprite&&t.setMode(I.TRIANGLES);a.isInstancedMesh?t.renderInstances(c,r,a.count):i.isInstancedBufferGeometry?(s=void 0!==i._maxInstanceCount?i._maxInstanceCount:1/0,e=Math.min(i.instanceCount,s),t.renderInstances(c,r,e)):t.render(c,r)}},this.compile=function(i,t){function n(e,t,r){!0===e.transparent&&e.side===DoubleSide&&!1===e.forceSinglePass?(e.side=BackSide,e.needsUpdate=!0,Ie(e,t,r),e.side=FrontSide,e.needsUpdate=!0,Ie(e,t,r),e.side=DoubleSide):Ie(e,t,r)}(w=ve.get(i)).init(),o.push(w),i.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(w.pushLight(e),e.castShadow)&&w.pushShadow(e)}),w.setupLights(C._useLegacyLights),i.traverse(function(t){var r=t.material;if(r)if(Array.isArray(r))for(let e=0;e<r.length;e++)n(r[e],i,t);else n(r,i,t)}),o.pop(),w=null};let Me=null;function Be(){t.stop()}function Ne(){t.start()}const t=new WebGLAnimation;function Re(e,t,i,r){var n=e.opaque,a=e.transmissive,e=e.transparent;if(w.setupLightsView(i),!0===ae&&V.setGlobalState(C.clippingPlanes,i),0<a.length){var o=n,s=a,l=t,c=i,d=F.isWebGL2,h=(null===L&&(L=new WebGLRenderTarget(1,1,{generateMipmaps:!0,type:v.has("EXT_color_buffer_half_float")?HalfFloatType:UnsignedByteType,minFilter:LinearMipmapLinearFilter,samples:d?4:0})),C.getDrawingBufferSize(le),d?L.setSize(le.x,le.y):L.setSize(floorPowerOfTwo(le.x),floorPowerOfTwo(le.y)),d=C.getRenderTarget(),C.setRenderTarget(L),C.getClearColor(J),(Z=C.getClearAlpha())<1&&C.setClearColor(16777215,.5),C.clear(),C.toneMapping);C.toneMapping=NoToneMapping,Le(o,l,c),D.updateMultisampleRenderTarget(L),D.updateRenderTargetMipmap(L);let r=!1;for(let e=0,t=s.length;e<t;e++){var u,A=s[e],p=A.object,m=A.geometry,f=A.material,A=A.group;f.side===DoubleSide&&p.layers.test(c.layers)&&(u=f.side,f.side=BackSide,f.needsUpdate=!0,Ue(p,l,c,m,f,A),f.side=u,f.needsUpdate=!0,r=!0)}!0===r&&(D.updateMultisampleRenderTarget(L),D.updateRenderTargetMipmap(L)),C.setRenderTarget(d),C.setClearColor(J,Z),C.toneMapping=h}r&&P.viewport(g.copy(r)),0<n.length&&Le(n,t,i),0<a.length&&Le(a,t,i),0<e.length&&Le(e,t,i),P.buffers.depth.setTest(!0),P.buffers.depth.setMask(!0),P.buffers.color.setMask(!0),P.setPolygonOffset(!1)}function Le(r,i,n){var a=!0===i.isScene?i.overrideMaterial:null;for(let e=0,t=r.length;e<t;e++){var o=r[e],s=o.object,l=o.geometry,c=null===a?o.material:a,o=o.group;s.layers.test(n.layers)&&Ue(s,i,n,l,c,o)}}function Ue(e,t,r,i,n,a){e.onBeforeRender(C,t,r,i,n,a),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),n.onBeforeRender(C,t,r,i,e,a),!0===n.transparent&&n.side===DoubleSide&&!1===n.forceSinglePass?(n.side=BackSide,n.needsUpdate=!0,C.renderBufferDirect(r,t,i,n,e,a),n.side=FrontSide,n.needsUpdate=!0,C.renderBufferDirect(r,t,i,n,e,a),n.side=DoubleSide):C.renderBufferDirect(r,t,i,n,e,a),e.onAfterRender(C,t,r,i,n,a)}function Ie(e,t,r){!0!==t.isScene&&(t=ce);var i=O.get(e),n=w.state.lights,a=w.state.shadowsArray,o=n.state.version,a=h.getParameters(e,n.state,a,t,r),s=h.getProgramCacheKey(a);let l=i.programs,c=(i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?k:H).get(e.envMap||i.environment),void 0===l&&(e.addEventListener("dispose",Se),l=new Map,i.programs=l),l.get(s));if(void 0!==c){if(i.currentProgram===c&&i.lightsStateVersion===o)return Fe(e,a),c}else a.uniforms=h.getUniforms(e),e.onBuild(r,a,C),e.onBeforeCompile(a,C),c=h.acquireProgram(a,s),l.set(s,c),i.uniforms=a.uniforms;t=i.uniforms,(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(t.clippingPlanes=V.uniform),Fe(e,a),i.needsLights=(r=e).isMeshLambertMaterial||r.isMeshToonMaterial||r.isMeshPhongMaterial||r.isMeshStandardMaterial||r.isShadowMaterial||r.isShaderMaterial&&!0===r.lights,i.lightsStateVersion=o,i.needsLights&&(t.ambientLightColor.value=n.state.ambient,t.lightProbe.value=n.state.probe,t.directionalLights.value=n.state.directional,t.directionalLightShadows.value=n.state.directionalShadow,t.spotLights.value=n.state.spot,t.spotLightShadows.value=n.state.spotShadow,t.rectAreaLights.value=n.state.rectArea,t.ltc_1.value=n.state.rectAreaLTC1,t.ltc_2.value=n.state.rectAreaLTC2,t.pointLights.value=n.state.point,t.pointLightShadows.value=n.state.pointShadow,t.hemisphereLights.value=n.state.hemi,t.directionalShadowMap.value=n.state.directionalShadowMap,t.directionalShadowMatrix.value=n.state.directionalShadowMatrix,t.spotShadowMap.value=n.state.spotShadowMap,t.spotLightMatrix.value=n.state.spotLightMatrix,t.spotLightMap.value=n.state.spotLightMap,t.pointShadowMap.value=n.state.pointShadowMap,t.pointShadowMatrix.value=n.state.pointShadowMatrix),s=c.getUniforms(),a=WebGLUniforms.seqWithValue(s.seq,t);return i.currentProgram=c,i.uniformsList=a,c}function Fe(e,t){e=O.get(e);e.outputColorSpace=t.outputColorSpace,e.instancing=t.instancing,e.instancingColor=t.instancingColor,e.skinning=t.skinning,e.morphTargets=t.morphTargets,e.morphNormals=t.morphNormals,e.morphColors=t.morphColors,e.morphTargetsCount=t.morphTargetsCount,e.numClippingPlanes=t.numClippingPlanes,e.numIntersection=t.numClipIntersection,e.vertexAlphas=t.vertexAlphas,e.vertexTangents=t.vertexTangents,e.toneMapping=t.toneMapping}t.setAnimationLoop(function(e){Me&&Me(e)}),"undefined"!=typeof self&&t.setContext(self),this.setAnimationLoop=function(e){Me=e,y.setAnimationLoop(e),null===e?t.stop():t.start()},y.addEventListener("sessionstart",Be),y.addEventListener("sessionend",Ne),this.render=function(r,e){if(void 0!==e&&!0!==e.isCamera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else if(!0!==K){!0===r.matrixWorldAutoUpdate&&r.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),!0===y.enabled&&!0===y.isPresenting&&(!0===y.cameraAutoUpdate&&y.updateCamera(e),e=y.getCamera()),!0===r.isScene&&r.onBeforeRender(C,r,e,S),(w=ve.get(r,o.length)).init(),o.push(w),se.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),ne.setFromProjectionMatrix(se),oe=this.localClippingEnabled,ae=V.init(this.clippingPlanes,oe),(p=ge.get(r,a.length)).init(),a.push(p),!function r(i,n,a,o){if(!1===i.visible)return;const e=i.layers.test(n.layers);if(e)if(i.isGroup)a=i.renderOrder;else if(i.isLOD)!0===i.autoUpdate&&i.update(n);else if(i.isLight)w.pushLight(i),i.castShadow&&w.pushShadow(i);else if(i.isSprite){if(!i.frustumCulled||ne.intersectsSprite(i)){o&&U.setFromMatrixPosition(i.matrixWorld).applyMatrix4(se);const t=m.update(i),l=i.material;l.visible&&p.push(i,t,l,a,U.z,null)}}else if((i.isMesh||i.isLine||i.isPoints)&&(!i.frustumCulled||ne.intersectsObject(i))){const c=m.update(i),d=i.material;if(o&&(void 0!==i.boundingSphere?(null===i.boundingSphere&&i.computeBoundingSphere(),U.copy(i.boundingSphere.center)):(null===c.boundingSphere&&c.computeBoundingSphere(),U.copy(c.boundingSphere.center)),U.applyMatrix4(i.matrixWorld).applyMatrix4(se)),Array.isArray(d)){const h=c.groups;for(let e=0,t=h.length;e<t;e++){const u=h[e],A=d[u.materialIndex];A&&A.visible&&p.push(i,c,A,a,U.z,u)}}else d.visible&&p.push(i,c,d,a,U.z,null)}const s=i.children;for(let e=0,t=s.length;e<t;e++)r(s[e],n,a,o)}(r,e,0,C.sortObjects),p.finish(),!0===C.sortObjects&&p.sort(ee,te),this.info.render.frame++,!0===ae&&V.beginShadows();var t=w.state.shadowsArray;if(u.render(t,r,e),!0===ae&&V.endShadows(),!0===this.info.autoReset&&this.info.reset(),A.render(p,r),w.setupLights(C._useLegacyLights),e.isArrayCamera){var i=e.cameras;for(let e=0,t=i.length;e<t;e++){var n=i[e];Re(p,r,n,n.viewport)}}else Re(p,r,e);null!==S&&(D.updateMultisampleRenderTarget(S),D.updateRenderTargetMipmap(S)),!0===r.isScene&&r.onAfterRender(C,r,e),f.resetDefaultState(),M=-1,B=null,o.pop(),w=0<o.length?o[o.length-1]:null,a.pop(),p=0<a.length?a[a.length-1]:null}},this.getActiveCubeFace=function(){return j},this.getActiveMipmapLevel=function(){return X},this.getRenderTarget=function(){return S},this.setRenderTargetTextures=function(e,t,r){O.get(e.texture).__webglTexture=t,O.get(e.depthTexture).__webglTexture=r;t=O.get(e);t.__hasExternalTextures=!0,t.__hasExternalTextures&&(t.__autoAllocateDepthBuffer=void 0===r,t.__autoAllocateDepthBuffer||!0===v.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),t.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){e=O.get(e);e.__webglFramebuffer=t,e.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,r=0){S=e,j=t,X=r;let i=!0,n=null,a=!1,o=!1;q=e?(void 0!==(s=O.get(e)).__useDefaultFramebuffer?(P.bindFramebuffer(I.FRAMEBUFFER,null),i=!1):void 0===s.__webglFramebuffer?D.setupRenderTarget(e):s.__hasExternalTextures&&D.rebindTextures(e,O.get(e.texture).__webglTexture,O.get(e.depthTexture).__webglTexture),((s=e.texture).isData3DTexture||s.isDataArrayTexture||s.isCompressedArrayTexture)&&(o=!0),s=O.get(e).__webglFramebuffer,e.isWebGLCubeRenderTarget?(n=Array.isArray(s[t])?s[t][r]:s[t],a=!0):n=F.isWebGL2&&0<e.samples&&!1===D.useMultisampledRTT(e)?O.get(e).__webglMultisampledFramebuffer:Array.isArray(s)?s[r]:s,g.copy(e.viewport),Y.copy(e.scissor),e.scissorTest):(g.copy(d).multiplyScalar(R).floor(),Y.copy(re).multiplyScalar(R).floor(),ie);var s=P.bindFramebuffer(I.FRAMEBUFFER,n);s&&F.drawBuffers&&i&&P.drawBuffers(e,n),P.viewport(g),P.scissor(Y),P.setScissorTest(q),a?(s=O.get(e.texture),I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+t,s.__webglTexture,r)):o&&(s=O.get(e.texture),e=t||0,I.framebufferTextureLayer(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,s.__webglTexture,r||0,e)),M=-1},this.readRenderTargetPixels=function(t,r,i,n,a,o,s){if(t&&t.isWebGLRenderTarget){let e=O.get(t).__webglFramebuffer;if(e=t.isWebGLCubeRenderTarget&&void 0!==s?e[s]:e){P.bindFramebuffer(I.FRAMEBUFFER,e);try{var l,c=t.texture,d=c.format,h=c.type;d!==RGBAFormat&&_.convert(d)!==I.getParameter(I.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):(l=h===HalfFloatType&&(v.has("EXT_color_buffer_half_float")||F.isWebGL2&&v.has("EXT_color_buffer_float")),h===UnsignedByteType||_.convert(h)===I.getParameter(I.IMPLEMENTATION_COLOR_READ_TYPE)||h===FloatType&&(F.isWebGL2||v.has("OES_texture_float")||v.has("WEBGL_color_buffer_float"))||l?0<=r&&r<=t.width-n&&0<=i&&i<=t.height-a&&I.readPixels(r,i,n,a,_.convert(d),_.convert(h),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type."))}finally{const e=null!==S?O.get(S).__webglFramebuffer:null;P.bindFramebuffer(I.FRAMEBUFFER,e)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,r=0){var i=Math.pow(2,-r),n=Math.floor(t.image.width*i),i=Math.floor(t.image.height*i);D.setTexture2D(t,0),I.copyTexSubImage2D(I.TEXTURE_2D,r,0,0,e.x,e.y,n,i),P.unbindTexture()},this.copyTextureToTexture=function(e,t,r,i=0){var n=t.image.width,a=t.image.height,o=_.convert(r.format),s=_.convert(r.type);D.setTexture2D(r,0),I.pixelStorei(I.UNPACK_FLIP_Y_WEBGL,r.flipY),I.pixelStorei(I.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),I.pixelStorei(I.UNPACK_ALIGNMENT,r.unpackAlignment),t.isDataTexture?I.texSubImage2D(I.TEXTURE_2D,i,e.x,e.y,n,a,o,s,t.image.data):t.isCompressedTexture?I.compressedTexSubImage2D(I.TEXTURE_2D,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):I.texSubImage2D(I.TEXTURE_2D,i,e.x,e.y,o,s,t.image),0===i&&r.generateMipmaps&&I.generateMipmap(I.TEXTURE_2D),P.unbindTexture()},this.copyTextureToTexture3D=function(t,r,i,n,a=0){if(C.isWebGL1Renderer)console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");else{var o=t.max.x-t.min.x+1,s=t.max.y-t.min.y+1,l=t.max.z-t.min.z+1,c=_.convert(n.format),d=_.convert(n.type);let e;if(n.isData3DTexture)D.setTexture3D(n,0),e=I.TEXTURE_3D;else{if(!n.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");D.setTexture2DArray(n,0),e=I.TEXTURE_2D_ARRAY}I.pixelStorei(I.UNPACK_FLIP_Y_WEBGL,n.flipY),I.pixelStorei(I.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),I.pixelStorei(I.UNPACK_ALIGNMENT,n.unpackAlignment);var h=I.getParameter(I.UNPACK_ROW_LENGTH),u=I.getParameter(I.UNPACK_IMAGE_HEIGHT),A=I.getParameter(I.UNPACK_SKIP_PIXELS),p=I.getParameter(I.UNPACK_SKIP_ROWS),m=I.getParameter(I.UNPACK_SKIP_IMAGES),f=i.isCompressedTexture?i.mipmaps[0]:i.image;I.pixelStorei(I.UNPACK_ROW_LENGTH,f.width),I.pixelStorei(I.UNPACK_IMAGE_HEIGHT,f.height),I.pixelStorei(I.UNPACK_SKIP_PIXELS,t.min.x),I.pixelStorei(I.UNPACK_SKIP_ROWS,t.min.y),I.pixelStorei(I.UNPACK_SKIP_IMAGES,t.min.z),i.isDataTexture||i.isData3DTexture?I.texSubImage3D(e,a,r.x,r.y,r.z,o,s,l,c,d,f.data):i.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),I.compressedTexSubImage3D(e,a,r.x,r.y,r.z,o,s,l,c,f.data)):I.texSubImage3D(e,a,r.x,r.y,r.z,o,s,l,c,d,f),I.pixelStorei(I.UNPACK_ROW_LENGTH,h),I.pixelStorei(I.UNPACK_IMAGE_HEIGHT,u),I.pixelStorei(I.UNPACK_SKIP_PIXELS,A),I.pixelStorei(I.UNPACK_SKIP_ROWS,p),I.pixelStorei(I.UNPACK_SKIP_IMAGES,m),0===a&&n.generateMipmaps&&I.generateMipmap(e),P.unbindTexture()}},this.initTexture=function(e){e.isCubeTexture?D.setTextureCube(e,0):e.isData3DTexture?D.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?D.setTexture2DArray(e,0):D.setTexture2D(e,0),P.unbindTexture()},this.resetState=function(){j=0,X=0,S=null,P.reset(),f.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return WebGLCoordinateSystem}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===SRGBColorSpace?sRGBEncoding:LinearEncoding}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===sRGBEncoding?SRGBColorSpace:LinearSRGBColorSpace}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class WebGL1Renderer extends WebGLRenderer{}WebGL1Renderer.prototype.isWebGL1Renderer=!0;class FogExp2{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new Color(e),this.density=t}clone(){return new FogExp2(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class Fog{constructor(e,t=1,r=1e3){this.isFog=!0,this.name="",this.color=new Color(e),this.near=t,this.far=r}clone(){return new Fog(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class Scene extends Object3D{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){e=super.toJSON(e);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),0<this.backgroundBlurriness&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e}}class InterleavedBuffer{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=generateUUID()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(r,i,n){r*=this.stride,n*=i.stride;for(let e=0,t=this.stride;e<t;e++)this.array[r+e]=i.array[n+e];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);e=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),e=new this.constructor(e,this.stride);return e.setUsage(this.usage),e}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const _vector$5=new Vector3;class InterleavedBufferAttribute{constructor(e,t,r,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=r,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(r){for(let e=0,t=this.data.count;e<t;e++)_vector$5.fromBufferAttribute(this,e),_vector$5.applyMatrix4(r),this.setXYZ(e,_vector$5.x,_vector$5.y,_vector$5.z);return this}applyNormalMatrix(r){for(let e=0,t=this.count;e<t;e++)_vector$5.fromBufferAttribute(this,e),_vector$5.applyNormalMatrix(r),this.setXYZ(e,_vector$5.x,_vector$5.y,_vector$5.z);return this}transformDirection(r){for(let e=0,t=this.count;e<t;e++)_vector$5.fromBufferAttribute(this,e),_vector$5.transformDirection(r),this.setXYZ(e,_vector$5.x,_vector$5.y,_vector$5.z);return this}setX(e,t){return this.normalized&&(t=normalize(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=normalize(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=normalize(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=normalize(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return t=this.normalized?denormalize(t,this.array):t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return t=this.normalized?denormalize(t,this.array):t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return t=this.normalized?denormalize(t,this.array):t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return t=this.normalized?denormalize(t,this.array):t}setXY(e,t,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=normalize(t,this.array),r=normalize(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this}setXYZ(e,t,r,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=normalize(t,this.array),r=normalize(r,this.array),i=normalize(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this}setXYZW(e,t,r,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=normalize(t,this.array),r=normalize(r,this.array),i=normalize(i,this.array),n=normalize(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=n,this}clone(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new InterleavedBufferAttribute(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized);console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");var t=[];for(let e=0;e<this.count;e++){var r=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[r+e])}return new BufferAttribute(new this.array.constructor(t),this.itemSize,this.normalized)}toJSON(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized};console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");var t=[];for(let e=0;e<this.count;e++){var r=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[r+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}}class SpriteMaterial extends Material{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let _geometry;const _intersectPoint=new Vector3,_worldScale=new Vector3,_mvPosition=new Vector3,_alignedPosition=new Vector2,_rotatedPosition=new Vector2,_viewWorldMatrix=new Matrix4,_vA=new Vector3,_vB=new Vector3,_vC=new Vector3,_uvA=new Vector2,_uvB=new Vector2,_uvC=new Vector2;class Sprite extends Object3D{constructor(e){var t;super(),this.isSprite=!0,this.type="Sprite",void 0===_geometry&&(_geometry=new BufferGeometry,t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new InterleavedBuffer(t,5),_geometry.setIndex([0,1,2,0,2,3]),_geometry.setAttribute("position",new InterleavedBufferAttribute(t,3,0,!1)),_geometry.setAttribute("uv",new InterleavedBufferAttribute(t,2,3,!1))),this.geometry=_geometry,this.material=void 0!==e?e:new SpriteMaterial,this.center=new Vector2(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_worldScale.setFromMatrixScale(this.matrixWorld),_viewWorldMatrix.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),_mvPosition.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&_worldScale.multiplyScalar(-_mvPosition.z);var r=this.material.rotation;let i,n;0!==r&&(n=Math.cos(r),i=Math.sin(r));var r=this.center,a=(transformVertex(_vA.set(-.5,-.5,0),_mvPosition,r,_worldScale,i,n),transformVertex(_vB.set(.5,-.5,0),_mvPosition,r,_worldScale,i,n),transformVertex(_vC.set(.5,.5,0),_mvPosition,r,_worldScale,i,n),_uvA.set(0,0),_uvB.set(1,0),_uvC.set(1,1),e.ray.intersectTriangle(_vA,_vB,_vC,!1,_intersectPoint));null===a&&(transformVertex(_vB.set(-.5,.5,0),_mvPosition,r,_worldScale,i,n),_uvB.set(0,1),null===(a=e.ray.intersectTriangle(_vA,_vC,_vB,!1,_intersectPoint)))||(r=e.ray.origin.distanceTo(_intersectPoint))<e.near||r>e.far||t.push({distance:r,point:_intersectPoint.clone(),uv:Triangle.getInterpolation(_intersectPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function transformVertex(e,t,r,i,n,a){_alignedPosition.subVectors(e,r).addScalar(.5).multiply(i),void 0!==n?(_rotatedPosition.x=a*_alignedPosition.x-n*_alignedPosition.y,_rotatedPosition.y=n*_alignedPosition.x+a*_alignedPosition.y):_rotatedPosition.copy(_alignedPosition),e.copy(t),e.x+=_rotatedPosition.x,e.y+=_rotatedPosition.y,e.applyMatrix4(_viewWorldMatrix)}const _v1$2=new Vector3,_v2$1=new Vector3;class LOD extends Object3D{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);var r=e.levels;for(let e=0,t=r.length;e<t;e++){var i=r[e];this.addLevel(i.object.clone(),i.distance,i.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,r=0){t=Math.abs(t);var i=this.levels;let n;for(n=0;n<i.length&&!(t<i[n].distance);n++);return i.splice(n,0,{distance:t,hysteresis:r,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(r){var i=this.levels;if(0<i.length){let t,e;for(t=1,e=i.length;t<e;t++){let e=i[t].distance;if(i[t].object.visible&&(e-=e*i[t].hysteresis),r<e)break}return i[t-1].object}return null}raycast(e,t){var r;0<this.levels.length&&(_v1$2.setFromMatrixPosition(this.matrixWorld),r=e.ray.origin.distanceTo(_v1$2),this.getObjectForDistance(r).raycast(e,t))}update(r){var i=this.levels;if(1<i.length){_v1$2.setFromMatrixPosition(r.matrixWorld),_v2$1.setFromMatrixPosition(this.matrixWorld);var n=_v1$2.distanceTo(_v2$1)/r.zoom;i[0].object.visible=!0;let t,e;for(t=1,e=i.length;t<e;t++){let e=i[t].distance;if(i[t].object.visible&&(e-=e*i[t].hysteresis),!(n>=e))break;i[t-1].object.visible=!1,i[t].object.visible=!0}for(this._currentLevel=t-1;t<e;t++)i[t].object.visible=!1}}toJSON(e){var r=super.toJSON(e),i=(!1===this.autoUpdate&&(r.object.autoUpdate=!1),r.object.levels=[],this.levels);for(let e=0,t=i.length;e<t;e++){var n=i[e];r.object.levels.push({object:n.object.uuid,distance:n.distance,hysteresis:n.hysteresis})}return r}}const _basePosition=new Vector3,_skinIndex=new Vector4,_skinWeight=new Vector4,_vector3=new Vector3,_matrix4=new Matrix4,_vertex=new Vector3,_sphere$3=new Sphere,_inverseMatrix$2=new Matrix4,_ray$2=new Ray;class SkinnedMesh extends Mesh{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){var e=this.geometry,t=(null===this.boundingBox&&(this.boundingBox=new Box3),this.boundingBox.makeEmpty(),e.getAttribute("position"));for(let e=0;e<t.count;e++)_vertex.fromBufferAttribute(t,e),this.applyBoneTransform(e,_vertex),this.boundingBox.expandByPoint(_vertex)}computeBoundingSphere(){var e=this.geometry,t=(null===this.boundingSphere&&(this.boundingSphere=new Sphere),this.boundingSphere.makeEmpty(),e.getAttribute("position"));for(let e=0;e<t.count;e++)_vertex.fromBufferAttribute(t,e),this.applyBoneTransform(e,_vertex),this.boundingSphere.expandByPoint(_vertex)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){var r=this.material,i=this.matrixWorld;void 0!==r&&(null===this.boundingSphere&&this.computeBoundingSphere(),_sphere$3.copy(this.boundingSphere),_sphere$3.applyMatrix4(i),!1!==e.ray.intersectsSphere(_sphere$3))&&(_inverseMatrix$2.copy(i).invert(),_ray$2.copy(e.ray).applyMatrix4(_inverseMatrix$2),null===this.boundingBox||!1!==_ray$2.intersectsBox(this.boundingBox))&&this._computeIntersections(e,t,_ray$2)}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){var r=new Vector4,i=this.geometry.attributes.skinWeight;for(let e=0,t=i.count;e<t;e++){r.fromBufferAttribute(i,e);var n=1/r.manhattanLength();n!=1/0?r.multiplyScalar(n):r.set(1,0,0,0),i.setXYZW(e,r.x,r.y,r.z,r.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){var r=this.skeleton,i=this.geometry;_skinIndex.fromBufferAttribute(i.attributes.skinIndex,e),_skinWeight.fromBufferAttribute(i.attributes.skinWeight,e),_basePosition.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){var n,a=_skinWeight.getComponent(e);0!==a&&(n=_skinIndex.getComponent(e),_matrix4.multiplyMatrices(r.bones[n].matrixWorld,r.boneInverses[n]),t.addScaledVector(_vector3.copy(_basePosition).applyMatrix4(_matrix4),a))}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class Bone extends Object3D{constructor(){super(),this.isBone=!0,this.type="Bone"}}class DataTexture extends Texture{constructor(e=null,t=1,r=1,i,n,a,o,s,l=NearestFilter,c=NearestFilter,d,h){super(null,a,o,s,l,c,i,n,d,h),this.isDataTexture=!0,this.image={data:e,width:t,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const _offsetMatrix=new Matrix4,_identityMatrix=new Matrix4;class Skeleton{constructor(e=[],t=[]){this.uuid=generateUUID(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.init()}init(){var e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Matrix4)}}calculateInverses(){for(let e=this.boneInverses.length=0,t=this.bones.length;e<t;e++){var r=new Matrix4;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){var r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){var i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){var r=this.bones,i=this.boneInverses,n=this.boneMatrices,e=this.boneTexture;for(let e=0,t=r.length;e<t;e++){var a=r[e]?r[e].matrixWorld:_identityMatrix;_offsetMatrix.multiplyMatrices(a,i[e]),_offsetMatrix.toArray(n,16*e)}null!==e&&(e.needsUpdate=!0)}clone(){return new Skeleton(this.bones,this.boneInverses)}computeBoneTexture(){var e=ceilPowerOfTwo(Math.sqrt(4*this.bones.length)),t=(e=Math.max(e,4),new Float32Array(e*e*4)),r=(t.set(this.boneMatrices),new DataTexture(t,e,e,RGBAFormat,FloatType));return r.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=r,this.boneTextureSize=e,this}getBoneByName(r){for(let e=0,t=this.bones.length;e<t;e++){var i=this.bones[e];if(i.name===r)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(r,i){this.uuid=r.uuid;for(let t=0,e=r.bones.length;t<e;t++){var n=r.bones[t];let e=i[n];void 0===e&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),e=new Bone),this.bones.push(e),this.boneInverses.push((new Matrix4).fromArray(r.boneInverses[t]))}return this.init(),this}toJSON(){var r={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]},i=(r.uuid=this.uuid,this.bones),n=this.boneInverses;for(let e=0,t=i.length;e<t;e++){var a=i[e],a=(r.bones.push(a.uuid),n[e]);r.boneInverses.push(a.toArray())}return r}}class InstancedBufferAttribute extends BufferAttribute{constructor(e,t,r,i=1){super(e,t,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){var e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const _instanceLocalMatrix=new Matrix4,_instanceWorldMatrix=new Matrix4,_instanceIntersects=[],_box3=new Box3,_identity=new Matrix4,_mesh=new Mesh,_sphere$2=new Sphere;class InstancedMesh extends Mesh{constructor(e,t,r){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new InstancedBufferAttribute(new Float32Array(16*r),16),this.instanceColor=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let e=0;e<r;e++)this.setMatrixAt(e,_identity)}computeBoundingBox(){var t=this.geometry,r=this.count;null===this.boundingBox&&(this.boundingBox=new Box3),null===t.boundingBox&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let e=0;e<r;e++)this.getMatrixAt(e,_instanceLocalMatrix),_box3.copy(t.boundingBox).applyMatrix4(_instanceLocalMatrix),this.boundingBox.union(_box3)}computeBoundingSphere(){var t=this.geometry,r=this.count;null===this.boundingSphere&&(this.boundingSphere=new Sphere),null===t.boundingSphere&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let e=0;e<r;e++)this.getMatrixAt(e,_instanceLocalMatrix),_sphere$2.copy(t.boundingSphere).applyMatrix4(_instanceLocalMatrix),this.boundingSphere.union(_sphere$2)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,i){var t=this.matrixWorld,n=this.count;if(_mesh.geometry=this.geometry,_mesh.material=this.material,void 0!==_mesh.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),_sphere$2.copy(this.boundingSphere),_sphere$2.applyMatrix4(t),!1!==e.ray.intersectsSphere(_sphere$2)))for(let r=0;r<n;r++){this.getMatrixAt(r,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(t,_instanceLocalMatrix),_mesh.matrixWorld=_instanceWorldMatrix,_mesh.raycast(e,_instanceIntersects);for(let e=0,t=_instanceIntersects.length;e<t;e++){var a=_instanceIntersects[e];a.instanceId=r,a.object=this,i.push(a)}_instanceIntersects.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new InstancedBufferAttribute(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class LineBasicMaterial extends Material{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Color(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const _start$1=new Vector3,_end$1=new Vector3,_inverseMatrix$1=new Matrix4,_ray$1=new Ray,_sphere$1=new Sphere;class Line extends Object3D{constructor(e=new BufferGeometry,t=new LineBasicMaterial){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){var e=this.geometry;if(null===e.index){var r=e.attributes.position,i=[0];for(let e=1,t=r.count;e<t;e++)_start$1.fromBufferAttribute(r,e-1),_end$1.fromBufferAttribute(r,e),i[e]=i[e-1],i[e]+=_start$1.distanceTo(_end$1);e.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(r,i){var e=this.geometry,t=this.matrixWorld,n=r.params.Line.threshold,a=e.drawRange;if(null===e.boundingSphere&&e.computeBoundingSphere(),_sphere$1.copy(e.boundingSphere),_sphere$1.applyMatrix4(t),_sphere$1.radius+=n,!1!==r.ray.intersectsSphere(_sphere$1)){_inverseMatrix$1.copy(t).invert(),_ray$1.copy(r.ray).applyMatrix4(_inverseMatrix$1);var o,t=n/((this.scale.x+this.scale.y+this.scale.z)/3),s=t*t,l=new Vector3,c=new Vector3,d=new Vector3,h=new Vector3,u=this.isLineSegments?2:1,A=e.index,p=e.attributes.position;if(null!==A)for(let e=Math.max(0,a.start),t=Math.min(A.count,a.start+a.count)-1;e<t;e+=u){var m=A.getX(e),f=A.getX(e+1),m=(l.fromBufferAttribute(p,m),c.fromBufferAttribute(p,f),_ray$1.distanceSqToSegment(l,c,h,d));s<m||(h.applyMatrix4(this.matrixWorld),(f=r.ray.origin.distanceTo(h))<r.near)||f>r.far||i.push({distance:f,point:d.clone().applyMatrix4(this.matrixWorld),index:e,face:null,faceIndex:null,object:this})}else for(let e=Math.max(0,a.start),t=Math.min(p.count,a.start+a.count)-1;e<t;e+=u)l.fromBufferAttribute(p,e),c.fromBufferAttribute(p,e+1),s<_ray$1.distanceSqToSegment(l,c,h,d)||(h.applyMatrix4(this.matrixWorld),(o=r.ray.origin.distanceTo(h))<r.near)||o>r.far||i.push({distance:o,point:d.clone().applyMatrix4(this.matrixWorld),index:e,face:null,faceIndex:null,object:this})}}updateMorphTargets(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(0<t.length){var r=e[t[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){var i=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}}const _start=new Vector3,_end=new Vector3;class LineSegments extends Line{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){var e=this.geometry;if(null===e.index){var r=e.attributes.position,i=[];for(let e=0,t=r.count;e<t;e+=2)_start.fromBufferAttribute(r,e),_end.fromBufferAttribute(r,e+1),i[e]=0===e?0:i[e-1],i[e+1]=i[e]+_start.distanceTo(_end);e.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class LineLoop extends Line{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class PointsMaterial extends Material{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const _inverseMatrix=new Matrix4,_ray=new Ray,_sphere=new Sphere,_position$2=new Vector3;class Points extends Object3D{constructor(e=new BufferGeometry,t=new PointsMaterial){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(r,i){var e=this.geometry,n=this.matrixWorld,t=r.params.Points.threshold,a=e.drawRange;if(null===e.boundingSphere&&e.computeBoundingSphere(),_sphere.copy(e.boundingSphere),_sphere.applyMatrix4(n),_sphere.radius+=t,!1!==r.ray.intersectsSphere(_sphere)){_inverseMatrix.copy(n).invert(),_ray.copy(r.ray).applyMatrix4(_inverseMatrix);var t=t/((this.scale.x+this.scale.y+this.scale.z)/3),o=t*t,s=e.index,l=e.attributes.position;if(null!==s)for(let e=Math.max(0,a.start),t=Math.min(s.count,a.start+a.count);e<t;e++){var c=s.getX(e);_position$2.fromBufferAttribute(l,c),testPoint(_position$2,c,o,n,r,i,this)}else for(let e=Math.max(0,a.start),t=Math.min(l.count,a.start+a.count);e<t;e++)_position$2.fromBufferAttribute(l,e),testPoint(_position$2,e,o,n,r,i,this)}}updateMorphTargets(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(0<t.length){var r=e[t[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){var i=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}}function testPoint(e,t,r,i,n,a,o){var s=_ray.distanceSqToPoint(e);s<r&&(r=new Vector3,_ray.closestPointToPoint(e,r),r.applyMatrix4(i),(e=n.ray.origin.distanceTo(r))<n.near||e>n.far||a.push({distance:e,distanceToRay:Math.sqrt(s),point:r,index:t,face:null,object:o}))}class VideoTexture extends Texture{constructor(t,e,r,i,n,a,o,s,l){super(t,e,r,i,n,a,o,s,l),this.isVideoTexture=!0,this.minFilter=void 0!==a?a:LinearFilter,this.magFilter=void 0!==n?n:LinearFilter,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)})}clone(){return new this.constructor(this.image).copy(this)}update(){var e=this.image;!1=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class FramebufferTexture extends Texture{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.generateMipmaps=!1,this.needsUpdate=!0}}class CompressedTexture extends Texture{constructor(e,t,r,i,n,a,o,s,l,c,d,h){super(null,a,o,s,l,c,i,n,d,h),this.isCompressedTexture=!0,this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class CompressedArrayTexture extends CompressedTexture{constructor(e,t,r,i,n,a){super(e,t,r,n,a),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=ClampToEdgeWrapping}}class CompressedCubeTexture extends CompressedTexture{constructor(e,t,r){super(void 0,e[0].width,e[0].height,t,r,CubeReflectionMapping),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class CanvasTexture extends Texture{constructor(e,t,r,i,n,a,o,s,l){super(e,t,r,i,n,a,o,s,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Curve{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){e=this.getUtoTmapping(e);return this.getPoint(e,t)}getPoints(t=5){var r=[];for(let e=0;e<=t;e++)r.push(this.getPoint(e/t));return r}getSpacedPoints(t=5){var r=[];for(let e=0;e<=t;e++)r.push(this.getPointAt(e/t));return r}getLength(){var e=this.getLengths();return e[e.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var r=[];let i,n=this.getPoint(0),a=0;r.push(0);for(let e=1;e<=t;e++)i=this.getPoint(e/t),a+=i.distanceTo(n),r.push(a),n=i;return this.cacheArcLengths=r}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){var r=this.getLengths();let i=0;var n=r.length;let a,o=(a=t||e*r[n-1],0),s=n-1,l;for(;o<=s;)if((l=r[i=Math.floor(o+(s-o)/2)]-a)<0)o=i+1;else{if(!(0<l)){s=i;break}s=i-1}return r[i=s]===a?i/(n-1):(t=r[i],e=r[i+1],e=(a-t)/(e-t),(i+e)/(n-1))}getTangent(e,t){let r=e-1e-4,i=e+1e-4;r<0&&(r=0),1<i&&(i=1);var e=this.getPoint(r),n=this.getPoint(i),t=t||new(e.isVector2?Vector2:Vector3);return t.copy(n).sub(e).normalize(),t}getTangentAt(e,t){e=this.getUtoTmapping(e);return this.getTangent(e,t)}computeFrenetFrames(r,e){var t=new Vector3,i=[],n=[],a=[],o=new Vector3,s=new Matrix4;for(let e=0;e<=r;e++){var l=e/r;i[e]=this.getTangentAt(l,new Vector3)}n[0]=new Vector3,a[0]=new Vector3;let c=Number.MAX_VALUE;var d,h=Math.abs(i[0].x),u=Math.abs(i[0].y),A=Math.abs(i[0].z);h<=c&&(c=h,t.set(1,0,0)),u<=c&&(c=u,t.set(0,1,0)),A<=c&&t.set(0,0,1),o.crossVectors(i[0],t).normalize(),n[0].crossVectors(i[0],o),a[0].crossVectors(i[0],n[0]);for(let e=1;e<=r;e++)n[e]=n[e-1].clone(),a[e]=a[e-1].clone(),o.crossVectors(i[e-1],i[e]),o.length()>Number.EPSILON&&(o.normalize(),d=Math.acos(clamp(i[e-1].dot(i[e]),-1,1)),n[e].applyMatrix4(s.makeRotationAxis(o,d))),a[e].crossVectors(i[e],n[e]);if(!0===e){let t=Math.acos(clamp(n[0].dot(n[r]),-1,1));t/=r,0<i[0].dot(o.crossVectors(n[0],n[r]))&&(t=-t);for(let e=1;e<=r;e++)n[e].applyMatrix4(s.makeRotationAxis(i[e],t*e)),a[e].crossVectors(i[e],n[e])}return{tangents:i,normals:n,binormals:a}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){var e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class EllipseCurve extends Curve{constructor(e=0,t=0,r=1,i=1,n=0,a=2*Math.PI,o=!1,s=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=n,this.aEndAngle=a,this.aClockwise=o,this.aRotation=s}getPoint(e,t){var t=t||new Vector2,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;for(var n=Math.abs(i)<Number.EPSILON;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=n?0:r),!0!==this.aClockwise||n||(i===r?i=-r:i-=r);var a,o,n=this.aStartAngle+e*i;let s=this.aX+this.xRadius*Math.cos(n),l=this.aY+this.yRadius*Math.sin(n);return 0!==this.aRotation&&(e=Math.cos(this.aRotation),n=Math.sin(this.aRotation),a=s-this.aX,o=l-this.aY,s=a*e-o*n+this.aX,l=a*n+o*e+this.aY),t.set(s,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){var e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class ArcCurve extends EllipseCurve{constructor(e,t,r,i,n,a){super(e,t,r,r,i,n,a),this.isArcCurve=!0,this.type="ArcCurve"}}function CubicPoly(){let n=0,a=0,o=0,s=0;function l(e,t,r,i){n=e,a=r,o=-3*e+3*t-2*r-i,s=2*e-2*t+r+i}return{initCatmullRom:function(e,t,r,i,n){l(t,r,n*(r-e),n*(i-t))},initNonuniformCatmullRom:function(e,t,r,i,n,a,o){e=(t-e)/n-(r-e)/(n+a)+(r-t)/a,n=(r-t)/a-(i-t)/(a+o)+(i-r)/o;l(t,r,e*=a,n*=a)},calc:function(e){var t=e*e,r=t*e;return n+a*e+o*t+s*r}}}const tmp=new Vector3,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;class CatmullRomCurve3 extends Curve{constructor(e=[],t=!1,r="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=r,this.tension=i}getPoint(i,e=new Vector3){var n=this.points,t=n.length,i=(t-(this.closed?0:1))*i;let r=Math.floor(i),a=i-r;this.closed?r+=0<r?0:(Math.floor(Math.abs(r)/t)+1)*t:0===a&&r===t-1&&(r=t-2,a=1);let o,s;o=this.closed||0<r?n[(r-1)%t]:(tmp.subVectors(n[0],n[1]).add(n[0]),tmp);var i=n[r%t],l=n[(r+1)%t];if(s=this.closed||r+2<t?n[(r+2)%t]:(tmp.subVectors(n[t-1],n[t-2]).add(n[t-1]),tmp),"centripetal"===this.curveType||"chordal"===this.curveType){n="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(i),n),t=Math.pow(i.distanceToSquared(l),n),r=Math.pow(l.distanceToSquared(s),n);t<1e-4&&(t=1),e<1e-4&&(e=t),r<1e-4&&(r=t),px.initNonuniformCatmullRom(o.x,i.x,l.x,s.x,e,t,r),py.initNonuniformCatmullRom(o.y,i.y,l.y,s.y,e,t,r),pz.initNonuniformCatmullRom(o.z,i.z,l.z,s.z,e,t,r)}else"catmullrom"===this.curveType&&(px.initCatmullRom(o.x,i.x,l.x,s.x,this.tension),py.initCatmullRom(o.y,i.y,l.y,s.y,this.tension),pz.initCatmullRom(o.z,i.z,l.z,s.z,this.tension));return e.set(px.calc(a),py.calc(a),pz.calc(a)),e}copy(r){super.copy(r),this.points=[];for(let e=0,t=r.points.length;e<t;e++){var i=r.points[e];this.points.push(i.clone())}return this.closed=r.closed,this.curveType=r.curveType,this.tension=r.tension,this}toJSON(){var r=super.toJSON();r.points=[];for(let e=0,t=this.points.length;e<t;e++){var i=this.points[e];r.points.push(i.toArray())}return r.closed=this.closed,r.curveType=this.curveType,r.tension=this.tension,r}fromJSON(r){super.fromJSON(r),this.points=[];for(let e=0,t=r.points.length;e<t;e++){var i=r.points[e];this.points.push((new Vector3).fromArray(i))}return this.closed=r.closed,this.curveType=r.curveType,this.tension=r.tension,this}}function CatmullRom(e,t,r,i,n){var t=.5*(i-t),n=.5*(n-r),a=e*e;return(2*r-2*i+t+n)*(e*a)+(-3*r+3*i-2*t-n)*a+t*e+r}function QuadraticBezierP0(e,t){e=1-e;return e*e*t}function QuadraticBezierP1(e,t){return 2*(1-e)*e*t}function QuadraticBezierP2(e,t){return e*e*t}function QuadraticBezier(e,t,r,i){return QuadraticBezierP0(e,t)+QuadraticBezierP1(e,r)+QuadraticBezierP2(e,i)}function CubicBezierP0(e,t){e=1-e;return e*e*e*t}function CubicBezierP1(e,t){var r=1-e;return 3*r*r*e*t}function CubicBezierP2(e,t){return 3*(1-e)*e*e*t}function CubicBezierP3(e,t){return e*e*e*t}function CubicBezier(e,t,r,i,n){return CubicBezierP0(e,t)+CubicBezierP1(e,r)+CubicBezierP2(e,i)+CubicBezierP3(e,n)}class CubicBezierCurve extends Curve{constructor(e=new Vector2,t=new Vector2,r=new Vector2,i=new Vector2){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new Vector2){var r=this.v0,i=this.v1,n=this.v2,a=this.v3;return t.set(CubicBezier(e,r.x,i.x,n.x,a.x),CubicBezier(e,r.y,i.y,n.y,a.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){var e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class CubicBezierCurve3 extends Curve{constructor(e=new Vector3,t=new Vector3,r=new Vector3,i=new Vector3){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new Vector3){var r=this.v0,i=this.v1,n=this.v2,a=this.v3;return t.set(CubicBezier(e,r.x,i.x,n.x,a.x),CubicBezier(e,r.y,i.y,n.y,a.y),CubicBezier(e,r.z,i.z,n.z,a.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){var e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class LineCurve extends Curve{constructor(e=new Vector2,t=new Vector2){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Vector2){return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Vector2){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){var e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class LineCurve3 extends Curve{constructor(e=new Vector3,t=new Vector3){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new Vector3){return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Vector3){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){var e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class QuadraticBezierCurve extends Curve{constructor(e=new Vector2,t=new Vector2,r=new Vector2){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new Vector2){var r=this.v0,i=this.v1,n=this.v2;return t.set(QuadraticBezier(e,r.x,i.x,n.x),QuadraticBezier(e,r.y,i.y,n.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){var e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class QuadraticBezierCurve3 extends Curve{constructor(e=new Vector3,t=new Vector3,r=new Vector3){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new Vector3){var r=this.v0,i=this.v1,n=this.v2;return t.set(QuadraticBezier(e,r.x,i.x,n.x),QuadraticBezier(e,r.y,i.y,n.y),QuadraticBezier(e,r.z,i.z,n.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){var e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class SplineCurve extends Curve{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Vector2){var r=this.points,e=(r.length-1)*e,i=Math.floor(e),e=e-i,n=r[0===i?i:i-1],a=r[i],o=r[i>r.length-2?r.length-1:i+1],r=r[i>r.length-3?r.length-1:i+2];return t.set(CatmullRom(e,n.x,a.x,o.x,r.x),CatmullRom(e,n.y,a.y,o.y,r.y)),t}copy(r){super.copy(r),this.points=[];for(let e=0,t=r.points.length;e<t;e++){var i=r.points[e];this.points.push(i.clone())}return this}toJSON(){var r=super.toJSON();r.points=[];for(let e=0,t=this.points.length;e<t;e++){var i=this.points[e];r.points.push(i.toArray())}return r}fromJSON(r){super.fromJSON(r),this.points=[];for(let e=0,t=r.points.length;e<t;e++){var i=r.points[e];this.points.push((new Vector2).fromArray(i))}return this}}var Curves=Object.freeze({__proto__:null,ArcCurve:ArcCurve,CatmullRomCurve3:CatmullRomCurve3,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,EllipseCurve:EllipseCurve,LineCurve:LineCurve,LineCurve3:LineCurve3,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,SplineCurve:SplineCurve});class CurvePath extends Curve{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new LineCurve(t,e))}getPoint(e,t){var r,i,n,a=e*this.getLength(),o=this.getCurveLengths();let s=0;for(;s<o.length;){if(o[s]>=a)return r=o[s]-a,n=(i=this.curves[s]).getLength(),i.getPointAt(0===n?0:1-r/n,t);s++}return null}getLength(){var e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;var r=[];let i=0;for(let e=0,t=this.curves.length;e<t;e++)i+=this.curves[e].getLength(),r.push(i);return this.cacheLengths=r}getSpacedPoints(t=40){var r=[];for(let e=0;e<=t;e++)r.push(this.getPoint(e/t));return this.autoClose&&r.push(r[0]),r}getPoints(r=12){var i=[];let n;for(let e=0,t=this.curves;e<t.length;e++){var a=t[e],o=a.isEllipseCurve?2*r:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?r*a.points.length:r,s=a.getPoints(o);for(let e=0;e<s.length;e++){var l=s[e];n&&n.equals(l)||(i.push(l),n=l)}}return this.autoClose&&1<i.length&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(r){super.copy(r),this.curves=[];for(let e=0,t=r.curves.length;e<t;e++){var i=r.curves[e];this.curves.push(i.clone())}return this.autoClose=r.autoClose,this}toJSON(){var r=super.toJSON();r.autoClose=this.autoClose,r.curves=[];for(let e=0,t=this.curves.length;e<t;e++){var i=this.curves[e];r.curves.push(i.toJSON())}return r}fromJSON(r){super.fromJSON(r),this.autoClose=r.autoClose,this.curves=[];for(let e=0,t=r.curves.length;e<t;e++){var i=r.curves[e];this.curves.push((new Curves[i.type]).fromJSON(i))}return this}}class Path extends CurvePath{constructor(e){super(),this.type="Path",this.currentPoint=new Vector2,e&&this.setFromPoints(e)}setFromPoints(r){this.moveTo(r[0].x,r[0].y);for(let e=1,t=r.length;e<t;e++)this.lineTo(r[e].x,r[e].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){var r=new LineCurve(this.currentPoint.clone(),new Vector2(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,r,i){e=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(r,i));return this.curves.push(e),this.currentPoint.set(r,i),this}bezierCurveTo(e,t,r,i,n,a){e=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(r,i),new Vector2(n,a));return this.curves.push(e),this.currentPoint.set(n,a),this}splineThru(e){var t=[this.currentPoint.clone()].concat(e),t=new SplineCurve(t);return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,r,i,n,a){var o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,r,i,n,a),this}absarc(e,t,r,i,n,a){return this.absellipse(e,t,r,r,i,n,a),this}ellipse(e,t,r,i,n,a,o,s){var l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,r,i,n,a,o,s),this}absellipse(e,t,r,i,n,a,o,s){e=new EllipseCurve(e,t,r,i,n,a,o,s),0<this.curves.length&&((t=e.getPoint(0)).equals(this.currentPoint)||this.lineTo(t.x,t.y)),this.curves.push(e),r=e.getPoint(1);return this.currentPoint.copy(r),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){var e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class LatheGeometry extends BufferGeometry{constructor(r=[new Vector2(0,-.5),new Vector2(.5,0),new Vector2(0,.5)],i=12,e=0,n=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:r,segments:i,phiStart:e,phiLength:n},i=Math.floor(i),n=clamp(n,0,2*Math.PI);var a=[],o=[],s=[],l=[],c=[],d=1/i,h=new Vector3,u=new Vector2,t=new Vector3,A=new Vector3,p=new Vector3;let m=0,f=0;for(let e=0;e<=r.length-1;e++)switch(e){case 0:m=r[e+1].x-r[e].x,f=r[e+1].y-r[e].y,t.x=+f,t.y=-m,t.z=0*f,p.copy(t),t.normalize(),l.push(t.x,t.y,t.z);break;case r.length-1:l.push(p.x,p.y,p.z);break;default:m=r[e+1].x-r[e].x,f=r[e+1].y-r[e].y,t.x=+f,t.y=-m,t.z=0*f,A.copy(t),t.x+=p.x,t.y+=p.y,t.z+=p.z,t.normalize(),l.push(t.x,t.y,t.z),p.copy(A)}for(let t=0;t<=i;t++){var g=e+t*d*n,v=Math.sin(g),_=Math.cos(g);for(let e=0;e<=r.length-1;e++){h.x=r[e].x*v,h.y=r[e].y,h.z=r[e].x*_,o.push(h.x,h.y,h.z),u.x=t/i,u.y=e/(r.length-1),s.push(u.x,u.y);var y=l[3*e+0]*v,E=l[3*e+1],T=l[3*e+0]*_;c.push(y,E,T)}}for(let t=0;t<i;t++)for(let e=0;e<r.length-1;e++){var x=e+t*r.length,b=x+r.length,w=x+r.length+1,C=x+1;a.push(x,b,C),a.push(w,C,b)}this.setIndex(a),this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("uv",new Float32BufferAttribute(s,2)),this.setAttribute("normal",new Float32BufferAttribute(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new LatheGeometry(e.points,e.segments,e.phiStart,e.phiLength)}}class CapsuleGeometry extends LatheGeometry{constructor(e=1,t=1,r=4,i=8){var n=new Path;n.absarc(0,-t/2,e,1.5*Math.PI,0),n.absarc(0,t/2,e,0,.5*Math.PI),super(n.getPoints(r),i),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:r,radialSegments:i}}static fromJSON(e){return new CapsuleGeometry(e.radius,e.length,e.capSegments,e.radialSegments)}}class CircleGeometry extends BufferGeometry{constructor(r=1,i=32,n=0,a=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:r,segments:i,thetaStart:n,thetaLength:a},i=Math.max(3,i);var t=[],o=[],s=[],l=[],c=new Vector3,d=new Vector2;o.push(0,0,0),s.push(0,0,1),l.push(.5,.5);for(let e=0,t=3;e<=i;e++,t+=3){var h=n+e/i*a;c.x=r*Math.cos(h),c.y=r*Math.sin(h),o.push(c.x,c.y,c.z),s.push(0,0,1),d.x=(o[t]/r+1)/2,d.y=(o[t+1]/r+1)/2,l.push(d.x,d.y)}for(let e=1;e<=i;e++)t.push(e,e+1,0);this.setIndex(t),this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("normal",new Float32BufferAttribute(s,3)),this.setAttribute("uv",new Float32BufferAttribute(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new CircleGeometry(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class CylinderGeometry extends BufferGeometry{constructor(A=1,p=1,t=1,m=32,i=1,e=!1,f=0,g=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:A,radiusBottom:p,height:t,radialSegments:m,heightSegments:i,openEnded:e,thetaStart:f,thetaLength:g};const v=this,_=(m=Math.floor(m),i=Math.floor(i),[]),y=[],E=[],T=[];let x=0;const n=[],b=t/2;let w=0;{var a=new Vector3,o=new Vector3;let r=0;var s=(p-A)/t;for(let e=0;e<=i;e++){var l=[],c=e/i,d=c*(p-A)+A;for(let e=0;e<=m;e++){var h=e/m,u=h*g+f,C=Math.sin(u),u=Math.cos(u);o.x=d*C,o.y=-c*t+b,o.z=d*u,y.push(o.x,o.y,o.z),a.set(C,s,u).normalize(),E.push(a.x,a.y,a.z),T.push(h,1-c),l.push(x++)}n.push(l)}for(let t=0;t<m;t++)for(let e=0;e<i;e++){var S=n[e][t],M=n[e+1][t],B=n[e+1][t+1],N=n[e][t+1];_.push(S,M,N),_.push(M,B,N),r+=6}v.addGroup(w,r,0),w+=r}function r(t){var r=x,i=new Vector2,n=new Vector3;let a=0;var o=!0===t?A:p,s=!0===t?1:-1;for(let e=1;e<=m;e++)y.push(0,b*s,0),E.push(0,s,0),T.push(.5,.5),x++;var l=x;for(let e=0;e<=m;e++){var c=e/m*g+f,d=Math.cos(c),c=Math.sin(c);n.x=o*c,n.y=b*s,n.z=o*d,y.push(n.x,n.y,n.z),E.push(0,s,0),i.x=.5*d+.5,i.y=.5*c*s+.5,T.push(i.x,i.y),x++}for(let e=0;e<m;e++){var h=r+e,u=l+e;!0===t?_.push(u,u+1,h):_.push(u+1,u,h),a+=3}v.addGroup(w,a,!0===t?1:2),w+=a}!1===e&&(0<A&&r(!0),0<p)&&r(!1),this.setIndex(_),this.setAttribute("position",new Float32BufferAttribute(y,3)),this.setAttribute("normal",new Float32BufferAttribute(E,3)),this.setAttribute("uv",new Float32BufferAttribute(T,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new CylinderGeometry(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ConeGeometry extends CylinderGeometry{constructor(e=1,t=1,r=32,i=1,n=!1,a=0,o=2*Math.PI){super(0,e,t,r,i,n,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:n,thetaStart:a,thetaLength:o}}static fromJSON(e){return new ConeGeometry(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class PolyhedronGeometry extends BufferGeometry{constructor(r=[],t=[],e=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:r,indices:t,radius:e,detail:i};const n=[],a=[];var P=i,o=new Vector3,s=new Vector3,l=new Vector3;for(let e=0;e<t.length;e+=3){U(t[e+0],o),U(t[e+1],s),U(t[e+2],l);{c=void 0;d=void 0;h=void 0;u=void 0;A=void 0;p=void 0;m=void 0;f=void 0;g=void 0;v=void 0;var c=o;var d=s;var h=l;var u=P;var A=u+1,p=[];for(let t=0;t<=A;t++){p[t]=[];var m=c.clone().lerp(h,t/A),f=d.clone().lerp(h,t/A),g=A-t;for(let e=0;e<=g;e++)0===e&&t===A?p[t][e]=m:p[t][e]=m.clone().lerp(f,e/g)}for(let t=0;t<A;t++)for(let e=0;e<2*(A-t)-1;e++){var v=Math.floor(e/2);e%2==0?(L(p[t][v+1]),L(p[t+1][v]),L(p[t][v])):(L(p[t][v+1]),L(p[t+1][v+1]),L(p[t+1][v]))}}}var O=e,_=new Vector3;for(let e=0;e<n.length;e+=3)_.x=n[e+0],_.y=n[e+1],_.z=n[e+2],_.normalize().multiplyScalar(O),n[e+0]=_.x,n[e+1]=_.y,n[e+2]=_.z;var y=new Vector3;for(let e=0;e<n.length;e+=3){y.x=n[e+0],y.y=n[e+1],y.z=n[e+2];var D=F(y)/2/Math.PI+.5,H=function(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(y)/Math.PI+.5;a.push(D,1-H)}var E=new Vector3,T=new Vector3,x=new Vector3,b=new Vector3,w=new Vector2,C=new Vector2,S=new Vector2;for(let e=0,t=0;e<n.length;e+=9,t+=6){E.set(n[e+0],n[e+1],n[e+2]),T.set(n[e+3],n[e+4],n[e+5]),x.set(n[e+6],n[e+7],n[e+8]),w.set(a[t+0],a[t+1]),C.set(a[t+2],a[t+3]),S.set(a[t+4],a[t+5]),b.copy(E).add(T).add(x).divideScalar(3);var M=F(b);I(w,t+0,E,M),I(C,t+2,T,M),I(S,t+4,x,M)}for(let e=0;e<a.length;e+=6){var B=a[e+0],N=a[e+2],R=a[e+4],k=Math.max(B,N,R),V=Math.min(B,N,R);.9<k&&V<.1&&(B<.2&&(a[e+0]+=1),N<.2&&(a[e+2]+=1),R<.2)&&(a[e+4]+=1)}function L(e){n.push(e.x,e.y,e.z)}function U(e,t){e*=3;t.x=r[0+e],t.y=r[1+e],t.z=r[2+e]}function I(e,t,r,i){i<0&&1===e.x&&(a[t]=e.x-1),0===r.x&&0===r.z&&(a[t]=i/2/Math.PI+.5)}function F(e){return Math.atan2(e.z,-e.x)}this.setAttribute("position",new Float32BufferAttribute(n,3)),this.setAttribute("normal",new Float32BufferAttribute(n.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(a,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new PolyhedronGeometry(e.vertices,e.indices,e.radius,e.details)}}class DodecahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){var r=(1+Math.sqrt(5))/2,i=1/r;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new DodecahedronGeometry(e.radius,e.detail)}}const _v0=new Vector3,_v1$1=new Vector3,_normal=new Vector3,_triangle=new Triangle;class EdgesGeometry extends BufferGeometry{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){var r,i,n=Math.pow(10,4),a=Math.cos(DEG2RAD*t),o=e.getIndex(),s=e.getAttribute("position"),l=(o||s).count,c=[0,0,0],d=["a","b","c"],h=new Array(3),u={},A=[];for(let e=0;e<l;e+=3){o?(c[0]=o.getX(e),c[1]=o.getX(e+1),c[2]=o.getX(e+2)):(c[0]=e,c[1]=e+1,c[2]=e+2);var{a:p,b:m,c:f}=_triangle;if(p.fromBufferAttribute(s,c[0]),m.fromBufferAttribute(s,c[1]),f.fromBufferAttribute(s,c[2]),_triangle.getNormal(_normal),h[0]=`${Math.round(p.x*n)},${Math.round(p.y*n)},`+Math.round(p.z*n),h[1]=`${Math.round(m.x*n)},${Math.round(m.y*n)},`+Math.round(m.z*n),h[2]=`${Math.round(f.x*n)},${Math.round(f.y*n)},`+Math.round(f.z*n),h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(let e=0;e<3;e++){var g=(e+1)%3,v=h[e],_=h[g],y=_triangle[d[e]],E=_triangle[d[g]],T=v+"_"+_,_=_+"_"+v;_ in u&&u[_]?(_normal.dot(u[_].normal)<=a&&(A.push(y.x,y.y,y.z),A.push(E.x,E.y,E.z)),u[_]=null):T in u||(u[T]={index0:c[e],index1:c[g],normal:_normal.clone()})}}for(const x in u)u[x]&&({index0:r,index1:i}=u[x],_v0.fromBufferAttribute(s,r),_v1$1.fromBufferAttribute(s,i),A.push(_v0.x,_v0.y,_v0.z),A.push(_v1$1.x,_v1$1.y,_v1$1.z));this.setAttribute("position",new Float32BufferAttribute(A,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Shape extends Path{constructor(e){super(e),this.uuid=generateUUID(),this.type="Shape",this.holes=[]}getPointsHoles(r){var i=[];for(let e=0,t=this.holes.length;e<t;e++)i[e]=this.holes[e].getPoints(r);return i}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(r){super.copy(r),this.holes=[];for(let e=0,t=r.holes.length;e<t;e++){var i=r.holes[e];this.holes.push(i.clone())}return this}toJSON(){var r=super.toJSON();r.uuid=this.uuid,r.holes=[];for(let e=0,t=this.holes.length;e<t;e++){var i=this.holes[e];r.holes.push(i.toJSON())}return r}fromJSON(r){super.fromJSON(r),this.uuid=r.uuid,this.holes=[];for(let e=0,t=r.holes.length;e<t;e++){var i=r.holes[e];this.holes.push((new Path).fromJSON(i))}return this}}const Earcut={triangulate:function(s,l,c=2){var d=l&&l.length,h=d?l[0]*c:s.length;let u=linkedList(s,0,h,c,!0);var A=[];if(u&&u.next!==u.prev){let t,r,i,n,a,o,e;if(d&&(u=eliminateHoles(s,l,u,c)),s.length>80*c){t=i=s[0],r=n=s[1];for(let e=c;e<h;e+=c)a=s[e],o=s[e+1],a<t&&(t=a),o<r&&(r=o),a>i&&(i=a),o>n&&(n=o);e=0!==(e=Math.max(i-t,n-r))?32767/e:0}earcutLinked(u,A,c,t,r,e,0)}return A}};function linkedList(e,t,r,i,n){let a,o;if(n===0<signedArea(e,t,r,i))for(a=t;a<r;a+=i)o=insertNode(a,e[a],e[a+1],o);else for(a=r-i;a>=t;a-=i)o=insertNode(a,e[a],e[a+1],o);return o&&equals(o,o.next)&&(removeNode(o),o=o.next),o}function filterPoints(e,t){if(!e)return e;t=t||e;let r=e,i;do{if(i=!1,r.steiner||!equals(r,r.next)&&0!==area(r.prev,r,r.next))r=r.next;else{if(removeNode(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function earcutLinked(i,n,a,o,s,l,c){if(i){!c&&l&&indexCurve(i,o,s,l);let e=i,t,r;for(;i.prev!==i.next;)if(t=i.prev,r=i.next,l?isEarHashed(i,o,s,l):isEar(i))n.push(t.i/a|0),n.push(i.i/a|0),n.push(r.i/a|0),removeNode(i),i=r.next,e=r.next;else if((i=r)===e){c?1===c?earcutLinked(i=cureLocalIntersections(filterPoints(i),n,a),n,a,o,s,l,2):2===c&&splitEarcut(i,n,a,o,s,l):earcutLinked(filterPoints(i),n,a,o,s,l,1);break}}}function isEar(e){var t=e.prev,r=e,e=e.next;if(0<=area(t,r,e))return!1;var i=t.x,n=r.x,a=e.x,o=t.y,s=r.y,l=e.y,c=i<n?i<a?i:a:n<a?n:a,d=o<s?o<l?o:l:s<l?s:l,h=n<i?a<i?i:a:a<n?n:a,u=s<o?l<o?o:l:l<s?s:l;let A=e.next;for(;A!==t;){if(A.x>=c&&A.x<=h&&A.y>=d&&A.y<=u&&pointInTriangle(i,o,n,s,a,l,A.x,A.y)&&0<=area(A.prev,A,A.next))return!1;A=A.next}return!0}function isEarHashed(e,t,r,i){var n=e.prev,a=e,o=e.next;if(0<=area(n,a,o))return!1;var s=n.x,l=a.x,c=o.x,d=n.y,h=a.y,u=o.y,A=s<l?s<c?s:c:l<c?l:c,p=d<h?d<u?d:u:h<u?h:u,m=l<s?c<s?s:c:c<l?l:c,f=h<d?u<d?d:u:u<h?h:u,g=zOrder(A,p,t,r,i),v=zOrder(m,f,t,r,i);let _=e.prevZ,y=e.nextZ;for(;_&&_.z>=g&&y&&y.z<=v;){if(_.x>=A&&_.x<=m&&_.y>=p&&_.y<=f&&_!==n&&_!==o&&pointInTriangle(s,d,l,h,c,u,_.x,_.y)&&0<=area(_.prev,_,_.next))return!1;if(_=_.prevZ,y.x>=A&&y.x<=m&&y.y>=p&&y.y<=f&&y!==n&&y!==o&&pointInTriangle(s,d,l,h,c,u,y.x,y.y)&&0<=area(y.prev,y,y.next))return!1;y=y.nextZ}for(;_&&_.z>=g;){if(_.x>=A&&_.x<=m&&_.y>=p&&_.y<=f&&_!==n&&_!==o&&pointInTriangle(s,d,l,h,c,u,_.x,_.y)&&0<=area(_.prev,_,_.next))return!1;_=_.prevZ}for(;y&&y.z<=v;){if(y.x>=A&&y.x<=m&&y.y>=p&&y.y<=f&&y!==n&&y!==o&&pointInTriangle(s,d,l,h,c,u,y.x,y.y)&&0<=area(y.prev,y,y.next))return!1;y=y.nextZ}return!0}function cureLocalIntersections(e,t,r){let i=e;do{var n=i.prev,a=i.next.next;!equals(n,a)&&intersects(n,i,i.next,a)&&locallyInside(n,a)&&locallyInside(a,n)&&(t.push(n.i/r|0),t.push(i.i/r|0),t.push(a.i/r|0),removeNode(i),removeNode(i.next),i=e=a),i=i.next}while(i!==e);return filterPoints(i)}function splitEarcut(e,t,r,i,n,a){let o=e;do{let e=o.next.next;for(;e!==o.prev;){var s;if(o.i!==e.i&&isValidDiagonal(o,e))return s=splitPolygon(o,e),o=filterPoints(o,o.next),s=filterPoints(s,s.next),earcutLinked(o,t,r,i,n,a,0),void earcutLinked(s,t,r,i,n,a,0);e=e.next}}while((o=o.next)!==e)}function eliminateHoles(e,t,r,i){var n=[];let a,o,s,l,c;for(a=0,o=t.length;a<o;a++)s=t[a]*i,l=a<o-1?t[a+1]*i:e.length,(c=linkedList(e,s,l,i,!1))===c.next&&(c.steiner=!0),n.push(getLeftmost(c));for(n.sort(compareX),a=0;a<n.length;a++)r=eliminateHole(n[a],r);return r}function compareX(e,t){return e.x-t.x}function eliminateHole(e,t){var r=findHoleBridge(e,t);return r?(filterPoints(e=splitPolygon(r,e),e.next),filterPoints(r,r.next)):t}function findHoleBridge(e,t){let r=t,i=-1/0,n;var a=e.x,o=e.y;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=a&&s>i&&(i=s,n=r.x<r.next.x?r:r.next,s===a))return n}}while((r=r.next)!==t);if(!n)return null;var l=n,c=n.x,d=n.y;let h=1/0,u;for(r=n;a>=r.x&&r.x>=c&&a!==r.x&&pointInTriangle(o<d?a:i,o,c,d,o<d?i:a,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(a-r.x),locallyInside(r,e))&&(u<h||u===h&&(r.x>n.x||r.x===n.x&&sectorContainsSector(n,r)))&&(n=r,h=u),(r=r.next)!==l;);return n}function sectorContainsSector(e,t){return area(e.prev,e,t.prev)<0&&area(t.next,e,e.next)<0}function indexCurve(e,t,r,i){let n=e;for(;0===n.z&&(n.z=zOrder(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,(n=n.next)!==e;);n.prevZ.nextZ=null,n.prevZ=null,sortLinked(n)}function sortLinked(e){let t,r,i,n,a,o,s,l,c=1;do{for(r=e,e=null,a=null,o=0;r;){for(o++,i=r,s=0,t=0;t<c&&(s++,i=i.nextZ);t++);for(l=c;0<s||0<l&&i;)0!==s&&(0===l||!i||r.z<=i.z)?(r=(n=r).nextZ,s--):(i=(n=i).nextZ,l--),a?a.nextZ=n:e=n,n.prevZ=a,a=n;r=i}}while(a.nextZ=null,c*=2,1<o);return e}function zOrder(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function getLeftmost(e){let t=e,r=e;for(;(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),(t=t.next)!==e;);return r}function pointInTriangle(e,t,r,i,n,a,o,s){return(e-o)*(a-s)<=(n-o)*(t-s)&&(r-o)*(t-s)<=(e-o)*(i-s)&&(n-o)*(i-s)<=(r-o)*(a-s)}function isValidDiagonal(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!intersectsPolygon(e,t)&&(locallyInside(e,t)&&locallyInside(t,e)&&middleInside(e,t)&&(area(e.prev,e,t.prev)||area(e,t.prev,t))||equals(e,t)&&0<area(e.prev,e,e.next)&&0<area(t.prev,t,t.next))}function area(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function equals(e,t){return e.x===t.x&&e.y===t.y}function intersects(e,t,r,i){var n=sign(area(e,t,r)),a=sign(area(e,t,i)),o=sign(area(r,i,e)),s=sign(area(r,i,t));return n!==a&&o!==s||!!(0===n&&onSegment(e,r,t)||0===a&&onSegment(e,i,t)||0===o&&onSegment(r,e,i)||0===s&&onSegment(r,t,i))}function onSegment(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function sign(e){return 0<e?1:e<0?-1:0}function intersectsPolygon(e,t){let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&intersects(r,r.next,e,t))return!0}while((r=r.next)!==e);return!1}function locallyInside(e,t){return area(e.prev,e,e.next)<0?0<=area(e,t,e.next)&&0<=area(e,e.prev,t):area(e,t,e.prev)<0||area(e,e.next,t)<0}function middleInside(e,t){let r=e,i=!1;for(var n=(e.x+t.x)/2,a=(e.y+t.y)/2;r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),(r=r.next)!==e;);return i}function splitPolygon(e,t){var r=new Node$1(e.i,e.x,e.y),i=new Node$1(t.i,t.x,t.y),n=e.next,a=t.prev;return(e.next=t).prev=e,(r.next=n).prev=r,(i.next=r).prev=i,(a.next=i).prev=a,i}function insertNode(e,t,r,i){e=new Node$1(e,t,r);return i?(e.next=i.next,(e.prev=i).next.prev=e,i.next=e):(e.prev=e).next=e,e}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node$1(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(r,i,n,a){let o=0;for(let e=i,t=n-a;e<n;e+=a)o+=(r[t]-r[e])*(r[e+1]+r[t+1]),t=e;return o}class ShapeUtils{static area(r){var i=r.length;let n=0;for(let e=i-1,t=0;t<i;e=t++)n+=r[e].x*r[t].y-r[t].x*r[e].y;return.5*n}static isClockWise(e){return ShapeUtils.area(e)<0}static triangulateShape(e,t){var r=[],i=[],n=[];removeDupEndPts(e),addContour(r,e);let a=e.length;t.forEach(removeDupEndPts);for(let e=0;e<t.length;e++)i.push(a),a+=t[e].length,addContour(r,t[e]);var o=Earcut.triangulate(r,i);for(let e=0;e<o.length;e+=3)n.push(o.slice(e,e+3));return n}}function removeDupEndPts(e){var t=e.length;2<t&&e[t-1].equals(e[0])&&e.pop()}function addContour(t,r){for(let e=0;e<r.length;e++)t.push(r[e].x),t.push(r[e].y)}class ExtrudeGeometry extends BufferGeometry{constructor(r=new Shape([new Vector2(.5,.5),new Vector2(-.5,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),J={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:r,options:J},r=Array.isArray(r)?r:[r];const Z=this,ee=[],te=[];for(let e=0,t=r.length;e<t;e++)!function(e){const i=[],P=void 0!==J.curveSegments?J.curveSegments:12,A=void 0!==J.steps?J.steps:1,r=void 0!==J.depth?J.depth:1;let o=void 0===J.bevelEnabled||J.bevelEnabled,t=void 0!==J.bevelThickness?J.bevelThickness:.2,n=void 0!==J.bevelSize?J.bevelSize:t-.1,a=void 0!==J.bevelOffset?J.bevelOffset:0,p=void 0!==J.bevelSegments?J.bevelSegments:3;const s=J.extrudePath,O=void 0!==J.UVGenerator?J.UVGenerator:WorldUVGenerator;let l,c=!1,d,h,u,m;s&&(l=s.getSpacedPoints(A),c=!0,o=!1,d=s.computeFrenetFrames(A,!1),h=new Vector3,u=new Vector3,m=new Vector3);o||(p=0,t=0,n=0,a=0);e=e.extractPoints(P);let f=e.shape;const g=e.holes,D=!ShapeUtils.isClockWise(f);if(D){f=f.reverse();for(let e=0,t=g.length;e<t;e++){var H=g[e];ShapeUtils.isClockWise(H)&&(g[e]=H.reverse())}}const v=ShapeUtils.triangulateShape(f,g),_=f;for(let e=0,t=g.length;e<t;e++){var k=g[e];f=f.concat(k)}function y(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,r)}const E=f.length,T=v.length;function V(e,t,r){let i,n,a;var o=e.x-t.x,s=e.y-t.y,l=r.x-e.x,c=r.y-e.y,d=o*o+s*s;if(Math.abs(o*c-s*l)>Number.EPSILON){var h=Math.sqrt(d),u=Math.sqrt(l*l+c*c),A=t.x-s/h,t=t.y+o/h,h=((r.x-c/u-A)*c-(r.y+l/u-t)*l)/(o*c-s*l),r=(i=A+o*h-e.x,n=t+s*h-e.y,i*i+n*n);if(r<=2)return new Vector2(i,n);a=Math.sqrt(r/2)}else{let e=!1;o>Number.EPSILON?l>Number.EPSILON&&(e=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(s)===Math.sign(c)&&(e=!0),a=e?(i=-s,n=o,Math.sqrt(d)):(i=o,n=s,Math.sqrt(d/2))}return new Vector2(i/a,n/a)}var x=[];for(let e=0,t=_.length,r=t-1,i=e+1;e<t;e++,r++,i++)r===t&&(r=0),i===t&&(i=0),x[e]=V(_[e],_[r],_[i]);var b=[];let w,C=x.concat();for(let e=0,t=g.length;e<t;e++){var S=g[e];w=[];for(let e=0,t=S.length,r=t-1,i=e+1;e<t;e++,r++,i++)r===t&&(r=0),i===t&&(i=0),w[e]=V(S[e],S[r],S[i]);b.push(w),C=C.concat(w)}for(let e=0;e<p;e++){var Q=e/p,G=t*Math.cos(Q*Math.PI/2);const M=n*Math.sin(Q*Math.PI/2)+a;for(let e=0,t=_.length;e<t;e++){var z=y(_[e],x[e],M);L(z.x,z.y,-G)}for(let e=0,t=g.length;e<t;e++){var $=g[e];w=b[e];for(let e=0,t=$.length;e<t;e++){var W=y($[e],w[e],M);L(W.x,W.y,-G)}}}const M=n+a;for(let e=0;e<E;e++){var B=o?y(f[e],C[e],M):f[e];c?(u.copy(d.normals[0]).multiplyScalar(B.x),h.copy(d.binormals[0]).multiplyScalar(B.y),m.copy(l[0]).add(u).add(h),L(m.x,m.y,m.z)):L(B.x,B.y,0)}for(let t=1;t<=A;t++)for(let e=0;e<E;e++){var N=o?y(f[e],C[e],M):f[e];c?(u.copy(d.normals[t]).multiplyScalar(N.x),h.copy(d.binormals[t]).multiplyScalar(N.y),m.copy(l[t]).add(u).add(h),L(m.x,m.y,m.z)):L(N.x,N.y,r/A*t)}for(let e=p-1;0<=e;e--){var K=e/p,j=t*Math.cos(K*Math.PI/2);const M=n*Math.sin(K*Math.PI/2)+a;for(let e=0,t=_.length;e<t;e++){var X=y(_[e],x[e],M);L(X.x,X.y,r+j)}for(let e=0,t=g.length;e<t;e++){var Y=g[e];w=b[e];for(let e=0,t=Y.length;e<t;e++){var R=y(Y[e],w[e],M);c?L(R.x,R.y+l[A-1].y,l[A-1].x+j):L(R.x,R.y,r+j)}}}function q(e,i){let t=e.length;for(;0<=--t;){var n=t;let r=t-1;r<0&&(r=e.length-1);for(let e=0,t=A+2*p;e<t;e++){var a=E*e,o=E*(e+1),s=i+r+a,l=i+r+o,c=(u=h=d=c=void 0,i+n+a),d=s,h=l,u=i+n+o;I(c),I(d),I(u),I(d),I(h),I(u),c=ee.length/3,F((d=O.generateSideWallUV(Z,ee,c-6,c-3,c-2,c-1))[0]),F(d[1]),F(d[3]),F(d[1]),F(d[2]),F(d[3])}}}function L(e,t,r){i.push(e),i.push(t),i.push(r)}function U(e,t,r){I(e),I(t),I(r);e=ee.length/3,t=O.generateTopUV(Z,ee,e-3,e-2,e-1);F(t[0]),F(t[1]),F(t[2])}function I(e){ee.push(i[3*e+0]),ee.push(i[3*e+1]),ee.push(i[3*e+2])}function F(e){te.push(e.x),te.push(e.y)}(function(){var e,t=ee.length/3;if(o){let t=0*E;for(let e=0;e<T;e++){var r=v[e];U(r[2]+t,r[1]+t,r[0]+t)}e=A+2*p,t=E*e;for(let e=0;e<T;e++){var i=v[e];U(i[0]+t,i[1]+t,i[2]+t)}}else{for(let e=0;e<T;e++){var n=v[e];U(n[2],n[1],n[0])}for(let e=0;e<T;e++){var a=v[e];U(a[0]+E*A,a[1]+E*A,a[2]+E*A)}}Z.addGroup(t,ee.length/3-t,0)})(),function(){var e=ee.length/3;let r=0;q(_,r),r+=_.length;for(let e=0,t=g.length;e<t;e++){var i=g[e];q(i,r),r+=i.length}Z.addGroup(e,ee.length/3-e,1)}()}(r[e]);this.setAttribute("position",new Float32BufferAttribute(ee,3)),this.setAttribute("uv",new Float32BufferAttribute(te,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){var e=super.toJSON();return toJSON$1(this.parameters.shapes,this.parameters.options,e)}static fromJSON(r,i){var n=[];for(let e=0,t=r.shapes.length;e<t;e++){var a=i[r.shapes[e]];n.push(a)}var e=r.options.extrudePath;return void 0!==e&&(r.options.extrudePath=(new Curves[e.type]).fromJSON(e)),new ExtrudeGeometry(n,r.options)}}const WorldUVGenerator={generateTopUV:function(e,t,r,i,n){var a=t[3*r],r=t[3*r+1],o=t[3*i],i=t[3*i+1],s=t[3*n],t=t[3*n+1];return[new Vector2(a,r),new Vector2(o,i),new Vector2(s,t)]},generateSideWallUV:function(e,t,r,i,n,a){var o=t[3*r],s=t[3*r+1],r=t[3*r+2],l=t[3*i],c=t[3*i+1],i=t[3*i+2],d=t[3*n],h=t[3*n+1],n=t[3*n+2],u=t[3*a],A=t[3*a+1],t=t[3*a+2];return Math.abs(s-c)<Math.abs(o-l)?[new Vector2(o,1-r),new Vector2(l,1-i),new Vector2(d,1-n),new Vector2(u,1-t)]:[new Vector2(s,1-r),new Vector2(c,1-i),new Vector2(h,1-n),new Vector2(A,1-t)]}};function toJSON$1(r,e,i){if(i.shapes=[],Array.isArray(r))for(let e=0,t=r.length;e<t;e++){var n=r[e];i.shapes.push(n.uuid)}else i.shapes.push(r.uuid);return i.options=Object.assign({},e),void 0!==e.extrudePath&&(i.options.extrudePath=e.extrudePath.toJSON()),i}class IcosahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){var r=(1+Math.sqrt(5))/2;super([-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new IcosahedronGeometry(e.radius,e.detail)}}class OctahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new OctahedronGeometry(e.radius,e.detail)}}class RingGeometry extends BufferGeometry{constructor(e=.5,t=1,r=32,i=1,n=0,a=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:n,thetaLength:a},r=Math.max(3,r);var o=[],s=[],l=[],c=[];let d=e;var h=(t-e)/(i=Math.max(1,i)),u=new Vector3,A=new Vector2;for(let e=0;e<=i;e++){for(let e=0;e<=r;e++){var p=n+e/r*a;u.x=d*Math.cos(p),u.y=d*Math.sin(p),s.push(u.x,u.y,u.z),l.push(0,0,1),A.x=(u.x/t+1)/2,A.y=(u.y/t+1)/2,c.push(A.x,A.y)}d+=h}for(let e=0;e<i;e++){var m=e*(r+1);for(let e=0;e<r;e++){var f=e+m,g=f+r+1,v=f+r+2,_=f+1;o.push(f,g,_),o.push(g,v,_)}}this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(s,3)),this.setAttribute("normal",new Float32BufferAttribute(l,3)),this.setAttribute("uv",new Float32BufferAttribute(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new RingGeometry(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class ShapeGeometry extends BufferGeometry{constructor(t=new Shape([new Vector2(0,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),u=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:u};const A=[],p=[],m=[],f=[];let r=0,g=0;if(!1===Array.isArray(t))i(t);else for(let e=0;e<t.length;e++)i(t[e]),this.addGroup(r,g,e),r+=g,g=0;function i(e){var r=p.length/3,e=e.extractPoints(u);let i=e.shape;var n=e.holes;!1===ShapeUtils.isClockWise(i)&&(i=i.reverse());for(let e=0,t=n.length;e<t;e++){var a=n[e];!0===ShapeUtils.isClockWise(a)&&(n[e]=a.reverse())}var o=ShapeUtils.triangulateShape(i,n);for(let e=0,t=n.length;e<t;e++){var s=n[e];i=i.concat(s)}for(let e=0,t=i.length;e<t;e++){var l=i[e];p.push(l.x,l.y,0),m.push(0,0,1),f.push(l.x,l.y)}for(let e=0,t=o.length;e<t;e++){var c=o[e],d=c[0]+r,h=c[1]+r,c=c[2]+r;A.push(d,h,c),g+=3}}this.setIndex(A),this.setAttribute("position",new Float32BufferAttribute(p,3)),this.setAttribute("normal",new Float32BufferAttribute(m,3)),this.setAttribute("uv",new Float32BufferAttribute(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){var e=super.toJSON();return toJSON(this.parameters.shapes,e)}static fromJSON(r,i){var n=[];for(let e=0,t=r.shapes.length;e<t;e++){var a=i[r.shapes[e]];n.push(a)}return new ShapeGeometry(n,r.curveSegments)}}function toJSON(r,i){if(i.shapes=[],Array.isArray(r))for(let e=0,t=r.length;e<t;e++){var n=r[e];i.shapes.push(n.uuid)}else i.shapes.push(r.uuid);return i}class SphereGeometry extends BufferGeometry{constructor(r=1,i=32,n=16,a=0,o=2*Math.PI,s=0,l=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:r,widthSegments:i,heightSegments:n,phiStart:a,phiLength:o,thetaStart:s,thetaLength:l},i=Math.max(3,Math.floor(i)),n=Math.max(2,Math.floor(n));var c=Math.min(s+l,Math.PI);let d=0;var h=[],u=new Vector3,A=new Vector3,p=[],m=[],f=[],g=[];for(let e=0;e<=n;e++){var v=[],_=e/n;let t=0;0===e&&0===s?t=.5/i:e===n&&c===Math.PI&&(t=-.5/i);for(let e=0;e<=i;e++){var y=e/i;u.x=-r*Math.cos(a+y*o)*Math.sin(s+_*l),u.y=r*Math.cos(s+_*l),u.z=r*Math.sin(a+y*o)*Math.sin(s+_*l),m.push(u.x,u.y,u.z),A.copy(u).normalize(),f.push(A.x,A.y,A.z),g.push(y+t,1-_),v.push(d++)}h.push(v)}for(let t=0;t<n;t++)for(let e=0;e<i;e++){var E=h[t][e+1],T=h[t][e],x=h[t+1][e],b=h[t+1][e+1];(0!==t||0<s)&&p.push(E,T,b),(t!==n-1||c<Math.PI)&&p.push(T,x,b)}this.setIndex(p),this.setAttribute("position",new Float32BufferAttribute(m,3)),this.setAttribute("normal",new Float32BufferAttribute(f,3)),this.setAttribute("uv",new Float32BufferAttribute(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new SphereGeometry(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class TetrahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new TetrahedronGeometry(e.radius,e.detail)}}class TorusGeometry extends BufferGeometry{constructor(r=1,i=.4,n=12,a=48,o=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:r,tube:i,radialSegments:n,tubularSegments:a,arc:o},n=Math.floor(n),a=Math.floor(a);var s=[],l=[],c=[],d=[],h=new Vector3,u=new Vector3,A=new Vector3;for(let t=0;t<=n;t++)for(let e=0;e<=a;e++){var p=e/a*o,m=t/n*Math.PI*2;u.x=(r+i*Math.cos(m))*Math.cos(p),u.y=(r+i*Math.cos(m))*Math.sin(p),u.z=i*Math.sin(m),l.push(u.x,u.y,u.z),h.x=r*Math.cos(p),h.y=r*Math.sin(p),A.subVectors(u,h).normalize(),c.push(A.x,A.y,A.z),d.push(e/a),d.push(t/n)}for(let t=1;t<=n;t++)for(let e=1;e<=a;e++){var f=(a+1)*t+e-1,g=(a+1)*(t-1)+e-1,v=(a+1)*(t-1)+e,_=(a+1)*t+e;s.push(f,g,_),s.push(g,v,_)}this.setIndex(s),this.setAttribute("position",new Float32BufferAttribute(l,3)),this.setAttribute("normal",new Float32BufferAttribute(c,3)),this.setAttribute("uv",new Float32BufferAttribute(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new TorusGeometry(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class TorusKnotGeometry extends BufferGeometry{constructor(e=1,r=.4,i=64,n=8,a=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:r,tubularSegments:i,radialSegments:n,p:a,q:o},i=Math.floor(i),n=Math.floor(n);var s=[],l=[],c=[],d=[],h=new Vector3,u=new Vector3,A=new Vector3,p=new Vector3,m=new Vector3,f=new Vector3,g=new Vector3;for(let t=0;t<=i;++t){var v=t/i*a*Math.PI*2;w(v,a,o,e,A),w(.01+v,a,o,e,p),f.subVectors(p,A),g.addVectors(p,A),m.crossVectors(f,g),g.crossVectors(m,f),m.normalize(),g.normalize();for(let e=0;e<=n;++e){var _=e/n*Math.PI*2,y=-r*Math.cos(_),_=r*Math.sin(_);h.x=A.x+(y*g.x+_*m.x),h.y=A.y+(y*g.y+_*m.y),h.z=A.z+(y*g.z+_*m.z),l.push(h.x,h.y,h.z),u.subVectors(h,A).normalize(),c.push(u.x,u.y,u.z),d.push(t/i),d.push(e/n)}}for(let t=1;t<=i;t++)for(let e=1;e<=n;e++){var E=(n+1)*(t-1)+(e-1),T=(n+1)*t+(e-1),x=(n+1)*t+e,b=(n+1)*(t-1)+e;s.push(E,T,b),s.push(T,x,b)}function w(e,t,r,i,n){var a=Math.cos(e),o=Math.sin(e),r=r/t*e,t=Math.cos(r);n.x=i*(2+t)*.5*a,n.y=i*(2+t)*o*.5,n.z=i*Math.sin(r)*.5}this.setIndex(s),this.setAttribute("position",new Float32BufferAttribute(l,3)),this.setAttribute("normal",new Float32BufferAttribute(c,3)),this.setAttribute("uv",new Float32BufferAttribute(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new TorusKnotGeometry(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class TubeGeometry extends BufferGeometry{constructor(a=new QuadraticBezierCurve3(new Vector3(-1,-1,0),new Vector3(-1,1,0),new Vector3(1,1,0)),o=64,s=1,l=8,e=!1){super(),this.type="TubeGeometry",this.parameters={path:a,tubularSegments:o,radius:s,radialSegments:l,closed:e};const c=a.computeFrenetFrames(o,e),d=(this.tangents=c.tangents,this.normals=c.normals,this.binormals=c.binormals,new Vector3),h=new Vector3,r=new Vector2;let u=new Vector3;const A=[],p=[],i=[],n=[];for(let e=0;e<o;e++)t(e);t(!1===e?o:0);for(let t=0;t<=o;t++)for(let e=0;e<=l;e++)r.x=t/o,r.y=e/l,i.push(r.x,r.y);for(let t=1;t<=o;t++)for(let e=1;e<=l;e++){var m=(l+1)*(t-1)+(e-1),f=(l+1)*t+(e-1),g=(l+1)*t+e,v=(l+1)*(t-1)+e;n.push(m,f,v),n.push(f,g,v)}function t(e){u=a.getPointAt(e/o,u);var t=c.normals[e],r=c.binormals[e];for(let e=0;e<=l;e++){var i=e/l*Math.PI*2,n=Math.sin(i),i=-Math.cos(i);h.x=i*t.x+n*r.x,h.y=i*t.y+n*r.y,h.z=i*t.z+n*r.z,h.normalize(),p.push(h.x,h.y,h.z),d.x=u.x+s*h.x,d.y=u.y+s*h.y,d.z=u.z+s*h.z,A.push(d.x,d.y,d.z)}}this.setIndex(n),this.setAttribute("position",new Float32BufferAttribute(A,3)),this.setAttribute("normal",new Float32BufferAttribute(p,3)),this.setAttribute("uv",new Float32BufferAttribute(i,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){var e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new TubeGeometry((new Curves[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class WireframeGeometry extends BufferGeometry{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){var i=[],n=new Set,a=new Vector3,o=new Vector3;if(null!==e.index){var s=e.attributes.position,l=e.index;let r=e.groups;for(let e=0,t=(r=0===r.length?[{start:0,count:l.count,materialIndex:0}]:r).length;e<t;++e){var c=r[e],d=c.start;for(let t=d,e=d+c.count;t<e;t+=3)for(let e=0;e<3;e++){var h=l.getX(t+e),u=l.getX(t+(e+1)%3);a.fromBufferAttribute(s,h),o.fromBufferAttribute(s,u),!0===isUniqueEdge(a,o,n)&&(i.push(a.x,a.y,a.z),i.push(o.x,o.y,o.z))}}}else{var r=e.attributes.position;for(let t=0,e=r.count/3;t<e;t++)for(let e=0;e<3;e++){var A=3*t+e,p=3*t+(e+1)%3;a.fromBufferAttribute(r,A),o.fromBufferAttribute(r,p),!0===isUniqueEdge(a,o,n)&&(i.push(a.x,a.y,a.z),i.push(o.x,o.y,o.z))}}this.setAttribute("position",new Float32BufferAttribute(i,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function isUniqueEdge(e,t,r){var i=`${e.x},${e.y},${e.z}-${t.x},${t.y},`+t.z,t=`${t.x},${t.y},${t.z}-${e.x},${e.y},`+e.z;return!0!==r.has(i)&&!0!==r.has(t)&&(r.add(i),r.add(t),!0)}var Geometries=Object.freeze({__proto__:null,BoxGeometry:BoxGeometry,CapsuleGeometry:CapsuleGeometry,CircleGeometry:CircleGeometry,ConeGeometry:ConeGeometry,CylinderGeometry:CylinderGeometry,DodecahedronGeometry:DodecahedronGeometry,EdgesGeometry:EdgesGeometry,ExtrudeGeometry:ExtrudeGeometry,IcosahedronGeometry:IcosahedronGeometry,LatheGeometry:LatheGeometry,OctahedronGeometry:OctahedronGeometry,PlaneGeometry:PlaneGeometry,PolyhedronGeometry:PolyhedronGeometry,RingGeometry:RingGeometry,ShapeGeometry:ShapeGeometry,SphereGeometry:SphereGeometry,TetrahedronGeometry:TetrahedronGeometry,TorusGeometry:TorusGeometry,TorusKnotGeometry:TorusKnotGeometry,TubeGeometry:TubeGeometry,WireframeGeometry:WireframeGeometry});class ShadowMaterial extends Material{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class RawShaderMaterial extends ShaderMaterial{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class MeshStandardMaterial extends Material{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class MeshPhysicalMaterial extends MeshStandardMaterial{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return clamp(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Color(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Color(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Color(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){0<this._anisotropy!=0<e&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){0<this._clearcoat!=0<e&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){0<this._iridescence!=0<e&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){0<this._sheen!=0<e&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){0<this._transmission!=0<e&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class MeshPhongMaterial extends Material{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class MeshToonMaterial extends Material{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class MeshNormalMaterial extends Material{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class MeshLambertMaterial extends Material{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class MeshMatcapMaterial extends Material{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class LineDashedMaterial extends LineBasicMaterial{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function arraySlice(e,t,r){return isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==r?r:e.length)):e.slice(t,r)}function convertArray(e,t,r){return!e||!r&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function getKeyframeOrder(r){var t=r.length,i=new Array(t);for(let e=0;e!==t;++e)i[e]=e;return i.sort(function(e,t){return r[e]-r[t]}),i}function sortedArray(r,i,n){var a=r.length,o=new r.constructor(a);for(let e=0,t=0;t!==a;++e){var s=n[e]*i;for(let e=0;e!==i;++e)o[t++]=r[s+e]}return o}function flattenJSON(t,r,i,n){let a=1,o=t[0];for(;void 0!==o&&void 0===o[n];)o=t[a++];if(void 0!==o){let e=o[n];if(void 0!==e)if(Array.isArray(e))for(;void 0!==(e=o[n])&&(r.push(o.time),i.push.apply(i,e)),void 0!==(o=t[a++]););else if(void 0!==e.toArray)for(;void 0!==(e=o[n])&&(r.push(o.time),e.toArray(i,i.length)),void 0!==(o=t[a++]););else for(;void 0!==(e=o[n])&&(r.push(o.time),i.push(e)),void 0!==(o=t[a++]););}}function subclip(e,t,r,i,n=30){var a=e.clone(),o=(a.name=t,[]);for(let e=0;e<a.tracks.length;++e){var s=a.tracks[e],l=s.getValueSize(),c=[],d=[];for(let t=0;t<s.times.length;++t){var h=s.times[t]*n;if(!(h<r||i<=h)){c.push(s.times[t]);for(let e=0;e<l;++e)d.push(s.values[t*l+e])}}0!==c.length&&(s.times=convertArray(c,s.times.constructor),s.values=convertArray(d,s.values.constructor),o.push(s))}a.tracks=o;let u=1/0;for(let e=0;e<a.tracks.length;++e)u>a.tracks[e].times[0]&&(u=a.tracks[e].times[0]);for(let e=0;e<a.tracks.length;++e)a.tracks[e].shift(-1*u);return a.resetDuration(),a}function makeClipAdditive(t,e=0,r=t,i=30){var n=r.tracks.length,a=e/(i=i<=0?30:i);for(let e=0;e<n;++e){const f=r.tracks[e],g=f.ValueTypeName;if("bool"!==g&&"string"!==g){var o=t.tracks.find(function(e){return e.name===f.name&&e.ValueTypeName===g});if(void 0!==o){let e=0;var s=f.getValueSize();f.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(e=s/3);let t=0;var l,c,d,h=o.getValueSize(),u=(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(t=h/3),f.times.length-1);let r;r=a<=f.times[0]?(c=s-(l=e),arraySlice(f.values,l,c)):a>=f.times[u]?(c=(l=u*s+e)+s-e,arraySlice(f.values,l,c)):(u=f.createInterpolant(),d=s-(s=e),u.evaluate(a),arraySlice(u.resultBuffer,s,d)),"quaternion"===g&&(new Quaternion).fromArray(r).normalize().conjugate().toArray(r);var A=o.times.length;for(let e=0;e<A;++e){var p=e*h+t;if("quaternion"===g)Quaternion.multiplyQuaternionsFlat(o.values,p,r,0,o.values,p);else{var m=h-2*t;for(let e=0;e<m;++e)o.values[p+e]-=r[e]}}}}}return t.blendMode=AdditiveAnimationBlendMode,t}const AnimationUtils={arraySlice:arraySlice,convertArray:convertArray,isTypedArray:isTypedArray,getKeyframeOrder:getKeyframeOrder,sortedArray:sortedArray,flattenJSON:flattenJSON,subclip:subclip,makeClipAdditive:makeClipAdditive};class Interpolant{constructor(e,t,r,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(r),this.sampleValues=t,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(t){var r=this.parameterPositions;let i=this._cachedIndex,n=r[i],a=r[i-1];e:{t:{let e;r:{i:if(!(t<n)){for(var o=i+2;;){if(void 0===n){if(t<a)break i;return i=r.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===o)break;if(a=n,t<(n=r[++i]))break t}e=r.length;break r}if(t>=a)break e;var s=r[1];t<s&&(i=2,a=s);for(var l=i-2;;){if(void 0===a)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(n=a,t>=(a=r[--i-1]))break t}e=i,i=0}for(;i<e;){var c=i+e>>>1;t<r[c]?e=c:i=1+c}if(n=r[i],void 0===(a=r[i-1]))return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===n)return i=r.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,a,n)}return this.interpolate_(i,a,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){var t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i;for(let e=0;e!==i;++e)t[e]=r[n+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class CubicInterpolant extends Interpolant{constructor(e,t,r,i){super(e,t,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding}}intervalChanged_(e,t,r){var i=this.parameterPositions;let n=e-2,a=e+1,o=i[n],s=i[a];if(void 0===o)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:n=e,o=2*t-r;break;case WrapAroundEnding:n=i.length-2,o=t+i[n]-i[n+1];break;default:n=e,o=r}if(void 0===s)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:a=e,s=2*r-t;break;case WrapAroundEnding:a=1,s=r+i[1]-i[0];break;default:a=e-1,s=t}var l=.5*(r-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-r),this._offsetPrev=n*c,this._offsetNext=a*c}interpolate_(e,t,r,i){var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=this._offsetPrev,d=this._offsetNext,e=this._weightPrev,h=this._weightNext,r=(r-t)/(i-t),i=r*r,t=i*r,u=-e*t+2*e*i-e*r,A=(1+e)*t+(-1.5-2*e)*i+(-.5+e)*r+1,p=(-1-h)*t+(1.5+h)*i+.5*r,m=h*t-h*i;for(let e=0;e!==o;++e)n[e]=u*a[c+e]+A*a[l+e]+p*a[s+e]+m*a[d+e];return n}}class LinearInterpolant extends Interpolant{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=(r-t)/(i-t),d=1-c;for(let e=0;e!==o;++e)n[e]=a[l+e]*d+a[s+e]*c;return n}}class DiscreteInterpolant extends Interpolant{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class KeyframeTrack{constructor(e,t,r,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=convertArray(t,this.TimeBufferType),this.values=convertArray(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){var t=e.constructor;let r;return t.toJSON!==this.toJSON?r=t.toJSON(e):(r={name:e.name,times:convertArray(e.times,Array),values:convertArray(e.values,Array)},(t=e.getInterpolation())!==e.DefaultInterpolation&&(r.interpolation=t)),r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new LinearInterpolant(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new CubicInterpolant(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case InterpolateDiscrete:t=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:t=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}console.warn("THREE.KeyframeTrack:",r)}else this.createInterpolant=t;return this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}}getValueSize(){return this.values.length/this.times.length}shift(r){if(0!==r){var i=this.times;for(let e=0,t=i.length;e!==t;++e)i[e]+=r}return this}scale(r){if(1!==r){var i=this.times;for(let e=0,t=i.length;e!==t;++e)i[e]*=r}return this}trim(e,t){var r,i=this.times,n=i.length;let a=0,o=n-1;for(;a!==n&&i[a]<e;)++a;for(;-1!==o&&i[o]>t;)--o;return++o,0===a&&o===n||(a>=o&&(o=Math.max(o,1),a=o-1),r=this.getValueSize(),this.times=arraySlice(i,a,o),this.values=arraySlice(this.values,a*r,o*r)),this}validate(){let r=!0;var e=this.getValueSize(),t=(e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),r=!1),this.times),i=this.values,n=t.length;0===n&&(console.error("THREE.KeyframeTrack: Track is empty.",this),r=!1);let a=null;for(let e=0;e!==n;e++){var o=t[e];if("number"==typeof o&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,o),r=!1;break}if(null!==a&&a>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,o,a),r=!1;break}a=o}if(void 0!==i&&isTypedArray(i))for(let e=0,t=i.length;e!==t;++e){var s=i[e];if(isNaN(s)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,s),r=!1;break}}return r}optimize(){var r=arraySlice(this.times),i=arraySlice(this.values),n=this.getValueSize(),a=this.getInterpolation()===InterpolateSmooth,o=r.length-1;let s=1;for(let e=1;e<o;++e){let t=!1;var l=r[e];if(l!==r[e+1]&&(1!==e||l!==r[0]))if(a)t=!0;else{var c=e*n,d=c-n,h=c+n;for(let e=0;e!==n;++e){var u=i[c+e];if(u!==i[d+e]||u!==i[h+e]){t=!0;break}}}if(t){if(e!==s){r[s]=r[e];var A=e*n,p=s*n;for(let e=0;e!==n;++e)i[p+e]=i[A+e]}++s}}if(0<o){r[s]=r[o];for(let e=o*n,t=s*n,r=0;r!==n;++r)i[t+r]=i[e+r];++s}return s!==r.length?(this.times=arraySlice(r,0,s),this.values=arraySlice(i,0,s*n)):(this.times=r,this.values=i),this}clone(){var e=arraySlice(this.times,0),t=arraySlice(this.values,0),e=new this.constructor(this.name,e,t);return e.createInterpolant=this.createInterpolant,e}}KeyframeTrack.prototype.TimeBufferType=Float32Array,KeyframeTrack.prototype.ValueBufferType=Float32Array,KeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;class BooleanKeyframeTrack extends KeyframeTrack{}BooleanKeyframeTrack.prototype.ValueTypeName="bool",BooleanKeyframeTrack.prototype.ValueBufferType=Array,BooleanKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete,BooleanKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0,BooleanKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class ColorKeyframeTrack extends KeyframeTrack{}ColorKeyframeTrack.prototype.ValueTypeName="color";class NumberKeyframeTrack extends KeyframeTrack{}NumberKeyframeTrack.prototype.ValueTypeName="number";class QuaternionLinearInterpolant extends Interpolant{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(r-t)/(i-t);let l=e*o;for(var c=l+o;l!==c;l+=4)Quaternion.slerpFlat(n,0,a,l-o,a,l,s);return n}}class QuaternionKeyframeTrack extends KeyframeTrack{InterpolantFactoryMethodLinear(e){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),e)}}QuaternionKeyframeTrack.prototype.ValueTypeName="quaternion",QuaternionKeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear,QuaternionKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class StringKeyframeTrack extends KeyframeTrack{}StringKeyframeTrack.prototype.ValueTypeName="string",StringKeyframeTrack.prototype.ValueBufferType=Array,StringKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete,StringKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0,StringKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class VectorKeyframeTrack extends KeyframeTrack{}VectorKeyframeTrack.prototype.ValueTypeName="vector";class AnimationClip{constructor(e,t=-1,r,i=NormalAnimationBlendMode){this.name=e,this.tracks=r,this.duration=t,this.blendMode=i,this.uuid=generateUUID(),this.duration<0&&this.resetDuration()}static parse(e){var r=[],i=e.tracks,n=1/(e.fps||1);for(let e=0,t=i.length;e!==t;++e)r.push(parseKeyframeTrack(i[e]).scale(n));var t=new this(e.name,e.duration,r,e.blendMode);return t.uuid=e.uuid,t}static toJSON(e){var r=[],i=e.tracks,e={name:e.name,duration:e.duration,tracks:r,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,t=i.length;e!==t;++e)r.push(KeyframeTrack.toJSON(i[e]));return e}static CreateFromMorphTargetSequence(e,i,n,a){var o=i.length,s=[];for(let r=0;r<o;r++){let e=[],t=[];e.push((r+o-1)%o,r,(r+1)%o),t.push(0,1,0);var l=getKeyframeOrder(e);e=sortedArray(e,1,l),t=sortedArray(t,1,l),a||0!==e[0]||(e.push(o),t.push(t[0])),s.push(new NumberKeyframeTrack(".morphTargetInfluences["+i[r].name+"]",e,t).scale(1/n))}return new this(e,-1,s)}static findByName(e,t){let r=e;Array.isArray(e)||(r=e.geometry&&e.geometry.animations||e.animations);for(let e=0;e<r.length;e++)if(r[e].name===t)return r[e];return null}static CreateClipsFromMorphTargetSequences(r,e,t){var i={},n=/^([\w-]*?)([\d]+)$/;for(let e=0,t=r.length;e<t;e++){var a=r[e],o=a.name.match(n);if(o&&1<o.length){o=o[1];let e=i[o];e||(i[o]=e=[]),e.push(a)}}var s=[];for(const l in i)s.push(this.CreateFromMorphTargetSequence(l,i[l],e,t));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;function r(e,t,r,i,n){var a;0!==r.length&&(flattenJSON(r,r=[],a=[],i),0!==r.length)&&n.push(new e(t,r,a))}var i=[],n=e.name||"default",a=e.fps||30,o=e.blendMode;let s=e.length||-1;var l=e.hierarchy||[];for(let e=0;e<l.length;e++){var c=l[e].keys;if(c&&0!==c.length)if(c[0].morphTargets){var d={};let t;for(t=0;t<c.length;t++)if(c[t].morphTargets)for(let e=0;e<c[t].morphTargets.length;e++)d[c[t].morphTargets[e]]=-1;for(const m in d){var h=[],u=[];for(let e=0;e!==c[t].morphTargets.length;++e){var A=c[t];h.push(A.time),u.push(A.morphTarget===m?1:0)}i.push(new NumberKeyframeTrack(".morphTargetInfluence["+m+"]",h,u))}s=d.length*a}else{var p=".bones["+t[e].name+"]";r(VectorKeyframeTrack,p+".position",c,"pos",i),r(QuaternionKeyframeTrack,p+".quaternion",c,"rot",i),r(VectorKeyframeTrack,p+".scale",c,"scl",i)}}return 0===i.length?null:new this(n,s,i,o)}resetDuration(){let r=0;for(let e=0,t=this.tracks.length;e!==t;++e){var i=this.tracks[e];r=Math.max(r,i.times[i.times.length-1])}return this.duration=r,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){var t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function getTrackTypeForValueTypeName(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function parseKeyframeTrack(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t,r,i=getTrackTypeForValueTypeName(e.type);return void 0===e.times&&(flattenJSON(e.keys,t=[],r=[],"value"),e.times=t,e.values=r),void 0!==i.parse?i.parse(e):new i(e.name,e.times,e.values,e.interpolation)}const Cache={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class LoadingManager{constructor(e,t,r){const i=this;let n=!1,a=0,o=0,s=void 0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){o++,!1===n&&void 0!==i.onStart&&i.onStart(e,a,o),n=!0},this.itemEnd=function(e){a++,void 0!==i.onProgress&&i.onProgress(e,a,o),a===o&&(n=!1,void 0!==i.onLoad)&&i.onLoad()},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){e=l.indexOf(e);return-1!==e&&l.splice(e,2),this},this.getHandler=function(r){for(let e=0,t=l.length;e<t;e+=2){var i=l[e],n=l[e+1];if(i.global&&(i.lastIndex=0),i.test(r))return n}return null}}}const DefaultLoadingManager=new LoadingManager;class Loader{constructor(e){this.manager=void 0!==e?e:DefaultLoadingManager,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(r,i){const n=this;return new Promise(function(e,t){n.load(r,e,i,t)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Loader.DEFAULT_MATERIAL_NAME="__DEFAULT";const loading={};class HttpError extends Error{constructor(e,t){super(e),this.response=t}}class FileLoader extends Loader{constructor(e){super(e)}load(a,e,t,r){void 0===a&&(a=""),void 0!==this.path&&(a=this.path+a),a=this.manager.resolveURL(a);const i=Cache.get(a);if(void 0!==i)return this.manager.itemStart(a),setTimeout(()=>{e&&e(i),this.manager.itemEnd(a)},0),i;if(void 0!==loading[a])loading[a].push({onLoad:e,onProgress:t,onError:r});else{loading[a]=[],loading[a].push({onLoad:e,onProgress:t,onError:r});t=new Request(a,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"});const n=this.mimeType,o=this.responseType;fetch(t).then(e=>{if(200!==e.status&&0!==e.status)throw new HttpError(`fetch for "${e.url}" responded with ${e.status}: `+e.statusText,e);{if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const s=loading[a],t=e.body.getReader();e=e.headers.get("Content-Length")||e.headers.get("X-File-Size");const l=e?parseInt(e):0,c=0!==l;let o=0;e=new ReadableStream({start(a){!function n(){t.read().then(({done:e,value:t})=>{if(e)a.close();else{o+=t.byteLength;const r=new ProgressEvent("progress",{lengthComputable:c,loaded:o,total:l});for(let e=0,t=s.length;e<t;e++){const i=s[e];i.onProgress&&i.onProgress(r)}a.enqueue(t),n()}})}()}});return new Response(e)}}).then(e=>{switch(o){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(e=>{return(new DOMParser).parseFromString(e,n)});case"json":return e.json();default:if(void 0===n)return e.text();{var t=/charset="?([^;"\s]*)"?/i.exec(n),t=t&&t[1]?t[1].toLowerCase():void 0;const r=new TextDecoder(t);return e.arrayBuffer().then(e=>r.decode(e))}}}).then(r=>{Cache.add(a,r);var i=loading[a];delete loading[a];for(let e=0,t=i.length;e<t;e++){var n=i[e];n.onLoad&&n.onLoad(r)}}).catch(r=>{var i=loading[a];if(void 0===i)throw this.manager.itemError(a),r;delete loading[a];for(let e=0,t=i.length;e<t;e++){var n=i[e];n.onError&&n.onError(r)}this.manager.itemError(a)}).finally(()=>{this.manager.itemEnd(a)}),this.manager.itemStart(a)}}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class AnimationLoader extends Loader{constructor(e){super(e)}load(t,r,e,i){const n=this;var a=new FileLoader(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(e){try{r(n.parse(JSON.parse(e)))}catch(e){i?i(e):console.error(e),n.manager.itemError(t)}},e,i)}parse(t){var r=[];for(let e=0;e<t.length;e++){var i=AnimationClip.parse(t[e]);r.push(i)}return r}}class CompressedTextureLoader extends Loader{constructor(e){super(e)}load(r,n,i,a){const o=this,s=[],l=new CompressedTexture,c=new FileLoader(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(o.withCredentials);let d=0;if(Array.isArray(r))for(let e=0,t=r.length;e<t;++e)!function(t){c.load(r[t],function(e){e=o.parse(e,!0);s[t]={width:e.width,height:e.height,format:e.format,mipmaps:e.mipmaps},6===(d+=1)&&(1===e.mipmapCount&&(l.minFilter=LinearFilter),l.image=s,l.format=e.format,l.needsUpdate=!0,n)&&n(l)},i,a)}(e);else c.load(r,function(e){var r=o.parse(e,!0);if(r.isCubemap){var i=r.mipmaps.length/r.mipmapCount;for(let t=0;t<i;t++){s[t]={mipmaps:[]};for(let e=0;e<r.mipmapCount;e++)s[t].mipmaps.push(r.mipmaps[t*r.mipmapCount+e]),s[t].format=r.format,s[t].width=r.width,s[t].height=r.height}l.image=s}else l.image.width=r.width,l.image.height=r.height,l.mipmaps=r.mipmaps;1===r.mipmapCount&&(l.minFilter=LinearFilter),l.format=r.format,l.needsUpdate=!0,n&&n(l)},i,a);return l}}class ImageLoader extends Loader{constructor(e){super(e)}load(t,e,r,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const n=this,a=Cache.get(t);if(void 0!==a)return n.manager.itemStart(t),setTimeout(function(){e&&e(a),n.manager.itemEnd(t)},0),a;const o=createElementNS("img");function s(){c(),Cache.add(t,this),e&&e(this),n.manager.itemEnd(t)}function l(e){c(),i&&i(e),n.manager.itemError(t),n.manager.itemEnd(t)}function c(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),n.manager.itemStart(t),o.src=t,o}}class CubeTextureLoader extends Loader{constructor(e){super(e)}load(r,i,e,n){const a=new CubeTexture,o=(a.colorSpace=SRGBColorSpace,new ImageLoader(this.manager));o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let s=0;for(let e=0;e<r.length;++e)!function(t){o.load(r[t],function(e){a.images[t]=e,6===++s&&(a.needsUpdate=!0,i)&&i(a)},void 0,n)}(e);return a}}class DataTextureLoader extends Loader{constructor(e){super(e)}load(e,r,t,i){const n=this,a=new DataTexture;var o=new FileLoader(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(n.withCredentials),o.load(e,function(e){let t;try{t=n.parse(e)}catch(e){if(void 0===i)return void console.error(e);i(e)}if(!t)return i();void 0!==t.image?a.image=t.image:void 0!==t.data&&(a.image.width=t.width,a.image.height=t.height,a.image.data=t.data),a.wrapS=void 0!==t.wrapS?t.wrapS:ClampToEdgeWrapping,a.wrapT=void 0!==t.wrapT?t.wrapT:ClampToEdgeWrapping,a.magFilter=void 0!==t.magFilter?t.magFilter:LinearFilter,a.minFilter=void 0!==t.minFilter?t.minFilter:LinearFilter,a.anisotropy=void 0!==t.anisotropy?t.anisotropy:1,void 0!==t.colorSpace?a.colorSpace=t.colorSpace:void 0!==t.encoding&&(a.encoding=t.encoding),void 0!==t.flipY&&(a.flipY=t.flipY),void 0!==t.format&&(a.format=t.format),void 0!==t.type&&(a.type=t.type),void 0!==t.mipmaps&&(a.mipmaps=t.mipmaps,a.minFilter=LinearMipmapLinearFilter),1===t.mipmapCount&&(a.minFilter=LinearFilter),void 0!==t.generateMipmaps&&(a.generateMipmaps=t.generateMipmaps),a.needsUpdate=!0,r&&r(a,t)},t,i),a}}class TextureLoader extends Loader{constructor(e){super(e)}load(e,t,r,i){const n=new Texture;var a=new ImageLoader(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(e){n.image=e,n.needsUpdate=!0,void 0!==t&&t(n)},r,i),n}}class Light extends Object3D{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Color(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){e=super.toJSON(e);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}class HemisphereLight extends Light{constructor(e,t,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Color(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const _projScreenMatrix$1=new Matrix4,_lightPositionWorld$1=new Vector3,_lookTarget$1=new Vector3;class LightShadow{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){var t=this.camera,r=this.matrix;_lightPositionWorld$1.setFromMatrixPosition(e.matrixWorld),t.position.copy(_lightPositionWorld$1),_lookTarget$1.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(_lookTarget$1),t.updateMatrixWorld(),_projScreenMatrix$1.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix$1),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(_projScreenMatrix$1)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){var e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class SpotLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){var t=this.camera,r=2*RAD2DEG*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;r===t.fov&&i===t.aspect&&n===t.far||(t.fov=r,t.aspect=i,t.far=n,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class SpotLight extends Light{constructor(e,t,r=0,i=Math.PI/3,n=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.distance=r,this.angle=i,this.penumbra=n,this.decay=a,this.map=null,this.shadow=new SpotLightShadow}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const _projScreenMatrix=new Matrix4,_lightPositionWorld=new Vector3,_lookTarget=new Vector3;class PointLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}updateMatrices(e,t=0){var r=this.camera,i=this.matrix,n=e.distance||r.far;n!==r.far&&(r.far=n,r.updateProjectionMatrix()),_lightPositionWorld.setFromMatrixPosition(e.matrixWorld),r.position.copy(_lightPositionWorld),_lookTarget.copy(r.position),_lookTarget.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(_lookTarget),r.updateMatrixWorld(),i.makeTranslation(-_lightPositionWorld.x,-_lightPositionWorld.y,-_lightPositionWorld.z),_projScreenMatrix.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix)}}class PointLight extends Light{constructor(e,t,r=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=i,this.shadow=new PointLightShadow}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class DirectionalLightShadow extends LightShadow{constructor(){super(new OrthographicCamera(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class DirectionalLight extends Light{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class AmbientLight extends Light{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class RectAreaLight extends Light{constructor(e,t,r=10,i=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){e=super.toJSON(e);return e.object.width=this.width,e.object.height=this.height,e}}class SphericalHarmonics3{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Vector3)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){var r=e.x,i=e.y,e=e.z,n=this.coefficients;return t.copy(n[0]).multiplyScalar(.282095),t.addScaledVector(n[1],.488603*i),t.addScaledVector(n[2],.488603*e),t.addScaledVector(n[3],.488603*r),t.addScaledVector(n[4],r*i*1.092548),t.addScaledVector(n[5],i*e*1.092548),t.addScaledVector(n[6],.315392*(3*e*e-1)),t.addScaledVector(n[7],r*e*1.092548),t.addScaledVector(n[8],.546274*(r*r-i*i)),t}getIrradianceAt(e,t){var r=e.x,i=e.y,e=e.z,n=this.coefficients;return t.copy(n[0]).multiplyScalar(.886227),t.addScaledVector(n[1],1.023328*i),t.addScaledVector(n[2],1.023328*e),t.addScaledVector(n[3],1.023328*r),t.addScaledVector(n[4],.858086*r*i),t.addScaledVector(n[5],.858086*i*e),t.addScaledVector(n[6],.743125*e*e-.247708),t.addScaledVector(n[7],.858086*r*e),t.addScaledVector(n[8],.429043*(r*r-i*i)),t}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,r){for(let e=0;e<9;e++)this.coefficients[e].addScaledVector(t.coefficients[e],r);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,r){for(let e=0;e<9;e++)this.coefficients[e].lerp(t.coefficients[e],r);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,r=0){var i=this.coefficients;for(let e=0;e<9;e++)i[e].fromArray(t,r+3*e);return this}toArray(t=[],r=0){var i=this.coefficients;for(let e=0;e<9;e++)i[e].toArray(t,r+3*e);return t}static getBasisAt(e,t){var r=e.x,i=e.y,e=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*e,t[3]=.488603*r,t[4]=1.092548*r*i,t[5]=1.092548*i*e,t[6]=.315392*(3*e*e-1),t[7]=1.092548*r*e,t[8]=.546274*(r*r-i*i)}}class LightProbe extends Light{constructor(e=new SphericalHarmonics3,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){e=super.toJSON(e);return e.object.sh=this.sh.toArray(),e}}class MaterialLoader extends Loader{constructor(e){super(e),this.textures={}}load(t,r,e,i){const n=this;var a=new FileLoader(n.manager);a.setPath(n.path),a.setRequestHeader(n.requestHeader),a.setWithCredentials(n.withCredentials),a.load(t,function(e){try{r(n.parse(JSON.parse(e)))}catch(e){i?i(e):console.error(e),n.manager.itemError(t)}},e,i)}parse(t){const r=this.textures;function e(e){return void 0===r[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),r[e]}var i=MaterialLoader.createMaterialFromType(t.type);if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&void 0!==i.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.sheen&&(i.sheen=t.sheen),void 0!==t.sheenColor&&(i.sheenColor=(new Color).setHex(t.sheenColor)),void 0!==t.sheenRoughness&&(i.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==i.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==i.specular&&i.specular.setHex(t.specular),void 0!==t.specularIntensity&&(i.specularIntensity=t.specularIntensity),void 0!==t.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(t.specularColor),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearcoat&&(i.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(i.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.iridescence&&(i.iridescence=t.iridescence),void 0!==t.iridescenceIOR&&(i.iridescenceIOR=t.iridescenceIOR),void 0!==t.iridescenceThicknessRange&&(i.iridescenceThicknessRange=t.iridescenceThicknessRange),void 0!==t.transmission&&(i.transmission=t.transmission),void 0!==t.thickness&&(i.thickness=t.thickness),void 0!==t.attenuationDistance&&(i.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(t.attenuationColor),void 0!==t.anisotropy&&(i.anisotropy=t.anisotropy),void 0!==t.anisotropyRotation&&(i.anisotropyRotation=t.anisotropyRotation),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.combine&&(i.combine=t.combine),void 0!==t.side&&(i.side=t.side),void 0!==t.shadowSide&&(i.shadowSide=t.shadowSide),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.alphaHash&&(i.alphaHash=t.alphaHash),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(i.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(i.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(i.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(i.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(i.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(i.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(i.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(i.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),1!==t.linewidth&&(i.linewidth=t.linewidth),void 0!==t.dashSize&&(i.dashSize=t.dashSize),void 0!==t.gapSize&&(i.gapSize=t.gapSize),void 0!==t.scale&&(i.scale=t.scale),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.alphaToCoverage&&(i.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(i.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.forceSinglePass&&(i.forceSinglePass=t.forceSinglePass),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.toneMapped&&(i.toneMapped=t.toneMapped),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?i.vertexColors=0<t.vertexColors:i.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const a in t.uniforms){var n=t.uniforms[a];switch(i.uniforms[a]={},n.type){case"t":i.uniforms[a].value=e(n.value);break;case"c":i.uniforms[a].value=(new Color).setHex(n.value);break;case"v2":i.uniforms[a].value=(new Vector2).fromArray(n.value);break;case"v3":i.uniforms[a].value=(new Vector3).fromArray(n.value);break;case"v4":i.uniforms[a].value=(new Vector4).fromArray(n.value);break;case"m3":i.uniforms[a].value=(new Matrix3).fromArray(n.value);break;case"m4":i.uniforms[a].value=(new Matrix4).fromArray(n.value);break;default:i.uniforms[a].value=n.value}}if(void 0!==t.defines&&(i.defines=t.defines),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.glslVersion&&(i.glslVersion=t.glslVersion),void 0!==t.extensions)for(const o in t.extensions)i.extensions[o]=t.extensions[o];if(void 0!==t.lights&&(i.lights=t.lights),void 0!==t.clipping&&(i.clipping=t.clipping),void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=e(t.map)),void 0!==t.matcap&&(i.matcap=e(t.matcap)),void 0!==t.alphaMap&&(i.alphaMap=e(t.alphaMap)),void 0!==t.bumpMap&&(i.bumpMap=e(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=e(t.normalMap)),void 0!==t.normalMapType&&(i.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),i.normalScale=(new Vector2).fromArray(e)}return void 0!==t.displacementMap&&(i.displacementMap=e(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=e(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=e(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=e(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=e(t.specularMap)),void 0!==t.specularIntensityMap&&(i.specularIntensityMap=e(t.specularIntensityMap)),void 0!==t.specularColorMap&&(i.specularColorMap=e(t.specularColorMap)),void 0!==t.envMap&&(i.envMap=e(t.envMap)),void 0!==t.envMapIntensity&&(i.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(i.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(i.lightMap=e(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=e(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=e(t.gradientMap)),void 0!==t.clearcoatMap&&(i.clearcoatMap=e(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=e(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(i.clearcoatNormalMap=e(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Vector2).fromArray(t.clearcoatNormalScale)),void 0!==t.iridescenceMap&&(i.iridescenceMap=e(t.iridescenceMap)),void 0!==t.iridescenceThicknessMap&&(i.iridescenceThicknessMap=e(t.iridescenceThicknessMap)),void 0!==t.transmissionMap&&(i.transmissionMap=e(t.transmissionMap)),void 0!==t.thicknessMap&&(i.thicknessMap=e(t.thicknessMap)),void 0!==t.anisotropyMap&&(i.anisotropyMap=e(t.anisotropyMap)),void 0!==t.sheenColorMap&&(i.sheenColorMap=e(t.sheenColorMap)),void 0!==t.sheenRoughnessMap&&(i.sheenRoughnessMap=e(t.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){return new{ShadowMaterial:ShadowMaterial,SpriteMaterial:SpriteMaterial,RawShaderMaterial:RawShaderMaterial,ShaderMaterial:ShaderMaterial,PointsMaterial:PointsMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshToonMaterial:MeshToonMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshBasicMaterial:MeshBasicMaterial,MeshMatcapMaterial:MeshMatcapMaterial,LineDashedMaterial:LineDashedMaterial,LineBasicMaterial:LineBasicMaterial,Material:Material}[e]}}class LoaderUtils{static decodeText(r){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(r);let i="";for(let e=0,t=r.length;e<t;e++)i+=String.fromCharCode(r[e]);try{return decodeURIComponent(escape(i))}catch(e){return i}}static extractUrlBase(e){var t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class InstancedBufferGeometry extends BufferGeometry{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){var e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class BufferGeometryLoader extends Loader{constructor(e){super(e)}load(t,r,e,i){const n=this;var a=new FileLoader(n.manager);a.setPath(n.path),a.setRequestHeader(n.requestHeader),a.setWithCredentials(n.withCredentials),a.load(t,function(e){try{r(n.parse(JSON.parse(e)))}catch(e){i?i(e):console.error(e),n.manager.itemError(t)}},e,i)}parse(r){const i={},n={};function a(e,t){var r;return void 0!==i[t]?i[t]:(r=function(e,t){if(void 0!==n[t])return n[t];e=e.arrayBuffers,e=e[t],e=new Uint32Array(e).buffer;return n[t]=e}(e,(e=e.interleavedBuffers[t]).buffer),r=getTypedArray(e.type,r),(r=new InterleavedBuffer(r,e.stride)).uuid=e.uuid,i[t]=r)}var o=new(r.isInstancedBufferGeometry?InstancedBufferGeometry:BufferGeometry),e=r.data.index,t=(void 0!==e&&(e=getTypedArray(e.type,e.array),o.setIndex(new BufferAttribute(e,1))),r.data.attributes);for(const g in t){var s,l=t[g];let e;e=l.isInterleavedBufferAttribute?(s=a(r.data,l.data),new InterleavedBufferAttribute(s,l.itemSize,l.offset,l.normalized)):(s=getTypedArray(l.type,l.array),new(l.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute)(s,l.itemSize,l.normalized)),void 0!==l.name&&(e.name=l.name),void 0!==l.usage&&e.setUsage(l.usage),void 0!==l.updateRange&&(e.updateRange.offset=l.updateRange.offset,e.updateRange.count=l.updateRange.count),o.setAttribute(g,e)}var c=r.data.morphAttributes;if(c)for(const v in c){var d=c[v],h=[];for(let t=0,e=d.length;t<e;t++){var u,A=d[t];let e;e=A.isInterleavedBufferAttribute?(u=a(r.data,A.data),new InterleavedBufferAttribute(u,A.itemSize,A.offset,A.normalized)):(u=getTypedArray(A.type,A.array),new BufferAttribute(u,A.itemSize,A.normalized)),void 0!==A.name&&(e.name=A.name),h.push(e)}o.morphAttributes[v]=h}r.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);var p=r.data.groups||r.data.drawcalls||r.data.offsets;if(void 0!==p)for(let e=0,t=p.length;e!==t;++e){var m=p[e];o.addGroup(m.start,m.count,m.materialIndex)}var f,e=r.data.boundingSphere;return void 0!==e&&(f=new Vector3,void 0!==e.center&&f.fromArray(e.center),o.boundingSphere=new Sphere(f,e.radius)),r.name&&(o.name=r.name),r.userData&&(o.userData=r.userData),o}}class ObjectLoader extends Loader{constructor(e){super(e)}load(r,i,e,n){const a=this;var t=""===this.path?LoaderUtils.extractUrlBase(r):this.path,t=(this.resourcePath=this.resourcePath||t,new FileLoader(this.manager));t.setPath(this.path),t.setRequestHeader(this.requestHeader),t.setWithCredentials(this.withCredentials),t.load(r,function(e){let t=null;try{t=JSON.parse(e)}catch(e){return void 0!==n&&n(e),void console.error("THREE:ObjectLoader: Can't parse "+r+".",e.message)}e=t.metadata;void 0===e||void 0===e.type||"geometry"===e.type.toLowerCase()?(void 0!==n&&n(new Error("THREE.ObjectLoader: Can't load "+r)),console.error("THREE.ObjectLoader: Can't load "+r)):a.parse(t,i)},e,n)}async loadAsync(e,t){var r=""===this.path?LoaderUtils.extractUrlBase(e):this.path,r=(this.resourcePath=this.resourcePath||r,new FileLoader(this.manager)),r=(r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),await r.loadAsync(e,t)),t=JSON.parse(r),r=t.metadata;if(void 0===r||void 0===r.type||"geometry"===r.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return this.parseAsync(t)}parse(e,t){var r=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,i),n=this.parseImages(e.images,function(){void 0!==t&&t(s)}),a=this.parseTextures(e.textures,n),o=this.parseMaterials(e.materials,a);const s=this.parseObject(e.object,i,o,a,r);i=this.parseSkeletons(e.skeletons,s);if(this.bindSkeletons(s,i),void 0!==t){let e=!1;for(const l in n)if(n[l].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(s)}return s}async parseAsync(e){var t=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,r),i=await this.parseImagesAsync(e.images),i=this.parseTextures(e.textures,i),n=this.parseMaterials(e.materials,i),r=this.parseObject(e.object,r,n,i,t),n=this.parseSkeletons(e.skeletons,r);return this.bindSkeletons(r,n),r}parseShapes(r){var i={};if(void 0!==r)for(let e=0,t=r.length;e<t;e++){var n=(new Shape).fromJSON(r[e]);i[n.uuid]=n}return i}parseSkeletons(r,e){var i={};const n={};if(e.traverse(function(e){e.isBone&&(n[e.uuid]=e)}),void 0!==r)for(let e=0,t=r.length;e<t;e++){var a=(new Skeleton).fromJSON(r[e],n);i[a.uuid]=a}return i}parseGeometries(r,i){var n={};if(void 0!==r){var a=new BufferGeometryLoader;for(let t=0,e=r.length;t<e;t++){let e;var o=r[t];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":e=a.parse(o);break;default:o.type in Geometries?e=Geometries[o.type].fromJSON(o,i):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${o.type}"`)}e.uuid=o.uuid,void 0!==o.name&&(e.name=o.name),void 0!==o.userData&&(e.userData=o.userData),n[o.uuid]=e}}return n}parseMaterials(r,e){var i={},n={};if(void 0!==r){var a=new MaterialLoader;a.setTextures(e);for(let e=0,t=r.length;e<t;e++){var o=r[e];void 0===i[o.uuid]&&(i[o.uuid]=a.parse(o)),n[o.uuid]=i[o.uuid]}}return n}parseAnimations(t){var r={};if(void 0!==t)for(let e=0;e<t.length;e++){var i=t[e],i=AnimationClip.parse(i);r[i.uuid]=i}return r}parseImages(r,e){const i=this;var n={};let a;function o(e){var t,r;return"string"==typeof e?(t=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t=e)?t:i.resourcePath+t,r=t,i.manager.itemStart(r),a.load(r,function(){i.manager.itemEnd(r)},void 0,function(){i.manager.itemError(r),i.manager.itemEnd(r)})):e.data?{data:getTypedArray(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==r&&0<r.length){e=new LoadingManager(e);(a=new ImageLoader(e)).setCrossOrigin(this.crossOrigin);for(let e=0,t=r.length;e<t;e++){var s=r[e],l=s.url;if(Array.isArray(l)){var c=[];for(let e=0,t=l.length;e<t;e++){var d=o(l[e]);null!==d&&(d instanceof HTMLImageElement?c.push(d):c.push(new DataTexture(d.data,d.width,d.height)))}n[s.uuid]=new Source(c)}else{var h=o(s.url);n[s.uuid]=new Source(h)}}}return n}async parseImagesAsync(r){const i=this;var n={};let a;async function o(e){var t;return"string"==typeof e?(t=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t=e)?t:i.resourcePath+t,a.loadAsync(t)):e.data?{data:getTypedArray(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==r&&0<r.length){(a=new ImageLoader(this.manager)).setCrossOrigin(this.crossOrigin);for(let e=0,t=r.length;e<t;e++){var s=r[e],l=s.url;if(Array.isArray(l)){var c=[];for(let e=0,t=l.length;e<t;e++){var d=await o(l[e]);null!==d&&(d instanceof HTMLImageElement?c.push(d):c.push(new DataTexture(d.data,d.width,d.height)))}n[s.uuid]=new Source(c)}else{var h=await o(s.url);n[s.uuid]=new Source(h)}}}return n}parseTextures(r,i){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var a={};if(void 0!==r)for(let t=0,e=r.length;t<e;t++){var o=r[t],s=(void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===i[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image),i[o.image]),l=s.data;let e;Array.isArray(l)?(e=new CubeTexture,6===l.length&&(e.needsUpdate=!0)):(e=new(l&&l.data?DataTexture:Texture),l&&(e.needsUpdate=!0)),e.source=s,e.uuid=o.uuid,void 0!==o.name&&(e.name=o.name),void 0!==o.mapping&&(e.mapping=n(o.mapping,TEXTURE_MAPPING)),void 0!==o.channel&&(e.channel=o.channel),void 0!==o.offset&&e.offset.fromArray(o.offset),void 0!==o.repeat&&e.repeat.fromArray(o.repeat),void 0!==o.center&&e.center.fromArray(o.center),void 0!==o.rotation&&(e.rotation=o.rotation),void 0!==o.wrap&&(e.wrapS=n(o.wrap[0],TEXTURE_WRAPPING),e.wrapT=n(o.wrap[1],TEXTURE_WRAPPING)),void 0!==o.format&&(e.format=o.format),void 0!==o.internalFormat&&(e.internalFormat=o.internalFormat),void 0!==o.type&&(e.type=o.type),void 0!==o.colorSpace&&(e.colorSpace=o.colorSpace),void 0!==o.encoding&&(e.encoding=o.encoding),void 0!==o.minFilter&&(e.minFilter=n(o.minFilter,TEXTURE_FILTER)),void 0!==o.magFilter&&(e.magFilter=n(o.magFilter,TEXTURE_FILTER)),void 0!==o.anisotropy&&(e.anisotropy=o.anisotropy),void 0!==o.flipY&&(e.flipY=o.flipY),void 0!==o.generateMipmaps&&(e.generateMipmaps=o.generateMipmaps),void 0!==o.premultiplyAlpha&&(e.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(e.unpackAlignment=o.unpackAlignment),void 0!==o.compareFunction&&(e.compareFunction=o.compareFunction),void 0!==o.userData&&(e.userData=o.userData),a[o.uuid]=e}return a}parseObject(e,t,a,r,i){let n;function o(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function s(r){if(void 0!==r){if(Array.isArray(r)){var i=[];for(let e=0,t=r.length;e<t;e++){var n=r[e];void 0===a[n]&&console.warn("THREE.ObjectLoader: Undefined material",n),i.push(a[n])}return i}return void 0===a[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),a[r]}}function l(e){return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),r[e]}let c,d;switch(e.type){case"Scene":n=new Scene,void 0!==e.background&&(Number.isInteger(e.background)?n.background=new Color(e.background):n.background=l(e.background)),void 0!==e.environment&&(n.environment=l(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?n.fog=new Fog(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(n.fog=new FogExp2(e.fog.color,e.fog.density))),void 0!==e.backgroundBlurriness&&(n.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(n.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":n=new PerspectiveCamera(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(n.focus=e.focus),void 0!==e.zoom&&(n.zoom=e.zoom),void 0!==e.filmGauge&&(n.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(n.filmOffset=e.filmOffset),void 0!==e.view&&(n.view=Object.assign({},e.view));break;case"OrthographicCamera":n=new OrthographicCamera(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(n.zoom=e.zoom),void 0!==e.view&&(n.view=Object.assign({},e.view));break;case"AmbientLight":n=new AmbientLight(e.color,e.intensity);break;case"DirectionalLight":n=new DirectionalLight(e.color,e.intensity);break;case"PointLight":n=new PointLight(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":n=new RectAreaLight(e.color,e.intensity,e.width,e.height);break;case"SpotLight":n=new SpotLight(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":n=new HemisphereLight(e.color,e.groundColor,e.intensity);break;case"LightProbe":n=(new LightProbe).fromJSON(e);break;case"SkinnedMesh":c=o(e.geometry),d=s(e.material),n=new SkinnedMesh(c,d),void 0!==e.bindMode&&(n.bindMode=e.bindMode),void 0!==e.bindMatrix&&n.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(n.skeleton=e.skeleton);break;case"Mesh":c=o(e.geometry),d=s(e.material),n=new Mesh(c,d);break;case"InstancedMesh":c=o(e.geometry),d=s(e.material);var h=e.count,u=e.instanceMatrix,A=e.instanceColor;(n=new InstancedMesh(c,d,h)).instanceMatrix=new InstancedBufferAttribute(new Float32Array(u.array),16),void 0!==A&&(n.instanceColor=new InstancedBufferAttribute(new Float32Array(A.array),A.itemSize));break;case"LOD":n=new LOD;break;case"Line":n=new Line(o(e.geometry),s(e.material));break;case"LineLoop":n=new LineLoop(o(e.geometry),s(e.material));break;case"LineSegments":n=new LineSegments(o(e.geometry),s(e.material));break;case"PointCloud":case"Points":n=new Points(o(e.geometry),s(e.material));break;case"Sprite":n=new Sprite(s(e.material));break;case"Group":n=new Group;break;case"Bone":n=new Bone;break;default:n=new Object3D}if(n.uuid=e.uuid,void 0!==e.name&&(n.name=e.name),void 0!==e.matrix?(n.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(n.matrixAutoUpdate=e.matrixAutoUpdate),n.matrixAutoUpdate&&n.matrix.decompose(n.position,n.quaternion,n.scale)):(void 0!==e.position&&n.position.fromArray(e.position),void 0!==e.rotation&&n.rotation.fromArray(e.rotation),void 0!==e.quaternion&&n.quaternion.fromArray(e.quaternion),void 0!==e.scale&&n.scale.fromArray(e.scale)),void 0!==e.up&&n.up.fromArray(e.up),void 0!==e.castShadow&&(n.castShadow=e.castShadow),void 0!==e.receiveShadow&&(n.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(n.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(n.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(n.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&n.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera)&&(n.shadow.camera=this.parseObject(e.shadow.camera)),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.frustumCulled&&(n.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(n.renderOrder=e.renderOrder),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.layers&&(n.layers.mask=e.layers),void 0!==e.children){var p=e.children;for(let e=0;e<p.length;e++)n.add(this.parseObject(p[e],t,a,r,i))}if(void 0!==e.animations){var m=e.animations;for(let e=0;e<m.length;e++){var f=m[e];n.animations.push(i[f])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(n.autoUpdate=e.autoUpdate);var g=e.levels;for(let e=0;e<g.length;e++){var v=g[e],_=n.getObjectByProperty("uuid",v.object);void 0!==_&&n.addLevel(_,v.distance,v.hysteresis)}}return n}bindSkeletons(e,r){0!==Object.keys(r).length&&e.traverse(function(e){var t;!0===e.isSkinnedMesh&&void 0!==e.skeleton&&(void 0===(t=r[e.skeleton])?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(t,e.bindMatrix))})}}const TEXTURE_MAPPING={UVMapping:UVMapping,CubeReflectionMapping:CubeReflectionMapping,CubeRefractionMapping:CubeRefractionMapping,EquirectangularReflectionMapping:EquirectangularReflectionMapping,EquirectangularRefractionMapping:EquirectangularRefractionMapping,CubeUVReflectionMapping:CubeUVReflectionMapping},TEXTURE_WRAPPING={RepeatWrapping:RepeatWrapping,ClampToEdgeWrapping:ClampToEdgeWrapping,MirroredRepeatWrapping:MirroredRepeatWrapping},TEXTURE_FILTER={NearestFilter:NearestFilter,NearestMipmapNearestFilter:NearestMipmapNearestFilter,NearestMipmapLinearFilter:NearestMipmapLinearFilter,LinearFilter:LinearFilter,LinearMipmapNearestFilter:LinearMipmapNearestFilter,LinearMipmapLinearFilter:LinearMipmapLinearFilter};class ImageBitmapLoader extends Loader{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(t,r,e,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const n=this,a=Cache.get(t);if(void 0!==a)return n.manager.itemStart(t),setTimeout(function(){r&&r(a),n.manager.itemEnd(t)},0),a;var o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(t,o).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(n.options,{colorSpaceConversion:"none"}))}).then(function(e){Cache.add(t,e),r&&r(e),n.manager.itemEnd(t)}).catch(function(e){i&&i(e),n.manager.itemError(t),n.manager.itemEnd(t)}),n.manager.itemStart(t)}}let _context;class AudioContext{static getContext(){return _context=void 0===_context?new(window.AudioContext||window.webkitAudioContext):_context}static setContext(e){_context=e}}class AudioLoader extends Loader{constructor(e){super(e)}load(t,r,e,i){const n=this;var a=new FileLoader(this.manager);function o(e){i?i(e):console.error(e),n.manager.itemError(t)}a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(e){try{var t=e.slice(0);AudioContext.getContext().decodeAudioData(t,function(e){r(e)},o)}catch(e){o(e)}},e,i)}}class HemisphereLightProbe extends LightProbe{constructor(e,t,r=1){super(void 0,r),this.isHemisphereLightProbe=!0;var r=(new Color).set(e),e=(new Color).set(t),t=new Vector3(r.r,r.g,r.b),r=new Vector3(e.r,e.g,e.b),e=Math.sqrt(Math.PI),i=e*Math.sqrt(.75);this.sh.coefficients[0].copy(t).add(r).multiplyScalar(e),this.sh.coefficients[1].copy(t).sub(r).multiplyScalar(i)}}class AmbientLightProbe extends LightProbe{constructor(e,t=1){super(void 0,t),this.isAmbientLightProbe=!0;t=(new Color).set(e);this.sh.coefficients[0].set(t.r,t.g,t.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const _eyeRight=new Matrix4,_eyeLeft=new Matrix4,_projectionMatrix=new Matrix4;class StereoCamera{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){var t,r,i,n,a=this._cache;a.focus===e.focus&&a.fov===e.fov&&a.aspect===e.aspect*this.aspect&&a.near===e.near&&a.far===e.far&&a.zoom===e.zoom&&a.eyeSep===this.eyeSep||(a.focus=e.focus,a.fov=e.fov,a.aspect=e.aspect*this.aspect,a.near=e.near,a.far=e.far,a.zoom=e.zoom,a.eyeSep=this.eyeSep,_projectionMatrix.copy(e.projectionMatrix),t=(i=a.eyeSep/2)*a.near/a.focus,r=a.near*Math.tan(DEG2RAD*a.fov*.5)/a.zoom,_eyeLeft.elements[12]=-i,_eyeRight.elements[12]=i,i=-r*a.aspect+t,n=r*a.aspect+t,_projectionMatrix.elements[0]=2*a.near/(n-i),_projectionMatrix.elements[8]=(n+i)/(n-i),this.cameraL.projectionMatrix.copy(_projectionMatrix),i=-r*a.aspect-t,n=r*a.aspect-t,_projectionMatrix.elements[0]=2*a.near/(n-i),_projectionMatrix.elements[8]=(n+i)/(n-i),this.cameraR.projectionMatrix.copy(_projectionMatrix)),this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(_eyeLeft),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(_eyeRight)}}class Clock{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;var t;return this.autoStart&&!this.running?(this.start(),0):(this.running&&(t=now(),e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e),e)}}function now(){return("undefined"==typeof performance?Date:performance).now()}const _position$1=new Vector3,_quaternion$1=new Quaternion,_scale$1=new Vector3,_orientation$1=new Vector3;class AudioListener extends Object3D{constructor(){super(),this.type="AudioListener",this.context=AudioContext.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return(null!==this.filter?(this.gain.disconnect(this.filter),this.filter):this.gain).disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);var t,e=this.context.listener,r=this.up;this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(_position$1,_quaternion$1,_scale$1),_orientation$1.set(0,0,-1).applyQuaternion(_quaternion$1),e.positionX?(t=this.context.currentTime+this.timeDelta,e.positionX.linearRampToValueAtTime(_position$1.x,t),e.positionY.linearRampToValueAtTime(_position$1.y,t),e.positionZ.linearRampToValueAtTime(_position$1.z,t),e.forwardX.linearRampToValueAtTime(_orientation$1.x,t),e.forwardY.linearRampToValueAtTime(_orientation$1.y,t),e.forwardZ.linearRampToValueAtTime(_orientation$1.z,t),e.upX.linearRampToValueAtTime(r.x,t),e.upY.linearRampToValueAtTime(r.y,t),e.upZ.linearRampToValueAtTime(r.z,t)):(e.setPosition(_position$1.x,_position$1.y,_position$1.z),e.setOrientation(_orientation$1.x,_orientation$1.y,_orientation$1.z,r.x,r.y,r.z))}}class Audio extends Object3D{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else{if(!1!==this.hasPlaybackControl)return this._startedAt=this.context.currentTime+e,(e=this.context.createBufferSource()).buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect();console.warn("THREE.Audio: this Audio has no playback control.")}}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e=e||[],!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const _position=new Vector3,_quaternion=new Quaternion,_scale=new Vector3,_orientation=new Vector3;class PositionalAudio extends Audio{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this}updateMatrixWorld(e){var t;super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying||(this.matrixWorld.decompose(_position,_quaternion,_scale),_orientation.set(0,0,1).applyQuaternion(_quaternion),(e=this.panner).positionX?(t=this.context.currentTime+this.listener.timeDelta,e.positionX.linearRampToValueAtTime(_position.x,t),e.positionY.linearRampToValueAtTime(_position.y,t),e.positionZ.linearRampToValueAtTime(_position.z,t),e.orientationX.linearRampToValueAtTime(_orientation.x,t),e.orientationY.linearRampToValueAtTime(_orientation.y,t),e.orientationZ.linearRampToValueAtTime(_orientation.z,t)):(e.setPosition(_position.x,_position.y,_position.z),e.setOrientation(_orientation.x,_orientation.y,_orientation.z)))}}class AudioAnalyser{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;var r=this.getFrequencyData();for(let e=0;e<r.length;e++)t+=r[e];return t/r.length}}class PropertyMixer{constructor(e,t,r){this.binding=e,this.valueSize=r;let i,n,a;switch(t){case"quaternion":i=this._slerp,n=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*r),this._workIndex=5;break;case"string":case"bool":i=this._select,n=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*r);break;default:i=this._lerp,n=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*r)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=n,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){var r=this.buffer,i=this.valueSize,n=e*i+i;let a=this.cumulativeWeight;if(0===a){for(let e=0;e!==i;++e)r[n+e]=r[e];a=t}else{e=t/(a+=t);this._mixBufferRegion(r,n,0,e,i)}this.cumulativeWeight=a}accumulateAdditive(e){var t=this.buffer,r=this.valueSize,i=r*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){var t,r=this.valueSize,i=this.buffer,n=e*r+r,e=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,e<1&&(t=r*this._origIndex,this._mixBufferRegion(i,n,t,1-e,r)),0<a&&this._mixBufferRegionAdditive(i,n,this._addIndex*r,1,r);for(let e=r,t=r+r;e!==t;++e)if(i[e]!==i[e+r]){o.setValue(i,n);break}}saveOriginalState(){var e=this.binding,r=this.buffer,i=this.valueSize,n=i*this._origIndex;e.getValue(r,n);for(let e=i,t=n;e!==t;++e)r[e]=r[n+e%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){var t=this._addIndex*this.valueSize,r=t+this.valueSize;for(let e=t;e<r;e++)this.buffer[e]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){var t=this._origIndex*this.valueSize,r=this._addIndex*this.valueSize;for(let e=0;e<this.valueSize;e++)this.buffer[r+e]=this.buffer[t+e]}_select(t,r,i,e,n){if(.5<=e)for(let e=0;e!==n;++e)t[r+e]=t[i+e]}_slerp(e,t,r,i){Quaternion.slerpFlat(e,t,e,t,e,r,i)}_slerpAdditive(e,t,r,i,n){n=this._workIndex*n;Quaternion.multiplyQuaternionsFlat(e,n,e,t,e,r),Quaternion.slerpFlat(e,t,e,t,e,n,i)}_lerp(t,r,i,n,a){var o=1-n;for(let e=0;e!==a;++e){var s=r+e;t[s]=t[s]*o+t[i+e]*n}}_lerpAdditive(t,r,i,n,a){for(let e=0;e!==a;++e){var o=r+e;t[o]=t[o]+t[i+e]*n}}}const _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g"),_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones","map"];class Composite{constructor(e,t,r){r=r||PropertyBinding.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();var r=this._targetGroup.nCachedObjects_,r=this._bindings[r];void 0!==r&&r.getValue(e,t)}setValue(r,i){var n=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=n.length;e!==t;++e)n[e].setValue(r,i)}bind(){var r=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=r.length;e!==t;++e)r[e].bind()}unbind(){var r=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=r.length;e!==t;++e)r[e].unbind()}}class PropertyBinding{constructor(e,t,r){this.path=t,this.parsedPath=r||PropertyBinding.parseTrackName(t),this.node=PropertyBinding.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,r){return new(e&&e.isAnimationObjectGroup?PropertyBinding.Composite:PropertyBinding)(e,t,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(_reservedRe,"")}static parseTrackName(e){var t=_trackRe.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var r,t={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=t.nodeName&&t.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i&&(r=t.nodeName.substring(i+1),-1!==_supportedObjectNames.indexOf(r))&&(t.nodeName=t.nodeName.substring(0,i),t.objectName=r),null===t.propertyName||0===t.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return t}static findNode(e,i){if(void 0===i||""===i||"."===i||-1===i||i===e.name||i===e.uuid)return e;if(e.skeleton){var t=e.skeleton.getBoneByName(i);if(void 0!==t)return t}if(e.children){const n=function(t){for(let e=0;e<t.length;e++){var r=t[e];if(r.name===i||r.uuid===i)return r;r=n(r.children);if(r)return r}return null};t=n(e.children);if(t)return t}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(r,i){var n=this.resolvedProperty;for(let e=0,t=n.length;e!==t;++e)r[i++]=n[e]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(r,i){var n=this.resolvedProperty;for(let e=0,t=n.length;e!==t;++e)n[e]=r[i++]}_setValue_array_setNeedsUpdate(r,i){var n=this.resolvedProperty;for(let e=0,t=n.length;e!==t;++e)n[e]=r[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(r,i){var n=this.resolvedProperty;for(let e=0,t=n.length;e!==t;++e)n[e]=r[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let r=this.node;var e=this.parsedPath,i=e.objectName,n=e.propertyName;let a=e.propertyIndex;if(r||(r=PropertyBinding.findNode(this.rootNode,e.nodeName),this.node=r),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,r){if(i){let t=e.objectIndex;switch(i){case"materials":if(!r.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!r.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);r=r.material.materials;break;case"bones":if(!r.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);r=r.skeleton.bones;for(let e=0;e<r.length;e++)if(r[e].name===t){t=e;break}break;case"map":if("map"in r)r=r.map;else{if(!r.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!r.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);r=r.material.map}break;default:if(void 0===r[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);r=r[i]}if(void 0!==t){if(void 0===r[t])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,r);r=r[t]}}var o=r[n];if(void 0===o)e=e.nodeName,console.error("THREE.PropertyBinding: Trying to update property for track: "+e+"."+n+" but it wasn't found.",r);else{let e=this.Versioning.None,t=(void 0!==(this.targetObject=r).needsUpdate?e=this.Versioning.NeedsUpdate:void 0!==r.matrixWorldNeedsUpdate&&(e=this.Versioning.MatrixWorldNeedsUpdate),this.BindingType.Direct);if(void 0!==a){if("morphTargetInfluences"===n){if(!r.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!r.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==r.morphTargetDictionary[a]&&(a=r.morphTargetDictionary[a])}t=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=a}else void 0!==o.fromArray&&void 0!==o.toArray?(t=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(t=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=n;this.getValue=this.GetterByBindingType[t],this.setValue=this.SetterByBindingTypeAndVersioning[t][e]}}else console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".")}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}PropertyBinding.Composite=Composite,PropertyBinding.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},PropertyBinding.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},PropertyBinding.prototype.GetterByBindingType=[PropertyBinding.prototype._getValue_direct,PropertyBinding.prototype._getValue_array,PropertyBinding.prototype._getValue_arrayElement,PropertyBinding.prototype._getValue_toArray],PropertyBinding.prototype.SetterByBindingTypeAndVersioning=[[PropertyBinding.prototype._setValue_direct,PropertyBinding.prototype._setValue_direct_setNeedsUpdate,PropertyBinding.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_array,PropertyBinding.prototype._setValue_array_setNeedsUpdate,PropertyBinding.prototype._setValue_array_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_arrayElement,PropertyBinding.prototype._setValue_arrayElement_setNeedsUpdate,PropertyBinding.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_fromArray,PropertyBinding.prototype._setValue_fromArray_setNeedsUpdate,PropertyBinding.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class AnimationObjectGroup{constructor(){this.isAnimationObjectGroup=!0,this.uuid=generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var r={};this._indicesByUUID=r;for(let e=0,t=arguments.length;e!==t;++e)r[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){var i=this._objects,n=this._indicesByUUID,a=this._paths,o=this._parsedPaths,s=this._bindings,l=s.length;let c=void 0,d=i.length,h=this.nCachedObjects_;for(let e=0,t=arguments.length;e!==t;++e){var u=arguments[e],A=u.uuid;let r=n[A];if(void 0===r){r=d++,n[A]=r,i.push(u);for(let e=0,t=l;e!==t;++e)s[e].push(new PropertyBinding(u,a[e],o[e]))}else if(r<h){c=i[r];var p=--h,m=i[p];i[n[m.uuid]=r]=m,i[n[A]=p]=u;for(let t=0,e=l;t!==e;++t){var f=s[t],g=f[p];let e=f[r];f[r]=g,void 0===e&&(e=new PropertyBinding(u,a[t],o[t])),f[p]=e}}else i[r]!==c&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=h}remove(){var r=this._objects,i=this._indicesByUUID,n=this._bindings,a=n.length;let o=this.nCachedObjects_;for(let e=0,t=arguments.length;e!==t;++e){var s=arguments[e],l=s.uuid,c=i[l];if(void 0!==c&&c>=o){var d=o++,h=r[d];r[i[h.uuid]=c]=h,r[i[l]=d]=s;for(let e=0,t=a;e!==t;++e){var u=n[e],A=u[d],p=u[c];u[c]=A,u[d]=p}}}this.nCachedObjects_=o}uncache(){var r=this._objects,i=this._indicesByUUID,n=this._bindings,a=n.length;let o=this.nCachedObjects_,s=r.length;for(let e=0,t=arguments.length;e!==t;++e){var l=arguments[e].uuid,c=i[l];if(void 0!==c)if(delete i[l],c<o){var d=--o,l=r[d],h=--s,u=r[h];r[i[l.uuid]=c]=l,r[i[u.uuid]=d]=u,r.pop();for(let e=0,t=a;e!==t;++e){var A=n[e],p=A[d],m=A[h];A[c]=p,A[d]=m,A.pop()}}else{var f=--s,l=r[f];0<f&&(i[l.uuid]=c),r[c]=l,r.pop();for(let e=0,t=a;e!==t;++e){var g=n[e];g[c]=g[f],g.pop()}}}this.nCachedObjects_=o}subscribe_(r,i){var e=this._bindingsIndicesByPath,t=e[r],n=this._bindings;if(void 0!==t)return n[t];var a=this._paths,o=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,d=new Array(l),t=n.length;e[r]=t,a.push(r),o.push(i),n.push(d);for(let e=c,t=s.length;e!==t;++e){var h=s[e];d[e]=new PropertyBinding(h,r,i)}return d}unsubscribe_(e){var t,r,i,n,a,o=this._bindingsIndicesByPath,s=o[e];void 0!==s&&(t=this._paths,r=this._parsedPaths,a=(i=this._bindings)[n=i.length-1],i[o[e[n]]=s]=a,i.pop(),r[s]=r[n],r.pop(),t[s]=t[n],t.pop())}}class AnimationAction{constructor(e,t,r=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=r,this.blendMode=i;var n=t.tracks,a=n.length,o=new Array(a),s={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding};for(let e=0;e!==a;++e){var l=n[e].createInterpolant(null);(o[e]=l).settings=s}this._interpolantSettings=s,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,r){var i,n;return e.fadeOut(t),this.fadeIn(t),r&&(n=(r=this._clip.duration)/(i=e._clip.duration),e.warp(1,i/r,t),this.warp(n,1,t)),this}crossFadeTo(e,t,r){return e.crossFadeFrom(this,t,r)}stopFading(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,r){var i=this._mixer,n=i.time,a=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);var i=o.parameterPositions,s=o.sampleValues;return i[0]=n,i[1]=n+r,s[0]=e/a,s[1]=t/a,this}stopWarping(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,r,i){if(this.enabled){var n=this._startTime,a=(null!==n&&(t=(n=(e-n)*r)<0||0===r?0:(this._startTime=null,r*n)),t*=this._updateTimeScale(e),this._updateTime(t)),o=this._updateWeight(e);if(0<o){var s=this._interpolants,l=this._propertyBindings;if(this.blendMode===AdditiveAnimationBlendMode)for(let e=0,t=s.length;e!==t;++e)s[e].evaluate(a),l[e].accumulateAdditive(o);else{NormalAnimationBlendMode;for(let e=0,t=s.length;e!==t;++e)s[e].evaluate(a),l[e].accumulate(i,o)}}}else this._updateWeight(e)}_updateWeight(e){let t=0;var r,i;return this.enabled&&(t=this.weight,null!==(r=this._weightInterpolant))&&(i=r.evaluate(e)[0],t*=i,e>r.parameterPositions[1])&&(this.stopFading(),0===i)&&(this.enabled=!1),this._effectiveWeight=t}_updateTimeScale(e){let t=0;var r,i;return this.paused||(t=this.timeScale,null!==(r=this._timeScaleInterpolant)&&(i=r.evaluate(e)[0],t*=i,e>r.parameterPositions[1])&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)),this._effectiveTimeScale=t}_updateTime(e){var t=this._clip.duration,r=this.loop;let i=this.time+e,n=this._loopCount;var a,o=r===LoopPingPong;if(0===e)return-1!==n&&o&&1==(1&n)?t-i:i;if(r===LoopOnce){-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else if(-1===n&&(0<=e?(n=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),i>=t||i<0?(r=Math.floor(i/t),i-=t*r,n+=Math.abs(r),(a=this.repetitions-n)<=0?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=0<e?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<e?1:-1})):(1==a?this._setEndings(a=e<0,!a,o):this._setEndings(!1,!1,o),this._loopCount=n,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:r}))):this.time=i,o&&1==(1&n))return t-i;return i}_setEndings(e,t,r){var i=this._interpolantSettings;r?(i.endingStart=ZeroSlopeEnding,i.endingEnd=ZeroSlopeEnding):(i.endingStart=e?this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding:WrapAroundEnding,i.endingEnd=t?this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding:WrapAroundEnding)}_scheduleFading(e,t,r){var i=this._mixer,n=i.time;let a=this._weightInterpolant;null===a&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);var i=a.parameterPositions,o=a.sampleValues;return i[0]=n,o[0]=t,i[1]=n+e,o[1]=r,this}}const _controlInterpolantsResultBuffer=new Float32Array(1);class AnimationMixer extends EventDispatcher{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,r){var i=e._localRoot||this._root,n=e._clip.tracks,a=n.length,o=e._propertyBindings,s=e._interpolants,l=i.uuid,e=this._bindingsByRootAndName;let c=e[l];void 0===c&&(c={},e[l]=c);for(let t=0;t!==a;++t){var d=n[t],h=d.name;let e=c[h];if(void 0!==e)++e.referenceCount;else{if(void 0!==(e=o[t])){null===e._cacheIndex&&(++e.referenceCount,this._addInactiveBinding(e,l,h));continue}var u=r&&r._propertyBindings[t].binding.parsedPath;++(e=new PropertyMixer(PropertyBinding.create(i,h,u),d.ValueTypeName,d.getValueSize())).referenceCount,this._addInactiveBinding(e,l,h)}o[t]=e,s[t].resultBuffer=e.buffer}}_activateAction(e){if(!this._isActiveAction(e)){null===e._cacheIndex&&(t=(e._localRoot||this._root).uuid,r=e._clip.uuid,i=this._actionsByClip[r],this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,r,t));var t,r,i,n=e._propertyBindings;for(let e=0,t=n.length;e!==t;++e){var a=n[e];0==a.useCount++&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){var r=e._propertyBindings;for(let e=0,t=r.length;e!==t;++e){var i=r[e];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){e=e._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(e,t,r){var i=this._actions,n=this._actionsByClip;let a=n[t];void 0===a?(a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=a):(n=a.knownActions,e._byClipCacheIndex=n.length,n.push(e)),e._cacheIndex=i.length,i.push(e),a.actionByRoot[r]=e}_removeInactiveAction(e){var t=this._actions,r=t[t.length-1],i=e._cacheIndex,i=(t[r._cacheIndex=i]=r,t.pop(),e._cacheIndex=null,e._clip.uuid),r=this._actionsByClip,t=r[i],n=t.knownActions,a=n[n.length-1],o=e._byClipCacheIndex;n[a._byClipCacheIndex=o]=a,n.pop(),e._byClipCacheIndex=null,delete t.actionByRoot[(e._localRoot||this._root).uuid],0===n.length&&delete r[i],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){var r=e._propertyBindings;for(let e=0,t=r.length;e!==t;++e){var i=r[e];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(e){var t=this._actions,r=e._cacheIndex,i=this._nActiveActions++,n=t[i];t[e._cacheIndex=i]=e,t[n._cacheIndex=r]=n}_takeBackAction(e){var t=this._actions,r=e._cacheIndex,i=--this._nActiveActions,n=t[i];t[e._cacheIndex=i]=e,t[n._cacheIndex=r]=n}_addInactiveBinding(e,t,r){var i=this._bindingsByRootAndName,n=this._bindings;let a=i[t];void 0===a&&(a={},i[t]=a),(a[r]=e)._cacheIndex=n.length,n.push(e)}_removeInactiveBinding(e){var t=this._bindings,r=e.binding,i=r.rootNode.uuid,r=r.path,n=this._bindingsByRootAndName,a=n[i],o=t[t.length-1],e=e._cacheIndex;t[o._cacheIndex=e]=o,t.pop(),delete a[r],0===Object.keys(a).length&&delete n[i]}_lendBinding(e){var t=this._bindings,r=e._cacheIndex,i=this._nActiveBindings++,n=t[i];t[e._cacheIndex=i]=e,t[n._cacheIndex=r]=n}_takeBackBinding(e){var t=this._bindings,r=e._cacheIndex,i=--this._nActiveBindings,n=t[i];t[e._cacheIndex=i]=e,t[n._cacheIndex=r]=n}_lendControlInterpolant(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let r=e[t];return void 0===r&&(e[(r=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,_controlInterpolantsResultBuffer)).__cacheIndex=t]=r),r}_takeBackControlInterpolant(e){var t=this._controlInterpolants,r=e.__cacheIndex,i=--this._nActiveControlInterpolants,n=t[i];t[e.__cacheIndex=i]=e,t[n.__cacheIndex=r]=n}clipAction(e,t,r){var i=t||this._root,n=i.uuid;let a="string"==typeof e?AnimationClip.findByName(i,e):e;i=null!==a?a.uuid:e,e=this._actionsByClip[i];let o=null;if(void 0===r&&(r=null!==a?a.blendMode:NormalAnimationBlendMode),void 0!==e){var s=e.actionByRoot[n];if(void 0!==s&&s.blendMode===r)return s;o=e.knownActions[0],null===a&&(a=o._clip)}return null===a?null:(s=new AnimationAction(this,a,t,r),this._bindAction(s,o),this._addInactiveAction(s,i,n),s)}existingAction(e,t){var t=t||this._root,r=t.uuid,t="string"==typeof e?AnimationClip.findByName(t,e):e,t=t?t.uuid:e,e=this._actionsByClip[t];return void 0!==e&&e.actionByRoot[r]||null}stopAllAction(){var t=this._actions;for(let e=this._nActiveActions-1;0<=e;--e)t[e].stop();return this}update(t){t*=this.timeScale;var r=this._actions,i=this._nActiveActions,n=this.time+=t,a=Math.sign(t),o=this._accuIndex^=1;for(let e=0;e!==i;++e)r[e]._update(n,t,a,o);var s=this._bindings,l=this._nActiveBindings;for(let e=0;e!==l;++e)s[e].apply(o);return this}setTime(e){for(let e=this.time=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){var r=this._actions,e=e.uuid,t=this._actionsByClip,i=t[e];if(void 0!==i){var n=i.knownActions;for(let e=0,t=n.length;e!==t;++e){var a=n[e],o=(this._deactivateAction(a),a._cacheIndex),s=r[r.length-1];a._cacheIndex=null,a._byClipCacheIndex=null,r[s._cacheIndex=o]=s,r.pop(),this._removeInactiveBindingsForAction(a)}delete t[e]}}uncacheRoot(e){var t=e.uuid,r=this._actionsByClip;for(const o in r){var i=r[o].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var n=this._bindingsByRootAndName[t];if(void 0!==n)for(const s in n){var a=n[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){e=this.existingAction(e,t);null!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}}class Uniform{constructor(e){this.value=e}clone(){return new Uniform(void 0===this.value.clone?this.value:this.value.clone())}}let id=0;class UniformsGroup extends EventDispatcher{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:id++}),this.name="",this.usage=StaticDrawUsage,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){e=this.uniforms.indexOf(e);return-1!==e&&this.uniforms.splice(e,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;var r=e.uniforms;for(let e=this.uniforms.length=0,t=r.length;e<t;e++)this.uniforms.push(r[e].clone());return this}clone(){return(new this.constructor).copy(this)}}class InstancedInterleavedBuffer extends InterleavedBuffer{constructor(e,t,r=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){e=super.clone(e);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(e){e=super.toJSON(e);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}class GLBufferAttribute{constructor(e,t,r,i,n){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=r,this.elementSize=i,this.count=n,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class Raycaster{constructor(e,t,r=0,i=1/0){this.ray=new Ray(e,t),this.near=r,this.far=i,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,r=[]){return intersectObject(e,this,r,t),r.sort(ascSort),r}intersectObjects(r,i=!0,n=[]){for(let e=0,t=r.length;e<t;e++)intersectObject(r[e],this,n,i);return n.sort(ascSort),n}}function ascSort(e,t){return e.distance-t.distance}function intersectObject(e,r,i,t){if(e.layers.test(r.layers)&&e.raycast(r,i),!0===t){var n=e.children;for(let e=0,t=n.length;e<t;e++)intersectObject(n[e],r,i,!0)}}class Spherical{constructor(e=1,t=0,r=0){return this.radius=e,this.phi=t,this.theta=r,this}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(clamp(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class Cylindrical{constructor(e=1,t=0,r=0){return this.radius=e,this.theta=t,this.y=r,this}set(e,t,r){return this.radius=e,this.theta=t,this.y=r,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const _vector$4=new Vector2;class Box2{constructor(e=new Vector2(1/0,1/0),t=new Vector2(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(r){this.makeEmpty();for(let e=0,t=r.length;e<t;e++)this.expandByPoint(r[e]);return this}setFromCenterAndSize(e,t){t=_vector$4.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(t),this.max.copy(e).add(t),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,_vector$4).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const _startP=new Vector3,_startEnd=new Vector3;class Line3{constructor(e=new Vector3,t=new Vector3){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){_startP.subVectors(e,this.start),_startEnd.subVectors(this.end,this.start);e=_startEnd.dot(_startEnd);let r=_startEnd.dot(_startP)/e;return r=t?clamp(r,0,1):r}closestPointToPoint(e,t,r){e=this.closestPointToPointParameter(e,t);return this.delta(r).multiplyScalar(e).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const _vector$3=new Vector3;class SpotLightHelper extends Object3D{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";var e=new BufferGeometry,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1;e<32;e++,t++){var i=e/32*Math.PI*2,n=t/32*Math.PI*2;r.push(Math.cos(i),Math.sin(i),1,Math.cos(n),Math.sin(n),1)}e.setAttribute("position",new Float32BufferAttribute(r,3));t=new LineBasicMaterial({fog:!1,toneMapped:!1});this.cone=new LineSegments(e,t),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);var e=this.light.distance||1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),_vector$3.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(_vector$3),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const _vector$2=new Vector3,_boneMatrix=new Matrix4,_matrixWorldInv=new Matrix4;class SkeletonHelper extends LineSegments{constructor(e){var t=getBoneList(e),r=new BufferGeometry,i=[],n=[],a=new Color(0,0,1),o=new Color(0,1,0);for(let e=0;e<t.length;e++){var s=t[e];s.parent&&s.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),n.push(a.r,a.g,a.b),n.push(o.r,o.g,o.b))}r.setAttribute("position",new Float32BufferAttribute(i,3)),r.setAttribute("color",new Float32BufferAttribute(n,3)),super(r,new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){var r=this.bones,t=this.geometry,i=t.getAttribute("position");_matrixWorldInv.copy(this.root.matrixWorld).invert();for(let e=0,t=0;e<r.length;e++){var n=r[e];n.parent&&n.parent.isBone&&(_boneMatrix.multiplyMatrices(_matrixWorldInv,n.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),i.setXYZ(t,_vector$2.x,_vector$2.y,_vector$2.z),_boneMatrix.multiplyMatrices(_matrixWorldInv,n.parent.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),i.setXYZ(t+1,_vector$2.x,_vector$2.y,_vector$2.z),t+=2)}t.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function getBoneList(t){var r=[];!0===t.isBone&&r.push(t);for(let e=0;e<t.children.length;e++)r.push.apply(r,getBoneList(t.children[e]));return r}class PointLightHelper extends Mesh{constructor(e,t,r){super(new SphereGeometry(t,4,2),new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const _vector$1=new Vector3,_color1=new Color,_color2=new Color;class HemisphereLightHelper extends Object3D{constructor(e,t,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="HemisphereLightHelper";e=new OctahedronGeometry(t),e.rotateY(.5*Math.PI),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0),r=e.getAttribute("position"),t=new Float32Array(3*r.count);e.setAttribute("color",new BufferAttribute(t,3)),this.add(new Mesh(e,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var r=e.geometry.getAttribute("color");_color1.copy(this.light.color),_color2.copy(this.light.groundColor);for(let e=0,t=r.count;e<t;e++){var i=e<t/2?_color1:_color2;r.setXYZ(e,i.r,i.g,i.b)}r.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(_vector$1.setFromMatrixPosition(this.light.matrixWorld).negate())}}class GridHelper extends LineSegments{constructor(e=10,i=10,n=4473924,a=8947848){n=new Color(n),a=new Color(a);var o=i/2,s=e/i,l=e/2,c=[],d=[];for(let e=0,t=0,r=-l;e<=i;e++,r+=s){c.push(-l,0,r,l,0,r),c.push(r,0,-l,r,0,l);var h=e===o?n:a;h.toArray(d,t),t+=3,h.toArray(d,t),t+=3,h.toArray(d,t),t+=3,h.toArray(d,t),t+=3}var e=new BufferGeometry,t=(e.setAttribute("position",new Float32BufferAttribute(c,3)),e.setAttribute("color",new Float32BufferAttribute(d,3)),new LineBasicMaterial({vertexColors:!0,toneMapped:!1}));super(e,t),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class PolarGridHelper extends LineSegments{constructor(t=10,r=16,i=8,n=64,a=4473924,o=8947848){a=new Color(a),o=new Color(o);var s=[],l=[];if(1<r)for(let e=0;e<r;e++){var c=e/r*(2*Math.PI),d=Math.sin(c)*t,c=Math.cos(c)*t,d=(s.push(0,0,0),s.push(d,0,c),1&e?a:o);l.push(d.r,d.g,d.b),l.push(d.r,d.g,d.b)}for(let e=0;e<i;e++){var h=1&e?a:o,u=t-t/i*e;for(let e=0;e<n;e++){var A=e/n*(2*Math.PI),p=Math.sin(A)*u,m=Math.cos(A)*u;s.push(p,0,m),l.push(h.r,h.g,h.b),A=(e+1)/n*(2*Math.PI),p=Math.sin(A)*u,m=Math.cos(A)*u,s.push(p,0,m),l.push(h.r,h.g,h.b)}}var e=new BufferGeometry,f=(e.setAttribute("position",new Float32BufferAttribute(s,3)),e.setAttribute("color",new Float32BufferAttribute(l,3)),new LineBasicMaterial({vertexColors:!0,toneMapped:!1}));super(e,f),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const _v1=new Vector3,_v2=new Vector3,_v3=new Vector3;class DirectionalLightHelper extends Object3D{constructor(e,t,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",void 0===t&&(t=1);let i=new BufferGeometry;i.setAttribute("position",new Float32BufferAttribute([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));e=new LineBasicMaterial({fog:!1,toneMapped:!1});this.lightPlane=new Line(i,e),this.add(this.lightPlane),(i=new BufferGeometry).setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(i,e),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),_v1.setFromMatrixPosition(this.light.matrixWorld),_v2.setFromMatrixPosition(this.light.target.matrixWorld),_v3.subVectors(_v2,_v1),this.lightPlane.lookAt(_v2),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_v2),this.targetLine.scale.z=_v3.length()}}const _vector=new Vector3,_camera=new Camera;class CameraHelper extends LineSegments{constructor(e){var t=new BufferGeometry,r=new LineBasicMaterial({color:16777215,vertexColors:!0,toneMapped:!1});const i=[],n=[],a={};function o(e,t){s(e),s(t)}function s(e){i.push(0,0,0),n.push(0,0,0),void 0===a[e]&&(a[e]=[]),a[e].push(i.length/3-1)}o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4"),t.setAttribute("position",new Float32BufferAttribute(i,3)),t.setAttribute("color",new Float32BufferAttribute(n,3)),super(t,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();var t=new Color(16755200),r=new Color(16711680),e=new Color(43775),l=new Color(16777215),c=new Color(3355443);this.setColors(t,r,e,l,c)}setColors(e,t,r,i,n){var a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,r.r,r.g,r.b),a.setXYZ(33,r.r,r.g,r.b),a.setXYZ(34,r.r,r.g,r.b),a.setXYZ(35,r.r,r.g,r.b),a.setXYZ(36,r.r,r.g,r.b),a.setXYZ(37,r.r,r.g,r.b),a.setXYZ(38,i.r,i.g,i.b),a.setXYZ(39,i.r,i.g,i.b),a.setXYZ(40,n.r,n.g,n.b),a.setXYZ(41,n.r,n.g,n.b),a.setXYZ(42,n.r,n.g,n.b),a.setXYZ(43,n.r,n.g,n.b),a.setXYZ(44,n.r,n.g,n.b),a.setXYZ(45,n.r,n.g,n.b),a.setXYZ(46,n.r,n.g,n.b),a.setXYZ(47,n.r,n.g,n.b),a.setXYZ(48,n.r,n.g,n.b),a.setXYZ(49,n.r,n.g,n.b),a.needsUpdate=!0}update(){var e=this.geometry,t=this.pointMap;_camera.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),setPoint("c",t,e,_camera,0,0,-1),setPoint("t",t,e,_camera,0,0,1),setPoint("n1",t,e,_camera,-1,-1,-1),setPoint("n2",t,e,_camera,1,-1,-1),setPoint("n3",t,e,_camera,-1,1,-1),setPoint("n4",t,e,_camera,1,1,-1),setPoint("f1",t,e,_camera,-1,-1,1),setPoint("f2",t,e,_camera,1,-1,1),setPoint("f3",t,e,_camera,-1,1,1),setPoint("f4",t,e,_camera,1,1,1),setPoint("u1",t,e,_camera,.7,1.1,-1),setPoint("u2",t,e,_camera,-.7,1.1,-1),setPoint("u3",t,e,_camera,0,2,-1),setPoint("cf1",t,e,_camera,-1,0,1),setPoint("cf2",t,e,_camera,1,0,1),setPoint("cf3",t,e,_camera,0,-1,1),setPoint("cf4",t,e,_camera,0,1,1),setPoint("cn1",t,e,_camera,-1,0,-1),setPoint("cn2",t,e,_camera,1,0,-1),setPoint("cn3",t,e,_camera,0,-1,-1),setPoint("cn4",t,e,_camera,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function setPoint(e,t,r,i,n,a,o){_vector.set(n,a,o).unproject(i);var s=t[e];if(void 0!==s){var l=r.getAttribute("position");for(let e=0,t=s.length;e<t;e++)l.setXYZ(s[e],_vector.x,_vector.y,_vector.z)}}const _box=new Box3;class BoxHelper extends LineSegments{constructor(e,t=16776960){var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),n=new BufferGeometry;n.setIndex(new BufferAttribute(r,1)),n.setAttribute("position",new BufferAttribute(i,3)),super(n,new LineBasicMaterial({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){var t,r,i;void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&_box.setFromObject(this.object),_box.isEmpty()||(e=_box.min,t=_box.max,(i=(r=this.geometry.attributes.position).array)[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=e.x,i[4]=t.y,i[5]=t.z,i[6]=e.x,i[7]=e.y,i[8]=t.z,i[9]=t.x,i[10]=e.y,i[11]=t.z,i[12]=t.x,i[13]=t.y,i[14]=e.z,i[15]=e.x,i[16]=t.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=t.x,i[22]=e.y,i[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere())}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Box3Helper extends LineSegments{constructor(e,t=16776960){var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new BufferGeometry;i.setIndex(new BufferAttribute(r,1)),i.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new LineBasicMaterial({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class PlaneHelper extends Line{constructor(e,t=1,r=16776960){var i=new BufferGeometry,i=(i.setAttribute("position",new Float32BufferAttribute([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),i.computeBoundingSphere(),super(i,new LineBasicMaterial({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t,new BufferGeometry);i.setAttribute("position",new Float32BufferAttribute([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),i.computeBoundingSphere(),this.add(new Mesh(i,new MeshBasicMaterial({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const _axis=new Vector3;let _lineGeometry,_coneGeometry;class ArrowHelper extends Object3D{constructor(e=new Vector3(0,0,1),t=new Vector3(0,0,0),r=1,i=16776960,n=.2*r,a=.2*n){super(),this.type="ArrowHelper",void 0===_lineGeometry&&((_lineGeometry=new BufferGeometry).setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),(_coneGeometry=new CylinderGeometry(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Line(_lineGeometry,new LineBasicMaterial({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(_coneGeometry,new MeshBasicMaterial({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,n,a)}setDirection(e){.99999<e.y?this.quaternion.set(0,0,0,1):e.y<-.99999?this.quaternion.set(1,0,0,0):(_axis.set(e.z,0,-e.x).normalize(),e=Math.acos(e.y),this.quaternion.setFromAxisAngle(_axis,e))}setLength(e,t=.2*e,r=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class AxesHelper extends LineSegments{constructor(e=1){var e=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],t=new BufferGeometry,e=(t.setAttribute("position",new Float32BufferAttribute(e,3)),t.setAttribute("color",new Float32BufferAttribute([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),new LineBasicMaterial({vertexColors:!0,toneMapped:!1}));super(t,e),this.type="AxesHelper"}setColors(e,t,r){var i=new Color,n=this.geometry.attributes.color.array;return i.set(e),i.toArray(n,0),i.toArray(n,3),i.set(t),i.toArray(n,6),i.toArray(n,9),i.set(r),i.toArray(n,12),i.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class ShapePath{constructor(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,r,i){return this.currentPath.quadraticCurveTo(e,t,r,i),this}bezierCurveTo(e,t,r,i,n,a){return this.currentPath.bezierCurveTo(e,t,r,i,n,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(i){var n=ShapeUtils.isClockWise,o=this.subPaths;if(0===o.length)return[];let s,l,c;var t=[];if(1===o.length)l=o[0],(c=new Shape).curves=l.curves,t.push(c);else{var d,h,u=!n(o[0].getPoints()),u=i?!u:u,A=[],p=[];let a=[],r=0;p[r]=void 0,a[r]=[];for(let e=0,t=o.length;e<t;e++)s=n(d=(l=o[e]).getPoints()),(i?!s:s)?(!u&&p[r]&&r++,p[r]={s:new Shape,p:d},p[r].s.curves=l.curves,u&&r++,a[r]=[]):a[r].push({h:l,p:d[0]});if(!p[0]){var m=o;var f=[];for(let e=0,t=m.length;e<t;e++){var g=m[e],v=new Shape;v.curves=g.curves,f.push(v)}return f;return}if(1<p.length){let i=!1,n=0;for(let e=0,t=p.length;e<t;e++)A[e]=[];for(let r=0,e=p.length;r<e;r++){var _=a[r];for(let e=0;e<_.length;e++){var y=_[e];let t=!0;for(let e=0;e<p.length;e++)!function(o,s){var e=s.length;let l=!1;for(let n=e-1,a=0;a<e;n=a++){let e=s[n],t=s[a],r=t.x-e.x,i=t.y-e.y;if(Math.abs(i)>Number.EPSILON){if(i<0&&(e=s[a],r=-r,t=s[n],i=-i),!(o.y<e.y||o.y>t.y))if(o.y===e.y){if(o.x===e.x)return 1}else{var c=i*(o.x-e.x)-r*(o.y-e.y);if(0==c)return 1;c<0||(l=!l)}}else if(o.y===e.y&&(t.x<=o.x&&o.x<=e.x||e.x<=o.x&&o.x<=t.x))return 1}return l}(y.p,p[e].p)||(r!==e&&n++,t?(t=!1,A[e].push(y)):i=!0);t&&A[r].push(y)}}0<n&&!1===i&&(a=A)}for(let r=0,e=p.length;r<e;r++){c=p[r].s,t.push(c);for(let e=0,t=(h=a[r]).length;e<t;e++)c.holes.push(h[e].h)}}return t}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=REVISION);var THREE=Object.freeze({__proto__:null,ACESFilmicToneMapping:ACESFilmicToneMapping,AddEquation:AddEquation,AddOperation:AddOperation,AdditiveAnimationBlendMode:AdditiveAnimationBlendMode,AdditiveBlending:AdditiveBlending,AlphaFormat:AlphaFormat,AlwaysCompare:AlwaysCompare,AlwaysDepth:AlwaysDepth,AlwaysStencilFunc:AlwaysStencilFunc,AmbientLight:AmbientLight,AmbientLightProbe:AmbientLightProbe,AnimationAction:AnimationAction,AnimationClip:AnimationClip,AnimationLoader:AnimationLoader,AnimationMixer:AnimationMixer,AnimationObjectGroup:AnimationObjectGroup,AnimationUtils:AnimationUtils,ArcCurve:ArcCurve,ArrayCamera:ArrayCamera,ArrowHelper:ArrowHelper,Audio:Audio,AudioAnalyser:AudioAnalyser,AudioContext:AudioContext,AudioListener:AudioListener,AudioLoader:AudioLoader,AxesHelper:AxesHelper,BackSide:BackSide,BasicDepthPacking:BasicDepthPacking,BasicShadowMap:BasicShadowMap,Bone:Bone,BooleanKeyframeTrack:BooleanKeyframeTrack,Box2:Box2,Box3:Box3,Box3Helper:Box3Helper,BoxGeometry:BoxGeometry,BoxHelper:BoxHelper,BufferAttribute:BufferAttribute,BufferGeometry:BufferGeometry,BufferGeometryLoader:BufferGeometryLoader,ByteType:ByteType,Cache:Cache,Camera:Camera,CameraHelper:CameraHelper,CanvasTexture:CanvasTexture,CapsuleGeometry:CapsuleGeometry,CatmullRomCurve3:CatmullRomCurve3,CineonToneMapping:CineonToneMapping,CircleGeometry:CircleGeometry,ClampToEdgeWrapping:ClampToEdgeWrapping,Clock:Clock,Color:Color,ColorKeyframeTrack:ColorKeyframeTrack,ColorManagement:ColorManagement,CompressedArrayTexture:CompressedArrayTexture,CompressedCubeTexture:CompressedCubeTexture,CompressedTexture:CompressedTexture,CompressedTextureLoader:CompressedTextureLoader,ConeGeometry:ConeGeometry,CubeCamera:CubeCamera,CubeReflectionMapping:CubeReflectionMapping,CubeRefractionMapping:CubeRefractionMapping,CubeTexture:CubeTexture,CubeTextureLoader:CubeTextureLoader,CubeUVReflectionMapping:CubeUVReflectionMapping,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,CubicInterpolant:CubicInterpolant,CullFaceBack:CullFaceBack,CullFaceFront:CullFaceFront,CullFaceFrontBack:CullFaceFrontBack,CullFaceNone:CullFaceNone,Curve:Curve,CurvePath:CurvePath,CustomBlending:CustomBlending,CustomToneMapping:CustomToneMapping,CylinderGeometry:CylinderGeometry,Cylindrical:Cylindrical,Data3DTexture:Data3DTexture,DataArrayTexture:DataArrayTexture,DataTexture:DataTexture,DataTextureLoader:DataTextureLoader,DataUtils:DataUtils,DecrementStencilOp:DecrementStencilOp,DecrementWrapStencilOp:DecrementWrapStencilOp,DefaultLoadingManager:DefaultLoadingManager,DepthFormat:DepthFormat,DepthStencilFormat:DepthStencilFormat,DepthTexture:DepthTexture,DirectionalLight:DirectionalLight,DirectionalLightHelper:DirectionalLightHelper,DiscreteInterpolant:DiscreteInterpolant,DisplayP3ColorSpace:DisplayP3ColorSpace,DodecahedronGeometry:DodecahedronGeometry,DoubleSide:DoubleSide,DstAlphaFactor:DstAlphaFactor,DstColorFactor:DstColorFactor,DynamicCopyUsage:DynamicCopyUsage,DynamicDrawUsage:DynamicDrawUsage,DynamicReadUsage:DynamicReadUsage,EdgesGeometry:EdgesGeometry,EllipseCurve:EllipseCurve,EqualCompare:EqualCompare,EqualDepth:EqualDepth,EqualStencilFunc:EqualStencilFunc,EquirectangularReflectionMapping:EquirectangularReflectionMapping,EquirectangularRefractionMapping:EquirectangularRefractionMapping,Euler:Euler,EventDispatcher:EventDispatcher,ExtrudeGeometry:ExtrudeGeometry,FileLoader:FileLoader,Float16BufferAttribute:Float16BufferAttribute,Float32BufferAttribute:Float32BufferAttribute,Float64BufferAttribute:Float64BufferAttribute,FloatType:FloatType,Fog:Fog,FogExp2:FogExp2,FramebufferTexture:FramebufferTexture,FrontSide:FrontSide,Frustum:Frustum,GLBufferAttribute:GLBufferAttribute,GLSL1:GLSL1,GLSL3:GLSL3,GreaterCompare:GreaterCompare,GreaterDepth:GreaterDepth,GreaterEqualCompare:GreaterEqualCompare,GreaterEqualDepth:GreaterEqualDepth,GreaterEqualStencilFunc:GreaterEqualStencilFunc,GreaterStencilFunc:GreaterStencilFunc,GridHelper:GridHelper,Group:Group,HalfFloatType:HalfFloatType,HemisphereLight:HemisphereLight,HemisphereLightHelper:HemisphereLightHelper,HemisphereLightProbe:HemisphereLightProbe,IcosahedronGeometry:IcosahedronGeometry,ImageBitmapLoader:ImageBitmapLoader,ImageLoader:ImageLoader,ImageUtils:ImageUtils,IncrementStencilOp:IncrementStencilOp,IncrementWrapStencilOp:IncrementWrapStencilOp,InstancedBufferAttribute:InstancedBufferAttribute,InstancedBufferGeometry:InstancedBufferGeometry,InstancedInterleavedBuffer:InstancedInterleavedBuffer,InstancedMesh:InstancedMesh,Int16BufferAttribute:Int16BufferAttribute,Int32BufferAttribute:Int32BufferAttribute,Int8BufferAttribute:Int8BufferAttribute,IntType:IntType,InterleavedBuffer:InterleavedBuffer,InterleavedBufferAttribute:InterleavedBufferAttribute,Interpolant:Interpolant,InterpolateDiscrete:InterpolateDiscrete,InterpolateLinear:InterpolateLinear,InterpolateSmooth:InterpolateSmooth,InvertStencilOp:InvertStencilOp,KeepStencilOp:KeepStencilOp,KeyframeTrack:KeyframeTrack,LOD:LOD,LatheGeometry:LatheGeometry,Layers:Layers,LessCompare:LessCompare,LessDepth:LessDepth,LessEqualCompare:LessEqualCompare,LessEqualDepth:LessEqualDepth,LessEqualStencilFunc:LessEqualStencilFunc,LessStencilFunc:LessStencilFunc,Light:Light,LightProbe:LightProbe,Line:Line,Line3:Line3,LineBasicMaterial:LineBasicMaterial,LineCurve:LineCurve,LineCurve3:LineCurve3,LineDashedMaterial:LineDashedMaterial,LineLoop:LineLoop,LineSegments:LineSegments,LinearEncoding:LinearEncoding,LinearFilter:LinearFilter,LinearInterpolant:LinearInterpolant,LinearMipMapLinearFilter:LinearMipMapLinearFilter,LinearMipMapNearestFilter:LinearMipMapNearestFilter,LinearMipmapLinearFilter:LinearMipmapLinearFilter,LinearMipmapNearestFilter:LinearMipmapNearestFilter,LinearSRGBColorSpace:LinearSRGBColorSpace,LinearToneMapping:LinearToneMapping,Loader:Loader,LoaderUtils:LoaderUtils,LoadingManager:LoadingManager,LoopOnce:LoopOnce,LoopPingPong:LoopPingPong,LoopRepeat:LoopRepeat,LuminanceAlphaFormat:LuminanceAlphaFormat,LuminanceFormat:LuminanceFormat,MOUSE:MOUSE,Material:Material,MaterialLoader:MaterialLoader,MathUtils:MathUtils,Matrix3:Matrix3,Matrix4:Matrix4,MaxEquation:MaxEquation,Mesh:Mesh,MeshBasicMaterial:MeshBasicMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshMatcapMaterial:MeshMatcapMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshToonMaterial:MeshToonMaterial,MinEquation:MinEquation,MirroredRepeatWrapping:MirroredRepeatWrapping,MixOperation:MixOperation,MultiplyBlending:MultiplyBlending,MultiplyOperation:MultiplyOperation,NearestFilter:NearestFilter,NearestMipMapLinearFilter:NearestMipMapLinearFilter,NearestMipMapNearestFilter:NearestMipMapNearestFilter,NearestMipmapLinearFilter:NearestMipmapLinearFilter,NearestMipmapNearestFilter:NearestMipmapNearestFilter,NeverCompare:NeverCompare,NeverDepth:NeverDepth,NeverStencilFunc:NeverStencilFunc,NoBlending:NoBlending,NoColorSpace:NoColorSpace,NoToneMapping:NoToneMapping,NormalAnimationBlendMode:NormalAnimationBlendMode,NormalBlending:NormalBlending,NotEqualCompare:NotEqualCompare,NotEqualDepth:NotEqualDepth,NotEqualStencilFunc:NotEqualStencilFunc,NumberKeyframeTrack:NumberKeyframeTrack,Object3D:Object3D,ObjectLoader:ObjectLoader,ObjectSpaceNormalMap:ObjectSpaceNormalMap,OctahedronGeometry:OctahedronGeometry,OneFactor:OneFactor,OneMinusDstAlphaFactor:OneMinusDstAlphaFactor,OneMinusDstColorFactor:OneMinusDstColorFactor,OneMinusSrcAlphaFactor:OneMinusSrcAlphaFactor,OneMinusSrcColorFactor:OneMinusSrcColorFactor,OrthographicCamera:OrthographicCamera,PCFShadowMap:PCFShadowMap,PCFSoftShadowMap:PCFSoftShadowMap,PMREMGenerator:PMREMGenerator,Path:Path,PerspectiveCamera:PerspectiveCamera,Plane:Plane,PlaneGeometry:PlaneGeometry,PlaneHelper:PlaneHelper,PointLight:PointLight,PointLightHelper:PointLightHelper,Points:Points,PointsMaterial:PointsMaterial,PolarGridHelper:PolarGridHelper,PolyhedronGeometry:PolyhedronGeometry,PositionalAudio:PositionalAudio,PropertyBinding:PropertyBinding,PropertyMixer:PropertyMixer,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,Quaternion:Quaternion,QuaternionKeyframeTrack:QuaternionKeyframeTrack,QuaternionLinearInterpolant:QuaternionLinearInterpolant,RED_GREEN_RGTC2_Format:RED_GREEN_RGTC2_Format,RED_RGTC1_Format:RED_RGTC1_Format,REVISION:REVISION,RGBADepthPacking:RGBADepthPacking,RGBAFormat:RGBAFormat,RGBAIntegerFormat:RGBAIntegerFormat,RGBA_ASTC_10x10_Format:RGBA_ASTC_10x10_Format,RGBA_ASTC_10x5_Format:RGBA_ASTC_10x5_Format,RGBA_ASTC_10x6_Format:RGBA_ASTC_10x6_Format,RGBA_ASTC_10x8_Format:RGBA_ASTC_10x8_Format,RGBA_ASTC_12x10_Format:RGBA_ASTC_12x10_Format,RGBA_ASTC_12x12_Format:RGBA_ASTC_12x12_Format,RGBA_ASTC_4x4_Format:RGBA_ASTC_4x4_Format,RGBA_ASTC_5x4_Format:RGBA_ASTC_5x4_Format,RGBA_ASTC_5x5_Format:RGBA_ASTC_5x5_Format,RGBA_ASTC_6x5_Format:RGBA_ASTC_6x5_Format,RGBA_ASTC_6x6_Format:RGBA_ASTC_6x6_Format,RGBA_ASTC_8x5_Format:RGBA_ASTC_8x5_Format,RGBA_ASTC_8x6_Format:RGBA_ASTC_8x6_Format,RGBA_ASTC_8x8_Format:RGBA_ASTC_8x8_Format,RGBA_BPTC_Format:RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:RGBA_ETC2_EAC_Format,RGBA_PVRTC_2BPPV1_Format:RGBA_PVRTC_2BPPV1_Format,RGBA_PVRTC_4BPPV1_Format:RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format:RGBA_S3TC_DXT1_Format,RGBA_S3TC_DXT3_Format:RGBA_S3TC_DXT3_Format,RGBA_S3TC_DXT5_Format:RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:RGB_ETC1_Format,RGB_ETC2_Format:RGB_ETC2_Format,RGB_PVRTC_2BPPV1_Format:RGB_PVRTC_2BPPV1_Format,RGB_PVRTC_4BPPV1_Format:RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format:RGB_S3TC_DXT1_Format,RGFormat:RGFormat,RGIntegerFormat:RGIntegerFormat,RawShaderMaterial:RawShaderMaterial,Ray:Ray,Raycaster:Raycaster,RectAreaLight:RectAreaLight,RedFormat:RedFormat,RedIntegerFormat:RedIntegerFormat,ReinhardToneMapping:ReinhardToneMapping,RenderTarget:RenderTarget,RepeatWrapping:RepeatWrapping,ReplaceStencilOp:ReplaceStencilOp,ReverseSubtractEquation:ReverseSubtractEquation,RingGeometry:RingGeometry,SIGNED_RED_GREEN_RGTC2_Format:SIGNED_RED_GREEN_RGTC2_Format,SIGNED_RED_RGTC1_Format:SIGNED_RED_RGTC1_Format,SRGBColorSpace:SRGBColorSpace,Scene:Scene,ShaderChunk:ShaderChunk,ShaderLib:ShaderLib,ShaderMaterial:ShaderMaterial,ShadowMaterial:ShadowMaterial,Shape:Shape,ShapeGeometry:ShapeGeometry,ShapePath:ShapePath,ShapeUtils:ShapeUtils,ShortType:ShortType,Skeleton:Skeleton,SkeletonHelper:SkeletonHelper,SkinnedMesh:SkinnedMesh,Source:Source,Sphere:Sphere,SphereGeometry:SphereGeometry,Spherical:Spherical,SphericalHarmonics3:SphericalHarmonics3,SplineCurve:SplineCurve,SpotLight:SpotLight,SpotLightHelper:SpotLightHelper,Sprite:Sprite,SpriteMaterial:SpriteMaterial,SrcAlphaFactor:SrcAlphaFactor,SrcAlphaSaturateFactor:SrcAlphaSaturateFactor,SrcColorFactor:SrcColorFactor,StaticCopyUsage:StaticCopyUsage,StaticDrawUsage:StaticDrawUsage,StaticReadUsage:StaticReadUsage,StereoCamera:StereoCamera,StreamCopyUsage:StreamCopyUsage,StreamDrawUsage:StreamDrawUsage,StreamReadUsage:StreamReadUsage,StringKeyframeTrack:StringKeyframeTrack,SubtractEquation:SubtractEquation,SubtractiveBlending:SubtractiveBlending,TOUCH:TOUCH,TangentSpaceNormalMap:TangentSpaceNormalMap,TetrahedronGeometry:TetrahedronGeometry,Texture:Texture,TextureLoader:TextureLoader,TorusGeometry:TorusGeometry,TorusKnotGeometry:TorusKnotGeometry,Triangle:Triangle,TriangleFanDrawMode:TriangleFanDrawMode,TriangleStripDrawMode:TriangleStripDrawMode,TrianglesDrawMode:TrianglesDrawMode,TubeGeometry:TubeGeometry,TwoPassDoubleSide:TwoPassDoubleSide,UVMapping:UVMapping,Uint16BufferAttribute:Uint16BufferAttribute,Uint32BufferAttribute:Uint32BufferAttribute,Uint8BufferAttribute:Uint8BufferAttribute,Uint8ClampedBufferAttribute:Uint8ClampedBufferAttribute,Uniform:Uniform,UniformsGroup:UniformsGroup,UniformsLib:UniformsLib,UniformsUtils:UniformsUtils,UnsignedByteType:UnsignedByteType,UnsignedInt248Type:UnsignedInt248Type,UnsignedIntType:UnsignedIntType,UnsignedShort4444Type:UnsignedShort4444Type,UnsignedShort5551Type:UnsignedShort5551Type,UnsignedShortType:UnsignedShortType,VSMShadowMap:VSMShadowMap,Vector2:Vector2,Vector3:Vector3,Vector4:Vector4,VectorKeyframeTrack:VectorKeyframeTrack,VideoTexture:VideoTexture,WebGL1Renderer:WebGL1Renderer,WebGL3DRenderTarget:WebGL3DRenderTarget,WebGLArrayRenderTarget:WebGLArrayRenderTarget,WebGLCoordinateSystem:WebGLCoordinateSystem,WebGLCubeRenderTarget:WebGLCubeRenderTarget,WebGLMultipleRenderTargets:WebGLMultipleRenderTargets,WebGLRenderTarget:WebGLRenderTarget,WebGLRenderer:WebGLRenderer,WebGLUtils:WebGLUtils,WebGPUCoordinateSystem:WebGPUCoordinateSystem,WireframeGeometry:WireframeGeometry,WrapAroundEnding:WrapAroundEnding,ZeroCurvatureEnding:ZeroCurvatureEnding,ZeroFactor:ZeroFactor,ZeroSlopeEnding:ZeroSlopeEnding,ZeroStencilOp:ZeroStencilOp,_SRGBAFormat:_SRGBAFormat,sRGBEncoding:sRGBEncoding});const pause=t=>new Promise(e=>setTimeout(e,1e3*t)),sum=e=>e.reduce((e,t)=>e+t,0),eqArr=(e,t)=>{if(e.length!==t.length)return!1;for(const r=0,i=e.length;r<i;r++)if(e[r]instanceof Array&&t[r]instanceof Array){if(!eqArr(e[r],t[r]))return!1}else if(e[r]!==t[r])return!1;return!0},omit=(e,t)=>e.reduce((e,t)=>{const{[t]:r,...i}=e;return i},t),pick=(e,r)=>e.reduce((e,t)=>t in r?Object.assign(e,{[t]:r[t]}):e,{}),unique=(e,t,r)=>r.indexOf(e)===t,makeImage=(e,t,r)=>{var i=new Image(128,128);return i.src=r,i},copyProps=function({from:e,into:t,required:r=[],optional:i=[]}){var n,a,o=[];for(n of r||[]){if(void 0===e[n])throw new Error(`Missing property "${n}"`);t[n]=e[n],o.push(n)}for(a of i||[])void 0!==e[a]&&(t[a]=e[a],o.push(a));return o},UUIDRegex=new RegExp(/^(?:\{[0-9a-fA-F]{8}-(?:[0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}\}|[0-9a-fA-F]{8}-(?:[0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12})$/i),URLRegex=new RegExp(/[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)?/gi),semverRegex=new RegExp(/ ^([0-9]+)\.([0-9]+)\.([0-9]+)(?:-([0-9A-Za-z-]+(?:\.[0-9A-Za-z-]+)*))?(?:\+[0-9A-Za-z-]+)?$\b/gi),getAssigningComponent=e=>e.positionedMesh||e.positionedMeshGroup||e.blockInstance;function isConstructor(e){return!!e.prototype&&!!e.prototype.constructor.name}const checkPropTypes=function(r,i={},n={}){const a=(e,t,r)=>{let i=null;if("object"==typeof r&&r.msg&&(i=r.msg||null,r=r.test),"string"==typeof r){if(typeof t!==r)throw new Error(`Property [${e}] is a ${typeof t} not a ${r}. `+(i||""))}else if(r instanceof RegExp){if(!t.match(r))throw new Error(`Property [${e}] format is incorrect. `+(i||""))}else if("function"!=typeof r||isConstructor(r)){if("function"!=typeof r)throw console.error(r),new Error("Unknown check type ");if(!(t instanceof r))throw new Error(`Property [${e}] is a ${t.constructor.name} not a ${r.name||r}. `+(i||""))}else{r=r(t);if(!0!==r)throw new Error(`Invalid property [${e}]. ${"string"==typeof r?r:""} `+(i||"a "+i))}};for(let[t,e]of Object.entries(i)){const o=r[t];if(void 0===o)throw new Error(`Required property [${t}] is undefined in keys [${Object.keys(r).join(", ")}]`);Array.isArray(e)?e.forEach(e=>a(t,o,e)):a(t,o,e)}for(let[t,e]of Object.entries(n)){const s=r[t];void 0!==s&&(Array.isArray(e)?e.forEach(e=>a(t,s,e)):a(t,s,e))}return!0},buildMateMap=({connectionTypes:e,connectorTypes:r,connectors:i})=>{var n=new Map;for(let t of r){const o={};o.connectionTypes=e.filter(e=>e.settings.connectorTypes.includes(t)),o.connectorTypes=[];for(var a of o.connectionTypes){a=a.settings.connectorTypes,a=a[0]===t?a[1]:a[0];-1===o.connectorTypes.indexOf(a)&&o.connectorTypes.push(a)}o.connectors=i.filter(e=>o.connectorTypes.includes(e.type)),n.set(t,o)}return n},ucFirst=e=>e.charAt(0).toUpperCase()+e.slice(1);var getRandomValues="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),rnds8=new Uint8Array(16);function rng(){if(getRandomValues)return getRandomValues(rnds8);throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported")}var REGEX=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function validate(e){return"string"==typeof e&&REGEX.test(e)}for(var byteToHex=[],i=0;i<256;++i)byteToHex.push((i+256).toString(16).substr(1));function stringify(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,t=(byteToHex[e[t+0]]+byteToHex[e[t+1]]+byteToHex[e[t+2]]+byteToHex[e[t+3]]+"-"+byteToHex[e[t+4]]+byteToHex[e[t+5]]+"-"+byteToHex[e[t+6]]+byteToHex[e[t+7]]+"-"+byteToHex[e[t+8]]+byteToHex[e[t+9]]+"-"+byteToHex[e[t+10]]+byteToHex[e[t+11]]+byteToHex[e[t+12]]+byteToHex[e[t+13]]+byteToHex[e[t+14]]+byteToHex[e[t+15]]).toLowerCase();if(validate(t))return t;throw TypeError("Stringified UUID is invalid")}function parse(e){var t,r;if(validate(e))return(r=new Uint8Array(16))[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r;throw TypeError("Invalid UUID")}function stringToBytes(e){e=unescape(encodeURIComponent(e));for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}var DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",URL$1="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function v35(e,o,s){function t(e,t,r,i){if("string"==typeof e&&(e=stringToBytes(e)),16!==(t="string"==typeof t?parse(t):t).length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var n=new Uint8Array(16+e.length);if(n.set(t),n.set(e,t.length),(n=s(n))[6]=15&n[6]|o,n[8]=63&n[8]|128,r){i=i||0;for(var a=0;a<16;++a)r[i+a]=n[a];return r}return stringify(n)}try{t.name=e}catch(e){}return t.DNS=DNS,t.URL=URL$1,t}function md5(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return md5ToHexEncodedArray(wordsToMd5(bytesToWords(e),8*e.length))}function md5ToHexEncodedArray(e){for(var t=[],r=32*e.length,i="0123456789abcdef",n=0;n<r;n+=8){var a=e[n>>5]>>>n%32&255,a=parseInt(i.charAt(a>>>4&15)+i.charAt(15&a),16);t.push(a)}return t}function getOutputLength(e){return 14+(e+64>>>9<<4)+1}function wordsToMd5(e,t){e[t>>5]|=128<<t%32,e[getOutputLength(t)-1]=t;for(var r=1732584193,i=-271733879,n=-1732584194,a=271733878,o=0;o<e.length;o+=16){var s=r,l=i,c=n,d=a,r=md5ff(r,i,n,a,e[o],7,-680876936),a=md5ff(a,r,i,n,e[o+1],12,-389564586),n=md5ff(n,a,r,i,e[o+2],17,606105819),i=md5ff(i,n,a,r,e[o+3],22,-1044525330);r=md5ff(r,i,n,a,e[o+4],7,-176418897),a=md5ff(a,r,i,n,e[o+5],12,1200080426),n=md5ff(n,a,r,i,e[o+6],17,-1473231341),i=md5ff(i,n,a,r,e[o+7],22,-45705983),r=md5ff(r,i,n,a,e[o+8],7,1770035416),a=md5ff(a,r,i,n,e[o+9],12,-1958414417),n=md5ff(n,a,r,i,e[o+10],17,-42063),i=md5ff(i,n,a,r,e[o+11],22,-1990404162),r=md5ff(r,i,n,a,e[o+12],7,1804603682),a=md5ff(a,r,i,n,e[o+13],12,-40341101),n=md5ff(n,a,r,i,e[o+14],17,-1502002290),r=md5gg(r,i=md5ff(i,n,a,r,e[o+15],22,1236535329),n,a,e[o+1],5,-165796510),a=md5gg(a,r,i,n,e[o+6],9,-1069501632),n=md5gg(n,a,r,i,e[o+11],14,643717713),i=md5gg(i,n,a,r,e[o],20,-373897302),r=md5gg(r,i,n,a,e[o+5],5,-701558691),a=md5gg(a,r,i,n,e[o+10],9,38016083),n=md5gg(n,a,r,i,e[o+15],14,-660478335),i=md5gg(i,n,a,r,e[o+4],20,-405537848),r=md5gg(r,i,n,a,e[o+9],5,568446438),a=md5gg(a,r,i,n,e[o+14],9,-1019803690),n=md5gg(n,a,r,i,e[o+3],14,-187363961),i=md5gg(i,n,a,r,e[o+8],20,1163531501),r=md5gg(r,i,n,a,e[o+13],5,-1444681467),a=md5gg(a,r,i,n,e[o+2],9,-51403784),n=md5gg(n,a,r,i,e[o+7],14,1735328473),r=md5hh(r,i=md5gg(i,n,a,r,e[o+12],20,-1926607734),n,a,e[o+5],4,-378558),a=md5hh(a,r,i,n,e[o+8],11,-2022574463),n=md5hh(n,a,r,i,e[o+11],16,1839030562),i=md5hh(i,n,a,r,e[o+14],23,-35309556),r=md5hh(r,i,n,a,e[o+1],4,-1530992060),a=md5hh(a,r,i,n,e[o+4],11,1272893353),n=md5hh(n,a,r,i,e[o+7],16,-155497632),i=md5hh(i,n,a,r,e[o+10],23,-1094730640),r=md5hh(r,i,n,a,e[o+13],4,681279174),a=md5hh(a,r,i,n,e[o],11,-358537222),n=md5hh(n,a,r,i,e[o+3],16,-722521979),i=md5hh(i,n,a,r,e[o+6],23,76029189),r=md5hh(r,i,n,a,e[o+9],4,-640364487),a=md5hh(a,r,i,n,e[o+12],11,-421815835),n=md5hh(n,a,r,i,e[o+15],16,530742520),r=md5ii(r,i=md5hh(i,n,a,r,e[o+2],23,-995338651),n,a,e[o],6,-198630844),a=md5ii(a,r,i,n,e[o+7],10,1126891415),n=md5ii(n,a,r,i,e[o+14],15,-1416354905),i=md5ii(i,n,a,r,e[o+5],21,-57434055),r=md5ii(r,i,n,a,e[o+12],6,1700485571),a=md5ii(a,r,i,n,e[o+3],10,-1894986606),n=md5ii(n,a,r,i,e[o+10],15,-1051523),i=md5ii(i,n,a,r,e[o+1],21,-2054922799),r=md5ii(r,i,n,a,e[o+8],6,1873313359),a=md5ii(a,r,i,n,e[o+15],10,-30611744),n=md5ii(n,a,r,i,e[o+6],15,-1560198380),i=md5ii(i,n,a,r,e[o+13],21,1309151649),r=md5ii(r,i,n,a,e[o+4],6,-145523070),a=md5ii(a,r,i,n,e[o+11],10,-1120210379),n=md5ii(n,a,r,i,e[o+2],15,718787259),i=md5ii(i,n,a,r,e[o+9],21,-343485551),r=safeAdd(r,s),i=safeAdd(i,l),n=safeAdd(n,c),a=safeAdd(a,d)}return[r,i,n,a]}function bytesToWords(e){if(0===e.length)return[];for(var t=8*e.length,r=new Uint32Array(getOutputLength(t)),i=0;i<t;i+=8)r[i>>5]|=(255&e[i/8])<<i%32;return r}function safeAdd(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function bitRotateLeft(e,t){return e<<t|e>>>32-t}function md5cmn(e,t,r,i,n,a){return safeAdd(bitRotateLeft(safeAdd(safeAdd(t,e),safeAdd(i,a)),n),r)}function md5ff(e,t,r,i,n,a,o){return md5cmn(t&r|~t&i,e,t,n,a,o)}function md5gg(e,t,r,i,n,a,o){return md5cmn(t&i|r&~i,e,t,n,a,o)}function md5hh(e,t,r,i,n,a,o){return md5cmn(t^r^i,e,t,n,a,o)}function md5ii(e,t,r,i,n,a,o){return md5cmn(r^(t|~i),e,t,n,a,o)}var v3=v35("v3",48,md5);function v4(e,t,r){var i=(e=e||{}).random||(e.rng||rng)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){r=r||0;for(var n=0;n<16;++n)t[r+n]=i[n];return t}return stringify(i)}function f(e,t,r,i){switch(e){case 0:return t&r^~t&i;case 1:return t^r^i;case 2:return t&r^t&i^r&i;case 3:return t^r^i}}function ROTL(e,t){return e<<t|e>>>32-t}function sha1(e){var t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var i=unescape(encodeURIComponent(e));e=[];for(var n=0;n<i.length;++n)e.push(i.charCodeAt(n))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var a=e.length/4+2,o=Math.ceil(a/16),s=new Array(o),l=0;l<o;++l){for(var c=new Uint32Array(16),d=0;d<16;++d)c[d]=e[64*l+4*d]<<24|e[64*l+4*d+1]<<16|e[64*l+4*d+2]<<8|e[64*l+4*d+3];s[l]=c}s[o-1][14]=8*(e.length-1)/Math.pow(2,32),s[o-1][14]=Math.floor(s[o-1][14]),s[o-1][15]=8*(e.length-1)&4294967295;for(var h=0;h<o;++h){for(var u=new Uint32Array(80),A=0;A<16;++A)u[A]=s[h][A];for(var p=16;p<80;++p)u[p]=ROTL(u[p-3]^u[p-8]^u[p-14]^u[p-16],1);for(var m=r[0],g=r[1],v=r[2],_=r[3],y=r[4],E=0;E<80;++E)var T=Math.floor(E/20),T=ROTL(m,5)+f(T,g,v,_)+y+t[T]+u[E]>>>0,y=_,_=v,v=ROTL(g,30)>>>0,g=m,m=T;r[0]=r[0]+m>>>0,r[1]=r[1]+g>>>0,r[2]=r[2]+v>>>0,r[3]=r[3]+_>>>0,r[4]=r[4]+y>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]}var v5=v35("v5",80,sha1);class EventEmitter{constructor(){this._events={}}addEvent(e){this._events[e]||(this._events[e]={})}on(e,t,r){this._events[e]||(this._events[e]={});r=r||v4();this._events[e][r]=t,this._events.listenerChange&&this.emit("listenerChange",{event:e,listenerObject:this._events[e]})}once(t,r){const i=v4();this.on(t,(...e)=>{this.removeListener(t,i),r(...e)},i)}hasListener(e,t){return!!this._events&&this._events[e]&&this._events[e][t]}removeListener(e,t){if(!this._events[e])throw new Error(`Can't remove listener for unknown event "${e}".`);if(!this._events[e][t])throw new Error(`Can't remove ${e} listener with unknown id "${t}".`);delete this._events[e][t],this._events.listenerChange&&this.emit("listenerChange",{event:e,listenerObject:this._events[e]})}emit(e,t){return this._events[e]||(this._events[e]={}),Promise.all(Object.values(this._events[e]).map(e=>e(t)))}removeAllListeners(){for(var[e,t]of Object.entries(this._events||{}))for(var[r,i]of Object.entries(t))this.removeListener(e,r)}destroy(){for(var e in this.removeAllListeners(),"function"==typeof super.destroy&&super.destroy(),this)this[e]=null}}class InformationSource extends EventEmitter{constructor(r,e={}){if(!(r instanceof Reporter))throw new Error("No reporter");checkPropTypes(e,{},{id:UUIDRegex,name:"string"}),super(),this.id=e.id||v4(),this.slug=e.slug||this.id.substr(0,4),this.name=e.name||"",this.label=this.constructor.name+" "+(this.name||this.slug),this._reporter=r,this.report=({msg:e,level:t="debug"})=>r.report({msg:e,level:t,time:(new Date).getTime(),source:{id:this.id,name:this.name,type:this.constructor.name}})}static uuid(){return v4()}destroy(){this.removeAllListeners(),"function"==typeof super.destroy&&super.destroy()}}class Logger extends InformationSource{constructor(e,t){super(t),this.fromLevel=e,this.fromLevelNum=Reporter.syslogLevelsIndexed[e],this._reporter=t}log({}){}}class Reporter{constructor(){this._actions={},this._loggers=[],this._rebuildActionDictionary()}_rebuildActionDictionary(){this._actions=Reporter.logLevels.reduce((e,t)=>Object.assign(e,{[t]:[]}),{});for(var t of this._loggers)for(let e=0;e<=7;e+=1)e<=t.fromLevelNum&&this._actions[Reporter.logLevels[e]].push(t)}addLogger(e){this._loggers.push(e),this._rebuildActionDictionary()}async report({msg:t,level:r="debug",source:i}){return Promise.all(this._actions[r].map(e=>e.log({msg:t,level:r,source:i})))}}Reporter.logLevels=["emergency","alert","critical","error","warning","notice","info","debug"],Reporter.syslogLevelsIndexed={emergency:0,alert:1,critical:2,error:3,warning:4,notice:5,info:6,debug:8};class ServerConnection extends InformationSource{constructor(e,t){if(!["ws:","wss:"].includes(t.url.protocol))throw new Error("URL must be of a websocket server");super(e,{...t,name:t.url.hostname}),this.reporter=e,this.reconnectTime=t.reconnectTime||30,this.url=t.url,this._connected=!1,this._socket=null,this.autoReconnectFlag=0<this.reconnectTime,this._requestRegister={},this._connectionChangeHandlers=[],this._connect()}get connected(){return this._connected}_notificationHandler(e){this.report({level:"notice",msg:"Unhandled notification "+e.meta.type})}set notificationHandler(e){if("function"!=typeof e)throw new Error("Notification handler must be a function");this._notificationHandler=e}async _connect(){const t=this,r=function(e){return t.report({msg:"Closed",level:"notice"}),t._socket.removeEventListener("close",r),t._socket.removeEventListener("message",i),t._socket=null,t._connected=!1,t.emit("connection-changed",!1),t._connect()},i=this._handleMessage.bind(this);for(;!0!==this._connected&&!0===this.autoReconnectFlag;){let e=null;try{e=await ServerConnection.openWebsocket(this.url)}catch(e){this.report({msg:"Failed"})}if(e){this.report({msg:"Opened",level:"notice"}),this._socket=e,this._connected=!0,this._socket.addEventListener("close",r),this._socket.addEventListener("message",i),this.emit("connection-changed",!0);break}0<this.reconnectTime&&await pause(this.reconnectTime)}}static openWebsocket(e){let t=new WebSocket(e.href),r=null,i=null;e=new Promise(function(e,t){r=e,i=t});function n(){t.removeEventListener("open",a),t.removeEventListener("close",o),t.removeEventListener("error",o)}const a=function(e){n(),r(t)},o=function(){n();try{t.close()}catch(e){}t=null,i(null)};return t.addEventListener("open",a),t.addEventListener("close",o),t.addEventListener("error",o),e}_handleMessage(t){let e={};try{e=JSON.parse(t.data)}catch(e){return void this.report({level:"error",msg:"Could not parse msg as JSON: "+t.message})}e.meta&&e.meta.id?e.meta.type?this._notificationHandler(e):e.errors?(console.error("Error response from server:",e),this._requestRegister[e.meta.id].reject(e.errors[0].detail)):this._requestRegister[e.meta.id]?(this._requestRegister[e.meta.id].resolve(e),delete this._requestRegister[e.meta.id]):this.report({level:"notice",msg:"Unhandled response "+JSON.stringify(t.message)}):this.report({level:"error",msg:"Malformed message: "+t.message})}request({method:e,endpoint:t,data:r}){if(!0!==this._connected)throw new Error("ServerConnection not available (yet)");const i=v4();var n=new Promise((e,t)=>this._requestRegister[i]={resolve:e,reject:t});return this._socket.send(JSON.stringify({meta:{id:i,method:e,endpoint:t},data:r})),n}}function getDimensions(e){e.content.main.medium;var t=new Vector3,r=e.boundingBox.boundingBox.getCenter(t),i=new Vector3(r.x,0,r.z),n=e.boundingBox.boundingBox.min,a=e.boundingBox.boundingBox.max;e.boundingBox.boundingBox.getSize(t);return{center:r,base:i,min:n,max:a,width:Math.round(100*e.boundingBox.boundingBox.getSize(t).x),height:Math.round(100*e.boundingBox.boundingBox.getSize(t).y),depth:Math.round(100*e.boundingBox.boundingBox.getSize(t).z),dimLeft:[{start:new Vector3(n.x,n.y,a.z),end:new Vector3(n.x,n.y,n.z)}],dimBack:[{start:new Vector3(n.x,n.y,n.z),end:new Vector3(a.x,n.y,n.z)}],dimRight:[{start:new Vector3(a.x,n.y,n.z),end:new Vector3(a.x,n.y,a.z)}],dimFront:[{start:new Vector3(n.x,n.y,a.z),end:new Vector3(a.x,n.y,a.z)}],dimHeight:[{start:new Vector3(n.x,n.y,n.z),end:new Vector3(n.x,a.y,n.z)}]}}function getDimensionsBoundingBox(e){var t=new Vector3,r=e.getCenter(t),i=new Vector3(r.x,0,r.z),n=e.min,a=e.max;e.getSize(t);return{center:r,base:i,min:n,max:a,width:Math.round(100*e.getSize(t).x),height:Math.round(100*e.getSize(t).y),depth:Math.round(100*e.getSize(t).z),dimLeft:[{start:new Vector3(n.x,n.y,a.z),end:new Vector3(n.x,n.y,n.z)}],dimBack:[{start:new Vector3(n.x,n.y,n.z),end:new Vector3(a.x,n.y,n.z)}],dimRight:[{start:new Vector3(a.x,n.y,n.z),end:new Vector3(a.x,n.y,a.z)}],dimFront:[{start:new Vector3(n.x,n.y,a.z),end:new Vector3(a.x,n.y,a.z)}],dimHeight:[{start:new Vector3(n.x,n.y,n.z),end:new Vector3(n.x,a.y,n.z)}]}}class Atom extends InformationSource{constructor(e,t,r,i){super(e,{name:t}),this._state=void 0,this._states=void 0,this.addEvent("change");for(const a in r){var n=r[a];if(!Array.isArray(n))throw new Error("Missing state transitions array");for(const o of n)if(!r.hasOwnProperty(o))throw new Error("State transition to unknown state specified")}if(!r[i])throw new Error("Unknown initial state "+i);this._states=r,this._state=i}async setState(e,t){if(e!==this._state){if(this._states[e]){var r,i=this._state;if(i&&!this._states[i].includes(e))throw this.report({msg:r=`Transition from state ${i} to state ${e} not allowed`,level:"error"}),new Error(r);return this._state=e,this.emit("change",{state:this._state,previousState:i,bubbleState:t})}throw new Error("Unknown state "+e)}}get state(){return this._state}}class Component extends InformationSource{constructor(e,t){if(super(e,pick(["id","name"],t)),this._status={},this._debug=!1,this.mainPlaceholder=void 0,this._settings=void 0,this._tree=void 0,this._content={},this.makeNullStatusObj=()=>{var e,t={};for(e of Component.parts){t[e]={};for(var r of Component.qualities)t[e][r]=null}return t},this._resetContent=()=>{this._content=this.makeNullStatusObj()},this._error={},this.destroyed=!1,!this.constructor._exportName)throw new Error("Class constructor is missing a static exportName field");this._error=this.makeNullStatusObj(),this._resetContent(),this._debug=t.debug||!1,delete t.debug,this._settings=t,this.addEvent("status-change");for(let n of Component.parts){this._status[n]||(this._status[n]={});for(let i of Component.qualities)this._status[n][i]=Component.partQualityStatusAtom(`${this.label} ${i} quality `+n,this._reporter),this._status[n][i].on("change",({state:e,previousState:t,bubbleState:r})=>("main"===n&&"medium"===i&&"ready"===e&&this.report({msg:`${i} quality ${n} status: ${t} -> `+e,level:"debug"}),"error"===e&&console.error(this.label,`${i} quality ${n} status: ${t} -> `+e),!1===r||this.emit("status-change",{quality:i,part:n,status:e,previousStatus:t,bubbleState:r})))}for(let e of Object.keys(this._settings))"source"!==e&&void 0===this[e]&&void 0===Object.getOwnPropertyDescriptor(this,e)&&Object.defineProperty(this,e,{get:()=>this._settings[e]})}static get exportLevel(){return this._exportLevel}get exportLevel(){return this.constructor.exportLevel}static get exportName(){return this._exportName.plural}get exportName(){return this.constructor.exportName}static partQualityStatusAtom(e,t){return new Atom(t,e+" status",{"not-loaded":["loading","partially-loaded","ready","error"],loading:["partially-loaded","ready","error"],"partially-loaded":["not-loaded","loading","ready","error"],ready:["not-loaded","loading","partially-loaded","error"],error:[]},"not-loaded")}get status(){var e,t={};for(e of Component.parts){t[e]={};for(var r of Component.qualities)t[e][r]=this._status[e][r].state}return t}get materializable(){return void 0!==this._settings.materialVariantGroup}get settings(){return this._settings}_onTreeSet(){}_onTreeUnset(){}get tree(){return this._tree}set tree(e){if(void 0===e)this._onTreeUnset(),this._tree=void 0;else{if(void 0!==this._tree&&!0===this.constructor.treeLock)throw new Error(this.label+" tree property already set.");this._tree=e,this._onTreeSet()}}get content(){return this._content}get error(){return this._error}_setContent(e,t,r,i=!0){return this._content[e][t]=r,this._status[e][t].setState("ready",i)}_setError(e,t,r){if(null!==this._error[e][t])throw console.error(r),new Error(`Can not set ${this.label} ${e} ${t} to error state twice. New error ignored.`);return this._error[e][t]=r,this._status[e][t].setState("error")}clone(e={}){return new this.constructor(this._reporter,{...this._settings,...e})}static sortStatusArray(e){return e.slice().sort((e,t)=>Component.loadStatusSortMap[t]-Component.loadStatusSortMap[e])}static sortQualityArray(e){return e.slice().sort((e,t)=>Component.qualitySortMap[t]-Component.qualitySortMap[e])}static highestQualityLoaded(e){return e.high||e.medium||e.low||null}static unlink(e){return Array.isArray(e)?e.map(Component.unlink):e instanceof Package?void 0:e instanceof Component?e.id:e instanceof URL?e.href:"object"==typeof e?Object.entries(e).reduce((e,[t,r])=>Object.assign(e,{[t]:Component.unlink(r)}),{}):e}toJSON(){var e,t,r,i=Object.entries(this._settings).reduce((e,[t,r])=>{r=Component.unlink(r);return void 0===r||(e[t]=r),e},{id:this.id,name:this.name});if("Configuration"===this.constructor.name)if(this.assignedMaterials){var n,a={};for(n of this.blockInstances||[]){a[n.id]={assignables:[],block:{id:n.block.id,name:n.block.name}};for(var o of this.assignedMaterials[n.id]||[]){var s,l,c={assignments:[]};for([s,l]of Object.entries(o.mvg)){var d=this.pkg.findComponentById(s),d={mvg:{id:s,name:d.name},material:{id:l.id,name:l.name}};c.assignments.push(d)}o.positionedMeshGroup&&(c.positionedMeshGroup={id:positionedMeshGroup.id,name:positionedMeshGroup.id}),o.positionedMesh&&(c.positionedMesh={id:positionedMesh.id,name:positionedMesh.id}),a[n.id].assignables.push(c)}}i.materialOverview=a}else console.warn("Not exporting assigned materials, configuration not build yet");this._settings&&this._settings.source&&1===Object.keys(this._settings.source).length&&(i.source=this._settings.source.medium);const h={[this.exportName]:[i]};for(e of Component.parts){var u,A=this.dependencies?Object.values(this.dependencies[e]):[];if("main"===e&&this._exportOnlyDependencies&&0<(u=Object.values(this._exportOnlyDependencies)).length&&A.push(...u),0<A.length){var p,m=A.flat();let e=[];for(let t of e="ComponentTree"===this.constructor.name?this.constructor.importInstructions.map(e=>e.cls):this._tree?this._tree.constructor.importInstructions.map(e=>e.cls):m.filter(unique).map(e=>e.constructor))for(p of m.filter(e=>e.constructor===t))if("ComponentTree"===p.constructor.name)this.report({msg:"Not exporting external component tree "+ComponentTree.label});else if("configurations"===p.exportName)h.configurations=h.configurations||[],h.configurations.push(p.toJSON());else{var f,g=p.toJSON();for(let[e,t]of Object.entries(g))"root"!==p.exportLevel&&e===p.exportName?(i[p.exportName]=i[p.exportName]||[],i[p.exportName].push(...t),f=i[p.exportName].indexOf(p.id),i[p.exportName].splice(f,1),delete h[p.exportName]):(h[e]=h[e]||[],f=t.filter(t=>void 0===h[e].find(e=>e.id===t.id)),h[e].push(...f))}}}for([t,r]of Object.entries(h))Array.isArray(r)&&r.sort((e,t)=>e.id>t.id?1:-1);return h}destroy(){if(!1!==this.destroyed)console.warn(this.label,"was already destroyed");else{this.destroyed=!0;for(var e of Component.parts)for(var t of Component.qualities)this._status[e][t].removeAllListeners(),this._content[e][t]&&"function"==typeof this._content[e][t].dispose&&this._content[e][t].dispose();this._resetContent();for(var r of Object.keys(this.settings))["options"].includes(r)||(this.settings[r]=void 0);for(var i of Object.keys(this))this[i]=void 0;super.destroy&&super.destroy()}}}Component._exportLevel="root",Component._exportName={singular:"component",plural:"components"},Component.qualities=["medium"],Component.parts=["UI","main","specs"],Component.treeLock=!0,Component.loadStatusSortMap={"not-loaded":1,loading:2,"partially-loaded":3,ready:4,error:5},Component.qualitySortMap={high:3,medium:2,low:1};class LoadingBase extends InformationSource{constructor(e,t){super(e,t),t.for||(console.warn("Setting LoadingBase `for` property to `default`"),t.for=["default"]),checkPropTypes(t,{url:URL,for:e=>Array.isArray(e)&&e.every(e=>"string"==typeof e)},{}),"/"!==t.url.href.substr(-1)&&(t.url.href+="/"),this.url=t.url,this.for=t.for,this.name=t.name}}class LoadableComponent extends Component{constructor(e,t){if(super(e,t),this.source={},!t.source)throw new Error("Missing source property");if(!t.source.medium)throw new Error("Source should always specify a medium quality file");var r,i=e=>"string"!=typeof e.path||""===e.path?`Property path = ${e.path}, should be a non-empty string.`:"number"==typeof e.sizeBytes||`Property sizeBytes = ${e.sizeBytes}, should be a number.`,n={};for(r of Component.qualities)n[r]=i;checkPropTypes(t.source,{medium:i},{loadingBase:"string",...n}),this.loadingBase||(this.loadingBase="default"),this.source={medium:t.source.medium},this.source.high=t.source.high||t.source.medium,this.source.low=t.source.low||t.source.medium}async _load(e,t){return this.report({level:"notice",msg:"Override LoadableComponent _load method!"}),Promise.reject()}async load(e,t="medium"){await this._status.main[t].setState("loading");let r=null;try{var i=await this._load(e,t);return await this._setContent("main",t,i),this}catch(e){r=e.message?"Load errored: "+e.message:"Unknown loading error.",this.report({msg:r,level:"error"}),console.error(`Error loading ${t} quality `+this.label,e),this._setError("main",t,new Error(r))}}}class InfoComponent extends Component{constructor(e,t){super(e,t)}autoUpdateStatus(){for(var e of Component.parts)for(var t of Component.qualities)this._status[e][t].setState("ready")}async _build(e,t,r){return this._setContent(e,t,this),this}toJSON(){var e=super.toJSON();return{[this.exportName]:e[this.exportName][0]}}}InfoComponent._exportName={singular:"info",plural:"info"};class ComponentLoader extends InformationSource{constructor(e,t={}){var r;super(e,t),this._defaultLoadingQuality="medium",this._loadingBases=void 0,this._concurrentLoadsPerBase=2,this._buildQueue=[],this._loadableQueue=[],this._currentLoads=[],this._qualitiesLowToHigh=Component.sortQualityArray(Component.qualities).reverse(),checkPropTypes(t,{},{bases:e=>Array.isArray(e)&&e.every(e=>e instanceof LoadingBase),concurrentLoadsPerBase:"number",defaultLoadingQuality:e=>Component.qualities.includes(e)}),t.bases?this.loadingBases=t.bases:(r=location.origin,this.report({msg:"No loading bases specified, auto generating from origin "+r}),this.loadingBases=[new LoadingBase(e,{for:["default"],url:new URL(r)})]),t.concurrentLoadsPerBase&&(this._concurrentLoadsPerBase=t.concurrentLoadsPerBase),t.defaultLoadingQuality&&(this._defaultLoadingQuality=t.defaultLoadingQuality)}set defaultLoadingQuality(e){this._defaultLoadingQuality=e}get loadingBases(){return this._loadingBases}set loadingBases(e){if(0<this._buildQueue.length)throw new Error("Can't change loading bases while loading resources");this._loadingBases=e,this._currentLoads=this.loadingBases.map(e=>({base:e,loads:{},maxConcurrentLoads:this._concurrentLoadsPerBase}))}_loadNext(){var e=this._loadableQueue.length;let i=0;if(this.report({msg:"Load next: "+(0<e?e+" in queue.":"Queue empty."),level:"info"}),0<e){for(let r of this._currentLoads){let t=!1;this._debug&&console.debug(r.base.label,"current loads:",Object.keys(r.loads).length);for(let e=0;e<this._loadableQueue.length;e+=1){var n=this._loadableQueue[e];if(n.loadingBase){if(!r.base.for.includes(n.loadingBase))continue}else if(!r.base.for.includes("default"))continue;if(Object.keys(r.loads).length<r.maxConcurrentLoads&&0<this._loadableQueue.length){i+=1;const a=n,o=(this._loadableQueue.splice(e,1),this.report({msg:`Free slot in base ${r.base.url.href}, start ${this._defaultLoadingQuality} quality loading `+a.label,level:"debug"}),v4());n=a.load(r.base,this._defaultLoadingQuality).finally(()=>(delete r.loads[o],this.report({msg:`Load process ${a.label} finished, calling loadNext`,level:"debug"}),this._loadNext()));r.loads[o]=n,t=!0;break}!0===t&&next}}0===i&&this.report({msg:"Could not assign loads to bases, all slots are taken.",level:"debug"})}}findLoadingBaseFor(t){var e=this._loadingBases.find(e=>e.for.includes(t));if(e)return e;throw new Error(`No loading base for "${t}" found.`)}async build(a,o="main",s="medium",e=!1){if(this.report({msg:`Build request for ${s} quality ${o} part `+a.label,level:"info"}),"ready"===a.status[o][s])return this.report({msg:"Component already ready, returning"}),Promise.resolve(a);const t=new Promise((i,n)=>{a.on("status-change",({status:e,quality:t,part:r})=>{if(t===s&&r===o){switch(!0===a._debug&&(console.warn(a.label,o,s,e),console.log(JSON.parse(JSON.stringify(a.dependencyStatus)))),e){case"loading":case"partially-loaded":return;case"ready":i(a);break;case"error":n(a.error[o][s]);break;default:throw new Error("Component Loader unable to handle new component status "+e)}a.hasListener("status-change",this.id)&&a.removeListener("status-change",this.id)}},this.id)}).finally(()=>{var e=this._buildQueue.filter(e=>e.component!==a||e.part!==o||e.quality!==s),t=this._buildQueue.length-e.length;0<t&&(this.report({msg:`Cleaned up ${t} old build requests`}),this._buildQueue=e)});var r={component:a,part:o,quality:s};if(void 0!==this._buildQueue.find(e=>e.component===a&&e.part===o&&e.quality===s))return t;!0!==e?this._buildQueue.push(r):this._buildQueue=[r,...this._buildQueue];e=[a,...a.allDependencies],r=e.filter(e=>e instanceof BuildableComponent&&e.dependencies&&0===Object.values(e.dependencies[o]).length),e=e.filter(e=>e instanceof BuildableComponent&&e.dependencies&&Object.values(e.dependencies[o]).every(e=>Array.isArray(e)?e.find(e=>"ready"===e.status[o][s]):"ready"===e.status[o][s])),r=[...r,...e].filter(unique).filter(e=>"not-loaded"===e.status[o][s]).map(e=>e.autoUpdateStatus());return this._rescheduleLoadingOrder(),Promise.all(r).then(()=>t)}_rescheduleLoadingOrder(){const r={};var e=this._loadableQueue.length,t=this._buildQueue.length;for(let t of Component.qualities){var i,n=[];for(i of this._buildQueue.filter(e=>e.quality===t))"UI"===i.part?i.component.dependencies.UI&&n.push(...Object.values(i.component.dependencies.UI)):"specs"===i.part?i.component.dependencies.specs&&n.push(...Object.values(i.component.dependencies.specs)):n.push(i.component);0<n.length&&(r[t]=ComponentLoader.optimalLoadingOrder(n,t))}this._loadableQueue=this._qualitiesLowToHigh.map(e=>r[e]?.relevantDependencies||[]).flat();var a=this._loadableQueue.length,o=this._buildQueue.length;this.report({msg:`Rescheduled loading order, ${e} => ${a}, ${t} - `+o}),this._loadNext()}static optimalLoadingOrder(e,r="medium"){e=ComponentLoader.getLoadableDependencies(e);const i=["not-loaded","partially-loaded"];return e.map(e=>{var e=[...e],t=e.filter(e=>i.includes(e.status.main[r]));return{dependencies:e,relevantDependencies:t,sizeBytes:t.reduce((e,t)=>i.includes(t.status.main[r])?e+t.source[r].sizeBytes:e,0)}}).sort((e,t)=>e.sizeBytes-t.sizeBytes)[0]}static getLoadableDependencies(t,r=[new Set],i=[]){if(t instanceof LoadableComponent)r.forEach(e=>e.add(t));else{let e=null;if(t instanceof BuildableComponent)t.dependencies||console.log(t),e=Object.values(t.dependencies.main);else if(Array.isArray(t)&&t.every(e=>e instanceof Component))e=t;else{if(!(t instanceof InfoComponent))throw new Error("Cannot get dependencies of "+typeof t);e=[]}for(var n of e)if(n instanceof Component)-1===i.indexOf(n)&&(i.push(t),r=this.getLoadableDependencies(n,r,i));else if(Array.isArray(n)){var a,o,s=[];for(a of n)-1===i.indexOf(a)&&(o=r.map(e=>new Set(e)),s.push(...this.getLoadableDependencies(a,o,i.slice())));0<s.length&&(r=s)}}return r}}ComponentLoader.socketTable={IE:8,Safari:4,Firefox:6,Opera:6,Chrome:4};const imageLoader=new ImageLoader;class WrappedImage extends LoadableComponent{constructor(e,t){super(e,t),checkPropTypes(t,{},{})}async _load(e,t){this._status,this._setContent.bind(this);const i=new URL(e.url.href+this.source[t].path);return this.report({msg:"Loading image from "+i}),new Promise((t,r)=>{imageLoader.load(i.href,function(e){t(e)},void 0,function(e){r("Could not load image from "+i+(e.message?", "+e.message:""))})})}}WrappedImage._exportName={singular:"image",plural:"images"};let defaultLoader=null;class BuildableComponent extends Component{constructor(e,t,r={}){super(e,t),this._placeHolderContent=null,this.defaultContent=this._placeHolderContent,this._dependencies=void 0,this._exportOnlyDependencies={},this._applicableMaterialVariantGroups=void 0,this._materializableDependencies=void 0,this._assignableDependencies=void 0,this._allDependencies=void 0,this._directDependencies=void 0,this._buildPromises={main:{medium:null},UI:{medium:null},specs:{medium:null}},checkPropTypes(t,{},{thumbnail:WrappedImage}),this._resetDependencies(),!1!==r.autoLinkDependencies&&this._autoLink(t,r),t.assignable}static autogenIntegralInstruction(e){return{parse:Object.entries(e).reduce((e,[t,r])=>Array.isArray(r)?Object.assign(e,{[t]:"integral"}):e,{})}}_autoLink(e,t){this.report({msg:"Auto-linking"}),this.removeDependencyListeners(),this._resetDependencies();for(var[r,i]of Object.entries(e)){!0===this._debug&&console.log(this.label,`Process settings "${r}" =`,i);var n=void 0!==BuildableComponent.partSettings[r]?BuildableComponent.partSettings[r]:"main";if(i instanceof Component)!0===this._debug&&console.log(this.label,"Simple setting, adding to _dependencies."+n),this._dependencies[n][r]=i;else if(Array.isArray(i)){if(!0===this._debug&&console.log(this.label,"Setting value is an array"),void 0===t.parse?.[r])throw new Error(`Unspecified array setting ${this.constructor.name}.`+r);var a,o=[];for(a of i)if("object"!=typeof a||Array.isArray(a)||a instanceof Component)a instanceof Component&&(!0===this._debug&&console.log(this.label,"Subvalue looks like Component. Adding",a,"to _dependencies"),o.push(a));else{!0===this._debug&&console.log(this.label,"Subvalue",a,"looks like an object");var s=Object.values(a).filter(e=>e instanceof Component);switch(!0===this._debug&&console.log(this.label,"Found",s,"components in subvalue"),s.length){case 0:break;case 1:!0===this._debug&&console.log(this.label,"Adding",s[0],"to ._dependencies"),o.push(s[0]);break;default:if("alternatives"===t.parse[r])throw new Error(`${this.label}.key setting holds ${s.length} Components, but 1 is the maximum`);!0===this._debug&&console.log(this.label,"Adding",s.length,"in-object-dependencies to ._dependencies"),o.push(...s)}}if("integral"===t.parse[r])for(let e=0;e<o.length;e+=1)this._dependencies[n][r+"-"+e]=o[e];else"alternatives"===t.parse[r]&&(this._dependencies[n][r]=o)}else if("object"==typeof i){let e=0;for(var[l,c]of Object.entries(i))e+=1,c instanceof Component&&(this._dependencies[n][r+"-"+e]=c)}}for(var d of Component.parts)for(var h of Object.values(this._dependencies[d]).flat())this._debug&&console.log(this.label,"subscribe status change",h.label),this.autoBuildOnStatusChange(h)}async _dependencyStatusChangeHandler(e){await this.autoUpdateStatus(),this._debug&&console.warn(this.status)}autoBuildOnStatusChange(e){e.on("status-change",this._dependencyStatusChangeHandler.bind(this),this.id)}removeDependencyListeners(){for(var e of Component.parts)for(var t of Object.values(this._dependencies[e]).flat())t.hasListener("status-change",this.id)&&t.removeListener("status-change",this.id)}addExportDependency(e,t){this.dependsDirectlyOn(t)||(this._exportOnlyDependencies[e]=t)}async autoUpdateStatus(){var r,e=this.dependencyStatus,t=(!0===this._debug&&console.log("_autoUpdateStatus",this.label,e),this.status);for(r of Component.parts)for(var i of Component.qualities){this._debug;var n=this._status[r][i].state;if(t[r][i]===n){var a=e[r][i].status;if("error"===n)!0===this._debug&&console.log(this.label,"Skip (comp in error state)");else if("ready"===a&&"ready"!==n&&null===this._content[r][i]){!0===this._debug&&console.log(this.label,`Auto building: ${n}->`+a);let t=null;try{await this._build(r,i,e[r][i].dependencies)}catch(e){t=e}var o=this._status[r][i].state;if("ready"!==o||null!==t){var s=`${this.label} status should've been "ready" after auto-build but is "${this._status[r][i].state}" ${t?t.message:""}. `+("error"!==o?"Going to error state.":"");if(this.report({msg:s,level:"error"}),"error"!==o)throw this._setError(r,i,t||new Error(s)),!0===this._debug&&console.log("Component set to error state",r,i),t}}else if(a!==n){let t=null;!0===this._debug&&console.log(`Auto updating ${r} ${i}: ${n}->`+a),"error"===a&&(this._error[r][i]=new Error("Error in dependency chain"));try{await this._status[r][i].setState(a)}catch(e){-1===e.message.toLowerCase().indexOf("transition")?t=e:this.report({msg:`Status update ${n}->${a} failed, probably because the state changed intermediately to "${this._status[r][i].state}"`,level:"debug"})}o=this._status[r][i].state;null!==t&&(s=`Status change ${n}->${a} failed. Current status: "${this._status[r][i].state}".`,this.report({msg:s,level:"error"}),"error"!==o)&&(this._setError(r,i,t||new Error(s)),!0===this._debug)&&console.log(this.label+" set to error state",r,i)}}}}_resetDependencies(){this._dependencies={main:{},UI:{},specs:{}}}get dependencies(){return this._dependencies}get dependencyStatus(){var e,r,i={};for(e of Component.parts){i[e]={};for(var t of Component.qualities)i[e][t]={}}for(r of Component.parts){var n=Object.entries(this._dependencies[r]);if(!0===this._debug&&console.log(r,"dep entries",n,this._dependencies),0===n.length){i[r]={};for(var a of Component.qualities)i[r][a]={status:"ready",dependencies:{}}}else{!0===this._debug&&console.log("deps!",n);for(let t of Component.qualities){!0===this._debug&&console.debug("dep quality",r,t);var o,s,l,c,d={},h={};for([o,s]of n)Array.isArray(s)?(l=s.map(e=>e.status.main[t]),c=Component.sortStatusArray(l)[0],h[o]=s[l.indexOf(c)],d[c]=(d[c]||0)+1):(!0===this._debug&&console.debug(s.label,s.status),d[s.status.main[t]]=(d[s.status.main[t]]||0)+1,h[o]=s);!0===this._debug&&console.debug(this.label,d,h);var u=Object.keys(d);1===u.length?(i[r][t].status=u[0],"ready"===u[0]&&(i[r][t].dependencies=h)):u.find(e=>"error"===e)?i[r][t].status="error":u.find(e=>"loading"===e)?i[r][t].status="loading":u.find(e=>"ready"===e)||u.find(e=>"partially-loaded"===e)?i[r][t].status="partially-loaded":i[r][t].status="not-loaded"}}}return i}get applicableMaterialVariantGroups(){if(!this._applicableMaterialVariantGroups){var e,t=[];for(e of this.allDependencies)e.materialVariantGroup&&-1===t.indexOf(e.materialVariantGroup)&&t.push(e.materialVariantGroup);this._applicableMaterialVariantGroups=t}return this._applicableMaterialVariantGroups}get materializableDependencies(){return this._materializableDependencies||(this._materializableDependencies=this.allDependencies.filter(e=>!0===e.materializable)),this._materializableDependencies}get assignableDependencies(){return this._assignableDependencies||(this._assignableDependencies=this.allDependencies.filter(e=>!0===e.assignable)),this._assignableDependencies}get allDependencies(){if(!this._allDependencies){var e=this.directDependencies.reduce((e,t)=>t.allDependencies?e.concat(t,...t.allDependencies):e.concat(t),[]).filter(unique);if(Object.isFrozen(this))return e;this._allDependencies=e}return this._allDependencies}get directDependencies(){if(!this._directDependencies){var e=Component.parts.map(e=>Object.values(this._dependencies[e])).flat().flat().filter(unique);if(Object.isFrozen(this))return e;this._directDependencies=e}return this._directDependencies}dependsDirectlyOn(e){return this.directDependencies.includes(e)}dependsOn(e){return this.allDependencies.includes(e)}highestMainQuality(){var e=this.dependencyStatus;return"ready"!==e.high.status?{quality:"high",dependencies:e.dependencies}:null!==e.medium.status?{quality:"medium",dependencies:e.dependencies}:null!==e.low.status?{quality:"low",dependencies:e.dependencies}:null}async _build(e,t,r){return this.report({level:"notice",msg:"Override BuildableComponent._build interface method!"}),this._setContent(e,t,"-"),this}_rebuild(e="main"){for(var t of Component.qualities)"ready"===this.status[e][t]&&this._build("main",t)}async build({componentLoader:t,part:r="main",quality:i="medium",highPriority:n=!1}={}){if(!this._buildPromises[r][i]){let e=t;if(e){if(!(e instanceof ComponentLoader))throw new Error("Loader does not instance class ComponentLoader");this.report({msg:"Using specified loader"})}else e=this._tree&&this._tree.loader?(this.report({msg:"Using component loader from component tree"}),this._tree.loader):(this.report({msg:"No loader specified, using default loader"}),defaultLoader||(this.report({msg:"Creating default loader"}),console.log("Creating default loader"),defaultLoader=new ComponentLoader(this._reporter,{name:"Default loader"})),defaultLoader);this._buildPromises[r][i]=e.build(this,r,i,n)}return this._buildPromises[r][i]}destroy(){this.removeDependencyListeners(),super.destroy&&super.destroy()}}BuildableComponent.partSettings={thumbnail:"UI",dimensionsImage:"specs","*":"main"};class ConnectorType extends BuildableComponent{constructor(e,t){super(e,t,{autoLinkDependencies:!1}),checkPropTypes(t,{name:"string"},{}),t.thumbnail&&(this._dependencies.UI={thumbnail:t.thumbnail})}get connectors(){return this._tree?this._tree.connectorsByType[this]:[]}_onTreeSet(){const t=this;this._tree.on("change",({cls:e=[]})=>{e.includes(Connector)&&(t.report({msg:"Connector changed in package. Rebuilding."}),this._rebuild())},this.id),this._rebuild()}_onTreeUnset(){this._tree.hasListener("change",this.id)&&this._tree.removeListener("change",this.id)}async _build(e,t){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":var r=this._tree?.connectors?this._tree.connectors.filter(e=>e.settings.type===this):[];this._setContent("main",t,r);break;default:this._setContent(e,t,null)}return this}}ConnectorType._exportName={singular:"connectorType",plural:"connectorTypes"};class Theme extends BuildableComponent{constructor(e,t){super(e,t),checkPropTypes(t,{name:"string",group:ThemeGroup},{})}async _build(e,t){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":for(var r of Component.qualities)this._setContent("main",r,{id:this._settings.id,name:this._settings.name,group:this._settings.group.id});break;default:this._setContent(e,t,null)}return this}}Theme._exportName={singular:"theme",plural:"themes"};class ThemeGroup extends BuildableComponent{constructor(e,t){super(e,t,{autoLinkDependencies:!1}),checkPropTypes(t,{name:"string"},{}),t.thumbnail&&(this._dependencies.UI={thumbnail:t.thumbnail})}_onTreeSet(){const t=this;this._tree.on("change",({cls:e=[]})=>{e.includes(Theme)&&(t.report({msg:"Theme(s) changed in package. Rebuilding."}),t._build("main"))},this.id),this._build("main")}_onTreeUnset(){this._tree.hasListener("change",this.id)&&this._tree.removeListener("change",this.id)}async _build(e,t){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":var r,i=this._tree?this._tree.themes.filter(e=>e.settings.group===this):[];for(r of Component.qualities)this._setContent("main",r,i);this.report({msg:`Built theme group of ${i.length} themes.`});break;default:this._setContent(e,t,null)}return this}}ThemeGroup._exportName={singular:"themeGroup",plural:"themeGroups"};class Connector extends BuildableComponent{constructor(e,t){void 0===t.position&&(t.position=new Vector3),void 0===t.quaternion&&(t.quaternion=new Quaternion),super(e,t),this._block=void 0,this.mate=void 0,this.mate={},checkPropTypes(t,{type:ConnectorType,position:Vector3,quaternion:Quaternion},{themeGroup:ThemeGroup})}get mateMap(){return this._tree?this._tree.mateMap[this.settings.type]:{}}get block(){return this._block}set block(e){if(this._block)throw new Error("Reference block setter called for a subsequent time.");console.assert(e instanceof Block),this._block=e}_updatePotentialMateList(){this._tree?this._tree.connectorTypeMateMap?this.mate=this._tree.connectorTypeMateMap.get(this.settings.type):console.warn("Can not update mate list, no connectorTypeMateMap in "+this._tree.label):console.warn("Can not update mate list, no tree")}_onTreeSet(){const e=this;this._updatePotentialMateList(),this._tree.on("mate-map-update",()=>{e._updatePotentialMateList.bind(e)()},this.id)}_onTreeUnset(){this.mate={},this._tree.removeListener("mate-map-update",this.id)}async _build(e,t,r){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":var i={id:this._settings.id,name:this._settings.name,themeGroup:this._settings.themeGroup,type:this._settings.type,position:this._settings.position,quaternion:this._settings.quaternion};this._setContent("main",t,i);break;default:this._setContent(e,t,null)}return this}}Connector._exportName={singular:"connector",plural:"connectors"},Connector._exportLevel="inline";const wrapTypes=[RepeatWrapping,ClampToEdgeWrapping,MirroredRepeatWrapping],checkWrapType=e=>!!wrapTypes.includes(e)||"Unknown wrapping "+e;class WrappedTexture extends BuildableComponent{constructor(e,t){checkPropTypes(t,{image:WrappedImage},{id:UUIDRegex,name:"string",wrapS:checkWrapType,wrapT:checkWrapType,repeat:Vector2,anisotropy:"number"}),super(e,t)}async _build(e,t,r){switch(this.report({msg:`Building ${t} `+e}),e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":var i=new Texture,n=Object.keys(i).filter(e=>"image"!==e),n=(copyProps({from:this._settings,into:i,required:[],optional:n}),Project.maxAnisotropy);i.anisotropy=n,i.image=r.image.content.main[t],i.flipY=!1,i.colorSpace=SRGBColorSpace,i.needsUpdate=!0,this._setContent("main",t,i);break;default:this._setContent(e,t,null)}return this}}WrappedTexture._exportName={singular:"texture",plural:"textures"};const NodeShaderStage={VERTEX:"vertex",FRAGMENT:"fragment"},NodeUpdateType={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},NodeType={BOOLEAN:"bool",INTEGER:"int",FLOAT:"float",VECTOR2:"vec2",VECTOR3:"vec3",VECTOR4:"vec4",MATRIX3:"mat3",MATRIX4:"mat4"},defaultShaderStages=["fragment","vertex"],defaultBuildStages=["construct","analyze","generate"],shaderStages=[...defaultShaderStages,"compute"],vectorComponents=["x","y","z","w"];function getCacheKey(e){let t="{";!0===e.isNode&&(t+=`uuid:"${e.uuid}"`);for(var{property:r,index:i,childNode:n}of getNodeChildren(e)){let e=getCacheKey(n);e.includes(",")||(e=e.slice(e.indexOf('"'),e.indexOf("}"))),t+=`,${r}${void 0!==i?"/"+i:""}:`+e}return t+="}"}function*getNodeChildren(e,t=!1){for(const a in e)if(!0!==a.startsWith("_")){var r=e[a];if(!0===Array.isArray(r))for(let e=0;e<r.length;e++){var i=r[e];i&&(!0===i.isNode||t&&"function"==typeof i.toJSON)&&(yield{property:a,index:e,childNode:i})}else if(r&&!0===r.isNode)yield{property:a,childNode:r};else if("object"==typeof r)for(const o in r){var n=r[o];n&&(!0===n.isNode||t&&"function"==typeof n.toJSON)&&(yield{property:a,index:o,childNode:n})}}}function getValueType(e){var t;return null==e?null:(t=typeof e,!0===e.isNode?"node":"number"==t?"float":"boolean"==t?"bool":"string"==t?"string":"function"==t?"shader":!0===e.isVector2?"vec2":!0===e.isVector3?"vec3":!0===e.isVector4?"vec4":!0===e.isMatrix3?"mat3":!0===e.isMatrix4?"mat4":!0===e.isColor?"color":e instanceof ArrayBuffer?"ArrayBuffer":null)}function getValueFromType(e,...t){var r=e?e.slice(-4):void 0;return"vec2"!==r&&"vec3"!==r&&"vec4"!==r||1!==t.length||(t="vec2"===r?[t[0],t[0]]:[t[0],t[0],t[0]]),"color"===e?new Color$1(...t):"vec2"===r?new Vector2$1(...t):"vec3"===r?new Vector3$1(...t):"vec4"===r?new Vector4$1(...t):"mat3"===r?new Matrix3$1(...t):"mat4"===r?new Matrix4$1(...t):"bool"===e?t[0]||!1:"float"===e||"int"===e||"uint"===e?t[0]||0:"string"===e?t[0]||"":"ArrayBuffer"===e?base64ToArrayBuffer(t[0]):null}function arrayBufferToBase64(e){let t="";var r=new Uint8Array(e);for(let e=0;e<r.length;e++)t+=String.fromCharCode(r[e]);return btoa(t)}function base64ToArrayBuffer(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0)).buffer}var NodeUtils=Object.freeze({__proto__:null,getCacheKey:getCacheKey,getNodeChildren:getNodeChildren,getValueType:getValueType,getValueFromType:getValueFromType,arrayBufferToBase64:arrayBufferToBase64,base64ToArrayBuffer:base64ToArrayBuffer});const NodeClasses=new Map;let _nodeId=0;class Node$2 extends EventDispatcher$2{constructor(e=null){super(),this.nodeType=e,this.updateType=NodeUpdateType.NONE,this.updateBeforeType=NodeUpdateType.NONE,this.uuid=MathUtils$1.generateUUID(),this.isNode=!0,Object.defineProperty(this,"id",{value:_nodeId++})}get type(){return this.constructor.name}isGlobal(){return!1}*getChildren(){const t=this;for(const{property:r,index:i,childNode:e}of getNodeChildren(this))yield{childNode:e,replaceNode(e){void 0===i?t[r]=e:t[r][i]=e}}}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e,t=null){e(this,t);for(const{childNode:r,replaceNode:t}of this.getChildren())r.traverse(e,t)}getCacheKey(){return getCacheKey(this)}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getNodeType(){return this.nodeType}getReference(e){var t=this.getHash(e);return e.getNodeFromHash(t)||this}construct(e){var t,r=e.getNodeProperties(this);for({childNode:t}of this.getChildren())r["_node"+t.id]=t;return null}analyze(e){var t=e.getDataFromNode(this);if(t.dependenciesCount=void 0===t.dependenciesCount?1:t.dependenciesCount+1,1===t.dependenciesCount){t=e.getNodeProperties(this);for(const r of Object.values(t))r&&!0===r.isNode&&r.build(e)}}generate(e,t){var r=e.getNodeProperties(this)["outputNode"];if(r&&!0===r.isNode)return r.build(e,t)}updateBefore(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,t=null){var r=this.getReference(e);if(this!==r)return r.build(e,t);e.addNode(this),e.addChain(this);let i=null;var r=e.getBuildStage();if("construct"===r){var n=e.getNodeProperties(this);if(!0!==n.initialized||!1===e.context.tempRead){var a=e.stack.nodes.length;n.initialized=!0,n.outputNode=this.construct(e),null!==n.outputNode&&e.stack.nodes.length!==a&&(n.outputNode=e.stack);for(const o of Object.values(n))o&&!0===o.isNode&&o.build(e)}}else"analyze"===r?this.analyze(e):"generate"===r&&(a=1===this.generate.length,i=a?(n=this.getNodeType(e),r=e.getDataFromNode(this),void 0===(i=r.snippet)&&(i=this.generate(e)||"",r.snippet=i),e.format(i,n,t)):this.generate(e,t)||"");return e.removeChain(this),i}getSerializeChildren(){return getNodeChildren(this)}serialize(e){var t,r,i,n={};for({property:t,index:r,childNode:i}of this.getSerializeChildren())void 0!==r?(void 0===n[t]&&(n[t]=Number.isInteger(r)?[]:{}),n[t][r]=i.toJSON(e.meta).uuid):n[t]=i.toJSON(e.meta).uuid;0<Object.keys(n).length&&(e.inputNodes=n)}deserialize(e){if(void 0!==e.inputNodes){var t=e.meta.nodes;for(const o in e.inputNodes)if(Array.isArray(e.inputNodes[o])){var r=[];for(const s of e.inputNodes[o])r.push(t[s]);this[o]=r}else if("object"==typeof e.inputNodes[o]){var i={};for(const l in e.inputNodes[o]){var n=e.inputNodes[o][l];i[l]=t[n]}this[o]=i}else{var a=e.inputNodes[o];this[o]=t[a]}}}toJSON(e){var{uuid:t,type:r}=this,i=void 0===e||"string"==typeof e;let n=(e=i?{textures:{},images:{},nodes:{}}:e).nodes[t];function a(e){var t=[];for(const i in e){var r=e[i];delete r.metadata,t.push(r)}return t}return void 0===n&&(n={uuid:t,type:r,meta:e,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},!0!=i&&(e.nodes[n.uuid]=n),this.serialize(n),delete n.meta),i&&(t=a(e.textures),r=a(e.images),i=a(e.nodes),0<t.length&&(n.textures=t),0<r.length&&(n.images=r),0<i.length)&&(n.nodes=i),n}}function addNodeClass(e){if("function"!=typeof e||!e.name)throw new Error(`Node class ${e.name} is not a class`);if(NodeClasses.has(e.name))throw new Error("Redefinition of node class "+e.name);NodeClasses.set(e.name,e)}function createNodeFromType(e){e=NodeClasses.get(e);if(void 0!==e)return new e}class InputNode extends Node$2{constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return null===this.nodeType?getValueType(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=getValueType(this.value),e.nodeType=this.nodeType,"ArrayBuffer"===e.valueType&&(e.value=arrayBufferToBase64(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?getValueFromType(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}addNodeClass(InputNode);class ArrayElementNode extends Node$2{constructor(e,t){super(),this.node=e,this.indexNode=t}getNodeType(e){return this.node.getNodeType(e)}generate(e){return this.node.build(e)+`[ ${this.indexNode.build(e,"uint")} ]`}}addNodeClass(ArrayElementNode);class ConvertNode extends Node$2{constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){var t=this.node.getNodeType(e);let r=null;for(const i of this.convertTo.split("|"))null!==r&&e.getTypeLength(t)!==e.getTypeLength(i)||(r=i);return r}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){var r=this.node,i=this.getNodeType(e),r=r.build(e,i);return e.format(r,i,t)}}addNodeClass(ConvertNode);class TempNode extends Node$2{constructor(e){super(e),this.isTempNode=!0}hasDependencies(e){return 1<e.getDataFromNode(this).dependenciesCount}build(e,t){if("generate"===e.getBuildStage()){var r,i,n=e.getVectorType(this.getNodeType(e,t)),a=e.getDataFromNode(this);if(!1!==e.context.tempRead&&void 0!==a.propertyName)return e.format(a.propertyName,n,t);if(!1!==e.context.tempWrite&&"void"!==n&&"void"!==t&&this.hasDependencies(e))return r=super.build(e,n),i=e.getVarFromNode(this,n),i=e.getPropertyName(i),e.addLineFlowCode(i+" = "+r),a.snippet=r,a.propertyName=i,e.format(a.propertyName,n,t)}return super.build(e,t)}}addNodeClass(TempNode);class JoinNode extends TempNode{constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(r){return null!==this.nodeType?r.getVectorType(this.nodeType):r.getTypeFromLength(this.nodes.reduce((e,t)=>e+r.getTypeLength(t.getNodeType(r)),0))}generate(e,t){var r=this.getNodeType(e),i=[];for(const o of this.nodes){var n=o.build(e);i.push(n)}var a=`${e.getType(r)}( ${i.join(", ")} )`;return e.format(a,r,t)}}addNodeClass(JoinNode);const stringVectorComponents=vectorComponents.join("");class SplitNode extends Node$2{constructor(e,t="x"){super(),this.node=e,this.components=t}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(vectorComponents.indexOf(t)+1,e);return e}getNodeType(e){return e.getTypeFromLength(this.components.length)}generate(t,r){var i=this.node,n=t.getTypeLength(i.getNodeType(t));let a=null;if(1<n){let e=null;n<=this.getVectorLength()&&(e=t.getTypeFromLength(this.getVectorLength()));var o=i.build(t,e);a=this.components.length===n&&this.components===stringVectorComponents.slice(0,this.components.length)?t.format(o,e,r):t.format(o+"."+this.components,this.getNodeType(t),r)}else a=i.build(t,r);return a}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}addNodeClass(SplitNode);class ConstNode extends InputNode{constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.getConst(this.getNodeType(e),this.value)}generate(e,t){var r=this.getNodeType(e);return e.format(this.generateConst(e),r,t)}}addNodeClass(ConstNode);const NodeElements=new Map;function addNodeElement(e,t){if(NodeElements.has(e))throw new Error("Redefinition of node element "+e);if("function"!=typeof t)throw new Error(`Node element ${e} is not a function`);NodeElements.set(e,t)}const shaderNodeHandler={construct(e,t){var r=t.shift();return e(nodeObjects(r),...t)},get:function(e,t,r){if("string"==typeof t&&void 0===e[t]){if(NodeElements.has(t)){const i=NodeElements.get(t);return(...e)=>i(r,...e)}if(t.endsWith("Assign")&&NodeElements.has(t.slice(0,t.length-"Assign".length))){const n=NodeElements.get(t.slice(0,t.length-"Assign".length));return(...e)=>r.assign(n(r,...e))}if(!0===/^[xyzwrgbastpq]{1,4}$/.test(t))return t=t.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),nodeObject(new SplitNode(e,t));if("width"===t||"height"===t)return nodeObject(new SplitNode(e,"width"===t?"x":"y"));if(!0===/^\d+$/.test(t))return nodeObject(new ArrayElementNode(e,new ConstNode(Number(t),"uint")))}return e[t]}},nodeObjectsCacheMap=new WeakMap,ShaderNodeObject=function(t,e=null){var r=getValueType(t);if("node"!==r)return null===e&&("float"===r||"boolean"===r)||r&&"shader"!==r&&"string"!==r?nodeObject(getConstNode(t,e)):"shader"===r?tslFn(t):t;{let e=nodeObjectsCacheMap.get(t);return void 0===e&&(e=new Proxy(t,shaderNodeHandler),nodeObjectsCacheMap.set(t,e),nodeObjectsCacheMap.set(e,e)),e}},ShaderNodeObjects=function(e,t=null){for(const r in e)e[r]=nodeObject(e[r],t);return e},ShaderNodeArray=function(t,r=null){var i=t.length;for(let e=0;e<i;e++)t[e]=nodeObject(t[e],r);return t},ShaderNodeProxy=function(t,r=null,i=null,n=null){const a=e=>nodeObject(null!==n?Object.assign(e,n):e);return null===r?(...e)=>a(new t(...nodeArray(e))):null!==i?(i=nodeObject(i),(...e)=>a(new t(r,...nodeArray(e),i))):(...e)=>a(new t(r,...nodeArray(e)))},ShaderNodeImmutable=function(e,...t){return nodeObject(new e(...nodeArray(t)))};class ShaderNodeInternal extends Node$2{constructor(e){super(),this._jsFunc=e}call(e,t,r){return e=nodeObjects(e),nodeObject(this._jsFunc(e,t,r))}getNodeType(e){var t=e.getNodeProperties(this)["outputNode"];return t?t.getNodeType(e):super.getNodeType(e)}construct(e){return e.addStack(),e.stack.outputNode=nodeObject(this._jsFunc(e.stack,e)),e.removeStack()}}const bools=[!1,!0],uints=[0,1,2,3],ints=[-1,-2],floats=[.5,1.5,1/3,1e-6,1e6,Math.PI,2*Math.PI,1/Math.PI,2/Math.PI,1/(2*Math.PI),Math.PI/2],boolsCacheMap=new Map;for(const bool of bools)boolsCacheMap.set(bool,new ConstNode(bool));const uintsCacheMap=new Map;for(const uint of uints)uintsCacheMap.set(uint,new ConstNode(uint,"uint"));const intsCacheMap=new Map([...uintsCacheMap].map(e=>new ConstNode(e.value,"int")));for(const int of ints)intsCacheMap.set(int,new ConstNode(int,"int"));const floatsCacheMap=new Map([...intsCacheMap].map(e=>new ConstNode(e.value)));for(const float of floats)floatsCacheMap.set(float,new ConstNode(float));for(const float of floats)floatsCacheMap.set(-float,new ConstNode(-float));const cacheMaps={bool:boolsCacheMap,uint:uintsCacheMap,ints:intsCacheMap,float:floatsCacheMap},constNodesCacheMap=new Map([...boolsCacheMap,...floatsCacheMap]),getConstNode=(e,t)=>constNodesCacheMap.has(e)?constNodesCacheMap.get(e):!0===e.isNode?e:new ConstNode(e,t),safeGetNodeType=e=>{try{return e.getNodeType()}catch(e){}},ConvertType=function(r,i=null){return(...e)=>{var t;return 1===(e=0===e.length||!["bool","float","int","uint"].includes(r)&&e.every(e=>"object"!=typeof e)?[getValueFromType(r,...e)]:e).length&&null!==i&&i.has(e[0])?nodeObject(i.get(e[0])):1===e.length?(t=getConstNode(e[0],r),safeGetNodeType(t)===r?nodeObject(t):nodeObject(new ConvertNode(t,r))):(t=e.map(e=>getConstNode(e)),nodeObject(new JoinNode(t,r)))}},getConstNodeType=e=>null!=e?e.nodeType||e.convertTo||("string"==typeof e?e:null):null;function ShaderNode(e){return new Proxy(new ShaderNodeInternal(e),shaderNodeHandler)}const nodeObject=(e,t=null)=>ShaderNodeObject(e,t),nodeObjects=(e,t=null)=>new ShaderNodeObjects(e,t),nodeArray=(e,t=null)=>new ShaderNodeArray(e,t),nodeProxy=(...e)=>new ShaderNodeProxy(...e),nodeImmutable=(...e)=>new ShaderNodeImmutable(...e),shader=e=>(console.warn("TSL: shader() is deprecated. Use tslFn() instead."),new ShaderNode(e)),tslFn=t=>{let r=null;return(...e)=>(r=null===r?new ShaderNode(t):r).call(...e)},color=(addNodeClass(ShaderNode),new ConvertType("color")),float=new ConvertType("float",cacheMaps.float),int=new ConvertType("int",cacheMaps.int),uint=new ConvertType("uint",cacheMaps.uint),bool=new ConvertType("bool",cacheMaps.bool),vec2=new ConvertType("vec2"),ivec2=new ConvertType("ivec2"),uvec2=new ConvertType("uvec2"),bvec2=new ConvertType("bvec2"),vec3=new ConvertType("vec3"),ivec3=new ConvertType("ivec3"),uvec3=new ConvertType("uvec3"),bvec3=new ConvertType("bvec3"),vec4=new ConvertType("vec4"),ivec4=new ConvertType("ivec4"),uvec4=new ConvertType("uvec4"),bvec4=new ConvertType("bvec4"),mat3=new ConvertType("mat3"),imat3=new ConvertType("imat3"),umat3=new ConvertType("umat3"),bmat3=new ConvertType("bmat3"),mat4=new ConvertType("mat4"),imat4=new ConvertType("imat4"),umat4=new ConvertType("umat4"),bmat4=new ConvertType("bmat4"),string=(e="")=>nodeObject(new ConstNode(e,"string")),arrayBuffer=e=>nodeObject(new ConstNode(e,"ArrayBuffer")),element=(addNodeElement("color",color),addNodeElement("float",float),addNodeElement("int",int),addNodeElement("uint",uint),addNodeElement("bool",bool),addNodeElement("vec2",vec2),addNodeElement("ivec2",ivec2),addNodeElement("uvec2",uvec2),addNodeElement("bvec2",bvec2),addNodeElement("vec3",vec3),addNodeElement("ivec3",ivec3),addNodeElement("uvec3",uvec3),addNodeElement("bvec3",bvec3),addNodeElement("vec4",vec4),addNodeElement("ivec4",ivec4),addNodeElement("uvec4",uvec4),addNodeElement("bvec4",bvec4),addNodeElement("mat3",mat3),addNodeElement("imat3",imat3),addNodeElement("umat3",umat3),addNodeElement("bmat3",bmat3),addNodeElement("mat4",mat4),addNodeElement("imat4",imat4),addNodeElement("umat4",umat4),addNodeElement("bmat4",bmat4),addNodeElement("string",string),addNodeElement("arrayBuffer",arrayBuffer),nodeProxy(ArrayElementNode)),convert=(e,t)=>nodeObject(new ConvertNode(nodeObject(e),t)),split=(e,t)=>nodeObject(new SplitNode(nodeObject(e),t));addNodeElement("element",element),addNodeElement("convert",convert);class UniformNode extends InputNode{constructor(e,t=null){super(e,t),this.isUniformNode=!0}getUniformHash(e){return this.getHash(e)}generate(e,t){var r=this.getNodeType(e),i=this.getUniformHash(e);let n=e.getNodeFromHash(i);void 0===n&&(e.setHashNode(this,i),n=this);i=n.getInputType(e),i=e.getUniformFromNode(n,i,e.shaderStage,e.context.label),i=e.getPropertyName(i);return e.format(i,r,t)}}const uniform=(e,t)=>{t=getConstNodeType(t||e),e=e&&!0===e.isNode?e.node&&e.node.value||e.value:e;return nodeObject(new UniformNode(e,t))};addNodeClass(UniformNode);class ArrayUniformNode extends UniformNode{constructor(e=[]){super(),this.isArrayUniformNode=!0,this.nodes=e}getNodeType(e){return this.nodes[0].getNodeType(e)}}addNodeClass(ArrayUniformNode);class VaryingNode extends Node$2{constructor(e,t=null){super(),this.node=e,this.name=t}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){var{name:t,node:r}=this,i=this.getNodeType(e),n=e.getVaryingFromNode(this,i),t=(n.needsInterpolation||(n.needsInterpolation="fragment"===e.shaderStage),null!==t&&(n.name=t),e.getPropertyName(n,NodeShaderStage.VERTEX));return e.flowNodeFromShaderStage(NodeShaderStage.VERTEX,r,i,t),e.getPropertyName(n)}}const varying=nodeProxy(VaryingNode);addNodeElement("varying",varying),addNodeClass(VaryingNode);class AttributeNode extends Node$2{constructor(e,t=null){super(t),this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){var t=this.getAttributeName(e);let r=super.getNodeType(e);return r=null===r?e.hasGeometryAttribute(t)?(t=e.geometry.getAttribute(t),e.getTypeFromAttribute(t)):"float":r}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){var t,r,i=this.getAttributeName(e),n=this.getNodeType(e);return!0===e.hasGeometryAttribute(i)?(t=e.geometry.getAttribute(i),t=e.getTypeFromAttribute(t),r=e.getAttribute(i,t),"vertex"===e.shaderStage?e.format(r.name,t,n):varying(this).build(e,n)):(console.warn(`AttributeNode: Attribute "${i}" not found.`),e.getConst(n))}}const attribute=(e,t)=>nodeObject(new AttributeNode(e,t));addNodeClass(AttributeNode);class BypassNode extends Node$2{constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){var t=this.callNode.build(e,"void");return""!==t&&e.addLineFlowCode(t),this.outputNode.build(e)}}const bypass=nodeProxy(BypassNode);addNodeElement("bypass",bypass),addNodeClass(BypassNode);let id$1=0;class NodeCache{constructor(){this.id=id$1++,this.nodesData=new WeakMap}getNodeData(e){return this.nodesData.get(e)}setNodeData(e,t){this.nodesData.set(e,t)}}class CacheNode extends Node$2{constructor(e,t=new NodeCache){super(),this.isCacheNode=!0,this.node=e,this.cache=t}getNodeType(e){return this.node.getNodeType(e)}build(e,...t){var r=e.getCache(),t=(e.setCache(this.cache),this.node.build(e,...t));return e.setCache(r),t}}const cache=nodeProxy(CacheNode);addNodeElement("cache",cache),addNodeClass(CacheNode);class ContextNode extends Node$2{constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.context=t}getNodeType(e){return this.node.getNodeType(e)}construct(e){var t=e.getContext(),r=(e.setContext({...e.context,...this.context}),this.node.build(e));return e.setContext(t),r}generate(e,t){var r=e.getContext(),t=(e.setContext({...e.context,...this.context}),this.node.build(e,t));return e.setContext(r),t}}const context=nodeProxy(ContextNode),label=(e,t)=>context(e,{label:t});addNodeElement("context",context),addNodeElement("label",label),addNodeClass(ContextNode);class IndexNode extends Node$2{constructor(e){super("uint"),this.scope=e,this.isInstanceIndexNode=!0}generate(e){var t=this.getNodeType(e),r=this.scope;let i;if(r===IndexNode.VERTEX)i=e.getVertexIndex();else{if(r!==IndexNode.INSTANCE)throw new Error("THREE.IndexNode: Unknown scope: "+r);i=e.getInstanceIndex()}let n;return n="vertex"===e.shaderStage||"compute"===e.shaderStage?i:varying(this).build(e,t)}}IndexNode.VERTEX="vertex",IndexNode.INSTANCE="instance";const vertexIndex=nodeImmutable(IndexNode,IndexNode.VERTEX),instanceIndex=nodeImmutable(IndexNode,IndexNode.INSTANCE);addNodeClass(IndexNode);class LightingModel{init(){}direct(){}indirectDiffuse(){}indirectSpecular(){}ambientOcclusion(){}}class NodeAttribute{constructor(e,t,r=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=r}}class NodeUniform{constructor(e,t,r,i=void 0){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=r,this.needsUpdate=i}get value(){return this.node.value}set value(e){this.node.value=e}}class NodeVar{constructor(e,t){this.isNodeVar=!0,this.name=e,this.type=t}}class NodeVarying extends NodeVar{constructor(e,t){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0}}class NodeCode{constructor(e,t,r=""){this.name=e,this.type=t,this.code=r,Object.defineProperty(this,"isNodeCode",{value:!0})}}class NodeKeywords{constructor(){this.keywords=[],this.nodes=[],this.keywordsCallback={}}getNode(e){let t=this.nodes[e];return void 0===t&&void 0!==this.keywordsCallback[e]&&(t=this.keywordsCallback[e](e),this.nodes[e]=t),t}addKeyword(e,t){return this.keywords.push(e),this.keywordsCallback[e]=t,this}parse(e){var t=this.keywords,t=new RegExp(`\\b${t.join("\\b|\\b")}\\b`,"g"),e=e.match(t),r=[];if(null!==e)for(const n of e){var i=this.getNode(n);void 0!==i&&-1===r.indexOf(i)&&r.push(i)}return r}include(e,t){for(const r of this.parse(t))r.build(e)}}class PropertyNode extends Node$2{constructor(e,t=null){super(e),this.name=t}getHash(e){return this.name||super.getHash(e)}isGlobal(){return!0}generate(e){var t=e.getVarFromNode(this,this.getNodeType(e)),r=this.name;return null!==r&&(t.name=r),e.getPropertyName(t)}}const property=(e,t)=>nodeObject(new PropertyNode(e,t)),diffuseColor=nodeImmutable(PropertyNode,"vec4","DiffuseColor"),roughness=nodeImmutable(PropertyNode,"float","Roughness"),metalness=nodeImmutable(PropertyNode,"float","Metalness"),clearcoat=nodeImmutable(PropertyNode,"float","Clearcoat"),clearcoatRoughness=nodeImmutable(PropertyNode,"float","ClearcoatRoughness"),sheen=nodeImmutable(PropertyNode,"vec3","Sheen"),sheenRoughness=nodeImmutable(PropertyNode,"float","SheenRoughness"),iridescence=nodeImmutable(PropertyNode,"float","Iridescence"),iridescenceIOR=nodeImmutable(PropertyNode,"float","IridescenceIOR"),iridescenceThickness=nodeImmutable(PropertyNode,"float","IridescenceThickness"),specularColor=nodeImmutable(PropertyNode,"color","SpecularColor"),shininess=nodeImmutable(PropertyNode,"float","Shininess"),output=nodeImmutable(PropertyNode,"vec4","Output");addNodeClass(PropertyNode);class UVNode extends AttributeNode{constructor(e=0){super(null,"vec2"),this.isUVNode=!0,this.index=e}getAttributeName(){var e=this.index;return"uv"+(0<e?e:"")}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const uv=(...e)=>nodeObject(new UVNode(...e));addNodeClass(UVNode);class TextureSizeNode extends Node$2{constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){var r=this.textureNode.build(e,"property"),i=this.levelNode.build(e,"int");return e.format(`textureDimensions( ${r}, ${i} )`,this.getNodeType(e),t)}}const textureSize=nodeProxy(TextureSizeNode);addNodeElement("textureSize",textureSize),addNodeClass(TextureSizeNode);class OperatorNode extends TempNode{constructor(r,e,i,...n){if(super(),this.op=r,0<n.length){let t=i;for(let e=0;e<n.length;e++)t=new OperatorNode(r,t,n[e]);i=t}this.aNode=e,this.bNode=i}hasDependencies(e){return"="!==this.op&&super.hasDependencies(e)}getNodeType(e,t){var r=this.op,i=this.aNode,n=this.bNode,i=i.getNodeType(e),n=n.getNodeType(e);return"void"===i||"void"===n?"void":"="===r||"%"===r?i:"&"===r||"|"===r||"^"===r||">>"===r||"<<"===r?e.getIntegerType(i):"=="===r||"&&"===r||"||"===r||"^^"===r?"bool":"<"===r||">"===r||"<="===r||">="===r?1<(r=t?e.getTypeLength(t):Math.max(e.getTypeLength(i),e.getTypeLength(n)))?"bvec"+r:"bool":"float"===i&&e.isMatrix(n)?n:e.isMatrix(i)&&e.isVector(n)?e.getVectorFromMatrix(i):e.isVector(i)&&e.isMatrix(n)?e.getVectorFromMatrix(n):e.getTypeLength(n)>e.getTypeLength(i)?n:i}generate(e,t){var r=this.op,i=this.aNode,n=this.bNode,a=this.getNodeType(e,t);let o=null,s=null;"void"!==a?(o=i.getNodeType(e),s=n.getNodeType(e),"="===r?s=o:"<"===r||">"===r||"<="===r||">="===r||"=="===r?e.isVector(o)?s=o:o=s="float":">>"===r||"<<"===r?(o=a,s=e.changeComponentType(s,"uint")):e.isMatrix(o)&&e.isVector(s)?s=e.getVectorFromMatrix(o):o=e.isVector(o)&&e.isMatrix(s)?e.getVectorFromMatrix(s):s=a):o=s=a;var i=i.build(e,o),n=n.build(e,s),l=e.getTypeLength(t);return"void"!==t?"="===r?(e.addLineFlowCode(`${i} ${this.op} `+n),i):"<"===r&&1<l?e.format(e.getMethod("lessThan")+`( ${i}, ${n} )`,a,t):"<="===r&&1<l?e.format(e.getMethod("lessThanEqual")+`( ${i}, ${n} )`,a,t):">"===r&&1<l?e.format(e.getMethod("greaterThan")+`( ${i}, ${n} )`,a,t):">="===r&&1<l?e.format(e.getMethod("greaterThanEqual")+`( ${i}, ${n} )`,a,t):e.format(`( ${i} ${this.op} ${n} )`,a,t):"void"!==o?e.format(`${i} ${this.op} `+n,a,t):void 0}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const add=nodeProxy(OperatorNode,"+"),sub=nodeProxy(OperatorNode,"-"),mul=nodeProxy(OperatorNode,"*"),div=nodeProxy(OperatorNode,"/"),remainder=nodeProxy(OperatorNode,"%"),equal=nodeProxy(OperatorNode,"=="),assign=nodeProxy(OperatorNode,"="),lessThan=nodeProxy(OperatorNode,"<"),greaterThan=nodeProxy(OperatorNode,">"),lessThanEqual=nodeProxy(OperatorNode,"<="),greaterThanEqual=nodeProxy(OperatorNode,">="),and=nodeProxy(OperatorNode,"&&"),or=nodeProxy(OperatorNode,"||"),xor=nodeProxy(OperatorNode,"^^"),bitAnd=nodeProxy(OperatorNode,"&"),bitOr=nodeProxy(OperatorNode,"|"),bitXor=nodeProxy(OperatorNode,"^"),shiftLeft=nodeProxy(OperatorNode,"<<"),shiftRight=nodeProxy(OperatorNode,">>");addNodeElement("add",add),addNodeElement("sub",sub),addNodeElement("mul",mul),addNodeElement("div",div),addNodeElement("remainder",remainder),addNodeElement("equal",equal),addNodeElement("assign",assign),addNodeElement("lessThan",lessThan),addNodeElement("greaterThan",greaterThan),addNodeElement("lessThanEqual",lessThanEqual),addNodeElement("greaterThanEqual",greaterThanEqual),addNodeElement("and",and),addNodeElement("or",or),addNodeElement("xor",xor),addNodeElement("bitAnd",bitAnd),addNodeElement("bitOr",bitOr),addNodeElement("bitXor",bitXor),addNodeElement("shiftLeft",shiftLeft),addNodeElement("shiftRight",shiftRight),addNodeClass(OperatorNode);class MathNode extends TempNode{constructor(e,t,r=null,i=null){super(),this.method=e,this.aNode=t,this.bNode=r,this.cNode=i}getInputType(e){var t=this.aNode.getNodeType(e),r=this.bNode?this.bNode.getNodeType(e):null,i=this.cNode?this.cNode.getNodeType(e):null,n=e.isMatrix(t)?0:e.getTypeLength(t),a=e.isMatrix(r)?0:e.getTypeLength(r),e=e.isMatrix(i)?0:e.getTypeLength(i);return a<n&&e<n?t:e<a?r:n<e?i:t}getNodeType(e){var t=this.method;return t===MathNode.LENGTH||t===MathNode.DISTANCE||t===MathNode.DOT?"float":t===MathNode.CROSS?"vec3":this.getInputType(e)}generate(r,i){var e,t=this.method,n=this.getNodeType(r),a=this.getInputType(r),o=this.aNode,s=this.bNode,l=this.cNode,c=!0===r.renderer.isWebGLRenderer;if(t!==MathNode.TRANSFORM_DIRECTION)return t===MathNode.NEGATE?r.format("-"+o.build(r,a),n,i):t===MathNode.ONE_MINUS?sub(1,o).build(r,i):t===MathNode.RECIPROCAL?div(1,o).build(r,i):t===MathNode.DIFFERENCE?abs(sub(o,s)).build(r,i):(e=[],t===MathNode.CROSS?e.push(o.build(r,n),s.build(r,n)):t===MathNode.STEP?e.push(o.build(r,1===r.getTypeLength(o.getNodeType(r))?"float":a),s.build(r,a)):c&&(t===MathNode.MIN||t===MathNode.MAX)||t===MathNode.MOD?e.push(o.build(r,a),s.build(r,1===r.getTypeLength(s.getNodeType(r))?"float":a)):t===MathNode.REFRACT?e.push(o.build(r,a),s.build(r,a),l.build(r,"float")):t===MathNode.MIX?e.push(o.build(r,a),s.build(r,a),l.build(r,1===r.getTypeLength(l.getNodeType(r))?"float":a)):(e.push(o.build(r,a)),null!==s&&e.push(s.build(r,a)),null!==l&&e.push(l.build(r,a))),r.format(`${r.getMethod(t)}( ${e.join(", ")} )`,n,i));{let e=o,t=s;r.isMatrix(e.getNodeType(r))?t=vec4(vec3(t),0):e=vec4(vec3(e),0);c=mul(e,t).xyz;return normalize$1(c).build(r,i)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}MathNode.RADIANS="radians",MathNode.DEGREES="degrees",MathNode.EXP="exp",MathNode.EXP2="exp2",MathNode.LOG="log",MathNode.LOG2="log2",MathNode.SQRT="sqrt",MathNode.INVERSE_SQRT="inversesqrt",MathNode.FLOOR="floor",MathNode.CEIL="ceil",MathNode.NORMALIZE="normalize",MathNode.FRACT="fract",MathNode.SIN="sin",MathNode.COS="cos",MathNode.TAN="tan",MathNode.ASIN="asin",MathNode.ACOS="acos",MathNode.ATAN="atan",MathNode.ABS="abs",MathNode.SIGN="sign",MathNode.LENGTH="length",MathNode.NEGATE="negate",MathNode.ONE_MINUS="oneMinus",MathNode.DFDX="dFdx",MathNode.DFDY="dFdy",MathNode.ROUND="round",MathNode.RECIPROCAL="reciprocal",MathNode.TRUNC="trunc",MathNode.FWIDTH="fwidth",MathNode.ATAN2="atan2",MathNode.MIN="min",MathNode.MAX="max",MathNode.MOD="mod",MathNode.STEP="step",MathNode.REFLECT="reflect",MathNode.DISTANCE="distance",MathNode.DIFFERENCE="difference",MathNode.DOT="dot",MathNode.CROSS="cross",MathNode.POW="pow",MathNode.TRANSFORM_DIRECTION="transformDirection",MathNode.MIX="mix",MathNode.CLAMP="clamp",MathNode.REFRACT="refract",MathNode.SMOOTHSTEP="smoothstep",MathNode.FACEFORWARD="faceforward";const EPSILON=float(1e-6),INFINITY=float(1e6),radians=nodeProxy(MathNode,MathNode.RADIANS),degrees=nodeProxy(MathNode,MathNode.DEGREES),exp=nodeProxy(MathNode,MathNode.EXP),exp2=nodeProxy(MathNode,MathNode.EXP2),log=nodeProxy(MathNode,MathNode.LOG),log2=nodeProxy(MathNode,MathNode.LOG2),sqrt=nodeProxy(MathNode,MathNode.SQRT),inverseSqrt=nodeProxy(MathNode,MathNode.INVERSE_SQRT),floor=nodeProxy(MathNode,MathNode.FLOOR),ceil=nodeProxy(MathNode,MathNode.CEIL),normalize$1=nodeProxy(MathNode,MathNode.NORMALIZE),fract=nodeProxy(MathNode,MathNode.FRACT),sin=nodeProxy(MathNode,MathNode.SIN),cos=nodeProxy(MathNode,MathNode.COS),tan=nodeProxy(MathNode,MathNode.TAN),asin=nodeProxy(MathNode,MathNode.ASIN),acos=nodeProxy(MathNode,MathNode.ACOS),atan=nodeProxy(MathNode,MathNode.ATAN),abs=nodeProxy(MathNode,MathNode.ABS),sign$1=nodeProxy(MathNode,MathNode.SIGN),length=nodeProxy(MathNode,MathNode.LENGTH),negate=nodeProxy(MathNode,MathNode.NEGATE),oneMinus=nodeProxy(MathNode,MathNode.ONE_MINUS),dFdx=nodeProxy(MathNode,MathNode.DFDX),dFdy=nodeProxy(MathNode,MathNode.DFDY),round=nodeProxy(MathNode,MathNode.ROUND),reciprocal=nodeProxy(MathNode,MathNode.RECIPROCAL),trunc=nodeProxy(MathNode,MathNode.TRUNC),fwidth=nodeProxy(MathNode,MathNode.FWIDTH),atan2=nodeProxy(MathNode,MathNode.ATAN2),min=nodeProxy(MathNode,MathNode.MIN),max=nodeProxy(MathNode,MathNode.MAX),mod=nodeProxy(MathNode,MathNode.MOD),step=nodeProxy(MathNode,MathNode.STEP),reflect=nodeProxy(MathNode,MathNode.REFLECT),distance=nodeProxy(MathNode,MathNode.DISTANCE),difference=nodeProxy(MathNode,MathNode.DIFFERENCE),dot=nodeProxy(MathNode,MathNode.DOT),cross=nodeProxy(MathNode,MathNode.CROSS),pow=nodeProxy(MathNode,MathNode.POW),pow2=nodeProxy(MathNode,MathNode.POW,2),pow3=nodeProxy(MathNode,MathNode.POW,3),pow4=nodeProxy(MathNode,MathNode.POW,4),transformDirection=nodeProxy(MathNode,MathNode.TRANSFORM_DIRECTION),mix=nodeProxy(MathNode,MathNode.MIX),clamp$1=(e,t=0,r=1)=>nodeObject(new MathNode(MathNode.CLAMP,nodeObject(e),nodeObject(t),nodeObject(r))),saturate=e=>clamp$1(e),refract=nodeProxy(MathNode,MathNode.REFRACT),smoothstep$1=nodeProxy(MathNode,MathNode.SMOOTHSTEP),faceForward=nodeProxy(MathNode,MathNode.FACEFORWARD),mixElement=(e,t,r)=>mix(t,r,e),smoothstepElement=(e,t,r)=>smoothstep$1(t,r,e),sRGBToLinearShader=(addNodeElement("radians",radians),addNodeElement("degrees",degrees),addNodeElement("exp",exp),addNodeElement("exp2",exp2),addNodeElement("log",log),addNodeElement("log2",log2),addNodeElement("sqrt",sqrt),addNodeElement("inverseSqrt",inverseSqrt),addNodeElement("floor",floor),addNodeElement("ceil",ceil),addNodeElement("normalize",normalize$1),addNodeElement("fract",fract),addNodeElement("sin",sin),addNodeElement("cos",cos),addNodeElement("tan",tan),addNodeElement("asin",asin),addNodeElement("acos",acos),addNodeElement("atan",atan),addNodeElement("abs",abs),addNodeElement("sign",sign$1),addNodeElement("length",length),addNodeElement("negate",negate),addNodeElement("oneMinus",oneMinus),addNodeElement("dFdx",dFdx),addNodeElement("dFdy",dFdy),addNodeElement("round",round),addNodeElement("reciprocal",reciprocal),addNodeElement("trunc",trunc),addNodeElement("fwidth",fwidth),addNodeElement("atan2",atan2),addNodeElement("min",min),addNodeElement("max",max),addNodeElement("mod",mod),addNodeElement("step",step),addNodeElement("reflect",reflect),addNodeElement("distance",distance),addNodeElement("dot",dot),addNodeElement("cross",cross),addNodeElement("pow",pow),addNodeElement("pow2",pow2),addNodeElement("pow3",pow3),addNodeElement("pow4",pow4),addNodeElement("transformDirection",transformDirection),addNodeElement("mix",mixElement),addNodeElement("clamp",clamp$1),addNodeElement("refract",refract),addNodeElement("smoothstep",smoothstepElement),addNodeElement("faceForward",faceForward),addNodeElement("difference",difference),addNodeElement("saturate",saturate),addNodeClass(MathNode),tslFn(e=>{var e=e["value"],t=e["rgb"],r=t.mul(.9478672986).add(.0521327014).pow(2.4),i=t.mul(.0773993808),t=t.lessThanEqual(.04045),r=mix(r,i,t);return vec4(r,e.a)})),LinearTosRGBShader=tslFn(e=>{var e=e["value"],t=e["rgb"],r=t.pow(.41666).mul(1.055).sub(.055),i=t.mul(12.92),t=t.lessThanEqual(.0031308),r=mix(r,i,t);return vec4(r,e.a)}),getColorSpaceMethod=e=>{let t=null;return e===LinearSRGBColorSpace$1?t="Linear":e===SRGBColorSpace$1&&(t="sRGB"),t},getMethod=(e,t)=>getColorSpaceMethod(e)+"To"+getColorSpaceMethod(t);class ColorSpaceNode extends TempNode{constructor(e,t){super("vec4"),this.method=e,this.node=t}construct(){var{method:e,node:t}=this;return e===ColorSpaceNode.LINEAR_TO_LINEAR?t:Methods[e]({value:t})}}ColorSpaceNode.LINEAR_TO_LINEAR="LinearToLinear",ColorSpaceNode.LINEAR_TO_sRGB="LinearTosRGB",ColorSpaceNode.sRGB_TO_LINEAR="sRGBToLinear";const Methods={[ColorSpaceNode.LINEAR_TO_sRGB]:LinearTosRGBShader,[ColorSpaceNode.sRGB_TO_LINEAR]:sRGBToLinearShader},linearToColorSpace=(e,t)=>nodeObject(new ColorSpaceNode(getMethod(LinearSRGBColorSpace$1,t),nodeObject(e))),colorSpaceToLinear=(e,t)=>nodeObject(new ColorSpaceNode(getMethod(t,LinearSRGBColorSpace$1),nodeObject(e))),linearTosRGB=nodeProxy(ColorSpaceNode,ColorSpaceNode.LINEAR_TO_sRGB),sRGBToLinear=nodeProxy(ColorSpaceNode,ColorSpaceNode.sRGB_TO_LINEAR);addNodeElement("linearTosRGB",linearTosRGB),addNodeElement("sRGBToLinear",sRGBToLinear),addNodeElement("linearToColorSpace",linearToColorSpace),addNodeElement("colorSpaceToLinear",colorSpaceToLinear),addNodeClass(ColorSpaceNode);class ExpressionNode extends Node$2{constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){var r=this.getNodeType(e),i=this.snippet;if("void"!==r)return e.format(`( ${i} )`,r,t);e.addLineFlowCode(i)}}const expression=nodeProxy(ExpressionNode);addNodeClass(ExpressionNode);class TextureNode extends UniformNode{constructor(e,t=null,r=null,i=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=r,this.compareNode=i,this.updateMatrix=!1,this.updateType=NodeUpdateType.NONE,this.setUpdateMatrix(null===t)}getUniformHash(){return this.value.uuid}getNodeType(){return!0===this.value.isDepthTexture?"float":"vec4"}getInputType(){return"texture"}getDefaultUV(){return uv(this.value.channel)}getTextureMatrix(e){var t=this.value;return uniform(t.matrix).mul(vec3(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?NodeUpdateType.FRAME:NodeUpdateType.NONE,this}construct(e){var t=e.getNodeProperties(this);let r=this.uvNode,i=(r=(r=null===r&&e.context.getUVNode?e.context.getUVNode(this):r)||this.getDefaultUV(),this.updateMatrix&&(r=this.getTextureMatrix(r)),this.levelNode);null===i&&e.context.getSamplerLevelNode&&(i=e.context.getSamplerLevelNode(this)),t.uvNode=r,t.levelNode=i?e.context.getMIPLevelAlgorithmNode(this,i):null}generate(r,i){var{uvNode:n,levelNode:a}=r.getNodeProperties(this),o=this.compareNode,s=this.value;if(!s||!0!==s.isTexture)throw new Error("TextureNode: Need a three.js texture.");var l=super.generate(r,"property");if("sampler"===i)return l+"_sampler";if(r.isReference(i))return l;{var c=this.getNodeType(r),d=r.getDataFromNode(this);let t=d.propertyName;if(void 0===t){var n=n.build(r,"vec2"),h=r.getVarFromNode(this,c);t=r.getPropertyName(h);let e=null;e=a&&!0===a.isNode?(h=a.build(r,"float"),r.getTextureLevel(s,l,n,h)):null!==o?(a=o.build(r,"float"),r.getTextureCompare(s,l,n,a)):r.getTexture(s,l,n),r.addLineFlowCode(t+" = "+e),d.snippet=e,d.propertyName=t}let e=t;return r.needsColorSpaceToLinear(this.value)&&(e=colorSpaceToLinear(expression(e,c),this.value.colorSpace).construct(r).build(r,c)),r.format(e,c,i)}}uv(e){var t=this.clone();return t.uvNode=e,nodeObject(t)}level(e){var t=this.clone();return t.levelNode=e,context(t,{getMIPLevelAlgorithmNode:(e,t)=>t})}size(e){return textureSize(this,e)}compare(e){var t=this.clone();return t.compareNode=nodeObject(e),nodeObject(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value]}update(){var e=this.value;!0===e.matrixAutoUpdate&&e.updateMatrix()}clone(){return new this.constructor(this.value,this.uvNode,this.levelNode,this.compareNode)}}const texture=nodeProxy(TextureNode),sampler=e=>(!0===e.isNode?e:texture(e)).convert("sampler");addNodeElement("texture",texture),addNodeClass(TextureNode);class ReferenceNode extends Node$2{constructor(e,t,r=null){super(),this.property=e,this.uniformType=t,this.object=r,this.node=null,this.updateType=NodeUpdateType.OBJECT,this.setNodeType(t)}setNodeType(e){let t=null;t="texture"===e?texture(null):uniform(e),this.node=t}getNodeType(e){return this.node.getNodeType(e)}update(e){var e=(null!==this.object?this:e).object,t=this.property;this.node.value=e[t]}construct(){return this.node}}const reference=(e,t,r)=>nodeObject(new ReferenceNode(e,t,r));addNodeClass(ReferenceNode);class MaterialReferenceNode extends ReferenceNode{constructor(e,t,r=null){super(e,t,r),this.material=r}construct(e){var t=(null!==this.material?this:e).material;return this.node.value=t[this.property],super.construct(e)}update(e){this.object=(null!==this.material?this:e).material,super.update(e)}}const materialReference=(e,t,r)=>nodeObject(new MaterialReferenceNode(e,t,r));addNodeClass(MaterialReferenceNode);class MaterialNode extends Node$2{constructor(e){super(),this.scope=e}getFloat(e){return materialReference(e,"float")}getColor(e){return materialReference(e,"color")}getTexture(e){return materialReference(e,"texture")}construct(e){var t,r=e.context.material,i=this.scope;let n=null;return n=i===MaterialNode.ALPHA_TEST||i===MaterialNode.SHININESS||i===MaterialNode.REFLECTIVITY||i===MaterialNode.ROTATION||i===MaterialNode.IRIDESCENCE||i===MaterialNode.IRIDESCENCE_IOR?this.getFloat(i):i===MaterialNode.SPECULAR_COLOR?this.getColor("specular"):i===MaterialNode.COLOR?(t=this.getColor("color"),r.map&&!0===r.map.isTexture?t.mul(this.getTexture("map")):t):i===MaterialNode.OPACITY?(t=this.getFloat("opacity"),r.alphaMap&&!0===r.alphaMap.isTexture?t.mul(this.getTexture("alphaMap")):t):i===MaterialNode.SPECULAR_STRENGTH?r.specularMap&&!0===r.specularMap.isTexture?this.getTexture("specularMap").r:float(1):i===MaterialNode.ROUGHNESS?(t=this.getFloat("roughness"),r.roughnessMap&&!0===r.roughnessMap.isTexture?t.mul(this.getTexture("roughnessMap").g):t):i===MaterialNode.METALNESS?(t=this.getFloat("metalness"),r.metalnessMap&&!0===r.metalnessMap.isTexture?t.mul(this.getTexture("metalnessMap").b):t):i===MaterialNode.EMISSIVE?(t=this.getColor("emissive"),r.emissiveMap&&!0===r.emissiveMap.isTexture?t.mul(this.getTexture("emissiveMap")):t):i===MaterialNode.CLEARCOAT?(t=this.getFloat("clearcoat"),r.clearcoatMap&&!0===r.clearcoatMap.isTexture?t.mul(this.getTexture("clearcoatMap").r):t):i===MaterialNode.CLEARCOAT_ROUGHNESS?(t=this.getFloat("clearcoatRoughness"),r.clearcoatRoughnessMap&&!0===r.clearcoatRoughnessMap.isTexture?t.mul(this.getTexture("clearcoatRoughnessMap").r):t):i===MaterialNode.SHEEN?(t=this.getColor("sheenColor").mul(this.getFloat("sheen")),r.sheenColorMap&&!0===r.sheenColorMap.isTexture?t.mul(this.getTexture("sheenColorMap").rgb):t):i===MaterialNode.SHEEN_ROUGHNESS?(t=this.getFloat("sheenRoughness"),(n=r.sheenRoughnessMap&&!0===r.sheenRoughnessMap.isTexture?t.mul(this.getTexture("sheenRoughnessMap").a):t).clamp(.07,1)):i===MaterialNode.IRIDESCENCE_THICKNESS?(t=reference(1,"float",r.iridescenceThicknessRange),r.iridescenceThicknessMap?(r=reference(0,"float",r.iridescenceThicknessRange),t.sub(r).mul(this.getTexture("iridescenceThicknessMap").g).add(r)):t):(r=this.getNodeType(e),materialReference(i,r))}}MaterialNode.ALPHA_TEST="alphaTest",MaterialNode.COLOR="color",MaterialNode.OPACITY="opacity",MaterialNode.SHININESS="shininess",MaterialNode.SPECULAR="specular",MaterialNode.SPECULAR_STRENGTH="specularStrength",MaterialNode.REFLECTIVITY="reflectivity",MaterialNode.ROUGHNESS="roughness",MaterialNode.METALNESS="metalness",MaterialNode.CLEARCOAT="clearcoat",MaterialNode.CLEARCOAT_ROUGHNESS="clearcoatRoughness",MaterialNode.EMISSIVE="emissive",MaterialNode.ROTATION="rotation",MaterialNode.SHEEN="sheen",MaterialNode.SHEEN_ROUGHNESS="sheenRoughness",MaterialNode.IRIDESCENCE="iridescence",MaterialNode.IRIDESCENCE_IOR="iridescenceIOR",MaterialNode.IRIDESCENCE_THICKNESS="iridescenceThickness";const materialAlphaTest=nodeImmutable(MaterialNode,MaterialNode.ALPHA_TEST),materialColor=nodeImmutable(MaterialNode,MaterialNode.COLOR),materialShininess=nodeImmutable(MaterialNode,MaterialNode.SHININESS),materialEmissive=nodeImmutable(MaterialNode,MaterialNode.EMISSIVE),materialOpacity=nodeImmutable(MaterialNode,MaterialNode.OPACITY),materialSpecularColor=nodeImmutable(MaterialNode,MaterialNode.SPECULAR_COLOR),materialSpecularStrength=nodeImmutable(MaterialNode,MaterialNode.SPECULAR_STRENGTH),materialReflectivity=nodeImmutable(MaterialNode,MaterialNode.REFLECTIVITY),materialRoughness=nodeImmutable(MaterialNode,MaterialNode.ROUGHNESS),materialMetalness=nodeImmutable(MaterialNode,MaterialNode.METALNESS),materialClearcoat=nodeImmutable(MaterialNode,MaterialNode.CLEARCOAT),materialClearcoatRoughness=nodeImmutable(MaterialNode,MaterialNode.CLEARCOAT_ROUGHNESS),materialRotation=nodeImmutable(MaterialNode,MaterialNode.ROTATION),materialSheen=nodeImmutable(MaterialNode,MaterialNode.SHEEN),materialSheenRoughness=nodeImmutable(MaterialNode,MaterialNode.SHEEN_ROUGHNESS),materialIridescence=nodeImmutable(MaterialNode,MaterialNode.IRIDESCENCE),materialIridescenceIOR=nodeImmutable(MaterialNode,MaterialNode.IRIDESCENCE_IOR),materialIridescenceThickness=nodeImmutable(MaterialNode,MaterialNode.IRIDESCENCE_THICKNESS);addNodeClass(MaterialNode);class Object3DNode extends Node$2{constructor(e=Object3DNode.VIEW_MATRIX,t=null){super(),this.scope=e,this.object3d=t,this.updateType=NodeUpdateType.OBJECT,this._uniformNode=uniform(null)}getNodeType(){var e=this.scope;return e===Object3DNode.WORLD_MATRIX||e===Object3DNode.VIEW_MATRIX?"mat4":e===Object3DNode.NORMAL_MATRIX?"mat3":e===Object3DNode.POSITION||e===Object3DNode.VIEW_POSITION||e===Object3DNode.DIRECTION||e===Object3DNode.SCALE?"vec3":void 0}update(e){var t=this.object3d,r=this._uniformNode,i=this.scope;i===Object3DNode.VIEW_MATRIX?r.value=t.modelViewMatrix:i===Object3DNode.NORMAL_MATRIX?r.value=t.normalMatrix:i===Object3DNode.WORLD_MATRIX?r.value=t.matrixWorld:i===Object3DNode.POSITION?(r.value=r.value||new Vector3$1,r.value.setFromMatrixPosition(t.matrixWorld)):i===Object3DNode.SCALE?(r.value=r.value||new Vector3$1,r.value.setFromMatrixScale(t.matrixWorld)):i===Object3DNode.DIRECTION?(r.value=r.value||new Vector3$1,t.getWorldDirection(r.value)):i===Object3DNode.VIEW_POSITION&&(i=e.camera,r.value=r.value||new Vector3$1,r.value.setFromMatrixPosition(t.matrixWorld),r.value.applyMatrix4(i.matrixWorldInverse))}generate(e){var t=this.scope;return t===Object3DNode.WORLD_MATRIX||t===Object3DNode.VIEW_MATRIX?this._uniformNode.nodeType="mat4":t===Object3DNode.NORMAL_MATRIX?this._uniformNode.nodeType="mat3":t!==Object3DNode.POSITION&&t!==Object3DNode.VIEW_POSITION&&t!==Object3DNode.DIRECTION&&t!==Object3DNode.SCALE||(this._uniformNode.nodeType="vec3"),this._uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}Object3DNode.VIEW_MATRIX="viewMatrix",Object3DNode.NORMAL_MATRIX="normalMatrix",Object3DNode.WORLD_MATRIX="worldMatrix",Object3DNode.POSITION="position",Object3DNode.SCALE="scale",Object3DNode.VIEW_POSITION="viewPosition",Object3DNode.DIRECTION="direction";const objectDirection=nodeProxy(Object3DNode,Object3DNode.DIRECTION),objectViewMatrix=nodeProxy(Object3DNode,Object3DNode.VIEW_MATRIX),objectNormalMatrix=nodeProxy(Object3DNode,Object3DNode.NORMAL_MATRIX),objectWorldMatrix=nodeProxy(Object3DNode,Object3DNode.WORLD_MATRIX),objectPosition=nodeProxy(Object3DNode,Object3DNode.POSITION),objectScale=nodeProxy(Object3DNode,Object3DNode.SCALE),objectViewPosition=nodeProxy(Object3DNode,Object3DNode.VIEW_POSITION);addNodeClass(Object3DNode);class CameraNode extends Object3DNode{constructor(e=CameraNode.POSITION){super(e)}getNodeType(e){var t=this.scope;return t===CameraNode.PROJECTION_MATRIX?"mat4":t===CameraNode.NEAR||t===CameraNode.FAR?"float":super.getNodeType(e)}update(e){var t=e.camera,r=this._uniformNode,i=this.scope;i===CameraNode.VIEW_MATRIX?r.value=t.matrixWorldInverse:i===CameraNode.PROJECTION_MATRIX?r.value=t.projectionMatrix:i===CameraNode.NEAR?r.value=t.near:i===CameraNode.FAR?r.value=t.far:(this.object3d=t,super.update(e))}generate(e){var t=this.scope;return t===CameraNode.PROJECTION_MATRIX?this._uniformNode.nodeType="mat4":t!==CameraNode.NEAR&&t!==CameraNode.FAR||(this._uniformNode.nodeType="float"),super.generate(e)}}CameraNode.PROJECTION_MATRIX="projectionMatrix",CameraNode.NEAR="near",CameraNode.FAR="far";const cameraProjectionMatrix=label(nodeImmutable(CameraNode,CameraNode.PROJECTION_MATRIX),"projectionMatrix"),cameraNear=nodeImmutable(CameraNode,CameraNode.NEAR),cameraFar=nodeImmutable(CameraNode,CameraNode.FAR),cameraViewMatrix=nodeImmutable(CameraNode,CameraNode.VIEW_MATRIX),cameraNormalMatrix=nodeImmutable(CameraNode,CameraNode.NORMAL_MATRIX),cameraWorldMatrix=nodeImmutable(CameraNode,CameraNode.WORLD_MATRIX),cameraPosition=nodeImmutable(CameraNode,CameraNode.POSITION);addNodeClass(CameraNode);class ModelNode extends Object3DNode{constructor(e=ModelNode.VIEW_MATRIX){super(e)}update(e){this.object3d=e.object,super.update(e)}}const modelDirection=nodeImmutable(ModelNode,ModelNode.DIRECTION),modelViewMatrix=label(nodeImmutable(ModelNode,ModelNode.VIEW_MATRIX),"modelViewMatrix"),modelNormalMatrix=nodeImmutable(ModelNode,ModelNode.NORMAL_MATRIX),modelWorldMatrix=nodeImmutable(ModelNode,ModelNode.WORLD_MATRIX),modelPosition=nodeImmutable(ModelNode,ModelNode.POSITION),modelScale=nodeImmutable(ModelNode,ModelNode.SCALE),modelViewPosition=nodeImmutable(ModelNode,ModelNode.VIEW_POSITION);addNodeClass(ModelNode);class NormalNode extends Node$2{constructor(e=NormalNode.LOCAL){super("vec3"),this.scope=e}isGlobal(){return!0}getHash(){return"normal-"+this.scope}generate(e){var t,r=this.scope;let i=null;return r===NormalNode.GEOMETRY?i=attribute("normal","vec3"):r===NormalNode.LOCAL?i=varying(normalGeometry):r===NormalNode.VIEW?(t=modelNormalMatrix.mul(normalLocal),i=normalize$1(varying(t))):r===NormalNode.WORLD&&(t=normalView.transformDirection(cameraViewMatrix),i=normalize$1(varying(t))),i.build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}NormalNode.GEOMETRY="geometry",NormalNode.LOCAL="local",NormalNode.VIEW="view",NormalNode.WORLD="world";const normalGeometry=nodeImmutable(NormalNode,NormalNode.GEOMETRY),normalLocal=nodeImmutable(NormalNode,NormalNode.LOCAL),normalView=nodeImmutable(NormalNode,NormalNode.VIEW),normalWorld=nodeImmutable(NormalNode,NormalNode.WORLD),transformedNormalView=property("vec3","TransformedNormalView"),transformedNormalWorld=transformedNormalView.transformDirection(cameraViewMatrix).normalize(),transformedClearcoatNormalView=property("vec3","TransformedClearcoatNormalView");addNodeClass(NormalNode);class VarNode extends Node$2{constructor(e,t=null){super(),this.node=e,this.name=t}assign(e){return e.traverse((e,t)=>{t&&e.uuid===this.uuid&&t(this.node)}),this.node=e,this}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){var t,r=this.node,i=this.name;return null===i&&!0===r.isTempNode?r.build(e):(t=e.getVectorType(this.getNodeType(e)),r=r.build(e,t),t=e.getVarFromNode(this,t),null!==i&&(t.name=i),i=e.getPropertyName(t),e.addLineFlowCode(i+" = "+r),i)}}const temp=nodeProxy(VarNode);addNodeElement("temp",temp),addNodeClass(VarNode);class TangentNode extends Node$2{constructor(e=TangentNode.LOCAL){super(),this.scope=e}getHash(){return"tangent-"+this.scope}getNodeType(){return this.scope===TangentNode.GEOMETRY?"vec4":"vec3"}generate(e){var t,r=this.scope;let i=null;return r===TangentNode.GEOMETRY?i=attribute("tangent","vec4"):r===TangentNode.LOCAL?i=varying(tangentGeometry.xyz):r===TangentNode.VIEW?(t=modelViewMatrix.mul(tangentLocal).xyz,i=normalize$1(varying(t))):r===TangentNode.WORLD&&(t=tangentView.transformDirection(cameraViewMatrix),i=normalize$1(varying(t))),i.build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}TangentNode.GEOMETRY="geometry",TangentNode.LOCAL="local",TangentNode.VIEW="view",TangentNode.WORLD="world";const tangentGeometry=nodeImmutable(TangentNode,TangentNode.GEOMETRY),tangentLocal=nodeImmutable(TangentNode,TangentNode.LOCAL),tangentView=nodeImmutable(TangentNode,TangentNode.VIEW),tangentWorld=nodeImmutable(TangentNode,TangentNode.WORLD),transformedTangentView=temp(tangentView,"TransformedTangentView"),transformedTangentWorld=normalize$1(transformedTangentView.transformDirection(cameraViewMatrix));addNodeClass(TangentNode);class BitangentNode extends Node$2{constructor(e=BitangentNode.LOCAL){super("vec3"),this.scope=e}getHash(){return"bitangent-"+this.scope}generate(e){var t=this.scope;let r;t===BitangentNode.GEOMETRY?r=normalGeometry.cross(tangentGeometry):t===BitangentNode.LOCAL?r=normalLocal.cross(tangentLocal):t===BitangentNode.VIEW?r=normalView.cross(tangentView):t===BitangentNode.WORLD&&(r=normalWorld.cross(tangentWorld));t=r.mul(tangentGeometry.w).xyz;return normalize$1(varying(t)).build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}BitangentNode.GEOMETRY="geometry",BitangentNode.LOCAL="local",BitangentNode.VIEW="view",BitangentNode.WORLD="world";const bitangentGeometry=nodeImmutable(BitangentNode,BitangentNode.GEOMETRY),bitangentLocal=nodeImmutable(BitangentNode,BitangentNode.LOCAL),bitangentView=nodeImmutable(BitangentNode,BitangentNode.VIEW),bitangentWorld=nodeImmutable(BitangentNode,BitangentNode.WORLD),transformedBitangentView=normalize$1(transformedNormalView.cross(transformedTangentView).mul(tangentGeometry.w)),transformedBitangentWorld=normalize$1(transformedBitangentView.transformDirection(cameraViewMatrix));addNodeClass(BitangentNode);class PositionNode extends Node$2{constructor(e=PositionNode.LOCAL){super("vec3"),this.scope=e}isGlobal(){return!0}getHash(){return"position-"+this.scope}generate(e){var t,r=this.scope;let i=null;return r===PositionNode.GEOMETRY?i=attribute("position","vec3"):r===PositionNode.LOCAL?i=varying(positionGeometry):r===PositionNode.WORLD?(t=modelWorldMatrix.mul(positionLocal),i=varying(t)):r===PositionNode.VIEW?(t=modelViewMatrix.mul(positionLocal),i=varying(t)):r===PositionNode.VIEW_DIRECTION?(t=positionView.negate(),i=normalize$1(varying(t))):r===PositionNode.WORLD_DIRECTION&&(t=positionLocal.transformDirection(modelWorldMatrix),i=normalize$1(varying(t))),i.build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}PositionNode.GEOMETRY="geometry",PositionNode.LOCAL="local",PositionNode.WORLD="world",PositionNode.WORLD_DIRECTION="worldDirection",PositionNode.VIEW="view",PositionNode.VIEW_DIRECTION="viewDirection";const positionGeometry=nodeImmutable(PositionNode,PositionNode.GEOMETRY),positionLocal=nodeImmutable(PositionNode,PositionNode.LOCAL),positionWorld=nodeImmutable(PositionNode,PositionNode.WORLD),positionWorldDirection=nodeImmutable(PositionNode,PositionNode.WORLD_DIRECTION),positionView=nodeImmutable(PositionNode,PositionNode.VIEW),positionViewDirection=nodeImmutable(PositionNode,PositionNode.VIEW_DIRECTION);addNodeClass(PositionNode);class FrontFacingNode extends Node$2{constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){return e.getFrontFacing()}}const frontFacing=nodeImmutable(FrontFacingNode),faceDirection=float(frontFacing).mul(2).sub(1),perturbNormal2Arb=(addNodeClass(FrontFacingNode),tslFn(e=>{var{eye_pos:e,surf_norm:t,mapN:r,uv:i}=e,n=e.dFdx(),e=e.dFdy(),a=i.dFdx(),i=i.dFdy(),e=e.cross(t),n=t.cross(n),o=e.mul(a.x).add(n.mul(i.x)),e=e.mul(a.y).add(n.mul(i.y)),a=o.dot(o).max(e.dot(e)),n=faceDirection.mul(a.inverseSqrt());return add(o.mul(r.x,n),e.mul(r.y,n),t.mul(r.z)).normalize()}));class NormalMapNode extends TempNode{constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=TangentSpaceNormalMap$1}construct(e){var{normalMapType:t,scaleNode:r}=this;let i=this.node.mul(2).sub(1),n=(null!==r&&(i=vec3(i.xy.mul(r),i.z)),null);return t===ObjectSpaceNormalMap$1?n=modelNormalMatrix.mul(i).normalize():t===TangentSpaceNormalMap$1&&(r=e.hasGeometryAttribute("tangent"),n=!0===r?TBNViewMatrix.mul(i).normalize():perturbNormal2Arb({eye_pos:positionView,surf_norm:normalView,mapN:i,uv:uv()})),n}}const normalMap=nodeProxy(NormalMapNode),TBNViewMatrix=mat3(tangentView,bitangentView,normalView),dHdxy_fwd=(addNodeClass(NormalMapNode),tslFn(({bumpTexture:e,bumpScale:t})=>{var r=uv(),i=texture(e,r).x;return vec2(texture(e,r.add(r.dFdx())).x.sub(i),texture(e,r.add(r.dFdy())).x.sub(i)).mul(t)})),perturbNormalArb=tslFn(e=>{var{surf_pos:e,surf_norm:t,dHdxy:r}=e,i=e.dFdx(),n=t,e=e.dFdy().cross(n),n=n.cross(i),i=i.dot(e).mul(faceDirection),e=i.sign().mul(r.x.mul(e).add(r.y.mul(n)));return i.abs().mul(t).sub(e).normalize()});class BumpMapNode extends TempNode{constructor(e,t=null){super("vec3"),this.texture=e,this.scaleNode=t}construct(){var e=null!==this.scaleNode?this.scaleNode:1,e=dHdxy_fwd({bumpTexture:this.texture,bumpScale:e});return perturbNormalArb({surf_pos:positionView.negate(),surf_norm:normalView,dHdxy:e})}}const bumpMap=nodeProxy(BumpMapNode);addNodeClass(BumpMapNode);class ExtendedMaterialNode extends MaterialNode{constructor(e){super(e)}getNodeType(e){var t=this.scope;let r=null;return(r=t!==ExtendedMaterialNode.NORMAL&&t!==ExtendedMaterialNode.CLEARCOAT_NORMAL?r:"vec3")||super.getNodeType(e)}construct(e){var t=e.material,r=this.scope;let i=null;return r===ExtendedMaterialNode.NORMAL?i=t.normalMap?normalMap(this.getTexture("normalMap"),materialReference("normalScale","vec2")):t.bumpMap?bumpMap(t.bumpMap,materialReference("bumpScale","float")):normalView:r===ExtendedMaterialNode.CLEARCOAT_NORMAL&&(i=t.clearcoatNormalMap?normalMap(this.getTexture("clearcoatNormalMap"),materialReference("clearcoatNormalScale","vec2")):normalView),i||super.construct(e)}}ExtendedMaterialNode.NORMAL="normal",ExtendedMaterialNode.CLEARCOAT_NORMAL="clearcoatNormal";const materialNormal=nodeImmutable(ExtendedMaterialNode,ExtendedMaterialNode.NORMAL),materialClearcoatNormal=nodeImmutable(ExtendedMaterialNode,ExtendedMaterialNode.CLEARCOAT_NORMAL);addNodeClass(ExtendedMaterialNode);class ModelViewProjectionNode extends Node$2{constructor(e=positionLocal){super("vec4"),this.positionNode=e}construct(){return cameraProjectionMatrix.mul(modelViewMatrix).mul(this.positionNode)}}const modelViewProjection=nodeProxy(ModelViewProjectionNode);addNodeClass(ModelViewProjectionNode);class BufferAttributeNode extends InputNode{constructor(e,t,r=0,i=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=r,this.bufferOffset=i,this.usage=StaticDrawUsage$1,this.instanced=!1}construct(e){var t=this.getNodeType(e),r=this.value,e=e.getTypeLength(t),t=this.bufferStride||e,i=this.bufferOffset,r=!0===r.isInterleavedBuffer?r:new InterleavedBuffer$1(r,t),t=new InterleavedBufferAttribute$1(r,e,i);r.setUsage(this.usage),this.attribute=t,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){var t=this.getNodeType(e),r=e.getBufferAttributeFromNode(this,t),r=e.getPropertyName(r);let i=null;return i="vertex"===e.shaderStage?r:varying(this).build(e,t)}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this}setInstanced(e){return this.instanced=e,this}}const bufferAttribute=(e,t,r,i)=>nodeObject(new BufferAttributeNode(e,t,r,i)),dynamicBufferAttribute=(e,t,r,i)=>bufferAttribute(e,t,r,i).setUsage(DynamicDrawUsage$1),instancedBufferAttribute=(e,t,r,i)=>bufferAttribute(e,t,r,i).setInstanced(!0),instancedDynamicBufferAttribute=(e,t,r,i)=>dynamicBufferAttribute(e,t,r,i).setInstanced(!0);addNodeClass(BufferAttributeNode);class InstanceNode extends Node$2{constructor(e){super("void"),this.instanceMesh=e,this.instanceMatrixNode=null}construct(e){let t=this.instanceMatrixNode;null===t&&(i=this.instanceMesh.instanceMatrix,r=new InstancedInterleavedBuffer$1(i.array,16,1),i=[(i=i.usage===DynamicDrawUsage$1?instancedDynamicBufferAttribute:instancedBufferAttribute)(r,"vec4",16,0),i(r,"vec4",16,4),i(r,"vec4",16,8),i(r,"vec4",16,12)],t=mat4(...i),this.instanceMatrixNode=t);var r=t.mul(positionLocal).xyz,i=mat3(t[0].xyz,t[1].xyz,t[2].xyz),n=normalLocal.div(vec3(i[0].dot(i[0]),i[1].dot(i[1]),i[2].dot(i[2]))),i=i.mul(n).xyz;e.stack.assign(positionLocal,r),e.stack.assign(normalLocal,i)}}const instance=nodeProxy(InstanceNode);addNodeClass(InstanceNode);class BufferNode extends UniformNode{constructor(e,t,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=r}getInputType(){return"buffer"}}const buffer=(e,t,r)=>nodeObject(new BufferNode(e,t,r));addNodeClass(BufferNode);class SkinningNode extends Node$2{constructor(e){super("void"),this.skinnedMesh=e,this.updateType=NodeUpdateType.OBJECT,this.skinIndexNode=attribute("skinIndex","uvec4"),this.skinWeightNode=attribute("skinWeight","vec4"),this.bindMatrixNode=uniform(e.bindMatrix,"mat4"),this.bindMatrixInverseNode=uniform(e.bindMatrixInverse,"mat4"),this.boneMatricesNode=buffer(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length)}construct(e){var{skinIndexNode:t,skinWeightNode:r,bindMatrixNode:i,bindMatrixInverseNode:n,boneMatricesNode:a}=this,o=a.element(t.x),s=a.element(t.y),l=a.element(t.z),a=a.element(t.w),t=i.mul(positionLocal),t=add(o.mul(r.x).mul(t),s.mul(r.y).mul(t),l.mul(r.z).mul(t),a.mul(r.w).mul(t)),t=n.mul(t).xyz,o=add(r.x.mul(o),r.y.mul(s),r.z.mul(l),r.w.mul(a)),s=(o=n.mul(o).mul(i)).transformDirection(normalLocal).xyz;e.stack.assign(positionLocal,t),e.stack.assign(normalLocal,s),e.hasGeometryAttribute("tangent")&&e.stack.assign(tangentLocal,s)}update(){this.skinnedMesh.skeleton.update()}}const skinning=nodeProxy(SkinningNode);addNodeClass(SkinningNode);class MorphNode extends Node$2{constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=uniform(1),this.updateType=NodeUpdateType.OBJECT}constructAttribute(t,e,r=positionLocal){var i=this.mesh,n=i.geometry.morphAttributes[e];t.stack.assign(r,r.mul(this.morphBaseInfluence));for(let e=0;e<n.length;e++){var a=n[e],a=bufferAttribute(a.array,"vec3"),o=reference(e,"float",i.morphTargetInfluences);t.stack.assign(r,r.add(a.mul(o)))}}construct(e){this.constructAttribute(e,"position")}update(){var e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((e,t)=>e+t,0)}}const morph=nodeProxy(MorphNode);addNodeClass(MorphNode);class ReflectVectorNode extends Node$2{constructor(){super("vec3")}getHash(){return"reflectVector"}construct(){return positionViewDirection.negate().reflect(transformedNormalView).transformDirection(cameraViewMatrix)}}const reflectVector=nodeImmutable(ReflectVectorNode);addNodeClass(ReflectVectorNode);class CubeTextureNode extends TextureNode{constructor(e,t=null,r=null){super(e,t,r),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){return reflectVector}setUpdateMatrix(){}generate(r,e){var{uvNode:i,levelNode:n}=r.getNodeProperties(this),a=this.value;if(!a||!0!==a.isCubeTexture)throw new Error("CubeTextureNode: Need a three.js cube texture.");a=UniformNode.prototype.generate.call(this,r,"cubeTexture");if("sampler"===e)return a+"_sampler";if(r.isReference(e))return a;{var o=r.getDataFromNode(this);let t=o.propertyName;if(void 0===t){var i=vec3(i.x.negate(),i.yz).build(r,"vec3"),s=r.getVarFromNode(this,"vec4");t=r.getPropertyName(s);let e=null;e=n&&!0===n.isNode?(s=n.build(r,"float"),r.getTextureLevel(this,a,i,s)):r.getTexture(this,a,i),r.addLineFlowCode(t+" = "+e),o.snippet=e,o.propertyName=t}return r.format(t,"vec4",e)}}}const cubeTexture=nodeProxy(CubeTextureNode);addNodeElement("cubeTexture",cubeTexture),addNodeClass(CubeTextureNode);class LightingNode extends Node$2{constructor(){super("vec3")}generate(){console.warn("Abstract function.")}}addNodeClass(LightingNode);let depthMaterial=null;class AnalyticLightNode extends LightingNode{constructor(e=null){super(),this.updateType=NodeUpdateType.FRAME,this.light=e,this.rtt=null,this.shadowNode=null,this.color=new Color$1,this.colorNode=uniform(this.color)}getHash(){return this.light.uuid}constructShadow(t){var r;if(null===(r=this.shadowNode)){null===depthMaterial&&(depthMaterial=t.createNodeMaterial("MeshBasicNodeMaterial"));var i=this.light.shadow,t=t.getRenderTarget(i.mapSize.width,i.mapSize.height),n=new DepthTexture$1,a=(n.minFilter=NearestFilter$1,n.magFilter=NearestFilter$1,n.image.width=i.mapSize.width,n.image.height=i.mapSize.height,n.compareFunction=LessCompare$1,t.depthTexture=n,i.camera.updateProjectionMatrix(),reference("bias","float",i)),o=reference("normalBias","float",i);let e=uniform(i.matrix).mul(positionWorld.add(normalWorld.mul(o)));i=(e=e.xyz.div(e.w)).x.greaterThanEqual(0).and(e.x.lessThanEqual(1)).and(e.y.greaterThanEqual(0)).and(e.y.lessThanEqual(1)).and(e.z.lessThanEqual(1));e=vec3(e.x,e.y.oneMinus(),e.z.add(a).mul(2).sub(1));o=n,a=e.xy,n=e.z,r=texture(o,a).compare(n),this.rtt=t,this.colorNode=this.colorNode.mul(i.mix(1,r)),this.shadowNode=r,this.updateBeforeType=NodeUpdateType.RENDER}}construct(e){this.light.castShadow&&this.constructShadow(e)}updateShadow(e){var{rtt:t,light:r}=this,{renderer:e,scene:i}=e;i.overrideMaterial=depthMaterial,t.setSize(r.shadow.mapSize.width,r.shadow.mapSize.height),r.shadow.updateMatrices(r),e.setRenderTarget(t),e.render(i,r.shadow.camera),e.setRenderTarget(null),i.overrideMaterial=null}updateBefore(e){var t=this["light"];t.castShadow&&this.updateShadow(e)}update(){var e=this["light"];this.color.copy(e.color).multiplyScalar(e.intensity)}}addNodeClass(AnalyticLightNode);const LightNodes=new WeakMap,sortLights=e=>e.sort((e,t)=>e.id-t.id);class LightsNode extends Node$2{constructor(e=[]){super("vec3"),this.lightNodes=e,this._hash=null}get hasLight(){return 0<this.lightNodes.length}construct(e){for(const t of this.lightNodes)t.build(e)}getHash(t){if(null===this._hash){let e="";for(const r of this.lightNodes)e+=r.getHash(t)+" ";this._hash=e}return this._hash}getLightNodeByHash(e){for(const t of this.lightNodes)if(t.light.uuid===e)return t;return null}fromLights(e=[]){var t,r=[];for(const i of e=sortLights(e)){let e=this.getLightNodeByHash(i.uuid);null===e&&(t=i.constructor,t=LightNodes.has(t)?LightNodes.get(t):AnalyticLightNode,e=nodeObject(new t(i))),r.push(e)}return this.lightNodes=r,this._hash=null,this}}const lights=e=>nodeObject((new LightsNode).fromLights(e)),lightsWithoutWrap=nodeProxy(LightsNode);function addLightNode(e,t){if(LightNodes.has(e))throw new Error("Redefinition of light node "+t.name);if("function"!=typeof e||!e.name)throw new Error(`Light ${e.name} is not a class`);if("function"!=typeof t||!t.name)throw new Error(`Light node ${t.name} is not a class`);LightNodes.set(e,t)}class AONode extends LightingNode{constructor(e=null){super(),this.aoNode=e}construct(e){var t=this.aoNode.x.sub(1).mul(1).add(1);e.context.ambientOcclusion.mulAssign(t)}}addNodeClass(AONode);class EquirectUVNode extends TempNode{constructor(e=positionWorldDirection){super("vec2"),this.dirNode=e}construct(){var e=this.dirNode,t=e.z.atan2(e.x).mul(1/(2*Math.PI)).add(.5),e=e.y.negate().clamp(-1,1).asin().mul(1/Math.PI).add(.5);return vec2(t,e)}}const equirectUV=nodeProxy(EquirectUVNode);addNodeClass(EquirectUVNode);class MaxMipLevelNode extends UniformNode{constructor(e){super(0),this.textureNode=e,this.updateType=NodeUpdateType.FRAME}get texture(){return this.textureNode.value}update(){var e=this.texture,t=e.images,t=t&&0<t.length?t[0]&&t[0].image||t[0]:e.image;t&&void 0!==t.width&&({width:e,height:t}=t,this.value=Math.log2(Math.max(e,t)))}}const maxMipLevel=nodeProxy(MaxMipLevelNode);addNodeClass(MaxMipLevelNode);class SpecularMIPLevelNode extends Node$2{constructor(e,t=null){super("float"),this.textureNode=e,this.roughnessNode=t}construct(){var{textureNode:e,roughnessNode:t}=this,e=maxMipLevel(e),t=t.mul(t).mul(Math.PI).div(t.add(1));return e.add(t.log2()).clamp(0,e)}}const specularMIPLevel=nodeProxy(SpecularMIPLevelNode),envNodeCache=(addNodeClass(SpecularMIPLevelNode),new WeakMap);class EnvironmentNode extends LightingNode{constructor(e=null){super(),this.envNode=e}construct(t){let r=this.envNode;var e=t.getNodeProperties(this);if(r.isTextureNode&&!0!==r.value.isCubeTexture){let e=envNodeCache.get(r.value);void 0===e&&(i=r.value,n=t.renderer,n=t.getCubeRenderTarget(512).fromEquirectangularTexture(n,i),e=cubeTexture(n.texture),envNodeCache.set(r.value,e)),r=e}var i=reference("envMapIntensity","float",t.material),n=context(r,createRadianceContext(roughness,transformedNormalView)).mul(i),a=context(r,createIrradianceContext(transformedNormalWorld)).mul(Math.PI).mul(i),n=cache(n),t=(t.context.radiance.addAssign(n),t.context.iblIrradiance.addAssign(a),t.context.lightingModel.clearcoatRadiance);t&&(i=context(r,createRadianceContext(clearcoatRoughness,transformedClearcoatNormalView)).mul(i),i=cache(i),t.addAssign(i)),e.radiance=n,e.irradiance=a}}const createRadianceContext=(r,i)=>{let n=null,a=null;return{getUVNode:e=>{let t=null;return null===n&&(n=positionViewDirection.negate().reflect(i),n=(n=r.mul(r).mix(n,i).normalize()).transformDirection(cameraViewMatrix)),e.isCubeTextureNode?t=n:e.isTextureNode&&(null===a&&(a=equirectUV(n)),t=a),t},getSamplerLevelNode:()=>r,getMIPLevelAlgorithmNode:(e,t)=>specularMIPLevel(e,t)}},createIrradianceContext=r=>{let i=null;return{getUVNode:e=>{let t=null;return e.isCubeTextureNode?t=r:e.isTextureNode&&(null===i&&(i=equirectUV(r),i=vec2(i.x,i.y.oneMinus())),t=i),t},getSamplerLevelNode:()=>float(1),getMIPLevelAlgorithmNode:(e,t)=>specularMIPLevel(e,t)}},NodeMaterials=(addNodeClass(EnvironmentNode),new Map);class NodeMaterial extends ShaderMaterial$1{constructor(){super(),this.isNodeMaterial=!0,this.type=this.constructor.name,this.forceSinglePass=!1,this.unlit=this.constructor===NodeMaterial.prototype.constructor,this.fog=!0,this.lights=!0,this.normals=!0,this.colorSpace=!0,this.lightsNode=null,this.envNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.outputNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+getCacheKey(this)}build(e){this.construct(e)}construct(e){e.addStack(),e.stack.outputNode=this.constructPosition(e),e.addFlow("vertex",e.removeStack()),e.addStack();let t;var r;!1===this.unlit?(!0===this.normals&&this.constructNormal(e),this.constructDiffuseColor(e),this.constructVariants(e),r=this.constructLighting(e),t=this.constructOutput(e,vec4(r,diffuseColor.a)),e.stack.assign(output,t),null!==this.outputNode&&(t=this.outputNode)):t=this.constructOutput(e,this.outputNode||vec4(0,0,0,1)),e.stack.outputNode=t,e.addFlow("fragment",e.removeStack())}constructPosition(e){var t=e.object,r=t.geometry;return e.addStack(),(r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color)&&e.stack.add(morph(t)),!0===t.isSkinnedMesh&&e.stack.add(skinning(t)),t.instanceMatrix&&!0===t.instanceMatrix.isInstancedBufferAttribute&&!0===e.isAvailable("instance")&&e.stack.add(instance(t)),null!==this.positionNode&&e.stack.assign(positionLocal,this.positionNode),e.context.vertex=e.removeStack(),this.vertexNode||modelViewProjection()}constructDiffuseColor({stack:e,geometry:t}){let r=this.colorNode?vec4(this.colorNode):materialColor;!0===this.vertexColors&&t.hasAttribute("color")&&(r=vec4(r.xyz.mul(attribute("color")),r.a)),e.assign(diffuseColor,r);var t=this.opacityNode?float(this.opacityNode):materialOpacity;e.assign(diffuseColor.a,diffuseColor.a.mul(t)),(null!==this.alphaTestNode||0<this.alphaTest)&&(t=null!==this.alphaTestNode?float(this.alphaTestNode):materialAlphaTest,e.add(diffuseColor.a.lessThanEqual(t).discard()))}constructVariants(){}constructNormal({stack:e}){var t,r;!0===this.flatShading?(t=dFdx(positionView),r=dFdy(positionView.negate()),t=t.cross(r).normalize(),e.assign(transformedNormalView,t)):(r=this.normalNode?vec3(this.normalNode):materialNormal,e.assign(transformedNormalView,r))}getEnvNode(e){let t=null;return this.envNode?t=this.envNode:this.envMap?t=(this.envMap.isCubeTexture?cubeTexture:texture)(this.envMap):e.environmentNode&&(t=e.environmentNode),t}constructLights(e){var t=this.getEnvNode(e),r=[];t&&r.push(new EnvironmentNode(t)),e.material.aoMap&&r.push(new AONode(texture(e.material.aoMap)));let i=this.lightsNode||e.lightsNode;return i=0<r.length?lightsWithoutWrap([...i.lightNodes,...r]):i}constructLightingModel(){}constructLighting(e){var t=e["material"],{backdropNode:r,backdropAlphaNode:i,emissiveNode:n}=this,a=!0===this.lights||null!==this.lightsNode?this.constructLights(e):null;let o=diffuseColor.rgb;return a&&!1!==a.hasLight?(e=this.constructLightingModel(e),o=a.lightingContext(e,r,i)):null!==r&&(o=vec3(null!==i?mix(o,r,i):r)),o=n&&!0===n.isNode||t.emissive&&!0===t.emissive.isColor?o.add(n?vec3(n):materialEmissive):o}constructOutput(t,r){var i=t.renderer,e=t.toneMappingNode;if(e&&(r=vec4(e.context({color:r.rgb}),r.a)),!0===this.fog&&(e=t.fogNode)&&(r=vec4(e.mixAssign(r.rgb),r.a)),!0===this.colorSpace){t=i.getRenderTarget();let e;(e=null!==t?t.texture.colorSpace:i.outputColorSpace)!==LinearSRGBColorSpace$1&&e!==NoColorSpace$1&&(r=r.linearToColorSpace(e))}return r}setDefaultValues(e){for(const i in e){var t=e[i];void 0===this[i]&&(this[i]=t)&&t.clone&&(this[i]=t.clone())}Object.assign(this.defines,e.defines);var r=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const n in r)void 0===Object.getOwnPropertyDescriptor(this.constructor.prototype,n)&&void 0!==r[n].get&&Object.defineProperty(this.constructor.prototype,n,r[n])}toJSON(e){var t,r,i,n=void 0===e||"string"==typeof e,a=Material$1.prototype.toJSON.call(this,e=n?{textures:{},images:{},nodes:{}}:e),o=getNodeChildren(this);a.inputNodes={};for({property:t,childNode:r}of o)a.inputNodes[t]=r.toJSON(e).uuid;function s(e){var t=[];for(const i in e){var r=e[i];delete r.metadata,t.push(r)}return t}return n&&(o=s(e.textures),n=s(e.images),i=s(e.nodes),0<o.length&&(a.textures=o),0<n.length&&(a.images=n),0<i.length)&&(a.nodes=i),a}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.positionNode=e.positionNode,this.outputNode=e.outputNode,this.vertexNode=e.vertexNode,super.copy(e)}static fromMaterial(e){if(!0===e.isNodeMaterial)return e;var t=createNodeMaterialFromType(e.type.replace("Material","NodeMaterial"));if(void 0===t)throw new Error(`NodeMaterial: Material "${e.type}" is not compatible.`);for(const r in e)t[r]=e[r];return t}}function addNodeMaterial(e){if("function"!=typeof e||!e.name)throw new Error(`Node material ${e.name} is not a class`);if(NodeMaterials.has(e.name))throw new Error("Redefinition of node material "+e.name);NodeMaterials.set(e.name,e)}function createNodeMaterialFromType(e){e=NodeMaterials.get(e);if(void 0!==e)return new e}addNodeMaterial(NodeMaterial);class CondNode extends Node$2{constructor(e,t,r=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=r}getNodeType(e){var t=this.ifNode.getNodeType(e);if(null!==this.elseNode){var r=this.elseNode.getNodeType(e);if(e.getTypeLength(r)>e.getTypeLength(t))return r}return t}generate(e){var t=this.getNodeType(e),r={tempWrite:!1},{ifNode:i,elseNode:n}=this,i="void"!==i.getNodeType(e)||n&&"void"!==n.getNodeType(e),a=i?property(t).build(e):"",o=context(this.condNode).build(e,"bool"),o=(e.addFlowCode(`
${e.tab}if ( ${o} ) {

`).addFlowTab(),context(this.ifNode,r).build(e,t)),o=i?a+" = "+o+";":o;return e.removeFlowTab().addFlowCode(e.tab+"\t"+o+"\n\n"+e.tab+"}"),null!==n?(e.addFlowCode(" else {\n\n").addFlowTab(),i=context(n,r).build(e,t),i=a?a+" = "+i+";":i,e.removeFlowTab().addFlowCode(e.tab+"\t"+i+"\n\n"+e.tab+"}\n\n")):e.addFlowCode("\n\n"),a}}const cond=nodeProxy(CondNode);addNodeElement("cond",cond),addNodeClass(CondNode);class LoopNode extends Node$2{constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode("i".charCodeAt()+e)}getProperties(e){var t=e.getNodeProperties(this);if(void 0===t.stackNode){var r={};for(let e=0,t=this.params.length-1;e<t;e++){var i=this.getVarName(e);r[i]=expression(i,"int")}t.returnsNode=this.params[this.params.length-1](r,e.addStack(),e),t.stackNode=e.removeStack()}return t}getNodeType(e){var t=this.getProperties(e)["returnsNode"];return t?t.getNodeType(e):"void"}construct(e){this.getProperties(e)}generate(o){var e=this.getProperties(o),s=this.params,t=e.stackNode,e=e.returnsNode?e.returnsNode.build(o):"";for(let a=0,e=s.length-1;a<e;a++){var l=s[a],c=this.getVarName(a);let e=null,t=null,r=null;l.isNode?(e="0",t=l.generate(o,"int"),r="forward"):(e=l.start,t=l.end,r=l.direction,"number"==typeof e?e=e.toString():e&&e.isNode&&(e=e.generate(o,"int")),"number"==typeof t?t=t.toString():t&&t.isNode&&(t=t.generate(o,"int")),void 0!==e&&void 0===t?(e+=" - 1",t="0",r="backwards"):void 0!==t&&void 0===e&&(e="0",r="forward"),void 0===r&&(r=Number(e)>Number(t)?"backwards":"forward"));var l={start:e,end:t,direction:r},d=l.start,h=l.end,u="";let i="",n="";u+=o.getVar("int",c)+" = "+d,"backwards"===l.direction?(i+=c+" >= "+h,n+=c+" --"):(i+=c+" < "+h,n+=c+" ++");d=`for ( ${u}; ${i}; ${n} )`;o.addFlowCode((0===a?"\n":"")+o.tab+d+" {\n\n").addFlowTab()}t=context(t,{tempWrite:!1}).build(o,"void");o.removeFlowTab().addFlowCode("\n"+o.tab+t);for(let e=0,t=this.params.length-1;e<t;e++)o.addFlowCode((0===e?"":o.tab)+"}\n\n").removeFlowTab();return o.addFlowTab(),e}}const loop=(...e)=>nodeObject(new LoopNode(nodeArray(e,"int")));addNodeElement("loop",(e,...t)=>bypass(e,loop(...t))),addNodeClass(LoopNode);class StackNode extends Node$2{constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}add(e){return this.nodes.push(bypass(expression(),e)),this}if(e,t){t=shader(t);return this._currentCond=cond(e,t),this.add(this._currentCond)}elseif(e,t){t=shader(t),e=cond(e,t);return this._currentCond.elseNode=e,this._currentCond=e,this}else(e){return this._currentCond.elseNode=shader(e),this}assign(e,t){return this.add(assign(e,t))}loop(...e){return this.add(loop(...e))}build(e,...t){for(const r of this.nodes)r.build(e,"void");return this.outputNode?this.outputNode.build(e,...t):super.build(e,...t)}}const stack=nodeProxy(StackNode),typeFromLength=(addNodeClass(StackNode),new Map([[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]])),typeFromArray=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),isNonPaddingElementArray=new Set([Int32Array,Uint32Array,Float32Array]),toFloat=e=>(e=Number(e))+(e%1?"":".0");class NodeBuilder{constructor(e,t,r,i=null){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=r,this.scene=i,this.nodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.hashNodes={},this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.toneMappingNode=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:[]},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.codes={vertex:[],fragment:[],compute:[]},this.bindings={vertex:[],fragment:[],compute:[]},this.bindingsOffset={vertex:0,fragment:0,compute:0},this.bindingsArray=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.vars={vertex:[],fragment:[],compute:[]},this.flow={code:""},this.chaining=[],this.stack=stack(),this.tab="\t",this.context={keywords:new NodeKeywords,material:this.material,getMIPLevelAlgorithmNode:(e,t)=>t.mul(maxMipLevel(e))},this.cache=new NodeCache,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null}includes(e){return this.nodes.includes(e)}getBindings(){let e=this.bindingsArray;var t;return null===e&&(t=this.bindings,this.bindingsArray=e=null!==this.material?[...t.vertex,...t.fragment]:t.compute),e}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){var t,r;-1===this.nodes.indexOf(e)&&(t=e.getUpdateType(),r=e.getUpdateBeforeType(),t!==NodeUpdateType.NONE&&this.updateNodes.push(e),r!==NodeUpdateType.NONE&&this.updateBeforeNodes.push(e),this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}get currentNode(){return this.chaining[this.chaining.length-1]}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}setCache(e){this.cache=e}getCache(){return this.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}getTexture(){console.warn("Abstract function.")}getTextureLevel(){console.warn("Abstract function.")}getConst(e,t=null){if(null===t&&("float"===e||"int"===e||"uint"===e?t=0:"bool"===e?t=!1:"color"===e?t=new Color$1:"vec2"===e?t=new Vector2$1:"vec3"===e?t=new Vector3$1:"vec4"===e&&(t=new Vector4$1)),"float"===e)return toFloat(t);if("int"===e)return""+Math.round(t);if("uint"===e)return 0<=t?Math.round(t)+"u":"0u";if("bool"===e)return t?"true":"false";if("color"===e)return`${this.getType("vec3")}( ${toFloat(t.r)}, ${toFloat(t.g)}, ${toFloat(t.b)} )`;var r=this.getTypeLength(e);const i=this.getComponentType(e);var n=e=>this.getConst(i,e);if(2===r)return`${this.getType(e)}( ${n(t.x)}, ${n(t.y)} )`;if(3===r)return`${this.getType(e)}( ${n(t.x)}, ${n(t.y)}, ${n(t.z)} )`;if(4===r)return`${this.getType(e)}( ${n(t.x)}, ${n(t.y)}, ${n(t.z)}, ${n(t.w)} )`;if(4<r&&t&&(t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(n).join(", ")} )`;if(4<r)return this.getType(e)+"()";throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e}generateMethod(e){return e}hasGeometryAttribute(e){return this.geometry&&void 0!==this.geometry.getAttribute(e)}getAttribute(e,t){var r=this.attributes;for(const i of r)if(i.name===e)return i;const i=new NodeAttribute(e,t);return r.push(i),i}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return"void"===e||"property"===e||"sampler"===e||"texture"===e||"cubeTexture"===e}needsColorSpaceToLinear(){return!1}getTextureEncodingFromMap(e){return console.warn("THREE.NodeBuilder: Method .getTextureEncodingFromMap replaced by .getTextureColorSpaceFromMap in r152+."),this.getTextureColorSpaceFromMap(e)===SRGBColorSpace$1?sRGBEncoding$1:LinearEncoding$1}getTextureColorSpaceFromMap(e){let t;return t=e&&e.isTexture?e.colorSpace:e&&e.isWebGLRenderTarget?e.texture.colorSpace:NoColorSpace$1}getComponentType(e){return"float"===(e=this.getVectorType(e))||"bool"===e||"int"===e||"uint"===e?e:null===(e=/(b|i|u|)(vec|mat)([2-4])/.exec(e))?null:"b"===e[1]?"bool":"i"===e[1]?"int":"u"===e[1]?"uint":"float"}getVectorType(e){return"color"===e?"vec3":"texture"===e?"vec4":e}getTypeFromLength(e,t="float"){return 1===e?t:(e=typeFromLength.get(e),("float"===t?"":t[0])+e)}getTypeFromArray(e){return typeFromArray.get(e.constructor)}getTypeFromAttribute(e){let t=e;var r=(t=e.isInterleavedBufferAttribute?e.data:t).array,i=!isNonPaddingElementArray.has(r.constructor)&&t.stride||e.itemSize,n=e.normalized;let a;return e instanceof Float16BufferAttribute$1||!0===n||(a=this.getTypeFromArray(r)),this.getTypeFromLength(i,a)}getTypeLength(e){var t=this.getVectorType(e),r=/vec([2-4])/.exec(t);return null!==r?Number(r[1]):"float"===t||"bool"===t||"int"===t||"uint"===t?1:!0===/mat3/.test(e)?9:!0===/mat4/.test(e)?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){var t=this.getComponentType(e);return"int"===t||"uint"===t?e:this.changeComponentType(e,"int")}addStack(){return this.stack=stack(this.stack),this.stack}removeStack(){var e=this.stack;return this.stack=e.parent,e}getDataFromNode(e,t=this.shaderStage){var r=e.isGlobal(this)?this.globalCache:this.cache;let i=r.getNodeData(e);return void 0===i&&(i={vertex:{},fragment:{},compute:{}},r.setNodeData(e,i)),null!==t?i[t]:i}getNodeProperties(e,t=this.shaderStage){e=this.getDataFromNode(e,t);return e.properties||(e.properties={outputNode:null})}getBufferAttributeFromNode(e,t){var r,i=this.getDataFromNode(e);let n=i.bufferAttribute;return void 0===n&&(r=this.uniforms.index++,n=new NodeAttribute("nodeAttribute"+r,t,e),this.bufferAttributes.push(n),i.bufferAttribute=n),n}getUniformFromNode(e,t,r=this.shaderStage,i=null){var n,a=this.getDataFromNode(e,r);let o=a.uniform;return void 0===o&&(n=this.uniforms.index++,o=new NodeUniform(i||"nodeUniform"+n,t,e),this.uniforms[r].push(o),a.uniform=o),o}getVarFromNode(e,t,r=this.shaderStage){var i,e=this.getDataFromNode(e,r);let n=e.variable;return void 0===n&&(i=(r=this.vars[r]).length,n=new NodeVar("nodeVar"+i,t),r.push(n),e.variable=n),n}getVaryingFromNode(e,t){var r,i,e=this.getDataFromNode(e,null);let n=e.varying;return void 0===n&&(i=(r=this.varyings).length,n=new NodeVarying("nodeVarying"+i,t),r.push(n),e.varying=n),n}getCodeFromNode(e,t,r=this.shaderStage){var i,e=this.getDataFromNode(e);let n=e.code;return void 0===n&&(i=(r=this.codes[r]).length,n=new NodeCode("nodeCode"+i,t),r.push(n),e.code=n),n}addLineFlowCode(e){return""!==e&&(e=this.tab+e,/;\s*$/.test(e)||(e+=";\n"),this.flow.code+=e),this}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="\t",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){var t=e.getNodeType(this),t=this.flowChildNode(e,t);return this.flowsData.set(e,t),t}flowChildNode(e,t=null){var r=this.flow,i={code:""};return(this.flow=i).result=e.build(this,t),this.flow=r,i}flowNodeFromShaderStage(e,t,r=null,i=null){var n=this.shaderStage,t=(this.setShaderStage(e),this.flowChildNode(t,r));return null!==i&&(t.code+=`${this.tab+i} = ${t.result};\n`),this.flowCode[e]=this.flowCode[e]+t.code,this.setShaderStage(n),t}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(e,t){return e+" "+t}getVars(e){let t="";for(const r of this.vars[e])t+=this.getVar(r.type,r.name)+"; ";return t}getUniforms(){console.warn("Abstract function.")}getCodes(e){let t="";for(const r of this.codes[e])t+=r.code+"\n";return t}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}build(){for(const e of defaultBuildStages){this.setBuildStage(e),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const t of shaderStages){this.setShaderStage(t);for(const r of this.flowNodes[t])"generate"===e?this.flowNode(r):r.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this}createNodeMaterial(e){return createNodeMaterialFromType(e)}format(e,t,r){var i,n;return(t=this.getVectorType(t))===(r=this.getVectorType(r))||null===r||this.isReference(r)||(i=this.getTypeLength(t),n=this.getTypeLength(r),4<i)||4<n||0===n?e:i===n?this.getType(r)+`( ${e} )`:n<i?this.format(e+"."+"xyz".slice(0,n),this.getTypeFromLength(n,this.getComponentType(t)),r):4===n?`${this.getType(r)}( ${this.format(e,t,"vec3")}, 1.0 )`:2===i?`${this.getType(r)}( ${this.format(e,t,"vec2")}, 0.0 )`:this.getType(r)+`( ${e} )`}getSignature(){return`// Three.js r${REVISION$1} - NodeMaterial System
`}}class NodeFrame{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.startTime=null,this.frameMap=new WeakMap,this.frameBeforeMap=new WeakMap,this.renderMap=new WeakMap,this.renderBeforeMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}updateBeforeNode(e){var t=e.getUpdateBeforeType();t===NodeUpdateType.FRAME?this.frameBeforeMap.get(e)!==this.frameId&&(this.frameBeforeMap.set(e,this.frameId),e.updateBefore(this)):t===NodeUpdateType.RENDER?this.renderBeforeMap.get(e)===this.renderId&&this.frameBeforeMap.get(e)===this.frameId||(this.renderBeforeMap.set(e,this.renderId),this.frameBeforeMap.set(e,this.frameId),e.updateBefore(this)):t===NodeUpdateType.OBJECT&&e.updateBefore(this)}updateNode(e){var t=e.getUpdateType();t===NodeUpdateType.FRAME?this.frameMap.get(e)!==this.frameId&&(this.frameMap.set(e,this.frameId),e.update(this)):t===NodeUpdateType.RENDER?this.renderMap.get(e)===this.renderId&&this.frameMap.get(e)===this.frameId||(this.renderMap.set(e,this.renderId),this.frameMap.set(e,this.frameId),e.update(this)):t===NodeUpdateType.OBJECT&&e.update(this)}update(){this.frameId++,void 0===this.lastTime&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class NodeFunctionInput{constructor(e,t,r=null,i="",n=!1){this.type=e,this.name=t,this.count=r,this.qualifier=i,this.isConst=n}}NodeFunctionInput.isNodeFunctionInput=!0;let discardExpression;class DiscardNode extends CondNode{constructor(e){super(e,discardExpression=discardExpression||expression("discard"))}}const discard=nodeProxy(DiscardNode);addNodeElement("discard",discard),addNodeClass(DiscardNode);class MatcapUVNode extends TempNode{constructor(){super("vec2")}construct(){var e=vec3(positionViewDirection.z,0,positionViewDirection.x.negate()).normalize(),t=positionViewDirection.cross(e);return vec2(e.dot(transformedNormalView),t.dot(transformedNormalView)).mul(.495).add(.5)}}const matcapUV=nodeImmutable(MatcapUVNode);addNodeClass(MatcapUVNode);class TimerNode extends UniformNode{constructor(e=TimerNode.LOCAL,t=1,r=0){super(r),this.scope=e,this.scale=t,this.updateType=NodeUpdateType.FRAME}update(e){var t=this.scope,r=this.scale;t===TimerNode.LOCAL?this.value+=e.deltaTime*r:t===TimerNode.DELTA?this.value=e.deltaTime*r:t===TimerNode.FRAME?this.value=e.frameId:this.value=e.time*r}serialize(e){super.serialize(e),e.scope=this.scope,e.scale=this.scale}deserialize(e){super.deserialize(e),this.scope=e.scope,this.scale=e.scale}}TimerNode.LOCAL="local",TimerNode.GLOBAL="global",TimerNode.DELTA="delta",TimerNode.FRAME="frame";const timerLocal=(e,t=0)=>nodeObject(new TimerNode(TimerNode.LOCAL,e,t)),timerGlobal=(e,t=0)=>nodeObject(new TimerNode(TimerNode.GLOBAL,e,t)),timerDelta=(e,t=0)=>nodeObject(new TimerNode(TimerNode.DELTA,e,t)),frameId=nodeImmutable(TimerNode,TimerNode.FRAME);addNodeClass(TimerNode);class OscNode extends Node$2{constructor(e=OscNode.SINE,t=timerLocal()){super(),this.method=e,this.timeNode=t}getNodeType(e){return this.timeNode.getNodeType(e)}construct(){var e=this.method,t=nodeObject(this.timeNode);let r=null;return e===OscNode.SINE?r=t.add(.75).mul(2*Math.PI).sin().mul(.5).add(.5):e===OscNode.SQUARE?r=t.fract().round():e===OscNode.TRIANGLE?r=t.add(.5).fract().mul(2).sub(1).abs():e===OscNode.SAWTOOTH&&(r=t.fract()),r}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}OscNode.SINE="sine",OscNode.SQUARE="square",OscNode.TRIANGLE="triangle",OscNode.SAWTOOTH="sawtooth";const oscSine=nodeProxy(OscNode,OscNode.SINE),oscSquare=nodeProxy(OscNode,OscNode.SQUARE),oscTriangle=nodeProxy(OscNode,OscNode.TRIANGLE),oscSawtooth=nodeProxy(OscNode,OscNode.SAWTOOTH);addNodeClass(OscNode);class PackingNode extends TempNode{constructor(e,t){super(),this.scope=e,this.node=t}getNodeType(e){return this.node.getNodeType(e)}construct(){var{scope:e,node:t}=this;let r=null;return e===PackingNode.DIRECTION_TO_COLOR?r=t.mul(.5).add(.5):e===PackingNode.COLOR_TO_DIRECTION&&(r=t.mul(2).sub(1)),r}}PackingNode.DIRECTION_TO_COLOR="directionToColor",PackingNode.COLOR_TO_DIRECTION="colorToDirection";const directionToColor=nodeProxy(PackingNode,PackingNode.DIRECTION_TO_COLOR),colorToDirection=nodeProxy(PackingNode,PackingNode.COLOR_TO_DIRECTION);addNodeElement("directionToColor",directionToColor),addNodeElement("colorToDirection",colorToDirection),addNodeClass(PackingNode);class RemapNode extends Node$2{constructor(e,t,r,i,n){super(),this.node=e,this.inLowNode=t,this.inHighNode=r,this.outLowNode=i,this.outHighNode=n,this.doClamp=!0}construct(){var{node:e,inLowNode:t,inHighNode:r,outLowNode:i,outHighNode:n,doClamp:a}=this;let o=e.sub(t).div(r.sub(t));return(o=!0===a?o.clamp():o).mul(n.sub(i)).add(i)}}const remap=nodeProxy(RemapNode,null,null,{doClamp:!1}),remapClamp=nodeProxy(RemapNode);addNodeElement("remap",remap),addNodeElement("remapClamp",remapClamp),addNodeClass(RemapNode);class RotateUVNode extends TempNode{constructor(e,t,r=vec2(.5)){super("vec2"),this.uvNode=e,this.rotationNode=t,this.centerNode=r}construct(){var{uvNode:e,rotationNode:t,centerNode:r}=this,i=t.cos(),t=t.sin(),e=e.sub(r);return vec2(vec2(i,t).dot(e),vec2(t.negate(),i).dot(e)).add(r)}}const rotateUV=nodeProxy(RotateUVNode);addNodeElement("rotateUV",rotateUV),addNodeClass(RotateUVNode);class SpriteSheetUVNode extends Node$2{constructor(e,t=uv(),r=float(0)){super("vec2"),this.countNode=e,this.uvNode=t,this.frameNode=r}construct(){var{frameNode:e,uvNode:t,countNode:r}=this,{width:i,height:n}=r,e=e.mod(i.mul(n)).floor(),a=e.mod(i),n=n.sub(e.add(1).div(i).ceil()),e=r.reciprocal(),i=vec2(a,n);return t.add(i).mul(e)}}const spritesheetUV=nodeProxy(SpriteSheetUVNode);addNodeClass(SpriteSheetUVNode);class TriplanarTexturesNode extends Node$2{constructor(e,t=null,r=null,i=float(1),n=positionWorld,a=normalWorld){super("vec4"),this.textureXNode=e,this.textureYNode=t,this.textureZNode=r,this.scaleNode=i,this.positionNode=n,this.normalNode=a}construct(){var{textureXNode:e,textureYNode:t,textureZNode:r,scaleNode:i,positionNode:n,normalNode:a}=this;let o=a.abs().normalize();o=o.div(o.dot(vec3(1)));var a=n.yz.mul(i),s=n.zx.mul(i),n=n.xy.mul(i),i=e.value,e=null!==t?t.value:i,t=null!==r?r.value:i,r=texture(i,a).mul(o.x),i=texture(e,s).mul(o.y),a=texture(t,n).mul(o.z);return add(r,i,a)}}const triplanarTextures=nodeProxy(TriplanarTexturesNode),triplanarTexture=(...e)=>triplanarTextures(...e),bC=(addNodeElement("triplanarTexture",triplanarTexture),addNodeClass(TriplanarTexturesNode),1/6),w0=e=>mul(bC,mul(e,mul(e,e.negate().add(3)).sub(3)).add(1)),w1=e=>mul(bC,mul(e,mul(e,mul(3,e).sub(6))).add(4)),w2=e=>mul(bC,mul(e,mul(e,mul(-3,e).add(3)).add(3)).add(1)),w3=e=>mul(bC,pow(e,3)),g0=e=>w0(e).add(w1(e)),g1=e=>w2(e).add(w3(e)),h0=e=>add(-1,w1(e).div(w0(e).add(w1(e)))),h1=e=>add(1,w3(e).div(w2(e).add(w3(e)))),bicubic=(e,t,r)=>{var i=e.uvNode,i=mul(i,t.zw).add(.5),n=floor(i),i=fract(i),a=g0(i.x),o=g1(i.x),s=h0(i.x),l=h1(i.x),c=h0(i.y),d=h1(i.y),h=vec2(n.x.add(s),n.y.add(c)).sub(.5).mul(t.xy),c=vec2(n.x.add(l),n.y.add(c)).sub(.5).mul(t.xy),s=vec2(n.x.add(s),n.y.add(d)).sub(.5).mul(t.xy),l=vec2(n.x.add(l),n.y.add(d)).sub(.5).mul(t.xy),n=g0(i.y).mul(add(a.mul(e.uv(h).level(r)),o.mul(e.uv(c).level(r)))),d=g1(i.y).mul(add(a.mul(e.uv(s).level(r)),o.mul(e.uv(l).level(r))));return n.add(d)},textureBicubicMethod=(e,t)=>{var r=vec2(e.size(int(t))),i=vec2(e.size(int(t.add(1)))),n=div(1,r),a=div(1,i),n=bicubic(e,vec4(n,r),floor(t)),r=bicubic(e,vec4(a,i),ceil(t));return fract(t).mix(n,r)};class TextureBicubicNode extends TempNode{constructor(e,t=float(3)){super("vec4"),this.textureNode=e,this.blurNode=t}construct(){return textureBicubicMethod(this.textureNode,this.blurNode)}}const textureBicubic=nodeProxy(TextureBicubicNode);addNodeElement("bicubic",textureBicubic),addNodeClass(TextureBicubicNode);class PointUVNode extends Node$2{constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}const pointUV=nodeImmutable(PointUVNode);addNodeClass(PointUVNode);class SceneNode extends Node$2{constructor(e=SceneNode.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}construct(e){var t=this.scope,e=(null!==this.scene?this:e).scene;let r;return t===SceneNode.BACKGROUND_BLURRINESS?r=reference("backgroundBlurriness","float",e):t===SceneNode.BACKGROUND_INTENSITY?r=reference("backgroundIntensity","float",e):console.error("THREE.SceneNode: Unknown scope:",t),r}}SceneNode.BACKGROUND_BLURRINESS="backgroundBlurriness",SceneNode.BACKGROUND_INTENSITY="backgroundIntensity";const backgroundBlurriness=nodeImmutable(SceneNode,SceneNode.BACKGROUND_BLURRINESS),backgroundIntensity=nodeImmutable(SceneNode,SceneNode.BACKGROUND_INTENSITY);addNodeClass(SceneNode);class StorageBufferNode extends BufferNode{constructor(e,t,r=0){super(e,t,r),this.isStorageBufferNode=!0}getInputType(){return"storageBuffer"}}const storage=(e,t,r)=>nodeObject(new StorageBufferNode(e,t,r));addNodeClass(StorageBufferNode);class UserDataNode extends ReferenceNode{constructor(e,t,r=null){super(e,t,r),this.userData=r}update(e){this.object=(null!==this.userData?this:e.object).userData,super.update(e)}}const userData=(e,t,r)=>nodeObject(new UserDataNode(e,t,r)),BurnNode=(addNodeClass(UserDataNode),tslFn(({base:t,blend:r})=>{var e=e=>r[e].lessThan(EPSILON).cond(r[e],t[e].oneMinus().div(r[e]).oneMinus().max(0));return vec3(e("x"),e("y"),e("z"))})),DodgeNode=tslFn(({base:t,blend:r})=>{var e=e=>r[e].equal(1).cond(r[e],t[e].div(r[e].oneMinus()).max(0));return vec3(e("x"),e("y"),e("z"))}),ScreenNode=tslFn(({base:t,blend:r})=>{var e=e=>t[e].oneMinus().mul(r[e].oneMinus()).oneMinus();return vec3(e("x"),e("y"),e("z"))}),OverlayNode=tslFn(({base:t,blend:r})=>{var e=e=>t[e].lessThan(.5).cond(t[e].mul(r[e],2),t[e].oneMinus().mul(r[e].oneMinus()).oneMinus());return vec3(e("x"),e("y"),e("z"))});class BlendModeNode extends TempNode{constructor(e,t,r){super(),this.blendMode=e,this.baseNode=t,this.blendNode=r}construct(){var{blendMode:e,baseNode:t,blendNode:r}=this,t={base:t,blend:r};let i=null;return e===BlendModeNode.BURN?i=BurnNode(t):e===BlendModeNode.DODGE?i=DodgeNode(t):e===BlendModeNode.SCREEN?i=ScreenNode(t):e===BlendModeNode.OVERLAY&&(i=OverlayNode(t)),i}}BlendModeNode.BURN="burn",BlendModeNode.DODGE="dodge",BlendModeNode.SCREEN="screen",BlendModeNode.OVERLAY="overlay";const burn=nodeProxy(BlendModeNode,BlendModeNode.BURN),dodge=nodeProxy(BlendModeNode,BlendModeNode.DODGE),overlay=nodeProxy(BlendModeNode,BlendModeNode.OVERLAY),screen=nodeProxy(BlendModeNode,BlendModeNode.SCREEN),saturationNode=(addNodeElement("burn",burn),addNodeElement("dodge",dodge),addNodeElement("overlay",overlay),addNodeElement("screen",screen),addNodeClass(BlendModeNode),tslFn(({color:e,adjustment:t})=>t.mix(luminance(e),e))),vibranceNode=tslFn(({color:e,adjustment:t})=>{var r=add(e.r,e.g,e.b).div(3),i=e.r.max(e.g.max(e.b)),r=i.sub(r).mul(t).mul(-3);return mix(e,i,r)}),hueNode=tslFn(({color:e,adjustment:t})=>{var r=mat3(.299,.587,.114,.595716,-.274453,-.321263,.211456,-.522591,.311135),i=mat3(1,.9563,.621,1,-.2721,-.6474,1,-1.107,1.7046),r=r.mul(e),e=r.z.atan2(r.y).add(t),t=r.yz.length();return i.mul(vec3(r.x,t.mul(e.cos()),t.mul(e.sin())))});class ColorAdjustmentNode extends TempNode{constructor(e,t,r=float(1)){super("vec3"),this.method=e,this.colorNode=t,this.adjustmentNode=r}construct(){var{method:e,colorNode:t,adjustmentNode:r}=this,t={color:t,adjustment:r};let i=null;return e===ColorAdjustmentNode.SATURATION?i=saturationNode(t):e===ColorAdjustmentNode.VIBRANCE?i=vibranceNode(t):e===ColorAdjustmentNode.HUE?i=hueNode(t):console.error(`${this.type}: Method "${this.method}" not supported!`),i}}ColorAdjustmentNode.SATURATION="saturation",ColorAdjustmentNode.VIBRANCE="vibrance",ColorAdjustmentNode.HUE="hue";const saturation=nodeProxy(ColorAdjustmentNode,ColorAdjustmentNode.SATURATION),vibrance=nodeProxy(ColorAdjustmentNode,ColorAdjustmentNode.VIBRANCE),hue=nodeProxy(ColorAdjustmentNode,ColorAdjustmentNode.HUE),lumaCoeffs=vec3(.2125,.7154,.0721),luminance=(e,t=lumaCoeffs)=>dot(e,t);addNodeElement("saturation",saturation),addNodeElement("vibrance",vibrance),addNodeElement("hue",hue),addNodeClass(ColorAdjustmentNode);class PosterizeNode extends TempNode{constructor(e,t){super(),this.sourceNode=e,this.stepsNode=t}construct(){var{sourceNode:e,stepsNode:t}=this;return e.mul(t).floor().div(t)}}const posterize=nodeProxy(PosterizeNode),LinearToneMappingNode=(addNodeElement("posterize",posterize),addNodeClass(PosterizeNode),tslFn(({color:e,exposure:t})=>e.mul(t).clamp())),ReinhardToneMappingNode=tslFn(({color:e,exposure:t})=>(e=e.mul(t)).div(e.add(1)).clamp()),OptimizedCineonToneMappingNode=tslFn(({color:e,exposure:t})=>{t=(e=(e=e.mul(t)).sub(.004).max(0)).mul(e.mul(6.2).add(.5)),e=e.mul(e.mul(6.2).add(1.7)).add(.06);return t.div(e).pow(2.2)}),RRTAndODTFit=tslFn(({color:e})=>{var t=e.mul(e.add(.0245786)).sub(90537e-9),e=e.mul(e.add(.432951).mul(.983729)).add(.238081);return t.div(e)}),ACESFilmicToneMappingNode=tslFn(({color:e,exposure:t})=>{var r=mat3(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),i=mat3(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return e=e.mul(t).div(.6),e=r.mul(e),e=RRTAndODTFit({color:e}),(e=i.mul(e)).clamp()}),toneMappingLib={[LinearToneMapping$1]:LinearToneMappingNode,[ReinhardToneMapping$1]:ReinhardToneMappingNode,[CineonToneMapping$1]:OptimizedCineonToneMappingNode,[ACESFilmicToneMapping$1]:ACESFilmicToneMappingNode};class ToneMappingNode extends TempNode{constructor(e=NoToneMapping$1,t=float(1),r=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=r}getCacheKey(){var e=super.getCacheKey();return"{toneMapping:"+this.toneMapping+",nodes:"+e+"}"}construct(e){var e=this.colorNode||e.context.color,t=this.toneMapping;if(t===NoToneMapping$1)return e;var r={exposure:this.exposureNode,color:e},i=toneMappingLib[t];let n=null;return n=i?i(r):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",t),e)}}const toneMapping=(e,t,r)=>nodeObject(new ToneMappingNode(e,nodeObject(t),nodeObject(r)));addNodeClass(ToneMappingNode);let resolution;class ViewportNode extends Node$2{constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===ViewportNode.COORDINATE?"vec4":"vec2"}getUpdateType(){let e=NodeUpdateType.NONE;return this.scope===ViewportNode.RESOLUTION&&(e=NodeUpdateType.FRAME),this.updateType=e}update({renderer:e}){e.getDrawingBufferSize(resolution)}construct(i){var n=this.scope;if(n!==ViewportNode.COORDINATE){let r=null;if(n===ViewportNode.RESOLUTION)r=uniform(resolution=resolution||new Vector2$1);else{var a=vec2(new ViewportNode(ViewportNode.COORDINATE)),o=new ViewportNode(ViewportNode.RESOLUTION);let e=(r=a.div(o)).x,t=r.y;(/top/i.test(n)&&i.isFlipY()||/bottom/i.test(n)&&!1===i.isFlipY())&&(t=t.oneMinus()),/right/i.test(n)&&(e=e.oneMinus()),r=vec2(e,t)}return r}}generate(e){return this.scope===ViewportNode.COORDINATE?e.getFragCoord():super.generate(e)}}ViewportNode.COORDINATE="coordinate",ViewportNode.RESOLUTION="resolution",ViewportNode.TOP_LEFT="topLeft",ViewportNode.BOTTOM_LEFT="bottomLeft",ViewportNode.TOP_RIGHT="topRight",ViewportNode.BOTTOM_RIGHT="bottomRight";const viewportCoordinate=nodeImmutable(ViewportNode,ViewportNode.COORDINATE),viewportResolution=nodeImmutable(ViewportNode,ViewportNode.RESOLUTION),viewportTopLeft=nodeImmutable(ViewportNode,ViewportNode.TOP_LEFT),viewportBottomLeft=nodeImmutable(ViewportNode,ViewportNode.BOTTOM_LEFT),viewportTopRight=nodeImmutable(ViewportNode,ViewportNode.TOP_RIGHT),viewportBottomRight=nodeImmutable(ViewportNode,ViewportNode.BOTTOM_RIGHT),_size=(addNodeClass(ViewportNode),new Vector2$1);class ViewportTextureNode extends TextureNode{constructor(e=viewportTopLeft,t=null,r=null){null===r&&((r=new FramebufferTexture$1).minFilter=LinearMipmapLinearFilter$1),super(r,e,t),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=NodeUpdateType.FRAME}updateBefore(e){var e=e.renderer,t=(e.getDrawingBufferSize(_size),this.value),r=(t.image.width===_size.width&&t.image.height===_size.height||(t.image.width=_size.width,t.image.height=_size.height,t.needsUpdate=!0),t.generateMipmaps);t.generateMipmaps=this.generateMipmaps,e.copyFramebufferToTexture(t),t.generateMipmaps=r}clone(){return new this.constructor(this.uvNode,this.levelNode,this.value)}}const viewportTexture=nodeProxy(ViewportTextureNode),viewportMipTexture=nodeProxy(ViewportTextureNode,null,null,{generateMipmaps:!0});addNodeElement("viewportTexture",viewportTexture),addNodeElement("viewportMipTexture",viewportMipTexture),addNodeClass(ViewportTextureNode);let sharedFramebuffer=null;class ViewportSharedTextureNode extends ViewportTextureNode{constructor(e=viewportTopLeft,t=null){super(e,t,sharedFramebuffer=null===sharedFramebuffer?new FramebufferTexture$1:sharedFramebuffer)}}const viewportSharedTexture=nodeProxy(ViewportSharedTextureNode);addNodeElement("viewportSharedTexture",viewportSharedTexture),addNodeClass(ViewportSharedTextureNode);let sharedDepthbuffer=null;class ViewportDepthTextureNode extends ViewportTextureNode{constructor(e=viewportTopLeft,t=null){null===sharedDepthbuffer&&((sharedDepthbuffer=new DepthTexture$1).minFilter=LinearMipmapLinearFilter$1,sharedDepthbuffer.type=UnsignedIntType$1,sharedDepthbuffer.format=DepthFormat$1),super(e,t,sharedDepthbuffer)}}const viewportDepthTexture=nodeProxy(ViewportDepthTextureNode);addNodeElement("viewportDepthTexture",viewportDepthTexture),addNodeClass(ViewportDepthTextureNode);class ViewportDepthNode extends Node$2{constructor(e,t=null){super("float"),this.scope=e,this.textureNode=t,this.isViewportDepthNode=!0}construct(){var e=this["scope"];let t=null;return e===ViewportDepthNode.DEPTH?t=viewZToOrthographicDepth(positionView.z,cameraNear,cameraFar):e===ViewportDepthNode.DEPTH_TEXTURE&&(e=this.textureNode||viewportDepthTexture(),e=perspectiveDepthToViewZ(e,cameraNear,cameraFar),t=viewZToOrthographicDepth(e,cameraNear,cameraFar)),t}}const viewZToOrthographicDepth=(e,t,r)=>e.add(t).div(t.sub(r)),orthographicDepthToViewZ=(e,t,r)=>t.sub(r).mul(e).sub(t),viewZToPerspectiveDepth=(e,t,r)=>t.add(e).mul(r).div(t.sub(r).mul(e)),perspectiveDepthToViewZ=(e,t,r)=>t.mul(r).div(r.sub(t).mul(e).sub(r)),depth=(ViewportDepthNode.DEPTH="depth",ViewportDepthNode.DEPTH_TEXTURE="depthTexture",nodeImmutable(ViewportDepthNode,ViewportDepthNode.DEPTH)),depthTexture=nodeProxy(ViewportDepthNode,ViewportDepthNode.DEPTH_TEXTURE);addNodeClass(ViewportDepthNode);class CodeNode extends Node$2{constructor(e="",t=[],r=""){super("code"),this.isCodeNode=!0,this.code=e,this.language=r,this._includes=t}setIncludes(e){return this._includes=e,this}getIncludes(){return this._includes}generate(e){for(const r of this.getIncludes(e))r.build(e);var t=e.getCodeFromNode(this,this.getNodeType(e));return t.code=this.code,t.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}const code=nodeProxy(CodeNode),js=(e,t)=>code(e,t,"js"),wgsl=(e,t)=>code(e,t,"wgsl"),glsl=(e,t)=>code(e,t,"glsl");addNodeClass(CodeNode);class FunctionCallNode extends TempNode{constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(t){var r=[],e=this.functionNode,i=e.getInputs(t),n=this.parameters;if(Array.isArray(n))for(let e=0;e<n.length;e++){var a=i[e],o=n[e];r.push(o.build(t,a.type))}else for(const l of i){var s=n[l.name];if(void 0===s)throw new Error(`FunctionCallNode: Input '${l.name}' not found in FunctionNode.`);r.push(s.build(t,l.type))}return`${e.build(t,"property")}( ${r.join(", ")} )`}}const call=(e,...t)=>(t=1<t.length||t[0]&&!0===t[0].isNode?nodeArray(t):nodeObjects(t[0]),nodeObject(new FunctionCallNode(nodeObject(e),t)));addNodeElement("call",call),addNodeClass(FunctionCallNode);class FunctionNode extends CodeNode{constructor(e="",t=[],r=""){super(e,t,r),this.keywords={}}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){var t=e.getDataFromNode(this);let r=t.nodeFunction;return void 0===r&&(r=e.parser.parseFunction(this.code),t.nodeFunction=r),r}generate(e,t){super.generate(e);var r=this.getNodeFunction(e),i=r.name,r=r.type,n=e.getCodeFromNode(this,r),i=(""!==i&&(n.name=i),e.getPropertyName(n));let a=this.getNodeFunction(e).getCode(i);var o=this.keywords,s=Object.keys(o);if(0<s.length)for(const d of s){var l=new RegExp(`\\b${d}\\b`,"g"),c=o[d].build(e,"property");a=a.replace(l,c)}return n.code=a,"property"===t?i:e.format(i+"()",r,t)}}const nativeFn=(t,r,i="")=>{let n=null;return(...e)=>(n=null===n?nodeObject(new FunctionNode(t,r,i)):n).call(...e)},glslFn=(e,t)=>nativeFn(e,t,"glsl"),wgslFn=(e,t)=>nativeFn(e,t,"wgsl");addNodeClass(FunctionNode);class ScriptableValueNode extends Node$2{constructor(e=null){super(),this._value=e,this._cache=null,this.inputType=null,this.outpuType=null,this.events=new EventDispatcher$2,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return null!==this.outputType}set value(e){this._value!==e&&(this._cache&&"URL"===this.inputType&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=e,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){var e=this.value;if(e&&null===this._cache&&"URL"===this.inputType&&e.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([e.value]));else if(e&&null!==e.value&&void 0!==e.value&&(("URL"===this.inputType||"String"===this.inputType)&&"string"==typeof e.value||"Number"===this.inputType&&"number"==typeof e.value||"Vector2"===this.inputType&&e.value.isVector2||"Vector3"===this.inputType&&e.value.isVector3||"Vector4"===this.inputType&&e.value.isVector4||"Color"===this.inputType&&e.value.isColor||"Matrix3"===this.inputType&&e.value.isMatrix3||"Matrix4"===this.inputType&&e.value.isMatrix4))return e.value;return this._cache||e}getNodeType(e){return this.value&&this.value.isNode?this.value.getNodeType(e):"float"}construct(){return this.value&&this.value.isNode?this.value:float()}serialize(e){super.serialize(e),null!==this.value?"ArrayBuffer"===this.inputType?e.value=arrayBufferToBase64(this.value):e.value=this.value?this.value.toJSON(e.meta).uuid:null:e.value=null,e.inputType=this.inputType,e.outputType=this.outputType}deserialize(e){super.deserialize(e);let t=null;null!==e.value&&(t="ArrayBuffer"===e.inputType?base64ToArrayBuffer(e.value):"Texture"===e.inputType?e.meta.textures[e.value]:e.meta.nodes[e.value]||null),this.value=t,this.inputType=e.inputType,this.outputType=e.outputType}}const scriptableValue=nodeProxy(ScriptableValueNode);addNodeElement("scriptableValue",scriptableValue),addNodeClass(ScriptableValueNode);class Resources extends Map{get(e,t=null,...r){return this.has(e)?super.get(e):null!==t?(t=t(...r),this.set(e,t),t):void 0}}class Parameters{constructor(e){this.scriptableNode=e}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(e){return this.scriptableNode.getInputLayout(e)}get(e){e=this.parameters[e];return e?e.getValue():null}}const global=new Resources;class ScriptableNode extends Node$2{constructor(e=null,t={}){super(),this.codeNode=e,this.parameters=t,this._local=new Resources,this._output=scriptableValue(),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(e,t){return this._local.set(e,t)}getLocal(e){return this._local.get(e)}onRefresh(){this._refresh()}getInputLayout(e){for(const t of this.getLayout())if(t.inputType&&(t.id===e||t.name===e))return t}getOutputLayout(e){for(const t of this.getLayout())if(t.outputType&&(t.id===e||t.name===e))return t}setOutput(e,t){var r=this._outputs;return void 0===r[e]?r[e]=scriptableValue(t):r[e].value=t,this}getOutput(e){return this._outputs[e]}getParameter(e){return this.parameters[e]}setParameter(e,t){var r=this.parameters;return t&&t.isScriptableNode?(this.deleteParameter(e),r[e]=t,r[e].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):t&&t.isScriptableValueNode?(this.deleteParameter(e),r[e]=t,r[e].events.addEventListener("refresh",this.onRefresh)):void 0===r[e]?(r[e]=scriptableValue(t),r[e].events.addEventListener("refresh",this.onRefresh)):r[e].value=t,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(e){let t=this.parameters[e];return t&&(t=t.isScriptableNode?t.getDefaultOutput():t).events.removeEventListener("refresh",this.onRefresh),this}clearParameters(){for(const e of Object.keys(this.parameters))this.deleteParameter(e);return this.needsUpdate=!0,this}call(e,...t){e=this.getObject()[e];if("function"==typeof e)return e(...t)}async callAsync(e,...t){e=this.getObject()[e];if("function"==typeof e)return"AsyncFunction"===e.constructor.name?await e(...t):e(...t)}getNodeType(e){return this.getDefaultOutputNode().getNodeType(e)}refresh(e=null){null!==e?this.getOutput(e).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),null===this._object){var e=new Parameters(this),t=global.get("THREE"),r=global.get("TSL"),i=this.getMethod(this.codeNode),e=[e,this._local,global,()=>this.refresh(),(e,t)=>this.setOutput(e,t),t,r],t=(this._object=i(...e),this._object.layout);if(t&&(!1===t.cache&&this._local.clear(),this._output.outputType=t.outputType||null,Array.isArray(t.elements)))for(const a of t.elements){var n=a.id||a.name;a.inputType&&(void 0===this.getParameter(n)&&this.setParameter(n,null),this.getParameter(n).inputType=a.inputType),a.outputType&&(void 0===this.getOutput(n)&&this.setOutput(n,null),this.getOutput(n).outputType=a.outputType)}}return this._object}deserialize(e){super.deserialize(e);for(const t in this.parameters){let e=this.parameters[t];(e=e.isScriptableNode?e.getDefaultOutput():e).events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){var e=this.getDefaultOutput().value;return e&&e.isNode?e:float()}getDefaultOutput(){return this._exec()._output}getMethod(){var e;return this.needsUpdate&&this.dispose(),null===this._method&&(e="var "+(e=["layout","init","main","dispose"].join(", "))+"; var output = {};\n"+this.codeNode.code+("\nreturn { ...output, "+e+" };"),this._method=new Function("parameters","local","global","refresh","setOutput","THREE","TSL",e)),this._method}dispose(){null!==this._method&&(this._object&&"function"==typeof this._object.dispose&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}construct(){return this.getDefaultOutputNode()}set needsUpdate(e){!0===e&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return null!==this.codeNode&&(!0===this._needsOutputUpdate&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value),this}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const scriptable=nodeProxy(ScriptableNode);addNodeElement("scriptable",scriptable),addNodeClass(ScriptableNode);class FogNode extends Node$2{constructor(e,t){super("float"),this.isFogNode=!0,this.colorNode=e,this.factorNode=t}mixAssign(e){return this.mix(e,this.colorNode)}construct(){return this.factorNode}}const fog=nodeProxy(FogNode);addNodeElement("fog",fog),addNodeClass(FogNode);class FogRangeNode extends FogNode{constructor(e,t,r){super(e),this.isFogRangeNode=!0,this.nearNode=t,this.farNode=r}construct(){return smoothstep$1(this.nearNode,this.farNode,positionView.z.negate())}}const rangeFog=nodeProxy(FogRangeNode);addNodeElement("rangeFog",rangeFog),addNodeClass(FogRangeNode);class FogExp2Node extends FogNode{constructor(e,t){super(e),this.isFogExp2Node=!0,this.densityNode=t}construct(){var e=positionView.z.negate(),t=this.densityNode;return t.mul(t,e,e).negate().exp().oneMinus()}}const densityFog=nodeProxy(FogExp2Node);addNodeElement("densityFog",densityFog),addNodeClass(FogExp2Node);let min$1=null,max$1=null;class RangeNode extends Node$2{constructor(e=float(),t=float()){super(),this.minNode=e,this.maxNode=t}getVectorLength(e){var t=e.getTypeLength(getValueType(this.minNode.value)),e=e.getTypeLength(getValueType(this.maxNode.value));return e<t?t:e}getNodeType(e){return!0===e.object.isInstancedMesh?e.getTypeFromLength(this.getVectorLength(e)):"float"}construct(e){var t=e.object;let r=null;if(!0===t.isInstancedMesh){var i=this.minNode.value,n=this.maxNode.value,a=e.getTypeLength(getValueType(i)),o=e.getTypeLength(getValueType(n)),s=(min$1=min$1||new Vector4$1,max$1=max$1||new Vector4$1,min$1.setScalar(0),max$1.setScalar(0),1===a?min$1.setScalar(i):i.isColor?min$1.set(i.r,i.g,i.b):min$1.set(i.x,i.y,i.z||0,i.w||0),1===o?max$1.setScalar(n):n.isColor?max$1.set(n.r,n.g,n.b):max$1.set(n.x,n.y,n.z||0,n.w||0),4*t.count),l=new Float32Array(s);for(let e=0;e<s;e++){var c=e%4,d=min$1.getComponent(c),c=max$1.getComponent(c);l[e]=MathUtils$1.lerp(d,c,Math.random())}a=this.getNodeType(e);r=buffer(l,"vec4",t.count).element(instanceIndex).convert(a)}else r=float(0);return r}}const range=nodeProxy(RangeNode);addNodeClass(RangeNode);class ComputeNode extends Node$2{constructor(e,t,r=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=r,this.dispatchCount=0,this.version=1,this.updateType=NodeUpdateType.OBJECT,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}updateDispatchCount(){var{count:e,workgroupSize:t}=this;let r=t[0];for(let e=1;e<t.length;e++)r*=t[e];this.dispatchCount=Math.ceil(e/r)}onInit(){}update({renderer:e}){e.compute(this)}generate(e){var t=e["shaderStage"];"compute"===t&&""!==(t=this.computeNode.build(e,"void"))&&e.addLineFlowCode(t)}}const compute=(e,t,r)=>nodeObject(new ComputeNode(nodeObject(e),t,r));addNodeElement("compute",compute),addNodeClass(ComputeNode);class LightNode extends Node$2{constructor(e=LightNode.TARGET_DIRECTION,t=null){super(),this.scope=e,this.light=t}construct(){var{scope:e,light:t}=this;let r=null;return r=e===LightNode.TARGET_DIRECTION?cameraViewMatrix.transformDirection(objectPosition(t).sub(objectPosition(t.target))):r}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}LightNode.TARGET_DIRECTION="targetDirection";const lightTargetDirection=nodeProxy(LightNode,LightNode.TARGET_DIRECTION),getDistanceAttenuation=(addNodeClass(LightNode),tslFn(e=>{var{lightDistance:e,cutoffDistance:t,decayExponent:r}=e,r=e.pow(r).max(.01).reciprocal();return t.greaterThan(0).cond(r.mul(e.div(t).pow4().oneMinus().clamp().pow2()),r)}));class PointLightNode extends AnalyticLightNode{constructor(e=null){super(e),this.cutoffDistanceNode=uniform(0),this.decayExponentNode=uniform(0)}update(e){var t=this["light"];super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}construct(e){var{colorNode:t,cutoffDistanceNode:r,decayExponentNode:i,light:n}=this,a=e.context.lightingModel,n=objectViewPosition(n).sub(positionView),o=n.normalize(),n=n.length(),n=getDistanceAttenuation({lightDistance:n,cutoffDistance:r,decayExponent:i}),r=t.mul(n),i=e.context.reflectedLight;a.direct({lightDirection:o,lightColor:r,reflectedLight:i})}}addLightNode(PointLight$1,PointLightNode),addNodeClass(PointLightNode);class DirectionalLightNode extends AnalyticLightNode{constructor(e=null){super(e)}construct(e){super.construct(e);var t=e.context.lightingModel,r=this.colorNode,i=lightTargetDirection(this.light),e=e.context.reflectedLight;t.direct({lightDirection:i,lightColor:r,reflectedLight:e})}}addLightNode(DirectionalLight$1,DirectionalLightNode),addNodeClass(DirectionalLightNode);class SpotLightNode extends AnalyticLightNode{constructor(e=null){super(e),this.coneCosNode=uniform(0),this.penumbraCosNode=uniform(0),this.cutoffDistanceNode=uniform(0),this.decayExponentNode=uniform(0)}update(e){super.update(e);e=this.light;this.coneCosNode.value=Math.cos(e.angle),this.penumbraCosNode.value=Math.cos(e.angle*(1-e.penumbra)),this.cutoffDistanceNode.value=e.distance,this.decayExponentNode.value=e.decay}getSpotAttenuation(e){var{coneCosNode:t,penumbraCosNode:r}=this;return smoothstep$1(t,r,e)}construct(e){super.construct(e);var t=e.context.lightingModel,{colorNode:r,cutoffDistanceNode:i,decayExponentNode:n,light:a}=this,o=objectViewPosition(a).sub(positionView),s=o.normalize(),a=s.dot(lightTargetDirection(a)),a=this.getSpotAttenuation(a),o=o.length(),o=getDistanceAttenuation({lightDistance:o,cutoffDistance:i,decayExponent:n}),i=r.mul(a).mul(o),n=e.context.reflectedLight;t.direct({lightDirection:s,lightColor:i,reflectedLight:n})}}addLightNode(SpotLight$1,SpotLightNode),addNodeClass(SpotLightNode);class IESSpotLight extends SpotLight$1{constructor(e,t,r,i,n,a){super(e,t,r,i,n,a),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class IESSpotLightNode extends SpotLightNode{getSpotAttenuation(e){var t,r=this.light.iesMap;let i=null;return i=r&&!0===r.isTexture?(t=e.acos().mul(1/Math.PI),texture(r,vec2(t,0),0).r):super.getSpotAttenuation(e)}}addLightNode(IESSpotLight,IESSpotLightNode),addNodeClass(IESSpotLightNode);class AmbientLightNode extends AnalyticLightNode{constructor(e=null){super(e)}construct({context:e}){e.irradiance.addAssign(this.colorNode)}}addLightNode(AmbientLight$1,AmbientLightNode),addNodeClass(AmbientLightNode);class LightingContextNode extends ContextNode{constructor(e,t=null,r=null,i=null){super(e),this.lightingModel=t,this.backdropNode=r,this.backdropAlphaNode=i}getNodeType(){return"vec3"}construct(e){var{lightingModel:t,backdropNode:r,backdropAlphaNode:i}=this,n=this.context={},a=e.getNodeProperties(this),o=vec3().temp(),s=vec3().temp(),l=vec3().temp(),c=vec3().temp();let d=add(o,l);null!==r&&(d=vec3(null!==i?mix(d,r,i):r));i=add(s,c),r={directDiffuse:o,directSpecular:s,indirectDiffuse:l,indirectSpecular:c,total:add(d,i).temp()},o={radiance:vec3().temp(),irradiance:vec3().temp(),iblIrradiance:vec3().temp(),ambientOcclusion:float(1).temp()};return n.reflectedLight=r,n.lightingModel=t||n.lightingModel,Object.assign(a,r,o),Object.assign(n,o),t&&(t.init(n,e.stack,e),t.indirectDiffuse(n,e.stack,e),t.indirectSpecular(n,e.stack,e),t.ambientOcclusion(n,e.stack,e)),super.construct(e)}generate(e){var t=this["context"],r=this.getNodeType(e);return super.generate(e,r),t.reflectedLight.total.build(e,r)}}const lightingContext=nodeProxy(LightingContextNode);addNodeElement("lightingContext",lightingContext),addNodeClass(LightingContextNode);class HemisphereLightNode extends AnalyticLightNode{constructor(e=null){super(e),this.lightPositionNode=objectPosition(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=uniform(new Color$1)}update(e){var t=this["light"];super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}construct(e){var{colorNode:t,groundColorNode:r,lightDirectionNode:i}=this,i=normalView.dot(i).mul(.5).add(.5),r=mix(r,t,i);e.context.irradiance.addAssign(r)}}addLightNode(HemisphereLight$1,HemisphereLightNode),addNodeClass(HemisphereLightNode);const checkerShaderNode=tslFn(e=>{var e=e.uv.mul(2),t=e.x.floor(),e=e.y.floor();return t.add(e).mod(2).sign()});class CheckerNode extends TempNode{constructor(e=uv()){super("float"),this.uvNode=e}generate(e){return checkerShaderNode({uv:this.uvNode}).build(e)}}const checker=nodeProxy(CheckerNode);addNodeElement("checker",checker),addNodeClass(CheckerNode);class NodeLoader extends Loader$1{constructor(e){super(e),this.textures={}}load(t,r,e,i){var n=new FileLoader$1(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(t,e=>{try{r(this.parse(JSON.parse(e)))}catch(e){i?i(e):console.error(e),this.manager.itemError(t)}},e,i)}parseNodes(e){var t={};if(void 0!==e){for(const a of e){var{uuid:r,type:i}=a;t[r]=nodeObject(createNodeFromType(i)),t[r].uuid=r}var n={nodes:t,textures:this.textures};for(const o of e)o.meta=n,t[o.uuid].deserialize(o),delete o.meta}return t}parse(e){var t=nodeObject(createNodeFromType(e.type)),r=(t.uuid=e.uuid,this.parseNodes(e.nodes)),r={nodes:r,textures:this.textures};return e.meta=r,t.deserialize(e),delete e.meta,t}setTextures(e){return this.textures=e,this}}const defaultValues=new LineBasicMaterial$1;class LineBasicNodeMaterial extends NodeMaterial{constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.lights=!1,this.normals=!1,this.setDefaultValues(defaultValues),this.setValues(e)}}addNodeMaterial(LineBasicNodeMaterial);const defaultValues$1=new MeshNormalMaterial$1;class MeshNormalNodeMaterial extends NodeMaterial{constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.colorSpace=!1,this.setDefaultValues(defaultValues$1),this.setValues(e)}constructDiffuseColor({stack:e}){var t=this.opacityNode?float(this.opacityNode):materialOpacity;e.assign(diffuseColor,vec4(directionToColor(transformedNormalView),t))}}addNodeMaterial(MeshNormalNodeMaterial);const defaultValues$2=new MeshBasicMaterial$1;class MeshBasicNodeMaterial extends NodeMaterial{constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!1,this.setDefaultValues(defaultValues$2),this.setValues(e)}}addNodeMaterial(MeshBasicNodeMaterial);const F_Schlick=tslFn(({f0:e,f90:t,dotVH:r})=>{r=r.mul(-5.55473).sub(6.98316).mul(r).exp2();return e.mul(r.oneMinus()).add(t.mul(r))}),BRDF_Lambert=tslFn(e=>e.diffuseColor.mul(1/Math.PI)),G_BlinnPhong_Implicit=()=>float(.25),D_BlinnPhong=tslFn(({dotNH:e})=>shininess.mul(.5/Math.PI).add(1).mul(e.pow(shininess))),BRDF_BlinnPhong=tslFn(({lightDirection:e})=>{var e=e.add(positionViewDirection).normalize(),t=transformedNormalView.dot(e).clamp(),e=positionViewDirection.dot(e).clamp(),e=F_Schlick({f0:specularColor,f90:1,dotVH:e}),r=G_BlinnPhong_Implicit(),t=D_BlinnPhong({dotNH:t});return e.mul(r).mul(t)});class PhongLightingModel extends LightingModel{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:r}){t=transformedNormalView.dot(e).clamp().mul(t);r.directDiffuse.addAssign(t.mul(BRDF_Lambert({diffuseColor:diffuseColor.rgb}))),!0===this.specular&&r.directSpecular.addAssign(t.mul(BRDF_BlinnPhong({lightDirection:e})).mul(materialSpecularStrength))}indirectDiffuse({irradiance:e,reflectedLight:t}){t.indirectDiffuse.addAssign(e.mul(BRDF_Lambert({diffuseColor:diffuseColor})))}}const defaultValues$3=new MeshLambertMaterial$1;class MeshLambertNodeMaterial extends NodeMaterial{constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(defaultValues$3),this.setValues(e)}constructLightingModel(){return new PhongLightingModel(!1)}}addNodeMaterial(MeshLambertNodeMaterial);const defaultValues$4=new MeshPhongMaterial$1;class MeshPhongNodeMaterial extends NodeMaterial{constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(defaultValues$4),this.setValues(e)}constructLightingModel(){return new PhongLightingModel}constructVariants({stack:e}){var t=(this.shininessNode?float(this.shininessNode):materialShininess).max(1e-4),t=(e.assign(shininess,t),this.specularNode||materialSpecularColor);e.assign(specularColor,t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}addNodeMaterial(MeshPhongNodeMaterial);const getGeometryRoughness=tslFn(()=>{var e=normalGeometry.dFdx().abs().max(normalGeometry.dFdy().abs());return e.x.max(e.y).max(e.z)}),getRoughness=tslFn(e=>{var e=e["roughness"],t=getGeometryRoughness();let r=e.max(.0525);return r=(r=r.add(t)).min(1)}),V_GGX_SmithCorrelated=tslFn(e=>{var{alpha:e,dotNL:t,dotNV:r}=e,e=e.pow2(),i=t.mul(e.add(e.oneMinus().mul(r.pow2())).sqrt()),r=r.mul(e.add(e.oneMinus().mul(t.pow2())).sqrt());return div(.5,i.add(r).max(EPSILON))}),D_GGX=tslFn(e=>{var{alpha:e,dotNH:t}=e,e=e.pow2(),t=t.pow2().mul(e.oneMinus()).oneMinus();return e.div(t.pow2()).mul(1/Math.PI)}),BRDF_GGX=tslFn(e=>{var{lightDirection:t,f0:r,f90:i,roughness:n,iridescenceFresnel:a}=e,e=e.normalView||transformedNormalView,n=n.pow2(),o=t.add(positionViewDirection).normalize(),t=e.dot(t).clamp(),s=e.dot(positionViewDirection).clamp(),e=e.dot(o).clamp(),o=positionViewDirection.dot(o).clamp();let l=F_Schlick({f0:r,f90:i,dotVH:o});a&&(l=iridescence.mix(l,a));r=V_GGX_SmithCorrelated({alpha:n,dotNL:t,dotNV:s}),i=D_GGX({alpha:n,dotNH:e});return l.mul(r).mul(i)}),DFGApprox=tslFn(e=>{var t=e["roughness"],e=e.dotNV||transformedNormalView.dot(positionViewDirection).clamp(),r=vec4(-1,-.0275,-.572,.022),i=vec4(1,.0425,1.04,-.04),t=t.mul(r).add(i),r=t.x.mul(t.x).min(e.mul(-9.28).exp2()).mul(t.x).add(t.y);return vec2(-1.04,1.04).mul(r).add(t.zw)}),EnvironmentBRDF=tslFn(e=>{var{dotNV:e,specularColor:t,specularF90:r,roughness:i}=e,e=DFGApprox({dotNV:e,roughness:i});return t.mul(e.x).add(r.mul(e.y))}),Schlick_to_F0=tslFn(({f:e,f90:t,dotVH:r})=>{var r=r.oneMinus().saturate(),i=r.mul(r),r=r.mul(i,i).clamp(0,.9999);return e.sub(vec3(t).mul(r)).div(r.oneMinus())}),D_Charlie=(e,t)=>{e=e.pow2(),e=float(1).div(e),t=t.pow2().oneMinus().max(.0078125);return float(2).add(e).mul(t.pow(e.mul(.5))).div(2*Math.PI)},V_Neubelt=(e,t)=>float(1).div(float(4).mul(t.add(e).sub(t.mul(e)))),BRDF_Sheen=tslFn(({lightDirection:e})=>{var t=e.add(positionViewDirection).normalize(),e=transformedNormalView.dot(e).clamp(),r=transformedNormalView.dot(positionViewDirection).clamp(),t=transformedNormalView.dot(t).clamp(),t=D_Charlie(sheenRoughness,t),r=V_Neubelt(r,e);return sheen.mul(t).mul(r)}),XYZ_TO_REC709=mat3(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),Fresnel0ToIor=e=>{e=e.sqrt();return vec3(1).add(e).div(vec3(1).sub(e))},IorToFresnel0=(e,t)=>e.sub(t).div(e.add(t)).pow2(),evalSensitivity=(e,t)=>{var e=e.mul(2*Math.PI*1e-9),r=vec3(54856e-17,44201e-17,52481e-17),i=vec3(1681e3,1795300,2208400),n=vec3(43278e5,93046e5,66121e5),a=float(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(e.mul(2239900).add(t.x).cos()).mul(e.pow2().mul(-45282e5).exp());let o=r.mul(n.mul(2*Math.PI).sqrt()).mul(i.mul(e).add(t).cos()).mul(e.pow2().negate().mul(n).exp());return o=vec3(o.x.add(a),o.y,o.z).div(1.0685e-7),XYZ_TO_REC709.mul(o)},evalIridescence=(e,t,r,i,n)=>{var t=mix(e,t,smoothstep$1(0,.03,i)),a=e.div(t).pow2().mul(float(1).sub(r.pow2())),a=float(1).sub(a).sqrt(),o=IorToFresnel0(t,e),o=F_Schlick({f0:o,f90:1,dotVH:r}),r=o.oneMinus(),e=t.lessThan(e).cond(Math.PI,0),e=float(Math.PI).sub(e),n=Fresnel0ToIor(n.clamp(0,.9999)),s=IorToFresnel0(n,t.vec3()),s=F_Schlick({f0:s,f90:1,dotVH:a}),n=vec3(n.x.lessThan(t).cond(Math.PI,0),n.y.lessThan(t).cond(Math.PI,0),n.z.lessThan(t).cond(Math.PI,0)),l=t.mul(i,a,2),c=vec3(e).add(n),t=o.mul(s).clamp(1e-5,.9999),d=t.sqrt(),i=r.pow2().mul(s).div(vec3(1).sub(t));let h=o.add(i),u=i.sub(r);for(let e=1;e<=2;++e){u=u.mul(d);var A=evalSensitivity(float(e).mul(l),float(e).mul(c)).mul(2);h=h.add(u.mul(A))}return h.max(vec3(0))},IBLSheenBRDF=(e,t,r)=>{var e=e.dot(t).saturate(),t=r.pow2(),i=cond(r.lessThan(.25),float(-339.2).mul(t).add(float(161.4).mul(r)).sub(25.9),float(-8.48).mul(t).add(float(14.3).mul(r)).sub(9.95)),t=cond(r.lessThan(.25),float(44).mul(t).sub(float(23.7).mul(r)).add(3.26),float(1.97).mul(t).sub(float(3.27).mul(r)).add(.72));return cond(r.lessThan(.25),0,float(.1).mul(r).sub(.025)).add(i.mul(e).add(t).exp()).mul(1/Math.PI).saturate()},clearcoatF0=vec3(.04),clearcoatF90=vec3(1);class PhysicalLightingModel extends LightingModel{constructor(e=!0,t=!0,r=!0){super(),this.clearcoat=e,this.sheen=t,this.iridescence=r,this.clearcoatRadiance=null,this.clearcoatSpecular=null,this.sheenSpecular=null,this.iridescenceFresnel=null,this.iridescenceF0=null}init({reflectedLight:e}){var t,r;!0===this.clearcoat&&(this.clearcoatRadiance=vec3().temp(),this.clearcoatSpecular=vec3().temp(),r=transformedClearcoatNormalView.dot(positionViewDirection).clamp(),r=F_Schlick({dotVH:r,f0:clearcoatF0,f90:clearcoatF90}),r=(t=e.total).mul(clearcoat.mul(r).oneMinus()).add(this.clearcoatSpecular.mul(clearcoat)),t.assign(r)),!0===this.sheen&&(this.sheenSpecular=vec3().temp(),t=e.total,r=sheen.r.max(sheen.g).max(sheen.b).mul(.157).oneMinus(),e=t.mul(r).add(this.sheenSpecular),t.assign(e)),!0===this.iridescence&&(r=transformedNormalView.dot(positionViewDirection).clamp(),this.iridescenceFresnel=evalIridescence(float(1),iridescenceIOR,r,iridescenceThickness,specularColor),this.iridescenceF0=Schlick_to_F0({f:this.iridescenceFresnel,f90:1,dotVH:r}))}computeMultiscattering(e,t,r=float(1)){var i=DFGApprox({roughness:roughness}),r=(this.iridescenceF0?iridescence.mix(specularColor,this.iridescenceF0):specularColor).mul(i.x).add(r.mul(i.y)),i=i.x.add(i.y).oneMinus(),n=specularColor.add(specularColor.oneMinus().mul(.047619)),n=r.mul(n).div(i.mul(n).oneMinus());e.addAssign(r),t.addAssign(n.mul(i))}direct({lightDirection:e,lightColor:t,reflectedLight:r}){var i=transformedNormalView.dot(e).clamp().mul(t);!0===this.sheen&&this.sheenSpecular.addAssign(i.mul(BRDF_Sheen({lightDirection:e}))),!0===this.clearcoat&&(t=transformedClearcoatNormalView.dot(e).clamp().mul(t),this.clearcoatSpecular.addAssign(t.mul(BRDF_GGX({lightDirection:e,f0:clearcoatF0,f90:clearcoatF90,roughness:clearcoatRoughness,normalView:transformedClearcoatNormalView})))),r.directDiffuse.addAssign(i.mul(BRDF_Lambert({diffuseColor:diffuseColor.rgb}))),r.directSpecular.addAssign(i.mul(BRDF_GGX({lightDirection:e,f0:specularColor,f90:1,roughness:roughness,iridescence:this.iridescence,iridescenceFresnel:this.iridescenceFresnel})))}indirectDiffuse({irradiance:e,reflectedLight:t}){t.indirectDiffuse.addAssign(e.mul(BRDF_Lambert({diffuseColor:diffuseColor})))}indirectSpecular({radiance:e,iblIrradiance:t,reflectedLight:r}){!0===this.sheen&&this.sheenSpecular.addAssign(t.mul(sheen,IBLSheenBRDF(transformedNormalView,positionViewDirection,sheenRoughness))),!0===this.clearcoat&&(i=transformedClearcoatNormalView.dot(positionViewDirection).clamp(),i=EnvironmentBRDF({dotNV:i,specularColor:clearcoatF0,specularF90:clearcoatF90,roughness:clearcoatRoughness}),this.clearcoatSpecular.addAssign(this.clearcoatRadiance.mul(i)));var i=vec3().temp(),n=vec3().temp(),t=t.mul(1/Math.PI),a=(this.computeMultiscattering(i,n),i.add(n)),a=diffuseColor.mul(a.r.max(a.g).max(a.b).oneMinus());r.indirectSpecular.addAssign(e.mul(i)),r.indirectSpecular.addAssign(n.mul(t)),r.indirectDiffuse.addAssign(a.mul(t))}ambientOcclusion({ambientOcclusion:e,reflectedLight:t}){var r=transformedNormalView.dot(positionViewDirection).clamp().add(e),i=roughness.mul(-16).oneMinus().negate().exp2(),r=e.sub(r.pow(i).oneMinus()).clamp();t.indirectDiffuse.mulAssign(e),t.indirectSpecular.mulAssign(r)}}const defaultValues$5=new MeshStandardMaterial$1;class MeshStandardNodeMaterial extends NodeMaterial{constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(defaultValues$5),this.setValues(e)}constructLightingModel(){return new PhysicalLightingModel(!1,!1)}constructVariants({stack:e}){var t=this.metalnessNode?float(this.metalnessNode):materialMetalness,r=(e.assign(metalness,t),this.roughnessNode?float(this.roughnessNode):materialRoughness),r=getRoughness({roughness:r}),r=(e.assign(roughness,r),mix(vec3(.04),diffuseColor.rgb,t));e.assign(specularColor,r),e.assign(diffuseColor,vec4(diffuseColor.rgb.mul(t.oneMinus()),diffuseColor.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}addNodeMaterial(MeshStandardNodeMaterial);const defaultValues$6=new MeshPhysicalMaterial$1;class MeshPhysicalNodeMaterial extends MeshStandardNodeMaterial{constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.setDefaultValues(defaultValues$6),this.setValues(e)}constructLightingModel(){return new PhysicalLightingModel}constructVariants(e){super.constructVariants(e);var e=e["stack"],t=this.clearcoatNode?float(this.clearcoatNode):materialClearcoat,r=this.clearcoatRoughnessNode?float(this.clearcoatRoughnessNode):materialClearcoatRoughness,t=(e.assign(clearcoat,t),e.assign(clearcoatRoughness,r),this.sheenNode?vec3(this.sheenNode):materialSheen),r=this.sheenRoughnessNode?float(this.sheenRoughnessNode):materialSheenRoughness,t=(e.assign(sheen,t),e.assign(sheenRoughness,r),this.iridescenceNode?float(this.iridescenceNode):materialIridescence),r=this.iridescenceIORNode?float(this.iridescenceIORNode):materialIridescenceIOR,i=this.iridescenceThicknessNode?float(this.iridescenceThicknessNode):materialIridescenceThickness;e.assign(iridescence,t),e.assign(iridescenceIOR,r),e.assign(iridescenceThickness,i)}constructNormal(e){super.constructNormal(e);var t=this.clearcoatNormalNode?vec3(this.clearcoatNormalNode):materialClearcoatNormal;e.stack.assign(transformedClearcoatNormalView,t)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,super.copy(e)}}addNodeMaterial(MeshPhysicalNodeMaterial);const defaultValues$7=new PointsMaterial$1;class PointsNodeMaterial extends NodeMaterial{constructor(e){super(),this.isPointsNodeMaterial=!0,this.lights=!1,this.normals=!1,this.transparent=!0,this.colorNode=null,this.opacityNode=null,this.alphaTestNode=null,this.lightNode=null,this.sizeNode=null,this.positionNode=null,this.setDefaultValues(defaultValues$7),this.setValues(e)}copy(e){return this.sizeNode=e.sizeNode,super.copy(e)}}addNodeMaterial(PointsNodeMaterial);const defaultValues$8=new SpriteMaterial$1;class SpriteNodeMaterial extends NodeMaterial{constructor(e){super(),this.isSpriteNodeMaterial=!0,this.lights=!1,this.normals=!1,this.colorNode=null,this.opacityNode=null,this.alphaTestNode=null,this.lightNode=null,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues(defaultValues$8),this.setValues(e)}constructPosition({object:e,context:t}){var{positionNode:r,rotationNode:i,scaleNode:n}=this,a=positionLocal;let o=modelViewMatrix.mul(vec3(r||0)),s=vec2(modelWorldMatrix[0].xyz.length(),modelWorldMatrix[1].xyz.length()),l=(null!==n&&(s=s.mul(n)),a.xy);l=(l=e.center&&!0===e.center.isVector2?l.sub(uniform(e.center).sub(.5)):l).mul(s);r=float(i||materialRotation),n=r.cos(),e=r.sin(),i=vec2(vec2(n,e.negate()).dot(l),vec2(e,n).dot(l)),o=vec4(o.xy.add(i),o.zw),r=cameraProjectionMatrix.mul(o);return t.vertex=a,r}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}}addNodeMaterial(SpriteNodeMaterial);const superFromTypeFunction=MaterialLoader$1.createMaterialFromType;MaterialLoader$1.createMaterialFromType=function(e){var t=createNodeMaterialFromType(e);return void 0!==t?t:superFromTypeFunction.call(this,e)};class NodeMaterialLoader extends MaterialLoader$1{constructor(e){super(e),this.nodes={}}parse(e){var t=super.parse(e),r=this.nodes,i=e.inputNodes;for(const a in i){var n=i[a];t[a]=r[n]}return t}setNodes(e){return this.nodes=e,this}}class NodeObjectLoader extends ObjectLoader$1{constructor(e){super(e),this._nodesJSON=null}parse(e,t){this._nodesJSON=e.nodes;e=super.parse(e,t);return this._nodesJSON=null,e}parseNodes(e,t){var r;return void 0!==e?((r=new NodeLoader).setTextures(t),r.parseNodes(e)):{}}parseMaterials(r,e){var i={};if(void 0!==r){var t=this.parseNodes(this._nodesJSON,e),n=new NodeMaterialLoader;n.setTextures(e),n.setNodes(t);for(let e=0,t=r.length;e<t;e++){var a=r[e];i[a.uuid]=n.parse(a)}}return i}}class NodeParser{parseFunction(){console.warn("Abstract function.")}}class NodeFunction{constructor(e,t,r="",i=""){this.type=e,this.inputs=t,this.name=r,this.presicion=i}getCode(){console.warn("Abstract function.")}}NodeFunction.isNodeFunction=!0;const declarationRegexp=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,propertiesRegexp=/[a-z_0-9]+/gi,pragmaMain="#pragma main",parse$1=e=>{var t=(e=e.trim()).indexOf(pragmaMain),i=-1!==t?e.slice(t+pragmaMain.length):e,n=i.match(declarationRegexp);if(null===n||5!==n.length)throw new Error("FunctionNode: Function is not a GLSL code.");{for(var a,o=n[4],s=[];null!==(a=propertiesRegexp.exec(o));)s.push(a);var l=[];let r=0;for(;r<s.length;){var c="const"===s[r][0];!0==c&&r++;let e=s[r][0];"in"===e||"out"===e||"inout"===e?r++:e="";var d=s[r++][0];let t=Number.parseInt(s[r][0]);!1===Number.isNaN(t)?r++:t=null;var h=s[r++][0];l.push(new NodeFunctionInput(d,h,t,e,c))}var i=i.substring(n[0].length),u=void 0!==n[3]?n[3]:"";return{type:n[2],inputs:l,name:u,presicion:void 0!==n[1]?n[1]:"",inputsCode:o,blockCode:i,headerCode:-1!==t?e.slice(0,t):""}}};class GLSLNodeFunction extends NodeFunction{constructor(e){var{type:e,inputs:t,name:r,presicion:i,inputsCode:n,blockCode:a,headerCode:o}=parse$1(e);super(e,t,r,i),this.inputsCode=n,this.blockCode=a,this.headerCode=o}getCode(t=this.name){let r;var i=this.blockCode;if(""!==i){var{type:n,inputsCode:a,headerCode:o,presicion:s}=this;let e=`${n} ${t} ( ${a.trim()} )`;""!==s&&(e=s+" "+e),r=o+e+i}else r="";return r}}class GLSLNodeParser extends NodeParser{parseFunction(e){return new GLSLNodeFunction(e)}}const mx_noise=glsl(`float mx_select(bool b, float t, float f)
{
    return b ? t : f;
}

float mx_negate_if(float val, bool b)
{
    return b ? -val : val;
}

int mx_floor(float x)
{
    return int(floor(x));
}

// return mx_floor as well as the fractional remainder
float mx_floorfrac(float x, out int i)
{
    i = mx_floor(x);
    return x - float(i);
}

float mx_bilerp(float v0, float v1, float v2, float v3, float s, float t)
{
    float s1 = 1.0 - s;
    return (1.0 - t) * (v0*s1 + v1*s) + t * (v2*s1 + v3*s);
}
vec3 mx_bilerp(vec3 v0, vec3 v1, vec3 v2, vec3 v3, float s, float t)
{
    float s1 = 1.0 - s;
    return (1.0 - t) * (v0*s1 + v1*s) + t * (v2*s1 + v3*s);
}
float mx_trilerp(float v0, float v1, float v2, float v3, float v4, float v5, float v6, float v7, float s, float t, float r)
{
    float s1 = 1.0 - s;
    float t1 = 1.0 - t;
    float r1 = 1.0 - r;
    return (r1*(t1*(v0*s1 + v1*s) + t*(v2*s1 + v3*s)) +
            r*(t1*(v4*s1 + v5*s) + t*(v6*s1 + v7*s)));
}
vec3 mx_trilerp(vec3 v0, vec3 v1, vec3 v2, vec3 v3, vec3 v4, vec3 v5, vec3 v6, vec3 v7, float s, float t, float r)
{
    float s1 = 1.0 - s;
    float t1 = 1.0 - t;
    float r1 = 1.0 - r;
    return (r1*(t1*(v0*s1 + v1*s) + t*(v2*s1 + v3*s)) +
            r*(t1*(v4*s1 + v5*s) + t*(v6*s1 + v7*s)));
}

// 2 and 3 dimensional gradient functions - perform a dot product against a
// randomly chosen vector. Note that the gradient vector is not normalized, but
// this only affects the overal "scale" of the result, so we simply account for
// the scale by multiplying in the corresponding "perlin" function.
float mx_gradient_float(uint hash, float x, float y)
{
    // 8 possible directions (+-1,+-2) and (+-2,+-1)
    uint h = hash & 7u;
    float u = mx_select(h<4u, x, y);
    float v = 2.0 * mx_select(h<4u, y, x);
    // compute the dot product with (x,y).
    return mx_negate_if(u, bool(h&1u)) + mx_negate_if(v, bool(h&2u));
}
float mx_gradient_float(uint hash, float x, float y, float z)
{
    // use vectors pointing to the edges of the cube
    uint h = hash & 15u;
    float u = mx_select(h<8u, x, y);
    float v = mx_select(h<4u, y, mx_select((h==12u)||(h==14u), x, z));
    return mx_negate_if(u, bool(h&1u)) + mx_negate_if(v, bool(h&2u));
}
vec3 mx_gradient_vec3(uvec3 hash, float x, float y)
{
    return vec3(mx_gradient_float(hash.x, x, y), mx_gradient_float(hash.y, x, y), mx_gradient_float(hash.z, x, y));
}
vec3 mx_gradient_vec3(uvec3 hash, float x, float y, float z)
{
    return vec3(mx_gradient_float(hash.x, x, y, z), mx_gradient_float(hash.y, x, y, z), mx_gradient_float(hash.z, x, y, z));
}
// Scaling factors to normalize the result of gradients above.
// These factors were experimentally calculated to be:
//    2D:   0.6616
//    3D:   0.9820
float mx_gradient_scale2d(float v) { return 0.6616 * v; }
float mx_gradient_scale3d(float v) { return 0.9820 * v; }
vec3 mx_gradient_scale2d(vec3 v) { return 0.6616 * v; }
vec3 mx_gradient_scale3d(vec3 v) { return 0.9820 * v; }

/// Bitwise circular rotation left by k bits (for 32 bit unsigned integers)
uint mx_rotl32(uint x, int k)
{
    return (x<<k) | (x>>(32-k));
}

void mx_bjmix(inout uint a, inout uint b, inout uint c)
{
    a -= c; a ^= mx_rotl32(c, 4); c += b;
    b -= a; b ^= mx_rotl32(a, 6); a += c;
    c -= b; c ^= mx_rotl32(b, 8); b += a;
    a -= c; a ^= mx_rotl32(c,16); c += b;
    b -= a; b ^= mx_rotl32(a,19); a += c;
    c -= b; c ^= mx_rotl32(b, 4); b += a;
}

// Mix up and combine the bits of a, b, and c (doesn't change them, but
// returns a hash of those three original values).
uint mx_bjfinal(uint a, uint b, uint c)
{
    c ^= b; c -= mx_rotl32(b,14);
    a ^= c; a -= mx_rotl32(c,11);
    b ^= a; b -= mx_rotl32(a,25);
    c ^= b; c -= mx_rotl32(b,16);
    a ^= c; a -= mx_rotl32(c,4);
    b ^= a; b -= mx_rotl32(a,14);
    c ^= b; c -= mx_rotl32(b,24);
    return c;
}

// Convert a 32 bit integer into a floating point number in [0,1]
float mx_bits_to_01(uint bits)
{
    return float(bits) / float(uint(0xffffffff));
}

float mx_fade(float t)
{
   return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);
}

uint mx_hash_int(int x)
{
    uint len = 1u;
    uint seed = uint(0xdeadbeef) + (len << 2u) + 13u;
    return mx_bjfinal(seed+uint(x), seed, seed);
}

uint mx_hash_int(int x, int y)
{
    uint len = 2u;
    uint a, b, c;
    a = b = c = uint(0xdeadbeef) + (len << 2u) + 13u;
    a += uint(x);
    b += uint(y);
    return mx_bjfinal(a, b, c);
}

uint mx_hash_int(int x, int y, int z)
{
    uint len = 3u;
    uint a, b, c;
    a = b = c = uint(0xdeadbeef) + (len << 2u) + 13u;
    a += uint(x);
    b += uint(y);
    c += uint(z);
    return mx_bjfinal(a, b, c);
}

uint mx_hash_int(int x, int y, int z, int xx)
{
    uint len = 4u;
    uint a, b, c;
    a = b = c = uint(0xdeadbeef) + (len << 2u) + 13u;
    a += uint(x);
    b += uint(y);
    c += uint(z);
    mx_bjmix(a, b, c);
    a += uint(xx);
    return mx_bjfinal(a, b, c);
}

uint mx_hash_int(int x, int y, int z, int xx, int yy)
{
    uint len = 5u;
    uint a, b, c;
    a = b = c = uint(0xdeadbeef) + (len << 2u) + 13u;
    a += uint(x);
    b += uint(y);
    c += uint(z);
    mx_bjmix(a, b, c);
    a += uint(xx);
    b += uint(yy);
    return mx_bjfinal(a, b, c);
}

uvec3 mx_hash_vec3(int x, int y)
{
    uint h = mx_hash_int(x, y);
    // we only need the low-order bits to be random, so split out
    // the 32 bit result into 3 parts for each channel
    uvec3 result;
    result.x = (h      ) & 0xFFu;
    result.y = (h >> 8 ) & 0xFFu;
    result.z = (h >> 16) & 0xFFu;
    return result;
}

uvec3 mx_hash_vec3(int x, int y, int z)
{
    uint h = mx_hash_int(x, y, z);
    // we only need the low-order bits to be random, so split out
    // the 32 bit result into 3 parts for each channel
    uvec3 result;
    result.x = (h      ) & 0xFFu;
    result.y = (h >> 8 ) & 0xFFu;
    result.z = (h >> 16) & 0xFFu;
    return result;
}

float mx_perlin_noise_float(vec2 p)
{
    int X, Y;
    float fx = mx_floorfrac(p.x, X);
    float fy = mx_floorfrac(p.y, Y);
    float u = mx_fade(fx);
    float v = mx_fade(fy);
    float result = mx_bilerp(
        mx_gradient_float(mx_hash_int(X  , Y  ), fx    , fy     ),
        mx_gradient_float(mx_hash_int(X+1, Y  ), fx-1.0, fy     ),
        mx_gradient_float(mx_hash_int(X  , Y+1), fx    , fy-1.0),
        mx_gradient_float(mx_hash_int(X+1, Y+1), fx-1.0, fy-1.0),
        u, v);
    return mx_gradient_scale2d(result);
}

float mx_perlin_noise_float(vec3 p)
{
    int X, Y, Z;
    float fx = mx_floorfrac(p.x, X);
    float fy = mx_floorfrac(p.y, Y);
    float fz = mx_floorfrac(p.z, Z);
    float u = mx_fade(fx);
    float v = mx_fade(fy);
    float w = mx_fade(fz);
    float result = mx_trilerp(
        mx_gradient_float(mx_hash_int(X  , Y  , Z  ), fx    , fy    , fz     ),
        mx_gradient_float(mx_hash_int(X+1, Y  , Z  ), fx-1.0, fy    , fz     ),
        mx_gradient_float(mx_hash_int(X  , Y+1, Z  ), fx    , fy-1.0, fz     ),
        mx_gradient_float(mx_hash_int(X+1, Y+1, Z  ), fx-1.0, fy-1.0, fz     ),
        mx_gradient_float(mx_hash_int(X  , Y  , Z+1), fx    , fy    , fz-1.0),
        mx_gradient_float(mx_hash_int(X+1, Y  , Z+1), fx-1.0, fy    , fz-1.0),
        mx_gradient_float(mx_hash_int(X  , Y+1, Z+1), fx    , fy-1.0, fz-1.0),
        mx_gradient_float(mx_hash_int(X+1, Y+1, Z+1), fx-1.0, fy-1.0, fz-1.0),
        u, v, w);
    return mx_gradient_scale3d(result);
}

vec3 mx_perlin_noise_vec3(vec2 p)
{
    int X, Y;
    float fx = mx_floorfrac(p.x, X);
    float fy = mx_floorfrac(p.y, Y);
    float u = mx_fade(fx);
    float v = mx_fade(fy);
    vec3 result = mx_bilerp(
        mx_gradient_vec3(mx_hash_vec3(X  , Y  ), fx    , fy     ),
        mx_gradient_vec3(mx_hash_vec3(X+1, Y  ), fx-1.0, fy     ),
        mx_gradient_vec3(mx_hash_vec3(X  , Y+1), fx    , fy-1.0),
        mx_gradient_vec3(mx_hash_vec3(X+1, Y+1), fx-1.0, fy-1.0),
        u, v);
    return mx_gradient_scale2d(result);
}

vec3 mx_perlin_noise_vec3(vec3 p)
{
    int X, Y, Z;
    float fx = mx_floorfrac(p.x, X);
    float fy = mx_floorfrac(p.y, Y);
    float fz = mx_floorfrac(p.z, Z);
    float u = mx_fade(fx);
    float v = mx_fade(fy);
    float w = mx_fade(fz);
    vec3 result = mx_trilerp(
        mx_gradient_vec3(mx_hash_vec3(X  , Y  , Z  ), fx    , fy    , fz     ),
        mx_gradient_vec3(mx_hash_vec3(X+1, Y  , Z  ), fx-1.0, fy    , fz     ),
        mx_gradient_vec3(mx_hash_vec3(X  , Y+1, Z  ), fx    , fy-1.0, fz     ),
        mx_gradient_vec3(mx_hash_vec3(X+1, Y+1, Z  ), fx-1.0, fy-1.0, fz     ),
        mx_gradient_vec3(mx_hash_vec3(X  , Y  , Z+1), fx    , fy    , fz-1.0),
        mx_gradient_vec3(mx_hash_vec3(X+1, Y  , Z+1), fx-1.0, fy    , fz-1.0),
        mx_gradient_vec3(mx_hash_vec3(X  , Y+1, Z+1), fx    , fy-1.0, fz-1.0),
        mx_gradient_vec3(mx_hash_vec3(X+1, Y+1, Z+1), fx-1.0, fy-1.0, fz-1.0),
        u, v, w);
    return mx_gradient_scale3d(result);
}

float mx_cell_noise_float(float p)
{
    int ix = mx_floor(p);
    return mx_bits_to_01(mx_hash_int(ix));
}

float mx_cell_noise_float(vec2 p)
{
    int ix = mx_floor(p.x);
    int iy = mx_floor(p.y);
    return mx_bits_to_01(mx_hash_int(ix, iy));
}

float mx_cell_noise_float(vec3 p)
{
    int ix = mx_floor(p.x);
    int iy = mx_floor(p.y);
    int iz = mx_floor(p.z);
    return mx_bits_to_01(mx_hash_int(ix, iy, iz));
}

float mx_cell_noise_float(vec4 p)
{
    int ix = mx_floor(p.x);
    int iy = mx_floor(p.y);
    int iz = mx_floor(p.z);
    int iw = mx_floor(p.w);
    return mx_bits_to_01(mx_hash_int(ix, iy, iz, iw));
}

vec3 mx_cell_noise_vec3(float p)
{
    int ix = mx_floor(p);
    return vec3(
            mx_bits_to_01(mx_hash_int(ix, 0)),
            mx_bits_to_01(mx_hash_int(ix, 1)),
            mx_bits_to_01(mx_hash_int(ix, 2))
    );
}

vec3 mx_cell_noise_vec3(vec2 p)
{
    int ix = mx_floor(p.x);
    int iy = mx_floor(p.y);
    return vec3(
            mx_bits_to_01(mx_hash_int(ix, iy, 0)),
            mx_bits_to_01(mx_hash_int(ix, iy, 1)),
            mx_bits_to_01(mx_hash_int(ix, iy, 2))
    );
}

vec3 mx_cell_noise_vec3(vec3 p)
{
    int ix = mx_floor(p.x);
    int iy = mx_floor(p.y);
    int iz = mx_floor(p.z);
    return vec3(
            mx_bits_to_01(mx_hash_int(ix, iy, iz, 0)),
            mx_bits_to_01(mx_hash_int(ix, iy, iz, 1)),
            mx_bits_to_01(mx_hash_int(ix, iy, iz, 2))
    );
}

vec3 mx_cell_noise_vec3(vec4 p)
{
    int ix = mx_floor(p.x);
    int iy = mx_floor(p.y);
    int iz = mx_floor(p.z);
    int iw = mx_floor(p.w);
    return vec3(
            mx_bits_to_01(mx_hash_int(ix, iy, iz, iw, 0)),
            mx_bits_to_01(mx_hash_int(ix, iy, iz, iw, 1)),
            mx_bits_to_01(mx_hash_int(ix, iy, iz, iw, 2))
    );
}

float mx_fractal_noise_float(vec3 p, int octaves, float lacunarity, float diminish)
{
    float result = 0.0;
    float amplitude = 1.0;
    for (int i = 0;  i < octaves; ++i)
    {
        result += amplitude * mx_perlin_noise_float(p);
        amplitude *= diminish;
        p *= lacunarity;
    }
    return result;
}

vec3 mx_fractal_noise_vec3(vec3 p, int octaves, float lacunarity, float diminish)
{
    vec3 result = vec3(0.0);
    float amplitude = 1.0;
    for (int i = 0;  i < octaves; ++i)
    {
        result += amplitude * mx_perlin_noise_vec3(p);
        amplitude *= diminish;
        p *= lacunarity;
    }
    return result;
}

vec2 mx_fractal_noise_vec2(vec3 p, int octaves, float lacunarity, float diminish)
{
    return vec2(mx_fractal_noise_float(p, octaves, lacunarity, diminish),
                mx_fractal_noise_float(p+vec3(19, 193, 17), octaves, lacunarity, diminish));
}

vec4 mx_fractal_noise_vec4(vec3 p, int octaves, float lacunarity, float diminish)
{
    vec3  c = mx_fractal_noise_vec3(p, octaves, lacunarity, diminish);
    float f = mx_fractal_noise_float(p+vec3(19, 193, 17), octaves, lacunarity, diminish);
    return vec4(c, f);
}

float mx_worley_distance(vec2 p, int x, int y, int xoff, int yoff, float jitter, int metric)
{
    vec3  tmp = mx_cell_noise_vec3(vec2(x+xoff, y+yoff));
    vec2  off = vec2(tmp.x, tmp.y);

    off -= 0.5f;
    off *= jitter;
    off += 0.5f;

    vec2 cellpos = vec2(float(x), float(y)) + off;
    vec2 diff = cellpos - p;
    if (metric == 2)
        return abs(diff.x) + abs(diff.y);       // Manhattan distance
    if (metric == 3)
        return max(abs(diff.x), abs(diff.y));   // Chebyshev distance
    // Either Euclidian or Distance^2
    return dot(diff, diff);
}

float mx_worley_distance(vec3 p, int x, int y, int z, int xoff, int yoff, int zoff, float jitter, int metric)
{
    vec3  off = mx_cell_noise_vec3(vec3(x+xoff, y+yoff, z+zoff));

    off -= 0.5f;
    off *= jitter;
    off += 0.5f;

    vec3 cellpos = vec3(float(x), float(y), float(z)) + off;
    vec3 diff = cellpos - p;
    if (metric == 2)
        return abs(diff.x) + abs(diff.y) + abs(diff.z); // Manhattan distance
    if (metric == 3)
        return max(max(abs(diff.x), abs(diff.y)), abs(diff.z)); // Chebyshev distance
    // Either Euclidian or Distance^2
    return dot(diff, diff);
}

float mx_worley_noise_float(vec2 p, float jitter, int metric)
{
    int X, Y;
    vec2 localpos = vec2(mx_floorfrac(p.x, X), mx_floorfrac(p.y, Y));
    float sqdist = 1e6f;        // Some big number for jitter > 1 (not all GPUs may be IEEE)
    for (int x = -1; x <= 1; ++x)
    {
        for (int y = -1; y <= 1; ++y)
        {
            float dist = mx_worley_distance(localpos, x, y, X, Y, jitter, metric);
            sqdist = min(sqdist, dist);
        }
    }
    if (metric == 0)
        sqdist = sqrt(sqdist);
    return sqdist;
}

vec2 mx_worley_noise_vec2(vec2 p, float jitter, int metric)
{
    int X, Y;
    vec2 localpos = vec2(mx_floorfrac(p.x, X), mx_floorfrac(p.y, Y));
    vec2 sqdist = vec2(1e6f, 1e6f);
    for (int x = -1; x <= 1; ++x)
    {
        for (int y = -1; y <= 1; ++y)
        {
            float dist = mx_worley_distance(localpos, x, y, X, Y, jitter, metric);
            if (dist < sqdist.x)
            {
                sqdist.y = sqdist.x;
                sqdist.x = dist;
            }
            else if (dist < sqdist.y)
            {
                sqdist.y = dist;
            }
        }
    }
    if (metric == 0)
        sqdist = sqrt(sqdist);
    return sqdist;
}

vec3 mx_worley_noise_vec3(vec2 p, float jitter, int metric)
{
    int X, Y;
    vec2 localpos = vec2(mx_floorfrac(p.x, X), mx_floorfrac(p.y, Y));
    vec3 sqdist = vec3(1e6f, 1e6f, 1e6f);
    for (int x = -1; x <= 1; ++x)
    {
        for (int y = -1; y <= 1; ++y)
        {
            float dist = mx_worley_distance(localpos, x, y, X, Y, jitter, metric);
            if (dist < sqdist.x)
            {
                sqdist.z = sqdist.y;
                sqdist.y = sqdist.x;
                sqdist.x = dist;
            }
            else if (dist < sqdist.y)
            {
                sqdist.z = sqdist.y;
                sqdist.y = dist;
            }
            else if (dist < sqdist.z)
            {
                sqdist.z = dist;
            }
        }
    }
    if (metric == 0)
        sqdist = sqrt(sqdist);
    return sqdist;
}

float mx_worley_noise_float(vec3 p, float jitter, int metric)
{
    int X, Y, Z;
    vec3 localpos = vec3(mx_floorfrac(p.x, X), mx_floorfrac(p.y, Y), mx_floorfrac(p.z, Z));
    float sqdist = 1e6f;
    for (int x = -1; x <= 1; ++x)
    {
        for (int y = -1; y <= 1; ++y)
        {
            for (int z = -1; z <= 1; ++z)
            {
                float dist = mx_worley_distance(localpos, x, y, z, X, Y, Z, jitter, metric);
                sqdist = min(sqdist, dist);
            }
        }
    }
    if (metric == 0)
        sqdist = sqrt(sqdist);
    return sqdist;
}

vec2 mx_worley_noise_vec2(vec3 p, float jitter, int metric)
{
    int X, Y, Z;
    vec3 localpos = vec3(mx_floorfrac(p.x, X), mx_floorfrac(p.y, Y), mx_floorfrac(p.z, Z));
    vec2 sqdist = vec2(1e6f, 1e6f);
    for (int x = -1; x <= 1; ++x)
    {
        for (int y = -1; y <= 1; ++y)
        {
            for (int z = -1; z <= 1; ++z)
            {
                float dist = mx_worley_distance(localpos, x, y, z, X, Y, Z, jitter, metric);
                if (dist < sqdist.x)
                {
                    sqdist.y = sqdist.x;
                    sqdist.x = dist;
                }
                else if (dist < sqdist.y)
                {
                    sqdist.y = dist;
                }
            }
        }
    }
    if (metric == 0)
        sqdist = sqrt(sqdist);
    return sqdist;
}

vec3 mx_worley_noise_vec3(vec3 p, float jitter, int metric)
{
    int X, Y, Z;
    vec3 localpos = vec3(mx_floorfrac(p.x, X), mx_floorfrac(p.y, Y), mx_floorfrac(p.z, Z));
    vec3 sqdist = vec3(1e6f, 1e6f, 1e6f);
    for (int x = -1; x <= 1; ++x)
    {
        for (int y = -1; y <= 1; ++y)
        {
            for (int z = -1; z <= 1; ++z)
            {
                float dist = mx_worley_distance(localpos, x, y, z, X, Y, Z, jitter, metric);
                if (dist < sqdist.x)
                {
                    sqdist.z = sqdist.y;
                    sqdist.y = sqdist.x;
                    sqdist.x = dist;
                }
                else if (dist < sqdist.y)
                {
                    sqdist.z = sqdist.y;
                    sqdist.y = dist;
                }
                else if (dist < sqdist.z)
                {
                    sqdist.z = dist;
                }
            }
        }
    }
    if (metric == 0)
        sqdist = sqrt(sqdist);
    return sqdist;
}`),includes=[mx_noise],mx_perlin_noise_float=glslFn("float mx_perlin_noise_float( any p )",includes),mx_perlin_noise_vec2=glslFn("vec2 mx_perlin_noise_vec2( any p )",includes),mx_perlin_noise_vec3=glslFn("vec3 mx_perlin_noise_vec3( any p )",includes),mx_cell_noise_float=glslFn("float mx_cell_noise_float( vec3 p )",includes),mx_worley_noise_float=glslFn("float mx_worley_noise_float( any p, float jitter, int metric )",includes),mx_worley_noise_vec2=glslFn("float mx_worley_noise_vec2( any p, float jitter, int metric )",includes),mx_worley_noise_vec3=glslFn("float mx_worley_noise_vec3( any p, float jitter, int metric )",includes),mx_fractal_noise_float=glslFn("float mx_fractal_noise_float( vec3 p, int octaves, float lacunarity, float diminish )",includes),mx_fractal_noise_vec2=glslFn("float mx_fractal_noise_vec2( vec3 p, int octaves, float lacunarity, float diminish )",includes),mx_fractal_noise_vec3=glslFn("float mx_fractal_noise_vec3( vec3 p, int octaves, float lacunarity, float diminish )",includes),mx_fractal_noise_vec4=glslFn("float mx_fractal_noise_vec4( vec3 p, int octaves, float lacunarity, float diminish )",includes),mx_hsvtorgb=glslFn(`vec3 mx_hsvtorgb(vec3 hsv)
{
    // Reference for this technique: Foley & van Dam
    float h = hsv.x; float s = hsv.y; float v = hsv.z;
    if (s < 0.0001f) {
      return vec3 (v, v, v);
    } else {
        h = 6.0f * (h - floor(h));  // expand to [0..6)
        int hi = int(trunc(h));
        float f = h - float(hi);
        float p = v * (1.0f-s);
        float q = v * (1.0f-s*f);
        float t = v * (1.0f-s*(1.0f-f));
        if (hi == 0)
            return vec3 (v, t, p);
        else if (hi == 1)
            return vec3 (q, v, p);
        else if (hi == 2)
            return vec3 (p, v, t);
        else if (hi == 3)
            return vec3 (p, q, v);
        else if (hi == 4)
            return vec3 (t, p, v);
        return vec3 (v, p, q);
    }
}`),mx_rgbtohsv=glslFn(`vec3 mx_rgbtohsv(vec3 c)
{
    // See Foley & van Dam
    float r = c.x; float g = c.y; float b = c.z;
    float mincomp = min (r, min(g, b));
    float maxcomp = max (r, max(g, b));
    float delta = maxcomp - mincomp;  // chroma
    float h, s, v;
    v = maxcomp;
    if (maxcomp > 0.0f)
        s = delta / maxcomp;
    else s = 0.0f;
    if (s <= 0.0f)
        h = 0.0f;
    else {
        if      (r >= maxcomp) h = (g-b) / delta;
        else if (g >= maxcomp) h = 2.0f + (b-r) / delta;
        else                   h = 4.0f + (r-g) / delta;
        h *= (1.0f/6.0f);
        if (h < 0.0f)
            h += 1.0f;
    }
    return vec3(h, s, v);
}`),mx_transform_color=glsl(`#define M_AP1_TO_REC709 mat3(1.705079555511475, -0.1297005265951157, -0.02416634373366833, -0.6242334842681885, 1.138468623161316, -0.1246141716837883, -0.0808461606502533, -0.008768022060394287, 1.148780584335327)

vec3 mx_srgb_texture_to_lin_rec709(vec3 color)
{
    bvec3 isAbove = greaterThan(color, vec3(0.04045));
    vec3 linSeg = color / 12.92;
    vec3 powSeg = pow(max(color + vec3(0.055), vec3(0.0)) / 1.055, vec3(2.4));
    return mix(linSeg, powSeg, isAbove);
}`),includes$1=[mx_transform_color],mx_srgb_texture_to_lin_rec709=glslFn("vec3 mx_srgb_texture_to_lin_rec709( vec3 color )",includes$1),mx_aastep=(e,t)=>{e=float(e),t=float(t);var r=vec2(t.dFdx(),t.dFdy()).length().mul(.7071067811865476);return smoothstep$1(e.sub(r),e.add(r),t)},_ramp=(e,t,r,i)=>mix(e,t,r[i].clamp()),mx_ramplr=(e,t,r=uv())=>_ramp(e,t,r,"x"),mx_ramptb=(e,t,r=uv())=>_ramp(e,t,r,"y"),_split=(e,t,r,i,n)=>mix(e,t,mx_aastep(r,i[n])),mx_splitlr=(e,t,r,i=uv())=>_split(e,t,r,i,"x"),mx_splittb=(e,t,r,i=uv())=>_split(e,t,r,i,"y"),mx_transform_uv=(e=1,t=0,r=uv())=>r.mul(e).add(t),mx_safepower=(e,t=1)=>(e=float(e)).abs().pow(t).mul(e.sign()),mx_contrast=(e,t=1,r=.5)=>float(e).sub(r).mul(t).add(r),mx_noise_float=(e=uv(),t=1,r=0)=>mx_perlin_noise_float(e.convert("vec2|vec3")).mul(t).add(r),mx_noise_vec2=(e=uv(),t=1,r=0)=>mx_perlin_noise_vec2(e.convert("vec2|vec3")).mul(t).add(r),mx_noise_vec3=(e=uv(),t=1,r=0)=>mx_perlin_noise_vec3(e.convert("vec2|vec3")).mul(t).add(r),mx_noise_vec4=(e=uv(),t=1,r=0)=>{return e=e.convert("vec2|vec3"),vec4(mx_perlin_noise_vec3(e),mx_perlin_noise_float(e.add(vec2(19,73)))).mul(t).add(r)},mx_worley_noise_float$1=(e=uv(),t=1)=>mx_worley_noise_float(e.convert("vec2|vec3"),t,1),mx_worley_noise_vec2$1=(e=uv(),t=1)=>mx_worley_noise_vec2(e.convert("vec2|vec3"),t,1),mx_worley_noise_vec3$1=(e=uv(),t=1)=>mx_worley_noise_vec3(e.convert("vec2|vec3"),t,1),mx_cell_noise_float$1=(e=uv())=>mx_cell_noise_float(e.convert("vec2|vec3")),mx_fractal_noise_float$1=(e=uv(),t=3,r=2,i=.5,n=1)=>mx_fractal_noise_float(e,t,r,i).mul(n),mx_fractal_noise_vec2$1=(e=uv(),t=3,r=2,i=.5,n=1)=>mx_fractal_noise_vec2(e,t,r,i).mul(n),mx_fractal_noise_vec3$1=(e=uv(),t=3,r=2,i=.5,n=1)=>mx_fractal_noise_vec3(e,t,r,i).mul(n),mx_fractal_noise_vec4$1=(e=uv(),t=3,r=2,i=.5,n=1)=>mx_fractal_noise_vec4(e,t,r,i).mul(n);var Nodes=Object.freeze({__proto__:null,NodeUtils:NodeUtils,ArrayUniformNode:ArrayUniformNode,AttributeNode:AttributeNode,attribute:attribute,BypassNode:BypassNode,bypass:bypass,CacheNode:CacheNode,cache:cache,ConstNode:ConstNode,ContextNode:ContextNode,context:context,label:label,IndexNode:IndexNode,vertexIndex:vertexIndex,instanceIndex:instanceIndex,LightingModel:LightingModel,Node:Node$2,addNodeClass:addNodeClass,createNodeFromType:createNodeFromType,NodeAttribute:NodeAttribute,NodeBuilder:NodeBuilder,NodeCache:NodeCache,NodeCode:NodeCode,NodeFrame:NodeFrame,NodeFunctionInput:NodeFunctionInput,NodeKeywords:NodeKeywords,NodeUniform:NodeUniform,NodeVar:NodeVar,NodeVarying:NodeVarying,PropertyNode:PropertyNode,property:property,output:output,diffuseColor:diffuseColor,roughness:roughness,metalness:metalness,specularColor:specularColor,shininess:shininess,StackNode:StackNode,stack:stack,TempNode:TempNode,UniformNode:UniformNode,uniform:uniform,VarNode:VarNode,temp:temp,VaryingNode:VaryingNode,varying:varying,MathNode:MathNode,EPSILON:EPSILON,INFINITY:INFINITY,radians:radians,degrees:degrees,exp:exp,exp2:exp2,log:log,log2:log2,sqrt:sqrt,inverseSqrt:inverseSqrt,floor:floor,ceil:ceil,normalize:normalize$1,fract:fract,sin:sin,cos:cos,tan:tan,asin:asin,acos:acos,atan:atan,abs:abs,sign:sign$1,length:length,negate:negate,oneMinus:oneMinus,dFdx:dFdx,dFdy:dFdy,round:round,reciprocal:reciprocal,trunc:trunc,fwidth:fwidth,atan2:atan2,min:min,max:max,mod:mod,step:step,reflect:reflect,distance:distance,difference:difference,dot:dot,cross:cross,pow:pow,pow2:pow2,pow3:pow3,pow4:pow4,transformDirection:transformDirection,mix:mix,clamp:clamp$1,saturate:saturate,refract:refract,smoothstep:smoothstep$1,faceForward:faceForward,OperatorNode:OperatorNode,add:add,sub:sub,mul:mul,div:div,remainder:remainder,equal:equal,assign:assign,lessThan:lessThan,greaterThan:greaterThan,lessThanEqual:lessThanEqual,greaterThanEqual:greaterThanEqual,and:and,or:or,xor:xor,bitAnd:bitAnd,bitOr:bitOr,bitXor:bitXor,shiftLeft:shiftLeft,shiftRight:shiftRight,CondNode:CondNode,cond:cond,ArrayElementNode:ArrayElementNode,ConvertNode:ConvertNode,DiscardNode:DiscardNode,discard:discard,EquirectUVNode:EquirectUVNode,equirectUV:equirectUV,JoinNode:JoinNode,LoopNode:LoopNode,loop:loop,MatcapUVNode:MatcapUVNode,matcapUV:matcapUV,MaxMipLevelNode:MaxMipLevelNode,maxMipLevel:maxMipLevel,OscNode:OscNode,oscSine:oscSine,oscSquare:oscSquare,oscTriangle:oscTriangle,oscSawtooth:oscSawtooth,PackingNode:PackingNode,directionToColor:directionToColor,colorToDirection:colorToDirection,RemapNode:RemapNode,remap:remap,remapClamp:remapClamp,RotateUVNode:RotateUVNode,rotateUV:rotateUV,SpecularMIPLevelNode:SpecularMIPLevelNode,specularMIPLevel:specularMIPLevel,SplitNode:SplitNode,SpriteSheetUVNode:SpriteSheetUVNode,spritesheetUV:spritesheetUV,TimerNode:TimerNode,timerLocal:timerLocal,timerGlobal:timerGlobal,timerDelta:timerDelta,frameId:frameId,TriplanarTexturesNode:TriplanarTexturesNode,triplanarTextures:triplanarTextures,triplanarTexture:triplanarTexture,BitangentNode:BitangentNode,bitangentGeometry:bitangentGeometry,bitangentLocal:bitangentLocal,bitangentView:bitangentView,bitangentWorld:bitangentWorld,transformedBitangentView:transformedBitangentView,transformedBitangentWorld:transformedBitangentWorld,BufferAttributeNode:BufferAttributeNode,bufferAttribute:bufferAttribute,dynamicBufferAttribute:dynamicBufferAttribute,instancedBufferAttribute:instancedBufferAttribute,instancedDynamicBufferAttribute:instancedDynamicBufferAttribute,BufferNode:BufferNode,buffer:buffer,CameraNode:CameraNode,cameraProjectionMatrix:cameraProjectionMatrix,cameraViewMatrix:cameraViewMatrix,cameraNormalMatrix:cameraNormalMatrix,cameraWorldMatrix:cameraWorldMatrix,cameraPosition:cameraPosition,cameraNear:cameraNear,cameraFar:cameraFar,CubeTextureNode:CubeTextureNode,cubeTexture:cubeTexture,ExtendedMaterialNode:ExtendedMaterialNode,materialNormal:materialNormal,InstanceNode:InstanceNode,instance:instance,MaterialNode:MaterialNode,materialAlphaTest:materialAlphaTest,materialColor:materialColor,materialShininess:materialShininess,materialEmissive:materialEmissive,materialOpacity:materialOpacity,materialSpecularColor:materialSpecularColor,materialReflectivity:materialReflectivity,materialRoughness:materialRoughness,materialMetalness:materialMetalness,materialRotation:materialRotation,materialSheen:materialSheen,materialSheenRoughness:materialSheenRoughness,MaterialReferenceNode:MaterialReferenceNode,materialReference:materialReference,MorphNode:MorphNode,morph:morph,TextureBicubicNode:TextureBicubicNode,textureBicubic:textureBicubic,ModelNode:ModelNode,modelDirection:modelDirection,modelViewMatrix:modelViewMatrix,modelNormalMatrix:modelNormalMatrix,modelWorldMatrix:modelWorldMatrix,modelPosition:modelPosition,modelViewPosition:modelViewPosition,modelScale:modelScale,ModelViewProjectionNode:ModelViewProjectionNode,modelViewProjection:modelViewProjection,NormalNode:NormalNode,normalGeometry:normalGeometry,normalLocal:normalLocal,normalView:normalView,normalWorld:normalWorld,transformedNormalView:transformedNormalView,transformedNormalWorld:transformedNormalWorld,transformedClearcoatNormalView:transformedClearcoatNormalView,Object3DNode:Object3DNode,objectDirection:objectDirection,objectViewMatrix:objectViewMatrix,objectNormalMatrix:objectNormalMatrix,objectWorldMatrix:objectWorldMatrix,objectPosition:objectPosition,objectScale:objectScale,objectViewPosition:objectViewPosition,PointUVNode:PointUVNode,pointUV:pointUV,PositionNode:PositionNode,positionGeometry:positionGeometry,positionLocal:positionLocal,positionWorld:positionWorld,positionWorldDirection:positionWorldDirection,positionView:positionView,positionViewDirection:positionViewDirection,ReferenceNode:ReferenceNode,reference:reference,ReflectVectorNode:ReflectVectorNode,reflectVector:reflectVector,SkinningNode:SkinningNode,skinning:skinning,SceneNode:SceneNode,backgroundBlurriness:backgroundBlurriness,backgroundIntensity:backgroundIntensity,StorageBufferNode:StorageBufferNode,storage:storage,TangentNode:TangentNode,tangentGeometry:tangentGeometry,tangentLocal:tangentLocal,tangentView:tangentView,tangentWorld:tangentWorld,transformedTangentView:transformedTangentView,transformedTangentWorld:transformedTangentWorld,TextureNode:TextureNode,texture:texture,sampler:sampler,UVNode:UVNode,uv:uv,UserDataNode:UserDataNode,userData:userData,BlendModeNode:BlendModeNode,burn:burn,dodge:dodge,overlay:overlay,screen:screen,ColorAdjustmentNode:ColorAdjustmentNode,saturation:saturation,vibrance:vibrance,hue:hue,lumaCoeffs:lumaCoeffs,luminance:luminance,ColorSpaceNode:ColorSpaceNode,linearToColorSpace:linearToColorSpace,colorSpaceToLinear:colorSpaceToLinear,linearTosRGB:linearTosRGB,sRGBToLinear:sRGBToLinear,FrontFacingNode:FrontFacingNode,frontFacing:frontFacing,faceDirection:faceDirection,NormalMapNode:NormalMapNode,normalMap:normalMap,TBNViewMatrix:TBNViewMatrix,PosterizeNode:PosterizeNode,posterize:posterize,ToneMappingNode:ToneMappingNode,toneMapping:toneMapping,ViewportNode:ViewportNode,viewportCoordinate:viewportCoordinate,viewportResolution:viewportResolution,viewportTopLeft:viewportTopLeft,viewportBottomLeft:viewportBottomLeft,viewportTopRight:viewportTopRight,viewportBottomRight:viewportBottomRight,ViewportTextureNode:ViewportTextureNode,viewportTexture:viewportTexture,viewportMipTexture:viewportMipTexture,ViewportSharedTextureNode:ViewportSharedTextureNode,viewportSharedTexture:viewportSharedTexture,ViewportDepthTextureNode:ViewportDepthTextureNode,viewportDepthTexture:viewportDepthTexture,ViewportDepthNode:ViewportDepthNode,viewZToOrthographicDepth:viewZToOrthographicDepth,orthographicDepthToViewZ:orthographicDepthToViewZ,viewZToPerspectiveDepth:viewZToPerspectiveDepth,perspectiveDepthToViewZ:perspectiveDepthToViewZ,depth:depth,depthTexture:depthTexture,ExpressionNode:ExpressionNode,expression:expression,CodeNode:CodeNode,code:code,js:js,wgsl:wgsl,glsl:glsl,FunctionCallNode:FunctionCallNode,call:call,FunctionNode:FunctionNode,wgslFn:wgslFn,glslFn:glslFn,ScriptableNode:ScriptableNode,scriptable:scriptable,global:global,ScriptableValueNode:ScriptableValueNode,scriptableValue:scriptableValue,FogNode:FogNode,fog:fog,FogRangeNode:FogRangeNode,rangeFog:rangeFog,FogExp2Node:FogExp2Node,densityFog:densityFog,RangeNode:RangeNode,range:range,ComputeNode:ComputeNode,compute:compute,LightNode:LightNode,lightTargetDirection:lightTargetDirection,PointLightNode:PointLightNode,DirectionalLightNode:DirectionalLightNode,SpotLightNode:SpotLightNode,IESSpotLightNode:IESSpotLightNode,AmbientLightNode:AmbientLightNode,LightsNode:LightsNode,lights:lights,lightsWithoutWrap:lightsWithoutWrap,addLightNode:addLightNode,LightingNode:LightingNode,LightingContextNode:LightingContextNode,lightingContext:lightingContext,HemisphereLightNode:HemisphereLightNode,EnvironmentNode:EnvironmentNode,AONode:AONode,AnalyticLightNode:AnalyticLightNode,CheckerNode:CheckerNode,checker:checker,NodeLoader:NodeLoader,NodeObjectLoader:NodeObjectLoader,NodeMaterialLoader:NodeMaterialLoader,GLSLNodeParser:GLSLNodeParser,BRDF_GGX:BRDF_GGX,BRDF_Lambert:BRDF_Lambert,D_GGX:D_GGX,DFGApprox:DFGApprox,F_Schlick:F_Schlick,V_GGX_SmithCorrelated:V_GGX_SmithCorrelated,getDistanceAttenuation:getDistanceAttenuation,getGeometryRoughness:getGeometryRoughness,getRoughness:getRoughness,PhongLightingModel:PhongLightingModel,PhysicalLightingModel:PhysicalLightingModel,NodeShaderStage:NodeShaderStage,NodeUpdateType:NodeUpdateType,NodeType:NodeType,defaultShaderStages:defaultShaderStages,defaultBuildStages:defaultBuildStages,shaderStages:shaderStages,vectorComponents:vectorComponents,addNodeElement:addNodeElement,getConstNodeType:getConstNodeType,ShaderNode:ShaderNode,nodeObject:nodeObject,nodeObjects:nodeObjects,nodeArray:nodeArray,nodeProxy:nodeProxy,nodeImmutable:nodeImmutable,shader:shader,tslFn:tslFn,color:color,float:float,int:int,uint:uint,bool:bool,vec2:vec2,ivec2:ivec2,uvec2:uvec2,bvec2:bvec2,vec3:vec3,ivec3:ivec3,uvec3:uvec3,bvec3:bvec3,vec4:vec4,ivec4:ivec4,uvec4:uvec4,bvec4:bvec4,mat3:mat3,imat3:imat3,umat3:umat3,bmat3:bmat3,mat4:mat4,imat4:imat4,umat4:umat4,bmat4:bmat4,string:string,arrayBuffer:arrayBuffer,element:element,convert:convert,split:split,NodeMaterial:NodeMaterial,addNodeMaterial:addNodeMaterial,createNodeMaterialFromType:createNodeMaterialFromType,LineBasicNodeMaterial:LineBasicNodeMaterial,MeshNormalNodeMaterial:MeshNormalNodeMaterial,MeshBasicNodeMaterial:MeshBasicNodeMaterial,MeshLambertNodeMaterial:MeshLambertNodeMaterial,MeshPhongNodeMaterial:MeshPhongNodeMaterial,MeshStandardNodeMaterial:MeshStandardNodeMaterial,MeshPhysicalNodeMaterial:MeshPhysicalNodeMaterial,PointsNodeMaterial:PointsNodeMaterial,SpriteNodeMaterial:SpriteNodeMaterial,mx_aastep:mx_aastep,mx_ramplr:mx_ramplr,mx_ramptb:mx_ramptb,mx_splitlr:mx_splitlr,mx_splittb:mx_splittb,mx_transform_uv:mx_transform_uv,mx_safepower:mx_safepower,mx_contrast:mx_contrast,mx_noise_float:mx_noise_float,mx_noise_vec2:mx_noise_vec2,mx_noise_vec3:mx_noise_vec3,mx_noise_vec4:mx_noise_vec4,mx_worley_noise_float:mx_worley_noise_float$1,mx_worley_noise_vec2:mx_worley_noise_vec2$1,mx_worley_noise_vec3:mx_worley_noise_vec3$1,mx_cell_noise_float:mx_cell_noise_float$1,mx_fractal_noise_float:mx_fractal_noise_float$1,mx_fractal_noise_vec2:mx_fractal_noise_vec2$1,mx_fractal_noise_vec3:mx_fractal_noise_vec3$1,mx_fractal_noise_vec4:mx_fractal_noise_vec4$1,mx_hsvtorgb:mx_hsvtorgb,mx_rgbtohsv:mx_rgbtohsv,mx_srgb_texture_to_lin_rec709:mx_srgb_texture_to_lin_rec709});const{ADD,SUB,MUL,DIV}=OperatorNode,buildNodeMaterial=(e,t,r)=>{var i,n=new Vector2(1,1),a=e.map.repeat,o={};for(i of["map","bumpMap","diffuseMap","roughnessMap","normalMap"])e[i]&&(o[i]=new TextureNode(e[i]),o[i].uv=new(void 0),o[i].uv.setUvTransform(n.x,n.y,a.x,a.y,MathUtils.degToRad(0)));var s,l=new MeshStandardNodeMaterial;return l.color=o.map||e.color,l.roughness=new(void 0)(e.roughness),l.metalness=new(void 0)(e.metalness),t&&(t.uv=new(void 0),t.uv.setUvTransform(1,1,r.x,r.y,MathUtils.degToRad(0)),r=new NormalMapNode(t),console.log(r),o.bumpMap?((s=new(void 0)(o.bumpMap)).toNormalMap=!0,s=new OperatorNode(r,s,ADD),new OperatorNode(s,new(void 0)(8421631),SUB),l.normal=t):(o.normalMap&&(s=new NormalMapNode(o.normalMap),r=new OperatorNode(r,s,ADD),s=new OperatorNode(r,new(void 0)(8421631),SUB),console.log(s)),l.normalMap=t),l.normalMap=l.normalMap||{},l.normalMap.scale=new(void 0)(e.normalScale)),l.needsUpdate=!0,l};class MaterialCategoryType extends BuildableComponent{constructor(e,t){super(e,t),checkPropTypes(t,{name:"string"},{})}_onTreeSet(){const t=this;this._tree.on("change",({cls:e=[]})=>{e.includes(MaterialCategory)&&(t.report({msg:"Material categories changed in package. Rebuilding."}),t._rebuild("main"))},this.id),this._rebuild("main")}_onTreeUnset(){this._tree.hasListener("change",this.id)&&this._tree.removeListener("change",this.id)}async _build(e,t){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":var r,i=this._tree?this._tree.materialCategories.filter(e=>e.settings.type===this):[];for(r of Component.qualities)this._setContent("main",r,i);this.report({msg:`Built material category type of ${i.length} material categories.`});break;default:this._setContent(e,t,null)}return this}}MaterialCategoryType._exportName={singular:"materialCategoryType",plural:"materialCategoryTypes"};class MaterialCategory extends BuildableComponent{constructor(e,t){super(e,t),checkPropTypes(t,{name:"string",type:MaterialCategoryType},{id:UUIDRegex})}_onTreeSet(){const t=this;this._tree.on("change",({cls:e=[]})=>{e.includes(WrappedMaterial)&&(t.report({msg:"Materials changed in package. Rebuilding."}),t._rebuild())},this.id),this._rebuild()}_onTreeUnset(){this._tree.hasListener("change",this.id)&&this._tree.removeListener("change",this.id)}async _build(e,t){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":var r=this._tree?this._tree.materials.filter(e=>(e.settings.categories||[]).find(e=>e===this)):[];this._setContent("main",t,r),this.report({msg:`Built category of ${r.length} materials.`});break;default:this._setContent(e,t,null)}return this}}MaterialCategory._exportName={singular:"materialCategory",plural:"materialCategories"};var durl=function(e){return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};try{URL.revokeObjectURL(durl(""))}catch(e){durl=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}for(var u8=Uint8Array,u16=Uint16Array,u32=Uint32Array,fleb=new u8([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fdeb=new u8([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),clim=new u8([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),freb=function(e,t){for(var r=new u16(31),i=0;i<31;++i)r[i]=t+=1<<e[i-1];for(var n=new u32(r[30]),i=1;i<30;++i)for(var a=r[i];a<r[i+1];++a)n[a]=a-r[i]<<5|i;return[r,n]},_a=freb(fleb,2),fl=_a[0],revfl=_a[1],_b=(fl[28]=258,revfl[258]=28,freb(fdeb,0)),fd=_b[0],revfd=_b[1],rev=new u16(32768),i$1=0;i$1<32768;++i$1){var x=(52428&(x=(43690&i$1)>>>1|(21845&i$1)<<1))>>>2|(13107&x)<<2;rev[i$1]=((65280&(x=(61680&x)>>>4|(3855&x)<<4))>>>8|(255&x)<<8)>>>1}for(var hMap=function(e,t,r){for(var i=e.length,n=0,a=new u16(t);n<i;++n)++a[e[n]-1];var o=new u16(t);for(n=0;n<t;++n)o[n]=o[n-1]+a[n-1]<<1;if(r){for(var s=new u16(1<<t),l=15-t,n=0;n<i;++n)if(e[n])for(var c=n<<4|e[n],d=t-e[n],h=o[e[n]-1]++<<d,u=h|(1<<d)-1;h<=u;++h)s[rev[h]>>>l]=c}else for(s=new u16(i),n=0;n<i;++n)e[n]&&(s[n]=rev[o[e[n]-1]++]>>>15-e[n]);return s},flt=new u8(288),i$1=0;i$1<144;++i$1)flt[i$1]=8;for(i$1=144;i$1<256;++i$1)flt[i$1]=9;for(i$1=256;i$1<280;++i$1)flt[i$1]=7;for(i$1=280;i$1<288;++i$1)flt[i$1]=8;for(var fdt=new u8(32),i$1=0;i$1<32;++i$1)fdt[i$1]=5;var flm=hMap(flt,9,0),flrm=hMap(flt,9,1),fdm=hMap(fdt,5,0),fdrm=hMap(fdt,5,1),max$2=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},bits=function(e,t,r){var i=t/8|0;return(e[i]|e[1+i]<<8)>>(7&t)&r},bits16=function(e,t){var r=t/8|0;return(e[r]|e[1+r]<<8|e[2+r]<<16)>>(7&t)},shft=function(e){return(e/8|0)+(7&e&&1)},slc=function(e,t,r){(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length);var i=new(e instanceof u16?u16:e instanceof u32?u32:u8)(r-t);return i.set(e.subarray(t,r)),i},inflt=function(e,r,t){var i=e.length;if(!i||t&&!t.l&&i<5)return r||new u8(0);function n(e){var t=r.length;t<e&&((t=new u8(Math.max(2*t,e))).set(r),r=t)}var a=!r||t,o=!t||t.i,s=(t=t||{},r=r||new u8(3*i),t.f||0),l=t.p||0,c=t.b||0,d=t.l,h=t.d,u=t.m,A=t.n,p=8*i;do{if(!d){t.f=s=bits(e,l,1);var m=bits(e,l+1,3);if(l+=3,!m){var f=e[(w=shft(l)+4)-4]|e[w-3]<<8,g=w+f;if(i<g){if(o)throw"unexpected EOF";break}a&&n(c+f),r.set(e.subarray(w,g),c),t.b=c+=f,t.p=l=8*g;continue}if(1==m)d=flrm,h=fdrm,u=9,A=5;else{if(2!=m)throw"invalid block type";for(var f=bits(e,l,31)+257,v=bits(e,l+10,15)+4,_=f+bits(e,l+5,31)+1,y=(l+=14,new u8(_)),E=new u8(19),T=0;T<v;++T)E[clim[T]]=bits(e,l+3*T,7);l+=3*v;for(var g=max$2(E),x=(1<<g)-1,b=hMap(E,g,1),T=0;T<_;){var w,C=b[bits(e,l,x)];if(l+=15&C,(w=C>>>4)<16)y[T++]=w;else{var S=0,M=0;for(16==w?(M=3+bits(e,l,3),l+=2,S=y[T-1]):17==w?(M=3+bits(e,l,7),l+=3):18==w&&(M=11+bits(e,l,127),l+=7);M--;)y[T++]=S}}var m=y.subarray(0,f),B=y.subarray(f),u=max$2(m),A=max$2(B),d=hMap(m,u,1),h=hMap(B,A,1)}if(p<l){if(o)throw"unexpected EOF";break}}a&&n(c+131072);for(var P=(1<<u)-1,O=(1<<A)-1,N=l;;N=l){var R=(S=d[bits16(e,l)&P])>>>4;if(p<(l+=15&S)){if(o)throw"unexpected EOF";break}if(!S)throw"invalid length/literal";if(R<256)r[c++]=R;else{if(256==R){N=l,d=null;break}var L=R-254,R=(264<R&&(I=fleb[T=R-257],L=bits(e,l,(1<<I)-1)+fl[T],l+=I),h[bits16(e,l)&O]),U=R>>>4;if(!R)throw"invalid distance";l+=15&R;var I,B=fd[U];if(3<U&&(I=fdeb[U],B+=bits16(e,l)&(1<<I)-1,l+=I),p<l){if(o)throw"unexpected EOF";break}a&&n(c+131072);for(var F=c+L;c<F;c+=4)r[c]=r[c-B],r[c+1]=r[c+1-B],r[c+2]=r[c+2-B],r[c+3]=r[c+3-B];c=F}}t.l=d,t.p=N,t.b=c,d&&(s=1,t.m=u,t.d=h,t.n=A)}while(!s);return c==r.length?r:slc(r,0,c)},wbits=function(e,t,r){var i=t/8|0;e[i]|=r<<=7&t,e[1+i]|=r>>>8},wbits16=function(e,t,r){var i=t/8|0;e[i]|=r<<=7&t,e[1+i]|=r>>>8,e[2+i]|=r>>>16},hTree=function(e,t){for(var r=[],i=0;i<e.length;++i)e[i]&&r.push({s:i,f:e[i]});var n=r.length,a=r.slice();if(!n)return[et,0];if(1==n)return(m=new u8(r[0].s+1))[r[0].s]=1,[m,1];r.sort(function(e,t){return e.f-t.f}),r.push({s:-1,f:25001});var o=r[0],s=r[1],l=0,c=1,d=2;for(r[0]={s:-1,f:o.f+s.f,l:o,r:s};c!=n-1;)o=r[r[l].f<r[d].f?l++:d++],s=r[l!=c&&r[l].f<r[d].f?l++:d++],r[c++]={s:-1,f:o.f+s.f,l:o,r:s};for(var h=a[0].s,i=1;i<n;++i)a[i].s>h&&(h=a[i].s);var u=new u16(h+1),A=ln(r[c-1],u,0);if(t<A){var i=0,p=0,m=A-t,f=1<<m;for(a.sort(function(e,t){return u[t.s]-u[e.s]||e.f-t.f});i<n;++i){var g=a[i].s;if(!(u[g]>t))break;p+=f-(1<<A-u[g]),u[g]=t}for(p>>>=m;0<p;){var v=a[i].s;u[v]<t?p-=1<<t-u[v]++-1:++i}for(;0<=i&&p;--i){var _=a[i].s;u[_]==t&&(--u[_],++p)}A=t}return[new u8(u),A]},ln=function(e,t,r){return-1==e.s?Math.max(ln(e.l,t,r+1),ln(e.r,t,r+1)):t[e.s]=r},lc=function(e){for(var t=e.length;t&&!e[--t];);function r(e){i[n++]=e}for(var i=new u16(++t),n=0,a=e[0],o=1,s=1;s<=t;++s)if(e[s]==a&&s!=t)++o;else{if(!a&&2<o){for(;138<o;o-=138)r(32754);2<o&&(r(10<o?o-11<<5|28690:o-3<<5|12305),o=0)}else if(3<o){for(r(a),--o;6<o;o-=6)r(8304);2<o&&(r(o-3<<5|8208),o=0)}for(;o--;)r(a);o=1,a=e[s]}return[i.subarray(0,n),t]},clen=function(e,t){for(var r=0,i=0;i<t.length;++i)r+=e[i]*t[i];return r},wfblk=function(e,t,r){var i=r.length,n=shft(t+2);e[n]=255&i,e[n+1]=i>>>8,e[n+2]=255^e[n],e[n+3]=255^e[n+1];for(var a=0;a<i;++a)e[n+a+4]=r[a];return 8*(n+4+i)},wblk=function(e,t,r,i,n,a,o,s,l,c,d){wbits(t,d++,r),++n[256];for(var r=hTree(n,15),h=r[0],r=r[1],u=hTree(a,15),A=u[0],u=u[1],p=lc(h),m=p[0],p=p[1],f=lc(A),g=f[0],f=f[1],v=new u16(19),_=0;_<m.length;++_)v[31&m[_]]++;for(_=0;_<g.length;++_)v[31&g[_]]++;for(var y=hTree(v,7),E=y[0],y=y[1],T=19;4<T&&!E[clim[T-1]];--T);var x=c+5<<3,b=clen(n,flt)+clen(a,fdt)+o,n=clen(n,h)+clen(a,A)+o+14+3*T+clen(v,E)+(2*v[16]+3*v[17]+7*v[18]);if(x<=b&&x<=n)return wfblk(t,d,e.subarray(l,l+c));if(wbits(t,d,1+(n<b)),d+=2,n<b){var w=hMap(h,r,0),C=h,S=hMap(A,u,0),M=A,B=hMap(E,y,0);wbits(t,d,p-257),wbits(t,d+5,f-1),wbits(t,d+10,T-4),d+=14;for(_=0;_<T;++_)wbits(t,d+3*_,E[clim[_]]);d+=3*T;for(var N=[m,g],R=0;R<2;++R)for(var L=N[R],_=0;_<L.length;++_){var U=31&L[_];wbits(t,d,B[U]),d+=E[U],15<U&&(wbits(t,d,L[_]>>>5&127),d+=L[_]>>>12)}}else w=flm,C=flt,S=fdm,M=fdt;for(var I,_=0;_<s;++_)255<i[_]?(U=i[_]>>>18&31,wbits16(t,d,w[U+257]),d+=C[U+257],7<U&&(wbits(t,d,i[_]>>>23&31),d+=fleb[U]),I=31&i[_],wbits16(t,d,S[I]),d+=M[I],3<I&&(wbits16(t,d,i[_]>>>5&8191),d+=fdeb[I])):(wbits16(t,d,w[i[_]]),d+=C[i[_]]);return wbits16(t,d,w[256]),d+C[256]},deo=new u32([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),et=new u8(0),dflt=function(t,e,r,i,n,a){var o=t.length,s=new u8(i+o+5*(1+Math.ceil(o/7e3))+n),l=s.subarray(i,s.length-n),c=0;if(!e||o<8)for(var d=0;d<=o;d+=65535)var h=d+65535,c=h<o?wfblk(l,c,t.subarray(d,h)):(l[d]=a,wfblk(l,c,t.subarray(d,o)));else{function u(e){return(t[e]^t[e+1]<<f^t[e+2]<<D)&A}for(var e=deo[e-1],P=e>>>13,O=8191&e,A=(1<<r)-1,p=new u16(32768),m=new u16(1+A),f=Math.ceil(r/3),D=2*f,g=new u32(25e3),v=new u16(288),_=new u16(32),y=0,E=0,d=0,T=0,x=0,b=0;d<o;++d){var w=u(d),C=32767&d,S=m[w];if(p[C]=S,m[w]=C,x<=d){var M=o-d;if((7e3<y||24576<T)&&423<M){c=wblk(t,l,0,g,v,_,E,T,b,d-b,c);for(var T=y=E=0,b=d,B=0;B<286;++B)v[B]=0;for(B=0;B<30;++B)_[B]=0}var N=2,R=0,H=O,L=C-S&32767;if(2<M&&w==u(d-L))for(var k=Math.min(P,M)-1,V=Math.min(32767,d),Q=Math.min(258,M);L<=V&&--H&&C!=S;){if(t[d+N]==t[d+N-L]){for(var U=0;U<Q&&t[d+U]==t[d+U-L];++U);if(N<U){if(R=L,k<(N=U))break;for(var G=Math.min(L,U-2),I=0,B=0;B<G;++B){var F=d-L+B+32768&32767,z=F-p[F]+32768&32767;I<z&&(I=z,S=F)}}}L+=(C=S)-(S=p[C])+32768&32767}R?(g[T++]=268435456|revfl[N]<<18|revfd[R],w=31&revfl[N],M=31&revfd[R],E+=fleb[w]+fdeb[M],++v[257+w],++_[M],x=d+N,++y):(g[T++]=t[d],++v[t[d]])}}c=wblk(t,l,a,g,v,_,E,T,b,d-b,c),!a&&7&c&&(c=wfblk(l,c+1,et))}return slc(s,0,i+shft(c)+n)},crct=function(){for(var e=new u32(256),t=0;t<256;++t){for(var r=t,i=9;--i;)r=(1&r&&3988292384)^r>>>1;e[t]=r}return e}(),crc=function(){var i=-1;return{p:function(e){for(var t=i,r=0;r<e.length;++r)t=crct[255&t^e[r]]^t>>>8;i=t},d:function(){return~i}}},dopt=function(e,t,r,i,n){return dflt(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,r,i,!n)},mrg=function(e,t){var r,i={};for(r in e)i[r]=e[r];for(r in t)i[r]=t[r];return i},wbytes=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},zlv=function(e){if(8!=(15&e[0])||7<e[0]>>>4||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function deflateSync(e,t){return dopt(e,t||{},0,0)}function unzlibSync(e,t){return inflt((zlv(e),e.subarray(2,-4)),t)}var fltn=function(e,t,r,i){for(var n in e){var a=e[n],n=t+n;a instanceof u8?r[n]=[a,i]:Array.isArray(a)?r[n]=[a[0],mrg(i,a[1])]:fltn(a,n+"/",r,i)}},te="undefined"!=typeof TextEncoder&&new TextEncoder,td="undefined"!=typeof TextDecoder&&new TextDecoder,tds=0;try{td.decode(et,{stream:!0}),tds=1}catch(e){}function strToU8(e,t){if(t){for(var r=new u8(e.length),i=0;i<e.length;++i)r[i]=e.charCodeAt(i);return r}if(te)return te.encode(e);function n(e){o[s++]=e}for(var a=e.length,o=new u8(e.length+(e.length>>1)),s=0,i=0;i<a;++i){s+5>o.length&&((l=new u8(s+8+(a-i<<1))).set(o),o=l);var l=e.charCodeAt(i);l<128||t?n(l):(l<2048?n(192|l>>6):(55295<l&&l<57344?(n(240|(l=65536+(1047552&l)|1023&e.charCodeAt(++i))>>18),n(128|l>>12&63)):n(224|l>>12),n(128|l>>6&63)),n(128|63&l))}return slc(o,0,s)}var exfl=function(e){var t=0;if(e)for(var r in e){r=e[r].length;if(65535<r)throw"extra field too long";t+=r+4}return t},wzh=function(e,t,r,i,n,a,o,s){var l=i.length,c=r.extra,d=s&&s.length,h=exfl(c),n=(wbytes(e,t,null!=o?33639248:67324752),t+=4,null!=o&&(e[t++]=20,e[t++]=r.os),e[t]=20,t+=2,e[t++]=r.flag<<1|(null==a&&8),e[t++]=n&&8,e[t++]=255&r.compression,e[t++]=r.compression>>8,new Date(null==r.mtime?Date.now():r.mtime)),u=n.getFullYear()-1980;if(u<0||119<u)throw"date not in range 1980-2099";if(wbytes(e,t,u<<25|n.getMonth()+1<<21|n.getDate()<<16|n.getHours()<<11|n.getMinutes()<<5|n.getSeconds()>>>1),t+=4,null!=a&&(wbytes(e,t,r.crc),wbytes(e,t+4,a),wbytes(e,t+8,r.size)),wbytes(e,t+12,l),wbytes(e,t+14,h),t+=16,null!=o&&(wbytes(e,t,d),wbytes(e,t+6,r.attrs),wbytes(e,t+10,o),t+=14),e.set(i,t),t+=l,h)for(var A in c){var p=c[A],m=p.length;wbytes(e,t,+A),wbytes(e,t+2,m),e.set(p,t+4),t+=4+m}return d&&(e.set(s,t),t+=d),t},wzf=function(e,t,r,i,n){wbytes(e,t,101010256),wbytes(e,t+8,r),wbytes(e,t+10,r),wbytes(e,t+12,i),wbytes(e,t+16,n)};function zipSync(e,t){var r,i={},n=[],a=(fltn(e,"",i,t=t||{}),0),o=0;for(r in i){var s=i[r],l=s[0],s=s[1],c=0==s.level?0:8,d=(y=strToU8(r)).length,h=s.comment,u=h&&strToU8(h),A=u&&u.length,p=exfl(s.extra);if(65535<d)throw"filename too long";var m=c?deflateSync(l,s):l,f=m.length,g=crc();g.p(l),n.push(mrg(s,{size:l.length,crc:g.d(),c:m,f:y,m:u,u:d!=r.length||u&&h.length!=A,o:a,compression:c})),a+=30+d+p+f,o+=76+2*(d+p)+(A||0)+f}for(var v=new u8(o+22),e=a,t=o-a,_=0;_<n.length;++_){wzh(v,(y=n[_]).o,y,y.f,y.u,y.c.length);var y,E=30+y.f.length+exfl(y.extra);v.set(y.c,y.o+E),wzh(v,a,y,y.f,y.u,y.c.length,y.o,y.m),a+=16+E+(y.m?y.m.length:0)}return wzf(v,a,n.length,t,e),v}class EXRLoader extends DataTextureLoader$1{constructor(e){super(e),this.type=HalfFloatType$1}parse(e){const Q=65536,G=Q>>3;const U=14,I=65537,F=1<<U,P=F-1;const l=32768,r=65535,p=59,m=63,v=2+m-p,c=8,s=4,d=4,J=2,h=1,N=0,R=1,L=0,V=1,Y=2,ee=Math.pow(2.7182818,2.2);const f={l:0,c:0,lc:0};function _(e,t,r,i,n){for(;r<e;)t=t<<8|oe(i,n),r+=8;r-=e,f.l=t>>r&(1<<e)-1,f.c=t,f.lc=r}const g=new Array(59);function q(t,r,i,n,a,o){var s=r;let l=0,c=0;for(;n<=a;n++){if(s.value-r.value>i)return;_(6,l,c,t,s);var d=f.l;if(l=f.c,c=f.lc,(o[n]=d)==m){if(s.value-r.value>i)throw new Error("Something wrong with hufUnpackEncTable");_(8,l,c,t,s);let e=f.l+v;if(l=f.c,c=f.lc,n+e>a+1)throw new Error("Something wrong with hufUnpackEncTable");for(;e--;)o[n++]=0;n--}else if(d>=p){let e=d-p+2;if(n+e>a+1)throw new Error("Something wrong with hufUnpackEncTable");for(;e--;)o[n++]=0;n--}}{var h=o;for(let e=0;e<=58;++e)g[e]=0;for(let e=0;e<I;++e)g[h[e]]+=1;let t=0;for(let e=58;0<e;--e){var u=t+g[e]>>1;g[e]=t,t=u}for(let e=0;e<I;++e){var A=h[e];0<A&&(h[e]=A|g[A]++<<6)}}}const O={c:0,lc:0};function D(e,t,r,i){e=e<<8|oe(r,i),t+=8,O.c=e,O.lc=t}const H={c:0,lc:0};function k(e,t,r,i,n,a,o,s,l){if(e==t){i<8&&(D(r,i,n,a),r=O.c,i=O.lc);let e=r>>(i-=8);if(e=new Uint8Array([e])[0],s.value+e>l)return;for(var c=o[s.value-1];0<e--;)o[s.value++]=c}else{if(!(s.value<l))return;o[s.value++]=e}H.c=r,H.lc=i}function i(e){return 65535&e}function u(e){e=i(e);return 32767<e?e-65536:e}const z={a:0,b:0};function $(e,t){var e=u(e),t=u(t),e=e+(1&t)+(t>>1),r=e,e=e-t;z.a=r,z.b=e}function W(e,t){e=i(e),t=i(t),e=e-(t>>1)&r,t=t+e-l&r;z.a=t,z.b=e}function te(e,i,n,a,o,s){var l=n.value,t=K(i,n),c=K(i,n),i=(n.value+=4,K(i,n));if(n.value+=4,t<0||t>=I||c<0||c>=I)throw new Error("Something wrong with HUF_ENCSIZE");var d=new Array(I),h=new Array(F),r=h;for(let e=0;e<F;e++)r[e]={},r[e].len=0,r[e].lit=0,r[e].p=null;if(q(e,n,a-(n.value-l),t,c,d),i>8*(a-(n.value-l)))throw new Error("Something wrong with hufUncompress");for(var u=d,A=t,p=c,m=h;A<=p;A++){var f=u[A]>>6,g=63&u[A];if(f>>g)throw new Error("Invalid table entry");if(g>U){var v=m[f>>g-U];if(v.len)throw new Error("Invalid table entry");if(v.lit++,v.p){var _=v.p;v.p=new Array(v.lit);for(let e=0;e<v.lit-1;++e)v.p[e]=_[e]}else v.p=new Array(1);v.p[v.lit-1]=A}else if(g){let t=0;for(let e=1<<U-g;0<e;e--){var y=m[(f<<U-g)+t];if(y.len||y.p)throw new Error("Invalid table entry");y.len=g,y.lit=A,t++}}}{var E=d,T=h,x=e,b=n,w=(a=i,c),C=o,S={value:0};let t=0,r=0;for(var M=l=s,B=Math.trunc(b.value+(a+7)/8);b.value<B;)for(D(t,r,x,b),t=O.c,r=O.lc;r>=U;){var N=T[t>>r-U&P];if(N.len)r-=N.len,k(N.lit,w,t,r,x,b,C,S,M),t=H.c,r=H.lc;else{if(!N.p)throw new Error("hufDecode issues");let e;for(e=0;e<N.lit;e++){for(var R=63&E[N.p[e]];r<R&&b.value<B;)D(t,r,x,b),t=O.c,r=O.lc;if(r>=R&&E[N.p[e]]>>6==(t>>r-R&(1<<R)-1)){r-=R,k(N.p[e],w,t,r,x,b,C,S,M),t=H.c,r=H.lc;break}}if(e==N.lit)throw new Error("hufDecode issues")}}for(l=8-a&7,t>>=l,r-=l;0<r;){var L=T[t<<U-r&P];if(!L.len)throw new Error("hufDecode issues");r-=L.len,k(L.lit,w,t,r,x,b,C,S,M),t=H.c,r=H.lc}}}function A(t){for(let e=1;e<t.length;e++){var r=t[e-1]+t[e]-128;t[e]=r}}function y(e,t){let r=0,i=Math.floor((e.length+1)/2),n=0;for(var a=e.length-1;!(n>a)&&(t[n++]=e[r++],!(n>a));)t[n++]=e[i++]}function re(e){let t=e.byteLength;var r=new Array;let i=0;for(var n=new DataView(e);0<t;){var a=n.getInt8(i++);if(a<0){var o=-a;t-=1+o;for(let e=0;e<o;e++)r.push(n.getUint8(i++))}else{var s=a,l=(t-=2,n.getUint8(i++));for(let e=0;e<s+1;e++)r.push(l)}}return r}function ie(s,n,e,H,k,t){let l=new DataView(t.buffer);var c,d,r=e[s.idx[0]].width,i=e[s.idx[0]].height,h=Math.floor(r/8),u=Math.ceil(r/8),A=Math.ceil(i/8),V=r-8*(u-1),Q=i-8*(A-1),G={value:0},p=new Array(3),m=new Array(3),f=new Array(3),g=new Array(3),v=new Array(3);for(let e=0;e<3;++e)v[e]=n[s.idx[e]],p[e]=e<1?0:p[e-1]+u*A,m[e]=new Float32Array(64),f[e]=new Uint16Array(64),g[e]=new Uint16Array(64*u);for(let o=0;o<A;++o){let i=8,n=(o==A-1&&(i=Q),8);for(let t=0;t<u;++t){t==u-1&&(n=V);for(let r=0;r<3;++r){f[r].fill(0),f[r][0]=k[p[r]++];{_=void 0;z=void 0;$=void 0;var _=G;var z=H;var $=f[r];let e,t=1;for(;t<64;)65280==(e=z[_.value])?t=64:e>>8==255?t+=255&e:($[t]=e,t++),_.value++}c=f[r],(d=m[r])[0]=Z(c[0]),d[1]=Z(c[1]),d[2]=Z(c[5]),d[3]=Z(c[6]),d[4]=Z(c[14]),d[5]=Z(c[15]),d[6]=Z(c[27]),d[7]=Z(c[28]),d[8]=Z(c[2]),d[9]=Z(c[4]),d[10]=Z(c[7]),d[11]=Z(c[13]),d[12]=Z(c[16]),d[13]=Z(c[26]),d[14]=Z(c[29]),d[15]=Z(c[42]),d[16]=Z(c[3]),d[17]=Z(c[8]),d[18]=Z(c[12]),d[19]=Z(c[17]),d[20]=Z(c[25]),d[21]=Z(c[30]),d[22]=Z(c[41]),d[23]=Z(c[43]),d[24]=Z(c[9]),d[25]=Z(c[11]),d[26]=Z(c[18]),d[27]=Z(c[24]),d[28]=Z(c[31]),d[29]=Z(c[40]),d[30]=Z(c[44]),d[31]=Z(c[53]),d[32]=Z(c[10]),d[33]=Z(c[19]),d[34]=Z(c[23]),d[35]=Z(c[32]),d[36]=Z(c[39]),d[37]=Z(c[45]),d[38]=Z(c[52]),d[39]=Z(c[54]),d[40]=Z(c[20]),d[41]=Z(c[22]),d[42]=Z(c[33]),d[43]=Z(c[38]),d[44]=Z(c[46]),d[45]=Z(c[51]),d[46]=Z(c[55]),d[47]=Z(c[60]),d[48]=Z(c[21]),d[49]=Z(c[34]),d[50]=Z(c[37]),d[51]=Z(c[47]),d[52]=Z(c[50]),d[53]=Z(c[56]),d[54]=Z(c[59]),d[55]=Z(c[61]),d[56]=Z(c[35]),d[57]=Z(c[36]),d[58]=Z(c[48]),d[59]=Z(c[49]),d[60]=Z(c[57]),d[61]=Z(c[58]),d[62]=Z(c[62]),d[63]=Z(c[63]),L=R=N=B=M=S=C=w=b=x=T=E=y=void 0;var y=m[r],E=.5*Math.cos(.7853975),T=.5*Math.cos(.196349375),x=.5*Math.cos(.39269875),b=.5*Math.cos(3*3.14159/16),w=.5*Math.cos(.981746875),C=.5*Math.cos(3*3.14159/8),S=.5*Math.cos(1.374445625),M=new Array(4),B=new Array(4),N=new Array(4),R=new Array(4);for(let e=0;e<8;++e){var L=8*e;M[0]=x*y[2+L],M[1]=C*y[2+L],M[2]=x*y[6+L],M[3]=C*y[6+L],B[0]=T*y[1+L]+b*y[3+L]+w*y[5+L]+S*y[7+L],B[1]=b*y[1+L]-S*y[3+L]-T*y[5+L]-w*y[7+L],B[2]=w*y[1+L]-T*y[3+L]+S*y[5+L]+b*y[7+L],B[3]=S*y[1+L]-w*y[3+L]+b*y[5+L]-T*y[7+L],N[0]=E*(y[0+L]+y[4+L]),N[3]=E*(y[0+L]-y[4+L]),N[1]=M[0]+M[3],N[2]=M[1]-M[2],R[0]=N[0]+N[1],R[1]=N[3]+N[2],R[2]=N[3]-N[2],R[3]=N[0]-N[1],y[0+L]=R[0]+B[0],y[1+L]=R[1]+B[1],y[2+L]=R[2]+B[2],y[3+L]=R[3]+B[3],y[4+L]=R[3]-B[3],y[5+L]=R[2]-B[2],y[6+L]=R[1]-B[1],y[7+L]=R[0]-B[0]}for(let e=0;e<8;++e)M[0]=x*y[16+e],M[1]=C*y[16+e],M[2]=x*y[48+e],M[3]=C*y[48+e],B[0]=T*y[8+e]+b*y[24+e]+w*y[40+e]+S*y[56+e],B[1]=b*y[8+e]-S*y[24+e]-T*y[40+e]-w*y[56+e],B[2]=w*y[8+e]-T*y[24+e]+S*y[40+e]+b*y[56+e],B[3]=S*y[8+e]-w*y[24+e]+b*y[40+e]-T*y[56+e],N[0]=E*(y[e]+y[32+e]),N[3]=E*(y[e]-y[32+e]),N[1]=M[0]+M[3],N[2]=M[1]-M[2],R[0]=N[0]+N[1],R[1]=N[3]+N[2],R[2]=N[3]-N[2],R[3]=N[0]-N[1],y[0+e]=R[0]+B[0],y[8+e]=R[1]+B[1],y[16+e]=R[2]+B[2],y[24+e]=R[3]+B[3],y[32+e]=R[3]-B[3],y[40+e]=R[2]-B[2],y[48+e]=R[1]-B[1],y[56+e]=R[0]-B[0]}P=F=I=U=void 0;var U=m;for(let e=0;e<64;++e){var I=U[0][e],F=U[1][e],P=U[2][e];U[0][e]=I+1.5747*P,U[1][e]=I-.1873*F-.4682*P,U[2][e]=I+1.8556*F}for(let e=0;e<3;++e){j=K=W=void 0;var W=m[e],K=g[e],j=64*t;for(let e=0;e<64;++e)K[j+e]=DataUtils$1.toHalfFloat(function(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(ee,Math.abs(e)-1)}(W[e]))}}let a=0;for(let r=0;r<3;++r){var O=e[s.idx[r]].type;for(let t=8*o;t<8*o+i;++t){a=v[r][t];for(let e=0;e<h;++e){var D=64*e+8*(7&t);l.setUint16(a+0*J*O,g[r][D],!0),l.setUint16(a+ +J*O,g[r][1+D],!0),l.setUint16(a+2*J*O,g[r][2+D],!0),l.setUint16(a+3*J*O,g[r][3+D],!0),l.setUint16(a+4*J*O,g[r][4+D],!0),l.setUint16(a+5*J*O,g[r][5+D],!0),l.setUint16(a+6*J*O,g[r][6+D],!0),l.setUint16(a+7*J*O,g[r][7+D],!0),a+=8*J*O}}if(h!=u)for(let e=8*o;e<8*o+i;++e){var X=v[r][e]+8*h*J*O,Y=64*h+8*(7&e);for(let e=0;e<n;++e)l.setUint16(X+e*J*O,g[r][Y+e],!0)}}}var a=new Uint16Array(r);l=new DataView(t.buffer);for(let t=0;t<3;++t){e[s.idx[t]].decoded=!0;var o=e[s.idx[t]].type;if(2==e[t].type)for(let e=0;e<i;++e){var q=v[t][e];for(let e=0;e<r;++e)a[e]=l.getUint16(q+e*J*o,!0);for(let e=0;e<r;++e)l.setFloat32(q+e*J*o,Z(a[e]),!0)}}}function x(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function b(e){var e=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),e=new Uint8Array(re(e)),t=new Uint8Array(e.length);return A(e),y(e,t),new DataView(t.buffer)}function C(e){var e=unzlibSync(e.array.slice(e.offset.value,e.offset.value+e.size)),t=new Uint8Array(e.length);return A(e),y(e,t),new DataView(t.buffer)}function w(r){var t=r.viewer,i={value:r.offset.value},n=new Uint16Array(r.width*r.scanlineBlockSize*(r.channels*r.type)),a=new Uint8Array(G);let o=0;var s=new Array(r.channels);for(let e=0;e<r.channels;e++)s[e]={},s[e].start=o,s[e].end=s[e].start,s[e].nx=r.width,s[e].ny=r.lines,s[e].size=r.type,o+=s[e].nx*s[e].ny*s[e].size;var l=X(t,i),c=X(t,i);if(c>=G)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(l<=c)for(let e=0;e<c-l+1;e++)a[e+l]=j(t,i);var e=new Uint16Array(Q),P=function(t,r){let i=0;for(let e=0;e<Q;++e)(0==e||t[e>>3]&1<<(7&e))&&(r[i++]=e);for(var e=i-1;i<Q;)r[i++]=0;return e}(a,e),O=K(t,i);te(r.array,t,i,O,n,o);for(let t=0;t<r.channels;++t){var d=s[t];for(let e=0;e<s[t].size;++e){h=void 0;u=void 0;A=void 0;p=void 0;m=void 0;f=void 0;g=void 0;v=void 0;_=void 0;y=void 0;E=void 0;T=void 0;x=void 0;b=void 0;C=void 0;S=void 0;M=void 0;B=void 0;w=void 0;N=void 0;R=void 0;var h=n;var u=d.start+e;var A=d.nx;var p=d.size;var m=d.ny;var f=d.nx*d.size;var g=P;var v=g<16384,_=m<A?m:A;let a=1,o,s;for(;a<=_;)a<<=1;for(a>>=1,o=a,a>>=1;1<=a;){var y=(s=0)+f*(m-o),E=f*a,T=f*o,x=p*a,b=p*o;let t,r,i,n;for(;s<=y;s+=T){let e=s;for(var w,C=s+p*(A-o);e<=C;e+=b){var S=e+x,M=e+E,B=M+x;(v?($(h[e+u],h[M+u]),t=z.a,i=z.b,$(h[S+u],h[B+u]),r=z.a,n=z.b,$(t,r),h[e+u]=z.a,h[S+u]=z.b,$):(W(h[e+u],h[M+u]),t=z.a,i=z.b,W(h[S+u],h[B+u]),r=z.a,n=z.b,W(t,r),h[e+u]=z.a,h[S+u]=z.b,W))(i,n),h[M+u]=z.a,h[B+u]=z.b}A&a&&(w=e+E,(v?$:W)(h[e+u],h[w+u]),t=z.a,h[w+u]=z.b,h[e+u]=t)}if(m&a){let e=s;for(var N=s+p*(A-o);e<=N;e+=b){var R=e+x;(v?$:W)(h[e+u],h[R+u]),t=z.a,h[R+u]=z.b,h[e+u]=t}}o=a,a>>=1}s}}var D=e,L=n,H=o;for(let e=0;e<H;++e)L[e]=D[L[e]];let U=0;var k=new Uint8Array(n.buffer.byteLength);for(let e=0;e<r.lines;e++)for(let e=0;e<r.channels;e++){var I=s[e],F=I.nx*I.size,V=new Uint8Array(n.buffer,I.end*J,F*J);k.set(V,U),U+=F*J,I.end+=F}return new DataView(k.buffer)}function ne(r){var i=unzlibSync(r.array.slice(r.offset.value,r.offset.value+r.size)),e=r.lines*r.channels*r.width,n=new(1==r.type?Uint16Array:Uint32Array)(e);let a=0,o=0;var s=new Array(4);for(let e=0;e<r.lines;e++)for(let e=0;e<r.channels;e++){let t=0;switch(r.type){case 1:s[0]=a,s[1]=s[0]+r.width,a=s[1]+r.width;for(let e=0;e<r.width;++e){var l=i[s[0]++]<<8|i[s[1]++];t+=l,n[o]=t,o++}break;case 2:s[0]=a,s[1]=s[0]+r.width,s[2]=s[1]+r.width,a=s[2]+r.width;for(let e=0;e<r.width;++e){var c=i[s[0]++]<<24|i[s[1]++]<<16|i[s[2]++]<<8;t+=c,n[o]=t,o++}}}return new DataView(n.buffer)}function ae(a){var e=a.viewer,t={value:a.offset.value},o=new Uint8Array(a.width*a.lines*(a.channels*a.type*J)),r={version:M(e,t),unknownUncompressedSize:M(e,t),unknownCompressedSize:M(e,t),acCompressedSize:M(e,t),dcCompressedSize:M(e,t),rleCompressedSize:M(e,t),rleUncompressedSize:M(e,t),rleRawSize:M(e,t),totalAcUncompressedCount:M(e,t),totalDcUncompressedCount:M(e,t),acCompression:M(e,t)};if(r.version<2)throw new Error("EXRLoader.parse: "+B.compression+" version "+r.version+" is unsupported");var i=new Array;let n=X(e,t)-J;for(;0<n;){var s=S(e.buffer,t),l=j(e,t),c=l>>2&3,l=new Int8Array([(l>>4)-1])[0],d=j(e,t);i.push({name:s,index:l,type:d,compression:c}),n-=s.length+3}var h=B.channels,u=new Array(a.channels);for(let e=0;e<a.channels;++e){var A=u[e]={},p=h[e];A.name=p.name,A.compression=L,A.decoded=!1,A.type=p.pixelType,A.pLinear=p.pLinear,A.width=a.width,A.height=a.lines}var m,f={idx:new Array(3)};for(let t=0;t<a.channels;++t){var g=u[t];for(let e=0;e<i.length;++e){var v=i[e];g.name==v.name&&(g.compression=v.compression,0<=v.index&&(f.idx[v.index]=t),g.offset=t)}}let _,y,E;if(0<r.acCompressedSize)switch(r.acCompression){case N:_=new Uint16Array(r.totalAcUncompressedCount),te(a.array,e,t,r.acCompressedSize,_,r.totalAcUncompressedCount);break;case R:var T=unzlibSync(a.array.slice(t.value,t.value+r.totalAcUncompressedCount));_=new Uint16Array(T.buffer),t.value+=r.totalAcUncompressedCount}0<r.dcCompressedSize&&(m={array:a.array,offset:t,size:r.dcCompressedSize},y=new Uint16Array(C(m).buffer),t.value+=r.dcCompressedSize),0<r.rleRawSize&&(m=unzlibSync(a.array.slice(t.value,t.value+r.rleCompressedSize)),E=re(m.buffer),t.value+=r.rleCompressedSize);let x=0;var b=new Array(u.length);for(let e=0;e<b.length;++e)b[e]=new Array;for(let e=0;e<a.lines;++e)for(let e=0;e<u.length;++e)b[e].push(x),x+=u[e].width*a.type*J;ie(f,b,u,_,y,o);for(let n=0;n<u.length;++n){var w=u[n];if(!w.decoded){if(w.compression!==Y)throw V,new Error("EXRLoader.parse: unsupported channel compression");{let r=0,i=0;for(let e=0;e<a.lines;++e){let t=b[n][r];for(let e=0;e<w.width;++e){for(let e=0;e<J*w.type;++e)o[t++]=E[i+e*w.width*w.height];i++}r++}}}}return new DataView(o.buffer)}function S(e,t){var r=new Uint8Array(e);let i=0;for(;0!=r[t.value+i];)i+=1;e=(new TextDecoder).decode(r.slice(t.value,t.value+i));return t.value=t.value+i+1,e}function E(e,t){e=e.getInt32(t.value,!0);return t.value=t.value+d,e}function K(e,t){e=e.getUint32(t.value,!0);return t.value=t.value+d,e}function oe(e,t){e=e[t.value];return t.value=t.value+h,e}function j(e,t){e=e.getUint8(t.value);return t.value=t.value+h,e}const M=function(e,t){let r;return r="getBigInt64"in DataView.prototype?Number(e.getBigInt64(t.value,!0)):e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=c,r};function T(e,t){e=e.getFloat32(t.value,!0);return t.value+=s,e}function se(e,t){return DataUtils$1.toHalfFloat(T(e,t))}function Z(e){var t=(31744&e)>>10,r=1023&e;return(e>>15?-1:1)*(t?31==t?r?NaN:1/0:Math.pow(2,t-15)*(1+r/1024):r/1024*6103515625e-14)}function X(e,t){e=e.getUint16(t.value,!0);return t.value+=J,e}function le(e,t){return Z(X(e,t))}function ce(e,t,r,i,n){if("string"===i||"stringvector"===i||"iccProfile"===i)return v=t,_=r,y=n,v=(new TextDecoder).decode(new Uint8Array(v).slice(_.value,_.value+y)),_.value=_.value+y,v;if("chlist"===i){for(var a=e,o=t,s=r,l=n,c=s.value,d=[];s.value<c+l-1;){var h=S(o,s),u=E(a,s),A=j(a,s),p=(s.value+=3,E(a,s)),m=E(a,s);d.push({name:h,pixelType:u,pLinear:A,xSampling:p,ySampling:m})}return s.value+=1,d}{var f,g,v,_,y;return"chromaticities"===i?{redX:T(_=e,y=r),redY:T(_,y),greenX:T(_,y),greenY:T(_,y),blueX:T(_,y),blueY:T(_,y),whiteX:T(_,y),whiteY:T(_,y)}:"compression"===i?["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][j(e,r)]:"box2i"===i?{xMin:K(v=e,t=r),yMin:K(v,t),xMax:K(v,t),yMax:K(v,t)}:"lineOrder"===i?["INCREASING_Y"][j(e,r)]:"float"===i?T(e,r):"v2f"===i?[T(t=e,g=r),T(t,g)]:"v3f"===i?[T(t=e,g=r),T(t,g),T(t,g)]:"int"===i?E(e,r):"rational"===i?[E(t=e,f=r),K(t,f)]:"timecode"===i?[K(t=e,f=r),K(t,f)]:"preview"===i?(r.value+=n,"skipped"):void(r.value+=n)}}var t=new DataView(e),de=new Uint8Array(e),n={value:0};const B=function(e,t,r){var i={};if(20000630!=e.getUint32(0,!0))throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");i.version=e.getUint8(4);var n=e.getUint8(5);i.spec={singleTile:!!(2&n),longName:!!(4&n),deepFormat:!!(8&n),multiPart:!!(16&n)},r.value=8;let a=!0;for(;a;){var o,s,l=S(t,r);0==l?a=!1:void 0===(s=ce(e,t,r,o=S(t,r),K(e,r)))?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${o}'.`):i[l]=s}if(0!=(-5&n))throw console.error("EXRHeader:",i),new Error("THREE.EXRLoader: provided file is currently unsupported.");return i}(t,e,n);var a=function(e,t,r,i,n){var a={size:0,viewer:t,array:r,offset:i,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:LinearSRGBColorSpace$1};switch(e.compression){case"NO_COMPRESSION":a.lines=1,a.uncompress=x;break;case"RLE_COMPRESSION":a.lines=1,a.uncompress=b;break;case"ZIPS_COMPRESSION":a.lines=1,a.uncompress=C;break;case"ZIP_COMPRESSION":a.lines=16,a.uncompress=C;break;case"PIZ_COMPRESSION":a.lines=32,a.uncompress=w;break;case"PXR24_COMPRESSION":a.lines=16,a.uncompress=ne;break;case"DWAA_COMPRESSION":a.lines=32,a.uncompress=ae;break;case"DWAB_COMPRESSION":a.lines=256,a.uncompress=ae;break;default:throw new Error("EXRLoader.parse: "+e.compression+" is unsupported")}if(a.scanlineBlockSize=a.lines,1==a.type)switch(n){case FloatType$1:a.getter=le,a.inputSize=J;break;case HalfFloatType$1:a.getter=X,a.inputSize=J}else{if(2!=a.type)throw new Error("EXRLoader.parse: unsupported pixelType "+a.type+" for "+e.compression+".");switch(n){case FloatType$1:a.getter=T,a.inputSize=s;break;case HalfFloatType$1:a.getter=se,a.inputSize=s}}a.blockCount=(e.dataWindow.yMax+1)/a.scanlineBlockSize;for(let e=0;e<a.blockCount;e++)M(t,i);a.outputChannels=3==a.channels?4:a.channels;var o=a.width*a.height*a.outputChannels;switch(n){case FloatType$1:a.byteArray=new Float32Array(o),a.channels<a.outputChannels&&a.byteArray.fill(1,0,o);break;case HalfFloatType$1:a.byteArray=new Uint16Array(o),a.channels<a.outputChannels&&a.byteArray.fill(15360,0,o);break;default:console.error("THREE.EXRLoader: unsupported type: ",n)}return a.bytesPerLine=a.width*a.inputSize*a.channels,4==a.outputChannels?(a.format=RGBAFormat$1,a.colorSpace=LinearSRGBColorSpace$1):(a.format=RedFormat$1,a.colorSpace=NoColorSpace$1),a}(B,t,de,n,this.type),he={value:0},ue={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<a.height/a.scanlineBlockSize;e++){var o=K(t,n),o=(a.size=K(t,n),a.lines=o+a.scanlineBlockSize>a.height?a.height-o:a.scanlineBlockSize,a.size<a.lines*a.bytesPerLine),Ae=o?a.uncompress(a):x(a);n.value+=a.size;for(let r=0;r<a.scanlineBlockSize;r++){var pe=r+e*a.scanlineBlockSize;if(pe>=a.height)break;for(let t=0;t<a.channels;t++){var me=ue[B.channels[t].name];for(let e=0;e<a.width;e++){he.value=(r*(a.channels*a.width)+t*a.width+e)*a.inputSize;var fe=(a.height-1-pe)*(a.width*a.outputChannels)+e*a.outputChannels+me;a.byteArray[fe]=a.getter(Ae,he)}}}}return{header:B,width:a.width,height:a.height,data:a.byteArray,format:a.format,colorSpace:a.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,r,t,i){return super.load(e,function(e,t){e.colorSpace=t.colorSpace,e.minFilter=LinearFilter$1,e.magFilter=LinearFilter$1,e.generateMipmaps=!1,e.flipY=!1,r&&r(e,t)},t,i)}}const exrLoader=new EXRLoader;class EXR extends LoadableComponent{constructor(e,t){super(e,t)}async _load(e,t){this._status,this._setContent.bind(this);const i=new URL(e.url.href+this.source[t].path);return this.report({msg:"Loading image from "+i}),new Promise((t,r)=>{exrLoader.setDataType(HalfFloatType),exrLoader.load(i.href,function(e){t(e)},void 0,function(e){r(e)})})}}EXR._exportName={singular:"exr",plural:"exrs"};class EnvironmentMap extends BuildableComponent{constructor(e,t){checkPropTypes(t,{},{exr:EXR,id:UUIDRegex,name:"string"}),super(e,t)}async _build(e,t){switch(this.report({msg:`Building ${t} `+e}),e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":if(!this.exr)throw new Error("Missing EXR map");if(!this._tree)throw new Error("No ComponentTree set. Environment map needs renderer from Engine->Tree->Component.");if(!this._tree.pmremGenerator)throw new Error("No pmremGenerator in ComponentTree, are you passing a renderer to the tree?");this._tree.pmremGenerator.compileEquirectangularShader();var r=this._tree.pmremGenerator.fromEquirectangular(this.exr.content.main[t]);this._setContent("main",t,r.texture);break;default:this._setContent(e,t,null)}return this}}EnvironmentMap._exportName={singular:"environmentMap",plural:"environmentMaps"};class MaterialSet extends BuildableComponent{constructor(e,t){super(e,t,{autoLinkDependencies:!1}),this.allMaterials=[],this.allMaterialsIndexed={},checkPropTypes(t,{name:"string"},{categories:e=>Array.isArray(e)&&e.every(e=>e instanceof MaterialCategory),materials:e=>Array.isArray(e)&&e.every(e=>e instanceof WrappedMaterial),id:UUIDRegex}),this._dependencies.main={};for(var r of t.materials||[])this.addExportDependency("material-"+r.id,r);for(var i of t.categories||[])this.addExportDependency("category-"+i.name,i);t.thumbnail&&(this._dependencies.UI=[t.thumbnail]),this.collectMaterials()}_onTreeSet(){const t=this;this._tree.on("change",({cls:e=[]})=>{(e.includes(WrappedMaterial)||e.includes(MaterialCategory))&&(t.report({msg:"Materials or material categories changed in package. Rebuilding."}),t._rebuild())},this.id),this._rebuild()}_onTreeUnset(){this._tree.hasListener("change",this.id)&&this._tree.removeListener("change",this.id)}has(e){return!!this.allMaterialsIndexed[e.id]}size(e=0){return this.allMaterials.length}collectMaterials(){var e,t=this._tree?this._tree.materials.filter(e=>(e.settings.categories||[]).some(e=>(this.settings.categories||[]).includes(e))||-1<this._settings.materials.indexOf(e)):this._settings.materials||[];this.allMaterials=t,this.allMaterialsIndexed={};for(e of t)this.allMaterialsIndexed[e.id]=e;this.report({msg:`size ${t.length} materials`})}async _build(e,t){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":this.collectMaterials(),this._setContent("main",t,this.allMaterials);break;default:this._setContent(e,t,null)}return this}}MaterialSet._exportName={singular:"materialSet",plural:"materialSets"};class WrappedMaterial extends BuildableComponent{constructor(e,t,r={}){r.tree&&r.tree.environmentMaps&&(t.envMap||(t.envMap=r.tree.environmentMaps[0])),super(e,t,{parse:{categories:"integral"}}),checkPropTypes(t,{type:e=>void 0!==WrappedMaterial.materialTypes[e]},{alphaMap:WrappedTexture,aoMap:WrappedTexture,envMap:EnvironmentMap,lightMap:WrappedTexture,map:WrappedTexture,specularMap:WrappedTexture,displacementMap:WrappedTexture,emissiveMap:WrappedTexture,bumpMap:WrappedTexture,normalMap:WrappedTexture,clearcoatMap:WrappedTexture,clearcoatNormalMap:WrappedTexture,gradientMap:WrappedTexture,parallaxMap:WrappedTexture}),this.settings.thumbnail&&this.settings.thumbnail.on("usability-changed",e=>{this._UIStatus=e})}getMaterialSets(){return this._tree?(this._tree.materialSets||[]).filter(e=>e.has(this)):[]}get materialSets(){return this.getMaterialSets()}async _build(e,t){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":if("Nodes"!==this._settings.type){var r,i,n=new WrappedMaterial.materialTypes[this._settings.type];n.userData={PB:{origin:this.id}};const o=Object.keys(this._settings).filter(e=>this._settings[e]instanceof WrappedTexture||this._settings[e]instanceof EnvironmentMap);let e=Object.keys(n).filter(e=>!o.includes(e));for(r of[this._settings,...this._settings.categories||[]]){const s=copyProps({from:r,into:n,required:[],optional:e});e=e.filter(e=>!s.includes(e));for(var a of o)r[a]&&!n[a]&&(n[a]=r[a].content.main[t])}!o.environmentMap&&this._tree&&this._tree.environmentMaps&&this._tree.environmentMaps[0]instanceof EnvironmentMap&&("ready"!==(i=this._tree.environmentMaps[0]).status.main[t]?console.warn(`Can not apply ${i.label} to ${this.label}, status should be "ready" but is "${i.status.main[t]}".`):n.envMap=this._tree.environmentMaps[0].content.main[t]),n.normalMap&&(n.normalMap.colorSpace=LinearSRGBColorSpace),n.roughnessMap&&(n.roughnessMap.colorSpace=LinearSRGBColorSpace),n.aoMap&&(n.aoMap.colorSpace=LinearSRGBColorSpace),n.metalnessMap&&(n.metalnessMap.colorSpace=LinearSRGBColorSpace),n.needsUpdate=!0,n.depthWrite=!0,n.transparent=!1,this._setContent("main",t,n)}break;default:this._setContent(e,t,null)}return this}}function toTrianglesDrawMode(e,r){if(r===TrianglesDrawMode$1)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(r!==TriangleFanDrawMode$1&&r!==TriangleStripDrawMode$1)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",r),e;{let t=e.getIndex();if(null===t){var i=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)i.push(e);e.setIndex(i),t=e.getIndex()}var a=t.count-2,o=[];if(r===TriangleFanDrawMode$1)for(let e=1;e<=a;e++)o.push(t.getX(0)),o.push(t.getX(e)),o.push(t.getX(e+1));else for(let e=0;e<a;e++)e%2==0?(o.push(t.getX(e)),o.push(t.getX(e+1)),o.push(t.getX(e+2))):(o.push(t.getX(e+2)),o.push(t.getX(e+1)),o.push(t.getX(e)));o.length/3!=a&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");r=e.clone();return r.setIndex(o),r.clearGroups(),r}}WrappedMaterial._exportName={singular:"material",plural:"materials"},WrappedMaterial.materialTypes={Nodes:Nodes,LineBasicMaterial:LineBasicMaterial,LineDashedMaterial:LineDashedMaterial,Material:Material,MeshBasicMaterial:MeshBasicMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshMatcapMaterial:MeshMatcapMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshToonMaterial:MeshToonMaterial,PointsMaterial:PointsMaterial,RawShaderMaterial:RawShaderMaterial,ShaderMaterial:ShaderMaterial,ShadowMaterial:ShadowMaterial,SpriteMaterial:SpriteMaterial};class GLTFLoader extends Loader$1{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new GLTFMaterialsClearcoatExtension(e)}),this.register(function(e){return new GLTFTextureBasisUExtension(e)}),this.register(function(e){return new GLTFTextureWebPExtension(e)}),this.register(function(e){return new GLTFTextureAVIFExtension(e)}),this.register(function(e){return new GLTFMaterialsSheenExtension(e)}),this.register(function(e){return new GLTFMaterialsTransmissionExtension(e)}),this.register(function(e){return new GLTFMaterialsVolumeExtension(e)}),this.register(function(e){return new GLTFMaterialsIorExtension(e)}),this.register(function(e){return new GLTFMaterialsEmissiveStrengthExtension(e)}),this.register(function(e){return new GLTFMaterialsSpecularExtension(e)}),this.register(function(e){return new GLTFMaterialsIridescenceExtension(e)}),this.register(function(e){return new GLTFMaterialsAnisotropyExtension(e)}),this.register(function(e){return new GLTFLightsExtension(e)}),this.register(function(e){return new GLTFMeshoptCompression(e)}),this.register(function(e){return new GLTFMeshGpuInstancing(e)})}load(t,r,e,i){const n=this;let a;a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:LoaderUtils$1.extractUrlBase(t),this.manager.itemStart(t);function o(e){i?i(e):console.error(e),n.manager.itemError(t),n.manager.itemEnd(t)}var s=new FileLoader$1(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,function(e){try{n.parse(e,a,function(e){r(e),n.manager.itemEnd(t)},o)}catch(e){o(e)}},e,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,i){let n;var a={},o={},s=new TextDecoder;if("string"==typeof e)n=JSON.parse(e);else if(e instanceof ArrayBuffer)if(s.decode(new Uint8Array(e,0,4))===BINARY_EXTENSION_HEADER_MAGIC){try{a[EXTENSIONS.KHR_BINARY_GLTF]=new GLTFBinaryExtension(e)}catch(e){return void(i&&i(e))}n=JSON.parse(a[EXTENSIONS.KHR_BINARY_GLTF].content)}else n=JSON.parse(s.decode(e));else n=e;if(void 0===n.asset||n.asset.version[0]<2)i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var l=new GLTFParser(n,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){var c=this.pluginCallbacks[e](l);a[(o[c.name]=c).name]=!0}if(n.extensionsUsed)for(let e=0;e<n.extensionsUsed.length;++e){var d=n.extensionsUsed[e],h=n.extensionsRequired||[];switch(d){case EXTENSIONS.KHR_MATERIALS_UNLIT:a[d]=new GLTFMaterialsUnlitExtension;break;case EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:a[d]=new GLTFDracoMeshCompressionExtension(n,this.dracoLoader);break;case EXTENSIONS.KHR_TEXTURE_TRANSFORM:a[d]=new GLTFTextureTransformExtension;break;case EXTENSIONS.KHR_MESH_QUANTIZATION:a[d]=new GLTFMeshQuantizationExtension;break;default:0<=h.indexOf(d)&&void 0===o[d]&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}l.setExtensions(a),l.setPlugins(o),l.parse(r,i)}}parseAsync(r,i){const n=this;return new Promise(function(e,t){n.parse(r,i,e,t)})}}function GLTFRegistry(){let r={};return{get:function(e){return r[e]},add:function(e,t){r[e]=t},remove:function(e){delete r[e]},removeAll:function(){r={}}}}const EXTENSIONS={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class GLTFLightsExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){var r=this.parser,i=this.parser.json.nodes||[];for(let e=0,t=i.length;e<t;e++){var n=i[e];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&r._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(t){var r=this.parser,i="light:"+t,n=r.cache.get(i);if(!n){var a=r.json,o=((a.extensions&&a.extensions[this.name]||{}).lights||[])[t];let e;var s=new Color$1(16777215),l=(void 0!==o.color&&s.fromArray(o.color),void 0!==o.range?o.range:0);switch(o.type){case"directional":(e=new DirectionalLight$1(s)).target.position.set(0,0,-1),e.add(e.target);break;case"point":(e=new PointLight$1(s)).distance=l;break;case"spot":(e=new SpotLight$1(s)).distance=l,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,e.angle=o.spot.outerConeAngle,e.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,e.target.position.set(0,0,-1),e.add(e.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}e.position.set(0,0,0),e.decay=2,assignExtrasToUserData(e,o),void 0!==o.intensity&&(e.intensity=o.intensity),e.name=r.createUniqueName(o.name||"light_"+t),n=Promise.resolve(e),r.cache.add(i,n)}return n}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,r=this.parser;e=r.json.nodes[e];const i=(e.extensions&&e.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then(function(e){return r._getNodeRef(t.cache,i,e)})}}class GLTFMaterialsUnlitExtension{constructor(){this.name=EXTENSIONS.KHR_MATERIALS_UNLIT}getMaterialType(){return MeshBasicMaterial$1}extendParams(e,t,r){var i,n=[],t=(e.color=new Color$1(1,1,1),e.opacity=1,t.pbrMetallicRoughness);return t&&(Array.isArray(t.baseColorFactor)&&(i=t.baseColorFactor,e.color.fromArray(i),e.opacity=i[3]),void 0!==t.baseColorTexture)&&n.push(r.assignTexture(e,"map",t.baseColorTexture,SRGBColorSpace$1)),Promise.all(n)}}class GLTFMaterialsEmissiveStrengthExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){var e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]&&void 0!==(e=e.extensions[this.name].emissiveStrength)&&(t.emissiveIntensity=e),Promise.resolve()}}class GLTFMaterialsClearcoatExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?MeshPhysicalMaterial$1:null}extendMaterialParams(e,t){var r,i=this.parser,e=i.json.materials[e];return e.extensions&&e.extensions[this.name]?(r=[],void 0!==(e=e.extensions[this.name]).clearcoatFactor&&(t.clearcoat=e.clearcoatFactor),void 0!==e.clearcoatTexture&&r.push(i.assignTexture(t,"clearcoatMap",e.clearcoatTexture)),void 0!==e.clearcoatRoughnessFactor&&(t.clearcoatRoughness=e.clearcoatRoughnessFactor),void 0!==e.clearcoatRoughnessTexture&&r.push(i.assignTexture(t,"clearcoatRoughnessMap",e.clearcoatRoughnessTexture)),void 0!==e.clearcoatNormalTexture&&(r.push(i.assignTexture(t,"clearcoatNormalMap",e.clearcoatNormalTexture)),void 0!==e.clearcoatNormalTexture.scale)&&(i=e.clearcoatNormalTexture.scale,t.clearcoatNormalScale=new Vector2$1(i,i)),Promise.all(r)):Promise.resolve()}}class GLTFMaterialsIridescenceExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?MeshPhysicalMaterial$1:null}extendMaterialParams(e,t){var r,i=this.parser,e=i.json.materials[e];return e.extensions&&e.extensions[this.name]?(r=[],void 0!==(e=e.extensions[this.name]).iridescenceFactor&&(t.iridescence=e.iridescenceFactor),void 0!==e.iridescenceTexture&&r.push(i.assignTexture(t,"iridescenceMap",e.iridescenceTexture)),void 0!==e.iridescenceIor&&(t.iridescenceIOR=e.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==e.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=e.iridescenceThicknessMinimum),void 0!==e.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=e.iridescenceThicknessMaximum),void 0!==e.iridescenceThicknessTexture&&r.push(i.assignTexture(t,"iridescenceThicknessMap",e.iridescenceThicknessTexture)),Promise.all(r)):Promise.resolve()}}class GLTFMaterialsSheenExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_SHEEN}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?MeshPhysicalMaterial$1:null}extendMaterialParams(e,t){var r,i=this.parser,e=i.json.materials[e];return e.extensions&&e.extensions[this.name]?(r=[],t.sheenColor=new Color$1(0,0,0),t.sheenRoughness=0,t.sheen=1,void 0!==(e=e.extensions[this.name]).sheenColorFactor&&t.sheenColor.fromArray(e.sheenColorFactor),void 0!==e.sheenRoughnessFactor&&(t.sheenRoughness=e.sheenRoughnessFactor),void 0!==e.sheenColorTexture&&r.push(i.assignTexture(t,"sheenColorMap",e.sheenColorTexture,SRGBColorSpace$1)),void 0!==e.sheenRoughnessTexture&&r.push(i.assignTexture(t,"sheenRoughnessMap",e.sheenRoughnessTexture)),Promise.all(r)):Promise.resolve()}}class GLTFMaterialsTransmissionExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?MeshPhysicalMaterial$1:null}extendMaterialParams(e,t){var r,i=this.parser,e=i.json.materials[e];return e.extensions&&e.extensions[this.name]?(r=[],void 0!==(e=e.extensions[this.name]).transmissionFactor&&(t.transmission=e.transmissionFactor),void 0!==e.transmissionTexture&&r.push(i.assignTexture(t,"transmissionMap",e.transmissionTexture)),Promise.all(r)):Promise.resolve()}}class GLTFMaterialsVolumeExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_VOLUME}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?MeshPhysicalMaterial$1:null}extendMaterialParams(e,t){var r,i=this.parser,e=i.json.materials[e];return e.extensions&&e.extensions[this.name]?(r=[],e=e.extensions[this.name],t.thickness=void 0!==e.thicknessFactor?e.thicknessFactor:0,void 0!==e.thicknessTexture&&r.push(i.assignTexture(t,"thicknessMap",e.thicknessTexture)),t.attenuationDistance=e.attenuationDistance||1/0,i=e.attenuationColor||[1,1,1],t.attenuationColor=new Color$1(i[0],i[1],i[2]),Promise.all(r)):Promise.resolve()}}class GLTFMaterialsIorExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_IOR}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?MeshPhysicalMaterial$1:null}extendMaterialParams(e,t){var e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]&&(e=e.extensions[this.name],t.ior=void 0!==e.ior?e.ior:1.5),Promise.resolve()}}class GLTFMaterialsSpecularExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_SPECULAR}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?MeshPhysicalMaterial$1:null}extendMaterialParams(e,t){var r,i,n=this.parser,e=n.json.materials[e];return e.extensions&&e.extensions[this.name]?(r=[],e=e.extensions[this.name],t.specularIntensity=void 0!==e.specularFactor?e.specularFactor:1,void 0!==e.specularTexture&&r.push(n.assignTexture(t,"specularIntensityMap",e.specularTexture)),i=e.specularColorFactor||[1,1,1],t.specularColor=new Color$1(i[0],i[1],i[2]),void 0!==e.specularColorTexture&&r.push(n.assignTexture(t,"specularColorMap",e.specularColorTexture,SRGBColorSpace$1)),Promise.all(r)):Promise.resolve()}}class GLTFMaterialsAnisotropyExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?MeshPhysicalMaterial$1:null}extendMaterialParams(e,t){var r,i=this.parser,e=i.json.materials[e];return e.extensions&&e.extensions[this.name]?(r=[],void 0!==(e=e.extensions[this.name]).anisotropyStrength&&(t.anisotropy=e.anisotropyStrength),void 0!==e.anisotropyRotation&&(t.anisotropyRotation=e.anisotropyRotation),void 0!==e.anisotropyTexture&&r.push(i.assignTexture(t,"anisotropyMap",e.anisotropyTexture)),Promise.all(r)):Promise.resolve()}}class GLTFTextureBasisUExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_TEXTURE_BASISU}loadTexture(e){var t=this.parser,r=t.json,i=r.textures[e];if(i.extensions&&i.extensions[this.name]){var i=i.extensions[this.name],n=t.options.ktx2Loader;if(n)return t.loadTextureImage(e,i.source,n);if(r.extensionsRequired&&0<=r.extensionsRequired.indexOf(this.name))throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures")}return null}}class GLTFTextureWebPExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const r=this.name,i=this.parser,n=i.json;var e=n.textures[t];if(!e.extensions||!e.extensions[r])return null;const a=e.extensions[r];var e=n.images[a.source];let o=i.textureLoader;return e.uri&&null!==(e=i.options.manager.getHandler(e.uri))&&(o=e),this.detectSupport().then(function(e){if(e)return i.loadTextureImage(t,a.source,o);if(n.extensionsRequired&&0<=n.extensionsRequired.indexOf(r))throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class GLTFTextureAVIFExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const r=this.name,i=this.parser,n=i.json;var e=n.textures[t];if(!e.extensions||!e.extensions[r])return null;const a=e.extensions[r];var e=n.images[a.source];let o=i.textureLoader;return e.uri&&null!==(e=i.options.manager.getHandler(e.uri))&&(o=e),this.detectSupport().then(function(e){if(e)return i.loadTextureImage(t,a.source,o);if(n.extensionsRequired&&0<=n.extensionsRequired.indexOf(r))throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class GLTFMeshoptCompression{constructor(e){this.name=EXTENSIONS.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){var t=this.parser.json,e=t.bufferViews[e];if(e.extensions&&e.extensions[this.name]){const o=e.extensions[this.name];e=this.parser.getDependency("buffer",o.buffer);const s=this.parser.options.meshoptDecoder;if(s&&s.supported)return e.then(function(e){var t=o.byteOffset||0,r=o.byteLength||0;const i=o.count,n=o.byteStride,a=new Uint8Array(e,t,r);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(i,n,a,o.mode,o.filter).then(function(e){return e.buffer}):s.ready.then(function(){var e=new ArrayBuffer(i*n);return s.decodeGltfBuffer(new Uint8Array(e),i,n,a,o.mode,o.filter),e})});if(t.extensionsRequired&&0<=t.extensionsRequired.indexOf(this.name))throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files")}return null}}class GLTFMeshGpuInstancing{constructor(e){this.name=EXTENSIONS.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){var t=this.parser.json,r=t.nodes[e];if(!r.extensions||!r.extensions[this.name]||void 0===r.mesh)return null;for(const a of t.meshes[r.mesh].primitives)if(a.mode!==WEBGL_CONSTANTS.TRIANGLES&&a.mode!==WEBGL_CONSTANTS.TRIANGLE_STRIP&&a.mode!==WEBGL_CONSTANTS.TRIANGLE_FAN&&void 0!==a.mode)return null;var i=r.extensions[this.name].attributes,n=[];const u={};for(const o in i)n.push(this.parser.getDependency("accessor",i[o]).then(e=>(u[o]=e,u[o])));return n.length<1?null:(n.push(this.parser.createNodeMesh(e)),Promise.all(n).then(e=>{var t=e.pop(),r=t.isGroup?t.children:[t],i=e[0].count,n=[];for(const d of r){var a=new Matrix4$1,o=new Vector3$1,s=new Quaternion$1,l=new Vector3$1(1,1,1),c=new InstancedMesh$1(d.geometry,d.material,i);for(let e=0;e<i;e++)u.TRANSLATION&&o.fromBufferAttribute(u.TRANSLATION,e),u.ROTATION&&s.fromBufferAttribute(u.ROTATION,e),u.SCALE&&l.fromBufferAttribute(u.SCALE,e),c.setMatrixAt(e,a.compose(o,s,l));for(const h in u)"TRANSLATION"!==h&&"ROTATION"!==h&&"SCALE"!==h&&d.geometry.setAttribute(h,u[h]);Object3D$1.prototype.copy.call(c,d),this.parser.assignFinalMaterial(c),n.push(c)}return t.isGroup?(t.clear(),t.add(...n),t):n[0]}))}}const BINARY_EXTENSION_HEADER_MAGIC="glTF",BINARY_EXTENSION_HEADER_LENGTH=12,BINARY_EXTENSION_CHUNK_TYPES={JSON:1313821514,BIN:5130562};class GLTFBinaryExtension{constructor(e){this.name=EXTENSIONS.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,BINARY_EXTENSION_HEADER_LENGTH),r=new TextDecoder;if(this.header={magic:r.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==BINARY_EXTENSION_HEADER_MAGIC)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");var i=this.header.length-BINARY_EXTENSION_HEADER_LENGTH,n=new DataView(e,BINARY_EXTENSION_HEADER_LENGTH);let a=0;for(;a<i;){var o,s=n.getUint32(a,!0),l=(a+=4,n.getUint32(a,!0));a+=4,l===BINARY_EXTENSION_CHUNK_TYPES.JSON?(o=new Uint8Array(e,BINARY_EXTENSION_HEADER_LENGTH+a,s),this.content=r.decode(o)):l===BINARY_EXTENSION_CHUNK_TYPES.BIN&&(o=BINARY_EXTENSION_HEADER_LENGTH+a,this.body=e.slice(o,o+s)),a+=s}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class GLTFDracoMeshCompressionExtension{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=EXTENSIONS.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){var r=this.json;const i=this.dracoLoader;var n=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes;const o={},s={},l={};for(const A in a){var c=ATTRIBUTES[A]||A.toLowerCase();o[c]=a[A]}for(const p in e.attributes){var d,h,u=ATTRIBUTES[p]||p.toLowerCase();void 0!==a[p]&&(d=r.accessors[e.attributes[p]],h=WEBGL_COMPONENT_TYPES[d.componentType],l[u]=h.name,s[u]=!0===d.normalized)}return t.getDependency("bufferView",n).then(function(e){return new Promise(function(n){i.decodeDracoFile(e,function(e){for(const i in e.attributes){var t=e.attributes[i],r=s[i];void 0!==r&&(t.normalized=r)}n(e)},o,l)})})}}class GLTFTextureTransformExtension{constructor(){this.name=EXTENSIONS.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale)&&(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class GLTFMeshQuantizationExtension{constructor(){this.name=EXTENSIONS.KHR_MESH_QUANTIZATION}}class GLTFCubicSplineInterpolant extends Interpolant$1{constructor(e,t,r,i){super(e,t,r,i)}copySampleValue_(e){var t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i*3+i;for(let e=0;e!==i;e++)t[e]=r[n+e];return t}interpolate_(e,t,r,i){var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,l=3*o,c=i-t,i=(r-t)/c,r=i*i,t=r*i,d=e*l,h=d-l,u=-2*t+3*r,A=t-r,p=1-u,m=A-r+i;for(let e=0;e!==o;e++){var f=a[h+e+o],g=a[h+e+s]*c,v=a[d+e+o],_=a[d+e]*c;n[e]=p*f+m*g+u*v+A*_}return n}}const _q=new Quaternion$1;class GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant{interpolate_(e,t,r,i){e=super.interpolate_(e,t,r,i);return _q.fromArray(e).normalize().toArray(e),e}}const WEBGL_CONSTANTS={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},WEBGL_FILTERS={9728:NearestFilter$1,9729:LinearFilter$1,9984:NearestMipmapNearestFilter$1,9985:LinearMipmapNearestFilter$1,9986:NearestMipmapLinearFilter$1,9987:LinearMipmapLinearFilter$1},WEBGL_WRAPPINGS={33071:ClampToEdgeWrapping$1,33648:MirroredRepeatWrapping$1,10497:RepeatWrapping$1},WEBGL_TYPE_SIZES={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ATTRIBUTES={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},PATH_PROPERTIES={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},INTERPOLATION={CUBICSPLINE:void 0,LINEAR:InterpolateLinear$1,STEP:InterpolateDiscrete$1},ALPHA_MODES={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function createDefaultMaterial(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new MeshStandardMaterial$1({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:FrontSide$1})),e.DefaultMaterial}function addUnknownExtensionsToUserData(e,t,r){for(const i in r.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=r.extensions[i])}function assignExtrasToUserData(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function addMorphTargets(i,r,n){let a=!1,o=!1,s=!1;for(let e=0,t=r.length;e<t;e++){var l=r[e];if(void 0!==l.POSITION&&(a=!0),void 0!==l.NORMAL&&(o=!0),void 0!==l.COLOR_0&&(s=!0),a&&o&&s)break}if(!a&&!o&&!s)return Promise.resolve(i);var c=[],d=[],h=[];for(let e=0,t=r.length;e<t;e++){var u,A=r[e];a&&(u=void 0!==A.POSITION?n.getDependency("accessor",A.POSITION):i.attributes.position,c.push(u)),o&&(u=void 0!==A.NORMAL?n.getDependency("accessor",A.NORMAL):i.attributes.normal,d.push(u)),s&&(A=void 0!==A.COLOR_0?n.getDependency("accessor",A.COLOR_0):i.attributes.color,h.push(A))}return Promise.all([Promise.all(c),Promise.all(d),Promise.all(h)]).then(function(e){var t=e[0],r=e[1],e=e[2];return a&&(i.morphAttributes.position=t),o&&(i.morphAttributes.normal=r),s&&(i.morphAttributes.color=e),i.morphTargetsRelative=!0,i})}function updateMorphTargets(r,i){if(r.updateMorphTargets(),void 0!==i.weights)for(let e=0,t=i.weights.length;e<t;e++)r.morphTargetInfluences[e]=i.weights[e];if(i.extras&&Array.isArray(i.extras.targetNames)){var n=i.extras.targetNames;if(r.morphTargetInfluences.length===n.length){r.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++)r.morphTargetDictionary[n[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function createPrimitiveKey(r){let i;var e=r.extensions&&r.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION];if(i=e?"draco:"+e.bufferView+":"+e.indices+":"+createAttributesKey(e.attributes):r.indices+":"+createAttributesKey(r.attributes)+":"+r.mode,void 0!==r.targets)for(let e=0,t=r.targets.length;e<t;e++)i+=":"+createAttributesKey(r.targets[e]);return i}function createAttributesKey(r){let i="";var n=Object.keys(r).sort();for(let e=0,t=n.length;e<t;e++)i+=n[e]+":"+r[n[e]]+";";return i}function getNormalizedComponentScale(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function getImageURIMimeType(e){return 0<e.search(/\.jpe?g($|\?)/i)||0===e.search(/^data\:image\/jpeg/)?"image/jpeg":0<e.search(/\.webp($|\?)/i)||0===e.search(/^data\:image\/webp/)?"image/webp":"image/png"}const _identityMatrix$1=new Matrix4$1;class GLTFParser{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new GLTFRegistry,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={};let r=!(this.nodeNamesUsed={}),i=!1,n=-1;"undefined"!=typeof navigator&&(r=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),i=-1<navigator.userAgent.indexOf("Firefox"),n=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||r||i&&n<98?this.textureLoader=new TextureLoader$1(this.options.manager):this.textureLoader=new ImageBitmapLoader$1(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new FileLoader$1(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(r,e){const i=this,n=this.json,a=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(e){const t={scene:e[0][n.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:n.asset,parser:i,userData:{}};addUnknownExtensionsToUserData(a,t,n),assignExtrasToUserData(t,n),Promise.all(i._invokeAll(function(e){return e.afterRoot&&e.afterRoot(t)})).then(function(){r(t)})}).catch(e)}_markDefs(){var r=this.json.nodes||[],i=this.json.skins||[],n=this.json.meshes||[];for(let e=0,t=i.length;e<t;e++){var a=i[e].joints;for(let e=0,t=a.length;e<t;e++)r[a[e]].isBone=!0}for(let e=0,t=r.length;e<t;e++){var o=r[e];void 0!==o.mesh&&(this._addNodeRef(this.meshCache,o.mesh),void 0!==o.skin)&&(n[o.mesh].isSkinnedMesh=!0),void 0!==o.camera&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,r){if(e.refs[t]<=1)return r;var i=r.clone();const a=(e,t)=>{var r,i,n=this.associations.get(e);null!=n&&this.associations.set(t,n);for([r,i]of e.children.entries())a(i,t.children[r])};return a(r,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(t){var r=Object.values(this.plugins);r.push(this);for(let e=0;e<r.length;e++){var i=t(r[e]);if(i)return i}return null}_invokeAll(t){var r=Object.values(this.plugins),i=(r.unshift(this),[]);for(let e=0;e<r.length;e++){var n=t(r[e]);n&&i.push(n)}return i}getDependency(t,r){var e=t+":"+r;let i=this.cache.get(e);if(!i){switch(t){case"scene":i=this.loadScene(r);break;case"node":i=this._invokeOne(function(e){return e.loadNode&&e.loadNode(r)});break;case"mesh":i=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(r)});break;case"accessor":i=this.loadAccessor(r);break;case"bufferView":i=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(r)});break;case"buffer":i=this.loadBuffer(r);break;case"material":i=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(r)});break;case"texture":i=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(r)});break;case"skin":i=this.loadSkin(r);break;case"animation":i=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(r)});break;case"camera":i=this.loadCamera(r);break;default:if(i=this._invokeOne(function(e){return e!=this&&e.getDependency&&e.getDependency(t,r)}))break;throw new Error("Unknown type: "+t)}this.cache.add(e,i)}return i}getDependencies(r){let e=this.cache.get(r);if(!e){const i=this;var t=this.json[r+("mesh"===r?"es":"s")]||[];e=Promise.all(t.map(function(e,t){return i.getDependency(r,t)})),this.cache.add(r,e)}return e}loadBuffer(e){const r=this.json.buffers[e],i=this.fileLoader;if(r.type&&"arraybuffer"!==r.type)throw new Error("THREE.GLTFLoader: "+r.type+" buffer type is not supported.");if(void 0===r.uri&&0===e)return Promise.resolve(this.extensions[EXTENSIONS.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(e,t){i.load(LoaderUtils$1.resolveURL(r.uri,n.path),e,void 0,function(){t(new Error('THREE.GLTFLoader: Failed to load buffer "'+r.uri+'".'))})})}loadBufferView(e){const i=this.json.bufferViews[e];return this.getDependency("buffer",i.buffer).then(function(e){var t=i.byteLength||0,r=i.byteOffset||0;return e.slice(r,r+t)})}loadAccessor(e){const m=this,f=this.json,g=this.json.accessors[e];var t,r;return void 0===g.bufferView&&void 0===g.sparse?(e=WEBGL_TYPE_SIZES[g.type],r=WEBGL_COMPONENT_TYPES[g.componentType],t=!0===g.normalized,r=new r(g.count*e),Promise.resolve(new BufferAttribute$1(r,e,t))):(r=[],void 0!==g.bufferView?r.push(this.getDependency("bufferView",g.bufferView)):r.push(null),void 0!==g.sparse&&(r.push(this.getDependency("bufferView",g.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",g.sparse.values.bufferView))),Promise.all(r).then(function(e){var t=e[0],r=WEBGL_TYPE_SIZES[g.type],i=WEBGL_COMPONENT_TYPES[g.componentType],n=i.BYTES_PER_ELEMENT,a=n*r,o=g.byteOffset||0,s=void 0!==g.bufferView?f.bufferViews[g.bufferView].byteStride:void 0,l=!0===g.normalized;let c,d;if(s&&s!==a){var a=Math.floor(o/s),h="InterleavedBuffer:"+g.bufferView+":"+g.componentType+":"+a+":"+g.count;let e=m.cache.get(h);e||(c=new i(t,a*s,g.count*s/n),e=new InterleavedBuffer$1(c,s/n),m.cache.add(h,e)),d=new InterleavedBufferAttribute$1(e,r,o%s/n,l)}else c=null===t?new i(g.count*r):new i(t,o,g.count*r),d=new BufferAttribute$1(c,r,l);if(void 0!==g.sparse){var a=WEBGL_TYPE_SIZES.SCALAR,h=WEBGL_COMPONENT_TYPES[g.sparse.indices.componentType],s=g.sparse.indices.byteOffset||0,n=g.sparse.values.byteOffset||0,u=new h(e[1],s,g.sparse.count*a),A=new i(e[2],n,g.sparse.count*r);null!==t&&(d=new BufferAttribute$1(d.array.slice(),d.itemSize,d.normalized));for(let e=0,t=u.length;e<t;e++){var p=u[e];if(d.setX(p,A[e*r]),2<=r&&d.setY(p,A[e*r+1]),3<=r&&d.setZ(p,A[e*r+2]),4<=r&&d.setW(p,A[e*r+3]),5<=r)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return d}))}loadTexture(e){var t=this.json,r=this.options,i=t.textures[e].source,t=t.images[i];let n=this.textureLoader;return t.uri&&null!==(r=r.manager.getHandler(t.uri))&&(n=r),this.loadTextureImage(e,i,n)}loadTextureImage(r,e,t){const i=this,n=this.json,a=n.textures[r],o=n.images[e];var s=(o.uri||o.bufferView)+":"+a.sampler;return this.textureCache[s]||(e=this.loadImageSource(e,t).then(function(e){e.flipY=!1,e.name=a.name||o.name||"",""===e.name&&"string"==typeof o.uri&&!1===o.uri.startsWith("data:image/")&&(e.name=o.uri);var t=(n.samplers||{})[a.sampler]||{};return e.magFilter=WEBGL_FILTERS[t.magFilter]||LinearFilter$1,e.minFilter=WEBGL_FILTERS[t.minFilter]||LinearMipmapLinearFilter$1,e.wrapS=WEBGL_WRAPPINGS[t.wrapS]||RepeatWrapping$1,e.wrapT=WEBGL_WRAPPINGS[t.wrapT]||RepeatWrapping$1,i.associations.set(e,{textures:r}),e}).catch(function(){return null}),this.textureCache[s]=e)}loadImageSource(e,n){var t=this.json;const a=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());const r=t.images[e],i=self.URL||self.webkitURL;let o=r.uri||"",s=!1;if(void 0!==r.bufferView)o=this.getDependency("bufferView",r.bufferView).then(function(e){s=!0;e=new Blob([e],{type:r.mimeType});return o=i.createObjectURL(e)});else if(void 0===r.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");t=Promise.resolve(o).then(function(i){return new Promise(function(t,e){let r=t;!0===n.isImageBitmapLoader&&(r=function(e){e=new Texture$1(e);e.needsUpdate=!0,t(e)}),n.load(LoaderUtils$1.resolveURL(i,a.path),r,void 0,e)})}).then(function(e){return!0===s&&i.revokeObjectURL(o),e.userData.mimeType=r.mimeType||getImageURIMimeType(r.uri),e}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),e});return this.sourceCache[e]=t}assignTexture(i,n,a,o){const s=this;return this.getDependency("texture",a.index).then(function(e){var t,r;return e?(void 0!==a.texCoord&&0<a.texCoord&&((e=e.clone()).channel=a.texCoord),s.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]&&(t=void 0!==a.extensions?a.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]:void 0)&&(r=s.associations.get(e),e=s.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM].extendTexture(e,t),s.associations.set(e,r)),void 0!==o&&(e.colorSpace=o),i[n]=e):null})}assignFinalMaterial(e){var r=e.geometry;let i=e.material;var n=void 0===r.attributes.tangent,a=void 0!==r.attributes.color,r=void 0===r.attributes.normal;if(e.isPoints){var t="PointsMaterial:"+i.uuid;let e=this.cache.get(t);e||(e=new PointsMaterial$1,Material$1.prototype.copy.call(e,i),e.color.copy(i.color),e.map=i.map,e.sizeAttenuation=!1,this.cache.add(t,e)),i=e}else if(e.isLine){t="LineBasicMaterial:"+i.uuid;let e=this.cache.get(t);e||(e=new LineBasicMaterial$1,Material$1.prototype.copy.call(e,i),e.color.copy(i.color),e.map=i.map,this.cache.add(t,e)),i=e}if(n||a||r){let e="ClonedMaterial:"+i.uuid+":",t=(n&&(e+="derivative-tangents:"),a&&(e+="vertex-colors:"),r&&(e+="flat-shading:"),this.cache.get(e));t||(t=i.clone(),a&&(t.vertexColors=!0),r&&(t.flatShading=!0),n&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale)&&(t.clearcoatNormalScale.y*=-1),this.cache.add(e,t),this.associations.set(t,this.associations.get(i))),i=t}e.material=i}getMaterialType(){return MeshStandardMaterial$1}loadMaterial(t){const r=this;var e=this.json;const i=this.extensions,n=e.materials[t];let a;const o={};var s,e=[],l=((n.extensions||{})[EXTENSIONS.KHR_MATERIALS_UNLIT]?(s=i[EXTENSIONS.KHR_MATERIALS_UNLIT],a=s.getMaterialType(),e.push(s.extendParams(o,n,r))):(s=n.pbrMetallicRoughness||{},o.color=new Color$1(1,1,1),o.opacity=1,Array.isArray(s.baseColorFactor)&&(l=s.baseColorFactor,o.color.fromArray(l),o.opacity=l[3]),void 0!==s.baseColorTexture&&e.push(r.assignTexture(o,"map",s.baseColorTexture,SRGBColorSpace$1)),o.metalness=void 0!==s.metallicFactor?s.metallicFactor:1,o.roughness=void 0!==s.roughnessFactor?s.roughnessFactor:1,void 0!==s.metallicRoughnessTexture&&(e.push(r.assignTexture(o,"metalnessMap",s.metallicRoughnessTexture)),e.push(r.assignTexture(o,"roughnessMap",s.metallicRoughnessTexture))),a=this._invokeOne(function(e){return e.getMaterialType&&e.getMaterialType(t)}),e.push(Promise.all(this._invokeAll(function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,o)})))),!0===n.doubleSided&&(o.side=DoubleSide$1),n.alphaMode||ALPHA_MODES.OPAQUE);return l===ALPHA_MODES.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,l===ALPHA_MODES.MASK&&(o.alphaTest=void 0!==n.alphaCutoff?n.alphaCutoff:.5)),void 0!==n.normalTexture&&a!==MeshBasicMaterial$1&&(e.push(r.assignTexture(o,"normalMap",n.normalTexture)),o.normalScale=new Vector2$1(1,1),void 0!==n.normalTexture.scale)&&(s=n.normalTexture.scale,o.normalScale.set(s,s)),void 0!==n.occlusionTexture&&a!==MeshBasicMaterial$1&&(e.push(r.assignTexture(o,"aoMap",n.occlusionTexture)),void 0!==n.occlusionTexture.strength)&&(o.aoMapIntensity=n.occlusionTexture.strength),void 0!==n.emissiveFactor&&a!==MeshBasicMaterial$1&&(o.emissive=(new Color$1).fromArray(n.emissiveFactor)),void 0!==n.emissiveTexture&&a!==MeshBasicMaterial$1&&e.push(r.assignTexture(o,"emissiveMap",n.emissiveTexture,SRGBColorSpace$1)),Promise.all(e).then(function(){var e=new a(o);return n.name&&(e.name=n.name),assignExtrasToUserData(e,n),r.associations.set(e,{materials:t}),n.extensions&&addUnknownExtensionsToUserData(i,e,n),e})}createUniqueName(e){e=PropertyBinding$1.sanitizeNodeName(e||"");return e in this.nodeNamesUsed?e+"_"+ ++this.nodeNamesUsed[e]:(this.nodeNamesUsed[e]=0,e)}loadGeometries(r){const i=this,n=this.extensions;var a=this.primitiveCache;var o=[];for(let e=0,t=r.length;e<t;e++){var s=r[e],l=createPrimitiveKey(s),c=a[l];if(c)o.push(c.promise);else{let e;e=s.extensions&&s.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION]?function(t){return n[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,i).then(function(e){return addPrimitiveAttributes(e,t,i)})}(s):addPrimitiveAttributes(new BufferGeometry$1,s,i),a[l]={primitive:s,promise:e},o.push(e)}}return Promise.all(o)}loadMesh(c){const d=this;var e=this.json;const h=this.extensions,u=e.meshes[c],A=u.primitives;var r=[];for(let e=0,t=A.length;e<t;e++){var i=void 0===A[e].material?createDefaultMaterial(this.cache):this.getDependency("material",A[e].material);r.push(i)}return r.push(d.loadGeometries(A)),Promise.all(r).then(function(e){var r=e.slice(0,e.length-1),i=e[e.length-1],n=[];for(let t=0,e=i.length;t<e;t++){var a=i[t],o=A[t];let e;var s=r[t];if(o.mode===WEBGL_CONSTANTS.TRIANGLES||o.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP||o.mode===WEBGL_CONSTANTS.TRIANGLE_FAN||void 0===o.mode)!0===(e=new(!0===u.isSkinnedMesh?SkinnedMesh$1:Mesh$1)(a,s)).isSkinnedMesh&&e.normalizeSkinWeights(),o.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP?e.geometry=toTrianglesDrawMode(e.geometry,TriangleStripDrawMode$1):o.mode===WEBGL_CONSTANTS.TRIANGLE_FAN&&(e.geometry=toTrianglesDrawMode(e.geometry,TriangleFanDrawMode$1));else if(o.mode===WEBGL_CONSTANTS.LINES)e=new LineSegments$1(a,s);else if(o.mode===WEBGL_CONSTANTS.LINE_STRIP)e=new Line$1(a,s);else if(o.mode===WEBGL_CONSTANTS.LINE_LOOP)e=new LineLoop$1(a,s);else{if(o.mode!==WEBGL_CONSTANTS.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+o.mode);e=new Points$1(a,s)}0<Object.keys(e.geometry.morphAttributes).length&&updateMorphTargets(e,u),e.name=d.createUniqueName(u.name||"mesh_"+c),assignExtrasToUserData(e,u),o.extensions&&addUnknownExtensionsToUserData(h,e,o),d.assignFinalMaterial(e),n.push(e)}for(let e=0,t=n.length;e<t;e++)d.associations.set(n[e],{meshes:c,primitives:e});if(1===n.length)return u.extensions&&addUnknownExtensionsToUserData(h,n[0],u),n[0];var l=new Group$1;u.extensions&&addUnknownExtensionsToUserData(h,l,u),d.associations.set(l,{meshes:c});for(let e=0,t=n.length;e<t;e++)l.add(n[e]);return l})}loadCamera(e){let t;var e=this.json.cameras[e],r=e[e.type];if(r)return"perspective"===e.type?t=new PerspectiveCamera$1(MathUtils$1.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===e.type&&(t=new OrthographicCamera$1(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),e.name&&(t.name=this.createUniqueName(e.name)),assignExtrasToUserData(t,e),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const s=this.json.skins[e];var r=[];for(let e=0,t=s.joints.length;e<t;e++)r.push(this._loadNodeShallow(s.joints[e]));return void 0!==s.inverseBindMatrices?r.push(this.getDependency("accessor",s.inverseBindMatrices)):r.push(null),Promise.all(r).then(function(e){var r=e.pop(),i=e,n=[],a=[];for(let e=0,t=i.length;e<t;e++){var o=i[e];o?(n.push(o),o=new Matrix4$1,null!==r&&o.fromArray(r.array,16*e),a.push(o)):console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',s.joints[e])}return new Skeleton$1(n,a)})}loadAnimation(e){var t=this.json;const p=this;var r=t.animations[e];const m=r.name||"animation_"+e;var i=[],n=[],a=[],o=[],s=[];for(let e=0,t=r.channels.length;e<t;e++){var l=r.channels[e],c=r.samplers[l.sampler],l=l.target,d=l.node,h=void 0!==r.parameters?r.parameters[c.input]:c.input,u=void 0!==r.parameters?r.parameters[c.output]:c.output;void 0!==l.node&&(i.push(this.getDependency("node",d)),n.push(this.getDependency("accessor",h)),a.push(this.getDependency("accessor",u)),o.push(c),s.push(l))}return Promise.all([Promise.all(i),Promise.all(n),Promise.all(a),Promise.all(o),Promise.all(s)]).then(function(e){var r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],s=[];for(let e=0,t=r.length;e<t;e++){var l=r[e],c=i[e],d=n[e],h=a[e],u=o[e];if(void 0!==l){l.updateMatrix&&l.updateMatrix();var A=p._createAnimationTracks(l,c,d,h,u);if(A)for(let e=0;e<A.length;e++)s.push(A[e])}}return new AnimationClip$1(m,void 0,s)})}createNodeMesh(e){var t=this.json;const r=this,i=t.nodes[e];return void 0===i.mesh?null:r.getDependency("mesh",i.mesh).then(function(e){e=r._getNodeRef(r.meshCache,i.mesh,e);return void 0!==i.weights&&e.traverse(function(r){if(r.isMesh)for(let e=0,t=i.weights.length;e<t;e++)r.morphTargetInfluences[e]=i.weights[e]}),e})}loadNode(e){var t=this.json.nodes[e],e=this._loadNodeShallow(e),r=[],i=t.children||[];for(let e=0,t=i.length;e<t;e++)r.push(this.getDependency("node",i[e]));t=void 0===t.skin?Promise.resolve(null):this.getDependency("skin",t.skin);return Promise.all([e,Promise.all(r),t]).then(function(e){var r=e[0],i=e[1];const t=e[2];null!==t&&r.traverse(function(e){e.isSkinnedMesh&&e.bind(t,_identityMatrix$1)});for(let e=0,t=i.length;e<t;e++)r.add(i[e]);return r})}_loadNodeShallow(t){var e=this.json;const n=this.extensions,a=this;if(void 0===this.nodeCache[t]){const o=e.nodes[t],s=o.name?a.createUniqueName(o.name):"",r=[];e=a._invokeOne(function(e){return e.createNodeMesh&&e.createNodeMesh(t)});e&&r.push(e),void 0!==o.camera&&r.push(a.getDependency("camera",o.camera).then(function(e){return a._getNodeRef(a.cameraCache,o.camera,e)})),a._invokeAll(function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)}).forEach(function(e){r.push(e)}),this.nodeCache[t]=Promise.all(r).then(function(r){let i;if((i=!0===o.isBone?new Bone$1:1<r.length?new Group$1:1===r.length?r[0]:new Object3D$1)!==r[0])for(let e=0,t=r.length;e<t;e++)i.add(r[e]);var e;return o.name&&(i.userData.name=o.name,i.name=s),assignExtrasToUserData(i,o),o.extensions&&addUnknownExtensionsToUserData(n,i,o),void 0!==o.matrix?((e=new Matrix4$1).fromArray(o.matrix),i.applyMatrix4(e)):(void 0!==o.translation&&i.position.fromArray(o.translation),void 0!==o.rotation&&i.quaternion.fromArray(o.rotation),void 0!==o.scale&&i.scale.fromArray(o.scale)),a.associations.has(i)||a.associations.set(i,{}),a.associations.get(i).nodes=t,i})}return this.nodeCache[t]}loadScene(e){var t=this.extensions,e=this.json.scenes[e];const n=this,i=new Group$1;e.name&&(i.name=n.createUniqueName(e.name)),assignExtrasToUserData(i,e),e.extensions&&addUnknownExtensionsToUserData(t,i,e);var r=e.nodes||[],a=[];for(let e=0,t=r.length;e<t;e++)a.push(n.getDependency("node",r[e]));return Promise.all(a).then(function(r){for(let e=0,t=r.length;e<t;e++)i.add(r[e]);return n.associations=(e=>{const r=new Map;for(var[t,i]of n.associations)(t instanceof Material$1||t instanceof Texture$1)&&r.set(t,i);return e.traverse(e=>{var t=n.associations.get(e);null!=t&&r.set(e,t)}),r})(i),i})}_createAnimationTracks(e,r,t,i,n){var a=[],o=e.name||e.uuid;const s=[];PATH_PROPERTIES[n.path]===PATH_PROPERTIES.weights?e.traverse(function(e){e.morphTargetInfluences&&s.push(e.name||e.uuid)}):s.push(o);let l;switch(PATH_PROPERTIES[n.path]){case PATH_PROPERTIES.weights:l=NumberKeyframeTrack$1;break;case PATH_PROPERTIES.rotation:l=QuaternionKeyframeTrack$1;break;case PATH_PROPERTIES.position:case PATH_PROPERTIES.scale:l=VectorKeyframeTrack$1;break;default:l=1===t.itemSize?NumberKeyframeTrack$1:VectorKeyframeTrack$1}var c=void 0!==i.interpolation?INTERPOLATION[i.interpolation]:InterpolateLinear$1,d=this._getArrayFromAccessor(t);for(let e=0,t=s.length;e<t;e++){var h=new l(s[e]+"."+PATH_PROPERTIES[n.path],r.array,d,c);"CUBICSPLINE"===i.interpolation&&this._createCubicSplineTrackInterpolant(h),a.push(h)}return a}_getArrayFromAccessor(e){let r=e.array;if(e.normalized){var i=getNormalizedComponentScale(r.constructor),n=new Float32Array(r.length);for(let e=0,t=r.length;e<t;e++)n[e]=r[e]*i;r=n}return r}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof QuaternionKeyframeTrack$1?GLTFCubicSplineQuaternionInterpolant:GLTFCubicSplineInterpolant)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function computeBounds(e,t,r){var i=t.attributes,n=new Box3$1;if(void 0!==i.POSITION){var i=r.json.accessors[i.POSITION],a=i.min,o=i.max;if(void 0===a||void 0===o)console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");else{n.set(new Vector3$1(a[0],a[1],a[2]),new Vector3$1(o[0],o[1],o[2])),i.normalized&&(a=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[i.componentType]),n.min.multiplyScalar(a),n.max.multiplyScalar(a));var s=t.targets;if(void 0!==s){var l=new Vector3$1,c=new Vector3$1;for(let e=0,t=s.length;e<t;e++){var d,h,u=s[e];void 0!==u.POSITION&&(h=(u=r.json.accessors[u.POSITION]).min,d=u.max,void 0!==h&&void 0!==d?(c.setX(Math.max(Math.abs(h[0]),Math.abs(d[0]))),c.setY(Math.max(Math.abs(h[1]),Math.abs(d[1]))),c.setZ(Math.max(Math.abs(h[2]),Math.abs(d[2]))),u.normalized&&(h=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[u.componentType]),c.multiplyScalar(h)),l.max(c)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION."))}n.expandByVector(l)}e.boundingBox=n;o=new Sphere$1;n.getCenter(o.center),o.radius=n.min.distanceTo(n.max)/2,e.boundingSphere=o}}}function addPrimitiveAttributes(r,e,i){var t,n=e.attributes,a=[];for(const s in n){var o=ATTRIBUTES[s]||s.toLowerCase();o in r.attributes||a.push(function(e,t){return i.getDependency("accessor",e).then(function(e){r.setAttribute(t,e)})}(n[s],o))}return void 0===e.indices||r.index||(t=i.getDependency("accessor",e.indices).then(function(e){r.setIndex(e)}),a.push(t)),assignExtrasToUserData(r,e),computeBounds(r,e,i),Promise.all(a).then(function(){return void 0!==e.targets?addMorphTargets(r,e.targets,i):r})}const _taskCache=new WeakMap;class DRACOLoader extends Loader$1{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,i){var n=new FileLoader$1(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,e=>{this.parse(e,t,i)},r,i)}parse(e,t,r){this.decodeDracoFile(e,t,null,null,SRGBColorSpace$1).catch(r)}decodeDracoFile(e,t,r,i,n=LinearSRGBColorSpace$1){i={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!r,vertexColorSpace:n};return this.decodeGeometry(e,i).then(t)}decodeGeometry(r,i){var e=JSON.stringify(i);if(_taskCache.has(r)){var t=_taskCache.get(r);if(t.key===e)return t.promise;if(0===r.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const a=this.workerNextTaskID++;t=r.byteLength,t=this._getWorker(a,t).then(e=>(n=e,new Promise((e,t)=>{n._callbacks[a]={resolve:e,reject:t},n.postMessage({type:"decode",id:a,taskConfig:i,buffer:r},[r])}))).then(e=>this._createGeometry(e.geometry));return t.catch(()=>!0).then(()=>{n&&a&&this._releaseTask(n,a)}),_taskCache.set(r,{key:e,promise:t}),t}_createGeometry(t){var r=new BufferGeometry$1;t.index&&r.setIndex(new BufferAttribute$1(t.index.array,1));for(let e=0;e<t.attributes.length;e++){var i=t.attributes[e],n=i.name,a=i.array,o=i.itemSize,o=new BufferAttribute$1(a,o);"color"===n&&(this._assignVertexColorSpace(o,i.vertexColorSpace),o.normalized=a instanceof Float32Array==!1),r.setAttribute(n,o)}return r}_assignVertexColorSpace(r,e){if(e===SRGBColorSpace$1){var i=new Color$1;for(let e=0,t=r.count;e<t;e++)i.fromBufferAttribute(r,e).convertSRGBToLinear(),r.setXYZ(e,i.r,i.g,i.b)}}_loadLibrary(r,e){const i=new FileLoader$1(this.manager);return i.setPath(this.decoderPath),i.setResponseType(e),i.setWithCredentials(this.withCredentials),new Promise((e,t)=>{i.load(r,e,void 0,t)})}preload(){return this._initDecoder(),this}_initDecoder(){if(!this.decoderPending){const r="object"!=typeof WebAssembly||"js"===this.decoderConfig.type;var e=[];r?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then(e=>{var t=e[0],e=(r||(this.decoderConfig.wasmBinary=e[1]),DRACOWorker.toString()),t=["/* draco decoder */",t,"","/* worker */",e.substring(e.indexOf("{")+1,e.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([t]))})}return this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(e){var t=e.data;switch(t.type){case"decode":r._callbacks[t.id].resolve(t);break;case"error":r._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1});const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}function DRACOWorker(){let r,t;onmessage=function(e){const n=e.data;switch(n.type){case"init":r=n.decoderConfig,t=new Promise(function(t){r.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(r)});break;case"decode":const a=n.buffer,o=n.taskConfig;t.then(e=>{var e=e.draco,t=new e.Decoder;try{var r=function(r,i,e,n){var a=n.attributeIDs,o=n.attributeTypes;let s,t;var l=i.GetEncodedGeometryType(e);if(l===r.TRIANGULAR_MESH)s=new r.Mesh,t=i.DecodeArrayToMesh(e,e.byteLength,s);else{if(l!==r.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");s=new r.PointCloud,t=i.DecodeArrayToPointCloud(e,e.byteLength,s)}if(!t.ok()||0===s.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+t.error_msg());var c={index:null,attributes:[]};for(const h in a){var d=self[o[h]];let e,t;if(n.useUniqueIDs)t=a[h],e=i.GetAttributeByUniqueId(s,t);else{if(-1===(t=i.GetAttributeId(s,r[a[h]])))continue;e=i.GetAttribute(s,t)}d=function(e,t,r,i,n,a){var o=a.num_components(),s=r.num_points(),s=s*o,l=s*n.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,n),d=e._malloc(l),t=(t.GetAttributeDataArrayForAllPoints(r,a,c,l,d),new n(e.HEAPF32.buffer,d,s).slice());return e._free(d),{name:i,array:t,itemSize:o}}(r,i,s,h,d,e);"color"===h&&(d.vertexColorSpace=n.vertexColorSpace),c.attributes.push(d)}l===r.TRIANGULAR_MESH&&(c.index=function(e,t,r){var i=r.num_faces(),i=3*i,n=4*i,a=e._malloc(n),t=(t.GetTrianglesUInt32Array(r,n,a),new Uint32Array(e.HEAPF32.buffer,a,i).slice());return e._free(a),{array:t,itemSize:1}}(r,i,s));return r.destroy(s),c}(e,t,new Int8Array(a),o),i=r.attributes.map(e=>e.array.buffer);r.index&&i.push(r.index.array.buffer),self.postMessage({type:"decode",id:n.id,geometry:r},i)}catch(e){console.error(e),self.postMessage({type:"error",id:n.id,error:e.message})}finally{e.destroy(t)}})}}}const dracoLoader=new DRACOLoader,gltfLoader=(dracoLoader.setDecoderPath("/draco/"),new GLTFLoader);gltfLoader.setDRACOLoader(dracoLoader);class GeometryFile extends LoadableComponent{constructor(e,t){super(e,t),checkPropTypes(t,{geometryNames:e=>Array.isArray(e)&&e.every(e=>"string"==typeof e)},{})}async _load(e,t){const o=this,s=new URL(e.url.href+this._settings.source[t].path);return this.report({msg:"Loading image from "+s}),new Promise((n,a)=>{gltfLoader.load(s.href,function(e){var t,r={};for(t of o._settings.geometryNames){var i=e.scene.getObjectByName(t,!0);i||a(`Missing specified geometry "${t}" in geometry file at `+s),r[t]=i.geometry}n({file:e,geometries:r})},void 0,function(e){a(e)})})}}GeometryFile._exportName={singular:"geometryFile",plural:"geometryFiles"};class Geometry extends BuildableComponent{constructor(e,t){super(e,t,{parse:{file:"alternatives"}}),checkPropTypes(t,{file:e=>Array.isArray(e)?e.every(e=>e instanceof GeometryFile):e instanceof GeometryFile,geometryName:"string"},{})}async _build(e,t,r){switch(this._status[e][t].setState("loading"),e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":this._setContent("main",t,r.file.content.main[t].geometries[this._settings.geometryName]);break;default:this._setContent(e,t,null)}return this}}Geometry._exportName={singular:"geometry",plural:"geometries"};class Environment extends BuildableComponent{constructor(e,t){super(e,t,{parse:{lights:"integral"}}),checkPropTypes(t,{},{envMap:EnvironmentMap,lights:e=>Array.isArray(e)&&e.every(e=>e instanceof Light)}),null!=t.envMap&&(this._envMapEXR=t.envMap._envMap),this._lights=t.lights,this._envMapCube=t.cubeMap}_setEnvironment(){}}class SceneManager extends InformationSource{constructor(e,t){super(e,t),this._scene=new Scene,this.actors=[],checkPropTypes(t,{},{environments:e=>Array.isArray(e)&&e.every(e=>e instanceof Environment)}),null!=t.environments&&(this._environments=t.environments,this._scene.environment=t.environments[0]._envMapEXR)}get scene(){return this._scene}addActor(e){this.report({msg:"Adding "+e.label,level:"notice"}),this.actors.push(e)}}SceneManager.basis="+X+Y+Z";const basesRegex=/^([+-][xyz])([+-][xyz])([+-][xyz])$/i,nameToIndex={x:0,y:1,z:2},orderedVectors=[new Vector3,new Vector3,new Vector3];function stringToAxes(e){return basesRegex.test(e)?(e=e.toLowerCase()).match(basesRegex).splice(1,3).map(e=>{return{negative:"-"===e[0],name:e[1]}}):null}function getBasisTransform(e,t,r){if(!basesRegex.test(e))return null;if(!basesRegex.test(t))return null;var i=stringToAxes(e),n=stringToAxes(t);for(let e=0;e<3;e++){var a=i[e],o=n[e],s=nameToIndex[a.name],a=a.negative===o.negative,s=orderedVectors[s];s.set(0,0,0),s[o.name]=a?1:-1}r.makeBasis(orderedVectors[0],orderedVectors[1],orderedVectors[2])}const dracoLoader$1=new DRACOLoader,pathToDir=window.location.origin,gltfLoader$1=(dracoLoader$1.setDecoderPath(pathToDir+"/draco/"),new GLTFLoader);gltfLoader$1.setDRACOLoader(dracoLoader$1);class GLTF extends LoadableComponent{constructor(e,t){super(e,t),checkPropTypes(t,{meshNames:e=>Array.isArray(e)&&e.every(e=>"string"==typeof e),basis:"string"},{}),this.transformMatrix=new Matrix4,getBasisTransform(t.basis||"+X+Y+Z",SceneManager.basis,this.transformMatrix)}async _load(e,t){const l=this,c=new URL(e.url.href+this._settings.source[t].path);return this.report({msg:"Loading file from "+c}),new Promise((o,s)=>{gltfLoader$1.load(c.href,function(e){var t,r={};for(t of l._settings.meshNames){var i=e.scene.getObjectByName(t,!0),n=(i||s(`Missing object ${t} in GLTF `+c),new Mesh),a=(n.name=t,n.geometry=i.geometry,new Group),n=(l.transformMatrix.decompose(a.position,a.quaternion,a.scale),{meshName:t,mesh:n,transformMatrix:l.transformMatrix,transformQuaternion:a.quaternion,basis:l.settings.basis});i||s(`Missing specified geometry "${t}" in geometry file at `+c),r[t]=n}o({file:e,gltf:r})},void 0,function(e){console.warn("ERROR"),s(e)})})}}GLTF._exportName={singular:"gltf",plural:"gltfs"};class WrappedMesh extends BuildableComponent{constructor(e,t){super(e,t),checkPropTypes(t,{meshName:"string",gltf:GLTF,defaultMaterial:WrappedMaterial},{materialVariantGroup:MaterialSet,tilingMultiplier:"number",aoMap:WrappedTexture,aoMapIntensity:"number",normalMap:WrappedTexture,normalMapIntensity:"number"}),Object.getOwnPropertyDescriptor(this,"materialVariantGroup")||(this.materialVariantGroup=t.materialVariantGroup),this._tilingMultiplier=t.tilingMultiplier,this._aoMap=t.aoMap,this._aoMapIntensity=t.aoMapIntensity,this._normalMap=t.normalMap,this._normalMapTiling=t.normalMapTiling,this._normalMapScale=t.normalMapIntensity,this._meshObject=null}async buildMeshMaterial(e){var t=this._normalMap.content.main.medium,r=(t.encoding=3e3,t.wrapS=RepeatWrapping,t.wrapT=RepeatWrapping,t.repeat=this._normalMapTiling,this._normalMapTiling),t=new TextureNode(t),t=buildNodeMaterial(e,t,r);return t.userData={PB:{origin:e.userData.PB.origin}},t.envMap=e.envMap,this._meshObject.mesh.material=t,this._meshObject.mesh.material.normalScale={x:2,y:2},this._meshObject.mesh.material.needsUpdate=!0,t}async _build(e,t,r){switch(this._status[e][t].setState("loading"),e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":if(this._settings.materialVariantGroup&&!this._settings.materialVariantGroup.has(this._settings.defaultMaterial))throw new Error(`Can not construct ${this.label} because def mat ${this._settings.defaultMaterial.name||this._settings.defaultMaterial.id} is not in its matVarGrp `+(settings.materialVariantGroup.name||settings.materialVariantGroup.id));if(this._meshObject=r.gltf.content.main[t].gltf[this._settings.meshName],this._meshObject.mesh.material=r.defaultMaterial.content.main[t],this.tilingMultiplier)for(var i of["bumpMap","emissiveMap","map","specularMap","roughnessMap","metalnessMap","normalMap","aoMap"])this._meshObject.mesh.material[i]&&(this._meshObject.mesh.material=this._meshObject.mesh.material.clone(),this._meshObject.mesh.material[i]=this._meshObject.mesh.material[i].clone(),this._meshObject.mesh.material[i].repeat.x*=this._settings.tilingMultiplier,this._meshObject.mesh.material[i].repeat.y*=this._settings.tilingMultiplier,this._meshObject.mesh.material[i].needsUpdate=!0);this._aoMap&&(this._meshObject.mesh.material.aoMap=this._aoMap.content.main[t],this._meshObject.mesh.material.aoMap.needsUpdate=!0),this._aoMapIntensity&&(this._meshObject.mesh.material.aoMapIntensity=this._aoMapIntensity,this._meshObject.mesh.material.aoMap.needsUpdate=!0),this._normalMap&&this.buildMeshMaterial(this._meshObject.mesh.material),this._meshObject.mesh.castShadow=!0,this._meshObject.mesh.receiveShadow=!0,this._setContent("main",t,this._meshObject);break;default:this._setContent(e,t,null)}return this}}WrappedMesh._exportName={singular:"mesh",plural:"meshes"};class Export{constructor(){throw this.revision=1,new Error("Not implemented")}}class PositionedComponent extends BuildableComponent{constructor(e,t){t.assignable=!0===t.assignable,super(e,t),checkPropTypes(t,{component:[{test:BuildableComponent,msg:"must be buildable"},{test:e=>!(e instanceof PositionedComponent),msg:"Do not nest positioned components"}],quaternion:Quaternion,position:Vector3},{}),Object.getOwnPropertyDescriptor(this,"component")||(this.component=t.component),Object.getOwnPropertyDescriptor(this,"assignable")||Object.defineProperty(this,"assignable",{get:()=>t.component.assignable})}get materializable(){return void 0!==this.component.settings.materialVariantGroup}async _build(e,t,r){switch(e){case"UI":this._setContent("UI",t,this._settings.component.content.UI[t]);break;case"main":var i=this._settings.component.content.main[t],n=(i instanceof Object3D?i:Object.values(i).find(e=>e instanceof Object3D)).clone();n.castShadow=!0,n.receiveShadow=!0,n.layers.toggle(Project.layerMap.visibleActors),n.translateX(this._settings.position.x),n.translateY(this._settings.position.y),n.translateZ(this._settings.position.z),i.transformMatrix instanceof Matrix4&&n.setRotationFromMatrix(i.transformMatrix),n.quaternion.multiply(this._settings.quaternion),n.updateMatrixWorld(),n.name=this.id,Object.defineProperty(n.userData,"origin",{get:()=>(console.log("DEPRECATED! Use userData.PB.origin"),this.id)}),n.userData.PB={origin:this.id,type:this.constructor.name},this._setContent("main",t,n);break;default:this._setContent(e,t,null)}return this}}PositionedComponent._exportLevel="inline";class PositionedMesh extends PositionedComponent{constructor(e,t){super(e,t),checkPropTypes(t,{component:WrappedMesh},{})}}PositionedMesh._exportName={singular:"positionedMesh",plural:"positionedMeshes"},PositionedMesh._exportLevel="inline";class MeshGroup extends BuildableComponent{constructor(e,t){super(e,t,{parse:{positionedMeshes:"integral"}}),checkPropTypes(t,{positionedMeshes:[{test:e=>Array.isArray(e),msg:"Value is not an array"},{test:e=>e.every(e=>e instanceof PositionedMesh),msg:"Array element is not a PositionedMesh"}]},{}),this.subAssignables=t.positionedMeshes.filter(e=>!0===e.assignable)}async _build(e,t,r){switch(this._status[e][t].setState("loading"),e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":var i,n=Object.values(this._settings.positionedMeshes),a=(this._debug&&console.log(n),new Group);for(i of n){var o=i.content.main[t].clone();a.add(o),a.castShadow=!0,a.receiveShadow=!0}this._setContent("main",t,a);break;default:this._setContent(e,t,null)}return this}}MeshGroup._exportName={singular:"meshGroup",plural:"meshGroups"};class PositionedMeshGroup extends PositionedComponent{constructor(e,t){super(e,t),checkPropTypes(t,{component:MeshGroup},{})}}PositionedMeshGroup._exportName={singular:"positionedMeshGroup",plural:"positionedMeshGroups"},PositionedMeshGroup._exportLevel="inline";class BlockCategoryType extends BuildableComponent{constructor(e,t){super(e,t),checkPropTypes(t,{name:"string"},{})}_onTreeSet(){const t=this;this._tree.on("change",({cls:e=[]})=>{e.includes(BlockCategory)&&(t.report({msg:"Block categories changed in package. Rebuilding."}),t._rebuild("main"))},this.id),this._rebuild("main")}_onTreeUnset(){this._tree.hasListener("change",this.id)&&this._tree.removeListener("change",this.id)}async _build(e,t){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":var r,i=this._tree?this._tree.blockCategories.filter(e=>e.settings.type===this):[];for(r of Component.qualities)this._setContent("main",r,i);this.report({msg:`Built block category type of ${i.length} block categories.`});break;default:this._setContent(e,t,null)}return this}}BlockCategoryType._exportName={singular:"blockCategoryType",plural:"blockCategoryTypes"};class BlockCategory extends BuildableComponent{constructor(e,t){super(e,t),checkPropTypes(t,{name:"string",type:BlockCategoryType},{id:UUIDRegex})}_onTreeSet(){const t=this;this._tree.on("change",({cls:e=[]})=>{e.includes(Block)&&(t.report({msg:"Blocks changed in package. Rebuilding."}),t._rebuild())},this.id),this._rebuild()}_onTreeUnset(){this._tree.hasListener("change",this.id)&&this._tree.removeListener("change",this.id)}async _build(e,t){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":var r=this._tree?this._tree.blocks.filter(e=>(e.settings.categories||[]).find(e=>e===this)):[];this._setContent("main",t,r),this.report({msg:`Built category of ${r.length} blocks.`});break;default:this._setContent(e,t,null)}return this}}BlockCategory._exportName={singular:"blockCategory",plural:"blockCategories"};class Block extends BuildableComponent{constructor(e,r){if(r.assignable="boolean"!=typeof r.assignable||r.assignable,r.dimensions=void 0!==r.dimensions?r.dimensions:new Vector3(1,1,1),r.dimensionsCenter=void 0!==r.dimensionsCenter?r.dimensionsCenter:new Vector3(.5,.5,.5),super(e,r,{parse:{positionedMeshes:"integral",positionedMeshGroups:"integral",connectors:"integral",categories:"integral",corners:"integral"}}),this.distinctPositionedMeshes=void 0,this.distinctMeshes=void 0,this.distinctMVGs=void 0,this.distinctMeshesPerMVG=void 0,this.subAssignables=void 0,this.connectors||(this.connectors=[]),checkPropTypes(r,{},{theme:Theme,connectors:e=>Array.isArray(e)&&e.every(e=>e instanceof Connector),positionedMeshes:e=>Array.isArray(e)&&e.every(e=>e instanceof PositionedMesh),positionedMeshGroups:e=>Array.isArray(e)&&e.every(e=>e instanceof PositionedMeshGroup),categories:e=>Array.isArray(e)&&e.every(e=>e instanceof BlockCategory),corners:e=>Array.isArray(e)&&e.every(e=>e instanceof Vector3)}),r.theme){e=(r.connectors||[]).find(e=>e.themeGroup);if(e)throw new Error(`${this.label} has theme "${r.theme.name}" AND ${e.label} with theme group "${e.themeGroup.name}". This is not allowed.`)}for(var t of r.connectors||[])t.block=this;this.distinctPositionedMeshes=this.allDependencies.filter(e=>e instanceof PositionedMesh).filter(unique),this.distinctMeshes=this.distinctPositionedMeshes.map(e=>e.component).filter(unique),this.distinctMVGs=[],this.distinctMeshesPerMVG={};for(var i of this.distinctMeshes)i.materialVariantGroup&&(this.distinctMVGs.includes(i.materialVariantGroup)||this.distinctMVGs.push(i.materialVariantGroup),this.distinctMeshesPerMVG[i.materialVariantGroup.id]=[i,...this.distinctMeshesPerMVG[i.materialVariantGroup.id]||[]]);this.subAssignables=(r.positionedMeshes||[]).filter(e=>1==e.assignable).map(e=>({positionedMesh:e}));for(let t of r.positionedMeshGroups||[])!0===t.assignable&&this.subAssignables.push({positionedMeshGroup:t}),this.subAssignables.push(...t.assignableDependencies.map(e=>({positionedMeshGroup:t,positionedMesh:e})));for(var n of this.subAssignables)if(n.assigningComponent=getAssigningComponent(n),n.materialVariantGroups=n.assigningComponent.applicableMaterialVariantGroups,n.id="B:"+this.slug,n.name=this.name||this.slug,n.positionedMeshGroup&&(n.name+=" "+n.positionedMeshGroup.slug,n.id="-MG:"+n.positionedMeshGroup.slug),n.positionedMesh){n.name+=" "+n.positionedMesh.name||n.positionedMesh.slug;let e="";e=void 0===n.positionedMeshGroup?(console.warn(`SubAssignable ${n.label} positionedMesh missing positionedMeshGroup`),"unknown"):"-M:"+n.positionedMeshGroup.slug,n.id=e}var e=new Vector3(-this.settings.dimensions.x/2,-this.settings.dimensions.y/2,-this.settings.dimensions.z/2),r=new Vector3(this.settings.dimensions.x/2,this.settings.dimensions.y/2,this.settings.dimensions.z/2),e=new Box3(e,r),r=new Float32Array([e.min.x,e.min.y,e.min.z,e.min.x,e.min.y,e.max.z,e.max.x,e.min.y,e.max.z,e.max.x,e.min.y,e.min.z,e.min.x,e.max.y,e.min.z,e.min.x,e.max.y,e.max.z,e.max.x,e.max.y,e.max.z,e.max.x,e.max.y,e.min.z]),e=new BufferGeometry,r=(e.name="boundingBox",e.visible=!1,e.setAttribute("position",new BufferAttribute(r,3)),new Matrix4),a=new Quaternion,o=new Vector3(1,1,1);r.compose(this.settings.dimensionsCenter,a,o),e.applyMatrix4(r),this.boundingBox=e}_onTreeSet(){}async _build(e,t,r){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":var i=new Group,n=(i.castShadow=!0,i.receiveShadow=!0,i.layers.set(Project.layerMap.visibleActors),new AxesHelper(5),(new Group).name="connectors",new Vector3(0,0,.1)),a=(n.normalize(),new Vector3(0,0,0));new ArrowHelper(n,a,.15,16711680,.05,.05);if(this._settings.positionedMeshGroups){var o,n=Object.values(this._settings.positionedMeshGroups||{});this._debug&&console.log("PosMeshGroups groups",n);for(o of n){var s=o.content.main[t].clone();i.add(s)}}if(this._settings.positionedMeshes){var l,a=Object.values(this._settings.positionedMeshes);this._debug&&console.log("Positioned meshed",a);for(l of a){var c=l.content.main[t].clone();c.castShadow=!0,c.receiveShadow=!0,i.add(c)}}n={block:i,connectors:this._settings.connectors||[]};this._setContent("main",t,n);break;case"specs":this._settings.dimensionsImage?this._setContent("specs",t,this._settings.dimensionsImage.content.main[t]):this._setContent("specs",t,Project.defaultImages.missing.cloneNode(!0));break;default:this._setContent(e,t,null)}return this}}Block._exportName={singular:"block",plural:"blocks"};class ConnectionType extends BuildableComponent{constructor(e,t){t.connectors||(t.connectors=[]),super(e,t,{parse:{connectorTypes:"integral",connectors:"integral"}}),checkPropTypes(t,{connectorTypes:t=>{if(!Array.isArray(t))return"Not an array";if(2!==t.length)return t.length+" connector types specified, but only 2 are allowed.";for(let e=0;e<t.length;e+=1){var r=t[e];if(!(r instanceof ConnectorType))return`Entry connectorTypes[${e}] is not a ConnectorType, but a `+r.constructor.name}return!0}},{parent:[ConnectorType,e=>!!t.connectorTypes.includes(e)||"Parent connector type is not in allowed connector types."]})}get isEqual(){return void 0===this._settings.parent}async _build(e,t){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":var r=this._settings;this._setContent("main",t,r);break;default:this._setContent(e,t,null)}return this}}ConnectionType._exportName={singular:"connectionType",plural:"connectionTypes"};class ComponentTree$1 extends BuildableComponent{constructor(e,i={},n={}){var t,r=[],a=n.import||[];for(t of a){var o=t.cls.exportName;void 0!==i[o]&&r.push(...i[o]),i[o]=[]}var s=Object.keys(i).filter(e=>Array.isArray(i[e])&&0<i[e].length);if(0<s.length)throw new Error("Component tree found no import instructions for settings: "+s.join(", "));if(super(e,i,{autoLinkDependencies:void 0===n.autoLinkDependencies||n.autoLinkDependencies,...BuildableComponent.autogenIntegralInstruction(i)}),this._tree=void 0,this._externalTrees=void 0,this._importInlined=void 0,this.loader=void 0,this._componentsById=void 0,this.renderer=void 0,this.pmremGenerator=void 0,(this._tree=this)._componentsById={},n.renderer&&(this.renderer=n.renderer,this.pmremGenerator=new PMREMGenerator(this.renderer)),checkPropTypes(n,{},{externalTrees:t=>{if(!Array.isArray(t))return"Not an array.";for(let e=0;e<t.length;e+=1){var r=t[e];if(!(r instanceof ComponentTree$1))return`Instruction externalTrees[${e}] is not a ComponentTree, but a `+r.constructor.name}return!0},loader:ComponentLoader}),this.addEvent("change"),this.addEvent("import-complete"),this._importInstructions=a,this._importInlined=a.filter(e=>"inline"===e.cls.exportLevel).reduce((e,t)=>Object.assign(e,{[t.cls.exportName]:t.cls}),{}),n.externalTrees){this._externalTrees=n.externalTrees;var l={};for(let r of[...Object.keys(i),...n.externalTrees.map(e=>Object.keys(e.settings)).flat()].filter(unique))Object.defineProperty(l,r,{get:()=>{var e,t=[];for(e of[i[r],...n.externalTrees.map(e=>e[r])].filter(e=>void 0!==e).filter(unique))Array.isArray(e)?t.push(...e):t.push(e);return t}});this.inclusive=l}this.loader=n.loader||new ComponentLoader(this._reporter),0<r.length&&this.addComponent(...r)}findComponentById(e){var t=this._componentsById[e];if(t)return t;if(Array.isArray(this._externalTrees))for(const i of this._externalTrees){var r=i.findComponentById(e);if(r)return r}}findDependingComponents(e){var t,r=[];for(t of Object.values(this.settings).filter(e=>Array.isArray(e)))for(var i of t)if(i instanceof BuildableComponent)for(var n of Component.parts)-1!==Object.values(i.dependencies[n]).indexOf(e)&&r.push(i);return r}_throwIfDependingComponents(e){e=this.findDependingComponents(e);if(0<e.length)throw new Error("Component is depended upon by "+e.map(e=>e.constructor.name+" "+e.name||e.id).join(", "))}hasComponent(t){return!!(this._settings[t.exportName]&&-1<this._settings[t.exportName].indexOf(t))||!(!this._externalTrees||!this._externalTrees.find(e=>e[t.exportName]&&-1<e[t.exportName].indexOf(t)))}addComponent(e,...t){this._addComponent(e,...t),this._postChangeHandler([e,...t])}_addComponent(t,...e){this.report({msg:"Adding a "+t.constructor.name,level:"debug"});let r=!0;Array.isArray(e)&&!1===e[0]&&(r=!1,e=void 0);var i=this._settings[t.exportName];if(this._externalTrees&&this._externalTrees.find(e=>e[t.exportName]&&-1<e[t.exportName].indexOf(t)))this.report({msg:"Component already in external tree "+t.label,level:"debug"});else{if(!i)throw new Error(`${this.label} Can not add unknown component class: ${t.constructor.name} -> `+t.exportName);if(!0===r&&t instanceof BuildableComponent||"Block"===t.constructor.name||"MeshGroup"===t.constructor.name)for(var n of Component.parts)for(var[a,o]of Object.entries(t.dependencies[n])||[])if(Array.isArray(o)&&0<o.length){var s=o.filter(e=>!1===this.hasComponent(e));this.report({msg:`Adding ${s.length} new dependencies of ${o.length} total for ${t.constructor.name}.`+a,level:"debug"}),s.forEach(e=>{this._addComponent(e)})}else{if(!(o instanceof Component))throw new Error("Dependency not an instance of Component!");try{!1===this.hasComponent(o)&&(this.report({msg:`Adding dependency: ${t.constructor.name}.`+a,level:"debug"}),this._addComponent(o))}catch(e){throw console.error(e,o),e}}if(-1<i.indexOf(t))this.report({msg:"Component already in tree "+t.label,level:"debug"});else{var l,c=this._componentsById[t.id];if(c)throw new Error("Component id already in tree: "+c.label);i.push(t),(this._componentsById[t.id]=t)instanceof ComponentTree$1||(t.tree=this),this.report({msg:"Added "+t.label,level:"debug"});for(l of Component.parts)for(var d of Component.qualities)"ready"===this._status[l][d].state&&this._status[l][d].setState("partially-loaded")}}if(e)for(var h of e)this._addComponent(h);return!0}_postChangeHandler(e){console.assert(Array.isArray(e),"component_tree._postChangeHandler() expects an array, not a "+e.constructor.name),this._autoLink(this._settings,BuildableComponent.autogenIntegralInstruction(this._settings));e=e.map(e=>e.constructor).filter(unique);this.emit("change",{type:"autolinked-dependencies",tree:this,cls:e})}removeComponent(e,t){var r=this._settings[e.exportName];if(!r)throw new Error("Unknown component class "+e.constructor.name);this._throwIfDependingComponents(e);var i=r.indexOf(e);if(-1===i)throw new Error(e.constructor.name+" is not included in tree");if(r.splice(i,1),delete this._componentsById[e.id],t&&e instanceof BuildableComponent)for(var n of e.dependencies)if(0===this.findDependingComponents(n).length)try{this.removeComponent(n)}catch(e){throw new Error(`Could not remove dependency ${n.name||n.id}. `+e.message)}this._postChangeHandler([e]),this.report({msg:"Removed "+e.label}),this.emit("change",{type:"component-removed",cls:[e.constructor],component:e,tree:this})}static linkSetting(i,n,t){if(Array.isArray(t))return t.map(e=>ComponentTree$1.linkSetting(i,n,e));if("object"==typeof t){const r=Object.keys(t);return 2===r.length&&["x","y"].every(e=>r.includes(e))?new Vector2(t.x,t.y):3===r.length&&["x","y","z"].every(e=>r.includes(e))?new Vector3(t.x,t.y,t.z):4===r.length||5===r.length&&["_x","_y","_z","_w"].every(e=>r.includes(e))?new Quaternion(t._x,t._y,t._z,t._w):3===r.length&&["r","g","b"].every(e=>r.includes(e))?1<t.r||1<t.g||1<t.b?new Color(t.r/255,t.g/255,t.b/255):new Color(t.r,t.g,t.b):i._importInlined[n]?(e=ComponentTree$1.linkJSONObj(i,t),new i._importInlined[n](i._reporter,e)):Object.entries(t).reduce((e,[t,r])=>Object.assign(e,{[t]:ComponentTree$1.linkSetting(i,n,r)}),{})}if(void 0!==t){if("string"==typeof t&&"id"!==n&&null!==t.match(UUIDRegex)){var e=i.findComponentById(t);if(e)return e;throw new Error(`Missing dependency "${n}": `+t)}if("string"!=typeof t||null===t.match(URLRegex))return"string"==typeof t&&2===t.length&&t.match(/[\+|-][x|y|z]/)?Project.standardQuaternions[t]:("map"===n.toLowerCase().substr(-3)||"thumbnail"===n?this.report({level:"warning",msg:`Seems like imported property ${n} should be linked, but its value is not a (valid) UUID.`}):"url"===n&&this.report({level:"warning",msg:`Seems like imported property ${n} should be a valid URL, but it isn't recognized as one.`}),t);try{return new URL(t)}catch(e){return t}}}static linkJSONObj(i,e){return Object.entries(e).reduce((e,[t,r])=>{r=ComponentTree$1.linkSetting(i,t,r);return void 0!==r&&(e[t]=r),e},{})}_instantiateLinkedComponentFromJSONObject(e,t){let r=null;try{r=ComponentTree$1.linkJSONObj(this,e)}catch(e){throw e.message+=" while importing "+t.exportName,new Error(e)}return r.source&&r.source.path&&(r.source={medium:r.source}),new t(this._reporter,r,{tree:this})}static createFromJSON(e,t,r,i={}){let n={};for(var a of Object.keys(e))"section"===a.substr(-7).toLowerCase()&&delete e[a];var o,s,l=this.importInstructions.map(e=>e.cls.exportName);for([o,s]of Object.entries(e))l.includes(o)||(n[o]=s);if(e.pkg){if(!r)throw new Error("Missing pkg argument");if(r.id!==e.pkg)throw new Error("Wrong pkg argument");(n=ComponentTree$1.linkJSONObj(r,omit(["pkg"],n))).pkg=r}r=new this(t,n,i);return r.importJSON(e),r}importJSON(e){var t=(new Date).getTime();e.id;if(e.id&&e.id!==this.id)throw new Error(`Look like a complete export. Did you mean to call ${this.constructor.name}.createFromJSON()?`);this.report({msg:"Start importing new JSON object"});let r=null;var i,n=[],a=[];for(i of this._importInstructions)if(void 0!==e[i.cls.exportName]&&(this.report({msg:`Found ${i.cls.exportName} entry in JSON obj`}),i.cls===Component||i.cls.prototype instanceof Component)){var o=e[i.cls.exportName];if("Configuration"===i.cls.name)for(var s of o)a.push(s);else{console.assert(Array.isArray(o)),this.report({msg:`Importing ${o.length} component`+(1<o.length?"s":"")});for(var l of o)try{var c=this._instantiateLinkedComponentFromJSONObject(l,i.cls);this._addComponent(c,!1),n.push(c)}catch(e){r=e;break}if(r)break}}var d=(new Date).getTime();if(null!==r)this.report({level:"error",msg:"Basic import failed"});else{this.report({level:"info",msg:`Basic import complete in ${d-t}ms`}),this._postChangeHandler(n),this.emit("import-complete",{tree:this});for(var h of a){var h=ComponentTree$1.Configuration.createFromJSON({...h},this._reporter,this),u=h.copy();u.id=h.id,n.push(u),this._settings.configurations=this._settings.configurations||[],this._settings.configurations.push(u)}d=(new Date).getTime();if(null===r)return this.report({level:"notice",msg:`Full import complete in ${d-t}ms`}),n;this.report({level:"error",msg:"Full import incomplete"})}throw r}toJSON(){var e=super.toJSON(),t=this.constructor.importInstructions.map(e=>e.cls),r=t.map(e=>e.exportName),t=t.filter(e=>"inline"===e.exportLevel),r=pick(r,e),i={};if(Object.assign(i,e[this.exportName][0]),Object.assign(i,r),"Package"===this.constructor.name)for(var n of t)delete i[n.exportName];return this.pkg&&(i.pkg=this.pkg.id),i}destroy(){"function"==typeof super.destroy&&super.destroy()}}class BlockSet extends BuildableComponent{constructor(e,t){super(e,t,{autoLinkDependencies:!1}),this.allBlocks=[],checkPropTypes(t,{name:"string"},{categories:e=>Array.isArray(e)&&e.every(e=>e instanceof BlockCategory),blocks:e=>Array.isArray(e)&&e.every(e=>e instanceof Block),id:UUIDRegex}),this._dependencies.main={};for(var r of t.blocks||[])this.addExportDependency("block-"+r.id,r);for(var i of t.categories||[])this.addExportDependency("category-"+i.name,i);t.thumbnail&&(this._dependencies.UI=[t.thumbnail]),this.collectBlocks()}_onTreeSet(){const t=this;this._tree.on("change",({cls:e=[]})=>{e.includes(Block,BlockCategory)&&(t.report({msg:"Blocks or block categories changed in package. Rebuilding."}),t._rebuild())},this.id),this._rebuild()}_onTreeUnset(){this._tree.hasListener("change",this.id)&&this._tree.removeListener("change",this.id)}has(e){return this.allBlocks.includes(e)}size(e=0){return this.allBlocks.length}collectBlocks(){var e=this._tree?this._tree.blocks.filter(e=>(e.settings.categories||[]).some(e=>(this.settings.categories||[]).includes(e))||-1<this._settings.blocks.indexOf(e)):this._settings.blocks||[];this.allBlocks=e,this.report({msg:`size ${e.length} blocks`})}async _build(e,t){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":this.collectBlocks(),this._setContent("main",t,this.allBlocks);break;default:this._setContent(e,t,null)}return this}}BlockSet._exportName={singular:"blockSet",plural:"blockSets"};const emptyConnectorTemplate={connectors:[]};class Connectable extends BuildableComponent{constructor(e,t){if(super(e,t),this.connectorTemplate=void 0,this.connections=void 0,this.equalConnections=void 0,this.unequalConnections=void 0,this.connectedTo=void 0,this.siblings=void 0,this.parentConnection=void 0,this.parent=void 0,this.childConnections=void 0,this.children=void 0,this.childMaterialAssignments=void 0,!this.constructor.connectorTemplateSetting)throw new Error(this.constructor.name+" is missing static property connectorTemplateSetting");checkPropTypes(t,{},{[this.constructor.connectorTemplateSetting]:[BuildableComponent]}),t[this.constructor.connectorTemplateSetting]?this.connectorTemplate=t[this.constructor.connectorTemplateSetting]:this.connectorTemplate=emptyConnectorTemplate}clone(e={}){e=super.clone(e);return e.connectorTemplate=this.connectorTemplate,e}get siblingChains(){var e,t=[],r={};for(e of this.siblings||[]){var i=[e,...Connectable.findSiblings(e,[this,...t])];r[e.id]=i,t.push(...i)}return r}findMaterialAssignments(){return this._tree&&this._tree.materialAssignments?this._tree.materialAssignments.filter(e=>e.blockInstance===this):[]}_updateConnections(){this.materialAssignments=this.findMaterialAssignments(),this.connections=(this._tree.connections||[]).filter(e=>e.from.connectable===this&&this.connectorTemplate.connectors.includes(e.from.connector)||e.to.connectable===this&&this.connectorTemplate.connectors.includes(e.to.connector)),this.equalConnections=this.connections.filter(e=>void 0===e.type.parent),this.unequalConnections=this.connections.filter(e=>void 0!==e.type.parent),this.connectedTo=this.connections.map(e=>(e.from.connectable===this?e.to:e.from).connectable),this.siblings=this.equalConnections.map(e=>(e.from.connectable===this?e.to:e.from).connectable);(this.block||this).label;var e=this.unequalConnections.filter(e=>{return!(e[e.from.connectable===this?"from":"to"].connector.type===e.type.parent)});let t=null;switch(e.length){case 0:break;case 1:t=e[0];break;default:throw console.info("Multiple parent connections:",e),new Error(this.label+" has more than one parent!")}t&&(r=(this.parentConnection=t).from.connectable===this?"to":"from",this.parent=t[r].connectable);var r=this.unequalConnections.filter(e=>{return e!==t});r&&(this.childConnections=r,this.children=r.map(e=>e.connectables.find(e=>e!==this)),this.childMaterialAssignments=this.children.map(e=>e.findMaterialAssignments()).flat())}_onTreeSet(){console.assert(this._tree instanceof Configuration,this.constructor.name+" can not be added to a "+this._tree.constructor.name);const t=this;if(!this._tree.findComponentById(this.connectorTemplate.id))throw new Error(`ConnectorTemplate ${this.connectorTemplate.label} not in tree`);this._tree.on("change",({cls:e})=>{e.find(e=>"Connection"===e.name)?t._updateConnections():e.find(e=>"MaterialAssignment"===e.name)&&(this.materialAssignments=this.findMaterialAssignments())},this.id),this._updateConnections()}_onTreeUnset(){this._tree.removeListeners("change",this.id),this.connections=void 0,this.connectedTo=void 0,this.materialAssignments=void 0,this.childMaterialAssignments=void 0}}Connectable.findSiblings=(t,r=[])=>(t.siblings||[]).filter(e=>!r.includes(e)).map(e=>[e,...Connectable.findSiblings(e,[t,...r])]).flat();class BlockInstance extends Connectable{constructor(e,t){checkPropTypes(t,{block:Block},{textureRepeat:Vector2,textureOffset:Vector2,textureRotation:"number",scale:Vector3}),super(e,t),this.assignableByDefinerId=void 0,this.bestMainContent=void 0,this.bestMainContent=new Group,this.bestMainContent.castShadow=!0,this.bestMainContent.receiveShadow=!0,this.block||(this.block=t.block),this.assignableByDefinerId={},this.assignables=this.block.subAssignables.map(e=>({blockInstance:this,...e})),!0===this.assignable&&this.assignables.push({blockInstance:this,assigningComponent:this,materialVariantGroups:this.applicableMaterialVariantGroups,name:this.block.name||this.block.slug});for(var r of this.assignables){this.assignableByDefinerId[r.assigningComponent.id]=r;var i="BI:"+this.slug;r.id=r.id?i+"-"+r.id:i}this.boundingBox=t.block.boundingBox,this.boundingBoxSettings}get assignable(){return this.block.assignable}get materializable(){return!1}_onTreeSet(){if(!this._tree.findComponentById(this.block.id))throw new Error("Block (template) not in tree");super._onTreeSet()}_onTreeUnset(){super._onTreeUnset()}_setContent(e,t,r){if(this._content[e][t]=r,"main"===e){for(;0<this.bestMainContent.children.length;)this.bestMainContent.remove(this.bestMainContent.children[0]);var i=this._content.main.medium;null!==i&&this.bestMainContent.add(i)}return super._setContent(e,t,r)}get appliedMaterials(){if(this._tree){var e,t=[];for(e of Object.values(this._tree.assignedMaterials))for(var r of e)r.assignable.blockInstance===this&&t.push(...r.materials);return t.filter(unique)}return[]}get assignedMaterials(){return this._tree?this._tree.materialAssignments.filter(e=>e.blockInstance===this):[]}get boundingBoxSettings(){let e,t,r;r=this.scale?(e=this.block.dimensions.x*this.scale.x,t=this.block.dimensions.y*this.scale.y,this.block.dimensions.z*this.scale.z):(e=this.block.dimensions.x,t=this.block.dimensions.y,this.block.dimensions.z);var i=new Vector3(-e/2,-t/2,-r/2),n=new Vector3(e/2,t/2,r/2),i=new Box3(i,n),n=new Float32Array([i.min.x,i.min.y,i.min.z,i.min.x,i.min.y,i.max.z,i.max.x,i.min.y,i.max.z,i.max.x,i.min.y,i.min.z,i.min.x,i.max.y,i.min.z,i.min.x,i.max.y,i.max.z,i.max.x,i.max.y,i.max.z,i.max.x,i.max.y,i.min.z]),i=new BufferGeometry,n=(i.name="boundingBox",i.visible=!1,i.setAttribute("position",new BufferAttribute(n,3)),new Matrix4),a=new Quaternion,o=new Vector3(1,1,1);n.compose(this.block.dimensionsCenter,a,o),i.applyMatrix4(n),this.boundingBox=i}async _build(e,t,r){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":var i=this._settings.block.content.main[t].block.clone(),n=(i.castShadow=!0,i.receiveShadow=!0,this.scale&&i.scale.copy(this.scale),i.name=this.id,i.userData.PB={type:"blockInstance",origin:this.id,blockInstance:this,isAssignable:this.assignable,assignableComponent:!0===this.assignable?{blockInstance:this}:null},i);i.traverse(t=>{t.userData||(t.userData={}),t.userData.PB||(t.userData.PB={}),"PositionedMeshGroup"===t.userData.PB.type?t.userData.PB.positionedMeshGroup=t.userData.PB.origin:t.userData.PB.positionedMeshGroup=t.parent?.userData?.PB?.positionedMeshGroup,"PositionedMesh"===t.userData.PB.type?(t.userData.PB.positionedMesh=t.userData.PB.origin,t.userData.PB.processed=!0):t.userData.PB.positionedMesh=t.parent?.userData?.PB?.positionedMesh,!0===t.userData.PB.isAssignable?t.userData.PB.assignable=this.assignables.find(e=>e.blockInstance===t.userData.PB.blockInstance&&e.positionedMeshGroup===t.userData.PB.positionedMeshGroup&&e.positionedMesh===t.userData.PB.positionedMesh):t.userData.PB.assignable=t.parent?.userData?.PB?.assignable}),this._setContent("main",t,n);break;default:this._setContent(e,t,null)}return this}}BlockInstance._exportName={singular:"blockInstance",plural:"blockInstances"},BlockInstance._exportLevel="inline",BlockInstance.connectorTemplateSetting="block",BlockInstance.treeLock=!1;class Connection extends Connectable{constructor(e,t){t.blockInstances&&delete t.blockInstances,super(e,t),this.connectables=void 0,this.connectors=void 0,this.connectorTypes=void 0,this._tree=void 0,this.type=void 0;for(var r of["from","to"]){if(!t[r])throw new Error(`Missing "${r}" object`);if(!(t[r].connectable instanceof Connectable))throw t[r].connectable?new Error(`${r}.connectable is not a Connectable, but a ${t[r].connectable.constructor.name}.`):new Error(`Missing a ${r}.connectable.`);if(!(t[r].connector instanceof Connector))throw t[r].connector?new Error(`${r}.connector is not a Connector, but a ${t[r].connector.constructor.name}.`):new Error(`Missing ${r}.connector.`);if(!t[r].connectable.block.dependsDirectlyOn(t[r].connector))throw new Error(`Entry ${r} connector is not a dependency of block`);if(t.quaternion&&!t.quaternion instanceof Quaternion)throw new Error(".quaternion is not a Quaternion but a "+t.quaternion.constructor.name)}if(t.quaternion||(this.quaternion=Connection.defaultQuaternion),this.inverseQuaternion=this.quaternion.clone().invert(),t.from.connectable===t.to.connectable)throw new Error("Connections to and from blocks are the same.");this.connectors=[t.from.connector,t.to.connector],this.connectorTypes=[t.from.connector.type,t.to.connector.type],this.connectables=[t.from.connectable,t.to.connectable],this.from||(this.from=t.from),this.to||(this.to=t.to)}_onTreeSet(){for(var e of["from","to"]){var t=this._settings[e].connectable.exportName;if(!this._tree[t]||!this._tree[t].includes(this._settings[e].connectable))throw new Error(`${e} ${t} is not specified in the tree (${this._settings[e].connectable.label}).`)}if(!this._tree.inclusive.connectionTypes)throw new Error("No connection types defined in tree");var r=this._tree.inclusive.connectionTypes.find(e=>e.connectorTypes[0]===this.connectorTypes[0]&&e.connectorTypes[1]===this.connectorTypes[1]||e.connectorTypes[0]===this.connectorTypes[1]&&e.connectorTypes[1]===this.connectorTypes[0]);if(!r)throw console.error(this._tree.inclusive.connectionTypes),new Error(`Missing this connection's type in tree.pkg [${this.connectorTypes[0].label} <-> ${this.connectorTypes[1].label}]`);if(this.type=r,this.type.parent&&this.connectorTypes[0]===this.connectorTypes[1])throw new Error(this.type.label+" defines a parent/child relationship, but both connectors have the same type in "+this.label);this.connectorTemplate=r,super._onTreeSet()}_onTreeUnset(){super._onTreeUnset(),this.type=void 0}connects(e){return e instanceof Connectable?this._settings.from.connectable===e||this._settings.to.connectable===e:e instanceof Connector&&(this._settings.from.connector===e||this._settings.to.connector===e)}_build(e,t,r){this._setContent(e,t,"-")}}Connection._exportName={singular:"connection",plural:"connections"},Connection._exportLevel="inline",Connection.connectorTemplateSetting="connectionType",Connection.baseQuaternion=new Quaternion(0,1,0,0),Connection.defaultQuaternion=new Quaternion(0,0,0,1),Connection.treeLock=!1;class MaterialAssignment extends BuildableComponent{constructor(e,t){if(t.blockInstances&&delete t.blockInstances,super(e,t),this.affectedComponents=void 0,this._relevantMaterialSets=void 0,this._tree=void 0,checkPropTypes(t,{blockInstance:BlockInstance,material:[WrappedMaterial]},{positionedMesh:[PositionedComponent,e=>!0===t.blockInstance.dependsOn(e)||e.label+" is not a dependency of "+t.blockInstance.label]}),this.assigningComponent=getAssigningComponent(t),!0!==this.assigningComponent.assignable)throw new Error(this.assigningComponent.label+" is not assignable");if(this.assigningComponent.applicableMaterialVariantGroups.find(e=>e.has(t.material))||console.warn(this.label+" will affect no components."),t.positionedMesh&&!t.blockInstance.dependsOn(t.positionedMesh))throw new Error(t.positionedMesh.label+" is not a dependency of "+t.blockInstance.label);if(t.positionedMeshGroup){if(!t.blockInstance.dependsOn(t.positionedMeshGroup))throw new Error(t.positionedMeshGroup.label+" is not a dependency of "+t.blockInstance.label);if(t.positionedMesh&&!t.positionedMeshGroup.dependsOn(t.positionedMesh))throw new Error(t.positionedMesh.label+" is not a dependency of "+t.positionedMeshGroup.label)}this._relevantMaterialSets=[],this.materializableComponents=this.assigningComponent.materializable?[this.assigningComponent,...this.assigningComponent.materializableDependencies]:this.assigningComponent.materializableDependencies,this.affectedComponents=this.materializableComponents.filter(e=>e instanceof PositionedComponent&&e.component.materialVariantGroup.has(t.material)),this.blockInstance||(this.blockInstance=t.blockInstance),this.material||(this.material=t.material)}_updateRelevantMaterialSets(){this._tree&&(this._relevantMaterialSets=this._tree.materialSetsByMaterial(this.material))}_onTreeSet(){if(!this._tree.findComponentById(this.blockInstance.block.id))throw new Error(`BlockInstance.block (the BlockInstance's "template") not in tree`);if(!this._tree.findComponentById(this.material.id))throw new Error("Material not in tree");this._tree.on("material-sets-by-material-update",this._updateRelevantMaterialSets.bind(this),this.id)}_onTreeUnset(){this._tree.removeListener("material-sets-by-material-update",this.id)}_build(e,t,r){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":this._setContent("main",t,this._settings.material);break;default:this._setContent(e,t,null)}return this}}MaterialAssignment._exportName={singular:"materialAssignment",plural:"materialAssignments"},MaterialAssignment._exportLevel="inline",MaterialAssignment.treeLock=!1;const findConnection=(t,r,e)=>{let i=null,n=null,a=null,o=null,s=e.find(e=>t.includes(e.from.connectable)&&r.includes(e.to.connectable));return s?(i=s.from,n=s.to,a=t,o=r):(s=e.find(e=>r.includes(e.from.connectable)&&t.includes(e.to.connectable)))&&(i=s.to,n=s.from,a=r,o=t),s?{connection:s,from:a,to:o,blockInA:i,blockInB:n}:null},calculatePlacement=t=>{var r={},i=(console.assert(Array.isArray(t.blockInstances)&&0<t.blockInstances.length,"No block instances in configuration"),r[t.blockInstances[0].id]={position:new Vector3,quaternion:new Quaternion,type:"connectable"},t.blockInstances.slice(1,t.blockInstances.length)),n=[t.blockInstances[0]],a=i.length;for(let e=0;e<a;e+=1){var o=findConnection(n,i,t.connections);if(!o)throw new Error("Unbuildable configuration. Missing connection between placed and unplaced block instances.");var s=o.connection,l=o.blockInA,c=o.blockInB,d=(console.assert(l.connector.quaternion instanceof Quaternion),console.assert(s.quaternion instanceof Quaternion),console.assert(s.inverseQuaternion instanceof Quaternion),console.assert(c.connector.quaternion instanceof Quaternion),l.connector.position.clone()),h=(d.applyQuaternion(r[l.connectable.id].quaternion),c.connector.position.clone().negate()),u=new Quaternion,o=(u.copy(r[l.connectable.id].quaternion),u.multiply(l.connector.quaternion),o.from===n?u.multiply(s.quaternion):u.multiply(s.inverseQuaternion),u.multiply(Connection.baseQuaternion),u.multiply(c.connector.quaternion.clone().invert()),h.applyQuaternion(u),r[l.connectable.id].position.clone()),o=(o.add(d),o.add(h),r[c.connectable.id]={position:o,quaternion:u,debug:{anchorTo:l,connection:s,anchorToConnectionVector:d,connectionToTargetVector:h},type:"connectable"},r[l.connectable.id].position.clone().add(d));r[s.id]={position:o,debug:{anchorTo:l,connection:s,anchorToConnectionVector:d,connectionToTargetVector:h},type:"connection"},n.push(...i.splice(i.indexOf(c.connectable),1))}return r};var findConnectedConnectors=e=>{var i=[];for(let r of e||[])for(let t of["from","to"]){if(void 0!==i.find(e=>e.connectable===r[t].connectable&&e.connector===r[t].connector))throw new Error(`Double usage of ${r[t].connector.label} in `+r.label);i.push(r[t])}return i};const findExtendOptions=(e,i={})=>{var t=(e.blockInstances||[]).concat(e.connections||[]),n=[];if(0===t.length)for(var r of e.pkg.blocks||[])n.push({block:r,placement:{position:new Vector3,quaternion:new Quaternion}});else for(let r of t)for(let t of r.connectorTemplate.connectors)if(void 0===i[t.id]||!0!==i[t.id][r.id])if(!(e.connections||[]).find(e=>e.from.connectable===r&&e.from.connector===t||e.to.connectable===r&&e.to.connector===t)){var a,o=e.placement[r.id];for(a of t.mate.connectors)n.push({block:a.block,connection:{from:{connectable:r,connector:t},to:{connectable:"new",connector:a}},placement:{position:o.position.clone().add(t.position.clone().applyQuaternion(o.quaternion)),quaternion:t.quaternion.clone().multiply(o.quaternion)}})}return n},findInsertOptions=e=>{var r,i=[];for(r of e.connections||[]){var n,a=r.from.connector.mate.connectors||[];const o=r.to.connector.mate.connectors||[];for(let t of a)for(n of t.block.connectors.filter(e=>e!==t).filter(e=>-1<o.indexOf(e)))i.push({type:"insert",oldConnection:r,block:t.block,newConnection1:{from:r.from,to:{connectable:"new",connector:t}},newConnection2:{from:{connectable:"new",connector:n},to:r.to},placement:e.placement[r.id]})}return i},findBlockInstanceOptions=e=>{var t,r=[],i=[];for(t of e.blockInstances||[]){var n=t.equalConnections,a={blockInstance:t,oldConnections:n,siblingChains:t.siblingChains,placement:e.placement[t.id]};switch(n.length){case 0:case 1:var o={blockInstance:t,oldConnections:n,placement:e.placement[t.id]};r.push(o);break;case 2:o=[n[0].from.connectable!==t?n[0].from:n[0].to,n[1].from.connectable!==t?n[1].from:n[1].to];o[0].connector.mate.connectors.includes(o[1].connector)&&r.push({blockInstance:t,oldConnections:n,newConnection:{from:o[0],to:o[1]},placement:e.placement[t.id]}),i.push(a);break;default:i.push(a)}}return{cutOptions:r,splitOptions:i}};class Configuration extends ComponentTree$1{constructor(r,i){i.step=i.step||1,i.blockInstances=i.blockInstances||[],i.connections=i.connections||[],i.materialAssignments=i.materialAssignments||[],i.themes=i.themes||{},i.ignoreColocatedConnectors=void 0!==i.ignoreColocatedConnectors&&i.ignoreColocatedConnectors,checkPropTypes(i,{pkg:Package},{blockInstances:t=>{if(!Array.isArray(t))return"Not an array";for(let e=0;e<t.length;e+=1){var r=t[e];if(!(r instanceof BlockInstance))return`Entry blockInstances[${e}] is not a BlockInstance, but a `+r.constructor.name}return t.filter(unique).length===t.length||"Duplicate blockInstances specified"},connections:t=>{if(!Array.isArray(t))return"Not an array";for(let e=0;e<t.length;e+=1){var r=t[e];if(!(r instanceof Connection))return`Entry connections[${e}] is not a Connection, but a `+r.constructor.name}return t.filter(unique).length===t.length||"Duplicate connections specified"},materialAssignments:t=>{if(!Array.isArray(t))return"Value is not an array";for(let e=0;e<t.length;e+=1){var r=t[e];if(!(r instanceof MaterialAssignment))return`Entry materialAssignments[${e}] is not a MaterialAssignment, but a `+r.constructor.name}return t.filter(unique).length===t.length||"Duplicate materialAssignments specified"}});var n=(i.blockInstances||[]).reduce((e,t)=>[...e,...(t.block.connectors||[]).map(e=>({connectable:t,connector:e}))],[]);const a=[];for(let e=0,t=i.pkg.themeGroups.length||0;e<t;e+=1){const R=i.pkg.themeGroups[e],L=i.themes[R.id]||i.pkg.themes.find(e=>e.group===R);var o=n.filter(e=>e.connector.themeGroup===R),s=o.map(e=>e.connector),l=[...o];for(let t of Object.values(i.connections)){var c=o.find(e=>e.connector===t.from.connector&&e.connectable===t.from.connectable),d=o.find(e=>e.connector===t.to.connector&&e.connectable===t.to.connectable);if(c){if(s.includes(t.to.connector))throw new Error(`Both sides of ${t.label} have a connector with ${R.label}: ${t.to.connector.label}, `+t.from.connector.label);t.to.connector.block.theme===L?(console.log(t.label+" already connected within theme"),l.splice(l.indexOf(c),1)):(i.connections.splice(i.connections.indexOf(t),1),a.push(t.to.connectable.id),i.blockInstances.splice(i.blockInstances.indexOf(t.to.connectable),1))}else if(d){if(s.includes(t.from.connector))throw new Error(`Both sides of ${t.label} have a connector with ${R.label}: ${t.to.connector.label}, `+t.from.connector.label);t.from.connector.block.theme===L?l.splice(l.indexOf(d),1):(i.connections.splice(i.connections.indexOf(t),1),a.push(t.from.connectable.id),i.blockInstances.splice(i.blockInstances.indexOf(t.from.connectable),1))}}i.materialAssignments=i.materialAssignments.filter(e=>!a.includes(e.blockInstance.id));for(const U of l){if(a.includes(U.connectable.id))throw new Error(`Can't create a new connection for ${U.connectable.label} - it was removed`);var h=i.pkg.connectors.find(e=>e.block.theme===L&&U.connector.mate.connectors.includes(e)),u=new BlockInstance(r,{block:h.block}),h=(i.blockInstances.push(u),new Connection(r,{from:U,to:{connector:h,connectable:u}}));i.connections.push(h)}}for(let e=n.length-1;0<=e;--e)a.includes(n[e].connectable.id)&&n.splice(e,1);super(r,omit(["pkg"],i),{import:Configuration.importInstructions,externalTrees:[i.pkg],loader:i.pkg.loader}),this.allMeshes=void 0,this.applicableMatVarGroups=void 0,this.applicableMaterials=void 0,this.connectors=void 0,this.extendOptions=void 0,this.insertOptions=void 0,this.options=void 0,this.instructions=void 0,this.assignedMaterials=void 0,this.preparedComponentClones=void 0,this.instructions={},this.clonedAssets=[],this.clonedComponents=[],Object.getOwnPropertyDescriptor(this,"blockInstances")||(this.blockInstances=[]),Object.getOwnPropertyDescriptor(this,"materialAssignments")||(this.materialAssignments=[]),Object.getOwnPropertyDescriptor(this,"connections")||(this.connections=[]),this.pkg=i.pkg,this.pkg.loader&&(this.loader=this.pkg.loader),this.connectors=n,this.connectedConnectors=findConnectedConnectors(i.connections),Array.isArray(i.blockInstances)&&0<i.blockInstances.length?this.placement=calculatePlacement(this):(this.placement={},console.warn("Empty configuration detected, no block instances defined.")),this.assignables=this.blockInstances.map(e=>e.assignables).flat(),this.assignedMaterials={},this.options={extend:[],insert:[],replace:[],cut:[],split:[],blocks:[],blockInstances:[],materials:[],materialVariantGroups:[]};var e={};if(!0!==i.ignoreColocatedConnectors)for(var t of n){var A,p=this.placement[t.connectable.id];const I=t.connector,F=p.position.clone().add(I.position.clone().applyQuaternion(p.quaternion));for(A of n.filter(e=>{var t=e.connector;if(t.id===I.id)return!1;try{var r=this.placement[e.connectable.id],i=r.position.clone().add(t.position.clone().applyQuaternion(r.quaternion));return F.distanceTo(i)<.01}catch(e){console.error(e)}}))e[A.connector.id]=e[A.connector.id]||{},e[A.connector.id][A.connectable.id]=!0}this.options.extend=findExtendOptions(this,e),this.options.insert=findInsertOptions(this),this.options.extend.forEach(e=>this._addBlockAddOption(e,"extend")),this.options.insert.forEach(e=>this._addBlockAddOption(e,"insert"));var m,{cutOptions:f,splitOptions:g}=findBlockInstanceOptions(this);this.options.cut=f,this.options.split=g,this.options.cut.forEach(e=>this._addBlockInstanceRemoveOption(e,"cut")),this.options.split.forEach(e=>this._addBlockInstanceRemoveOption(e,"split"));for(m of this.blockInstances)for(var v of m.block.distinctMVGs)this.options.materialVariantGroups.includes(v)||(this.options.materialVariantGroups.push(v),this.options[v.id]=[]),this.options[v.id].push(m);var _,f=this.options.materialVariantGroups.map(e=>e.id).sort().join("-"),y=(Configuration.materialCache[f]||(g=this.options.materialVariantGroups.map(e=>e.allMaterials).flat().filter(unique),Configuration.materialCache[f]=g),this.options.materials=Configuration.materialCache[f],this.options.material=r=>{return console.assert(r instanceof WrappedMaterial,`${r.label||typeof r} is not an instance of WrappedMaterial`),this.assignables.filter(e=>e.materialVariantGroups.find(e=>r.materialSets.includes(e))).map(e=>{getAssigningComponent(e);var t={position:(new Vector3).copy(this.placement[e.blockInstance.id].position),quaternion:(new Quaternion).copy(this.placement[e.blockInstance.id].quaternion)};return e.positionedMeshGroup&&(t.position.add(e.positionedMeshGroup.position),t.quaternion.multiply(e.positionedMeshGroup.quaternion)),e.positionedMesh&&(t.position.add(e.positionedMesh.position),t.quaternion.multiply(e.positionedMesh.quaternion)),{assignable:e,material:r,placement:t}})},this.boundingBoxes=new Map,[]);for(_ of i.blockInstances||[]){var E=_.boundingBox.clone(),T=(this.clonedAssets.push(E),new Matrix4),x=this.placement[_.id].position,b=this.placement[_.id].quaternion,P=new Vector3(1,1,1),w=(T.compose(x,b,P),E.applyMatrix4(T),_.boundingBox=E,this.boundingBoxes.set(_.id,E),_.boundingBox.computeBoundingBox(),_.boundingBox.computeBoundingSphere(),E.attributes.position),C=new Vector3;for(let e=0,t=w.count;e<t;e++){C.fromBufferAttribute(w,e);var S=C.clone();this.clonedAssets.push(S),y.push(S)}}var M,B=new Vector3,N=new Vector3;for(M of y)B.min(M),N.max(M);g=new Box3(B,N),f=new Float32Array([g.min.x,g.min.y,g.min.z,g.min.x,g.min.y,g.max.z,g.max.x,g.min.y,g.max.z,g.max.x,g.min.y,g.min.z,g.min.x,g.max.y,g.min.z,g.min.x,g.max.y,g.max.z,g.max.x,g.max.y,g.max.z,g.max.x,g.max.y,g.min.z]),g=new BufferGeometry;g.name="boundingBox",g.visible=!1,g.setAttribute("position",new BufferAttribute(f,3)),g.computeBoundingBox(),g.computeBoundingSphere(),this.boundingBox=g,this.dimensions=getDimensions(this)}_addBlockAddOption(e,t){var r=e.block;-1===this.options.blocks.indexOf(r)&&this.options.blocks.push(r),this.options[r.id]||(this.options[r.id]={extend:[],insert:[]}),this.options[r.id][t].push(e)}_addBlockInstanceRemoveOption(e,t){var r=e.blockInstance;-1===this.options.blockInstances.indexOf(r)&&this.options.blockInstances.push(r),this.options[r.id]||(this.options[r.id]={cut:[],split:[],replace:[],materialize:[]}),this.options[r.id][t].push(e)}prepareComponentClones(){this.preparedComponentClones=null,this.cloneComponents()}cloneComponents(e=!0,t={}){var r;if(this.preparedComponentClones)return r=this.preparedComponentClones,this.preparedComponentClones=null,r;var i,n,a,o={},s={},l={};for(i of this.blockInstances){var c=t[i.id]||i.clone(!0===e?{id:i.id}:{id:v4()});o[i.id]=c}for(n of this.materialAssignments){var d=new MaterialAssignment(this._reporter,{...n.settings,blockInstance:o[n.blockInstance.id]});s[n.id]=d}for(a of this.connections){var h=new Connection(this._reporter,{from:{connectable:o[a.from.connectable.id],connector:a.from.connector},to:{connectable:o[a.to.connectable.id],connector:a.to.connector},quaternion:a.quaternion});l[a.id]=h}return{blockInstanceClones:o,materialAssignmentClones:s,connectionClones:l}}_createClonedComponentConnection(e,t,r){return new Connection(this._reporter,{from:{connectable:"new"===e.from.connectable?r:t[e.from.connectable.id],connector:e.from.connector},to:{connectable:"new"===e.to.connectable?r:t[e.to.connectable.id],connector:e.to.connector}})}_createNewConfiguration(e,t,r,i={}){var n={};return Object.assign(n,this.settings),n.id=v4(),Object.assign(n,i),n.blockInstances=e,n.materialAssignments=t,n.connections=r,n.pkg=this.pkg,n.step=(Number(n.step)||0)+1,new Configuration(this._reporter,n)}_createLastAssignedMAsForBlockInstance(e){var t={};if(this.lastAssignedMaterials){var r,i=pick(e.applicableMaterialVariantGroups.map(e=>e.id),this.lastAssignedMaterials);for(r of Object.values(i)){var n=new MaterialAssignment(this._reporter,{blockInstance:e,material:r});t[n.id]=n}}return t}add(){}extend(e,t={}){var{blockInstanceClones:r,materialAssignmentClones:i,connectionClones:n}=this.cloneComponents(),a=new BlockInstance(this._reporter,{block:e.block}),e=(r[a.id]=a,e.connection&&(n[(e=this._createClonedComponentConnection(e.connection,r,a)).id]=e),!0===t.repeatLastAssignment&&Object.assign(i,this._createLastAssignedMAsForBlockInstance(a)),this._createNewConfiguration(Object.values(r),Object.values(i),Object.values(n)));return e}insert(e,t={}){var{blockInstanceClones:r,materialAssignmentClones:i,connectionClones:n}=this.cloneComponents(),a=new BlockInstance(this._reporter,{block:e.block}),o=(r[a.id]=a,this._createClonedComponentConnection(e.newConnection1,r,a)),o=(n[o.id]=o,this._createClonedComponentConnection(e.newConnection2,r,a));return n[o.id]=o,delete n[e.oldConnection.id],!0===t.repeatLastAssignment&&Object.assign(i,this._createLastAssignedMAsForBlockInstance(a)),this._createNewConfiguration(Object.values(r),Object.values(i),Object.values(n))}replace(){}copy(e=!0){var{blockInstanceClones:e,materialAssignmentClones:t,connectionClones:r}=this.cloneComponents(e);return this._createNewConfiguration(Object.values(e),Object.values(t),Object.values(r))}_cut(e){var t,r,i,n,{blockInstanceClones:a,materialAssignmentClones:o,connectionClones:s}=this.cloneComponents(),l={blockInstances:[],materialAssignments:[],connections:[]};l.blockInstances.push(a[e.blockInstance.id]),delete a[e.blockInstance.id];for(t of e.blockInstance.children)l.blockInstances.push(a[t.id]),delete a[t.id];for(r of[...e.blockInstance.materialAssignments,...e.blockInstance.childMaterialAssignments||[]])l.materialAssignments.push(o[r.id]),delete o[r.id];for(i of e.blockInstance.childConnections)l.connections.push(s[i.id]),delete s[i.id];for(n of e.oldConnections)delete s[n.id];return{cutConfigurationComponents:l,blockInstanceClones:a,materialAssignmentClones:o,connectionClones:s}}cut(e){var{cutConfigurationComponents:t,blockInstanceClones:r,materialAssignmentClones:i,connectionClones:n}=this._cut(e);return e.newConnection&&(n[(e=this._createClonedComponentConnection(e.newConnection,r)).id]=e),{main:this._createNewConfiguration(Object.values(r),Object.values(i),Object.values(n)),cut:this._createNewConfiguration(t.blockInstances,t.materialAssignments,t.connections)}}split(i){const{cutConfigurationComponents:e,blockInstanceClones:t,materialAssignmentClones:r,connectionClones:n}=this._cut(i);var a,o=[];for(a of Object.values(i.siblingChains)){var s=a.reduce((e,t)=>{var r;e.blockInstances.push(t,...t.children||[]),t.materialAssignments&&0<t.materialAssignments.length&&e.materialAssignments.push(...t.materialAssignments),t.childMaterialAssignments&&0<t.childMaterialAssignments.length&&e.materialAssignments.push(...t.childMaterialAssignments),t.childConnections&&0<t.childConnections.length&&e.connections.push(...t.childConnections);for(r of t.equalConnections.filter(e=>!i.oldConnections.includes(e)))-1===e.connections.indexOf(r)&&e.connections.push(r);return t.childConnections&&0<t.childConnections.length&&e.connections.push(...t.childConnections),e},{blockInstances:[],materialAssignments:[],connections:[]});s.blockInstances=s.blockInstances.map(e=>t[e.id]),s.materialAssignments=s.materialAssignments.map(e=>r[e.id]),s.connections=s.connections.map(e=>n[e.id]),o.push(this._createNewConfiguration(s.blockInstances,s.materialAssignments,s.connections,this.step+1))}return{cut:this._createNewConfiguration(e.blockInstances,e.materialAssignments,e.connections),split:o}}merge(e,t,r,i){var n=e.tree,a=r.tree;if(a.pkg!==this.pkg)throw new Error(`Can not merge configuration for ${this.pkg.label} with configurator for ${a.pkg.label} `);n=n.cloneComponents(!1),a=a.cloneComponents(!1),e=this._createClonedComponentConnection({from:{connectable:e,connector:t},to:{connectable:r,connector:i}},{...n.blockInstanceClones,...a.blockInstanceClones}),t={blockInstances:[...Object.values(n.blockInstanceClones||{}),...Object.values(a.blockInstanceClones||{})],materialAssignments:[...Object.values(n.materialAssignmentClones||{}),...Object.values(a.materialAssignmentClones||{})],connections:[...Object.values(n.connectionClones||{}),...Object.values(a.connectionClones||{}),e]};return this._createNewConfiguration(t.blockInstances,t.materialAssignments,t.connections)}findMergeOptions(e){}assignMaterial(e){var{blockInstanceClones:t,materialAssignmentClones:r,connectionClones:i}=this.cloneComponents(),n={},a=(n.blockInstance=t[e.assignable.blockInstance.id],e.assignable.positionedMeshGroup&&(n.positionedMeshGroup=e.assignable.positionedMeshGroup),e.assignable.positionedMesh&&(n.positionedMesh=e.assignable.positionedMesh),n.material=e.material,new MaterialAssignment(this._reporter,n)),o=e.assignable.assigningComponent;for(let[e,t]of Object.entries(r))t.assigningComponent.id!==o.id||a.material.materialSets.find(e=>t.material.materialSets.includes(e))&&a.affectedComponents.length===t.affectedComponents.length&&!a.affectedComponents.find(e=>void 0===t.affectedComponents.includes(e))&&delete r[e];r[a.id]=a;var s,l=this.lastAssignedMaterials||{};for(s of n.material.materialSets)l[s.id]=n.material;return this._createNewConfiguration(Object.values(t),Object.values(r),Object.values(i),{lastAssignedMaterials:l})}setDefaultMaterial(e){var t,{blockInstanceClones:r,materialAssignmentClones:i,connectionClones:n}=this.cloneComponents(),a=this.defaultMaterials||{};for(t of e.materialSets)a[t.id]=e;return this._createNewConfiguration(Object.values(r),Object.values(i),Object.values(n),{defaultMaterials:a})}clearMaterialAssignments(){var{blockInstanceClones:e,connectionClones:t}=this.cloneComponents();return this._createNewConfiguration(Object.values(e),[],Object.values(t))}applyTheme(e){var t,r,i,n,a;if(e instanceof Theme)return{blockInstanceClones:t,materialAssignmentClones:r,connectionClones:i}=this.cloneComponents(),n=this._settings.themes||{},a={},Object.assign(a,n),a[e.group.id]=e,this._createNewConfiguration(Object.values(t),Object.values(r),Object.values(i),{themes:a});throw new Error(e+" is not a Theme")}updateBlockInstanceSettings(t,e){var r,i=this.blockInstances.find(e=>e.id===t);if(i)return i=i.clone({id:i.id,...e}),{blockInstanceClones:e,materialAssignmentClones:i,connectionClones:r}=this.cloneComponents(!0,{[t]:i}),this._createNewConfiguration(Object.values(e),Object.values(i),Object.values(r));throw new Error("Can't replace non-existent block instance "+t)}updateBITextureRepeat(e,t){return this.updateBlockInstanceSettings(e,{textureRepeat:t})}updateBIScale(e,t){return this.updateBlockInstanceSettings(e,{scale:t})}updateBITextureOffset(e,t){return this.updateBlockInstanceSettings(e,{textureOffset:t})}updateBITextureRotation(e,t){return this.updateBlockInstanceSettings(e,{textureRotation:t})}destroy(){for(var e of this.pkg.configurations)if(this.id===e.id)return;for(var t of this.blockInstances)t.destroy();for(var r of this.materialAssignments)r.destroy();for(var i of this.connections)i.destroy();for(var n of this.clonedAssets)n.dispose&&n.dispose();super.destroy&&super.destroy()}async _build(e,t,r){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":var i=new Group,n=(i.castShadow=!0,i.receiveShadow=!0,Project.layerMap.boundingBoxes,i.name="Build of "+this.label,Object.values(this.defaultMaterials||{}).filter(unique));for(let a of this.blockInstances){console.assert(a.bestMainContent instanceof Object3D);var o=a.bestMainContent;o.position.copy(this.placement[a.id].position),o.quaternion.copy(this.placement[a.id].quaternion);var s=(this.materialAssignments||[]).filter(e=>e.blockInstance===a).sort((e,t)=>e.affectedComponents.length-t.affectedComponents.length),l=[];for(let t of n)l.push({material:t,affectedComponents:a.materializableDependencies.filter(e=>e instanceof PositionedComponent&&e.component.materialVariantGroup.has(t))});var c,d=[];for(c of[...s,...l])for(var h of c.affectedComponents)if(!d.includes(h.id)){d.push(h.id);var u=o.getObjectByName(h.id),h=this._tree.findComponentById(u.userData.PB.origin),A=h.dependencies.main.component;if(!h)throw console.warn("Tree referenced in upcoming error",this._tree),new Error(`Could not find positioned mesh with id ${u.userData.PB.origin} in tree`);var p,m=null;for(p of h._allDependencies)p instanceof WrappedMesh&&(m=p._tilingMultiplier);var f,g,h=u.material.aoMap,v=u.material.aoMapIntensity;A._normalMap?(u.material=await A.buildMeshMaterial(c.material.content.main[t].clone()),u.material.needsUpdate=!0):u.material=c.material.content.main[t].clone(),u.material.aoMap=h,u.material.aoMapIntensity=v,u.material.aoMap instanceof Texture&&(u.material.aoMap.needsUpdate=!0);for(f of["bumpMap","emissiveMap","map","specularMap","roughnessMap","metalnessMap","normalMap","aoMap"])u.material[f]instanceof Texture&&((g=u.material[f].clone()).repeat.x=g.repeat.x*m*(a?.textureRepeat?.x||1),g.repeat.y=g.repeat.y*m*(a?.textureRepeat?.y||1),g.offset.x=a?.textureOffset?.x||0,g.offset.y=a?.textureOffset?.y||0,g.rotation=a?.textureRotation||0,g.needsUpdate=!0,this.clonedAssets.push(g),u.material[f]=g);u.material.needsUpdate=!0}this.assignedMaterials[a.id]=a.assignables.map(e=>({assignable:e,materials:[],mvg:e.materialVariantGroups.reduce((e,t)=>Object.assign(e,{[t.id]:null}),{})})),o.traverse(e=>{if(e.material){const n=e.userData.PB.assignable;e.material.userData.PB.origin;if(!n)throw console.error(e),new Error("Missing assignable on Object3D "+e.id);var t=this._tree.findComponentById(e.material.userData.PB.origin),r=this.assignedMaterials[a.id].find(e=>e.assignable===n);if(!r)throw console.error(n),new Error("Could not find assigned materials list entry");if(-1===r.materials.indexOf(t)){r.materials.push(t);for(var i of t.materialSets)r.mvg[i.id]=t}}});s=new Object3D;s.castShadow=!0,s.receiveShadow=!0,s.name=a.label+"-transform-wrapper",s.add(o),i.add(s),i.userData.PB={origin:this.id}}0!==this.boundingBox.boundingBox.max.z&&(drawDimensionsLine(i,this.dimensions.dimFront,.25,"front"),drawDimensionsLine(i,this.dimensions.dimLeft,.25,"left")),this._setContent("main",t,i);setTimeout(this.prepareComponentClones.bind(this),10);break;default:this._setContent(e,t,null)}return this}}Configuration._exportName={singular:"configuration",plural:"configurations"},Configuration.importInstructions=[{cls:BlockInstance},{cls:Connection},{cls:MaterialAssignment}],Configuration.materialCache={},ComponentTree$1.Configuration=Configuration;class Package extends ComponentTree$1{constructor(e,t,r={}){super(e,t,{import:Package.importInstructions,...r}),this.connectorTypeMateMap=new Map,this.connectorsByType={},this.materialSetsByMaterial={},this.addEvent("mate-map-update"),this.addEvent("connectors-by-type-update"),this.addEvent("material-sets-by-material-update"),r.loader&&(this.loader=r.loader),this.on("change",({cls:e})=>{e.includes(Connector)||e.includes(ConnectorType)||e.includes(ConnectionType)?this.updateConnectorTypeMateMap():[WrappedMaterial,MaterialSet,MaterialCategory].includes(e)&&this.updateMaterialSetsByMaterial()}),this.updateConnectorTypeMateMap(),this.updateMaterialSetsByMaterial()}_autoLink(){var e,t,r=["blocks","connectionTypes"],i={};for([e,t]of Object.entries(this._settings))r.includes(e)?i[e]=t:Array.isArray(t)&&(this._exportOnlyDependencies[e]=t);super._autoLink(i,BuildableComponent.autogenIntegralInstruction(i))}updateConnectorTypeMateMap(){return this.report({msg:"Updating mate map"}),this.connectorTypeMateMap=buildMateMap(this._settings),this.emit("mate-map-update",this.connectorTypeMateMap),this.connectorTypeMateMap}updateConnectorsByType(){for(let t of this.connectorTypes)this.connectorsByType=this.connectors.filter(e=>e.settings.type===t);this.emit("connectors-by-type-update",this.connectorsByType)}updateMaterialSetsByMaterial(){var e,t={};for(e of this.materials){t[e]=[];for(var r of this.materialSets)r.has(e)&&t[e].push(r)}this.materialSetsByMaterial=t,this.emit("material-sets-by-material-update",this.materialSetsByMaterial)}async _build(e,t,r){switch(this._status[e][t].setState("loading"),e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):await this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":this._setContent(e,t,r);break;default:this._setContent(e,t,null)}return this}}Package._exportName={singular:"package",plural:"packages"},Package.importInstructions=[{cls:WrappedImage},{cls:EXR},{cls:WrappedTexture},{cls:EnvironmentMap},{cls:MaterialCategoryType},{cls:MaterialCategory},{cls:WrappedMaterial},{cls:MaterialSet},{cls:GeometryFile},{cls:GLTF},{cls:Geometry},{cls:WrappedMesh},{cls:PositionedMesh},{cls:MeshGroup},{cls:PositionedMeshGroup},{cls:ThemeGroup},{cls:Theme},{cls:ConnectorType},{cls:Connector},{cls:BlockCategoryType},{cls:BlockCategory},{cls:Block},{cls:BlockSet},{cls:ConnectionType},{cls:Configuration}];class Timer extends InformationSource{constructor(e,t){super(e,t),this.emitUpdates=!1,this.updateRequests={},this.addEvent("update")}trigger(){!1===this.emitUpdates&&requestAnimationFrame(this.animationFrameTimer.bind(this))}addUpdateRequest(e,t){if(!t)throw new Error("Description required");void 0===this.updateRequests[e]&&(this.updateRequests[e]=t,!1===this.emitUpdates&&(this.report({msg:"start updates"}),this.emitUpdates=!0),requestAnimationFrame(this.animationFrameTimer.bind(this)))}hasRequestId(e){return this.updateRequests[e],!0}removeUpdateRequest(e){delete this.updateRequests[e],0===Object.keys(this.updateRequests).length&&(this.report({msg:"stop updates"}),this.emitUpdates=!1)}animationFrameTimer(e){this.emit("update",e),!0===this.emitUpdates&&requestAnimationFrame(this.animationFrameTimer.bind(this))}}class StateTracker extends InformationSource{constructor(e,t){super(e,t),this._stateRegister=void 0,this._cursor=void 0,this.maxStateCount=Number(t.maxStateCount||5),this.addEvent("statechange"),this.resetState()}get cursor(){return this._cursor}get state(){return this._stateRegister[this._cursor]}resetState(){this._stateRegister=[],this._cursor=0}cleanUpStateItem(e){"function"==typeof e.cleanUp&&e.cleanUp({state:e,stateRegister:this._stateRegister,maxStateCount:this.maxStateCount})}async addState({newState:e,moveCursor:t=!0}){if(this._stateRegister=this._stateRegister.slice(0,this._cursor+1),this._stateRegister.length>this.maxStateCount)for(let e=0;e<this._stateRegister.length-this.maxStateCount;e+=1){var r=this._stateRegister.shift();this.report({msg:"Popping old state "+(r.label||r),level:"debug"}),this.cleanUpStateItem(r),0}this._stateRegister.push(e),!0===t?await this.setCursor(this._stateRegister.length-1):"silent"===t&&(this._cursor=this._stateRegister.length-1)}async setCursor(e){if(!this._stateRegister[e])throw new Error(this.label+" unset cursor position "+e);this._cursor=e,await this.onStateCursorMoved(this._stateRegister[e])}overwritePreviousState(){this._stateRegister.length;var e=this._stateRegister.length-2;this._stateRegister.splice(e,1),this._cursor=e}onStateCursorMoved(e){throw new Error("Interface not implemented in extending class")}undo(e=1){return this.setCursor(Math.max(0,this._cursor-e))}get canUndo(){return 0<this._cursor}redo(e=1){return this.setCursor(Math.min(this._stateRegister.length-1,this._cursor+e))}get canRedo(){return this._cursor<this._stateRegister.length-1}destroy(){this.resetState(),"function"==typeof super.destroy&&super.destroy()}}class Actor extends StateTracker{constructor(e,t){super(e,t),this.visible=void 0,this.body=new Group,this.addEvent("bodychange"),this.hiddenBody=new Group,this.body=new Group,this.body.name="Actor",(this.body.userData.origin=this).body.castShadow=!0,this.body.receiveShadow=!0,this.visible=!0}show(){console.log("show",this.label);const t=new Layers;t.set(Project.layerMap.hiddenActors),this.body.traverse(function(e){e.layers.test(t)&&e.layers.set(Project.layerMap.visibleActors)}),this.visible=!0}hide(){console.log("hide",this.label);const t=new Layers;t.set(Project.layerMap.visibleActors),this.body.traverse(function(e){e.layers.test(t)&&e.layers.set(Project.layerMap.hiddenActors)}),this.visible=!1}clearBody(){for(;0<this.body.children.length;)this.body.remove(this.body.children[0])}async updateBody(e,t,r,i){this.clearBody(),this.body.add(e),t&&this.body.quaternion.copy(t),r&&(i&&i.translation?this.body.position.copy((new Vector3).addVectors(r,i.translation)):this.body.position.copy(r)),await this.emit("bodychange",this.body)}}class DimensionFrame{constructor(e,t,r=["front","left"]){this.getAngle=function(e,t){return(360+180*Math.atan2(t,e)/Math.PI)%360},this.configurator=e,this.view=t,this.id=v4(),this.lines=r,this.elems={};for(var i of r){this.elems[i]={};var n=document.createElement("div"),a=document.createElement("div"),o=document.createElement("div");n.appendChild(a),n.appendChild(o),n.id=`dimension-line-${this.id.substr(0,5)}-`+i,a.classList.add("dimension-line"),a.classList.add(i),o.classList.add("dimension-label"),o.classList.add(i),n.style.position="absolute",n.style.left="0px",n.style.top="0px",n.style.transformOrigin="top left",n.style.zIndex=10,this.elems[i]=n,t.domElement.appendChild(n)}this.onSceneUpdate()}onSceneUpdate(){this.configDims=this.configurator.configuration.dimensions,this.linePoints=this.lines.reduce((e,t)=>(e[t]={start:this.configDims["dim"+ucFirst(t)][0].start.clone(),end:this.configDims["dim"+ucFirst(t)][0].end.clone()},console.log(t,e[t]),e),{})}update(){for(var e of this.lines){var t=this.view.project(this.linePoints[e].start.clone()),r=this.view.project(this.linePoints[e].end.clone()),i=new Vector2(t.x,t.y),r=new Vector2(r.x,r.y),r=(new Vector2).subVectors(r,i),i=this.getAngle(r.x,r.y);this.elems[e].style.width=r.length()+"px",this.elems[e].style.transform="translate3d("+t.x+"px,"+t.y+"px,0px) rotate("+i+"deg)"}}}var defaultCameraSettings={fov:45,aspect:window.innerWidth/window.innerHeight,near:.01,far:1e3};class CSS2DObject extends Object3D$1{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Vector2$1(.5,.5),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const _vector$c=new Vector3$1,_viewMatrix=new Matrix4$1,_viewProjectionMatrix=new Matrix4$1,_a$1=new Vector3$1,_b$1=new Vector3$1;class CSS2DRenderer{constructor(e={}){const s=this;let r,i,l,c;const d={objects:new WeakMap},h=void 0!==e.element?e.element:document.createElement("div");function u(e,t){return _a$1.setFromMatrixPosition(e.matrixWorld),_b$1.setFromMatrixPosition(t.matrixWorld),_a$1.distanceToSquared(_b$1)}h.style.overflow="hidden",this.domElement=h,this.getSize=function(){return{width:r,height:i}},this.render=function(e,t){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),_viewMatrix.copy(t.matrixWorldInverse),_viewProjectionMatrix.multiplyMatrices(t.projectionMatrix,_viewMatrix),function r(i,n,a){if(i.isCSS2DObject){_vector$c.setFromMatrixPosition(i.matrixWorld),_vector$c.applyMatrix4(_viewProjectionMatrix);const e=!0===i.visible&&-1<=_vector$c.z&&_vector$c.z<=1&&!0===i.layers.test(a.layers);if(i.element.style.display=!0==e?"":"none",!0==e){i.onBeforeRender(s,n,a);const o=i.element;o.style.transform="translate("+-100*i.center.x+"%,"+-100*i.center.y+"%)translate("+(_vector$c.x*l+l)+"px,"+(-_vector$c.y*c+c)+"px)",o.parentNode!==h&&h.appendChild(o),i.onAfterRender(s,n,a)}const t={distanceToCameraSquared:u(a,i)};d.objects.set(i,t)}for(let e=0,t=i.children.length;e<t;e++)r(i.children[e],n,a)}(e,e,t);var r=function(e){const t=[];return e.traverse(function(e){e.isCSS2DObject&&t.push(e)}),t}(e).sort(function(e,t){return e.renderOrder!==t.renderOrder?t.renderOrder-e.renderOrder:d.objects.get(e).distanceToCameraSquared-d.objects.get(t).distanceToCameraSquared}),i=r.length;for(let e=0,t=r.length;e<t;e++)r[e].element.style.zIndex=i-e},this.setSize=function(e,t){r=e,i=t,l=r/2,c=i/2,h.style.width=e+"px",h.style.height=t+"px"}}}const HorizontalBlurShader={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},VerticalBlurShader={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`};class ContactShadow extends BuildableComponent{constructor(e,t){super(e,t),checkPropTypes(t,{},{contactShadow:Object,scene:Scene,camera:Camera,renderer:WebGLRenderer}),this.name="ContactShadow",this.planeWidth=30,this.planeHeight=30,this.planeColor="#ffffff",this.planeOpacity=1,this.cameraHeight=.5,this.shadowDarkness=.85,this.shadowOpacity=1,this.blurAmount=.15,this.showWireframe=!0,this._scene=t.scene,this._camera=t.camera,this._renderer=t.renderer,this.renderTarget=null,this.renderTargetBlur=null,this.renderTargets=null}async _build(){var e=new PlaneGeometry(this.planeWidth,this.planeHeight).rotateX(Math.PI/2),t=(e.name="ContactShadow Plane",new MeshBasicMaterial({name:"ContactShadow Material",opacity:this.shadowOpacity,transparent:!0,envMap:null})),r=new Mesh(e,t),e=(r.name="ContactShadow Plane",r.scale.y=-1,r.receiveShadow=!0,r.layers.set(Project.layerMap.visibleActors),new Mesh(e)),i=(e.name="ContactShadow Blur Plane",e.visible=!1,new OrthographicCamera(-this.planeWidth/2,this.planeHeight/2,this.planeHeight/2,-this.planeHeight/2,0,this.cameraHeight));i.rotation.x=Math.PI/2,i.layers.enable(Project.layerMap.visibleActors);const n=new MeshDepthMaterial;n.userData.darkness={value:this.shadowDarkness},n.onBeforeCompile=function(e){e.uniforms.darkness=n.userData.darkness,e.fragmentShader=`
					uniform float darkness;
					${e.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * darkness );")}
				`},n.depthTest=!1,n.depthWrite=!1;var a=new ShaderMaterial(HorizontalBlurShader),o=(a.depthTest=!1,new ShaderMaterial(VerticalBlurShader)),s=(o.depthTest=!1,new Group);return s.name="ContactShadow Group",s.position.y=-0,s.children=[r,e,i],s.layers.set(1),s.receiveShadow=!0,this._shadowGroup=s,this._shadowBlurPlane=e,this._horizontalBlurMaterial=a,this._verticalBlurMaterial=o,this._shadowCamera=i,this._depthMaterial=n,this._shadowPlaneMaterial=t,this}_blur(e){return this._shadowBlurPlane.visible=!0,this._shadowPlaneMaterial.map=this._renderTargets[0].texture,this._shadowBlurPlane.material=this._verticalBlurMaterial,this._shadowBlurPlane.material.uniforms.tDiffuse.value=this._renderTargets[0].texture,this._verticalBlurMaterial.uniforms.v.value=+e/256,this._renderer.setRenderTarget(this._renderTargets[1]),this._renderer.render(this._shadowBlurPlane,this._shadowCamera),this._shadowBlurPlane.material=this._horizontalBlurMaterial,this._shadowBlurPlane.material.uniforms.tDiffuse.value=this._renderTargets[1].texture,this._horizontalBlurMaterial.uniforms.h.value=+e/256,this._renderer.setRenderTarget(this._renderTargets[0]),this._renderer.render(this._shadowBlurPlane,this._shadowCamera),this._shadowBlurPlane.visible=!1,this._renderTargets}_update(e){this._renderTargets=null,this.renderTarget&&this.renderTarget.dispose(),this.renderTargetBlur&&this.renderTargetBlur.dispose(),this.renderTarget=new WebGLRenderTarget(512,512),this.renderTarget.texture.format=RGBAFormat,this.renderTarget.texture.generateMipmaps=!1,this.renderTargetBlur=new WebGLRenderTarget(512,512),this.renderTargetBlur.texture.generateMipmaps=!1,this._renderTargets=[this.renderTarget,this.renderTargetBlur];var t=this._scene.background,r=(this._scene.background=null,this._scene.getObjectByName("crossHelper")),i=(r&&(r.visible=!1),this._scene.getObjectByName("frontHelper"));if(i&&(i.visible=!1),e instanceof Array)for(var n=0;n<e.length;n++)e[n].visible=!1;this._scene.overrideMaterial=this._depthMaterial;var a=this._renderer.getClearAlpha();if(this._renderer.setClearAlpha(0),this._renderer.setRenderTarget(this.renderTarget),this._renderer.render(this._scene,this._shadowCamera),this._scene.overrideMaterial=null,e instanceof Array)for(n=0;n<e.length;n++)e[n].visible=!0;r&&(r.visible=!0),i&&(i.visible=!0),this._blur(this.blurAmount),this._blur(.4*this.blurAmount),this._renderer.setRenderTarget(null),this._renderer.setClearAlpha(a),this._scene.background=t}}const CopyShader={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class Pass{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const _camera$1=new OrthographicCamera$1(-1,1,1,-1,0,1),_geometry$1=new BufferGeometry$1;_geometry$1.setAttribute("position",new Float32BufferAttribute$1([-1,3,0,-1,-1,0,3,-1,0],3)),_geometry$1.setAttribute("uv",new Float32BufferAttribute$1([0,2,0,0,2,0],2));class FullScreenQuad{constructor(e){this._mesh=new Mesh$1(_geometry$1,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,_camera$1)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class ShaderPass extends Pass{constructor(e,t){super(),this.textureID=void 0!==t?t:"tDiffuse",e instanceof ShaderMaterial$1?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=UniformsUtils$1.clone(e.uniforms),this.material=new ShaderMaterial$1({name:void 0!==e.name?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new FullScreenQuad(this.material)}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil)),this.fsQuad.render(e)}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class MaskPass extends Pass{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,r){var i=e.getContext(),n=e.state;n.buffers.color.setMask(!1),n.buffers.depth.setMask(!1),n.buffers.color.setLocked(!0),n.buffers.depth.setLocked(!0);let a,o;o=this.inverse?(a=0,1):(a=1,0),n.buffers.stencil.setTest(!0),n.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),n.buffers.stencil.setFunc(i.ALWAYS,a,4294967295),n.buffers.stencil.setClear(o),n.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),n.buffers.color.setLocked(!1),n.buffers.depth.setLocked(!1),n.buffers.color.setMask(!0),n.buffers.depth.setMask(!0),n.buffers.stencil.setLocked(!1),n.buffers.stencil.setFunc(i.EQUAL,1,4294967295),n.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),n.buffers.stencil.setLocked(!0)}}class ClearMaskPass extends Pass{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class EffectComposer{constructor(e,t){this.renderer=e,this._pixelRatio=e.getPixelRatio(),void 0===t?(e=e.getSize(new Vector2$1),this._width=e.width,this._height=e.height,(t=new WebGLRenderTarget$1(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:HalfFloatType$1})).texture.name="EffectComposer.rt1"):(this._width=t.width,this._height=t.height),this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new ShaderPass(CopyShader),this.copyPass.material.blending=NoBlending$1,this.clock=new Clock$1}swapBuffers(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){e=this.passes.indexOf(e);-1!==e&&this.passes.splice(e,1)}isLastEnabledPass(t){for(let e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0}render(r){void 0===r&&(r=this.clock.getDelta());var e=this.renderer.getRenderTarget();let i=!1;for(let e=0,t=this.passes.length;e<t;e++){var n,a,o=this.passes[e];!1!==o.enabled&&(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(e),o.render(this.renderer,this.writeBuffer,this.readBuffer,r,i),o.needsSwap&&(i&&(n=this.renderer.getContext(),(a=this.renderer.state.buffers.stencil).setFunc(n.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,r),a.setFunc(n.EQUAL,1,4294967295)),this.swapBuffers()),void 0!==MaskPass)&&(o instanceof MaskPass?i=!0:o instanceof ClearMaskPass&&(i=!1))}this.renderer.setRenderTarget(e)}reset(e){var t;void 0===e&&(t=this.renderer.getSize(new Vector2$1),this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)),this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;var r=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(r,i),this.renderTarget2.setSize(r,i);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(r,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class RenderPass extends Pass{constructor(e,t,r,i,n){super(),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=i,this.clearAlpha=void 0!==n?n:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Color$1}render(e,t,r){var i=e.autoClear;e.autoClear=!1;let n,a;void 0!==this.overrideMaterial&&(a=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),n=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,n),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=a),e.autoClear=i}}const OutputShader={uniforms:{tDiffuse:{value:null},toneMappingExposure:{value:1}},vertexShader:`
		precision highp float;

		uniform mat4 modelViewMatrix;
		uniform mat4 projectionMatrix;

		attribute vec3 position;
		attribute vec2 uv;

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
	
		precision highp float;

		uniform sampler2D tDiffuse;

		`+ShaderChunk$1.tonemapping_pars_fragment+ShaderChunk$1.colorspace_pars_fragment+`

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );

			// tone mapping

			#ifdef LINEAR_TONE_MAPPING

				gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );

			#elif defined( REINHARD_TONE_MAPPING )

				gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );

			#elif defined( CINEON_TONE_MAPPING )

				gl_FragColor.rgb = OptimizedCineonToneMapping( gl_FragColor.rgb );

			#elif defined( ACES_FILMIC_TONE_MAPPING )

				gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );

			#endif

			// color space

			#ifdef SRGB_COLOR_SPACE

				gl_FragColor = LinearTosRGB( gl_FragColor );

			#endif

		}`};class OutputPass extends Pass{constructor(){super();var e=OutputShader;this.uniforms=UniformsUtils$1.clone(e.uniforms),this.material=new RawShaderMaterial$1({uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.fsQuad=new FullScreenQuad(this.material),this._outputColorSpace=null,this._toneMapping=null}render(e,t,r){this.uniforms.tDiffuse.value=r.texture,this.uniforms.toneMappingExposure.value=e.toneMappingExposure,this._outputColorSpace===e.outputColorSpace&&this._toneMapping===e.toneMapping||(this._outputColorSpace=e.outputColorSpace,this._toneMapping=e.toneMapping,this.material.defines={},this._outputColorSpace==SRGBColorSpace$1&&(this.material.defines.SRGB_COLOR_SPACE=""),this._toneMapping===LinearToneMapping$1?this.material.defines.LINEAR_TONE_MAPPING="":this._toneMapping===ReinhardToneMapping$1?this.material.defines.REINHARD_TONE_MAPPING="":this._toneMapping===CineonToneMapping$1?this.material.defines.CINEON_TONE_MAPPING="":this._toneMapping===ACESFilmicToneMapping$1&&(this.material.defines.ACES_FILMIC_TONE_MAPPING=""),this.material.needsUpdate=!0),!0===this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil)),this.fsQuad.render(e)}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const LuminosityHighPassShader={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new Color$1(0)},defaultOpacity:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec3 defaultColor;
		uniform float defaultOpacity;
		uniform float luminosityThreshold;
		uniform float smoothWidth;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );

			vec3 luma = vec3( 0.299, 0.587, 0.114 );

			float v = dot( texel.xyz, luma );

			vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );

			float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );

			gl_FragColor = mix( outputColor, texel, alpha );

		}`};class UnrealBloomPass extends Pass{constructor(e,t,r,i){super(),this.strength=void 0!==t?t:1,this.radius=r,this.threshold=i,this.resolution=void 0!==e?new Vector2$1(e.x,e.y):new Vector2$1(256,256),this.clearColor=new Color$1(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let n=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetBright=new WebGLRenderTarget$1(n,a,{type:HalfFloatType$1}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let e=0;e<this.nMips;e++){var o=new WebGLRenderTarget$1(n,a,{type:HalfFloatType$1}),o=(o.texture.name="UnrealBloomPass.h"+e,o.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(o),new WebGLRenderTarget$1(n,a,{type:HalfFloatType$1}));o.texture.name="UnrealBloomPass.v"+e,o.texture.generateMipmaps=!1,this.renderTargetsVertical.push(o),n=Math.round(n/2),a=Math.round(a/2)}var r=LuminosityHighPassShader,s=(this.highPassUniforms=UniformsUtils$1.clone(r.uniforms),this.highPassUniforms.luminosityThreshold.value=i,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new ShaderMaterial$1({uniforms:this.highPassUniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}),this.separableBlurMaterials=[],[3,5,7,9,11]);n=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);for(let e=0;e<this.nMips;e++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(s[e])),this.separableBlurMaterials[e].uniforms.invSize.value=new Vector2$1(1/n,1/a),n=Math.round(n/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new Vector3$1(1,1,1),new Vector3$1(1,1,1),new Vector3$1(1,1,1),new Vector3$1(1,1,1),new Vector3$1(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;e=CopyShader;this.copyUniforms=UniformsUtils$1.clone(e.uniforms),this.blendMaterial=new ShaderMaterial$1({uniforms:this.copyUniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,blending:AdditiveBlending$1,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new Color$1,this.oldClearAlpha=1,this.basic=new MeshBasicMaterial$1,this.fsQuad=new FullScreenQuad(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose();for(let e=0;e<this.separableBlurMaterials.length;e++)this.separableBlurMaterials[e].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(e,t){let r=Math.round(e/2),i=Math.round(t/2);this.renderTargetBright.setSize(r,i);for(let e=0;e<this.nMips;e++)this.renderTargetsHorizontal[e].setSize(r,i),this.renderTargetsVertical[e].setSize(r,i),this.separableBlurMaterials[e].uniforms.invSize.value=new Vector2$1(1/r,1/i),r=Math.round(r/2),i=Math.round(i/2)}render(t,e,r,i,n){t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha();var a=t.autoClear;t.autoClear=!1,t.setClearColor(this.clearColor,0),n&&t.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,t.setRenderTarget(null),t.clear(),this.fsQuad.render(t)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,t.setRenderTarget(this.renderTargetBright),t.clear(),this.fsQuad.render(t);let o=this.renderTargetBright;for(let e=0;e<this.nMips;e++)this.fsQuad.material=this.separableBlurMaterials[e],this.separableBlurMaterials[e].uniforms.colorTexture.value=o.texture,this.separableBlurMaterials[e].uniforms.direction.value=UnrealBloomPass.BlurDirectionX,t.setRenderTarget(this.renderTargetsHorizontal[e]),t.clear(),this.fsQuad.render(t),this.separableBlurMaterials[e].uniforms.colorTexture.value=this.renderTargetsHorizontal[e].texture,this.separableBlurMaterials[e].uniforms.direction.value=UnrealBloomPass.BlurDirectionY,t.setRenderTarget(this.renderTargetsVertical[e]),t.clear(),this.fsQuad.render(t),o=this.renderTargetsVertical[e];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,t.setRenderTarget(this.renderTargetsHorizontal[0]),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,n&&t.state.buffers.stencil.setTest(!0),this.renderToScreen?t.setRenderTarget(null):t.setRenderTarget(r),this.fsQuad.render(t),t.setClearColor(this._oldClearColor,this.oldClearAlpha),t.autoClear=a}getSeperableBlurMaterial(t){var r=[];for(let e=0;e<t;e++)r.push(.39894*Math.exp(-.5*e*e/(t*t))/t);return new ShaderMaterial$1({defines:{KERNEL_RADIUS:t},uniforms:{colorTexture:{value:null},invSize:{value:new Vector2$1(.5,.5)},direction:{value:new Vector2$1(.5,.5)},gaussianCoefficients:{value:r}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 invSize;
				uniform vec2 direction;
				uniform float gaussianCoefficients[KERNEL_RADIUS];

				void main() {
					float weightSum = gaussianCoefficients[0];
					vec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianCoefficients[i];
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(e){return new ShaderMaterial$1({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}}UnrealBloomPass.BlurDirectionX=new Vector2$1(1,0),UnrealBloomPass.BlurDirectionY=new Vector2$1(0,1);const FXAAShader={uniforms:{tDiffuse:{value:null},resolution:{value:new Vector2$1(1/1024,1/512)}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
	precision highp float;

	uniform sampler2D tDiffuse;

	uniform vec2 resolution;

	varying vec2 vUv;

	// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)

	//----------------------------------------------------------------------------------
	// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag
	// SDK Version: v3.00
	// Email:       gameworks@nvidia.com
	// Site:        http://developer.nvidia.com/
	//
	// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.
	//
	// Redistribution and use in source and binary forms, with or without
	// modification, are permitted provided that the following conditions
	// are met:
	//  * Redistributions of source code must retain the above copyright
	//    notice, this list of conditions and the following disclaimer.
	//  * Redistributions in binary form must reproduce the above copyright
	//    notice, this list of conditions and the following disclaimer in the
	//    documentation and/or other materials provided with the distribution.
	//  * Neither the name of NVIDIA CORPORATION nor the names of its
	//    contributors may be used to endorse or promote products derived
	//    from this software without specific prior written permission.
	//
	// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ''AS IS'' AND ANY
	// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
	// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
	// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
	// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
	// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
	// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
	// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
	// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
	// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
	// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
	//
	//----------------------------------------------------------------------------------

	#ifndef FXAA_DISCARD
			//
			// Only valid for PC OpenGL currently.
			// Probably will not work when FXAA_GREEN_AS_LUMA = 1.
			//
			// 1 = Use discard on pixels which don't need AA.
			//     For APIs which enable concurrent TEX+ROP from same surface.
			// 0 = Return unchanged color on pixels which don't need AA.
			//
			#define FXAA_DISCARD 0
	#endif

	/*--------------------------------------------------------------------------*/
	#define FxaaTexTop(t, p) texture2D(t, p, -100.0)
	#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), -100.0)
	/*--------------------------------------------------------------------------*/

	#define NUM_SAMPLES 5

	// assumes colors have premultipliedAlpha, so that the calculated color contrast is scaled by alpha
	float contrast( vec4 a, vec4 b ) {
			vec4 diff = abs( a - b );
			return max( max( max( diff.r, diff.g ), diff.b ), diff.a );
	}

	/*============================================================================

									FXAA3 QUALITY - PC

	============================================================================*/

	/*--------------------------------------------------------------------------*/
	vec4 FxaaPixelShader(
			vec2 posM,
			sampler2D tex,
			vec2 fxaaQualityRcpFrame,
			float fxaaQualityEdgeThreshold,
			float fxaaQualityinvEdgeThreshold
	) {
			vec4 rgbaM = FxaaTexTop(tex, posM);
			vec4 rgbaS = FxaaTexOff(tex, posM, vec2( 0.0, 1.0), fxaaQualityRcpFrame.xy);
			vec4 rgbaE = FxaaTexOff(tex, posM, vec2( 1.0, 0.0), fxaaQualityRcpFrame.xy);
			vec4 rgbaN = FxaaTexOff(tex, posM, vec2( 0.0,-1.0), fxaaQualityRcpFrame.xy);
			vec4 rgbaW = FxaaTexOff(tex, posM, vec2(-1.0, 0.0), fxaaQualityRcpFrame.xy);
			// . S .
			// W M E
			// . N .

			bool earlyExit = max( max( max(
					contrast( rgbaM, rgbaN ),
					contrast( rgbaM, rgbaS ) ),
					contrast( rgbaM, rgbaE ) ),
					contrast( rgbaM, rgbaW ) )
					< fxaaQualityEdgeThreshold;
			// . 0 .
			// 0 0 0
			// . 0 .

			#if (FXAA_DISCARD == 1)
					if(earlyExit) FxaaDiscard;
			#else
					if(earlyExit) return rgbaM;
			#endif

			float contrastN = contrast( rgbaM, rgbaN );
			float contrastS = contrast( rgbaM, rgbaS );
			float contrastE = contrast( rgbaM, rgbaE );
			float contrastW = contrast( rgbaM, rgbaW );

			float relativeVContrast = ( contrastN + contrastS ) - ( contrastE + contrastW );
			relativeVContrast *= fxaaQualityinvEdgeThreshold;

			bool horzSpan = relativeVContrast > 0.;
			// . 1 .
			// 0 0 0
			// . 1 .

			// 45 deg edge detection and corners of objects, aka V/H contrast is too similar
			if( abs( relativeVContrast ) < .3 ) {
					// locate the edge
					vec2 dirToEdge;
					dirToEdge.x = contrastE > contrastW ? 1. : -1.;
					dirToEdge.y = contrastS > contrastN ? 1. : -1.;
					// . 2 .      . 1 .
					// 1 0 2  ~=  0 0 1
					// . 1 .      . 0 .

					// tap 2 pixels and see which ones are "outside" the edge, to
					// determine if the edge is vertical or horizontal

					vec4 rgbaAlongH = FxaaTexOff(tex, posM, vec2( dirToEdge.x, -dirToEdge.y ), fxaaQualityRcpFrame.xy);
					float matchAlongH = contrast( rgbaM, rgbaAlongH );
					// . 1 .
					// 0 0 1
					// . 0 H

					vec4 rgbaAlongV = FxaaTexOff(tex, posM, vec2( -dirToEdge.x, dirToEdge.y ), fxaaQualityRcpFrame.xy);
					float matchAlongV = contrast( rgbaM, rgbaAlongV );
					// V 1 .
					// 0 0 1
					// . 0 .

					relativeVContrast = matchAlongV - matchAlongH;
					relativeVContrast *= fxaaQualityinvEdgeThreshold;

					if( abs( relativeVContrast ) < .3 ) { // 45 deg edge
							// 1 1 .
							// 0 0 1
							// . 0 1

							// do a simple blur
							return mix(
									rgbaM,
									(rgbaN + rgbaS + rgbaE + rgbaW) * .25,
									.4
							);
					}

					horzSpan = relativeVContrast > 0.;
			}

			if(!horzSpan) rgbaN = rgbaW;
			if(!horzSpan) rgbaS = rgbaE;
			// . 0 .      1
			// 1 0 1  ->  0
			// . 0 .      1

			bool pairN = contrast( rgbaM, rgbaN ) > contrast( rgbaM, rgbaS );
			if(!pairN) rgbaN = rgbaS;

			vec2 offNP;
			offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;
			offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;

			bool doneN = false;
			bool doneP = false;

			float nDist = 0.;
			float pDist = 0.;

			vec2 posN = posM;
			vec2 posP = posM;

			int iterationsUsed = 0;
			int iterationsUsedN = 0;
			int iterationsUsedP = 0;
			for( int i = 0; i < NUM_SAMPLES; i++ ) {
					iterationsUsed = i;

					float increment = float(i + 1);

					if(!doneN) {
							nDist += increment;
							posN = posM + offNP * nDist;
							vec4 rgbaEndN = FxaaTexTop(tex, posN.xy);
							doneN = contrast( rgbaEndN, rgbaM ) > contrast( rgbaEndN, rgbaN );
							iterationsUsedN = i;
					}

					if(!doneP) {
							pDist += increment;
							posP = posM - offNP * pDist;
							vec4 rgbaEndP = FxaaTexTop(tex, posP.xy);
							doneP = contrast( rgbaEndP, rgbaM ) > contrast( rgbaEndP, rgbaN );
							iterationsUsedP = i;
					}

					if(doneN || doneP) break;
			}


			if ( !doneP && !doneN ) return rgbaM; // failed to find end of edge

			float dist = min(
					doneN ? float( iterationsUsedN ) / float( NUM_SAMPLES - 1 ) : 1.,
					doneP ? float( iterationsUsedP ) / float( NUM_SAMPLES - 1 ) : 1.
			);

			// hacky way of reduces blurriness of mostly diagonal edges
			// but reduces AA quality
			dist = pow(dist, .5);

			dist = 1. - dist;

			return mix(
					rgbaM,
					rgbaN,
					dist * .5
			);
	}

	void main() {
			const float edgeDetectionQuality = .2;
			const float invEdgeDetectionQuality = 1. / edgeDetectionQuality;

			gl_FragColor = FxaaPixelShader(
					vUv,
					tDiffuse,
					resolution,
					edgeDetectionQuality, // [0,1] contrast needed, otherwise early discard
					invEdgeDetectionQuality
			);

	}
	`};class Tween extends EventEmitter{constructor(e,t,r,i=0){super(),this.canceled=void 0,this.stepCount=void 0,this.lastFraction=void 0,this.id=v4(),this.stepCount=0,this.startTime=(new Date).getTime(),this.easingFn=r,this.callback=t,this.lengthMs=e,this.steps=i,this.timeStep=e/i,this.canceled=!1,this.lastFraction=0,this.update()}update(){var e,t,r;!1===this.stopped&&(e=(new Date).getTime(),t=Math.max(0,Math.min(1,(e-this.startTime)/this.lengthMs)),r=this.easingFn(t),this.callback(r,r-this.lastFraction,t),this.stepCount+=1,this.lastFraction=r,1===t?(this.emit("complete"),this.stop()):0<this.steps&&(r=this.startTime+this.stepCount*this.timeStep-e,setTimeout(this.update.bind(this),r)))}stop(){this.stopped=!0,this.emit("stop")}}Tween.linear=e=>e,Tween.easeInQuad=e=>e,Tween.easeOutQuad=e=>e*(2-e),Tween.easeInOutQuad=e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,Tween.easeInCubic=e=>e*e*e,Tween.easeOutCubic=e=>-e*e*e+1,Tween.easeInOutCubic=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,Tween.easeInQuart=e=>e*e*e*e,Tween.easeOutQuart=e=>1- --e*e*e*e,Tween.easeInOutQuart=e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e,Tween.easeInQuint=e=>e*e*e*e*e,Tween.easeOutQuint=e=>1+--e*e*e*e*e,Tween.staticeaseInOutQuint=e=>e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e;var ACTION,extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)};function __extends(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function isPerspectiveCamera(e){return e.isPerspectiveCamera}function isOrthographicCamera(e){return e.isOrthographicCamera}!function(e){e[e.NONE=0]="NONE",e[e.ROTATE=1]="ROTATE",e[e.TRUCK=2]="TRUCK",e[e.OFFSET=3]="OFFSET",e[e.DOLLY=4]="DOLLY",e[e.ZOOM=5]="ZOOM",e[e.TOUCH_ROTATE=6]="TOUCH_ROTATE",e[e.TOUCH_TRUCK=7]="TOUCH_TRUCK",e[e.TOUCH_OFFSET=8]="TOUCH_OFFSET",e[e.TOUCH_DOLLY=9]="TOUCH_DOLLY",e[e.TOUCH_ZOOM=10]="TOUCH_ZOOM",e[e.TOUCH_DOLLY_TRUCK=11]="TOUCH_DOLLY_TRUCK",e[e.TOUCH_DOLLY_OFFSET=12]="TOUCH_DOLLY_OFFSET",e[e.TOUCH_ZOOM_TRUCK=13]="TOUCH_ZOOM_TRUCK",e[e.TOUCH_ZOOM_OFFSET=14]="TOUCH_ZOOM_OFFSET"}(ACTION=ACTION||{});var PI_2=2*Math.PI,PI_HALF=Math.PI/2,FPS_60=60,EPSILON$1=1e-5;function approxZero(e){return Math.abs(e)<EPSILON$1}function approxEquals(e,t){return approxZero(e-t)}function roundToStep(e,t){return Math.round(e/t)*t}function infinityToMaxNumber(e){return isFinite(e)?e:e<0?-Number.MAX_VALUE:Number.MAX_VALUE}function maxNumberToInfinity(e){return Math.abs(e)<Number.MAX_VALUE?e:e*(1/0)}function isTouchEvent(e){return"TouchEvent"in window&&e instanceof TouchEvent}function extractClientCoordFromEvent(e,t){if(t.set(0,0),isTouchEvent(e)){for(var r=e,i=0;i<r.touches.length;i++)t.x+=r.touches[i].clientX,t.y+=r.touches[i].clientY;t.x/=r.touches.length,t.y/=r.touches.length}else t.set(e.clientX,e.clientY);return t}function notSupportedInOrthographicCamera(e,t){return!!isOrthographicCamera(e)&&(console.warn(t+" is not supported in OrthographicCamera"),!0)}function quatInvertCompat(e){return e.invert?e.invert():e.inverse(),e}var THREE$1,_ORIGIN,_AXIS_Y,_AXIS_Z,_v2$5,_v3A,_v3B,_v3C,_xColumn,_yColumn,_zColumn,_sphericalA,_sphericalB,_box3A,_box3B,_sphere$6,_quaternionA,_quaternionB,_rotationMatrix,_raycaster,EventDispatcher$1=function(){function e(){this._listeners={}}return e.prototype.addEventListener=function(e,t){var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},e.prototype.removeEventListener=function(e,t){e=this._listeners[e];void 0!==e&&-1!==(t=e.indexOf(t))&&e.splice(t,1)},e.prototype.removeAllEventListeners=function(e){e?Array.isArray(this._listeners[e])&&(this._listeners[e].length=0):this._listeners={}},e.prototype.dispatchEvent=function(e){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var r=t.slice(0),i=0,n=r.length;i<n;i++)r[i].call(this,e)}},e}(),isBrowser="undefined"!=typeof window,isMac=isBrowser&&/Mac/.test(navigator.platform),readonlyACTION=Object.freeze(ACTION),TOUCH_DOLLY_FACTOR=1/8,CameraControls=function(m){function e(e,t){var s,l,c,r,i,n,a,o,d,h,u,A,p=m.call(this)||this;return p.minPolarAngle=0,p.maxPolarAngle=Math.PI,p.minAzimuthAngle=-1/0,p.maxAzimuthAngle=1/0,p.minDistance=0,p.maxDistance=1/0,p.infinityDolly=!1,p.minZoom=.01,p.maxZoom=1/0,p.dampingFactor=.05,p.draggingDampingFactor=.25,p.azimuthRotateSpeed=1,p.polarRotateSpeed=1,p.dollySpeed=1,p.truckSpeed=2,p.dollyToCursor=!1,p.dragToOffset=!1,p.verticalDragToForward=!1,p.boundaryFriction=0,p.colliderMeshes=[],p.cancel=function(){},p._enabled=!0,p._state=ACTION.NONE,p._viewport=null,p._dollyControlAmount=0,p._boundaryEnclosesCamera=!1,p._needsUpdate=!0,p._updatedLastTime=!1,p._truckInternal=function(e,t,r){var i,n;isPerspectiveCamera(p._camera)?(n=_v3A.copy(p._camera.position).sub(p._target),i=p._camera.getEffectiveFOV()*THREE$1.MathUtils.DEG2RAD,n=n.length()*Math.tan(.5*i),i=p.truckSpeed*e*n/p._elementRect.w,n=p.truckSpeed*t*n/p._elementRect.w,p.verticalDragToForward?(r?p.setFocalOffset(p._focalOffsetEnd.x+i,p._focalOffsetEnd.y,p._focalOffsetEnd.z,!0):p.truck(i,0,!0),p.forward(-n,!0)):r?p.setFocalOffset(p._focalOffsetEnd.x+i,p._focalOffsetEnd.y+n,p._focalOffsetEnd.z,!0):p.truck(i,n,!0)):isOrthographicCamera(p._camera)&&(i=e*((e=p._camera).right-e.left)/e.zoom/p._elementRect.z,n=t*(e.top-e.bottom)/e.zoom/p._elementRect.w,r?p.setFocalOffset(p._focalOffsetEnd.x+i,p._focalOffsetEnd.y+n,p._focalOffsetEnd.z,!0):p.truck(i,n,!0))},p._rotateInternal=function(e,t){e=PI_2*p.azimuthRotateSpeed*e/p._elementRect.w,t=PI_2*p.polarRotateSpeed*t/p._elementRect.w;p.rotate(e,t,!0)},p._dollyInternal=function(e,t,r){var e=Math.pow(.95,-e*p.dollySpeed),e=p._sphericalEnd.radius*e,i=p._sphericalEnd.radius;p.dollyTo(e),p.infinityDolly&&e<p.minDistance&&(p._camera.getWorldDirection(_v3A),p._targetEnd.add(_v3A.normalize().multiplyScalar(i)),p._target.add(_v3A.normalize().multiplyScalar(i))),p.dollyToCursor&&(p._dollyControlAmount+=p._sphericalEnd.radius-i,p.infinityDolly&&e<p.minDistance&&(p._dollyControlAmount-=i),p._dollyControlCoord.set(t,r))},p._zoomInternal=function(e,t,r){e=Math.pow(.95,e*p.dollySpeed);p.zoomTo(p._zoom*e),p.dollyToCursor&&(p._dollyControlAmount=p._zoomEnd,p._dollyControlCoord.set(t,r))},void 0===THREE$1&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),p._camera=e,p._yAxisUpSpace=(new THREE$1.Quaternion).setFromUnitVectors(p._camera.up,_AXIS_Y),p._yAxisUpSpaceInverse=quatInvertCompat(p._yAxisUpSpace.clone()),p._state=ACTION.NONE,p._domElement=t,p._target=new THREE$1.Vector3,p._targetEnd=p._target.clone(),p._focalOffset=new THREE$1.Vector3,p._focalOffsetEnd=p._focalOffset.clone(),p._spherical=(new THREE$1.Spherical).setFromVector3(_v3A.copy(p._camera.position).applyQuaternion(p._yAxisUpSpace)),p._sphericalEnd=p._spherical.clone(),p._zoom=p._camera.zoom,p._zoomEnd=p._zoom,p._nearPlaneCorners=[new THREE$1.Vector3,new THREE$1.Vector3,new THREE$1.Vector3,new THREE$1.Vector3],p._updateNearPlaneCorners(),p._boundary=new THREE$1.Box3(new THREE$1.Vector3(-1/0,-1/0,-1/0),new THREE$1.Vector3(1/0,1/0,1/0)),p._target0=p._target.clone(),p._position0=p._camera.position.clone(),p._zoom0=p._zoom,p._focalOffset0=p._focalOffset.clone(),p._dollyControlAmount=0,p._dollyControlCoord=new THREE$1.Vector2,p.mouseButtons={left:ACTION.ROTATE,middle:ACTION.DOLLY,right:ACTION.TRUCK,wheel:isPerspectiveCamera(p._camera)?ACTION.DOLLY:isOrthographicCamera(p._camera)?ACTION.ZOOM:ACTION.NONE},p.touches={one:ACTION.TOUCH_ROTATE,two:isPerspectiveCamera(p._camera)?ACTION.TOUCH_DOLLY_TRUCK:isOrthographicCamera(p._camera)?ACTION.TOUCH_ZOOM_TRUCK:ACTION.NONE,three:ACTION.TOUCH_TRUCK},p._elementRect=new THREE$1.Vector4,p._domElement&&(s=new THREE$1.Vector2,l=new THREE$1.Vector2,c=new THREE$1.Vector2,r=function(){p._state=ACTION.NONE,document.removeEventListener("mousemove",u),document.removeEventListener("touchmove",u,{passive:!1}),document.removeEventListener("mouseup",A),document.removeEventListener("touchend",A)},n=function(e){if(p._enabled){switch(r(),e.touches.length){case 1:p._state=p.touches.one;break;case 2:p._state=p.touches.two;break;case 3:p._state=p.touches.three}h(e)}},a=-1,o=function(e){if(p._enabled&&p.mouseButtons.wheel!==ACTION.NONE){e.preventDefault(),!p.dollyToCursor&&p.mouseButtons.wheel!==ACTION.ROTATE&&p.mouseButtons.wheel!==ACTION.TRUCK||(t=performance.now(),a-t<1e3&&p._getClientRect(p._elementRect),a=t);var t=isMac?-1:-3,r=1===e.deltaMode?e.deltaY/t:e.deltaY/(10*t),i=p.dollyToCursor?(e.clientX-p._elementRect.x)/p._elementRect.z*2-1:0,n=p.dollyToCursor?(e.clientY-p._elementRect.y)/p._elementRect.w*-2+1:0;switch(p.mouseButtons.wheel){case ACTION.ROTATE:p._rotateInternal(e.deltaX,e.deltaY);break;case ACTION.TRUCK:p._truckInternal(e.deltaX,e.deltaY,!1);break;case ACTION.OFFSET:p._truckInternal(e.deltaX,e.deltaY,!0);break;case ACTION.DOLLY:p._dollyInternal(-r,i,n);break;case ACTION.ZOOM:p._zoomInternal(-r,i,n)}p.dispatchEvent({type:"control",originalEvent:e})}},d=function(e){p._enabled&&e.preventDefault()},h=function(e){var t,r,i;p._enabled&&(extractClientCoordFromEvent(e,_v2$5),p._getClientRect(p._elementRect),s.copy(_v2$5),l.copy(_v2$5),isTouchEvent(e)&&2<=e.touches.length&&(i=_v2$5.x-(t=e).touches[1].clientX,r=_v2$5.y-t.touches[1].clientY,i=Math.sqrt(i*i+r*r),c.set(0,i),r=.5*(t.touches[0].clientX+t.touches[1].clientX),i=.5*(t.touches[0].clientY+t.touches[1].clientY),l.set(r,i)),document.addEventListener("mousemove",u),document.addEventListener("touchmove",u,{passive:!1}),document.addEventListener("mouseup",A),document.addEventListener("touchend",A),p.dispatchEvent({type:"controlstart",originalEvent:e}))},u=function(e){if(p._enabled){e.cancelable&&e.preventDefault(),extractClientCoordFromEvent(e,_v2$5);var t=l.x-_v2$5.x,r=l.y-_v2$5.y;switch(l.copy(_v2$5),p._state){case ACTION.ROTATE:case ACTION.TOUCH_ROTATE:p._rotateInternal(t,r);break;case ACTION.DOLLY:case ACTION.ZOOM:var i=p.dollyToCursor?(s.x-p._elementRect.x)/p._elementRect.z*2-1:0,n=p.dollyToCursor?(s.y-p._elementRect.y)/p._elementRect.w*-2+1:0;p._state===ACTION.DOLLY?p._dollyInternal(r*TOUCH_DOLLY_FACTOR,i,n):p._zoomInternal(r*TOUCH_DOLLY_FACTOR,i,n);break;case ACTION.TOUCH_DOLLY:case ACTION.TOUCH_ZOOM:case ACTION.TOUCH_DOLLY_TRUCK:case ACTION.TOUCH_ZOOM_TRUCK:case ACTION.TOUCH_DOLLY_OFFSET:case ACTION.TOUCH_ZOOM_OFFSET:var a=_v2$5.x-e.touches[1].clientX,o=_v2$5.y-e.touches[1].clientY,a=Math.sqrt(a*a+o*o),o=c.y-a,i=(c.set(0,a),p.dollyToCursor?(l.x-p._elementRect.x)/p._elementRect.z*2-1:0),n=p.dollyToCursor?(l.y-p._elementRect.y)/p._elementRect.w*-2+1:0;p._state===ACTION.TOUCH_DOLLY||p._state===ACTION.TOUCH_DOLLY_TRUCK?p._dollyInternal(o*TOUCH_DOLLY_FACTOR,i,n):p._zoomInternal(o*TOUCH_DOLLY_FACTOR,i,n),p._state===ACTION.TOUCH_DOLLY_TRUCK||p._state===ACTION.TOUCH_ZOOM_TRUCK?p._truckInternal(t,r,!1):p._state!==ACTION.TOUCH_DOLLY_OFFSET&&p._state!==ACTION.TOUCH_ZOOM_OFFSET||p._truckInternal(t,r,!0);break;case ACTION.TRUCK:case ACTION.TOUCH_TRUCK:p._truckInternal(t,r,!1);break;case ACTION.OFFSET:case ACTION.TOUCH_OFFSET:p._truckInternal(t,r,!0)}p.dispatchEvent({type:"control",originalEvent:e})}},A=function(e){p._enabled&&(r(),p.dispatchEvent({type:"controlend",originalEvent:e}))},p._domElement.addEventListener("mousedown",i=function(e){if(p._enabled){switch(r(),e.button){case THREE$1.MOUSE.LEFT:p._state=p.mouseButtons.left;break;case THREE$1.MOUSE.MIDDLE:p._state=p.mouseButtons.middle;break;case THREE$1.MOUSE.RIGHT:p._state=p.mouseButtons.right}h(e)}}),p._domElement.addEventListener("touchstart",n,{passive:!0}),p._domElement.addEventListener("wheel",o,{passive:!1}),p._domElement.addEventListener("contextmenu",d),p._removeAllEventListeners=function(){p._domElement.removeEventListener("mousedown",i),p._domElement.removeEventListener("touchstart",n,{passive:!0}),p._domElement.removeEventListener("wheel",o,{passive:!1}),p._domElement.removeEventListener("contextmenu",d),document.removeEventListener("mousemove",u),document.removeEventListener("touchmove",u,{passive:!1}),document.removeEventListener("mouseup",A),document.removeEventListener("touchend",A)},p.cancel=function(){r(),p.dispatchEvent({type:"controlend",originalEvent:null})}),p.update(0),p}return __extends(e,m),e.install=function(e){THREE$1=e.THREE,_ORIGIN=Object.freeze(new THREE$1.Vector3(0,0,0)),_AXIS_Y=Object.freeze(new THREE$1.Vector3(0,1,0)),_AXIS_Z=Object.freeze(new THREE$1.Vector3(0,0,1)),_v2$5=new THREE$1.Vector2,_v3A=new THREE$1.Vector3,_v3B=new THREE$1.Vector3,_v3C=new THREE$1.Vector3,_xColumn=new THREE$1.Vector3,_yColumn=new THREE$1.Vector3,_zColumn=new THREE$1.Vector3,_sphericalA=new THREE$1.Spherical,_sphericalB=new THREE$1.Spherical,_box3A=new THREE$1.Box3,_box3B=new THREE$1.Box3,_sphere$6=new THREE$1.Sphere,_quaternionA=new THREE$1.Quaternion,_quaternionB=new THREE$1.Quaternion,_rotationMatrix=new THREE$1.Matrix4,_raycaster=new THREE$1.Raycaster},Object.defineProperty(e,"ACTION",{get:function(){return readonlyACTION},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){(this._enabled=e)||this.cancel()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentAction",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._spherical.radius},set:function(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"azimuthAngle",{get:function(){return this._spherical.theta},set:function(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polarAngle",{get:function(){return this._spherical.phi},set:function(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundaryEnclosesCamera",{get:function(){return this._boundaryEnclosesCamera},set:function(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0},enumerable:!1,configurable:!0}),e.prototype.addEventListener=function(e,t){m.prototype.addEventListener.call(this,e,t)},e.prototype.removeEventListener=function(e,t){m.prototype.removeEventListener.call(this,e,t)},e.prototype.rotate=function(e,t,r){this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,r=void 0===r?!1:r)},e.prototype.rotateTo=function(e,t,r){void 0===r&&(r=!1);e=THREE$1.MathUtils.clamp(e,this.minAzimuthAngle,this.maxAzimuthAngle),t=THREE$1.MathUtils.clamp(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=e,this._sphericalEnd.phi=t,this._sphericalEnd.makeSafe(),r||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi),this._needsUpdate=!0},e.prototype.dolly=function(e,t){this.dollyTo(this._sphericalEnd.radius-e,t=void 0===t?!1:t)},e.prototype.dollyTo=function(e,t){void 0===t&&(t=!1),this._sphericalEnd.radius=THREE$1.MathUtils.clamp(e,this.minDistance,this.maxDistance),t||(this._spherical.radius=this._sphericalEnd.radius),this._needsUpdate=!0},e.prototype.zoom=function(e,t){this.zoomTo(this._zoomEnd+e,t=void 0===t?!1:t)},e.prototype.zoomTo=function(e,t){void 0===t&&(t=!1),this._zoomEnd=THREE$1.MathUtils.clamp(e,this.minZoom,this.maxZoom),t||(this._zoom=this._zoomEnd),this._needsUpdate=!0},e.prototype.pan=function(e,t,r){void 0===r&&(r=!1),console.log("`pan` has been renamed to `truck`"),this.truck(e,t,r)},e.prototype.truck=function(e,t,r){void 0===r&&(r=!1),this._camera.updateMatrix(),_xColumn.setFromMatrixColumn(this._camera.matrix,0),_yColumn.setFromMatrixColumn(this._camera.matrix,1),_xColumn.multiplyScalar(e),_yColumn.multiplyScalar(-t);e=_v3A.copy(_xColumn).add(_yColumn);this._encloseToBoundary(this._targetEnd,e,this.boundaryFriction),r||this._target.copy(this._targetEnd),this._needsUpdate=!0},e.prototype.forward=function(e,t){void 0===t&&(t=!1),_v3A.setFromMatrixColumn(this._camera.matrix,0),_v3A.crossVectors(this._camera.up,_v3A),_v3A.multiplyScalar(e),this._encloseToBoundary(this._targetEnd,_v3A,this.boundaryFriction),t||this._target.copy(this._targetEnd),this._needsUpdate=!0},e.prototype.moveTo=function(e,t,r,i){void 0===i&&(i=!1),this._targetEnd.set(e,t,r),i||this._target.copy(this._targetEnd),this._needsUpdate=!0},e.prototype.fitToBox=function(e,t,r){var i,n,a,r=void 0===r?{}:r,o=r.paddingLeft,o=void 0===o?0:o,s=r.paddingRight,s=void 0===s?0:s,l=r.paddingBottom,l=void 0===l?0:l,r=r.paddingTop,r=void 0===r?0:r,e=e.isBox3?_box3A.copy(e):_box3A.setFromObject(e);e.isEmpty()?console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"):(a=roundToStep(this._sphericalEnd.theta,PI_HALF),n=roundToStep(this._sphericalEnd.phi,PI_HALF),this.rotateTo(a,n,t),n=_v3A.setFromSpherical(this._sphericalEnd).normalize(),i=_quaternionA.setFromUnitVectors(n,_AXIS_Z),approxEquals(Math.abs(n.y),1)&&i.multiply(_quaternionB.setFromAxisAngle(_AXIS_Y,a)),a=_box3B.makeEmpty(),_v3B.copy(e.min).applyQuaternion(i),a.expandByPoint(_v3B),_v3B.copy(e.min).setX(e.max.x).applyQuaternion(i),a.expandByPoint(_v3B),_v3B.copy(e.min).setY(e.max.y).applyQuaternion(i),a.expandByPoint(_v3B),_v3B.copy(e.max).setZ(e.min.z).applyQuaternion(i),a.expandByPoint(_v3B),_v3B.copy(e.min).setZ(e.max.z).applyQuaternion(i),a.expandByPoint(_v3B),_v3B.copy(e.max).setY(e.min.y).applyQuaternion(i),a.expandByPoint(_v3B),_v3B.copy(e.max).setX(e.min.x).applyQuaternion(i),a.expandByPoint(_v3B),_v3B.copy(e.max).applyQuaternion(i),a.expandByPoint(_v3B),i.setFromUnitVectors(_AXIS_Z,n),a.min.x-=o,a.min.y-=l,a.max.x+=s,a.max.y+=r,e=a.getSize(_v3A),n=a.getCenter(_v3B).applyQuaternion(i),isPerspectiveCamera(this._camera)?(o=this.getDistanceToFitBox(e.x,e.y,e.z),this.moveTo(n.x,n.y,n.z,t),this.dollyTo(o,t),this.setFocalOffset(0,0,0,t)):isOrthographicCamera(this._camera)&&(s=(l=this._camera).right-l.left,r=l.top-l.bottom,a=Math.min(s/e.x,r/e.y),this.moveTo(n.x,n.y,n.z,t),this.zoomTo(a,t),this.setFocalOffset(0,0,0,t)))},e.prototype.fitTo=function(e,t,r){void 0===r&&(r={}),console.warn("camera-controls: fitTo() has been renamed to fitToBox()"),this.fitToBox(e,t,r)},e.prototype.fitToSphere=function(e,t){var r,i,e=e instanceof THREE$1.Sphere?_sphere$6.copy(e):createBoundingSphere(e,_sphere$6);this.moveTo(e.center.x,e.center.y,e.center.z,t),isPerspectiveCamera(this._camera)?(i=this.getDistanceToFitSphere(e.radius),this.dollyTo(i,t)):isOrthographicCamera(this._camera)&&(i=this._camera.right-this._camera.left,r=this._camera.top-this._camera.bottom,e=2*e.radius,i=Math.min(i/e,r/e),this.zoomTo(i,t)),this.setFocalOffset(0,0,0,t)},e.prototype.setLookAt=function(e,t,r,i,n,a,o){void 0===o&&(o=!1);e=_v3A.set(e,t,r),t=_v3B.set(i,n,a);this._targetEnd.copy(t),this._sphericalEnd.setFromVector3(e.sub(t).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),o||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},e.prototype.lerpLookAt=function(e,t,r,i,n,a,o,s,l,c,d,h,u,A){void 0===A&&(A=!1);e=_v3A.set(e,t,r),t=_v3B.set(i,n,a),_sphericalA.setFromVector3(e.sub(t).applyQuaternion(this._yAxisUpSpace)),r=_v3A.set(c,d,h),this._targetEnd.copy(t).lerp(r,u),i=_v3B.set(o,s,l),_sphericalB.setFromVector3(i.sub(r).applyQuaternion(this._yAxisUpSpace)),n=_sphericalB.theta-_sphericalA.theta,a=_sphericalB.phi-_sphericalA.phi,e=_sphericalB.radius-_sphericalA.radius;this._sphericalEnd.set(_sphericalA.radius+e*u,_sphericalA.phi+a*u,_sphericalA.theta+n*u),this.normalizeRotations(),A||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},e.prototype.setPosition=function(e,t,r,i){this.setLookAt(e,t,r,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i=void 0===i?!1:i)},e.prototype.setTarget=function(e,t,r,i){void 0===i&&(i=!1);var n=this.getPosition(_v3A);this.setLookAt(n.x,n.y,n.z,e,t,r,i)},e.prototype.setFocalOffset=function(e,t,r,i){void 0===i&&(i=!1),this._focalOffsetEnd.set(e,t,r),i||this._focalOffset.copy(this._focalOffsetEnd),this._needsUpdate=!0},e.prototype.setBoundary=function(e){e?(this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd)):(this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0)),this._needsUpdate=!0},e.prototype.setViewport=function(e,t,r,i){null===e?this._viewport=null:(this._viewport=this._viewport||new THREE$1.Vector4,"number"==typeof e?this._viewport.set(e,t,r,i):this._viewport.copy(e))},e.prototype.getDistanceToFitBox=function(e,t,r){var i,n;return notSupportedInOrthographicCamera(this._camera,"getDistanceToFitBox")?this._spherical.radius:(n=e/t,i=this._camera.getEffectiveFOV()*THREE$1.MathUtils.DEG2RAD,.5*(n<(n=this._camera.aspect)?t:e/n)/Math.tan(.5*i)+.5*r)},e.prototype.getDistanceToFit=function(e,t,r){return console.warn("camera-controls: getDistanceToFit() has been renamed to getDistanceToFitBox()"),this.getDistanceToFitBox(e,t,r)},e.prototype.getDistanceToFitSphere=function(e){var t,r;return notSupportedInOrthographicCamera(this._camera,"getDistanceToFitSphere")?this._spherical.radius:(r=this._camera.getEffectiveFOV()*THREE$1.MathUtils.DEG2RAD,t=2*Math.atan(Math.tan(.5*r)*this._camera.aspect),r=1<this._camera.aspect?r:t,e/Math.sin(.5*r))},e.prototype.getTarget=function(e){return(e&&e.isVector3?e:new THREE$1.Vector3).copy(this._targetEnd)},e.prototype.getPosition=function(e){return(e&&e.isVector3?e:new THREE$1.Vector3).setFromSpherical(this._sphericalEnd).applyQuaternion(this._yAxisUpSpaceInverse).add(this._targetEnd)},e.prototype.getFocalOffset=function(e){return(e&&e.isVector3?e:new THREE$1.Vector3).copy(this._focalOffsetEnd)},e.prototype.normalizeRotations=function(){this._sphericalEnd.theta=this._sphericalEnd.theta%PI_2,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=PI_2),this._spherical.theta+=PI_2*Math.round((this._sphericalEnd.theta-this._spherical.theta)/PI_2)},e.prototype.reset=function(e){this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e=void 0===e?!1:e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)},e.prototype.saveState=function(){this._target0.copy(this._target),this._position0.copy(this._camera.position),this._zoom0=this._zoom},e.prototype.updateCameraUp=function(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,_AXIS_Y),quatInvertCompat(this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace))},e.prototype.update=function(e){var t,r,i=this._state===ACTION.NONE?this.dampingFactor:this.draggingDampingFactor,i=1-Math.exp(-i*e*FPS_60),e=this._sphericalEnd.theta-this._spherical.theta,n=this._sphericalEnd.phi-this._spherical.phi,a=this._sphericalEnd.radius-this._spherical.radius,o=_v3A.subVectors(this._targetEnd,this._target),s=_v3B.subVectors(this._focalOffsetEnd,this._focalOffset),s=(approxZero(e)&&approxZero(n)&&approxZero(a)&&approxZero(o.x)&&approxZero(o.y)&&approxZero(o.z)&&approxZero(s.x)&&approxZero(s.y)&&approxZero(s.z)?(this._spherical.copy(this._sphericalEnd),this._target.copy(this._targetEnd),this._focalOffset.copy(this._focalOffsetEnd)):(this._spherical.set(this._spherical.radius+a*i,this._spherical.phi+n*i,this._spherical.theta+e*i),this._target.add(o.multiplyScalar(i)),this._focalOffset.add(s.multiplyScalar(i)),this._needsUpdate=!0),0!==this._dollyControlAmount&&(isPerspectiveCamera(this._camera)?(t=this._camera,a=_v3A.setFromSpherical(this._sphericalEnd).applyQuaternion(this._yAxisUpSpaceInverse).normalize().negate(),0===(n=_v3B.copy(a).cross(t.up).normalize()).lengthSq()&&(n.x=1),e=_v3C.crossVectors(n,a),o=this._sphericalEnd.radius*Math.tan(t.getEffectiveFOV()*THREE$1.MathUtils.DEG2RAD*.5),s=(this._sphericalEnd.radius-this._dollyControlAmount-this._sphericalEnd.radius)/this._sphericalEnd.radius,r=_v3A.copy(this._targetEnd).add(n.multiplyScalar(this._dollyControlCoord.x*o*t.aspect)).add(e.multiplyScalar(this._dollyControlCoord.y*o)),this._targetEnd.lerp(r,s),this._target.copy(this._targetEnd)):isOrthographicCamera(this._camera)&&(t=this._camera,a=_v3A.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(t.near+t.far)/(t.near-t.far)).unproject(t),o=approxZero(e=(n=_v3B.set(0,0,-1).applyQuaternion(t.quaternion)).dot(t.up))?-a.dot(t.up):-a.dot(t.up)/e,r=_v3C.copy(a).add(n.multiplyScalar(o)),this._targetEnd.lerp(r,1-t.zoom/this._dollyControlAmount),this._target.copy(this._targetEnd)),this._dollyControlAmount=0),this._collisionTest());this._spherical.radius=Math.min(this._spherical.radius,s),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target);approxZero(this._focalOffset.x)&&approxZero(this._focalOffset.y)&&approxZero(this._focalOffset.z)||(this._camera.updateMatrix(),_xColumn.setFromMatrixColumn(this._camera.matrix,0),_yColumn.setFromMatrixColumn(this._camera.matrix,1),_zColumn.setFromMatrixColumn(this._camera.matrix,2),_xColumn.multiplyScalar(this._focalOffset.x),_yColumn.multiplyScalar(-this._focalOffset.y),_zColumn.multiplyScalar(this._focalOffset.z),_v3A.copy(_xColumn).add(_yColumn).add(_zColumn),this._camera.position.add(_v3A)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),_v3A.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);e=this._zoomEnd-this._zoom,this._zoom+=e*i,this._camera.zoom!==this._zoom&&(approxZero(e)&&(this._zoom=this._zoomEnd),this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),a=this._needsUpdate;return a&&!this._updatedLastTime?(this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):a?this.dispatchEvent({type:"update"}):!a&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._updatedLastTime=a,this._needsUpdate=!1,a},e.prototype.toJSON=function(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:infinityToMaxNumber(this.maxDistance),minZoom:this.minZoom,maxZoom:infinityToMaxNumber(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:infinityToMaxNumber(this.maxPolarAngle),minAzimuthAngle:infinityToMaxNumber(this.minAzimuthAngle),maxAzimuthAngle:infinityToMaxNumber(this.maxAzimuthAngle),dampingFactor:this.dampingFactor,draggingDampingFactor:this.draggingDampingFactor,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:_v3A.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})},e.prototype.fromJSON=function(e,t){void 0===t&&(t=!1);var e=JSON.parse(e),r=_v3A.fromArray(e.position);this.enabled=e.enabled,this.minDistance=e.minDistance,this.maxDistance=maxNumberToInfinity(e.maxDistance),this.minZoom=e.minZoom,this.maxZoom=maxNumberToInfinity(e.maxZoom),this.minPolarAngle=e.minPolarAngle,this.maxPolarAngle=maxNumberToInfinity(e.maxPolarAngle),this.minAzimuthAngle=maxNumberToInfinity(e.minAzimuthAngle),this.maxAzimuthAngle=maxNumberToInfinity(e.maxAzimuthAngle),this.dampingFactor=e.dampingFactor,this.draggingDampingFactor=e.draggingDampingFactor,this.dollySpeed=e.dollySpeed,this.truckSpeed=e.truckSpeed,this.dollyToCursor=e.dollyToCursor,this.verticalDragToForward=e.verticalDragToForward,this._target0.fromArray(e.target0),this._position0.fromArray(e.position0),this._zoom0=e.zoom0,this._focalOffset0.fromArray(e.focalOffset0),this.moveTo(e.target[0],e.target[1],e.target[2],t),_sphericalA.setFromVector3(r.sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(_sphericalA.theta,_sphericalA.phi,t),this.zoomTo(e.zoom,t),this.setFocalOffset(e.focalOffset[0],e.focalOffset[1],e.focalOffset[2],t),this._needsUpdate=!0},e.prototype.dispose=function(){this._removeAllEventListeners()},e.prototype._encloseToBoundary=function(e,t,r){var i,n,a=t.lengthSq();return 0===a?e:(i=_v3B.copy(t).add(e),0===(n=(i=this._boundary.clampPoint(i,_v3C).sub(i)).lengthSq())?e.add(t):n===a?e:0===r?e.add(t).add(i):(a=1+r*n/t.dot(i),e.add(_v3B.copy(t).multiplyScalar(a)).add(i.multiplyScalar(1-r))))},e.prototype._updateNearPlaneCorners=function(){var e,t,r,i,n;isPerspectiveCamera(this._camera)?(e=(n=this._camera).near,t=n.getEffectiveFOV()*THREE$1.MathUtils.DEG2RAD,e=(t=Math.tan(.5*t)*e)*n.aspect,this._nearPlaneCorners[0].set(-e,-t,0),this._nearPlaneCorners[1].set(e,-t,0),this._nearPlaneCorners[2].set(e,t,0),this._nearPlaneCorners[3].set(-e,t,0)):isOrthographicCamera(this._camera)&&(e=1/(n=this._camera).zoom,t=n.left*e,r=n.right*e,i=n.top*e,n=n.bottom*e,this._nearPlaneCorners[0].set(t,i,0),this._nearPlaneCorners[1].set(r,i,0),this._nearPlaneCorners[2].set(r,n,0),this._nearPlaneCorners[3].set(t,n,0))},e.prototype._collisionTest=function(){var e=1/0,t=1<=this.colliderMeshes.length;if(t&&!notSupportedInOrthographicCamera(this._camera,"_collisionTest")){var e=this._spherical.radius,r=_v3A.setFromSpherical(this._spherical).divideScalar(e);_rotationMatrix.lookAt(_ORIGIN,r,this._camera.up);for(var i=0;i<4;i++){var n=_v3B.copy(this._nearPlaneCorners[i]),n=(n.applyMatrix4(_rotationMatrix),_v3C.addVectors(this._target,n)),n=(_raycaster.set(n,r),_raycaster.far=e,_raycaster.intersectObjects(this.colliderMeshes));0!==n.length&&n[0].distance<e&&(e=n[0].distance)}}return e},e.prototype._getClientRect=function(e){var t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.z=this._viewport.z,e.w=this._viewport.w):(e.z=t.width,e.w=t.height),e},e.prototype._removeAllEventListeners=function(){},e}(EventDispatcher$1);function createBoundingSphere(e,t){var o=t.center,s=(e.traverse(function(e){e.isMesh&&_box3A.expandByObject(e)}),_box3A.getCenter(o),0);return e.traverse(function(e){if(e.isMesh){var t=e.geometry.clone();if(t.applyMatrix4(e.matrixWorld),t.isBufferGeometry)for(var r=0,i=(n=t.attributes.position).count;r<i;r++)_v3A.fromBufferAttribute(n,r),s=Math.max(s,o.distanceToSquared(_v3A));else for(var n=t.attributes.position,a=new THREE$1.Vector3,r=0,i=n.count;r<i;r++)a.fromBufferAttribute(n,r),s=Math.max(s,o.distanceToSquared(a))}}),t.radius=Math.sqrt(s),t}class Marker extends EventEmitter{constructor(e){super(),this.id=void 0,this.HTMLElement=void 0,this._position=void 0,this._distance=void 0,this._occlusion=void 0,checkPropTypes(e,{position:Vector3,HTMLElement:HTMLElement,view:View},{name:"string",blockInstance:BlockInstance}),this.addEvent("occlusionchange"),this.id=v4(),e.name&&(this.name=e.name),e.blockInstance&&(this._blockInstance=e.blockInstance),this._position=e.position,this.view=e.view,this.HTMLElement=e.HTMLElement,this.CSS2DObject=new CSS2DObject(this.HTMLElement),this.CSS2DObject.position.copy(this._position),this.CSS2DObject.name="marker",this.CSS2DObject.visible=!0,this.relinkObject3D()}get position(){return this._position}get distance(){return this._distance}get occlusion(){return this._occlusion}relinkObject3D(){if(this._blockInstance){var e=this._blockInstance._content.main.medium;if(!e)return console.warn("Could not find scene object for "+this._blockInstance.label),this.clear();this.sceneParent=e}else this.sceneParent=this.view.scene;this.sceneParent.add(this.CSS2DObject)}update(){var e=this.view.perspectiveCamera.position.clone().sub(this._position).normalize(),e=(this.view.rayCaster.set(this._position,e),this._distance=this._position.distanceTo(this.view.perspectiveCamera.position),this.view.rayCaster.intersectObjects(this.view.scene.children,!0)),e=0<e.length;e!==this._occlusion&&(this._occlusion=e,this.emit("occlusionchange",this.occlusion))}clear(){this.sceneParent.remove(this.CSS2DObject)}}class Configurator extends Actor{constructor(e,t){super(e,t),this._loadingQuality="medium",this.initialConfigBuiltPromise=void 0,checkPropTypes(t,{pkg:Package},{configuration:Configuration,position:Vector3,quaternion:Quaternion}),this.pkg=t.pkg;let r=null;this.initialConfigBuiltPromise=new Promise(e=>r=e),this.initialConfigBuilt=!1,(new Group).name="Configurator Group";const i=t.configuration||new Configuration(this._reporter,{pkg:t.pkg,name:"Configurator autogenerated initial config",blockInstances:[]});i.build().then(()=>{this.updateBody(i.content.main.medium),r(),this.initialConfigBuilt=!0}),this._stateRegister=[{configuration:i,position:t.position||new Vector3,quaternion:t.quaternion||new Quaternion}],this.body.position.copy(this.state.position),this.body.quaternion.copy(this.state.quaternion)}async onStateCursorMoved(e){return"ready"!==e.configuration.status.main[this._loadingQuality]&&await e.configuration.build({part:"main",quality:this._loadingQuality,highPriority:!0}),this.updateBody(e.configuration.content.main[this._loadingQuality],e.quaternion,e.position,e.modTransform)}get options(){var e={...this.configuration.options,...this.configuration.instructions};return this._cursor<this._stateRegister.length-1&&(e.redo=this.redo.bind(this)),0<this._cursor&&(e.undo=this.undo.bind(this)),e}get configuration(){return this._stateRegister[this._cursor]?.configuration}get position(){return this._stateRegister[this._cursor].position}get quaternion(){return this._stateRegister[this._cursor].quaternion}async insert(e){var t=this.configuration.insert(e);return await this.update(t,`Inserted ${e.block.label} in step `+this.configuration.step),{...this.state}}async extend(e){var t=this.configuration.extend(e);return await this.update(t,`Extended with ${e.block.label} in step `+this.configuration.step),{...this.state}}async cut(e){var t=performance.now(),r={position:this.state.position,quaternion:this.state.quaternion},i=this.configuration.cut(e),n=this.calcPosCorrection(i.cut,this.configuration),a=(await this.update(i.main,`${this.configuration.label} after cutting out ${e.blockInstance.label} in step `+this.configuration.step),performance.now());return console.warn("Cut took "+(a-t)+" ms."),{main:this.state,cut:{configuration:i.cut,position:n.position.add(r.position),quaternion:n.quaternion.multiply(r.quaternion),description:`Cut out ${e.blockInstance.label} of ${this.configuration.label} step `+this.configuration.step}}}async split(e){var t=performance.now();const r={position:this.state.position,quaternion:this.state.quaternion};var i=this.configuration.split(e),n=this.calcPosCorrection(i.cut,this.configuration),a=i.split.map(e=>{var t=this.calcPosCorrection(e,this.configuration);return{configuration:e,position:t.position.add(r.position),quaternion:t.quaternion.multiply(r.quaternion),description:`Sibling chain of splitting ${this.configuration.label} step `+this.configuration.step}}),o=performance.now();return console.warn("Split took "+(o-t)+" ms."),{cut:{configuration:i.cut,position:n.position.add(r.position),quaternion:n.quaternion.multiply(r.quaternion),description:`Cut out ${e.blockInstance.label} when splitting ${this.configuration.label} step `+this.configuration.step},split:a}}async assignMaterial(e){this.state.position,this.state.quaternion;var t=this.configuration.assignMaterial(e);return await this.update(t,`${this.configuration.label} after assigning ${e.material.label} to ${e.blockInstance.label} in step `+this.configuration.step),t}async setTheme(e){var t=this.configuration.setTheme(e);return await this.update(t,`${this.configuration.label} after setting ${e.label} in step `+this.configuration.step),t}static get defaultPlacementObject(){return{position:new Vector3,quaternion:new Quaternion}}calcPosCorrection(e,t){var r,i=Configurator.defaultPlacementObject,n=[[new Quaternion,0]];for(r of e.blockInstances)if(t.placement[r.id]){const h=(new Quaternion).copy(t.placement[r.id].quaternion).conjugate().multiply(e.placement[r.id].quaternion);var a=n.find(e=>e[0].equals(h));a?a[1]+=1:n.push([h,1])}var o,s=n.sort((e,t)=>t[1]-e[1])[0][0],l=[[new Vector3,0]];for(o of e.blockInstances)if(t.placement[o.id]){const u=(new Vector3).subVectors(t.placement[o.id].position.clone().applyQuaternion(s),e.placement[o.id].position.clone().applyQuaternion(s));var c=l.find(e=>e[0].equals(u));c?c[1]+=1:l.push([u,1])}var d=l.sort((e,t)=>t[1]-e[1])[0][0];return i.position=d,i.quaternion=s,i}async update(e,t,r={}){if(!(e instanceof Configuration))throw new Error("Configurator update parameter is not an instance of Configuration");if(e.pkg!==this.pkg)throw new Error("Configuration is of a different package");var i=this.calcPosCorrection(e,this.configuration),e={configuration:e,position:i.position.add(this.position),quaternion:i.quaternion.multiply(this.quaternion),modTransform:r,description:t};return e.cleanUp=function({state:t,stateRegister:r,maxStateCount:i}){console.log("Configurator state clean up");let n=!1;for(let e=0;e<i;e+=1)r[e].configuration===t.configuration&&(n=!0);n||(console.log("Destroy old configuration"),t.configuration.destroy()),t.configuration=null}.bind(this),await this.addState({newState:e,moveCursor:!0}),this.options}merge(e,t,r){}async move(e,t){return await this.addState({newState:{configuration:this.configuration,position:e||this.position,quaternion:t||this.quaternion,description:"Moved configuration"},moveCursor:!0}),this.options}}class ConsoleLogger extends Logger{constructor(e,t){super(e,t)}log(e){var t=e.source.name?e.source.type+" "+e.source.name:e.source.type+" "+(e.source.id||"xxxx").substr(0,4);return console[ConsoleLogger.levelMap[e.level]](t+": "+e.msg)}}var defaultRendererSettings={name:"default renderer",precision:"highp",alpha:!0,antialias:!(ConsoleLogger.levelMap={emergency:"error",critical:"error",alert:"error",error:"error",warning:"warn",notice:"info",info:"log",debug:"debug"}),stencil:!1,preserveDrawingBuffer:!1,premultipliedAlpha:!0,logarithmicDepthBuffer:!1,toneMapping:ACESFilmicToneMapping,toneMappingExposure:1};CameraControls.install({THREE:THREE});class View extends InformationSource{constructor(e,t){super(e,t),this.cameraControlsAwake=!1,this.lastPointerDown={x:0,y:0,timestamp:0},this.lastPointerUp={x:0,y:0,timestamp:0},this.lastPointerMove={x:0,y:0},this.lastPerspectiveCameraPosition=new Vector3,this.lastPerspectiveCameraQuaternion=new Quaternion,this.scene=void 0,this.perspectiveCamera=void 0,this.rayCaster=new Raycaster,this.renderer=void 0,this.passes=void 0,this.renderPass=void 0,this.timer=void 0,this.domElement=void 0,this.domElementDimensions=void 0,this.tweens=void 0,this.camTween=void 0,this.selectionActive=!1,this.hideShadowOnDrag=!1,this.mouseoverMesh=void 0,this.mouseoverBlockInstance=void 0,this.mouseoverActor=void 0,this.intersect=function(e,t){e=Math.max(0,Math.min(1,(e-this.domElementDimensions.left)/this.domElementDimensions.width)),t=Math.max(0,Math.min(1,(t-this.domElementDimensions.top)/this.domElementDimensions.height)),e=new Vector2(2*e-1,2*-t+1);return this.rayCaster.layers.set(Project.layerMap.visibleActors),this.rayCaster.setFromCamera(e,this.perspectiveCamera),this.rayCaster.intersectObjects(this.scene.children,!0)},this.dimensionsVisible=!1,checkPropTypes(t,{scene:Scene,renderer:WebGLRenderer,rendererOrtho:WebGLRenderer,timer:Timer},{cameraSettings:Object,passes:t=>{if(!Array.isArray(t))return"Not an array";for(let e=0;e<t.length;e+=1){var r=t[e];if(!(r instanceof Pass))return`Entry ${e} is not a Pass but a `+r.constructor.name}return!0}}),this.markers={},this.dimensionFrames={},this.domElementDimensions,this.camTween=null,this.tweens={},this.scene=t.scene,t.renderer?this.renderer=t.renderer:(console.warn("no render settings have been specified, reverting to default render settings"),t.renderSettings?this.renderer=new WebGLRenderer(t.renderSettings):this.renderer=project.renderer),this.rendererOrtho=t.rendererOrtho,this.timer=t.timer,this.cameraSettings={...defaultCameraSettings,...t.cameraSettings||{}},this.perspectiveCamera=new PerspectiveCamera(this.cameraSettings.fov,this.cameraSettings.aspect,this.cameraSettings.near,this.cameraSettings.far),this.perspectiveCamera.layers.enable(Project.layerMap.shadowPlane),this.perspectiveCamera.layers.enable(Project.layerMap.visibleActors),this.perspectiveCamera.layers.disable(Project.layerMap.hiddenActors),this.orthographicCamera=new OrthographicCamera,this.domElement=document.createElement("div"),this.domElement.classList=["canvas-container"],this.domElement.appendChild(this.renderer.domElement),this.renderPass=new RenderPass(this.scene,this.perspectiveCamera),this.renderPass.name="Default Render Pass",this.outputPass=new OutputPass,this.passes=[this.renderPass,this.outputPass,...t.passes||[]],this.scene.add(this.perspectiveCamera),this.scene.add(this.orthographicCamera),this.css2dRenderer=new CSS2DRenderer,this.css2dRenderer.domElement.style.position="absolute",this.css2dRenderer.domElement.style.top="0px",this.css2dRenderer.domElement.style.outline="none",this.css2dRenderer.id="css2dRenderer",this.on("dimensionsupdate",e=>{this.css2dRenderer.setSize(e.width,e.height)}),this.domElement.appendChild(this.css2dRenderer.domElement),this.clock=new Clock,this.cameraControls=new CameraControls(this.perspectiveCamera,this.domElement);var r=this.cameraSettings?.maxPolarAngle??180;this.cameraControls.maxPolarAngle=MathUtils.degToRad(r),this.cameraControls.normalizeRotations(),this.cameraControls.addEventListener("control",e=>{this.timer.addUpdateRequest(this.id,"Camera controls control")}),this.cameraControls.addEventListener("controlstart",e=>{this.timer.addUpdateRequest(this.id,"Camera controls start")}),this.cameraControls.addEventListener("wake",e=>{this.cameraControlsAwake=!0,this.timer.addUpdateRequest(this.id,"Camera controls wake")}),this.cameraControls.addEventListener("sleep",e=>{this.cameraControlsAwake=!1,this.timer.removeUpdateRequest(this.id)}),this.cameraControls.setLookAt(-2,1,6,0,.3,0,!1),this.shadow=new ContactShadow(e,{scene:this.scene,camera:this.perspectiveCamera,renderer:this.renderer}),this.shadow._build(),this.scene.add(this.shadow._shadowGroup),this.scene.castShadow=!0,this.scene.receiveShadow=!0,this.shadow._update(),this.findConfigurator=t.findConfigurator,this.addConfigurator=t.addConfigurator,this.findComponentById=t.findComponentById,this.addEvent("touchstart"),this.addEvent("touchmove"),this.addEvent("touchend"),this.addEvent("touchcancel"),this.addEvent("click"),this.addEvent("dblclick"),this.addEvent("fastclick"),this.addEvent("pointerdown"),this.addEvent("pointerup"),this.addEvent("pointermove"),this.addEvent("dragenter"),this.addEvent("dragover"),this.addEvent("dragleave"),this.addEvent("drop"),this.addEvent("dragend"),this.addEvent("componentDragEnter"),this.addEvent("componentDragLeave"),this.addEvent("blockinstancehover"),this.addEvent("componenthoverstart"),this.addEvent("componenthoverend"),this.addEvent("dimensionsupdate");const i=this.emitIntersectedBlocks.bind(this,["componenthoverstart","componenthoverend"]);this.emitIntersectedBlocks.bind(this,["componentdragenter","componentdragleave"]);this.on("listenerChange",({event:e,listenerObject:t})=>{switch(e){case"blockinstancehover":case"componenthoverstart":case"componenthoverend":0<Object.keys(t).length?this.domElement.addEventListener("pointermove",i):this.domElement.removeEventListener("pointermove",i)}}),this.domElement.addEventListener("click",this.onClick.bind(this)),document.addEventListener("pointerup",this.onPointerUp.bind(this)),document.addEventListener("pointerdown",this.onPointerDown.bind(this)),document.addEventListener("pointermove",this.onPointerMove.bind(this)),this.domElement.addEventListener("dragenter",this.onDragEnter.bind(this)),this.domElement.addEventListener("dragover",this.onDragOver.bind(this)),document.addEventListener("drop",this.onDrop.bind(this)),document.addEventListener("dragleave",this.onDragLeave.bind(this)),document.addEventListener("dragend",this.onDragEnd.bind(this)),document.addEventListener("componentdragenter",this.onComponentDragEnter.bind(this)),document.addEventListener("componentdragleave",this.onComponentDragLeave.bind(this)),window.addEventListener("resize",this.updateDOMElementDimensions.bind(this)),document.addEventListener("keyup",this.onKeyUp.bind(this)),this.rebuildComposer(),setTimeout(this.updateDOMElementDimensions.bind(this),1)}updateDOMElementDimensions(){var e=this.domElement.getBoundingClientRect();e.width=e.right-e.left,e.halfWidth=e.width/2,e.height=e.bottom-e.top,e.halfHeight=e.height/2,this.domElementDimensions=e,this.perspectiveCamera.aspect=e.width/e.height,this.perspectiveCamera.updateProjectionMatrix(),this.orthographicCamera.left=e.width/-2,this.orthographicCamera.right=e.width/2,this.orthographicCamera.top=e.height/2,this.orthographicCamera.bottom=e.height/-2,this.orthographicCamera.near=.1,this.orthographicCamera.far=1e3,this.orthographicCamera.position.set(0,0,10),this.renderer.setSize(e.width,e.height),this.rendererOrtho.setSize(e.width,e.height),this.shadow._update(),this.rebuildComposer(),this.timer.trigger(),this.emit("dimensionsupdate",this.domElementDimensions)}prependPass(e){this.passes=[e,...this.passes],this.rebuildComposer()}appendPass(e){this.passes=[...this.passes,e],this.rebuildComposer()}rebuildComposer(){this.composer=new EffectComposer(this.renderer);for(var e of this.passes)this.composer.addPass(e)}tween(e,t=250,r=Tween.easeInOutCubic){this.camTween instanceof Tween&&(this.camTween.stop(),this.camTween=null);const i=new Tween(t,e,r);(this.camTween=i).on("stop",()=>{delete this.tweens[i.id]})}focusOn(e,t,r,i){}onSceneUpdate(e){Object.values(this.markers).forEach(e=>e.relinkObject3D());for(var t of Object.values(this.dimensionFrames))t.onSceneUpdate();this.update()}update(){this.lastPerspectiveCameraPosition.copy(this.perspectiveCamera.position),this.lastPerspectiveCameraQuaternion.copy(this.perspectiveCamera.quaternion);var e,t,r,i=this.clock.getDelta(),i=this.cameraControls.update(i);for(e of Object.values(this.tweens))e.update();this.render();for(t of Object.values(this.markers))t.update();for(r of Object.values(this.dimensionFrames))r.update();1e-4<this.lastPerspectiveCameraPosition.distanceTo(this.perspectiveCamera.position)||i?this.timer.hasRequestId(this.id)||this.timer.addUpdateRequest(this.id):this.timer.hasRequestId(this.id)&&this.timer.removeUpdateRequest(this.id)}render(){this.composer.render(this.scene,this.perspectiveCamera),this.css2dRenderer.render(this.scene,this.perspectiveCamera)}renderOrtho(){this.composer.renderer.render(this.scene,this.orthographicCamera),this.css2dRenderer.render(this.scene,this.orthographicCamera)}onTouchStart(e){console.log("touch start")}onTouchMove(e){}onTouchEnd(e){}onTouchCancel(e){}onClick(e){var t;this.dragActive=!1,0<Object.keys(this._events.click).length&&((t=this.findFirstIntersectedBlockInstance()||{}).event=e,this.emit("click",t))}onDoubleClick(e){var t;0<Object.keys(this._events.click).length&&((t=this.findFirstIntersectedBlockInstance()||{}).event=e,this.emit("dblClick",t))}onPointerDown(e){}onPointerMove(e){}onPointerUp(e){}async onDragEnter(e){}async onDragOver(e){}async onDrop(e){}onDragLeave(e){}onDragEnd(){}onComponentDragEnter(e){console.log("componentdragenter")}onComponentDragLeave(e){Object.keys(listenerObject).length}onKeyUp(e){}emitIntersectedBlocks([e,t]){var r,i=this.findFirstIntersectedBlockInstance();i?(r=i.blockInstance,this.mouseoverActor!==r.tree&&(this.mouseoverActor&&this.emit(t,{component:this.mouseoverActor}),this.mouseoverActor=r.tree,this.emit(e,{component:r.tree})),this.mouseoverBlockInstance!==r&&(this.mouseoverBlockInstance&&this.emit(t,{component:this.mouseoverBlockInstance}),this.mouseoverBlockInstance=r,this.emit(e,{component:r,...i})),this.emit("blockinstancehover",r)):(void 0!==this.mouseoverActor&&(this.emit(t,{component:this.mouseoverActor}),this.mouseoverActor=void 0),void 0!==this.mouseoverBlockInstance&&(this.emit(t,{component:this.mouseoverBlockInstance}),this.mouseoverBlockInstance=void 0),void 0!==this.mouseoverMesh&&(this.emit(t,{component:this.mouseoverMesh}),this.mouseoverMesh=void 0))}findFirstIntersectedBlockInstance(){var e=this.intersect(this.lastPointerMove.x,this.lastPointerMove.y);return View.findBlockInstanceParent(e)}findFirstIntersectedConfiguration(){var e=this.intersect(this.lastPointerMove.x,this.lastPointerMove.y);return View.findConfigurationParent(e)}static findBlockInstanceParent(e,t=0){for(var r of e)if(r.object.userData.PB){if("blockInstance"===r.object.parent.userData.PB.type)return{blockInstanceId:r.object.parent.userData.PB.origin,blockInstance:r.object.parent.userData.PB.blockInstance,intersection:r};if(r.object.parent.parent.userData.PB&&"blockInstance"===r.object.parent.parent.userData.PB.type)return{blockInstanceId:r.object.parent.parent.userData.PB.origin,blockInstance:r.object.parent.parent.userData.PB.blockInstance,intersection:r}}}findConfigurationParent(e,t=0){for(var r of e)r.object.userData.PB&&r.object.parent.userData.PB.type}async addMarker({position:e,HTMLElement:t,blockInstance:r,name:i}){e=new Marker({position:e,HTMLElement:t,blockInstance:r,view:this,name:i});return this.markers[e.id]=e,await new Promise(e=>{this.timer.once("update",e),this.timer.trigger()}),e}async adddimensionFrame(e){e=new DimensionFrame(e,this);return this.dimensionFrames[e.id]=e,await new Promise(e=>{this.timer.once("update",e),this.timer.trigger()}),e}removeMarker(e){console.assert(e instanceof Marker,"Argument is not an instance of Marker",e),e.clear(),delete this.markers[e.id]}removeAllMarkers(){Object.values(this.markers).forEach(this.removeMarker.bind(this))}expectDrag(e){}rotateTo(e){var t=.1667*Math.PI,r=.25*Math.PI,i=.4*Math.PI,n=.5*Math.PI,a=Math.PI;switch(e){case"front":this.cameraControls.rotateTo(0,n,!0);break;case"back":this.cameraControls.rotateTo(a,n,!0);break;case"top":this.cameraControls.rotateTo(0,0,!0);break;case"bottom":this.cameraControls.rotateTo(0,a,!0);break;case"right":this.cameraControls.rotateTo(n,n,!0);break;case"left":this.cameraControls.rotateTo(-n,n,!0);break;case"front-angle":this.cameraControls.rotateTo(0,r,!0);break;case"right-angle":this.cameraControls.rotateTo(t,i,!0);break;case"left-angle":this.cameraControls.rotateTo(-t,i,!0)}}zoomBlock(e){}zoomConfiguration(e){}getAllActors(){const t=[];return this.scene.traverse(function(e){"Actor"===e.name&&t.push(e)}),t}zoomExtents(e=!0){this.update();this.getAllActors();var t=new Box3;for(const n of project.configurators)!0===n.visible&&t.expandByObject(n.body);var r=this.cameraControls.polarAngle;const i=MathUtils.radToDeg(this.cameraControls.azimuthAngle)%360;this.timer.trigger(),this.cameraControls.reset(e),this.cameraControls.fitToBox(t,e,{paddingTop:.3,paddingLeft:.3,paddingBottom:.3,paddingRight:.3}),this.cameraControls.rotateTo(MathUtils.degToRad(i<0&&-180<i?i:i<0&&i<-180?i+360:0<i&&i<180?i:0<i&&180<i?i-360:0),r,e)}zoomScene(){this.update();for(var e=this.getAllActors(),t=new Box3,r=0;r<e.length;r++)t.expandByObject(e[r]);var i=(new Vector3).subVectors(t.max,t.min),i=new(void 0)(i.x,i.y,i.z),i=new Mesh(i,new MeshBasicMaterial({color:16763989}));this.timer.trigger(),this.cameraControls.fitToSphere(i,!0)}zoomTop(){this.update();for(var e=this.getAllActors(),t=new Box3,r=0;r<e.length;r++)t.expandByObject(e[r]);this.timer.trigger(),this.cameraControls.reset(!0),this.rotateTo("top"),this.cameraControls.rotateTo(0,0,!0),this.cameraControls.fitToBox(t,!0,{paddingTop:.3,paddingLeft:.3,paddingBottom:.3,paddingRight:.3})}toggleBoundingBoxes(){this.perspectiveCamera.layers.toggle(2),this.update()}showBoundingBoxes(e){this.scene.traverse(function(e){e instanceof Box3Helper&&(e.visible=!1),"Vertex Helper"===e.name&&(e.visible=!1)});for(var t of e.content.main.medium.children)t instanceof Box3Helper&&(t.visible=!0);this.perspectiveCamera.layers.enable(2),this.update()}hideBoundingBoxes(){this.perspectiveCamera.layers.disable(2),this.update()}toggleDimensions(){let t;return this.perspectiveCamera.layers.toggle(3),this.scene.traverse(function(e){e instanceof CSS2DObject&&"dimLabel"===e.name&&(t=!1===e.visible?e.visible=!0:e.visible=!1)}),this.update(),t}showDimensions(){this.perspectiveCamera.layers.enable(3);for(const e of project.configurators)e.visible&&e.body.traverse(function(e){e instanceof CSS2DObject&&"dimLabel"===e.name&&!1===e.visible&&(e.visible=!0),"dimLine"===e.name&&!1===e.visible&&(e.visible=!0)});this.dimensionsVisible=!0,this.update()}hideDimensions(){this.perspectiveCamera.layers.disable(3),this.scene.traverse(function(e){e instanceof CSS2DObject&&"dimLabel"===e.name&&!0===e.visible&&(e.visible=!1),"dimLine"===e.name&&!0===e.visible&&(e.visible=!1)}),this.dimensionsVisible=!1,this.update()}project(e,t){t=void 0!==t?t:this.perspectiveCamera,console.assert(e instanceof Vector3,"Position should be a THREE.Vector3"),console.assert(t instanceof Camera,"Camera should be a THREE.Camera instance");t=e.project(this.perspectiveCamera);return{x:(t.x+1)/2*this.domElementDimensions.width,y:-(t.y-1)/2*this.domElementDimensions.height}}}var GammaCorrectionShader={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 tex = texture2D( tDiffuse, vUv );","\tgl_FragColor = LinearTosRGB( tex );","}"].join("\n")};const fxaaShader=new ShaderPass(FXAAShader),gammaCorrectionShader=new ShaderPass(GammaCorrectionShader);class DefaultView extends View{constructor(e,t){super(e,{...t,cameraSettings:{fov:30,aspect:window.innerWidth/window.innerHeight,near:.5,far:100},passes:[fxaaShader,gammaCorrectionShader]}),this.eventHandlerStates={_onPointerDownActive:!1,get active(){return this._active},set onPointerDownActive(e){this._onPointerDownActive=e}},this.dragState={_active:!1,get active(){return this._active},set active(e){this._active=e},_enter:!1,get enter(){return this._enter},set enter(e){this._enter=e},_leave:!1,get leave(){return this._leave},set leave(e){this._leave=e},_over:!1,get over(){return this._over},set over(e){this._over=e}},this.expectedComponentDrag=null,this.matOptions=[],checkPropTypes(t,{scene:Scene,renderer:WebGLRenderer,timer:Timer},{cameraSettings:Object,passes:t=>{if(!Array.isArray(t))return"Not an array";for(let e=0;e<t.length;e+=1){var r=t[e];if(!r instanceof Pass)return`Entry ${e} is not a Pass but a `+r.constructor.name}return!0}}),this.dragObject=null,this.dragging=!1,this.allMeshes=[],this.layerMap=Project.layerMap,this.onMouseDownActive=!1,this.shift=new Vector3,this.intersects=new Vector3,this.exrBackground=null,this.pixelRatio=this.renderer.getPixelRatio(),this.on("dimensionsupdate",e=>{fxaaShader.uniforms.resolution.value.x=1/(e.width*this.pixelRatio),fxaaShader.uniforms.resolution.value.y=1/(e.height*this.pixelRatio)}),fxaaShader.name="FXAA Pass",gammaCorrectionShader.name="Gamma Correction Pass",this.renderer.setClearColor(16777215,1),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=PCFSoftShadowMap,this.renderer.antialias=!1,this.renderer.gammaFactor=1.8,this.renderer.physicallyCorrectLights=!0,this.renderer.logarithmicDepthBuffer=!0,this.perspectiveCamera.position.set(-2,1,5),this.directionalLight=new DirectionalLight(16777215,3),this.directionalLight.position.set(-30,65,50),this.directionalLight.shadow.mapSize.width=512,this.directionalLight.shadow.mapSize.height=512,this.directionalLight.shadow.camera.near=.5,this.directionalLight.shadow.camera.far=500;this.directionalLight2=this.directionalLight.clone(),this.directionalLight.castShadow=!0,this.directionalLight2.castShadow=!1,this.directionalLight.intensity=2.7,this.directionalLight2.intensity=3.3,this.directionalLightLeft=this.directionalLight.clone(),this.directionalLightLeft.position.set(50,50,40),this.directionalLightLeft.castShadow=!0,this.directionalLightLeft.intensity=1.8,this.directionalLightBack=this.directionalLight.clone(),this.directionalLightBack.position.set(0,50,-50),this.directionalLightBack.castShadow=!1,this.directionalLightBack.intensity=1.5,this.scene.add(this.directionalLight),this.scene.add(this.directionalLight2),this.scene.add(this.directionalLightLeft),this.scene.add(this.directionalLightBack),this.mouse=new Vector2,this.intersectionPlane=new Plane,this.intersectionPlane.setFromCoplanarPoints(new Vector3,new Vector3(1,0,0),new Vector3(0,0,1)),this.intersectionPlaneNormal=new Vector3(0,1,0),this.pointOfIntersection=new Vector3,this.dragPlane=new Plane,this.dragPlane.setFromCoplanarPoints(new Vector3,new Vector3(1,0,0),new Vector3(0,0,1)),this.dragPlaneNormal=new Vector3(0,1,0),this.shift=new Vector3,this.dragging=!1,this.dragObject=null,this.pointOfIntersection=new Vector3,this.onPointerDownActive=!1,this.onTouchStartActive=!1}onTouchStart(e){var t;this.dragState.active||(this.onPointerDownActive=!1,this.onTouchStartActive=!0,this.lastPointerMove={x:e.touches[0].clientX,y:e.touches[0].clientY,timestamp:(new Date).getTime()},(t=this.findFirstIntersectedBlockInstance()||{}).event=e,this.emit("pointerdown",t),e=this.intersect(this.lastPointerMove.x,this.lastPointerMove.y),t.blockInstance instanceof BlockInstance?(this.selectionActive=!0,this.cameraControls.enabled=!1,t=this.findConfigurator(t.blockInstance.tree),this.dragObject=t,this.dragPlane.setFromNormalAndCoplanarPoint(this.dragPlaneNormal,e[0].point),this.shift.subVectors(this.dragObject.body.position,e[0].point)):(this.dragObject=null,this.hideBoundingBoxes(),this.selectionActive=!1,this.cameraControls.enabled=!0),this.update())}onTouchMove(e){console.log("touch move"),this.dragState.active||(this.lastPointerMove.x=e.touches[0].clientX,this.lastPointerMove.y=e.touches[0].clientY,void 0===this.domElementDimensions&&this.updateDOMElementDimensions(),this.intersect(this.lastPointerMove.x,this.lastPointerMove.y),this.onTouchStartActive?this.dragObject instanceof Configurator&&(!1===this.hideShadowOnDrag&&(this.shadow._update([this.dragObject.body]),this.hideShadowOnDrag=!0),this.rayCaster.ray.intersectPlane(this.dragPlane,this.pointOfIntersection),this.dragObject.body.position.copy(this.pointOfIntersection).add(this.shift),this.dragObject.body.position.setY(0),this.update()):this.hideShadowOnDrag=!1)}onTouchEnd(e){var t;console.log("touch end"),this.dragState.active||(this.hideShadowOnDrag=!1,this.onPointerDownActive=!1,this.onTouchStartActive=!1,this.cameraControls.enabled=!0,this.lastPointerUp={x:this.lastPointerMove.x,y:this.lastPointerMove.y,timestamp:(new Date).getTime()},this.dragObject instanceof Configurator?(this.selectionActive=!0,(t=this.dragObject).position.copy(this.dragObject.body.position),t.position.setY(0)):(this.selectionActive=!1,this.dragObject=null),this.dragObject=null,this.shadow._update(),this.update())}onTouchCancel(e){console.log("touch cancel"),this.onTouchCancelActive=!0}onClick(e){this.dragState.active=!1,this.onPointerDownActive=!1,super.onClick()}onDoubleClick(e){console.log("double click"),this.dragState.active=!1,this.onPointerDownActive=!1,super.onDoubleClick()}onPointerDown(e){var t;console.log("viewport pointer down"),this.dragState.active||(this.onPointerDownActive=!0,this.lastPointerDown={x:this.lastPointerMove.x,y:this.lastPointerMove.y,timestamp:(new Date).getTime()},(t=this.findFirstIntersectedBlockInstance()||{}).event=e,this.emit("pointerdown",t),e=this.intersect(this.lastPointerDown.x,this.lastPointerDown.y),t.blockInstance instanceof BlockInstance?(this.selectionActive=!0,this.cameraControls.enabled=!1,t=this.findConfigurator(t.blockInstance.tree),this.dragObject=t,this.dragPlane.setFromNormalAndCoplanarPoint(this.dragPlaneNormal,e[0].point),void 0!==e[0]&&void 0!==this.dragObject&&this.shift.subVectors(this.dragObject.body.position,e[0].point)):(this.dragObject=null,this.hideBoundingBoxes(),this.selectionActive=!1,this.cameraControls.enabled=!0),this.update())}onPointerMove(e){this.dragState.active||(this.lastPointerMove.x=e.clientX,this.lastPointerMove.y=e.clientY,void 0===this.domElementDimensions&&this.updateDOMElementDimensions(),this.intersect(this.lastPointerMove.x,this.lastPointerMove.y),this.onPointerDownActive?this.dragObject instanceof Configurator&&(!1===this.hideShadowOnDrag&&(this.shadow._update([this.dragObject.body]),this.hideShadowOnDrag=!0),this.rayCaster.ray.intersectPlane(this.dragPlane,this.pointOfIntersection),this.shift.y=0,this.pointOfIntersection.y=0,this.dragObject.body.position.copy(this.pointOfIntersection).add(this.shift),this.dragObject.body.position.setY(0),this.update()):this.hideShadowOnDrag=!1)}onPointerUp(e){var t;this.dragState.active||(this.hideShadowOnDrag=!1,this.onPointerDownActive=!1,this.cameraControls.enabled=!0,this.lastPointerUp={x:this.lastPointerMove.x,y:this.lastPointerMove.y,timestamp:(new Date).getTime()},this.dragObject instanceof Configurator?(this.selectionActive=!0,(t=this.dragObject).position.copy(this.dragObject.body.position),t.position.setY(0)):(this.selectionActive=!1,this.dragObject=null),this.shadow._update(),this.update())}expectComponentDrag(e){this.dragState.active=!0,this.dragState.leave=!1,this.dragState.over=!1,console.assert(e instanceof Component,"expectComponentDrag -> entered component needs to be an instance of the class Component!"),this.expectedComponentDrag&&(console.warn("Another component drag is still being expected... cancelling that one"),this.expectedComponentDrag.reject("A newer component expectation has made this one obsolete"));let r,i=null;var t=new Promise((e,t)=>{r=e,i=t});t.catch(e=>{console.error("Error in expected component drag chain:",e)}).finally(()=>{this.expectedComponentDrag=null}),this.expectedComponentDrag={component:e,promise:t,resolve:r,reject:i};const n=this;return this.expectedComponentDrag&&(this.expectedComponentDrag.timeout=setTimeout(function(){n.expectedComponentDrag.reject("Timeout")},2e3)),t}checkDrag(e){}async onDragEnter(e){if(e.preventDefault(),this.shift=new Vector3,this.hideDimensions(),this.dragState.active)if(this.dragState.leave)this.lastPointerMove.x=e.clientX,this.lastPointerMove.y=e.clientY,this.dragState.leave=!1,this.dragState.over=!1;else{this.dragState.enter=!0,this.dragState.leave=!1,this.dragState.over=!1,this.onPointerDownActive,this.cameraControls.enabled=!1,this.lastPointerMove.x=e.clientX,this.lastPointerMove.y=e.clientY;var t=this.expectedComponentDrag.component;if(t)switch(t.build(),clearTimeout(this.expectedComponentDrag.timeout),t.constructor){case WrappedMaterial:this.dragObject=t;break;case Block:var r=new Configuration(new Reporter,{pkg:t.tree,blockInstances:[new BlockInstance(new Reporter,{block:t})]}),r=(await r.build(),await this.addConfigurator({pkg:t.tree,configuration:r})),r=(this.dragObject=r,this.expectedComponentDrag.createdConfigurator=r,this.expectedComponentDrag.promise.catch(e=>{throw new Error(e)}),this.intersect(this.lastPointerMove.x,this.lastPointerMove.y));void 0!==r[0]&&this.dragPlane.setFromNormalAndCoplanarPoint(this.dragPlaneNormal,r[0].point),this.rayCaster.ray.intersectPlane(this.dragPlane,this.pointOfIntersection),this.dragObject.body.position.copy(this.pointOfIntersection),this.dragObject.body.position.setY(0),this.scene.add(this.dragObject.body),this.shadow._update([this.dragObject.body]),this.update();break;case Configuration:await t.build();r=await this.addConfigurator({pkg:t.tree.pkg,configuration:t}),r=(this.dragObject=r,this.expectedComponentDrag.createdConfigurator=r,this.expectedComponentDrag.promise.catch(e=>{throw new Error(e)}),this.intersect(this.lastPointerMove.x,this.lastPointerMove.y));this.dragPlane.setFromNormalAndCoplanarPoint(this.dragPlaneNormal,r[0].point),this.rayCaster.ray.intersectPlane(this.dragPlane,this.pointOfIntersection),this.dragObject.body.position.copy(this.pointOfIntersection),this.dragObject.body.position.setY(0),this.scene.add(this.dragObject.body),this.shadow._update([this.dragObject.body]),this.update();break;default:this.expectedComponentDrag.reject("Unknown onDragEnter expected component constructor "+this.expectedComponentDrag.component.constructor.name)}}else console.warn("DragEnter event received, but dragState = ",this.dragState)}async onDragOver(e){this.dragState.active&&(e.preventDefault(),this.lastPointerMove.x=e.clientX,this.lastPointerMove.y=e.clientY,!1===this.dragState.over&&(this.dragState.enter&&this.shadow._update([this.dragObject.body]),this.update(),this.dragState.over=!0),this.intersect(this.lastPointerMove.x,this.lastPointerMove.y),this.rayCaster.ray.intersectPlane(this.dragPlane,this.pointOfIntersection),this.dragObject instanceof Configurator&&(this.dragObject.body.position.copy(this.pointOfIntersection),this.dragObject.body.position.setY(0)),this.update())}async onDrop(t){if(this.dragState.active){t.preventDefault();t.dataTransfer.getData("text");if(this.onPointerDownActive=!1,this.cameraControls.enabled=!0,this.dragObject)switch(this.dragObject.constructor){case WrappedMaterial:var r=this.findFirstIntersectedBlockInstance()||{},i=(r.event=t,this.findConfigurator(r.blockInstance.tree));this.matOptions=i.configuration.options.material(this.dragObject);const n=r.intersection?.object?.userData?.PB?.assignable;let e=null;n&&(e=this.matOptions.find(e=>e.assignable===n))?this.domElement.style.cursor="cell":this.domElement.style.cursor="no-drop";r=i.configuration.assignMaterial(e);await i.update(r),this.expectedComponentDrag.resolve(r);break;case Configurator:this.intersect(this.lastPointerMove.x,this.lastPointerMove.y),this.rayCaster.ray.intersectPlane(this.dragPlane,this.pointOfIntersection),this.pointOfIntersection.y=0,this.dragObject.body.position.copy(this.pointOfIntersection),this.dragObject.position.copy(this.dragObject.body.position),this.expectedComponentDrag.resolve(this.expectedComponentDrag.createdConfigurator.configuration);break;default:this.expectedComponentDrag.reject("Unknown onDrop expected component constructor "+this.expectedComponentDrag.component.constructor.name)}this.shadow._update(),this.update(),this.dragState.active=!1,this.dragState.enter=!1,this.dragState.leave=!1,this.dragState.over=!1,this.selectionActive=!0}}onDragLeave(e){this.dragState.active&&(e.preventDefault(),this.dragState.enter&&(this.dragState.enter=!1,this.dragState.leave=!0,this.dragState.over=!1),this.update())}onDragEnd(){this.dragState.active&&(this.cameraControls.enabled=!0,this.dragObject?this.selectionActive=!0:(this.selectionActive=!1,this.dragObject=null),this.dragState.leave&&this.expectedComponentDrag.reject("The drag event has left the window with a drop event"),this.dragState.active=!1,this.dragState.enter=!1,this.dragState.over=!1,this.dragState.leave=!1,this.shadow._update(),this.update())}onComponentDragLeave(e){Object.keys(listenerObject).length}onKeyUp(e){var t=e.which||e.keyCode;e.shiftKey&&67===t&&this.dragObject&&this.rotateSelection(this.dragObject),67===t&&this.toggleConnectorHelpers()}rotateSelection(e){e instanceof Configurator?(e.move(e.body.position,e.quaternion.multiply((new Quaternion).setFromEuler(new Euler(0,Math.PI/2,0)))),this.shadow._update(),this.update()):e instanceof Block&&((e=this.findConfigurator(e.tree)).move(e.body.position,e.quaternion.multiply((new Quaternion).setFromEuler(new Euler(0,Math.PI/2,0)))),this.shadow._update(),this.update())}update(){super.update()}onSceneUpdate(...e){this.dragState.active||this.shadow._update(),super.onSceneUpdate(...e)}toggleConnectorHelpers(){this.scene.traverse(function(e){if("Actor"===e.name)for(var t of e.userData.origin.configuration.connectors){var t=t.connector._settings.position,r=new BoxGeometry(.1,.1,.1),i=new MeshBasicMaterial,r=new Mesh(r,i);r.position.copy(t),scene.add(r)}})}}class SingleBlockInstance extends Actor{constructor(e,t){super(e,t),checkPropTypes(t,{blockInstance:BlockInstance,loader:ComponentLoader},{position:Vector3,quaternion:Quaternion}),this.blockInstance=t.blockInstance,this.block=t.blockInstance.block,this.blockInstance.build({componentLoader:t.loader}).then(()=>{this.updateBody(t.blockInstance.content.main.medium),t.position&&this.body.position.copy(t.position),t.quaternion&&this.body.quaternion.copy(t.quaternion)}),this._stateRegister=[{position:this.body.position.clone(),quaternion:this.body.quaternion.clone()}]}toJSON(){return{block:this.block.id,position:Component.unlink(this.body.position),quaternion:Component.unlink(this.body.quaternion)}}async onStateCursorMoved(e){}}const GammaCorrectionShader$1={name:"GammaCorrectionShader",uniforms:{tDiffuse:{value:null}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 tex = texture2D( tDiffuse, vUv );

			gl_FragColor = LinearTosRGB( tex );

		}`};class Composer{constructor(e,t){this._renderer=new WebGLRenderer({antialias:!1,alpha:!0,preserveDrawingBuffer:!0,precision:"highp",premultipliedAlpha:!0,stencil:!1,logarithmicDepthBuffer:!1,toneMapping:LinearToneMapping,toneMappingExposure:1,toneMappingWhitePoint:1,gammaFactor:1,outputEncoding:LinearEncoding,minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,stencilBuffer:!1,type:FloatType}),checkPropTypes(t,{},{scene:Scene,camera:Camera}),this._scene=t.scene,this._camera=t.camera,this._renderer.setPixelRatio(window.devicePixelRatio),console.info(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>")}async build(e){console.log(e);var t=new RenderPass(this._scene,this._camera),r=(t.name=" Render Pass",t.clearAlpha=1,e.getPixelRatio()),i=new ShaderPass(FXAAShader);i.uniforms.resolution.value.x=1/(window.innerWidth*r),i.uniforms.resolution.value.y=1/(window.innerHeight*r),i.name="FXAA Pass";new ShaderPass(GammaCorrectionShader$1).name="Gamma Corretion Pass";r=new EffectComposer(e);return r.addPass(t),r.addPass(i),this._composer=r,this}}var extendStatics$1=function(e,t){return(extendStatics$1=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])}))(e,t)};function __extends$1(e,t){function r(){this.constructor=e}extendStatics$1(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function __awaiter(a,o,s,l){return new(s=s||Promise)(function(e,t){function r(e){try{n(l.next(e))}catch(e){t(e)}}function i(e){try{n(l.throw(e))}catch(e){t(e)}}function n(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(r,i)}n((l=l.apply(a,o||[])).next())})}function __generator(i,n){var a,o,s,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(r){return function(e){var t=[r,e];if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,o&&(s=2&t[0]?o.return:t[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,t[1])).done)return s;switch(o=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(s=0<(s=l.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3]))l.label=t[1];else if(6===t[0]&&l.label<s[1])l.label=s[1],s=t;else{if(!(s&&l.label<s[2])){s[2]&&l.ops.pop(),l.trys.pop();continue}l.label=s[2],l.ops.push(t)}}t=n.call(i,l)}catch(e){t=[6,e],o=0}finally{a=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}}for(var Bounds=function(){function n(e,t,r,i){this.left=e,this.top=t,this.width=r,this.height=i}return n.prototype.add=function(e,t,r,i){return new n(this.left+e,this.top+t,this.width+r,this.height+i)},n.fromClientRect=function(e){return new n(e.left,e.top,e.width,e.height)},n}(),parseBounds=function(e){return Bounds.fromClientRect(e.getBoundingClientRect())},parseDocumentSize=function(e){var t,r=e.body,e=e.documentElement;if(r&&e)return t=Math.max(Math.max(r.scrollWidth,e.scrollWidth),Math.max(r.offsetWidth,e.offsetWidth),Math.max(r.clientWidth,e.clientWidth)),r=Math.max(Math.max(r.scrollHeight,e.scrollHeight),Math.max(r.offsetHeight,e.offsetHeight),Math.max(r.clientHeight,e.clientHeight)),new Bounds(0,0,t,r);throw new Error("Unable to get document size")},toCodePoints=function(e){for(var t=[],r=0,i=e.length;r<i;){var n,a=e.charCodeAt(r++);55296<=a&&a<=56319&&r<i?56320==(64512&(n=e.charCodeAt(r++)))?t.push(((1023&a)<<10)+(1023&n)+65536):(t.push(a),r--):t.push(a)}return t},fromCodePoint=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var r=e.length;if(!r)return"";for(var i=[],n=-1,a="";++n<r;){var o=e[n];o<=65535?i.push(o):i.push(55296+((o-=65536)>>10),o%1024+56320),(n+1===r||16384<i.length)&&(a+=String.fromCharCode.apply(String,i),i.length=0)}return a},chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup="undefined"==typeof Uint8Array?[]:new Uint8Array(256),i$2=0;i$2<chars.length;i$2++)lookup[chars.charCodeAt(i$2)]=i$2;var TokenType,decode=function(e){for(var t,r,i,n,a=.75*e.length,o=e.length,s=0,a=("="===e[e.length-1]&&(a--,"="===e[e.length-2])&&a--,new("undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?ArrayBuffer:Array)(a)),l=Array.isArray(a)?a:new Uint8Array(a),c=0;c<o;c+=4)t=lookup[e.charCodeAt(c)],r=lookup[e.charCodeAt(c+1)],i=lookup[e.charCodeAt(c+2)],n=lookup[e.charCodeAt(c+3)],l[s++]=t<<2|r>>4,l[s++]=(15&r)<<4|i>>2,l[s++]=(3&i)<<6|63&n;return a},polyUint16Array=function(e){for(var t=e.length,r=[],i=0;i<t;i+=2)r.push(e[i+1]<<8|e[i]);return r},polyUint32Array=function(e){for(var t=e.length,r=[],i=0;i<t;i+=4)r.push(e[i+3]<<24|e[i+2]<<16|e[i+1]<<8|e[i]);return r},UTRIE2_SHIFT_2=5,UTRIE2_SHIFT_1=11,UTRIE2_INDEX_SHIFT=2,UTRIE2_SHIFT_1_2=UTRIE2_SHIFT_1-UTRIE2_SHIFT_2,UTRIE2_LSCP_INDEX_2_OFFSET=65536>>UTRIE2_SHIFT_2,UTRIE2_DATA_BLOCK_LENGTH=1<<UTRIE2_SHIFT_2,UTRIE2_DATA_MASK=UTRIE2_DATA_BLOCK_LENGTH-1,UTRIE2_LSCP_INDEX_2_LENGTH=1024>>UTRIE2_SHIFT_2,UTRIE2_INDEX_2_BMP_LENGTH=UTRIE2_LSCP_INDEX_2_OFFSET+UTRIE2_LSCP_INDEX_2_LENGTH,UTRIE2_UTF8_2B_INDEX_2_OFFSET=UTRIE2_INDEX_2_BMP_LENGTH,UTRIE2_UTF8_2B_INDEX_2_LENGTH=32,UTRIE2_INDEX_1_OFFSET=UTRIE2_INDEX_2_BMP_LENGTH+UTRIE2_UTF8_2B_INDEX_2_LENGTH,UTRIE2_OMITTED_BMP_INDEX_1_LENGTH=65536>>UTRIE2_SHIFT_1,UTRIE2_INDEX_2_BLOCK_LENGTH=1<<UTRIE2_SHIFT_1_2,UTRIE2_INDEX_2_MASK=UTRIE2_INDEX_2_BLOCK_LENGTH-1,slice16=function(e,t,r){return e.slice?e.slice(t,r):new Uint16Array(Array.prototype.slice.call(e,t,r))},slice32=function(e,t,r){return e.slice?e.slice(t,r):new Uint32Array(Array.prototype.slice.call(e,t,r))},createTrieFromBase64=function(e){var e=decode(e),t=Array.isArray(e)?polyUint32Array(e):new Uint32Array(e),e=Array.isArray(e)?polyUint16Array(e):new Uint16Array(e),r=slice16(e,12,t[4]/2),e=2===t[5]?slice16(e,(24+t[4])/2):slice32(t,Math.ceil((24+t[4])/4));return new Trie(t[0],t[1],t[2],t[3],r,e)},Trie=function(){function e(e,t,r,i,n,a){this.initialValue=e,this.errorValue=t,this.highStart=r,this.highValueIndex=i,this.index=n,this.data=a}return e.prototype.get=function(e){var t;if(0<=e){if(e<55296||56319<e&&e<=65535)return t=this.index[e>>UTRIE2_SHIFT_2],this.data[t=(t<<UTRIE2_INDEX_SHIFT)+(e&UTRIE2_DATA_MASK)];if(e<=65535)return t=this.index[UTRIE2_LSCP_INDEX_2_OFFSET+(e-55296>>UTRIE2_SHIFT_2)],this.data[t=(t<<UTRIE2_INDEX_SHIFT)+(e&UTRIE2_DATA_MASK)];if(e<this.highStart)return t=this.index[t=UTRIE2_INDEX_1_OFFSET-UTRIE2_OMITTED_BMP_INDEX_1_LENGTH+(e>>UTRIE2_SHIFT_1)],t=this.index[t+=e>>UTRIE2_SHIFT_2&UTRIE2_INDEX_2_MASK],this.data[t=(t<<UTRIE2_INDEX_SHIFT)+(e&UTRIE2_DATA_MASK)];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),base64="KwAAAAAAAAAACA4AIDoAAPAfAAACAAAAAAAIABAAGABAAEgAUABYAF4AZgBeAGYAYABoAHAAeABeAGYAfACEAIAAiACQAJgAoACoAK0AtQC9AMUAXgBmAF4AZgBeAGYAzQDVAF4AZgDRANkA3gDmAOwA9AD8AAQBDAEUARoBIgGAAIgAJwEvATcBPwFFAU0BTAFUAVwBZAFsAXMBewGDATAAiwGTAZsBogGkAawBtAG8AcIBygHSAdoB4AHoAfAB+AH+AQYCDgIWAv4BHgImAi4CNgI+AkUCTQJTAlsCYwJrAnECeQKBAk0CiQKRApkCoQKoArACuALAAsQCzAIwANQC3ALkAjAA7AL0AvwCAQMJAxADGAMwACADJgMuAzYDPgOAAEYDSgNSA1IDUgNaA1oDYANiA2IDgACAAGoDgAByA3YDfgOAAIQDgACKA5IDmgOAAIAAogOqA4AAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAK8DtwOAAIAAvwPHA88D1wPfAyAD5wPsA/QD/AOAAIAABAQMBBIEgAAWBB4EJgQuBDMEIAM7BEEEXgBJBCADUQRZBGEEaQQwADAAcQQ+AXkEgQSJBJEEgACYBIAAoASoBK8EtwQwAL8ExQSAAIAAgACAAIAAgACgAM0EXgBeAF4AXgBeAF4AXgBeANUEXgDZBOEEXgDpBPEE+QQBBQkFEQUZBSEFKQUxBTUFPQVFBUwFVAVcBV4AYwVeAGsFcwV7BYMFiwWSBV4AmgWgBacFXgBeAF4AXgBeAKsFXgCyBbEFugW7BcIFwgXIBcIFwgXQBdQF3AXkBesF8wX7BQMGCwYTBhsGIwYrBjMGOwZeAD8GRwZNBl4AVAZbBl4AXgBeAF4AXgBeAF4AXgBeAF4AXgBeAGMGXgBqBnEGXgBeAF4AXgBeAF4AXgBeAF4AXgB5BoAG4wSGBo4GkwaAAIADHgR5AF4AXgBeAJsGgABGA4AAowarBrMGswagALsGwwbLBjAA0wbaBtoG3QbaBtoG2gbaBtoG2gblBusG8wb7BgMHCwcTBxsHCwcjBysHMAc1BzUHOgdCB9oGSgdSB1oHYAfaBloHaAfaBlIH2gbaBtoG2gbaBtoG2gbaBjUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHbQdeAF4ANQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQd1B30HNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1B4MH2gaKB68EgACAAIAAgACAAIAAgACAAI8HlwdeAJ8HpweAAIAArwe3B14AXgC/B8UHygcwANAH2AfgB4AA6AfwBz4B+AcACFwBCAgPCBcIogEYAR8IJwiAAC8INwg/CCADRwhPCFcIXwhnCEoDGgSAAIAAgABvCHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIhAiLCI4IMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAANQc1BzUHNQc1BzUHNQc1BzUHNQc1B54INQc1B6II2gaqCLIIugiAAIAAvgjGCIAAgACAAIAAgACAAIAAgACAAIAAywiHAYAA0wiAANkI3QjlCO0I9Aj8CIAAgACAAAIJCgkSCRoJIgknCTYHLwk3CZYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiAAIAAAAFAAXgBeAGAAcABeAHwAQACQAKAArQC9AJ4AXgBeAE0A3gBRAN4A7AD8AMwBGgEAAKcBNwEFAUwBXAF4QkhCmEKnArcCgAHHAsABz4LAAcABwAHAAd+C6ABoAG+C/4LAAcABwAHAAc+DF4MAAcAB54M3gweDV4Nng3eDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEeDqABVg6WDqABoQ6gAaABoAHXDvcONw/3DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DncPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB7cPPwlGCU4JMACAAIAAgABWCV4JYQmAAGkJcAl4CXwJgAkwADAAMAAwAIgJgACLCZMJgACZCZ8JowmrCYAAswkwAF4AXgB8AIAAuwkABMMJyQmAAM4JgADVCTAAMAAwADAAgACAAIAAgACAAIAAgACAAIAAqwYWBNkIMAAwADAAMADdCeAJ6AnuCR4E9gkwAP4JBQoNCjAAMACAABUK0wiAAB0KJAosCjQKgAAwADwKQwqAAEsKvQmdCVMKWwowADAAgACAALcEMACAAGMKgABrCjAAMAAwADAAMAAwADAAMAAwADAAMAAeBDAAMAAwADAAMAAwADAAMAAwADAAMAAwAIkEPQFzCnoKiQSCCooKkAqJBJgKoAqkCokEGAGsCrQKvArBCjAAMADJCtEKFQHZCuEK/gHpCvEKMAAwADAAMACAAIwE+QowAIAAPwEBCzAAMAAwADAAMACAAAkLEQswAIAAPwEZCyELgAAOCCkLMAAxCzkLMAAwADAAMAAwADAAXgBeAEELMAAwADAAMAAwADAAMAAwAEkLTQtVC4AAXAtkC4AAiQkwADAAMAAwADAAMAAwADAAbAtxC3kLgAuFC4sLMAAwAJMLlwufCzAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAApwswADAAMACAAIAAgACvC4AAgACAAIAAgACAALcLMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAvwuAAMcLgACAAIAAgACAAIAAyguAAIAAgACAAIAA0QswADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAANkLgACAAIAA4AswADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACJCR4E6AswADAAhwHwC4AA+AsADAgMEAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMACAAIAAGAwdDCUMMAAwAC0MNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQw1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHPQwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADUHNQc1BzUHNQc1BzUHNQc2BzAAMAA5DDUHNQc1BzUHNQc1BzUHNQc1BzUHNQdFDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAgACAAIAATQxSDFoMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAF4AXgBeAF4AXgBeAF4AYgxeAGoMXgBxDHkMfwxeAIUMXgBeAI0MMAAwADAAMAAwAF4AXgCVDJ0MMAAwADAAMABeAF4ApQxeAKsMswy7DF4Awgy9DMoMXgBeAF4AXgBeAF4AXgBeAF4AXgDRDNkMeQBqCeAM3Ax8AOYM7Az0DPgMXgBeAF4AXgBeAF4AXgBeAF4AXgBeAF4AXgBeAF4AXgCgAAANoAAHDQ4NFg0wADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAeDSYNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIAAgACAAIAAgACAAC4NMABeAF4ANg0wADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAD4NRg1ODVYNXg1mDTAAbQ0wADAAMAAwADAAMAAwADAA2gbaBtoG2gbaBtoG2gbaBnUNeg3CBYANwgWFDdoGjA3aBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gaUDZwNpA2oDdoG2gawDbcNvw3HDdoG2gbPDdYN3A3fDeYN2gbsDfMN2gbaBvoN/g3aBgYODg7aBl4AXgBeABYOXgBeACUG2gYeDl4AJA5eACwO2w3aBtoGMQ45DtoG2gbaBtoGQQ7aBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gZJDjUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1B1EO2gY1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQdZDjUHNQc1BzUHNQc1B2EONQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHaA41BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1B3AO2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gY1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1B2EO2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gZJDtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBkkOeA6gAKAAoAAwADAAMAAwAKAAoACgAKAAoACgAKAAgA4wADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAD//wQABAAEAAQABAAEAAQABAAEAA0AAwABAAEAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAKABMAFwAeABsAGgAeABcAFgASAB4AGwAYAA8AGAAcAEsASwBLAEsASwBLAEsASwBLAEsAGAAYAB4AHgAeABMAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAFgAbABIAHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYADQARAB4ABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkAFgAaABsAGwAbAB4AHQAdAB4ATwAXAB4ADQAeAB4AGgAbAE8ATwAOAFAAHQAdAB0ATwBPABcATwBPAE8AFgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwArAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAAQABAANAA0ASwBLAEsASwBLAEsASwBLAEsASwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUAArACsABABQAAQABAAEAAQABAAEAAQAKwArAAQABAArACsABAAEAAQAUAArACsAKwArACsAKwArACsABAArACsAKwArAFAAUAArAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAGgAaAFAAUABQAFAAUABMAB4AGwBQAB4AKwArACsABAAEAAQAKwBQAFAAUABQAFAAUAArACsAKwArAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUAArAFAAUAArACsABAArAAQABAAEAAQABAArACsAKwArAAQABAArACsABAAEAAQAKwArACsABAArACsAKwArACsAKwArAFAAUABQAFAAKwBQACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwAEAAQAUABQAFAABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUAArACsABABQAAQABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQAKwArAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwAeABsAKwArACsAKwArACsAKwBQAAQABAAEAAQABAAEACsABAAEAAQAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwArAAQABAArACsABAAEAAQAKwArACsAKwArACsAKwArAAQABAArACsAKwArAFAAUAArAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwAeAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwAEAFAAKwBQAFAAUABQAFAAUAArACsAKwBQAFAAUAArAFAAUABQAFAAKwArACsAUABQACsAUAArAFAAUAArACsAKwBQAFAAKwArACsAUABQAFAAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQAKwArACsABAAEAAQAKwAEAAQABAAEACsAKwBQACsAKwArACsAKwArAAQAKwArACsAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAB4AHgAeAB4AHgAeABsAHgArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABAArACsAKwArACsAKwArAAQABAArAFAAUABQACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAB4AUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABAArACsAKwArACsAKwArAAQABAArACsAKwArACsAKwArAFAAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwArAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAKwBcAFwAKwBcACsAKwBcACsAKwArACsAKwArAFwAXABcAFwAKwBcAFwAXABcAFwAXABcACsAXABcAFwAKwBcACsAXAArACsAXABcACsAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgArACoAKgBcACsAKwBcAFwAXABcAFwAKwBcACsAKgAqACoAKgAqACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAFwAXABcAFwAUAAOAA4ADgAOAB4ADgAOAAkADgAOAA0ACQATABMAEwATABMACQAeABMAHgAeAB4ABAAEAB4AHgAeAB4AHgAeAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUAANAAQAHgAEAB4ABAAWABEAFgARAAQABABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAAQABAAEAAQABAANAAQABABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsADQANAB4AHgAeAB4AHgAeAAQAHgAeAB4AHgAeAB4AKwAeAB4ADgAOAA0ADgAeAB4AHgAeAB4ACQAJACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgAeAB4AHgBcAFwAXABcAFwAXAAqACoAKgAqAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAKgAqACoAKgAqACoAKgBcAFwAXAAqACoAKgAqAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAXAAqAEsASwBLAEsASwBLAEsASwBLAEsAKgAqACoAKgAqACoAUABQAFAAUABQAFAAKwBQACsAKwArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQACsAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwAEAAQABAAeAA0AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAEQArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAADQANAA0AUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAA0ADQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQACsABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoADQANABUAXAANAB4ADQAbAFwAKgArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAB4AHgATABMADQANAA4AHgATABMAHgAEAAQABAAJACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAUABQAFAAUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwAeACsAKwArABMAEwBLAEsASwBLAEsASwBLAEsASwBLAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwBcAFwAXABcAFwAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcACsAKwArACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwAeAB4AXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgArACsABABLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKgAqACoAKgAqACoAKgBcACoAKgAqACoAKgAqACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAUABQAFAAUABQAFAAUAArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4ADQANAA0ADQAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAHgAeAB4AHgBQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwANAA0ADQANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwBQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsABAAEAAQAHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAABABQAFAAUABQAAQABAAEAFAAUAAEAAQABAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAKwBQACsAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAKwArAB4AHgAeAB4AHgAeACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAUABQAFAAKwAeAB4AHgAeAB4AHgAeAA4AHgArAA0ADQANAA0ADQANAA0ACQANAA0ADQAIAAQACwAEAAQADQAJAA0ADQAMAB0AHQAeABcAFwAWABcAFwAXABYAFwAdAB0AHgAeABQAFAAUAA0AAQABAAQABAAEAAQABAAJABoAGgAaABoAGgAaABoAGgAeABcAFwAdABUAFQAeAB4AHgAeAB4AHgAYABYAEQAVABUAFQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgANAB4ADQANAA0ADQAeAA0ADQANAAcAHgAeAB4AHgArAAQABAAEAAQABAAEAAQABAAEAAQAUABQACsAKwBPAFAAUABQAFAAUAAeAB4AHgAWABEATwBQAE8ATwBPAE8AUABQAFAAUABQAB4AHgAeABYAEQArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAGwAbABsAGwAbABsAGwAaABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAaABsAGwAbABsAGgAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgBQABoAHgAdAB4AUAAeABoAHgAeAB4AHgAeAB4AHgAeAB4ATwAeAFAAGwAeAB4AUABQAFAAUABQAB4AHgAeAB0AHQAeAFAAHgBQAB4AUAAeAFAATwBQAFAAHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AUABQAFAAUABPAE8AUABQAFAAUABQAE8AUABQAE8AUABPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAE8ATwBPAE8ATwBPAE8ATwBPAE8AUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAATwAeAB4AKwArACsAKwAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB0AHQAeAB4AHgAdAB0AHgAeAB0AHgAeAB4AHQAeAB0AGwAbAB4AHQAeAB4AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB0AHgAdAB4AHQAdAB0AHQAdAB0AHgAdAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAdAB0AHQAdAB4AHgAdAB0AHgAeAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABQAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAlACUAHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBQAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAeAB4AHgAeAB0AHQAeAB4AHgAeAB0AHQAdAB4AHgAdAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB0AHQAeAB4AHQAeAB4AHgAeAB0AHQAeAB4AHgAeACUAJQAdAB0AJQAeACUAJQAlACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAHgAeAB4AHgAdAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHQAdAB0AHgAdACUAHQAdAB4AHQAdAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHQAdAB0AHQAlAB4AJQAlACUAHQAlACUAHQAdAB0AJQAlAB0AHQAlAB0AHQAlACUAJQAeAB0AHgAeAB4AHgAdAB0AJQAdAB0AHQAdAB0AHQAlACUAJQAlACUAHQAlACUAIAAlAB0AHQAlACUAJQAlACUAJQAlACUAHgAeAB4AJQAlACAAIAAgACAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeABcAFwAXABcAFwAXAB4AEwATACUAHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwArACUAJQBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAKwArACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAE8ATwBPAE8ATwBPAE8ATwAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeACsAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUAArACsAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQBQAFAAUABQACsAKwArACsAUABQAFAAUABQAFAAUABQAA0AUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQACsAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgBQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAABAAEAAQAKwAEAAQAKwArACsAKwArAAQABAAEAAQAUABQAFAAUAArAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsABAAEAAQAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsADQANAA0ADQANAA0ADQANAB4AKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AUABQAFAAUABQAFAAUABQAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAUABQAFAAUABQAA0ADQANAA0ADQANABQAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwANAA0ADQANAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAeAAQABAAEAB4AKwArAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLACsADQArAB4AKwArAAQABAAEAAQAUABQAB4AUAArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwAEAAQABAAEAAQABAAEAAQABAAOAA0ADQATABMAHgAeAB4ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0AUABQAFAAUAAEAAQAKwArAAQADQANAB4AUAArACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXABcAA0ADQANACoASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUAArACsAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANACsADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEcARwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQACsAKwAeAAQABAANAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAEAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUAArACsAUAArACsAUABQACsAKwBQAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AKwArAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAeAB4ADQANAA0ADQAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAArAAQABAArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAEAAQABAAEAAQABAAEACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAFgAWAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAKwBQACsAKwArACsAKwArAFAAKwArACsAKwBQACsAUAArAFAAKwBQAFAAUAArAFAAUAArAFAAKwArAFAAKwBQACsAUAArAFAAKwBQACsAUABQACsAUAArACsAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAUABQAFAAUAArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUAArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAlACUAJQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeACUAJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeACUAJQAlACUAJQAeACUAJQAlACUAJQAgACAAIAAlACUAIAAlACUAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIQAhACEAIQAhACUAJQAgACAAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIAAgACAAIAAlACUAJQAlACAAJQAgACAAIAAgACAAIAAgACAAIAAlACUAJQAgACUAJQAlACUAIAAgACAAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeACUAHgAlAB4AJQAlACUAJQAlACAAJQAlACUAJQAeACUAHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIAAgACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIAAlACUAJQAlACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAIAAgACAAJQAlACUAIAAgACAAIAAgAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFwAXABcAFQAVABUAHgAeAB4AHgAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIAAgACAAJQAlACUAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAlACAAIAAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsA",LETTER_NUMBER_MODIFIER=50,BK=1,CR=2,LF=3,CM=4,NL=5,WJ=7,ZW=8,GL=9,SP=10,ZWJ=11,B2=12,BA=13,BB=14,HY=15,CB=16,CL=17,CP=18,EX=19,IN=20,NS=21,OP=22,QU=23,IS=24,NU=25,PO=26,PR=27,SY=28,AI=29,AL=30,CJ=31,EB=32,EM=33,H2=34,H3=35,HL=36,ID=37,JL=38,JV=39,JT=40,RI=41,SA=42,XX=43,BREAK_MANDATORY="!",BREAK_NOT_ALLOWED="",BREAK_ALLOWED="",UnicodeTrie=createTrieFromBase64(base64),ALPHABETICS=[AL,HL],HARD_LINE_BREAKS=[BK,CR,LF,NL],SPACE=[SP,ZW],PREFIX_POSTFIX=[PR,PO],LINE_BREAKS=HARD_LINE_BREAKS.concat(SPACE),KOREAN_SYLLABLE_BLOCK=[JL,JV,JT,H2,H3],HYPHEN=[HY,BA],codePointsToCharacterClasses=function(e,i){void 0===i&&(i="strict");var n=[],a=[],o=[];return e.forEach(function(e,t){var r=UnicodeTrie.get(e);if(LETTER_NUMBER_MODIFIER<r?(o.push(!0),r-=LETTER_NUMBER_MODIFIER):o.push(!1),-1!==["normal","auto","loose"].indexOf(i)&&-1!==[8208,8211,12316,12448].indexOf(e))return a.push(t),n.push(CB);if(r!==CM&&r!==ZWJ)return a.push(t),r===CJ?n.push("strict"===i?NS:ID):r===SA||r===AI?n.push(AL):r===XX?n.push(131072<=e&&e<=196605||196608<=e&&e<=262141?ID:AL):void n.push(r);if(0!==t&&-1===LINE_BREAKS.indexOf(e=n[t-1]))return a.push(a[t-1]),n.push(e);return a.push(t),n.push(AL)}),[a,n,o]},isAdjacentWithSpaceIgnored=function(e,t,r,i){var n=i[r];if(Array.isArray(e)?-1!==e.indexOf(n):e===n)for(var a=r;a<=i.length;){if((s=i[++a])===t)return!0;if(s!==SP)break}if(n===SP)for(a=r;0<a;){var o=i[--a];if(Array.isArray(e)?-1!==e.indexOf(o):e===o)for(var s,l=r;l<=i.length;){if((s=i[++l])===t)return!0;if(s!==SP)break}if(o!==SP)break}return!1},previousNonSpaceClassType=function(e,t){for(var r=e;0<=r;){var i=t[r];if(i!==SP)return i;r--}return 0},_lineBreakAtIndex=function(e,t,r,i,n){if(0===r[i])return BREAK_NOT_ALLOWED;i-=1;if(Array.isArray(n)&&!0===n[i])return BREAK_NOT_ALLOWED;var n=i-1,a=1+i,o=t[i],s=0<=n?t[n]:0,l=t[a];if(o===CR&&l===LF)return BREAK_NOT_ALLOWED;if(-1!==HARD_LINE_BREAKS.indexOf(o))return BREAK_MANDATORY;if(-1!==HARD_LINE_BREAKS.indexOf(l))return BREAK_NOT_ALLOWED;if(-1!==SPACE.indexOf(l))return BREAK_NOT_ALLOWED;if(previousNonSpaceClassType(i,t)===ZW)return BREAK_ALLOWED;if(UnicodeTrie.get(e[i])===ZWJ&&(l===ID||l===EB||l===EM))return BREAK_NOT_ALLOWED;if(o===WJ||l===WJ)return BREAK_NOT_ALLOWED;if(o===GL)return BREAK_NOT_ALLOWED;if(-1===[SP,BA,HY].indexOf(o)&&l===GL)return BREAK_NOT_ALLOWED;if(-1!==[CL,CP,EX,IS,SY].indexOf(l))return BREAK_NOT_ALLOWED;if(previousNonSpaceClassType(i,t)===OP)return BREAK_NOT_ALLOWED;if(isAdjacentWithSpaceIgnored(QU,OP,i,t))return BREAK_NOT_ALLOWED;if(isAdjacentWithSpaceIgnored([CL,CP],NS,i,t))return BREAK_NOT_ALLOWED;if(isAdjacentWithSpaceIgnored(B2,B2,i,t))return BREAK_NOT_ALLOWED;if(o===SP)return BREAK_ALLOWED;if(o===QU||l===QU)return BREAK_NOT_ALLOWED;if(l===CB||o===CB)return BREAK_ALLOWED;if(-1!==[BA,HY,NS].indexOf(l)||o===BB)return BREAK_NOT_ALLOWED;if(s===HL&&-1!==HYPHEN.indexOf(o))return BREAK_NOT_ALLOWED;if(o===SY&&l===HL)return BREAK_NOT_ALLOWED;if(l===IN&&-1!==ALPHABETICS.concat(IN,EX,NU,ID,EB,EM).indexOf(o))return BREAK_NOT_ALLOWED;if(-1!==ALPHABETICS.indexOf(l)&&o===NU||-1!==ALPHABETICS.indexOf(o)&&l===NU)return BREAK_NOT_ALLOWED;if(o===PR&&-1!==[ID,EB,EM].indexOf(l)||-1!==[ID,EB,EM].indexOf(o)&&l===PO)return BREAK_NOT_ALLOWED;if(-1!==ALPHABETICS.indexOf(o)&&-1!==PREFIX_POSTFIX.indexOf(l)||-1!==PREFIX_POSTFIX.indexOf(o)&&-1!==ALPHABETICS.indexOf(l))return BREAK_NOT_ALLOWED;if(-1!==[PR,PO].indexOf(o)&&(l===NU||-1!==[OP,HY].indexOf(l)&&t[1+a]===NU)||-1!==[OP,HY].indexOf(o)&&l===NU||o===NU&&-1!==[NU,SY,IS].indexOf(l))return BREAK_NOT_ALLOWED;if(-1!==[NU,SY,IS,CL,CP].indexOf(l))for(var c=i;0<=c;){if((d=t[c])===NU)return BREAK_NOT_ALLOWED;if(-1===[SY,IS].indexOf(d))break;c--}if(-1!==[PR,PO].indexOf(l))for(var d,c=-1!==[CL,CP].indexOf(o)?n:i;0<=c;){if((d=t[c])===NU)return BREAK_NOT_ALLOWED;if(-1===[SY,IS].indexOf(d))break;c--}if(JL===o&&-1!==[JL,JV,H2,H3].indexOf(l)||-1!==[JV,H2].indexOf(o)&&-1!==[JV,JT].indexOf(l)||-1!==[JT,H3].indexOf(o)&&l===JT)return BREAK_NOT_ALLOWED;if(-1!==KOREAN_SYLLABLE_BLOCK.indexOf(o)&&-1!==[IN,PO].indexOf(l)||-1!==KOREAN_SYLLABLE_BLOCK.indexOf(l)&&o===PR)return BREAK_NOT_ALLOWED;if(-1!==ALPHABETICS.indexOf(o)&&-1!==ALPHABETICS.indexOf(l))return BREAK_NOT_ALLOWED;if(o===IS&&-1!==ALPHABETICS.indexOf(l))return BREAK_NOT_ALLOWED;if(-1!==ALPHABETICS.concat(NU).indexOf(o)&&l===OP||-1!==ALPHABETICS.concat(NU).indexOf(l)&&o===CP)return BREAK_NOT_ALLOWED;if(o===RI&&l===RI){for(var h=r[i],u=1;0<h&&t[--h]===RI;)u++;if(u%2!=0)return BREAK_NOT_ALLOWED}return o===EB&&l===EM?BREAK_NOT_ALLOWED:BREAK_ALLOWED},cssFormattedClasses=function(r,e){var t=codePointsToCharacterClasses(r,(e=e||{lineBreak:"normal",wordBreak:"normal"}).lineBreak),i=t[0],n=t[1],t=t[2],e=("break-all"!==e.wordBreak&&"break-word"!==e.wordBreak||(n=n.map(function(e){return-1!==[NU,AL,SA].indexOf(e)?ID:e})),"keep-all"===e.wordBreak?t.map(function(e,t){return e&&19968<=r[t]&&r[t]<=40959}):void 0);return[i,n,e]},Break=function(){function e(e,t,r,i){this.codePoints=e,this.required=t===BREAK_MANDATORY,this.start=r,this.end=i}return e.prototype.slice=function(){return fromCodePoint.apply(void 0,this.codePoints.slice(this.start,this.end))},e}(),LineBreaker=function(e,t){var r=toCodePoints(e),e=cssFormattedClasses(r,t),i=e[0],n=e[1],a=e[2],o=r.length,s=0,l=0;return{next:function(){if(o<=l)return{done:!0,value:null};for(var e,t=BREAK_NOT_ALLOWED;l<o&&(t=_lineBreakAtIndex(r,n,i,++l,a))===BREAK_NOT_ALLOWED;);return t!==BREAK_NOT_ALLOWED||l===o?(e=new Break(r,t,s,l),s=l,{value:e,done:!1}):{done:!0,value:null}}}},FLAG_UNRESTRICTED=(!function(e){e[e.STRING_TOKEN=0]="STRING_TOKEN",e[e.BAD_STRING_TOKEN=1]="BAD_STRING_TOKEN",e[e.LEFT_PARENTHESIS_TOKEN=2]="LEFT_PARENTHESIS_TOKEN",e[e.RIGHT_PARENTHESIS_TOKEN=3]="RIGHT_PARENTHESIS_TOKEN",e[e.COMMA_TOKEN=4]="COMMA_TOKEN",e[e.HASH_TOKEN=5]="HASH_TOKEN",e[e.DELIM_TOKEN=6]="DELIM_TOKEN",e[e.AT_KEYWORD_TOKEN=7]="AT_KEYWORD_TOKEN",e[e.PREFIX_MATCH_TOKEN=8]="PREFIX_MATCH_TOKEN",e[e.DASH_MATCH_TOKEN=9]="DASH_MATCH_TOKEN",e[e.INCLUDE_MATCH_TOKEN=10]="INCLUDE_MATCH_TOKEN",e[e.LEFT_CURLY_BRACKET_TOKEN=11]="LEFT_CURLY_BRACKET_TOKEN",e[e.RIGHT_CURLY_BRACKET_TOKEN=12]="RIGHT_CURLY_BRACKET_TOKEN",e[e.SUFFIX_MATCH_TOKEN=13]="SUFFIX_MATCH_TOKEN",e[e.SUBSTRING_MATCH_TOKEN=14]="SUBSTRING_MATCH_TOKEN",e[e.DIMENSION_TOKEN=15]="DIMENSION_TOKEN",e[e.PERCENTAGE_TOKEN=16]="PERCENTAGE_TOKEN",e[e.NUMBER_TOKEN=17]="NUMBER_TOKEN",e[e.FUNCTION=18]="FUNCTION",e[e.FUNCTION_TOKEN=19]="FUNCTION_TOKEN",e[e.IDENT_TOKEN=20]="IDENT_TOKEN",e[e.COLUMN_TOKEN=21]="COLUMN_TOKEN",e[e.URL_TOKEN=22]="URL_TOKEN",e[e.BAD_URL_TOKEN=23]="BAD_URL_TOKEN",e[e.CDC_TOKEN=24]="CDC_TOKEN",e[e.CDO_TOKEN=25]="CDO_TOKEN",e[e.COLON_TOKEN=26]="COLON_TOKEN",e[e.SEMICOLON_TOKEN=27]="SEMICOLON_TOKEN",e[e.LEFT_SQUARE_BRACKET_TOKEN=28]="LEFT_SQUARE_BRACKET_TOKEN",e[e.RIGHT_SQUARE_BRACKET_TOKEN=29]="RIGHT_SQUARE_BRACKET_TOKEN",e[e.UNICODE_RANGE_TOKEN=30]="UNICODE_RANGE_TOKEN",e[e.WHITESPACE_TOKEN=31]="WHITESPACE_TOKEN",e[e.EOF_TOKEN=32]="EOF_TOKEN"}(TokenType=TokenType||{}),1),FLAG_ID=2,FLAG_INTEGER=4,FLAG_NUMBER=8,LINE_FEED=10,SOLIDUS=47,REVERSE_SOLIDUS=92,CHARACTER_TABULATION=9,SPACE$1=32,QUOTATION_MARK=34,EQUALS_SIGN=61,NUMBER_SIGN=35,DOLLAR_SIGN=36,PERCENTAGE_SIGN=37,APOSTROPHE=39,LEFT_PARENTHESIS=40,RIGHT_PARENTHESIS=41,LOW_LINE=95,HYPHEN_MINUS=45,EXCLAMATION_MARK=33,LESS_THAN_SIGN=60,GREATER_THAN_SIGN=62,COMMERCIAL_AT=64,LEFT_SQUARE_BRACKET=91,RIGHT_SQUARE_BRACKET=93,CIRCUMFLEX_ACCENT=61,LEFT_CURLY_BRACKET=123,QUESTION_MARK=63,RIGHT_CURLY_BRACKET=125,VERTICAL_LINE=124,TILDE=126,CONTROL=128,REPLACEMENT_CHARACTER=65533,ASTERISK=42,PLUS_SIGN=43,COMMA=44,COLON=58,SEMICOLON=59,FULL_STOP=46,NULL=0,BACKSPACE=8,LINE_TABULATION=11,SHIFT_OUT=14,INFORMATION_SEPARATOR_ONE=31,DELETE=127,EOF=-1,ZERO=48,a=97,e=101,f$1=102,u=117,z=122,A=65,E=69,F=70,U=85,Z=90,isDigit=function(e){return ZERO<=e&&e<=57},isSurrogateCodePoint=function(e){return 55296<=e&&e<=57343},isHex=function(e){return isDigit(e)||A<=e&&e<=F||a<=e&&e<=f$1},isLowerCaseLetter=function(e){return a<=e&&e<=z},isUpperCaseLetter=function(e){return A<=e&&e<=Z},isLetter=function(e){return isLowerCaseLetter(e)||isUpperCaseLetter(e)},isNonASCIICodePoint=function(e){return CONTROL<=e},isWhiteSpace=function(e){return e===LINE_FEED||e===CHARACTER_TABULATION||e===SPACE$1},isNameStartCodePoint=function(e){return isLetter(e)||isNonASCIICodePoint(e)||e===LOW_LINE},isNameCodePoint=function(e){return isNameStartCodePoint(e)||isDigit(e)||e===HYPHEN_MINUS},isNonPrintableCodePoint=function(e){return NULL<=e&&e<=BACKSPACE||e===LINE_TABULATION||SHIFT_OUT<=e&&e<=INFORMATION_SEPARATOR_ONE||e===DELETE},isValidEscape=function(e,t){return e===REVERSE_SOLIDUS&&t!==LINE_FEED},isIdentifierStart=function(e,t,r){return e===HYPHEN_MINUS?isNameStartCodePoint(t)||isValidEscape(t,r):!!isNameStartCodePoint(e)||!(e!==REVERSE_SOLIDUS||!isValidEscape(e,t))},isNumberStart=function(e,t,r){return e===PLUS_SIGN||e===HYPHEN_MINUS?!!isDigit(t)||t===FULL_STOP&&isDigit(r):isDigit(e===FULL_STOP?t:e)},stringToNumber=function(t){for(var r=0,i=1,n=(t[r]!==PLUS_SIGN&&t[r]!==HYPHEN_MINUS||(t[r]===HYPHEN_MINUS&&(i=-1),r++),[]);isDigit(t[r]);)n.push(t[r++]);for(var a=n.length?parseInt(fromCodePoint.apply(void 0,n),10):0,o=(t[r]===FULL_STOP&&r++,[]);isDigit(t[r]);)o.push(t[r++]);for(var s=o.length,l=s?parseInt(fromCodePoint.apply(void 0,o),10):0,c=(t[r]!==E&&t[r]!==e||r++,1),d=(t[r]!==PLUS_SIGN&&t[r]!==HYPHEN_MINUS||(t[r]===HYPHEN_MINUS&&(c=-1),r++),[]);isDigit(t[r]);)d.push(t[r++]);var h=d.length?parseInt(fromCodePoint.apply(void 0,d),10):0;return i*(a+l*Math.pow(10,-s))*Math.pow(10,c*h)},LEFT_PARENTHESIS_TOKEN={type:TokenType.LEFT_PARENTHESIS_TOKEN},RIGHT_PARENTHESIS_TOKEN={type:TokenType.RIGHT_PARENTHESIS_TOKEN},COMMA_TOKEN={type:TokenType.COMMA_TOKEN},SUFFIX_MATCH_TOKEN={type:TokenType.SUFFIX_MATCH_TOKEN},PREFIX_MATCH_TOKEN={type:TokenType.PREFIX_MATCH_TOKEN},COLUMN_TOKEN={type:TokenType.COLUMN_TOKEN},DASH_MATCH_TOKEN={type:TokenType.DASH_MATCH_TOKEN},INCLUDE_MATCH_TOKEN={type:TokenType.INCLUDE_MATCH_TOKEN},LEFT_CURLY_BRACKET_TOKEN={type:TokenType.LEFT_CURLY_BRACKET_TOKEN},RIGHT_CURLY_BRACKET_TOKEN={type:TokenType.RIGHT_CURLY_BRACKET_TOKEN},SUBSTRING_MATCH_TOKEN={type:TokenType.SUBSTRING_MATCH_TOKEN},BAD_URL_TOKEN={type:TokenType.BAD_URL_TOKEN},BAD_STRING_TOKEN={type:TokenType.BAD_STRING_TOKEN},CDO_TOKEN={type:TokenType.CDO_TOKEN},CDC_TOKEN={type:TokenType.CDC_TOKEN},COLON_TOKEN={type:TokenType.COLON_TOKEN},SEMICOLON_TOKEN={type:TokenType.SEMICOLON_TOKEN},LEFT_SQUARE_BRACKET_TOKEN={type:TokenType.LEFT_SQUARE_BRACKET_TOKEN},RIGHT_SQUARE_BRACKET_TOKEN={type:TokenType.RIGHT_SQUARE_BRACKET_TOKEN},WHITESPACE_TOKEN={type:TokenType.WHITESPACE_TOKEN},EOF_TOKEN={type:TokenType.EOF_TOKEN},Tokenizer=function(){function t(){this._value=[]}return t.prototype.write=function(e){this._value=this._value.concat(toCodePoints(e))},t.prototype.read=function(){for(var e=[],t=this.consumeToken();t!==EOF_TOKEN;)e.push(t),t=this.consumeToken();return e},t.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case QUOTATION_MARK:return this.consumeStringToken(QUOTATION_MARK);case NUMBER_SIGN:var t=this.peekCodePoint(0),r=this.peekCodePoint(1),i=this.peekCodePoint(2);if(isNameCodePoint(t)||isValidEscape(r,i))return t=isIdentifierStart(t,r,i)?FLAG_ID:FLAG_UNRESTRICTED,a=this.consumeName(),{type:TokenType.HASH_TOKEN,value:a,flags:t};break;case DOLLAR_SIGN:if(this.peekCodePoint(0)===EQUALS_SIGN)return this.consumeCodePoint(),SUFFIX_MATCH_TOKEN;break;case APOSTROPHE:return this.consumeStringToken(APOSTROPHE);case LEFT_PARENTHESIS:return LEFT_PARENTHESIS_TOKEN;case RIGHT_PARENTHESIS:return RIGHT_PARENTHESIS_TOKEN;case ASTERISK:if(this.peekCodePoint(0)===EQUALS_SIGN)return this.consumeCodePoint(),SUBSTRING_MATCH_TOKEN;break;case PLUS_SIGN:if(isNumberStart(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case COMMA:return COMMA_TOKEN;case HYPHEN_MINUS:r=e,i=this.peekCodePoint(0),t=this.peekCodePoint(1);if(isNumberStart(r,i,t))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(isIdentifierStart(r,i,t))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(i===HYPHEN_MINUS&&t===GREATER_THAN_SIGN)return this.consumeCodePoint(),this.consumeCodePoint(),CDC_TOKEN;break;case FULL_STOP:if(isNumberStart(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case SOLIDUS:if(this.peekCodePoint(0)===ASTERISK)for(this.consumeCodePoint();;){var n=this.consumeCodePoint();if(n===ASTERISK&&(n=this.consumeCodePoint())===SOLIDUS)return this.consumeToken();if(n===EOF)return this.consumeToken()}break;case COLON:return COLON_TOKEN;case SEMICOLON:return SEMICOLON_TOKEN;case LESS_THAN_SIGN:if(this.peekCodePoint(0)===EXCLAMATION_MARK&&this.peekCodePoint(1)===HYPHEN_MINUS&&this.peekCodePoint(2)===HYPHEN_MINUS)return this.consumeCodePoint(),this.consumeCodePoint(),CDO_TOKEN;break;case COMMERCIAL_AT:var a,r=this.peekCodePoint(0),i=this.peekCodePoint(1),t=this.peekCodePoint(2);if(isIdentifierStart(r,i,t))return a=this.consumeName(),{type:TokenType.AT_KEYWORD_TOKEN,value:a};break;case LEFT_SQUARE_BRACKET:return LEFT_SQUARE_BRACKET_TOKEN;case REVERSE_SOLIDUS:if(isValidEscape(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case RIGHT_SQUARE_BRACKET:return RIGHT_SQUARE_BRACKET_TOKEN;case CIRCUMFLEX_ACCENT:if(this.peekCodePoint(0)===EQUALS_SIGN)return this.consumeCodePoint(),PREFIX_MATCH_TOKEN;break;case LEFT_CURLY_BRACKET:return LEFT_CURLY_BRACKET_TOKEN;case RIGHT_CURLY_BRACKET:return RIGHT_CURLY_BRACKET_TOKEN;case u:case U:r=this.peekCodePoint(0),i=this.peekCodePoint(1);return r!==PLUS_SIGN||!isHex(i)&&i!==QUESTION_MARK||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case VERTICAL_LINE:if(this.peekCodePoint(0)===EQUALS_SIGN)return this.consumeCodePoint(),DASH_MATCH_TOKEN;if(this.peekCodePoint(0)===VERTICAL_LINE)return this.consumeCodePoint(),COLUMN_TOKEN;break;case TILDE:if(this.peekCodePoint(0)===EQUALS_SIGN)return this.consumeCodePoint(),INCLUDE_MATCH_TOKEN;break;case EOF:return EOF_TOKEN}return isWhiteSpace(e)?(this.consumeWhiteSpace(),WHITESPACE_TOKEN):isDigit(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):isNameStartCodePoint(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:TokenType.DELIM_TOKEN,value:fromCodePoint(e)}},t.prototype.consumeCodePoint=function(){var e=this._value.shift();return void 0===e?-1:e},t.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},t.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},t.prototype.consumeUnicodeRangeToken=function(){for(var e=[],t=this.consumeCodePoint();isHex(t)&&e.length<6;)e.push(t),t=this.consumeCodePoint();for(var r=!1;t===QUESTION_MARK&&e.length<6;)e.push(t),t=this.consumeCodePoint(),r=!0;if(r)return i=parseInt(fromCodePoint.apply(void 0,e.map(function(e){return e===QUESTION_MARK?ZERO:e})),16),a=parseInt(fromCodePoint.apply(void 0,e.map(function(e){return e===QUESTION_MARK?F:e})),16),{type:TokenType.UNICODE_RANGE_TOKEN,start:i,end:a};var i=parseInt(fromCodePoint.apply(void 0,e),16);if(this.peekCodePoint(0)===HYPHEN_MINUS&&isHex(this.peekCodePoint(1))){this.consumeCodePoint();for(var t=this.consumeCodePoint(),n=[];isHex(t)&&n.length<6;)n.push(t),t=this.consumeCodePoint();var a=parseInt(fromCodePoint.apply(void 0,n),16);return{type:TokenType.UNICODE_RANGE_TOKEN,start:i,end:a}}return{type:TokenType.UNICODE_RANGE_TOKEN,start:i,end:i}},t.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return"url"===e.toLowerCase()&&this.peekCodePoint(0)===LEFT_PARENTHESIS?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===LEFT_PARENTHESIS?(this.consumeCodePoint(),{type:TokenType.FUNCTION_TOKEN,value:e}):{type:TokenType.IDENT_TOKEN,value:e}},t.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===EOF)return{type:TokenType.URL_TOKEN,value:""};var t=this.peekCodePoint(0);if(t===APOSTROPHE||t===QUOTATION_MARK)return(t=this.consumeStringToken(this.consumeCodePoint())).type===TokenType.STRING_TOKEN&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===EOF||this.peekCodePoint(0)===RIGHT_PARENTHESIS)?(this.consumeCodePoint(),{type:TokenType.URL_TOKEN,value:t.value}):(this.consumeBadUrlRemnants(),BAD_URL_TOKEN);for(;;){var r=this.consumeCodePoint();if(r===EOF||r===RIGHT_PARENTHESIS)return{type:TokenType.URL_TOKEN,value:fromCodePoint.apply(void 0,e)};if(isWhiteSpace(r))return this.consumeWhiteSpace(),this.peekCodePoint(0)===EOF||this.peekCodePoint(0)===RIGHT_PARENTHESIS?(this.consumeCodePoint(),{type:TokenType.URL_TOKEN,value:fromCodePoint.apply(void 0,e)}):(this.consumeBadUrlRemnants(),BAD_URL_TOKEN);if(r===QUOTATION_MARK||r===APOSTROPHE||r===LEFT_PARENTHESIS||isNonPrintableCodePoint(r))return this.consumeBadUrlRemnants(),BAD_URL_TOKEN;if(r===REVERSE_SOLIDUS){if(!isValidEscape(r,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),BAD_URL_TOKEN;e.push(this.consumeEscapedCodePoint())}else e.push(r)}},t.prototype.consumeWhiteSpace=function(){for(;isWhiteSpace(this.peekCodePoint(0));)this.consumeCodePoint()},t.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(e===RIGHT_PARENTHESIS||e===EOF)return;isValidEscape(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},t.prototype.consumeStringSlice=function(e){for(var t="";0<e;){var r=Math.min(6e4,e);t+=fromCodePoint.apply(void 0,this._value.splice(0,r)),e-=r}return this._value.shift(),t},t.prototype.consumeStringToken=function(e){for(var t="",r=0;;){var i,n=this._value[r];if(n===EOF||void 0===n||n===e)return t+=this.consumeStringSlice(r),{type:TokenType.STRING_TOKEN,value:t};if(n===LINE_FEED)return this._value.splice(0,r),BAD_STRING_TOKEN;n===REVERSE_SOLIDUS&&(i=this._value[r+1])!==EOF&&void 0!==i&&(i===LINE_FEED?(t+=this.consumeStringSlice(r),r=-1,this._value.shift()):isValidEscape(n,i)&&(t=(t+=this.consumeStringSlice(r))+fromCodePoint(this.consumeEscapedCodePoint()),r=-1)),r++}},t.prototype.consumeNumber=function(){var t=[],r=FLAG_INTEGER;for((i=this.peekCodePoint(0))!==PLUS_SIGN&&i!==HYPHEN_MINUS||t.push(this.consumeCodePoint());isDigit(this.peekCodePoint(0));)t.push(this.consumeCodePoint());var i=this.peekCodePoint(0),n=this.peekCodePoint(1);if(i===FULL_STOP&&isDigit(n))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),r=FLAG_NUMBER;isDigit(this.peekCodePoint(0));)t.push(this.consumeCodePoint());i=this.peekCodePoint(0);var n=this.peekCodePoint(1),a=this.peekCodePoint(2);if((i===E||i===e)&&((n===PLUS_SIGN||n===HYPHEN_MINUS)&&isDigit(a)||isDigit(n)))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),r=FLAG_NUMBER;isDigit(this.peekCodePoint(0));)t.push(this.consumeCodePoint());return[stringToNumber(t),r]},t.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],e=e[1],r=this.peekCodePoint(0),i=this.peekCodePoint(1),n=this.peekCodePoint(2);return isIdentifierStart(r,i,n)?(i=this.consumeName(),{type:TokenType.DIMENSION_TOKEN,number:t,flags:e,unit:i}):r===PERCENTAGE_SIGN?(this.consumeCodePoint(),{type:TokenType.PERCENTAGE_TOKEN,number:t,flags:e}):{type:TokenType.NUMBER_TOKEN,number:t,flags:e}},t.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(isHex(e)){for(var t=fromCodePoint(e);isHex(this.peekCodePoint(0))&&t.length<6;)t+=fromCodePoint(this.consumeCodePoint());isWhiteSpace(this.peekCodePoint(0))&&this.consumeCodePoint();var r=parseInt(t,16);return 0===r||isSurrogateCodePoint(r)||1114111<r?REPLACEMENT_CHARACTER:r}return e===EOF?REPLACEMENT_CHARACTER:e},t.prototype.consumeName=function(){for(var e="";;){var t=this.consumeCodePoint();if(isNameCodePoint(t))e+=fromCodePoint(t);else{if(!isValidEscape(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),e;e+=fromCodePoint(this.consumeEscapedCodePoint())}}},t}(),Parser=function(){function r(e){this._tokens=e}return r.create=function(e){var t=new Tokenizer;return t.write(e),new r(t.read())},r.parseValue=function(e){return r.create(e).parseComponentValue()},r.parseValues=function(e){return r.create(e).parseComponentValues()},r.prototype.parseComponentValue=function(){for(var e=this.consumeToken();e.type===TokenType.WHITESPACE_TOKEN;)e=this.consumeToken();if(e.type===TokenType.EOF_TOKEN)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);for(var t=this.consumeComponentValue();(e=this.consumeToken()).type===TokenType.WHITESPACE_TOKEN;);if(e.type===TokenType.EOF_TOKEN)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},r.prototype.parseComponentValues=function(){for(var e=[];;){var t=this.consumeComponentValue();if(t.type===TokenType.EOF_TOKEN)return e;e.push(t),e.push()}},r.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case TokenType.LEFT_CURLY_BRACKET_TOKEN:case TokenType.LEFT_SQUARE_BRACKET_TOKEN:case TokenType.LEFT_PARENTHESIS_TOKEN:return this.consumeSimpleBlock(e.type);case TokenType.FUNCTION_TOKEN:return this.consumeFunction(e)}return e},r.prototype.consumeSimpleBlock=function(e){for(var t={type:e,values:[]},r=this.consumeToken();;){if(r.type===TokenType.EOF_TOKEN||isEndingTokenFor(r,e))return t;this.reconsumeToken(r),t.values.push(this.consumeComponentValue()),r=this.consumeToken()}},r.prototype.consumeFunction=function(e){for(var t={name:e.value,values:[],type:TokenType.FUNCTION};;){var r=this.consumeToken();if(r.type===TokenType.EOF_TOKEN||r.type===TokenType.RIGHT_PARENTHESIS_TOKEN)return t;this.reconsumeToken(r),t.values.push(this.consumeComponentValue())}},r.prototype.consumeToken=function(){var e=this._tokens.shift();return void 0===e?EOF_TOKEN:e},r.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},r}(),isDimensionToken=function(e){return e.type===TokenType.DIMENSION_TOKEN},isNumberToken=function(e){return e.type===TokenType.NUMBER_TOKEN},isIdentToken=function(e){return e.type===TokenType.IDENT_TOKEN},isStringToken=function(e){return e.type===TokenType.STRING_TOKEN},isIdentWithValue=function(e,t){return isIdentToken(e)&&e.value===t},nonWhiteSpace=function(e){return e.type!==TokenType.WHITESPACE_TOKEN},nonFunctionArgSeparator=function(e){return e.type!==TokenType.WHITESPACE_TOKEN&&e.type!==TokenType.COMMA_TOKEN},parseFunctionArgs=function(e){var t=[],r=[];return e.forEach(function(e){if(e.type===TokenType.COMMA_TOKEN){if(0===r.length)throw new Error("Error parsing function args, zero tokens for arg");t.push(r),r=[]}else e.type!==TokenType.WHITESPACE_TOKEN&&r.push(e)}),r.length&&t.push(r),t},isEndingTokenFor=function(e,t){return t===TokenType.LEFT_CURLY_BRACKET_TOKEN&&e.type===TokenType.RIGHT_CURLY_BRACKET_TOKEN||t===TokenType.LEFT_SQUARE_BRACKET_TOKEN&&e.type===TokenType.RIGHT_SQUARE_BRACKET_TOKEN||t===TokenType.LEFT_PARENTHESIS_TOKEN&&e.type===TokenType.RIGHT_PARENTHESIS_TOKEN},isLength=function(e){return e.type===TokenType.NUMBER_TOKEN||e.type===TokenType.DIMENSION_TOKEN},isLengthPercentage=function(e){return e.type===TokenType.PERCENTAGE_TOKEN||isLength(e)},parseLengthPercentageTuple=function(e){return 1<e.length?[e[0],e[1]]:[e[0]]},ZERO_LENGTH={type:TokenType.NUMBER_TOKEN,number:0,flags:FLAG_INTEGER},FIFTY_PERCENT={type:TokenType.PERCENTAGE_TOKEN,number:50,flags:FLAG_INTEGER},HUNDRED_PERCENT={type:TokenType.PERCENTAGE_TOKEN,number:100,flags:FLAG_INTEGER},getAbsoluteValueForTuple=function(e,t,r){var i=e[0],e=e[1];return[getAbsoluteValue(i,t),getAbsoluteValue(void 0!==e?e:i,r)]},getAbsoluteValue=function(e,t){if(e.type===TokenType.PERCENTAGE_TOKEN)return e.number/100*t;if(isDimensionToken(e))switch(e.unit){case"rem":case"em":return 16*e.number;default:return e.number}return e.number},DEG="deg",GRAD="grad",RAD="rad",TURN="turn",angle={name:"angle",parse:function(e){if(e.type===TokenType.DIMENSION_TOKEN)switch(e.unit){case DEG:return Math.PI*e.number/180;case GRAD:return Math.PI/200*e.number;case RAD:return e.number;case TURN:return 2*Math.PI*e.number}throw new Error("Unsupported angle type")}},isAngle=function(e){return e.type===TokenType.DIMENSION_TOKEN&&(e.unit===DEG||e.unit===GRAD||e.unit===RAD||e.unit===TURN)},parseNamedSide=function(e){switch(e.filter(isIdentToken).map(function(e){return e.value}).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return[ZERO_LENGTH,ZERO_LENGTH];case"to top":case"bottom":return deg(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[ZERO_LENGTH,HUNDRED_PERCENT];case"to right":case"left":return deg(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[HUNDRED_PERCENT,HUNDRED_PERCENT];case"to bottom":case"top":return deg(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[HUNDRED_PERCENT,ZERO_LENGTH];case"to left":case"right":return deg(270)}return 0},deg=function(e){return Math.PI*e/180},color$1={name:"color",parse:function(e){if(e.type===TokenType.FUNCTION){var t=SUPPORTED_COLOR_FUNCTIONS[e.name];if(void 0===t)throw new Error('Attempting to parse an unsupported color function "'+e.name+'"');return t(e.values)}if(e.type===TokenType.HASH_TOKEN){var r,i,n,a;if(3===e.value.length)return r=e.value.substring(0,1),i=e.value.substring(1,2),n=e.value.substring(2,3),pack(parseInt(r+r,16),parseInt(i+i,16),parseInt(n+n,16),1);if(4===e.value.length)return r=e.value.substring(0,1),i=e.value.substring(1,2),n=e.value.substring(2,3),a=e.value.substring(3,4),pack(parseInt(r+r,16),parseInt(i+i,16),parseInt(n+n,16),parseInt(a+a,16)/255);if(6===e.value.length)return r=e.value.substring(0,2),i=e.value.substring(2,4),n=e.value.substring(4,6),pack(parseInt(r,16),parseInt(i,16),parseInt(n,16),1);if(8===e.value.length)return r=e.value.substring(0,2),i=e.value.substring(2,4),n=e.value.substring(4,6),a=e.value.substring(6,8),pack(parseInt(r,16),parseInt(i,16),parseInt(n,16),parseInt(a,16)/255)}if(e.type===TokenType.IDENT_TOKEN){t=COLORS[e.value.toUpperCase()];if(void 0!==t)return t}return COLORS.TRANSPARENT}},isTransparent=function(e){return 0==(255&e)},asString=function(e){var t=255&e,r=255&e>>8,i=255&e>>16,e=255&e>>24;return t<255?"rgba("+e+","+i+","+r+","+t/255+")":"rgb("+e+","+i+","+r+")"},pack=function(e,t,r,i){return(e<<24|t<<16|r<<8|Math.round(255*i)<<0)>>>0},getTokenColorValue=function(e,t){var r;return e.type===TokenType.NUMBER_TOKEN?e.number:e.type===TokenType.PERCENTAGE_TOKEN?(r=3===t?1:255,3===t?e.number/100*r:Math.round(e.number/100*r)):0},rgb=function(e){var t,r,i,e=e.filter(nonFunctionArgSeparator);return 3===e.length?(t=(i=e.map(getTokenColorValue))[0],r=i[1],i=i[2],pack(t,r,i,1)):4===e.length?(t=(e=e.map(getTokenColorValue))[0],r=e[1],i=e[2],e=e[3],pack(t,r,i,e)):0};function hue2rgb$1(e,t,r){return r<0&&(r+=1),1<=r&&--r,r<1/6?(t-e)*r*6+e:r<.5?t:r<2/3?6*(t-e)*(2/3-r)+e:e}var PropertyDescriptorParsingType,BACKGROUND_CLIP,CSSImageType,CSSRadialShape,CSSRadialExtent,hsl=function(e){var t,r,e=e.filter(nonFunctionArgSeparator),i=e[0],n=e[1],a=e[2],e=e[3],i=(i.type===TokenType.NUMBER_TOKEN?deg(i.number):angle.parse(i))/(2*Math.PI),n=isLengthPercentage(n)?n.number/100:0,a=isLengthPercentage(a)?a.number/100:0,e=void 0!==e&&isLengthPercentage(e)?getAbsoluteValue(e,1):1;return 0==n?pack(255*a,255*a,255*a,1):(t=hue2rgb$1(n=2*a-(a=a<=.5?a*(1+n):a+n-a*n),a,i+1/3),r=hue2rgb$1(n,a,i),n=hue2rgb$1(n,a,i-1/3),pack(255*t,255*r,255*n,e))},SUPPORTED_COLOR_FUNCTIONS={hsl:hsl,hsla:hsl,rgb:rgb,rgba:rgb},COLORS={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},backgroundClip=(!function(e){e[e.VALUE=0]="VALUE",e[e.LIST=1]="LIST",e[e.IDENT_VALUE=2]="IDENT_VALUE",e[e.TYPE_VALUE=3]="TYPE_VALUE",e[e.TOKEN_VALUE=4]="TOKEN_VALUE"}(PropertyDescriptorParsingType=PropertyDescriptorParsingType||{}),!function(e){e[e.BORDER_BOX=0]="BORDER_BOX",e[e.PADDING_BOX=1]="PADDING_BOX",e[e.CONTENT_BOX=2]="CONTENT_BOX"}(BACKGROUND_CLIP=BACKGROUND_CLIP||{}),{name:"background-clip",initialValue:"border-box",prefix:!1,type:PropertyDescriptorParsingType.LIST,parse:function(e){return e.map(function(e){if(isIdentToken(e))switch(e.value){case"padding-box":return BACKGROUND_CLIP.PADDING_BOX;case"content-box":return BACKGROUND_CLIP.CONTENT_BOX}return BACKGROUND_CLIP.BORDER_BOX})}}),backgroundColor={name:"background-color",initialValue:"transparent",prefix:!1,type:PropertyDescriptorParsingType.TYPE_VALUE,format:"color"},parseColorStop=function(e){var t=color$1.parse(e[0]),e=e[1];return e&&isLengthPercentage(e)?{color:t,stop:e}:{color:t,stop:null}},processColorStops=function(e,r){for(var t=e[0],i=e[e.length-1],n=(null===t.stop&&(t.stop=ZERO_LENGTH),null===i.stop&&(i.stop=HUNDRED_PERCENT),[]),a=0,o=0;o<e.length;o++){var s=e[o].stop;null!==s?(s=getAbsoluteValue(s,r),n.push(a<s?s:a),a=s):n.push(null)}for(var l=null,o=0;o<n.length;o++){var c=n[o];if(null===c)null===l&&(l=o);else if(null!==l){for(var d=o-l,h=(c-n[l-1])/(1+d),u=1;u<=d;u++)n[l+u-1]=h*u;l=null}}return e.map(function(e,t){return{color:e.color,stop:Math.max(Math.min(1,n[t]/r),0)}})},getAngleFromCorner=function(e,t,r){var i=t/2,n=r/2,t=getAbsoluteValue(e[0],t)-i,i=n-getAbsoluteValue(e[1],r);return(Math.atan2(i,t)+2*Math.PI)%(2*Math.PI)},calculateGradientDirection=function(e,t,r){var e="number"==typeof e?e:getAngleFromCorner(e,t,r),i=Math.abs(t*Math.sin(e))+Math.abs(r*Math.cos(e)),t=t/2,r=r/2,n=i/2,a=Math.sin(e-Math.PI/2)*n,e=Math.cos(e-Math.PI/2)*n;return[i,t-e,t+e,r-a,r+a]},distance$1=function(e,t){return Math.sqrt(e*e+t*t)},findCorner=function(e,t,n,a,o){return[[0,0],[0,t],[e,0],[e,t]].reduce(function(e,t){var r=t[0],i=t[1],r=distance$1(n-r,a-i);return(o?r<e.optimumDistance:r>e.optimumDistance)?{optimumCorner:t,optimumDistance:r}:e},{optimumDistance:o?1/0:-1/0,optimumCorner:null}).optimumCorner},calculateRadius=function(e,t,r,i,n){var a,o,s,l,c=0,d=0;switch(e.size){case CSSRadialExtent.CLOSEST_SIDE:e.shape===CSSRadialShape.CIRCLE?c=d=Math.min(Math.abs(t),Math.abs(t-i),Math.abs(r),Math.abs(r-n)):e.shape===CSSRadialShape.ELLIPSE&&(c=Math.min(Math.abs(t),Math.abs(t-i)),d=Math.min(Math.abs(r),Math.abs(r-n)));break;case CSSRadialExtent.CLOSEST_CORNER:e.shape===CSSRadialShape.CIRCLE?c=d=Math.min(distance$1(t,r),distance$1(t,r-n),distance$1(t-i,r),distance$1(t-i,r-n)):e.shape===CSSRadialShape.ELLIPSE&&(a=Math.min(Math.abs(r),Math.abs(r-n))/Math.min(Math.abs(t),Math.abs(t-i)),s=(l=findCorner(i,n,t,r,!0))[0],l=l[1],d=a*(c=distance$1(s-t,(l-r)/a)));break;case CSSRadialExtent.FARTHEST_SIDE:e.shape===CSSRadialShape.CIRCLE?c=d=Math.max(Math.abs(t),Math.abs(t-i),Math.abs(r),Math.abs(r-n)):e.shape===CSSRadialShape.ELLIPSE&&(c=Math.max(Math.abs(t),Math.abs(t-i)),d=Math.max(Math.abs(r),Math.abs(r-n)));break;case CSSRadialExtent.FARTHEST_CORNER:e.shape===CSSRadialShape.CIRCLE?c=d=Math.max(distance$1(t,r),distance$1(t,r-n),distance$1(t-i,r),distance$1(t-i,r-n)):e.shape===CSSRadialShape.ELLIPSE&&(a=Math.max(Math.abs(r),Math.abs(r-n))/Math.max(Math.abs(t),Math.abs(t-i)),s=(o=findCorner(i,n,t,r,!1))[0],l=o[1],d=a*(c=distance$1(s-t,(l-r)/a)))}return Array.isArray(e.size)&&(c=getAbsoluteValue(e.size[0],i),d=2===e.size.length?getAbsoluteValue(e.size[1],n):c),[c,d]},linearGradient=function(e){var r=deg(180),i=[];return parseFunctionArgs(e).forEach(function(e,t){if(0===t){t=e[0];if(t.type===TokenType.IDENT_TOKEN&&"to"===t.value)return void(r=parseNamedSide(e));if(isAngle(t))return void(r=angle.parse(t))}t=parseColorStop(e);i.push(t)}),{angle:r,stops:i,type:CSSImageType.LINEAR_GRADIENT}},prefixLinearGradient=function(e){var r=deg(180),i=[];return parseFunctionArgs(e).forEach(function(e,t){if(0===t){t=e[0];if(t.type===TokenType.IDENT_TOKEN&&-1!==["top","left","right","bottom"].indexOf(t.value))return void(r=parseNamedSide(e));if(isAngle(t))return void(r=(angle.parse(t)+deg(270))%deg(360))}t=parseColorStop(e);i.push(t)}),{angle:r,stops:i,type:CSSImageType.LINEAR_GRADIENT}},testRangeBounds=function(e){if(e.createRange){var t=e.createRange();if(t.getBoundingClientRect){var r=e.createElement("boundtest"),t=(r.style.height="123px",r.style.display="block",e.body.appendChild(r),t.selectNode(r),t.getBoundingClientRect()),t=Math.round(t.height);if(e.body.removeChild(r),123===t)return!0}}return!1},testCORS=function(){return void 0!==(new Image).crossOrigin},testResponseType=function(){return"string"==typeof(new XMLHttpRequest).responseType},testSVG=function(e){var t=new Image,e=e.createElement("canvas"),r=e.getContext("2d");if(!r)return!1;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{r.drawImage(t,0,0),e.toDataURL()}catch(e){return!1}return!0},isGreenPixel=function(e){return 0===e[0]&&255===e[1]&&0===e[2]&&255===e[3]},testForeignObject=function(r){var e=r.createElement("canvas"),i=(e.width=100,e.height=100,e.getContext("2d"));if(!i)return Promise.reject(!1);i.fillStyle="rgb(0, 255, 0)",i.fillRect(0,0,100,100);var t=new Image,n=e.toDataURL(),e=(t.src=n,createForeignObjectSVG(100,100,0,0,t));return i.fillStyle="red",i.fillRect(0,0,100,100),loadSerializedSVG(e).then(function(e){i.drawImage(e,0,0);var e=i.getImageData(0,0,100,100).data,t=(i.fillStyle="red",i.fillRect(0,0,100,100),r.createElement("div"));return t.style.backgroundImage="url("+n+")",t.style.height="100px",isGreenPixel(e)?loadSerializedSVG(createForeignObjectSVG(100,100,0,0,t)):Promise.reject(!1)}).then(function(e){return i.drawImage(e,0,0),isGreenPixel(i.getImageData(0,0,100,100).data)}).catch(function(){return!1})},createForeignObjectSVG=function(e,t,r,i,n){var a="http://www.w3.org/2000/svg",o=document.createElementNS(a,"svg"),a=document.createElementNS(a,"foreignObject");return o.setAttributeNS(null,"width",e.toString()),o.setAttributeNS(null,"height",t.toString()),a.setAttributeNS(null,"width","100%"),a.setAttributeNS(null,"height","100%"),a.setAttributeNS(null,"x",r.toString()),a.setAttributeNS(null,"y",i.toString()),a.setAttributeNS(null,"externalResourcesRequired","true"),o.appendChild(a),a.appendChild(n),o},loadSerializedSVG=function(i){return new Promise(function(e,t){var r=new Image;r.onload=function(){return e(r)},r.onerror=t,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(i))})},FEATURES={get SUPPORT_RANGE_BOUNDS(){var e=testRangeBounds(document);return Object.defineProperty(FEATURES,"SUPPORT_RANGE_BOUNDS",{value:e}),e},get SUPPORT_SVG_DRAWING(){var e=testSVG(document);return Object.defineProperty(FEATURES,"SUPPORT_SVG_DRAWING",{value:e}),e},get SUPPORT_FOREIGNOBJECT_DRAWING(){var e="function"==typeof Array.from&&"function"==typeof window.fetch?testForeignObject(document):Promise.resolve(!1);return Object.defineProperty(FEATURES,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:e}),e},get SUPPORT_CORS_IMAGES(){var e=testCORS();return Object.defineProperty(FEATURES,"SUPPORT_CORS_IMAGES",{value:e}),e},get SUPPORT_RESPONSE_TYPE(){var e=testResponseType();return Object.defineProperty(FEATURES,"SUPPORT_RESPONSE_TYPE",{value:e}),e},get SUPPORT_CORS_XHR(){var e="withCredentials"in new XMLHttpRequest;return Object.defineProperty(FEATURES,"SUPPORT_CORS_XHR",{value:e}),e}},Logger$1=function(){function r(e){var t=e.id,e=e.enabled;this.id=t,this.enabled=e,this.start=Date.now()}return r.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.debug?console.debug.apply(console,[this.id,this.getTime()+"ms"].concat(e)):this.info.apply(this,e))},r.prototype.getTime=function(){return Date.now()-this.start},r.create=function(e){r.instances[e.id]=new r(e)},r.destroy=function(e){delete r.instances[e]},r.getInstance=function(e){var t=r.instances[e];if(void 0===t)throw new Error("No logger instance found with id "+e);return t},r.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&"undefined"!=typeof window&&window.console&&"function"==typeof console.info&&console.info.apply(console,[this.id,this.getTime()+"ms"].concat(e))},r.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.error?console.error.apply(console,[this.id,this.getTime()+"ms"].concat(e)):this.info.apply(this,e))},r.instances={},r}(),CacheStorage=function(){function r(){}return r.create=function(e,t){return r._caches[e]=new Cache$1(e,t)},r.destroy=function(e){delete r._caches[e]},r.open=function(e){var t=r._caches[e];if(void 0!==t)return t;throw new Error('Cache with key "'+e+'" not found')},r.getOrigin=function(e){var t=r._link;return t?(t.href=e,t.href=t.href,t.protocol+t.hostname+t.port):"about:blank"},r.isSameOrigin=function(e){return r.getOrigin(e)===r._origin},r.setContext=function(e){r._link=e.document.createElement("a"),r._origin=r.getOrigin(e.location.href)},r.getInstance=function(){var e=r._current;if(null===e)throw new Error("No cache instance attached");return e},r.attachInstance=function(e){r._current=e},r.detachInstance=function(){r._current=null},r._caches={},r._origin="about:blank",r._current=null,r}(),Cache$1=function(){function e(e,t){this.id=e,this._options=t,this._cache={}}return e.prototype.addImage=function(e){var t=Promise.resolve();return this.has(e)||(isBlobImage(e)||isRenderable(e))&&(this._cache[e]=this.loadImage(e)),t},e.prototype.match=function(e){return this._cache[e]},e.prototype.loadImage=function(o){return __awaiter(this,void 0,void 0,function(){var t,i,r,n,a=this;return __generator(this,function(e){switch(e.label){case 0:return(t=CacheStorage.isSameOrigin(o),i=!isInlineImage(o)&&!0===this._options.useCORS&&FEATURES.SUPPORT_CORS_IMAGES&&!t,r=!isInlineImage(o)&&!t&&"string"==typeof this._options.proxy&&FEATURES.SUPPORT_CORS_XHR&&!i,t||!1!==this._options.allowTaint||isInlineImage(o)||r||i)?(n=o,r?[4,this.proxy(n)]:[3,2]):[2];case 1:n=e.sent(),e.label=2;case 2:return Logger$1.getInstance(this.id).debug("Added image "+o.substring(0,256)),[4,new Promise(function(e,t){var r=new Image;r.onload=function(){return e(r)},r.onerror=t,(isInlineBase64Image(n)||i)&&(r.crossOrigin="anonymous"),r.src=n,!0===r.complete&&setTimeout(function(){return e(r)},500),0<a._options.imageTimeout&&setTimeout(function(){return t("Timed out ("+a._options.imageTimeout+"ms) loading image")},a._options.imageTimeout)})];case 3:return[2,e.sent()]}})})},e.prototype.has=function(e){return void 0!==this._cache[e]},e.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},e.prototype.proxy=function(a){var o,s=this,l=this._options.proxy;if(l)return o=a.substring(0,256),new Promise(function(t,r){var e,i=FEATURES.SUPPORT_RESPONSE_TYPE?"blob":"text",n=new XMLHttpRequest;n.onload=function(){var e;200===n.status?"text"==i?t(n.response):((e=new FileReader).addEventListener("load",function(){return t(e.result)},!1),e.addEventListener("error",function(e){return r(e)},!1),e.readAsDataURL(n.response)):r("Failed to proxy resource "+o+" with status code "+n.status)},n.onerror=r,n.open("GET",l+"?url="+encodeURIComponent(a)+"&responseType="+i),"text"!=i&&n instanceof XMLHttpRequest&&(n.responseType=i),s._options.imageTimeout&&(e=s._options.imageTimeout,n.timeout=e,n.ontimeout=function(){return r("Timed out ("+e+"ms) proxying "+o)}),n.send()});throw new Error("No proxy defined")},e}(),INLINE_SVG=/^data:image\/svg\+xml/i,INLINE_BASE64=/^data:image\/.*;base64,/i,INLINE_IMG=/^data:image\/.*/i,isRenderable=function(e){return FEATURES.SUPPORT_SVG_DRAWING||!isSVG(e)},isInlineImage=function(e){return INLINE_IMG.test(e)},isInlineBase64Image=function(e){return INLINE_BASE64.test(e)},isBlobImage=function(e){return"blob"===e.substr(0,4)},isSVG=function(e){return"svg"===e.substr(-3).toLowerCase()||INLINE_SVG.test(e)},webkitGradient=function(e){var t=deg(180),i=[],n=CSSImageType.LINEAR_GRADIENT,r=CSSRadialShape.CIRCLE,a=CSSRadialExtent.FARTHEST_CORNER;return parseFunctionArgs(e).forEach(function(e,t){var r,e=e[0];if(0===t){if(isIdentToken(e)&&"linear"===e.value)return void(n=CSSImageType.LINEAR_GRADIENT);if(isIdentToken(e)&&"radial"===e.value)return void(n=CSSImageType.RADIAL_GRADIENT)}e.type===TokenType.FUNCTION&&("from"===e.name?(r=color$1.parse(e.values[0]),i.push({stop:ZERO_LENGTH,color:r})):"to"===e.name?(r=color$1.parse(e.values[0]),i.push({stop:HUNDRED_PERCENT,color:r})):"color-stop"===e.name&&2===(t=e.values.filter(nonFunctionArgSeparator)).length&&(r=color$1.parse(t[1]),e=t[0],isNumberToken(e))&&i.push({stop:{type:TokenType.PERCENTAGE_TOKEN,number:100*e.number,flags:e.flags},color:r}))}),n===CSSImageType.LINEAR_GRADIENT?{angle:(t+deg(180))%deg(360),stops:i,type:n}:{size:a,shape:r,stops:i,position:[],type:n}},CLOSEST_SIDE="closest-side",FARTHEST_SIDE="farthest-side",CLOSEST_CORNER="closest-corner",FARTHEST_CORNER="farthest-corner",CIRCLE="circle",ELLIPSE="ellipse",COVER="cover",CONTAIN="contain",radialGradient=function(e){var n=CSSRadialShape.CIRCLE,a=CSSRadialExtent.FARTHEST_CORNER,o=[],s=[];return parseFunctionArgs(e).forEach(function(e,t){var r,i=!0;0===t&&(r=!1,i=e.reduce(function(e,t){if(r)if(isIdentToken(t))switch(t.value){case"center":return s.push(FIFTY_PERCENT),e;case"top":case"left":return s.push(ZERO_LENGTH),e;case"right":case"bottom":return s.push(HUNDRED_PERCENT),e}else(isLengthPercentage(t)||isLength(t))&&s.push(t);else if(isIdentToken(t))switch(t.value){case CIRCLE:return n=CSSRadialShape.CIRCLE,!1;case ELLIPSE:return n=CSSRadialShape.ELLIPSE,!1;case"at":return!(r=!0);case CLOSEST_SIDE:return a=CSSRadialExtent.CLOSEST_SIDE,!1;case COVER:case FARTHEST_SIDE:return a=CSSRadialExtent.FARTHEST_SIDE,!1;case CONTAIN:case CLOSEST_CORNER:return a=CSSRadialExtent.CLOSEST_CORNER,!1;case FARTHEST_CORNER:return a=CSSRadialExtent.FARTHEST_CORNER,!1}else if(isLength(t)||isLengthPercentage(t))return(a=Array.isArray(a)?a:[]).push(t),!1;return e},i)),i&&(t=parseColorStop(e),o.push(t))}),{size:a,shape:n,stops:o,position:s,type:CSSImageType.RADIAL_GRADIENT}},prefixRadialGradient=function(e){var i=CSSRadialShape.CIRCLE,n=CSSRadialExtent.FARTHEST_CORNER,a=[],o=[];return parseFunctionArgs(e).forEach(function(e,t){var r=!0;0===t?r=e.reduce(function(e,t){if(isIdentToken(t))switch(t.value){case"center":return o.push(FIFTY_PERCENT),!1;case"top":case"left":return o.push(ZERO_LENGTH),!1;case"right":case"bottom":return o.push(HUNDRED_PERCENT),!1}else if(isLengthPercentage(t)||isLength(t))return o.push(t),!1;return e},r):1===t&&(r=e.reduce(function(e,t){if(isIdentToken(t))switch(t.value){case CIRCLE:return i=CSSRadialShape.CIRCLE,!1;case ELLIPSE:return i=CSSRadialShape.ELLIPSE,!1;case CONTAIN:case CLOSEST_SIDE:return n=CSSRadialExtent.CLOSEST_SIDE,!1;case FARTHEST_SIDE:return n=CSSRadialExtent.FARTHEST_SIDE,!1;case CLOSEST_CORNER:return n=CSSRadialExtent.CLOSEST_CORNER,!1;case COVER:case FARTHEST_CORNER:return n=CSSRadialExtent.FARTHEST_CORNER,!1}else if(isLength(t)||isLengthPercentage(t))return(n=Array.isArray(n)?n:[]).push(t),!1;return e},r)),r&&(t=parseColorStop(e),a.push(t))}),{size:n,shape:i,stops:a,position:o,type:CSSImageType.RADIAL_GRADIENT}},isLinearGradient=(!function(e){e[e.URL=0]="URL",e[e.LINEAR_GRADIENT=1]="LINEAR_GRADIENT",e[e.RADIAL_GRADIENT=2]="RADIAL_GRADIENT"}(CSSImageType=CSSImageType||{}),function(e){return e.type===CSSImageType.LINEAR_GRADIENT}),isRadialGradient=function(e){return e.type===CSSImageType.RADIAL_GRADIENT},image=(!function(e){e[e.CIRCLE=0]="CIRCLE",e[e.ELLIPSE=1]="ELLIPSE"}(CSSRadialShape=CSSRadialShape||{}),!function(e){e[e.CLOSEST_SIDE=0]="CLOSEST_SIDE",e[e.FARTHEST_SIDE=1]="FARTHEST_SIDE",e[e.CLOSEST_CORNER=2]="CLOSEST_CORNER",e[e.FARTHEST_CORNER=3]="FARTHEST_CORNER"}(CSSRadialExtent=CSSRadialExtent||{}),{name:"image",parse:function(e){if(e.type===TokenType.URL_TOKEN)return t={url:e.value,type:CSSImageType.URL},CacheStorage.getInstance().addImage(e.value),t;if(e.type!==TokenType.FUNCTION)throw new Error("Unsupported image type");var t=SUPPORTED_IMAGE_FUNCTIONS[e.name];if(void 0===t)throw new Error('Attempting to parse an unsupported image function "'+e.name+'"');return t(e.values)}});function isSupportedImage(e){return e.type!==TokenType.FUNCTION||SUPPORTED_IMAGE_FUNCTIONS[e.name]}var BACKGROUND_REPEAT,BACKGROUND_SIZE,BORDER_STYLE,FLOAT,LINE_BREAK,LIST_STYLE_POSITION,LIST_STYLE_TYPE,OVERFLOW,OVERFLOW_WRAP,TEXT_ALIGN,POSITION,TEXT_TRANSFORM,VISIBILITY,WORD_BREAK,FONT_STYLE,PseudoElementType,PathType,CORNER,SUPPORTED_IMAGE_FUNCTIONS={"linear-gradient":linearGradient,"-moz-linear-gradient":prefixLinearGradient,"-ms-linear-gradient":prefixLinearGradient,"-o-linear-gradient":prefixLinearGradient,"-webkit-linear-gradient":prefixLinearGradient,"radial-gradient":radialGradient,"-moz-radial-gradient":prefixRadialGradient,"-ms-radial-gradient":prefixRadialGradient,"-o-radial-gradient":prefixRadialGradient,"-webkit-radial-gradient":prefixRadialGradient,"-webkit-gradient":webkitGradient},backgroundImage={name:"background-image",initialValue:"none",type:PropertyDescriptorParsingType.LIST,prefix:!1,parse:function(e){var t;return 0===e.length||(t=e[0]).type===TokenType.IDENT_TOKEN&&"none"===t.value?[]:e.filter(function(e){return nonFunctionArgSeparator(e)&&isSupportedImage(e)}).map(image.parse)}},backgroundOrigin={name:"background-origin",initialValue:"border-box",prefix:!1,type:PropertyDescriptorParsingType.LIST,parse:function(e){return e.map(function(e){if(isIdentToken(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},backgroundPosition={name:"background-position",initialValue:"0% 0%",type:PropertyDescriptorParsingType.LIST,prefix:!1,parse:function(e){return parseFunctionArgs(e).map(function(e){return e.filter(isLengthPercentage)}).map(parseLengthPercentageTuple)}},backgroundRepeat=(!function(e){e[e.REPEAT=0]="REPEAT",e[e.NO_REPEAT=1]="NO_REPEAT",e[e.REPEAT_X=2]="REPEAT_X",e[e.REPEAT_Y=3]="REPEAT_Y"}(BACKGROUND_REPEAT=BACKGROUND_REPEAT||{}),{name:"background-repeat",initialValue:"repeat",prefix:!1,type:PropertyDescriptorParsingType.LIST,parse:function(e){return parseFunctionArgs(e).map(function(e){return e.filter(isIdentToken).map(function(e){return e.value}).join(" ")}).map(parseBackgroundRepeat)}}),parseBackgroundRepeat=function(e){switch(e){case"no-repeat":return BACKGROUND_REPEAT.NO_REPEAT;case"repeat-x":case"repeat no-repeat":return BACKGROUND_REPEAT.REPEAT_X;case"repeat-y":case"no-repeat repeat":return BACKGROUND_REPEAT.REPEAT_Y;default:return BACKGROUND_REPEAT.REPEAT}},backgroundSize=(!function(e){e.AUTO="auto",e.CONTAIN="contain",e.COVER="cover"}(BACKGROUND_SIZE=BACKGROUND_SIZE||{}),{name:"background-size",initialValue:"0",prefix:!1,type:PropertyDescriptorParsingType.LIST,parse:function(e){return parseFunctionArgs(e).map(function(e){return e.filter(isBackgroundSizeInfoToken)})}}),isBackgroundSizeInfoToken=function(e){return isIdentToken(e)||isLengthPercentage(e)},borderColorForSide=function(e){return{name:"border-"+e+"-color",initialValue:"transparent",prefix:!1,type:PropertyDescriptorParsingType.TYPE_VALUE,format:"color"}},borderTopColor=borderColorForSide("top"),borderRightColor=borderColorForSide("right"),borderBottomColor=borderColorForSide("bottom"),borderLeftColor=borderColorForSide("left"),borderRadiusForSide=function(e){return{name:"border-radius-"+e,initialValue:"0 0",prefix:!1,type:PropertyDescriptorParsingType.LIST,parse:function(e){return parseLengthPercentageTuple(e.filter(isLengthPercentage))}}},borderTopLeftRadius=borderRadiusForSide("top-left"),borderTopRightRadius=borderRadiusForSide("top-right"),borderBottomRightRadius=borderRadiusForSide("bottom-right"),borderBottomLeftRadius=borderRadiusForSide("bottom-left"),borderStyleForSide=(!function(e){e[e.NONE=0]="NONE",e[e.SOLID=1]="SOLID"}(BORDER_STYLE=BORDER_STYLE||{}),function(e){return{name:"border-"+e+"-style",initialValue:"solid",prefix:!1,type:PropertyDescriptorParsingType.IDENT_VALUE,parse:function(e){return"none"===e?BORDER_STYLE.NONE:BORDER_STYLE.SOLID}}}),borderTopStyle=borderStyleForSide("top"),borderRightStyle=borderStyleForSide("right"),borderBottomStyle=borderStyleForSide("bottom"),borderLeftStyle=borderStyleForSide("left"),borderWidthForSide=function(e){return{name:"border-"+e+"-width",initialValue:"0",type:PropertyDescriptorParsingType.VALUE,prefix:!1,parse:function(e){return isDimensionToken(e)?e.number:0}}},borderTopWidth=borderWidthForSide("top"),borderRightWidth=borderWidthForSide("right"),borderBottomWidth=borderWidthForSide("bottom"),borderLeftWidth=borderWidthForSide("left"),color$1$1={name:"color",initialValue:"transparent",prefix:!1,type:PropertyDescriptorParsingType.TYPE_VALUE,format:"color"},display={name:"display",initialValue:"inline-block",prefix:!1,type:PropertyDescriptorParsingType.LIST,parse:function(e){return e.filter(isIdentToken).reduce(function(e,t){return e|parseDisplayValue(t.value)},0)}},parseDisplayValue=function(e){switch(e){case"block":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},float$1=(!function(e){e[e.NONE=0]="NONE",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.INLINE_START=3]="INLINE_START",e[e.INLINE_END=4]="INLINE_END"}(FLOAT=FLOAT||{}),{name:"float",initialValue:"none",prefix:!1,type:PropertyDescriptorParsingType.IDENT_VALUE,parse:function(e){switch(e){case"left":return FLOAT.LEFT;case"right":return FLOAT.RIGHT;case"inline-start":return FLOAT.INLINE_START;case"inline-end":return FLOAT.INLINE_END}return FLOAT.NONE}}),letterSpacing={name:"letter-spacing",initialValue:"0",prefix:!1,type:PropertyDescriptorParsingType.VALUE,parse:function(e){return!(e.type===TokenType.IDENT_TOKEN&&"normal"===e.value||e.type!==TokenType.NUMBER_TOKEN&&e.type!==TokenType.DIMENSION_TOKEN)?e.number:0}},lineBreak=(!function(e){e.NORMAL="normal",e.STRICT="strict"}(LINE_BREAK=LINE_BREAK||{}),{name:"line-break",initialValue:"normal",prefix:!1,type:PropertyDescriptorParsingType.IDENT_VALUE,parse:function(e){return"strict"!==e?LINE_BREAK.NORMAL:LINE_BREAK.STRICT}}),lineHeight={name:"line-height",initialValue:"normal",prefix:!1,type:PropertyDescriptorParsingType.TOKEN_VALUE},computeLineHeight=function(e,t){return isIdentToken(e)&&"normal"===e.value?1.2*t:e.type===TokenType.NUMBER_TOKEN?t*e.number:isLengthPercentage(e)?getAbsoluteValue(e,t):t},listStyleImage={name:"list-style-image",initialValue:"none",type:PropertyDescriptorParsingType.VALUE,prefix:!1,parse:function(e){return e.type===TokenType.IDENT_TOKEN&&"none"===e.value?null:image.parse(e)}},listStylePosition=(!function(e){e[e.INSIDE=0]="INSIDE",e[e.OUTSIDE=1]="OUTSIDE"}(LIST_STYLE_POSITION=LIST_STYLE_POSITION||{}),{name:"list-style-position",initialValue:"outside",prefix:!1,type:PropertyDescriptorParsingType.IDENT_VALUE,parse:function(e){return"inside"!==e?LIST_STYLE_POSITION.OUTSIDE:LIST_STYLE_POSITION.INSIDE}}),listStyleType=(!function(e){e[e.NONE=-1]="NONE",e[e.DISC=0]="DISC",e[e.CIRCLE=1]="CIRCLE",e[e.SQUARE=2]="SQUARE",e[e.DECIMAL=3]="DECIMAL",e[e.CJK_DECIMAL=4]="CJK_DECIMAL",e[e.DECIMAL_LEADING_ZERO=5]="DECIMAL_LEADING_ZERO",e[e.LOWER_ROMAN=6]="LOWER_ROMAN",e[e.UPPER_ROMAN=7]="UPPER_ROMAN",e[e.LOWER_GREEK=8]="LOWER_GREEK",e[e.LOWER_ALPHA=9]="LOWER_ALPHA",e[e.UPPER_ALPHA=10]="UPPER_ALPHA",e[e.ARABIC_INDIC=11]="ARABIC_INDIC",e[e.ARMENIAN=12]="ARMENIAN",e[e.BENGALI=13]="BENGALI",e[e.CAMBODIAN=14]="CAMBODIAN",e[e.CJK_EARTHLY_BRANCH=15]="CJK_EARTHLY_BRANCH",e[e.CJK_HEAVENLY_STEM=16]="CJK_HEAVENLY_STEM",e[e.CJK_IDEOGRAPHIC=17]="CJK_IDEOGRAPHIC",e[e.DEVANAGARI=18]="DEVANAGARI",e[e.ETHIOPIC_NUMERIC=19]="ETHIOPIC_NUMERIC",e[e.GEORGIAN=20]="GEORGIAN",e[e.GUJARATI=21]="GUJARATI",e[e.GURMUKHI=22]="GURMUKHI",e[e.HEBREW=22]="HEBREW",e[e.HIRAGANA=23]="HIRAGANA",e[e.HIRAGANA_IROHA=24]="HIRAGANA_IROHA",e[e.JAPANESE_FORMAL=25]="JAPANESE_FORMAL",e[e.JAPANESE_INFORMAL=26]="JAPANESE_INFORMAL",e[e.KANNADA=27]="KANNADA",e[e.KATAKANA=28]="KATAKANA",e[e.KATAKANA_IROHA=29]="KATAKANA_IROHA",e[e.KHMER=30]="KHMER",e[e.KOREAN_HANGUL_FORMAL=31]="KOREAN_HANGUL_FORMAL",e[e.KOREAN_HANJA_FORMAL=32]="KOREAN_HANJA_FORMAL",e[e.KOREAN_HANJA_INFORMAL=33]="KOREAN_HANJA_INFORMAL",e[e.LAO=34]="LAO",e[e.LOWER_ARMENIAN=35]="LOWER_ARMENIAN",e[e.MALAYALAM=36]="MALAYALAM",e[e.MONGOLIAN=37]="MONGOLIAN",e[e.MYANMAR=38]="MYANMAR",e[e.ORIYA=39]="ORIYA",e[e.PERSIAN=40]="PERSIAN",e[e.SIMP_CHINESE_FORMAL=41]="SIMP_CHINESE_FORMAL",e[e.SIMP_CHINESE_INFORMAL=42]="SIMP_CHINESE_INFORMAL",e[e.TAMIL=43]="TAMIL",e[e.TELUGU=44]="TELUGU",e[e.THAI=45]="THAI",e[e.TIBETAN=46]="TIBETAN",e[e.TRAD_CHINESE_FORMAL=47]="TRAD_CHINESE_FORMAL",e[e.TRAD_CHINESE_INFORMAL=48]="TRAD_CHINESE_INFORMAL",e[e.UPPER_ARMENIAN=49]="UPPER_ARMENIAN",e[e.DISCLOSURE_OPEN=50]="DISCLOSURE_OPEN",e[e.DISCLOSURE_CLOSED=51]="DISCLOSURE_CLOSED"}(LIST_STYLE_TYPE=LIST_STYLE_TYPE||{}),{name:"list-style-type",initialValue:"none",prefix:!1,type:PropertyDescriptorParsingType.IDENT_VALUE,parse:function(e){switch(e){case"disc":return LIST_STYLE_TYPE.DISC;case"circle":return LIST_STYLE_TYPE.CIRCLE;case"square":return LIST_STYLE_TYPE.SQUARE;case"decimal":return LIST_STYLE_TYPE.DECIMAL;case"cjk-decimal":return LIST_STYLE_TYPE.CJK_DECIMAL;case"decimal-leading-zero":return LIST_STYLE_TYPE.DECIMAL_LEADING_ZERO;case"lower-roman":return LIST_STYLE_TYPE.LOWER_ROMAN;case"upper-roman":return LIST_STYLE_TYPE.UPPER_ROMAN;case"lower-greek":return LIST_STYLE_TYPE.LOWER_GREEK;case"lower-alpha":return LIST_STYLE_TYPE.LOWER_ALPHA;case"upper-alpha":return LIST_STYLE_TYPE.UPPER_ALPHA;case"arabic-indic":return LIST_STYLE_TYPE.ARABIC_INDIC;case"armenian":return LIST_STYLE_TYPE.ARMENIAN;case"bengali":return LIST_STYLE_TYPE.BENGALI;case"cambodian":return LIST_STYLE_TYPE.CAMBODIAN;case"cjk-earthly-branch":return LIST_STYLE_TYPE.CJK_EARTHLY_BRANCH;case"cjk-heavenly-stem":return LIST_STYLE_TYPE.CJK_HEAVENLY_STEM;case"cjk-ideographic":return LIST_STYLE_TYPE.CJK_IDEOGRAPHIC;case"devanagari":return LIST_STYLE_TYPE.DEVANAGARI;case"ethiopic-numeric":return LIST_STYLE_TYPE.ETHIOPIC_NUMERIC;case"georgian":return LIST_STYLE_TYPE.GEORGIAN;case"gujarati":return LIST_STYLE_TYPE.GUJARATI;case"gurmukhi":return LIST_STYLE_TYPE.GURMUKHI;case"hebrew":return LIST_STYLE_TYPE.HEBREW;case"hiragana":return LIST_STYLE_TYPE.HIRAGANA;case"hiragana-iroha":return LIST_STYLE_TYPE.HIRAGANA_IROHA;case"japanese-formal":return LIST_STYLE_TYPE.JAPANESE_FORMAL;case"japanese-informal":return LIST_STYLE_TYPE.JAPANESE_INFORMAL;case"kannada":return LIST_STYLE_TYPE.KANNADA;case"katakana":return LIST_STYLE_TYPE.KATAKANA;case"katakana-iroha":return LIST_STYLE_TYPE.KATAKANA_IROHA;case"khmer":return LIST_STYLE_TYPE.KHMER;case"korean-hangul-formal":return LIST_STYLE_TYPE.KOREAN_HANGUL_FORMAL;case"korean-hanja-formal":return LIST_STYLE_TYPE.KOREAN_HANJA_FORMAL;case"korean-hanja-informal":return LIST_STYLE_TYPE.KOREAN_HANJA_INFORMAL;case"lao":return LIST_STYLE_TYPE.LAO;case"lower-armenian":return LIST_STYLE_TYPE.LOWER_ARMENIAN;case"malayalam":return LIST_STYLE_TYPE.MALAYALAM;case"mongolian":return LIST_STYLE_TYPE.MONGOLIAN;case"myanmar":return LIST_STYLE_TYPE.MYANMAR;case"oriya":return LIST_STYLE_TYPE.ORIYA;case"persian":return LIST_STYLE_TYPE.PERSIAN;case"simp-chinese-formal":return LIST_STYLE_TYPE.SIMP_CHINESE_FORMAL;case"simp-chinese-informal":return LIST_STYLE_TYPE.SIMP_CHINESE_INFORMAL;case"tamil":return LIST_STYLE_TYPE.TAMIL;case"telugu":return LIST_STYLE_TYPE.TELUGU;case"thai":return LIST_STYLE_TYPE.THAI;case"tibetan":return LIST_STYLE_TYPE.TIBETAN;case"trad-chinese-formal":return LIST_STYLE_TYPE.TRAD_CHINESE_FORMAL;case"trad-chinese-informal":return LIST_STYLE_TYPE.TRAD_CHINESE_INFORMAL;case"upper-armenian":return LIST_STYLE_TYPE.UPPER_ARMENIAN;case"disclosure-open":return LIST_STYLE_TYPE.DISCLOSURE_OPEN;case"disclosure-closed":return LIST_STYLE_TYPE.DISCLOSURE_CLOSED;default:return LIST_STYLE_TYPE.NONE}}}),marginForSide=function(e){return{name:"margin-"+e,initialValue:"0",prefix:!1,type:PropertyDescriptorParsingType.TOKEN_VALUE}},marginTop=marginForSide("top"),marginRight=marginForSide("right"),marginBottom=marginForSide("bottom"),marginLeft=marginForSide("left"),overflow=(!function(e){e[e.VISIBLE=0]="VISIBLE",e[e.HIDDEN=1]="HIDDEN",e[e.SCROLL=2]="SCROLL",e[e.AUTO=3]="AUTO"}(OVERFLOW=OVERFLOW||{}),{name:"overflow",initialValue:"visible",prefix:!1,type:PropertyDescriptorParsingType.LIST,parse:function(e){return e.filter(isIdentToken).map(function(e){switch(e.value){case"hidden":return OVERFLOW.HIDDEN;case"scroll":return OVERFLOW.SCROLL;case"auto":return OVERFLOW.AUTO;default:return OVERFLOW.VISIBLE}})}}),overflowWrap=(!function(e){e.NORMAL="normal",e.BREAK_WORD="break-word"}(OVERFLOW_WRAP=OVERFLOW_WRAP||{}),{name:"overflow-wrap",initialValue:"normal",prefix:!1,type:PropertyDescriptorParsingType.IDENT_VALUE,parse:function(e){return"break-word"!==e?OVERFLOW_WRAP.NORMAL:OVERFLOW_WRAP.BREAK_WORD}}),paddingForSide=function(e){return{name:"padding-"+e,initialValue:"0",prefix:!1,type:PropertyDescriptorParsingType.TYPE_VALUE,format:"length-percentage"}},paddingTop=paddingForSide("top"),paddingRight=paddingForSide("right"),paddingBottom=paddingForSide("bottom"),paddingLeft=paddingForSide("left"),textAlign=(!function(e){e[e.LEFT=0]="LEFT",e[e.CENTER=1]="CENTER",e[e.RIGHT=2]="RIGHT"}(TEXT_ALIGN=TEXT_ALIGN||{}),{name:"text-align",initialValue:"left",prefix:!1,type:PropertyDescriptorParsingType.IDENT_VALUE,parse:function(e){switch(e){case"right":return TEXT_ALIGN.RIGHT;case"center":case"justify":return TEXT_ALIGN.CENTER;default:return TEXT_ALIGN.LEFT}}}),position=(!function(e){e[e.STATIC=0]="STATIC",e[e.RELATIVE=1]="RELATIVE",e[e.ABSOLUTE=2]="ABSOLUTE",e[e.FIXED=3]="FIXED",e[e.STICKY=4]="STICKY"}(POSITION=POSITION||{}),{name:"position",initialValue:"static",prefix:!1,type:PropertyDescriptorParsingType.IDENT_VALUE,parse:function(e){switch(e){case"relative":return POSITION.RELATIVE;case"absolute":return POSITION.ABSOLUTE;case"fixed":return POSITION.FIXED;case"sticky":return POSITION.STICKY}return POSITION.STATIC}}),textShadow={name:"text-shadow",initialValue:"none",type:PropertyDescriptorParsingType.LIST,prefix:!1,parse:function(e){return 1===e.length&&isIdentWithValue(e[0],"none")?[]:parseFunctionArgs(e).map(function(e){for(var t={color:COLORS.TRANSPARENT,offsetX:ZERO_LENGTH,offsetY:ZERO_LENGTH,blur:ZERO_LENGTH},r=0,i=0;i<e.length;i++){var n=e[i];isLength(n)?(0===r?t.offsetX=n:1===r?t.offsetY=n:t.blur=n,r++):t.color=color$1.parse(n)}return t})}},textTransform=(!function(e){e[e.NONE=0]="NONE",e[e.LOWERCASE=1]="LOWERCASE",e[e.UPPERCASE=2]="UPPERCASE",e[e.CAPITALIZE=3]="CAPITALIZE"}(TEXT_TRANSFORM=TEXT_TRANSFORM||{}),{name:"text-transform",initialValue:"none",prefix:!1,type:PropertyDescriptorParsingType.IDENT_VALUE,parse:function(e){switch(e){case"uppercase":return TEXT_TRANSFORM.UPPERCASE;case"lowercase":return TEXT_TRANSFORM.LOWERCASE;case"capitalize":return TEXT_TRANSFORM.CAPITALIZE}return TEXT_TRANSFORM.NONE}}),transform={name:"transform",initialValue:"none",prefix:!0,type:PropertyDescriptorParsingType.VALUE,parse:function(e){if(e.type===TokenType.IDENT_TOKEN&&"none"===e.value)return null;if(e.type!==TokenType.FUNCTION)return null;var t=SUPPORTED_TRANSFORM_FUNCTIONS[e.name];if(void 0===t)throw new Error('Attempting to parse an unsupported transform function "'+e.name+'"');return t(e.values)}},matrix=function(e){e=e.filter(function(e){return e.type===TokenType.NUMBER_TOKEN}).map(function(e){return e.number});return 6===e.length?e:null},matrix3d=function(e){var e=e.filter(function(e){return e.type===TokenType.NUMBER_TOKEN}).map(function(e){return e.number}),t=e[0],r=e[1],i=(e[2],e[3],e[4]),n=e[5],a=(e[6],e[7],e[8],e[9],e[10],e[11],e[12]),o=e[13];e[14],e[15];return 16===e.length?[t,r,i,n,a,o]:null},SUPPORTED_TRANSFORM_FUNCTIONS={matrix:matrix,matrix3d:matrix3d},DEFAULT_VALUE={type:TokenType.PERCENTAGE_TOKEN,number:50,flags:FLAG_INTEGER},DEFAULT=[DEFAULT_VALUE,DEFAULT_VALUE],transformOrigin={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:PropertyDescriptorParsingType.LIST,parse:function(e){e=e.filter(isLengthPercentage);return 2!==e.length?DEFAULT:[e[0],e[1]]}},visibility=(!function(e){e[e.VISIBLE=0]="VISIBLE",e[e.HIDDEN=1]="HIDDEN",e[e.COLLAPSE=2]="COLLAPSE"}(VISIBILITY=VISIBILITY||{}),{name:"visible",initialValue:"none",prefix:!1,type:PropertyDescriptorParsingType.IDENT_VALUE,parse:function(e){switch(e){case"hidden":return VISIBILITY.HIDDEN;case"collapse":return VISIBILITY.COLLAPSE;default:return VISIBILITY.VISIBLE}}}),wordBreak=(!function(e){e.NORMAL="normal",e.BREAK_ALL="break-all",e.KEEP_ALL="keep-all"}(WORD_BREAK=WORD_BREAK||{}),{name:"word-break",initialValue:"normal",prefix:!1,type:PropertyDescriptorParsingType.IDENT_VALUE,parse:function(e){switch(e){case"break-all":return WORD_BREAK.BREAK_ALL;case"keep-all":return WORD_BREAK.KEEP_ALL;default:return WORD_BREAK.NORMAL}}}),zIndex={name:"z-index",initialValue:"auto",prefix:!1,type:PropertyDescriptorParsingType.VALUE,parse:function(e){if(e.type===TokenType.IDENT_TOKEN)return{auto:!0,order:0};if(isNumberToken(e))return{auto:!1,order:e.number};throw new Error("Invalid z-index number parsed")}},opacity={name:"opacity",initialValue:"1",type:PropertyDescriptorParsingType.VALUE,prefix:!1,parse:function(e){return isNumberToken(e)?e.number:1}},textDecorationColor={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:PropertyDescriptorParsingType.TYPE_VALUE,format:"color"},textDecorationLine={name:"text-decoration-line",initialValue:"none",prefix:!1,type:PropertyDescriptorParsingType.LIST,parse:function(e){return e.filter(isIdentToken).map(function(e){switch(e.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(e){return 0!==e})}},fontFamily={name:"font-family",initialValue:"",prefix:!1,type:PropertyDescriptorParsingType.LIST,parse:function(e){var t=[],r=[];return e.forEach(function(e){switch(e.type){case TokenType.IDENT_TOKEN:case TokenType.STRING_TOKEN:t.push(e.value);break;case TokenType.NUMBER_TOKEN:t.push(e.number.toString());break;case TokenType.COMMA_TOKEN:r.push(t.join(" ")),t.length=0}}),t.length&&r.push(t.join(" ")),r.map(function(e){return-1===e.indexOf(" ")?e:"'"+e+"'"})}},fontSize={name:"font-size",initialValue:"0",prefix:!1,type:PropertyDescriptorParsingType.TYPE_VALUE,format:"length"},fontWeight={name:"font-weight",initialValue:"normal",type:PropertyDescriptorParsingType.VALUE,prefix:!1,parse:function(e){return isNumberToken(e)?e.number:!isIdentToken(e)||"bold"!==e.value?400:700}},fontVariant={name:"font-variant",initialValue:"none",type:PropertyDescriptorParsingType.LIST,prefix:!1,parse:function(e){return e.filter(isIdentToken).map(function(e){return e.value})}},fontStyle=(!function(e){e.NORMAL="normal",e.ITALIC="italic",e.OBLIQUE="oblique"}(FONT_STYLE=FONT_STYLE||{}),{name:"font-style",initialValue:"normal",prefix:!1,type:PropertyDescriptorParsingType.IDENT_VALUE,parse:function(e){switch(e){case"oblique":return FONT_STYLE.OBLIQUE;case"italic":return FONT_STYLE.ITALIC;default:return FONT_STYLE.NORMAL}}}),contains=function(e,t){return 0!=(e&t)},content={name:"content",initialValue:"none",type:PropertyDescriptorParsingType.LIST,prefix:!1,parse:function(e){var t;return 0===e.length||(t=e[0]).type===TokenType.IDENT_TOKEN&&"none"===t.value?[]:e}},counterIncrement={name:"counter-increment",initialValue:"none",prefix:!0,type:PropertyDescriptorParsingType.LIST,parse:function(e){if(0===e.length)return null;var t=e[0];if(t.type===TokenType.IDENT_TOKEN&&"none"===t.value)return null;for(var r=[],i=e.filter(nonWhiteSpace),n=0;n<i.length;n++){var a=i[n],o=i[n+1];a.type===TokenType.IDENT_TOKEN&&(o=o&&isNumberToken(o)?o.number:1,r.push({counter:a.value,increment:o}))}return r}},counterReset={name:"counter-reset",initialValue:"none",prefix:!0,type:PropertyDescriptorParsingType.LIST,parse:function(e){if(0===e.length)return[];for(var t=[],r=e.filter(nonWhiteSpace),i=0;i<r.length;i++){var n=r[i],a=r[i+1];isIdentToken(n)&&"none"!==n.value&&(a=a&&isNumberToken(a)?a.number:0,t.push({counter:n.value,reset:a}))}return t}},quotes={name:"quotes",initialValue:"none",prefix:!0,type:PropertyDescriptorParsingType.LIST,parse:function(e){if(0===e.length)return null;var t=e[0];if(t.type===TokenType.IDENT_TOKEN&&"none"===t.value)return null;var r=[],i=e.filter(isStringToken);if(i.length%2!=0)return null;for(var n=0;n<i.length;n+=2){var a=i[n].value,o=i[n+1].value;r.push({open:a,close:o})}return r}},getQuote=function(e,t,r){return e&&(t=e[Math.min(t,e.length-1)])?r?t.open:t.close:""},boxShadow={name:"box-shadow",initialValue:"none",type:PropertyDescriptorParsingType.LIST,prefix:!1,parse:function(e){return 1===e.length&&isIdentWithValue(e[0],"none")?[]:parseFunctionArgs(e).map(function(e){for(var t={color:255,offsetX:ZERO_LENGTH,offsetY:ZERO_LENGTH,blur:ZERO_LENGTH,spread:ZERO_LENGTH,inset:!1},r=0,i=0;i<e.length;i++){var n=e[i];isIdentWithValue(n,"inset")?t.inset=!0:isLength(n)?(0===r?t.offsetX=n:1===r?t.offsetY=n:2===r?t.blur=n:t.spread=n,r++):t.color=color$1.parse(n)}return t})}},CSSParsedDeclaration=function(){function e(e){this.backgroundClip=parse$2(backgroundClip,e.backgroundClip),this.backgroundColor=parse$2(backgroundColor,e.backgroundColor),this.backgroundImage=parse$2(backgroundImage,e.backgroundImage),this.backgroundOrigin=parse$2(backgroundOrigin,e.backgroundOrigin),this.backgroundPosition=parse$2(backgroundPosition,e.backgroundPosition),this.backgroundRepeat=parse$2(backgroundRepeat,e.backgroundRepeat),this.backgroundSize=parse$2(backgroundSize,e.backgroundSize),this.borderTopColor=parse$2(borderTopColor,e.borderTopColor),this.borderRightColor=parse$2(borderRightColor,e.borderRightColor),this.borderBottomColor=parse$2(borderBottomColor,e.borderBottomColor),this.borderLeftColor=parse$2(borderLeftColor,e.borderLeftColor),this.borderTopLeftRadius=parse$2(borderTopLeftRadius,e.borderTopLeftRadius),this.borderTopRightRadius=parse$2(borderTopRightRadius,e.borderTopRightRadius),this.borderBottomRightRadius=parse$2(borderBottomRightRadius,e.borderBottomRightRadius),this.borderBottomLeftRadius=parse$2(borderBottomLeftRadius,e.borderBottomLeftRadius),this.borderTopStyle=parse$2(borderTopStyle,e.borderTopStyle),this.borderRightStyle=parse$2(borderRightStyle,e.borderRightStyle),this.borderBottomStyle=parse$2(borderBottomStyle,e.borderBottomStyle),this.borderLeftStyle=parse$2(borderLeftStyle,e.borderLeftStyle),this.borderTopWidth=parse$2(borderTopWidth,e.borderTopWidth),this.borderRightWidth=parse$2(borderRightWidth,e.borderRightWidth),this.borderBottomWidth=parse$2(borderBottomWidth,e.borderBottomWidth),this.borderLeftWidth=parse$2(borderLeftWidth,e.borderLeftWidth),this.boxShadow=parse$2(boxShadow,e.boxShadow),this.color=parse$2(color$1$1,e.color),this.display=parse$2(display,e.display),this.float=parse$2(float$1,e.cssFloat),this.fontFamily=parse$2(fontFamily,e.fontFamily),this.fontSize=parse$2(fontSize,e.fontSize),this.fontStyle=parse$2(fontStyle,e.fontStyle),this.fontVariant=parse$2(fontVariant,e.fontVariant),this.fontWeight=parse$2(fontWeight,e.fontWeight),this.letterSpacing=parse$2(letterSpacing,e.letterSpacing),this.lineBreak=parse$2(lineBreak,e.lineBreak),this.lineHeight=parse$2(lineHeight,e.lineHeight),this.listStyleImage=parse$2(listStyleImage,e.listStyleImage),this.listStylePosition=parse$2(listStylePosition,e.listStylePosition),this.listStyleType=parse$2(listStyleType,e.listStyleType),this.marginTop=parse$2(marginTop,e.marginTop),this.marginRight=parse$2(marginRight,e.marginRight),this.marginBottom=parse$2(marginBottom,e.marginBottom),this.marginLeft=parse$2(marginLeft,e.marginLeft),this.opacity=parse$2(opacity,e.opacity);var t=parse$2(overflow,e.overflow);this.overflowX=t[0],this.overflowY=t[1<t.length?1:0],this.overflowWrap=parse$2(overflowWrap,e.overflowWrap),this.paddingTop=parse$2(paddingTop,e.paddingTop),this.paddingRight=parse$2(paddingRight,e.paddingRight),this.paddingBottom=parse$2(paddingBottom,e.paddingBottom),this.paddingLeft=parse$2(paddingLeft,e.paddingLeft),this.position=parse$2(position,e.position),this.textAlign=parse$2(textAlign,e.textAlign),this.textDecorationColor=parse$2(textDecorationColor,e.textDecorationColor||e.color),this.textDecorationLine=parse$2(textDecorationLine,e.textDecorationLine),this.textShadow=parse$2(textShadow,e.textShadow),this.textTransform=parse$2(textTransform,e.textTransform),this.transform=parse$2(transform,e.transform),this.transformOrigin=parse$2(transformOrigin,e.transformOrigin),this.visibility=parse$2(visibility,e.visibility),this.wordBreak=parse$2(wordBreak,e.wordBreak),this.zIndex=parse$2(zIndex,e.zIndex)}return e.prototype.isVisible=function(){return 0<this.display&&0<this.opacity&&this.visibility===VISIBILITY.VISIBLE},e.prototype.isTransparent=function(){return isTransparent(this.backgroundColor)},e.prototype.isTransformed=function(){return null!==this.transform},e.prototype.isPositioned=function(){return this.position!==POSITION.STATIC},e.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},e.prototype.isFloating=function(){return this.float!==FLOAT.NONE},e.prototype.isInlineLevel=function(){return contains(this.display,4)||contains(this.display,33554432)||contains(this.display,268435456)||contains(this.display,536870912)||contains(this.display,67108864)||contains(this.display,134217728)},e}(),CSSParsedPseudoDeclaration=function(e){this.content=parse$2(content,e.content),this.quotes=parse$2(quotes,e.quotes)},CSSParsedCounterDeclaration=function(e){this.counterIncrement=parse$2(counterIncrement,e.counterIncrement),this.counterReset=parse$2(counterReset,e.counterReset)},parse$2=function(e,t){var r=new Tokenizer,t=null!=t?t.toString():e.initialValue,i=(r.write(t),new Parser(r.read()));switch(e.type){case PropertyDescriptorParsingType.IDENT_VALUE:var n=i.parseComponentValue();return e.parse(isIdentToken(n)?n.value:e.initialValue);case PropertyDescriptorParsingType.VALUE:return e.parse(i.parseComponentValue());case PropertyDescriptorParsingType.LIST:return e.parse(i.parseComponentValues());case PropertyDescriptorParsingType.TOKEN_VALUE:return i.parseComponentValue();case PropertyDescriptorParsingType.TYPE_VALUE:switch(e.format){case"angle":return angle.parse(i.parseComponentValue());case"color":return color$1.parse(i.parseComponentValue());case"image":return image.parse(i.parseComponentValue());case"length":var a=i.parseComponentValue();return isLength(a)?a:ZERO_LENGTH;case"length-percentage":a=i.parseComponentValue();return isLengthPercentage(a)?a:ZERO_LENGTH}}throw new Error("Attempting to parse unsupported css format type "+e.format)},ElementContainer=function(e){this.styles=new CSSParsedDeclaration(window.getComputedStyle(e,null)),this.textNodes=[],this.elements=[],null!==this.styles.transform&&isHTMLElementNode(e)&&(e.style.transform="none"),this.bounds=parseBounds(e),this.flags=0},TextBounds=function(e,t){this.text=e,this.bounds=t},parseTextBounds=function(e,r,i){var e=breakText(e,r),n=[],a=0;return e.forEach(function(e){var t;r.textDecorationLine.length||0<e.trim().length?FEATURES.SUPPORT_RANGE_BOUNDS?n.push(new TextBounds(e,getRangeBounds(i,a,e.length))):(t=i.splitText(e.length),n.push(new TextBounds(e,getWrapperBounds(i))),i=t):FEATURES.SUPPORT_RANGE_BOUNDS||(i=i.splitText(e.length)),a+=e.length}),n},getWrapperBounds=function(e){var t=e.ownerDocument;if(t){var t=t.createElement("html2canvaswrapper"),r=(t.appendChild(e.cloneNode(!0)),e.parentNode);if(r)return r.replaceChild(t,e),e=parseBounds(t),t.firstChild&&r.replaceChild(t.firstChild,t),e}return new Bounds(0,0,0,0)},getRangeBounds=function(e,t,r){var i=e.ownerDocument;if(i)return(i=i.createRange()).setStart(e,t),i.setEnd(e,t+r),Bounds.fromClientRect(i.getBoundingClientRect());throw new Error("Node has no owner document")},breakText=function(e,t){return 0!==t.letterSpacing?toCodePoints(e).map(function(e){return fromCodePoint(e)}):breakWords(e,t)},breakWords=function(e,t){for(var r,i=LineBreaker(e,{lineBreak:t.lineBreak,wordBreak:t.overflowWrap===OVERFLOW_WRAP.BREAK_WORD?"break-word":t.wordBreak}),n=[];!(r=i.next()).done;)r.value&&n.push(r.value.slice());return n},TextContainer=function(e,t){this.text=transform$1(e.data,t.textTransform),this.textBounds=parseTextBounds(this.text,t,e)},transform$1=function(e,t){switch(t){case TEXT_TRANSFORM.LOWERCASE:return e.toLowerCase();case TEXT_TRANSFORM.CAPITALIZE:return e.replace(CAPITALIZE,capitalize);case TEXT_TRANSFORM.UPPERCASE:return e.toUpperCase();default:return e}},CAPITALIZE=/(^|\s|:|-|\(|\))([a-z])/g,capitalize=function(e,t,r){return 0<e.length?t+r.toUpperCase():e},ImageElementContainer=function(r){function e(e){var t=r.call(this,e)||this;return t.src=e.currentSrc||e.src,t.intrinsicWidth=e.naturalWidth,t.intrinsicHeight=e.naturalHeight,CacheStorage.getInstance().addImage(t.src),t}return __extends$1(e,r),e}(ElementContainer),CanvasElementContainer=function(r){function e(e){var t=r.call(this,e)||this;return t.canvas=e,t.intrinsicWidth=e.width,t.intrinsicHeight=e.height,t}return __extends$1(e,r),e}(ElementContainer),SVGElementContainer=function(i){function e(e){var t=i.call(this,e)||this,r=new XMLSerializer;return t.svg="data:image/svg+xml,"+encodeURIComponent(r.serializeToString(e)),t.intrinsicWidth=e.width.baseVal.value,t.intrinsicHeight=e.height.baseVal.value,CacheStorage.getInstance().addImage(t.svg),t}return __extends$1(e,i),e}(ElementContainer),LIElementContainer=function(r){function e(e){var t=r.call(this,e)||this;return t.value=e.value,t}return __extends$1(e,r),e}(ElementContainer),OLElementContainer=function(r){function e(e){var t=r.call(this,e)||this;return t.start=e.start,t.reversed="boolean"==typeof e.reversed&&!0===e.reversed,t}return __extends$1(e,r),e}(ElementContainer),CHECKBOX_BORDER_RADIUS=[{type:TokenType.DIMENSION_TOKEN,flags:0,unit:"px",number:3}],RADIO_BORDER_RADIUS=[{type:TokenType.PERCENTAGE_TOKEN,flags:0,number:50}],reformatInputBounds=function(e){return e.width>e.height?new Bounds(e.left+(e.width-e.height)/2,e.top,e.height,e.height):e.width<e.height?new Bounds(e.left,e.top+(e.height-e.width)/2,e.width,e.width):e},getInputValue=function(e){var t=e.type===PASSWORD?new Array(e.value.length+1).join(""):e.value;return 0===t.length?e.placeholder||"":t},CHECKBOX="checkbox",RADIO="radio",PASSWORD="password",INPUT_COLOR=707406591,InputElementContainer=function(r){function e(e){var t=r.call(this,e)||this;switch(t.type=e.type.toLowerCase(),t.checked=e.checked,t.value=getInputValue(e),t.type!==CHECKBOX&&t.type!==RADIO||(t.styles.backgroundColor=3739148031,t.styles.borderTopColor=t.styles.borderRightColor=t.styles.borderBottomColor=t.styles.borderLeftColor=2779096575,t.styles.borderTopWidth=t.styles.borderRightWidth=t.styles.borderBottomWidth=t.styles.borderLeftWidth=1,t.styles.borderTopStyle=t.styles.borderRightStyle=t.styles.borderBottomStyle=t.styles.borderLeftStyle=BORDER_STYLE.SOLID,t.styles.backgroundClip=[BACKGROUND_CLIP.BORDER_BOX],t.styles.backgroundOrigin=[0],t.bounds=reformatInputBounds(t.bounds)),t.type){case CHECKBOX:t.styles.borderTopRightRadius=t.styles.borderTopLeftRadius=t.styles.borderBottomRightRadius=t.styles.borderBottomLeftRadius=CHECKBOX_BORDER_RADIUS;break;case RADIO:t.styles.borderTopRightRadius=t.styles.borderTopLeftRadius=t.styles.borderBottomRightRadius=t.styles.borderBottomLeftRadius=RADIO_BORDER_RADIUS}return t}return __extends$1(e,r),e}(ElementContainer),SelectElementContainer=function(r){function e(e){var t=r.call(this,e)||this,e=e.options[e.selectedIndex||0];return t.value=e&&e.text||"",t}return __extends$1(e,r),e}(ElementContainer),TextareaElementContainer=function(r){function e(e){var t=r.call(this,e)||this;return t.value=e.value,t}return __extends$1(e,r),e}(ElementContainer),parseColor=function(e){return color$1.parse(Parser.create(e).parseComponentValue())},IFrameElementContainer=function(n){function e(e){var t,r,i=n.call(this,e)||this;i.src=e.src,i.width=parseInt(e.width,10)||0,i.height=parseInt(e.height,10)||0,i.backgroundColor=i.styles.backgroundColor;try{e.contentWindow&&e.contentWindow.document&&e.contentWindow.document.documentElement&&(i.tree=parseTree(e.contentWindow.document.documentElement),t=e.contentWindow.document.documentElement?parseColor(getComputedStyle(e.contentWindow.document.documentElement).backgroundColor):COLORS.TRANSPARENT,r=e.contentWindow.document.body?parseColor(getComputedStyle(e.contentWindow.document.body).backgroundColor):COLORS.TRANSPARENT,i.backgroundColor=isTransparent(t)?isTransparent(r)?i.styles.backgroundColor:r:t)}catch(e){}return i}return __extends$1(e,n),e}(ElementContainer),LIST_OWNERS=["OL","UL","MENU"],parseNodeTree=function(e,t,r){for(var i=e.firstChild;i;i=a){var n,a=i.nextSibling;isTextNode(i)&&0<i.data.trim().length?t.textNodes.push(new TextContainer(i,t.styles)):isElementNode(i)&&(n=createContainer(i)).styles.isVisible()&&(createsRealStackingContext(i,n,r)?n.flags|=4:createsStackingContext(n.styles)&&(n.flags|=2),-1!==LIST_OWNERS.indexOf(i.tagName)&&(n.flags|=8),t.elements.push(n),isTextareaElement(i)||isSVGElement(i)||isSelectElement(i)||parseNodeTree(i,n,r))}},createContainer=function(e){return new(isImageElement(e)?ImageElementContainer:isCanvasElement(e)?CanvasElementContainer:isSVGElement(e)?SVGElementContainer:isLIElement(e)?LIElementContainer:isOLElement(e)?OLElementContainer:isInputElement(e)?InputElementContainer:isSelectElement(e)?SelectElementContainer:isTextareaElement(e)?TextareaElementContainer:isIFrameElement(e)?IFrameElementContainer:ElementContainer)(e)},parseTree=function(e){var t=createContainer(e);return t.flags|=4,parseNodeTree(e,t,t),t},createsRealStackingContext=function(e,t,r){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||isBodyElement(e)&&r.styles.isTransparent()},createsStackingContext=function(e){return e.isPositioned()||e.isFloating()},isTextNode=function(e){return e.nodeType===Node.TEXT_NODE},isElementNode=function(e){return e.nodeType===Node.ELEMENT_NODE},isHTMLElementNode=function(e){return isElementNode(e)&&void 0!==e.style&&!isSVGElementNode(e)},isSVGElementNode=function(e){return"object"==typeof e.className},isLIElement=function(e){return"LI"===e.tagName},isOLElement=function(e){return"OL"===e.tagName},isInputElement=function(e){return"INPUT"===e.tagName},isHTMLElement=function(e){return"HTML"===e.tagName},isSVGElement=function(e){return"svg"===e.tagName},isBodyElement=function(e){return"BODY"===e.tagName},isCanvasElement=function(e){return"CANVAS"===e.tagName},isImageElement=function(e){return"IMG"===e.tagName},isIFrameElement=function(e){return"IFRAME"===e.tagName},isStyleElement=function(e){return"STYLE"===e.tagName},isScriptElement=function(e){return"SCRIPT"===e.tagName},isTextareaElement=function(e){return"TEXTAREA"===e.tagName},isSelectElement=function(e){return"SELECT"===e.tagName},CounterState=function(){function e(){this.counters={}}return e.prototype.getCounterValue=function(e){e=this.counters[e];return e&&e.length?e[e.length-1]:1},e.prototype.getCounterValues=function(e){e=this.counters[e];return e||[]},e.prototype.pop=function(e){var t=this;e.forEach(function(e){return t.counters[e].pop()})},e.prototype.parse=function(e){var r=this,t=e.counterIncrement,e=e.counterReset,i=!0,n=(null!==t&&t.forEach(function(e){var t=r.counters[e.counter];t&&0!==e.increment&&(i=!1,t[Math.max(0,t.length-1)]+=e.increment)}),[]);return i&&e.forEach(function(e){var t=r.counters[e.counter];n.push(e.counter),(t=t||(r.counters[e.counter]=[])).push(e.reset)}),n},e}(),ROMAN_UPPER={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},ARMENIAN={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},HEBREW={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},GEORGIAN={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},createAdditiveCounter=function(i,e,t,n,r,a){return i<e||t<i?createCounterText(i,r,0<a.length):n.integers.reduce(function(e,t,r){for(;t<=i;)i-=t,e+=n.values[r];return e},"")+a},createCounterStyleWithSymbolResolver=function(e,t,r,i){for(var n="";r||e--,n=i(e)+n,t<=(e/=t)*t;);return n},createCounterStyleFromRange=function(e,t,r,i,n){var a=r-t+1;return(e<0?"-":"")+(createCounterStyleWithSymbolResolver(Math.abs(e),a,i,function(e){return fromCodePoint(Math.floor(e%a)+t)})+n)},createCounterStyleFromSymbols=function(e,t,r){void 0===r&&(r=". ");var i=t.length;return createCounterStyleWithSymbolResolver(Math.abs(e),i,!1,function(e){return t[Math.floor(e%i)]})+r},CJK_ZEROS=1,CJK_TEN_COEFFICIENTS=2,CJK_TEN_HIGH_COEFFICIENTS=4,CJK_HUNDRED_COEFFICIENTS=8,createCJKCounter=function(e,t,r,i,n,a){if(e<-9999||9999<e)return createCounterText(e,LIST_STYLE_TYPE.CJK_DECIMAL,0<n.length);var o=Math.abs(e),s=n;if(0===o)return t[0]+s;for(var l=0;0<o&&l<=4;l++){var c=o%10;0==c&&contains(a,CJK_ZEROS)&&""!==s?s=t[c]+s:1<c||1==c&&0===l||1==c&&1===l&&contains(a,CJK_TEN_COEFFICIENTS)||1==c&&1===l&&contains(a,CJK_TEN_HIGH_COEFFICIENTS)&&100<e||1==c&&1<l&&contains(a,CJK_HUNDRED_COEFFICIENTS)?s=t[c]+(0<l?r[l-1]:"")+s:1==c&&0<l&&(s=r[l-1]+s),o=Math.floor(o/10)}return(e<0?i:"")+s},CHINESE_INFORMAL_MULTIPLIERS="",CHINESE_FORMAL_MULTIPLIERS="",JAPANESE_NEGATIVE="",KOREAN_NEGATIVE="",createCounterText=function(e,t,r){var i=r?". ":"",n=r?"":"",a=r?", ":"",o=r?" ":"";switch(t){case LIST_STYLE_TYPE.DISC:return""+o;case LIST_STYLE_TYPE.CIRCLE:return""+o;case LIST_STYLE_TYPE.SQUARE:return""+o;case LIST_STYLE_TYPE.DECIMAL_LEADING_ZERO:var s=createCounterStyleFromRange(e,48,57,!0,i);return s.length<4?"0"+s:s;case LIST_STYLE_TYPE.CJK_DECIMAL:return createCounterStyleFromSymbols(e,"",n);case LIST_STYLE_TYPE.LOWER_ROMAN:return createAdditiveCounter(e,1,3999,ROMAN_UPPER,LIST_STYLE_TYPE.DECIMAL,i).toLowerCase();case LIST_STYLE_TYPE.UPPER_ROMAN:return createAdditiveCounter(e,1,3999,ROMAN_UPPER,LIST_STYLE_TYPE.DECIMAL,i);case LIST_STYLE_TYPE.LOWER_GREEK:return createCounterStyleFromRange(e,945,969,!1,i);case LIST_STYLE_TYPE.LOWER_ALPHA:return createCounterStyleFromRange(e,97,122,!1,i);case LIST_STYLE_TYPE.UPPER_ALPHA:return createCounterStyleFromRange(e,65,90,!1,i);case LIST_STYLE_TYPE.ARABIC_INDIC:return createCounterStyleFromRange(e,1632,1641,!0,i);case LIST_STYLE_TYPE.ARMENIAN:case LIST_STYLE_TYPE.UPPER_ARMENIAN:return createAdditiveCounter(e,1,9999,ARMENIAN,LIST_STYLE_TYPE.DECIMAL,i);case LIST_STYLE_TYPE.LOWER_ARMENIAN:return createAdditiveCounter(e,1,9999,ARMENIAN,LIST_STYLE_TYPE.DECIMAL,i).toLowerCase();case LIST_STYLE_TYPE.BENGALI:return createCounterStyleFromRange(e,2534,2543,!0,i);case LIST_STYLE_TYPE.CAMBODIAN:case LIST_STYLE_TYPE.KHMER:return createCounterStyleFromRange(e,6112,6121,!0,i);case LIST_STYLE_TYPE.CJK_EARTHLY_BRANCH:return createCounterStyleFromSymbols(e,"",n);case LIST_STYLE_TYPE.CJK_HEAVENLY_STEM:return createCounterStyleFromSymbols(e,"",n);case LIST_STYLE_TYPE.CJK_IDEOGRAPHIC:case LIST_STYLE_TYPE.TRAD_CHINESE_INFORMAL:return createCJKCounter(e,"",CHINESE_INFORMAL_MULTIPLIERS,"",n,CJK_TEN_COEFFICIENTS|CJK_TEN_HIGH_COEFFICIENTS|CJK_HUNDRED_COEFFICIENTS);case LIST_STYLE_TYPE.TRAD_CHINESE_FORMAL:return createCJKCounter(e,"",CHINESE_FORMAL_MULTIPLIERS,"",n,CJK_ZEROS|CJK_TEN_COEFFICIENTS|CJK_TEN_HIGH_COEFFICIENTS|CJK_HUNDRED_COEFFICIENTS);case LIST_STYLE_TYPE.SIMP_CHINESE_INFORMAL:return createCJKCounter(e,"",CHINESE_INFORMAL_MULTIPLIERS,"",n,CJK_TEN_COEFFICIENTS|CJK_TEN_HIGH_COEFFICIENTS|CJK_HUNDRED_COEFFICIENTS);case LIST_STYLE_TYPE.SIMP_CHINESE_FORMAL:return createCJKCounter(e,"",CHINESE_FORMAL_MULTIPLIERS,"",n,CJK_ZEROS|CJK_TEN_COEFFICIENTS|CJK_TEN_HIGH_COEFFICIENTS|CJK_HUNDRED_COEFFICIENTS);case LIST_STYLE_TYPE.JAPANESE_INFORMAL:return createCJKCounter(e,"","",JAPANESE_NEGATIVE,n,0);case LIST_STYLE_TYPE.JAPANESE_FORMAL:return createCJKCounter(e,"","",JAPANESE_NEGATIVE,n,CJK_ZEROS|CJK_TEN_COEFFICIENTS|CJK_TEN_HIGH_COEFFICIENTS);case LIST_STYLE_TYPE.KOREAN_HANGUL_FORMAL:return createCJKCounter(e,"","",KOREAN_NEGATIVE,a,CJK_ZEROS|CJK_TEN_COEFFICIENTS|CJK_TEN_HIGH_COEFFICIENTS);case LIST_STYLE_TYPE.KOREAN_HANJA_INFORMAL:return createCJKCounter(e,"","",KOREAN_NEGATIVE,a,0);case LIST_STYLE_TYPE.KOREAN_HANJA_FORMAL:return createCJKCounter(e,"","",KOREAN_NEGATIVE,a,CJK_ZEROS|CJK_TEN_COEFFICIENTS|CJK_TEN_HIGH_COEFFICIENTS);case LIST_STYLE_TYPE.DEVANAGARI:return createCounterStyleFromRange(e,2406,2415,!0,i);case LIST_STYLE_TYPE.GEORGIAN:return createAdditiveCounter(e,1,19999,GEORGIAN,LIST_STYLE_TYPE.DECIMAL,i);case LIST_STYLE_TYPE.GUJARATI:return createCounterStyleFromRange(e,2790,2799,!0,i);case LIST_STYLE_TYPE.GURMUKHI:return createCounterStyleFromRange(e,2662,2671,!0,i);case LIST_STYLE_TYPE.HEBREW:return createAdditiveCounter(e,1,10999,HEBREW,LIST_STYLE_TYPE.DECIMAL,i);case LIST_STYLE_TYPE.HIRAGANA:return createCounterStyleFromSymbols(e,"");case LIST_STYLE_TYPE.HIRAGANA_IROHA:return createCounterStyleFromSymbols(e,"");case LIST_STYLE_TYPE.KANNADA:return createCounterStyleFromRange(e,3302,3311,!0,i);case LIST_STYLE_TYPE.KATAKANA:return createCounterStyleFromSymbols(e,"",n);case LIST_STYLE_TYPE.KATAKANA_IROHA:return createCounterStyleFromSymbols(e,"",n);case LIST_STYLE_TYPE.LAO:return createCounterStyleFromRange(e,3792,3801,!0,i);case LIST_STYLE_TYPE.MONGOLIAN:return createCounterStyleFromRange(e,6160,6169,!0,i);case LIST_STYLE_TYPE.MYANMAR:return createCounterStyleFromRange(e,4160,4169,!0,i);case LIST_STYLE_TYPE.ORIYA:return createCounterStyleFromRange(e,2918,2927,!0,i);case LIST_STYLE_TYPE.PERSIAN:return createCounterStyleFromRange(e,1776,1785,!0,i);case LIST_STYLE_TYPE.TAMIL:return createCounterStyleFromRange(e,3046,3055,!0,i);case LIST_STYLE_TYPE.TELUGU:return createCounterStyleFromRange(e,3174,3183,!0,i);case LIST_STYLE_TYPE.THAI:return createCounterStyleFromRange(e,3664,3673,!0,i);case LIST_STYLE_TYPE.TIBETAN:return createCounterStyleFromRange(e,3872,3881,!0,i);default:LIST_STYLE_TYPE.DECIMAL;return createCounterStyleFromRange(e,48,57,!0,i)}},IGNORE_ATTRIBUTE="data-html2canvas-ignore",DocumentCloner=function(){function e(e,t){if(this.options=t,this.scrolledElements=[],this.referenceElement=e,this.counters=new CounterState,this.quoteDepth=0,!e.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(e.ownerDocument.documentElement)}return e.prototype.toIFrame=function(e,r){var t,i,n,a,o=this,s=createIFrameContainer(e,r);return s.contentWindow?(t=e.defaultView.pageXOffset,e=e.defaultView.pageYOffset,i=s.contentWindow,n=i.document,a=iframeLoader(s).then(function(){return __awaiter(o,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return(this.scrolledElements.forEach(restoreNodeScroll),i&&(i.scrollTo(r.left,r.top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||i.scrollY===r.top&&i.scrollX===r.left||(n.documentElement.style.top=-r.top+"px",n.documentElement.style.left=-r.left+"px",n.documentElement.style.position="absolute")),t=this.options.onclone,void 0===this.clonedReferenceElement)?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:n.fonts&&n.fonts.ready?[4,n.fonts.ready]:[3,2];case 1:e.sent(),e.label=2;case 2:return"function"==typeof t?[2,Promise.resolve().then(function(){return t(n)}).then(function(){return s})]:[2,s]}})})}),n.open(),n.write(serializeDoctype(document.doctype)+"<html></html>"),restoreOwnerScroll(this.referenceElement.ownerDocument,t,e),n.replaceChild(n.adoptNode(this.documentElement),n.documentElement),n.close(),a):Promise.reject("Unable to find iframe window")},e.prototype.createElementClone=function(e){return isCanvasElement(e)?this.createCanvasClone(e):isStyleElement(e)?this.createStyleClone(e):(e=e.cloneNode(!1),isImageElement(e)&&"lazy"===e.loading&&(e.loading="eager"),e)},e.prototype.createStyleClone=function(e){try{var t,r,i=e.sheet;if(i&&i.cssRules)return t=[].slice.call(i.cssRules,0).reduce(function(e,t){return t&&"string"==typeof t.cssText?e+t.cssText:e},""),(r=e.cloneNode(!1)).textContent=t,r}catch(e){if(Logger$1.getInstance(this.options.id).error("Unable to access cssRules property",e),"SecurityError"!==e.name)throw e}return e.cloneNode(!1)},e.prototype.createCanvasClone=function(e){if(this.options.inlineImages&&e.ownerDocument){var t=e.ownerDocument.createElement("img");try{return t.src=e.toDataURL(),t}catch(e){Logger$1.getInstance(this.options.id).info("Unable to clone canvas contents, canvas is tainted")}}t=e.cloneNode(!1);try{t.width=e.width,t.height=e.height;var r=e.getContext("2d"),i=t.getContext("2d");i&&(r?i.putImageData(r.getImageData(0,0,e.width,e.height),0,0):i.drawImage(e,0,0))}catch(e){}return t},e.prototype.cloneNode=function(e){if(isTextNode(e))return document.createTextNode(e.data);if(e.ownerDocument){var t=e.ownerDocument.defaultView;if(t&&isElementNode(e)&&(isHTMLElementNode(e)||isSVGElementNode(e))){for(var r=this.createElementClone(e),i=t.getComputedStyle(e),n=t.getComputedStyle(e,":before"),t=t.getComputedStyle(e,":after"),a=(this.referenceElement===e&&isHTMLElementNode(r)&&(this.clonedReferenceElement=r),isBodyElement(r)&&createPseudoHideStyles(r),this.counters.parse(new CSSParsedCounterDeclaration(i))),n=this.resolvePseudoContent(e,r,n,PseudoElementType.BEFORE),o=e.firstChild;o;o=o.nextSibling)isElementNode(o)&&(isScriptElement(o)||o.hasAttribute(IGNORE_ATTRIBUTE)||"function"==typeof this.options.ignoreElements&&this.options.ignoreElements(o))||this.options.copyStyles&&isElementNode(o)&&isStyleElement(o)||r.appendChild(this.cloneNode(o));n&&r.insertBefore(n,r.firstChild);n=this.resolvePseudoContent(e,r,t,PseudoElementType.AFTER);return n&&r.appendChild(n),this.counters.pop(a),i&&(this.options.copyStyles||isSVGElementNode(e))&&!isIFrameElement(e)&&copyCSSStyles(i,r),0===e.scrollTop&&0===e.scrollLeft||this.scrolledElements.push([r,e.scrollLeft,e.scrollTop]),(isTextareaElement(e)||isSelectElement(e))&&(isTextareaElement(r)||isSelectElement(r))&&(r.value=e.value),r}}return e.cloneNode(!1)},e.prototype.resolvePseudoContent=function(o,e,t,r){var s=this;if(t){var l,c,i=t.content,d=e.ownerDocument;if(d&&i&&"none"!==i&&"-moz-alt-content"!==i&&"none"!==t.display)return this.counters.parse(new CSSParsedCounterDeclaration(t)),l=new CSSParsedPseudoDeclaration(t),c=d.createElement("html2canvaspseudoelement"),copyCSSStyles(t,c),l.content.forEach(function(e){if(e.type===TokenType.STRING_TOKEN)c.appendChild(d.createTextNode(e.value));else if(e.type===TokenType.URL_TOKEN){var t=d.createElement("img");t.src=e.value,t.style.opacity="1",c.appendChild(t)}else if(e.type===TokenType.FUNCTION){var r,i,n,a;"attr"===e.name?(t=e.values.filter(isIdentToken)).length&&c.appendChild(d.createTextNode(o.getAttribute(t[0].value)||"")):"counter"===e.name?(n=(t=e.values.filter(nonFunctionArgSeparator))[0],a=t[1],n&&isIdentToken(n)&&(t=s.counters.getCounterValue(n.value),r=a&&isIdentToken(a)?listStyleType.parse(a.value):LIST_STYLE_TYPE.DECIMAL,c.appendChild(d.createTextNode(createCounterText(t,r,!1))))):"counters"===e.name&&(n=(t=e.values.filter(nonFunctionArgSeparator))[0],r=t[1],a=t[2],n)&&isIdentToken(n)&&(t=s.counters.getCounterValues(n.value),i=a&&isIdentToken(a)?listStyleType.parse(a.value):LIST_STYLE_TYPE.DECIMAL,n=r&&r.type===TokenType.STRING_TOKEN?r.value:"",a=t.map(function(e){return createCounterText(e,i,!1)}).join(n),c.appendChild(d.createTextNode(a)))}else if(e.type===TokenType.IDENT_TOKEN)switch(e.value){case"open-quote":c.appendChild(d.createTextNode(getQuote(l.quotes,s.quoteDepth++,!0)));break;case"close-quote":c.appendChild(d.createTextNode(getQuote(l.quotes,--s.quoteDepth,!1)));break;default:c.appendChild(d.createTextNode(e.value))}}),c.className=PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+" "+PSEUDO_HIDE_ELEMENT_CLASS_AFTER,i=r===PseudoElementType.BEFORE?" "+PSEUDO_HIDE_ELEMENT_CLASS_BEFORE:" "+PSEUDO_HIDE_ELEMENT_CLASS_AFTER,isSVGElementNode(e)?e.className.baseValue+=i:e.className+=i,c}},e.destroy=function(e){return!!e.parentNode&&(e.parentNode.removeChild(e),!0)},e}(),createIFrameContainer=(!function(e){e[e.BEFORE=0]="BEFORE",e[e.AFTER=1]="AFTER"}(PseudoElementType=PseudoElementType||{}),function(e,t){var r=e.createElement("iframe");return r.className="html2canvas-container",r.style.visibility="hidden",r.style.position="fixed",r.style.left="-10000px",r.style.top="0px",r.style.border="0",r.width=t.width.toString(),r.height=t.height.toString(),r.scrolling="no",r.setAttribute(IGNORE_ATTRIBUTE,"true"),e.body.appendChild(r),r}),iframeLoader=function(n){return new Promise(function(t,e){var r=n.contentWindow;if(!r)return e("No window assigned for iframe");var i=r.document;r.onload=n.onload=i.onreadystatechange=function(){r.onload=n.onload=i.onreadystatechange=null;var e=setInterval(function(){0<i.body.childNodes.length&&"complete"===i.readyState&&(clearInterval(e),t(n))},50)}})},copyCSSStyles=function(e,t){for(var r=e.length-1;0<=r;r--){var i=e.item(r);"content"!==i&&t.style.setProperty(i,e.getPropertyValue(i))}return t},serializeDoctype=function(e){var t="";return e&&(t+="<!DOCTYPE ",e.name&&(t+=e.name),e.internalSubset&&(t+=e.internalSubset),e.publicId&&(t+='"'+e.publicId+'"'),e.systemId&&(t+='"'+e.systemId+'"'),t+=">"),t},restoreOwnerScroll=function(e,t,r){e&&e.defaultView&&(t!==e.defaultView.pageXOffset||r!==e.defaultView.pageYOffset)&&e.defaultView.scrollTo(t,r)},restoreNodeScroll=function(e){var t=e[0],r=e[1],e=e[2];t.scrollLeft=r,t.scrollTop=e},PSEUDO_BEFORE=":before",PSEUDO_AFTER=":after",PSEUDO_HIDE_ELEMENT_CLASS_BEFORE="___html2canvas___pseudoelement_before",PSEUDO_HIDE_ELEMENT_CLASS_AFTER="___html2canvas___pseudoelement_after",PSEUDO_HIDE_ELEMENT_STYLE='{\n    content: "" !important;\n    display: none !important;\n}',createPseudoHideStyles=function(e){createStyles(e,"."+PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+PSEUDO_BEFORE+PSEUDO_HIDE_ELEMENT_STYLE+"\n         ."+PSEUDO_HIDE_ELEMENT_CLASS_AFTER+PSEUDO_AFTER+PSEUDO_HIDE_ELEMENT_STYLE)},createStyles=function(e,t){var r=e.ownerDocument;r&&((r=r.createElement("style")).textContent=t,e.appendChild(r))},equalPath=(!function(e){e[e.VECTOR=0]="VECTOR",e[e.BEZIER_CURVE=1]="BEZIER_CURVE"}(PathType=PathType||{}),function(e,r){return e.length===r.length&&e.some(function(e,t){return e===r[t]})}),transformPath=function(e,r,i,n,a){return e.map(function(e,t){switch(t){case 0:return e.add(r,i);case 1:return e.add(r+n,i);case 2:return e.add(r+n,i+a);case 3:return e.add(r,i+a)}return e})},Vector=function(){function r(e,t){this.type=PathType.VECTOR,this.x=e,this.y=t}return r.prototype.add=function(e,t){return new r(this.x+e,this.y+t)},r}(),lerp$1=function(e,t,r){return new Vector(e.x+(t.x-e.x)*r,e.y+(t.y-e.y)*r)},BezierCurve=function(){function o(e,t,r,i){this.type=PathType.BEZIER_CURVE,this.start=e,this.startControl=t,this.endControl=r,this.end=i}return o.prototype.subdivide=function(e,t){var r=lerp$1(this.start,this.startControl,e),i=lerp$1(this.startControl,this.endControl,e),n=lerp$1(this.endControl,this.end,e),a=lerp$1(r,i,e),i=lerp$1(i,n,e),e=lerp$1(a,i,e);return t?new o(this.start,r,a,e):new o(e,i,n,this.end)},o.prototype.add=function(e,t){return new o(this.start.add(e,t),this.startControl.add(e,t),this.endControl.add(e,t),this.end.add(e,t))},o.prototype.reverse=function(){return new o(this.end,this.endControl,this.startControl,this.start)},o}(),isBezierCurve=function(e){return e.type===PathType.BEZIER_CURVE},BoundCurves=function(e){var t=e.styles,r=e.bounds,i=(n=getAbsoluteValueForTuple(t.borderTopLeftRadius,r.width,r.height))[0],n=n[1],a=(o=getAbsoluteValueForTuple(t.borderTopRightRadius,r.width,r.height))[0],o=o[1],s=(l=getAbsoluteValueForTuple(t.borderBottomRightRadius,r.width,r.height))[0],l=l[1],c=(d=getAbsoluteValueForTuple(t.borderBottomLeftRadius,r.width,r.height))[0],d=d[1];(h=[]).push((i+a)/r.width),h.push((c+s)/r.width),h.push((n+d)/r.height),h.push((o+l)/r.height);1<(h=Math.max.apply(Math,h))&&(i/=h,n/=h,a/=h,o/=h,s/=h,l/=h,c/=h,d/=h);var h=r.width-a,u=r.height-l,A=r.width-s,p=r.height-d,m=t.borderTopWidth,f=t.borderRightWidth,g=t.borderBottomWidth,v=t.borderLeftWidth,_=getAbsoluteValue(t.paddingTop,e.bounds.width),y=getAbsoluteValue(t.paddingRight,e.bounds.width),E=getAbsoluteValue(t.paddingBottom,e.bounds.width),t=getAbsoluteValue(t.paddingLeft,e.bounds.width);this.topLeftBorderBox=0<i||0<n?getCurvePoints(r.left,r.top,i,n,CORNER.TOP_LEFT):new Vector(r.left,r.top),this.topRightBorderBox=0<a||0<o?getCurvePoints(r.left+h,r.top,a,o,CORNER.TOP_RIGHT):new Vector(r.left+r.width,r.top),this.bottomRightBorderBox=0<s||0<l?getCurvePoints(r.left+A,r.top+u,s,l,CORNER.BOTTOM_RIGHT):new Vector(r.left+r.width,r.top+r.height),this.bottomLeftBorderBox=0<c||0<d?getCurvePoints(r.left,r.top+p,c,d,CORNER.BOTTOM_LEFT):new Vector(r.left,r.top+r.height),this.topLeftPaddingBox=0<i||0<n?getCurvePoints(r.left+v,r.top+m,Math.max(0,i-v),Math.max(0,n-m),CORNER.TOP_LEFT):new Vector(r.left+v,r.top+m),this.topRightPaddingBox=0<a||0<o?getCurvePoints(r.left+Math.min(h,r.width+v),r.top+m,h>r.width+v?0:a-v,o-m,CORNER.TOP_RIGHT):new Vector(r.left+r.width-f,r.top+m),this.bottomRightPaddingBox=0<s||0<l?getCurvePoints(r.left+Math.min(A,r.width-v),r.top+Math.min(u,r.height+m),Math.max(0,s-f),l-g,CORNER.BOTTOM_RIGHT):new Vector(r.left+r.width-f,r.top+r.height-g),this.bottomLeftPaddingBox=0<c||0<d?getCurvePoints(r.left+v,r.top+p,Math.max(0,c-v),d-g,CORNER.BOTTOM_LEFT):new Vector(r.left+v,r.top+r.height-g),this.topLeftContentBox=0<i||0<n?getCurvePoints(r.left+v+t,r.top+m+_,Math.max(0,i-(v+t)),Math.max(0,n-(m+_)),CORNER.TOP_LEFT):new Vector(r.left+v+t,r.top+m+_),this.topRightContentBox=0<a||0<o?getCurvePoints(r.left+Math.min(h,r.width+v+t),r.top+m+_,h>r.width+v+t?0:a-v+t,o-(m+_),CORNER.TOP_RIGHT):new Vector(r.left+r.width-(f+y),r.top+m+_),this.bottomRightContentBox=0<s||0<l?getCurvePoints(r.left+Math.min(A,r.width-(v+t)),r.top+Math.min(u,r.height+m+_),Math.max(0,s-(f+y)),l-(g+E),CORNER.BOTTOM_RIGHT):new Vector(r.left+r.width-(f+y),r.top+r.height-(g+E)),this.bottomLeftContentBox=0<c||0<d?getCurvePoints(r.left+v+t,r.top+p,Math.max(0,c-(v+t)),d-(g+E),CORNER.BOTTOM_LEFT):new Vector(r.left+v+t,r.top+r.height-(g+E))},getCurvePoints=(!function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_RIGHT=1]="TOP_RIGHT",e[e.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",e[e.BOTTOM_LEFT=3]="BOTTOM_LEFT"}(CORNER=CORNER||{}),function(e,t,r,i,n){var a=(Math.sqrt(2)-1)/3*4,o=r*a,s=i*a,l=e+r,c=t+i;switch(n){case CORNER.TOP_LEFT:return new BezierCurve(new Vector(e,c),new Vector(e,c-s),new Vector(l-o,t),new Vector(l,t));case CORNER.TOP_RIGHT:return new BezierCurve(new Vector(e,t),new Vector(e+o,t),new Vector(l,c-s),new Vector(l,c));case CORNER.BOTTOM_RIGHT:return new BezierCurve(new Vector(l,t),new Vector(l,t+s),new Vector(e+o,c),new Vector(e,c));default:CORNER.BOTTOM_LEFT;return new BezierCurve(new Vector(l,c),new Vector(l-o,c),new Vector(e,t+s),new Vector(e,t))}}),calculateBorderBoxPath=function(e){return[e.topLeftBorderBox,e.topRightBorderBox,e.bottomRightBorderBox,e.bottomLeftBorderBox]},calculateContentBoxPath=function(e){return[e.topLeftContentBox,e.topRightContentBox,e.bottomRightContentBox,e.bottomLeftContentBox]},calculatePaddingBoxPath=function(e){return[e.topLeftPaddingBox,e.topRightPaddingBox,e.bottomRightPaddingBox,e.bottomLeftPaddingBox]},TransformEffect=function(e,t,r){this.type=0,this.offsetX=e,this.offsetY=t,this.matrix=r,this.target=6},ClipEffect=function(e,t){this.type=1,this.target=t,this.path=e},isTransformEffect=function(e){return 0===e.type},isClipEffect=function(e){return 1===e.type},StackingContext=function(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]},ElementPaint=function(){function e(e,t){var r,i;this.container=e,this.effects=t.slice(0),this.curves=new BoundCurves(e),null!==e.styles.transform&&(t=e.bounds.left+e.styles.transformOrigin[0].number,i=e.bounds.top+e.styles.transformOrigin[1].number,r=e.styles.transform,this.effects.push(new TransformEffect(t,i,r))),e.styles.overflowX!==OVERFLOW.VISIBLE&&(t=calculateBorderBoxPath(this.curves),i=calculatePaddingBoxPath(this.curves),equalPath(t,i)?this.effects.push(new ClipEffect(t,6)):(this.effects.push(new ClipEffect(t,2)),this.effects.push(new ClipEffect(i,4))))}return e.prototype.getParentEffects=function(){var e,t,r=this.effects.slice(0);return this.container.styles.overflowX!==OVERFLOW.VISIBLE&&(e=calculateBorderBoxPath(this.curves),t=calculatePaddingBoxPath(this.curves),equalPath(e,t)||r.push(new ClipEffect(t,6))),r},e}(),parseStackTree=function(c,d,h,u){c.container.elements.forEach(function(e){var t,r,i,n,a=contains(e.flags,4),o=contains(e.flags,2),s=new ElementPaint(e,c.getParentEffects()),l=(contains(e.styles.display,2048)&&u.push(s),contains(e.flags,8)?[]:u);a||o?(o=a||e.styles.isPositioned()?h:d,t=new StackingContext(s),e.styles.isPositioned()||e.styles.opacity<1||e.styles.isTransformed()?(r=e.styles.zIndex.order)<0?(i=0,o.negativeZIndex.some(function(e,t){return r>e.element.container.styles.zIndex.order?(i=t,!1):0<i}),o.negativeZIndex.splice(i,0,t)):0<r?(n=0,o.positiveZIndex.some(function(e,t){return r>=e.element.container.styles.zIndex.order?(n=t+1,!1):0<n}),o.positiveZIndex.splice(n,0,t)):o.zeroOrAutoZIndexOrTransformedOrOpacity.push(t):(e.styles.isFloating()?o.nonPositionedFloats:o.nonPositionedInlineLevel).push(t),parseStackTree(s,t,a?t:h,l)):((e.styles.isInlineLevel()?d.inlineLevel:d.nonInlineLevel).push(s),parseStackTree(s,d,h,l)),contains(e.flags,8)&&processListItems(e,l)})},processListItems=function(e,t){for(var r=e instanceof OLElementContainer?e.start:1,i=e instanceof OLElementContainer&&e.reversed,n=0;n<t.length;n++){var a=t[n];a.container instanceof LIElementContainer&&"number"==typeof a.container.value&&0!==a.container.value&&(r=a.container.value),a.listValue=createCounterText(r,a.container.styles.listStyleType,!0),r+=i?-1:1}},parseStackingContexts=function(e){var e=new ElementPaint(e,[]),t=new StackingContext(e),r=[];return parseStackTree(e,t,t,r),processListItems(e.container,r),t},parsePathForBorder=function(e,t){switch(t){case 0:return createPathFromCurves(e.topLeftBorderBox,e.topLeftPaddingBox,e.topRightBorderBox,e.topRightPaddingBox);case 1:return createPathFromCurves(e.topRightBorderBox,e.topRightPaddingBox,e.bottomRightBorderBox,e.bottomRightPaddingBox);case 2:return createPathFromCurves(e.bottomRightBorderBox,e.bottomRightPaddingBox,e.bottomLeftBorderBox,e.bottomLeftPaddingBox);default:return createPathFromCurves(e.bottomLeftBorderBox,e.bottomLeftPaddingBox,e.topLeftBorderBox,e.topLeftPaddingBox)}},createPathFromCurves=function(e,t,r,i){var n=[];return isBezierCurve(e)?n.push(e.subdivide(.5,!1)):n.push(e),isBezierCurve(r)?n.push(r.subdivide(.5,!0)):n.push(r),isBezierCurve(i)?n.push(i.subdivide(.5,!0).reverse()):n.push(i),isBezierCurve(t)?n.push(t.subdivide(.5,!1).reverse()):n.push(t),n},paddingBox=function(e){var t=e.bounds,e=e.styles;return t.add(e.borderLeftWidth,e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth),-(e.borderTopWidth+e.borderBottomWidth))},contentBox=function(e){var t=e.styles,e=e.bounds,r=getAbsoluteValue(t.paddingLeft,e.width),i=getAbsoluteValue(t.paddingRight,e.width),n=getAbsoluteValue(t.paddingTop,e.width),a=getAbsoluteValue(t.paddingBottom,e.width);return e.add(r+t.borderLeftWidth,n+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+r+i),-(t.borderTopWidth+t.borderBottomWidth+n+a))},calculateBackgroundPositioningArea=function(e,t){return 0===e?t.bounds:(2===e?contentBox:paddingBox)(t)},calculateBackgroundPaintingArea=function(e,t){return e===BACKGROUND_CLIP.BORDER_BOX?t.bounds:(e===BACKGROUND_CLIP.CONTENT_BOX?contentBox:paddingBox)(t)},calculateBackgroundRendering=function(e,t,r){var i=calculateBackgroundPositioningArea(getBackgroundValueForIndex(e.styles.backgroundOrigin,t),e),n=calculateBackgroundPaintingArea(getBackgroundValueForIndex(e.styles.backgroundClip,t),e),r=calculateBackgroundSize(getBackgroundValueForIndex(e.styles.backgroundSize,t),r,i),a=r[0],o=r[1],s=getAbsoluteValueForTuple(getBackgroundValueForIndex(e.styles.backgroundPosition,t),i.width-a,i.height-o);return[calculateBackgroundRepeatPath(getBackgroundValueForIndex(e.styles.backgroundRepeat,t),s,r,i,n),Math.round(i.left+s[0]),Math.round(i.top+s[1]),a,o]},isAuto=function(e){return isIdentToken(e)&&e.value===BACKGROUND_SIZE.AUTO},hasIntrinsicValue=function(e){return"number"==typeof e},calculateBackgroundSize=function(e,t,r){var i=t[0],n=t[1],t=t[2],a=e[0],e=e[1];if(isLengthPercentage(a)&&e&&isLengthPercentage(e))return[getAbsoluteValue(a,r.width),getAbsoluteValue(e,r.height)];var o=hasIntrinsicValue(t);if(isIdentToken(a)&&(a.value===BACKGROUND_SIZE.CONTAIN||a.value===BACKGROUND_SIZE.COVER))return hasIntrinsicValue(t)?r.width/r.height<t!=(a.value===BACKGROUND_SIZE.COVER)?[r.width,r.width/t]:[r.height*t,r.height]:[r.width,r.height];var s=hasIntrinsicValue(i),l=hasIntrinsicValue(n),c=s||l;if(isAuto(a)&&(!e||isAuto(e)))return s&&l?[i,n]:o||c?c&&o?[s?i:n*t,l?n:i/t]:[s?i:r.width,l?n:r.height]:[r.width,r.height];if(o)return o=c=0,isLengthPercentage(a)?c=getAbsoluteValue(a,r.width):isLengthPercentage(e)&&(o=getAbsoluteValue(e,r.height)),isAuto(a)?c=o*t:e&&!isAuto(e)||(o=c/t),[c,o];t=null,c=null;if(isLengthPercentage(a)?t=getAbsoluteValue(a,r.width):e&&isLengthPercentage(e)&&(c=getAbsoluteValue(e,r.height)),null!==(t=null!==(c=null===t||e&&!isAuto(e)?c:s&&l?t/i*n:r.height)&&isAuto(a)?s&&l?c/n*i:r.width:t)&&null!==c)return[t,c];throw new Error("Unable to calculate background-size for element")},getBackgroundValueForIndex=function(e,t){t=e[t];return void 0===t?e[0]:t},calculateBackgroundRepeatPath=function(e,t,r,i,n){var a=t[0],o=t[1],s=r[0],l=r[1];switch(e){case BACKGROUND_REPEAT.REPEAT_X:return[new Vector(Math.round(i.left),Math.round(i.top+o)),new Vector(Math.round(i.left+i.width),Math.round(i.top+o)),new Vector(Math.round(i.left+i.width),Math.round(l+i.top+o)),new Vector(Math.round(i.left),Math.round(l+i.top+o))];case BACKGROUND_REPEAT.REPEAT_Y:return[new Vector(Math.round(i.left+a),Math.round(i.top)),new Vector(Math.round(i.left+a+s),Math.round(i.top)),new Vector(Math.round(i.left+a+s),Math.round(i.height+i.top)),new Vector(Math.round(i.left+a),Math.round(i.height+i.top))];case BACKGROUND_REPEAT.NO_REPEAT:return[new Vector(Math.round(i.left+a),Math.round(i.top+o)),new Vector(Math.round(i.left+a+s),Math.round(i.top+o)),new Vector(Math.round(i.left+a+s),Math.round(i.top+o+l)),new Vector(Math.round(i.left+a),Math.round(i.top+o+l))];default:return[new Vector(Math.round(n.left),Math.round(n.top)),new Vector(Math.round(n.left+n.width),Math.round(n.top)),new Vector(Math.round(n.left+n.width),Math.round(n.height+n.top)),new Vector(Math.round(n.left),Math.round(n.height+n.top))]}},SMALL_IMAGE="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",SAMPLE_TEXT="Hidden Text",FontMetrics=function(){function e(e){this._data={},this._document=e}return e.prototype.parseMetrics=function(e,t){var r=this._document.createElement("div"),i=this._document.createElement("img"),n=this._document.createElement("span"),a=this._document.body,e=(r.style.visibility="hidden",r.style.fontFamily=e,r.style.fontSize=t,r.style.margin="0",r.style.padding="0",a.appendChild(r),i.src=SMALL_IMAGE,i.width=1,i.height=1,i.style.margin="0",i.style.padding="0",i.style.verticalAlign="baseline",n.style.fontFamily=e,n.style.fontSize=t,n.style.margin="0",n.style.padding="0",n.appendChild(this._document.createTextNode(SAMPLE_TEXT)),r.appendChild(n),r.appendChild(i),i.offsetTop-n.offsetTop+2),t=(r.removeChild(n),r.appendChild(this._document.createTextNode(SAMPLE_TEXT)),r.style.lineHeight="normal",i.style.verticalAlign="super",i.offsetTop-r.offsetTop+2);return a.removeChild(r),{baseline:e,middle:t}},e.prototype.getMetrics=function(e,t){var r=e+" "+t;return void 0===this._data[r]&&(this._data[r]=this.parseMetrics(e,t)),this._data[r]},e}(),MASK_OFFSET=1e4,CanvasRenderer=function(){function A(e){this._activeEffects=[],this.canvas=e.canvas||document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),(this.options=e).canvas||(this.canvas.width=Math.floor(e.width*e.scale),this.canvas.height=Math.floor(e.height*e.scale),this.canvas.style.width=e.width+"px",this.canvas.style.height=e.height+"px"),this.fontMetrics=new FontMetrics(document),this.ctx.scale(this.options.scale,this.options.scale),this.ctx.translate(-e.x+e.scrollX,-e.y+e.scrollY),this.ctx.textBaseline="bottom",this._activeEffects=[],Logger$1.getInstance(e.id).debug("Canvas renderer initialized ("+e.width+"x"+e.height+" at "+e.x+","+e.y+") with scale "+e.scale)}return A.prototype.applyEffects=function(e,t){for(var r=this;this._activeEffects.length;)this.popEffect();e.filter(function(e){return contains(e.target,t)}).forEach(function(e){return r.applyEffect(e)})},A.prototype.applyEffect=function(e){this.ctx.save(),isTransformEffect(e)&&(this.ctx.translate(e.offsetX,e.offsetY),this.ctx.transform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this.ctx.translate(-e.offsetX,-e.offsetY)),isClipEffect(e)&&(this.path(e.path),this.ctx.clip()),this._activeEffects.push(e)},A.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},A.prototype.renderStack=function(r){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return(t=r.element.container.styles).isVisible()?(this.ctx.globalAlpha=t.opacity,[4,this.renderStackContent(r)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},A.prototype.renderNode=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return t.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(t)]:[3,3];case 1:return e.sent(),[4,this.renderNodeContent(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},A.prototype.renderTextWithLetterSpacing=function(r,e){var i=this;0===e?this.ctx.fillText(r.text,r.bounds.left,r.bounds.top+r.bounds.height):toCodePoints(r.text).map(function(e){return fromCodePoint(e)}).reduce(function(e,t){return i.ctx.fillText(t,e,r.bounds.top+r.bounds.height),e+i.ctx.measureText(t).width},r.bounds.left)},A.prototype.createFontStyle=function(e){var t=e.fontVariant.filter(function(e){return"normal"===e||"small-caps"===e}).join(""),r=e.fontFamily.join(", "),i=isDimensionToken(e.fontSize)?""+e.fontSize.number+e.fontSize.unit:e.fontSize.number+"px";return[[e.fontStyle,t,e.fontWeight,i,r].join(" "),r,i]},A.prototype.renderTextNode=function(o,s){return __awaiter(this,void 0,void 0,function(){var t,r,i,n,a=this;return __generator(this,function(e){return t=this.createFontStyle(s),r=t[0],i=t[1],n=t[2],this.ctx.font=r,o.textBounds.forEach(function(r){a.ctx.fillStyle=asString(s.color),a.renderTextWithLetterSpacing(r,s.letterSpacing);var e=s.textShadow;e.length&&r.text.trim().length&&(e.slice(0).reverse().forEach(function(e){a.ctx.shadowColor=asString(e.color),a.ctx.shadowOffsetX=e.offsetX.number*a.options.scale,a.ctx.shadowOffsetY=e.offsetY.number*a.options.scale,a.ctx.shadowBlur=e.blur.number,a.ctx.fillText(r.text,r.bounds.left,r.bounds.top+r.bounds.height)}),a.ctx.shadowColor="",a.ctx.shadowOffsetX=0,a.ctx.shadowOffsetY=0,a.ctx.shadowBlur=0),s.textDecorationLine.length&&(a.ctx.fillStyle=asString(s.textDecorationColor||s.color),s.textDecorationLine.forEach(function(e){switch(e){case 1:var t=a.fontMetrics.getMetrics(i,n).baseline;a.ctx.fillRect(r.bounds.left,Math.round(r.bounds.top+t),r.bounds.width,1);break;case 2:a.ctx.fillRect(r.bounds.left,Math.round(r.bounds.top),r.bounds.width,1);break;case 3:t=a.fontMetrics.getMetrics(i,n).middle;a.ctx.fillRect(r.bounds.left,Math.ceil(r.bounds.top+t),r.bounds.width,1)}}))}),[2]})})},A.prototype.renderReplacedElement=function(e,t,r){var i;r&&0<e.intrinsicWidth&&0<e.intrinsicHeight&&(i=contentBox(e),t=calculatePaddingBoxPath(t),this.path(t),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(r,0,0,e.intrinsicWidth,e.intrinsicHeight,i.left,i.top,i.width,i.height),this.ctx.restore())},A.prototype.renderNodeContent=function(u){return __awaiter(this,void 0,void 0,function(){var t,r,i,n,a,o,s,l,c,d,h;return __generator(this,function(e){switch(e.label){case 0:this.applyEffects(u.effects,4),t=u.container,r=u.curves,i=t.styles,n=0,a=t.textNodes,e.label=1;case 1:return n<a.length?(o=a[n],[4,this.renderTextNode(o,i)]):[3,4];case 2:e.sent(),e.label=3;case 3:return n++,[3,1];case 4:if(!(t instanceof ImageElementContainer))return[3,8];e.label=5;case 5:return e.trys.push([5,7,,8]),[4,this.options.cache.match(t.src)];case 6:return c=e.sent(),this.renderReplacedElement(t,r,c),[3,8];case 7:return e.sent(),Logger$1.getInstance(this.options.id).error("Error loading image "+t.src),[3,8];case 8:if(t instanceof CanvasElementContainer&&this.renderReplacedElement(t,r,t.canvas),!(t instanceof SVGElementContainer))return[3,12];e.label=9;case 9:return e.trys.push([9,11,,12]),[4,this.options.cache.match(t.svg)];case 10:return c=e.sent(),this.renderReplacedElement(t,r,c),[3,12];case 11:return e.sent(),Logger$1.getInstance(this.options.id).error("Error loading svg "+t.svg.substring(0,255)),[3,12];case 12:return t instanceof IFrameElementContainer&&t.tree?[4,new A({id:this.options.id,scale:this.options.scale,backgroundColor:t.backgroundColor,x:0,y:0,scrollX:0,scrollY:0,width:t.width,height:t.height,cache:this.options.cache,windowWidth:t.width,windowHeight:t.height}).render(t.tree)]:[3,14];case 13:o=e.sent(),t.width&&t.height&&this.ctx.drawImage(o,0,0,t.width,t.height,t.bounds.left,t.bounds.top,t.bounds.width,t.bounds.height),e.label=14;case 14:if(t instanceof InputElementContainer&&(l=Math.min(t.bounds.width,t.bounds.height),t.type===CHECKBOX?t.checked&&(this.ctx.save(),this.path([new Vector(t.bounds.left+.39363*l,t.bounds.top+.79*l),new Vector(t.bounds.left+.16*l,t.bounds.top+.5549*l),new Vector(t.bounds.left+.27347*l,t.bounds.top+.44071*l),new Vector(t.bounds.left+.39694*l,t.bounds.top+.5649*l),new Vector(t.bounds.left+.72983*l,t.bounds.top+.23*l),new Vector(t.bounds.left+.84*l,t.bounds.top+.34085*l),new Vector(t.bounds.left+.39363*l,t.bounds.top+.79*l)]),this.ctx.fillStyle=asString(INPUT_COLOR),this.ctx.fill(),this.ctx.restore()):t.type===RADIO&&t.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(t.bounds.left+l/2,t.bounds.top+l/2,l/4,0,2*Math.PI,!0),this.ctx.fillStyle=asString(INPUT_COLOR),this.ctx.fill(),this.ctx.restore())),isTextInputElement(t)&&t.value.length){switch(this.ctx.font=this.createFontStyle(i)[0],this.ctx.fillStyle=asString(i.color),this.ctx.textBaseline="middle",this.ctx.textAlign=canvasTextAlign(t.styles.textAlign),h=contentBox(t),s=0,t.styles.textAlign){case TEXT_ALIGN.CENTER:s+=h.width/2;break;case TEXT_ALIGN.RIGHT:s+=h.width}l=h.add(s,0,0,-h.height/2+1),this.ctx.save(),this.path([new Vector(h.left,h.top),new Vector(h.left+h.width,h.top),new Vector(h.left+h.width,h.top+h.height),new Vector(h.left,h.top+h.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new TextBounds(t.value,l),i.letterSpacing),this.ctx.restore(),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"}if(!contains(t.styles.display,2048))return[3,20];if(null===t.styles.listStyleImage)return[3,19];if((d=t.styles.listStyleImage).type!==CSSImageType.URL)return[3,18];c=void 0,d=d.url,e.label=15;case 15:return e.trys.push([15,17,,18]),[4,this.options.cache.match(d)];case 16:return c=e.sent(),this.ctx.drawImage(c,t.bounds.left-(c.width+10),t.bounds.top),[3,18];case 17:return e.sent(),Logger$1.getInstance(this.options.id).error("Error loading list-style-image "+d),[3,18];case 18:return[3,20];case 19:u.listValue&&t.styles.listStyleType!==LIST_STYLE_TYPE.NONE&&(this.ctx.font=this.createFontStyle(i)[0],this.ctx.fillStyle=asString(i.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",h=new Bounds(t.bounds.left,t.bounds.top+getAbsoluteValue(t.styles.paddingTop,t.bounds.width),t.bounds.width,computeLineHeight(i.lineHeight,i.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new TextBounds(u.listValue,h),i.letterSpacing),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),e.label=20;case 20:return[2]}})})},A.prototype.renderStackContent=function(f){return __awaiter(this,void 0,void 0,function(){var t,r,i,n,a,o,s,l,c,d,h,u,A,p,m;return __generator(this,function(e){switch(e.label){case 0:return[4,this.renderNodeBackgroundAndBorders(f.element)];case 1:e.sent(),t=0,r=f.negativeZIndex,e.label=2;case 2:return t<r.length?(m=r[t],[4,this.renderStack(m)]):[3,5];case 3:e.sent(),e.label=4;case 4:return t++,[3,2];case 5:return[4,this.renderNodeContent(f.element)];case 6:e.sent(),i=0,n=f.nonInlineLevel,e.label=7;case 7:return i<n.length?(m=n[i],[4,this.renderNode(m)]):[3,10];case 8:e.sent(),e.label=9;case 9:return i++,[3,7];case 10:a=0,o=f.nonPositionedFloats,e.label=11;case 11:return a<o.length?(m=o[a],[4,this.renderStack(m)]):[3,14];case 12:e.sent(),e.label=13;case 13:return a++,[3,11];case 14:s=0,l=f.nonPositionedInlineLevel,e.label=15;case 15:return s<l.length?(m=l[s],[4,this.renderStack(m)]):[3,18];case 16:e.sent(),e.label=17;case 17:return s++,[3,15];case 18:c=0,d=f.inlineLevel,e.label=19;case 19:return c<d.length?(m=d[c],[4,this.renderNode(m)]):[3,22];case 20:e.sent(),e.label=21;case 21:return c++,[3,19];case 22:h=0,u=f.zeroOrAutoZIndexOrTransformedOrOpacity,e.label=23;case 23:return h<u.length?(m=u[h],[4,this.renderStack(m)]):[3,26];case 24:e.sent(),e.label=25;case 25:return h++,[3,23];case 26:A=0,p=f.positiveZIndex,e.label=27;case 27:return A<p.length?(m=p[A],[4,this.renderStack(m)]):[3,30];case 28:e.sent(),e.label=29;case 29:return A++,[3,27];case 30:return[2]}})})},A.prototype.mask=function(e){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(e.slice(0).reverse()),this.ctx.closePath()},A.prototype.path=function(e){this.ctx.beginPath(),this.formatPath(e),this.ctx.closePath()},A.prototype.formatPath=function(e){var i=this;e.forEach(function(e,t){var r=isBezierCurve(e)?e.start:e;0===t?i.ctx.moveTo(r.x,r.y):i.ctx.lineTo(r.x,r.y),isBezierCurve(e)&&i.ctx.bezierCurveTo(e.startControl.x,e.startControl.y,e.endControl.x,e.endControl.y,e.end.x,e.end.y)})},A.prototype.renderRepeat=function(e,t,r,i){this.path(e),this.ctx.fillStyle=t,this.ctx.translate(r,i),this.ctx.fill(),this.ctx.translate(-r,-i)},A.prototype.resizeImage=function(e,t,r){var i;return e.width===t&&e.height===r?e:((i=this.canvas.ownerDocument.createElement("canvas")).width=t,i.height=r,i.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t,r),i)},A.prototype.renderBackgroundImage=function(w){return __awaiter(this,void 0,void 0,function(){var x,t,b,r,i,n;return __generator(this,function(e){switch(e.label){case 0:x=w.styles.backgroundImage.length-1,t=function(t){var r,i,n,a,o,s,l,c,d,h,u,A,p,m,f,g,v,_,y,E,T;return __generator(this,function(e){switch(e.label){case 0:if(t.type!==CSSImageType.URL)return[3,5];r=void 0,i=t.url,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,b.options.cache.match(i)];case 2:return r=e.sent(),[3,4];case 3:return e.sent(),Logger$1.getInstance(b.options.id).error("Error loading background-image "+i),[3,4];case 4:return r&&(h=calculateBackgroundRendering(w,x,[r.width,r.height,r.width/r.height]),s=h[0],A=h[1],p=h[2],d=h[3],h=h[4],a=b.ctx.createPattern(b.resizeImage(r,d,h),"repeat"),b.renderRepeat(s,a,A,p)),[3,6];case 5:isLinearGradient(t)?(u=calculateBackgroundRendering(w,x,[null,null,null]),s=u[0],A=u[1],p=u[2],d=u[3],h=u[4],u=calculateGradientDirection(t.angle,d,h),m=u[0],o=u[1],c=u[2],l=u[3],u=u[4],(g=document.createElement("canvas")).width=d,g.height=h,f=g.getContext("2d"),n=f.createLinearGradient(o,l,c,u),processColorStops(t.stops,m).forEach(function(e){return n.addColorStop(e.stop,asString(e.color))}),f.fillStyle=n,f.fillRect(0,0,d,h),0<d&&0<h&&(a=b.ctx.createPattern(g,"repeat"),b.renderRepeat(s,a,A,p))):isRadialGradient(t)&&(o=calculateBackgroundRendering(w,x,[null,null,null]),s=o[0],l=o[1],c=o[2],d=o[3],h=o[4],u=0===t.position.length?[FIFTY_PERCENT]:t.position,A=getAbsoluteValue(u[0],d),p=getAbsoluteValue(u[u.length-1],h),m=calculateRadius(t,A,p,d,h),f=m[0],g=m[1],0<f)&&(v=b.ctx.createRadialGradient(l+A,c+p,0,l+A,c+p,f),processColorStops(t.stops,2*f).forEach(function(e){return v.addColorStop(e.stop,asString(e.color))}),b.path(s),b.ctx.fillStyle=v,f!==g?(_=w.bounds.left+.5*w.bounds.width,y=w.bounds.top+.5*w.bounds.height,T=1/(E=g/f),b.ctx.save(),b.ctx.translate(_,y),b.ctx.transform(1,0,0,E,0,0),b.ctx.translate(-_,-y),b.ctx.fillRect(l,T*(c-y)+y,d,h*T),b.ctx.restore()):b.ctx.fill()),e.label=6;case 6:return x--,[2]}})},b=this,r=0,i=w.styles.backgroundImage.slice(0).reverse(),e.label=1;case 1:return r<i.length?(n=i[r],[5,t(n)]):[3,4];case 2:e.sent(),e.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},A.prototype.renderBorder=function(t,r,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.path(parsePathForBorder(i,r)),this.ctx.fillStyle=asString(t),this.ctx.fill(),[2]})})},A.prototype.renderNodeBackgroundAndBorders=function(c){return __awaiter(this,void 0,void 0,function(){var t,r,i,n,a,o,s,l=this;return __generator(this,function(e){switch(e.label){case 0:return(this.applyEffects(c.effects,2),t=c.container.styles,s=!isTransparent(t.backgroundColor)||t.backgroundImage.length,r=[{style:t.borderTopStyle,color:t.borderTopColor},{style:t.borderRightStyle,color:t.borderRightColor},{style:t.borderBottomStyle,color:t.borderBottomColor},{style:t.borderLeftStyle,color:t.borderLeftColor}],i=calculateBackgroundCurvedPaintingArea(getBackgroundValueForIndex(t.backgroundClip,0),c.curves),s||t.boxShadow.length)?(this.ctx.save(),this.path(i),this.ctx.clip(),isTransparent(t.backgroundColor)||(this.ctx.fillStyle=asString(t.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(c.container)]):[3,2];case 1:e.sent(),this.ctx.restore(),t.boxShadow.slice(0).reverse().forEach(function(e){l.ctx.save();var t=calculateBorderBoxPath(c.curves),r=e.inset?0:MASK_OFFSET,i=transformPath(t,-r+(e.inset?1:-1)*e.spread.number,(e.inset?1:-1)*e.spread.number,e.spread.number*(e.inset?-2:2),e.spread.number*(e.inset?-2:2));e.inset?(l.path(t),l.ctx.clip(),l.mask(i)):(l.mask(t),l.ctx.clip(),l.path(i)),l.ctx.shadowOffsetX=e.offsetX.number+r,l.ctx.shadowOffsetY=e.offsetY.number,l.ctx.shadowColor=asString(e.color),l.ctx.shadowBlur=e.blur.number,l.ctx.fillStyle=e.inset?asString(e.color):"rgba(0,0,0,1)",l.ctx.fill(),l.ctx.restore()}),e.label=2;case 2:a=n=0,o=r,e.label=3;case 3:return a<o.length?(s=o[a]).style===BORDER_STYLE.NONE||isTransparent(s.color)?[3,5]:[4,this.renderBorder(s.color,n,c.curves)]:[3,7];case 4:e.sent(),e.label=5;case 5:n++,e.label=6;case 6:return a++,[3,3];case 7:return[2]}})})},A.prototype.render=function(r){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=asString(this.options.backgroundColor),this.ctx.fillRect(this.options.x-this.options.scrollX,this.options.y-this.options.scrollY,this.options.width,this.options.height)),t=parseStackingContexts(r),[4,this.renderStack(t)];case 1:return e.sent(),this.applyEffects([],2),[2,this.canvas]}})})},A}(),isTextInputElement=function(e){return e instanceof TextareaElementContainer||e instanceof SelectElementContainer||e instanceof InputElementContainer&&e.type!==RADIO&&e.type!==CHECKBOX},calculateBackgroundCurvedPaintingArea=function(e,t){switch(e){case BACKGROUND_CLIP.BORDER_BOX:return calculateBorderBoxPath(t);case BACKGROUND_CLIP.CONTENT_BOX:return calculateContentBoxPath(t);default:BACKGROUND_CLIP.PADDING_BOX;return calculatePaddingBoxPath(t)}},canvasTextAlign=function(e){switch(e){case TEXT_ALIGN.CENTER:return"center";case TEXT_ALIGN.RIGHT:return"right";default:TEXT_ALIGN.LEFT;return"left"}},ForeignObjectRenderer=function(){function e(e){this.canvas=e.canvas||document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.options=e,this.canvas.width=Math.floor(e.width*e.scale),this.canvas.height=Math.floor(e.height*e.scale),this.canvas.style.width=e.width+"px",this.canvas.style.height=e.height+"px",this.ctx.scale(this.options.scale,this.options.scale),this.ctx.translate(-e.x+e.scrollX,-e.y+e.scrollY),Logger$1.getInstance(e.id).debug("EXPERIMENTAL ForeignObject renderer initialized ("+e.width+"x"+e.height+" at "+e.x+","+e.y+") with scale "+e.scale)}return e.prototype.render=function(r){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t=createForeignObjectSVG(Math.max(this.options.windowWidth,this.options.width)*this.options.scale,Math.max(this.options.windowHeight,this.options.height)*this.options.scale,this.options.scrollX*this.options.scale,this.options.scrollY*this.options.scale,r),[4,loadSerializedSVG$1(t)];case 1:return t=e.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=asString(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(t,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},e}(),loadSerializedSVG$1=function(i){return new Promise(function(e,t){var r=new Image;r.onload=function(){e(r)},r.onerror=t,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(i))})},_this=void 0,parseColor$1=function(e){return color$1.parse(Parser.create(e).parseComponentValue())},html2canvas=function(e,t){return renderElement(e,t=void 0===t?{}:t)},renderElement=("undefined"!=typeof window&&CacheStorage.setContext(window),function(p,m){return __awaiter(_this,void 0,void 0,function(){var t,r,i,n,a,o,s,l,c,d,h,u,A;return __generator(this,function(e){switch(e.label){case 0:if(!(t=p.ownerDocument))throw new Error("Element is not attached to a Document");if(o=t.defaultView)return r=(Math.round(1e3*Math.random())+Date.now()).toString(16),c=isBodyElement(p)||isHTMLElement(p)?parseDocumentSize(t):parseBounds(p),l=c.width,n=c.height,i=c.left,c=c.top,s=__assign({},{allowTaint:!1,imageTimeout:15e3,proxy:void 0,useCORS:!1},m),o={backgroundColor:"#ffffff",cache:m.cache||CacheStorage.create(r,s),logging:!0,removeContainer:!0,foreignObjectRendering:!1,scale:o.devicePixelRatio||1,windowWidth:o.innerWidth,windowHeight:o.innerHeight,scrollX:o.pageXOffset,scrollY:o.pageYOffset,x:i,y:c,width:Math.ceil(l),height:Math.ceil(n),id:r},i=__assign({},o,s,m),c=new Bounds(i.scrollX,i.scrollY,i.windowWidth,i.windowHeight),Logger$1.create({id:r,enabled:i.logging}),Logger$1.getInstance(r).debug("Starting document clone"),l=new DocumentCloner(p,{id:r,onclone:i.onclone,ignoreElements:i.ignoreElements,inlineImages:i.foreignObjectRendering,copyStyles:i.foreignObjectRendering}),(n=l.clonedReferenceElement)?[4,l.toIFrame(t,c)]:[2,Promise.reject("Unable to find element in cloned iframe")];throw new Error("Document is not attached to a Window");case 1:return(a=e.sent(),o=t.documentElement?parseColor$1(getComputedStyle(t.documentElement).backgroundColor):COLORS.TRANSPARENT,s=t.body?parseColor$1(getComputedStyle(t.body).backgroundColor):COLORS.TRANSPARENT,l=m.backgroundColor,c="string"==typeof l?parseColor$1(l):null===l?COLORS.TRANSPARENT:4294967295,d=p===t.documentElement?isTransparent(o)?isTransparent(s)?c:s:o:c,h={id:r,cache:i.cache,canvas:i.canvas,backgroundColor:d,scale:i.scale,x:i.x,y:i.y,scrollX:i.scrollX,scrollY:i.scrollY,width:i.width,height:i.height,windowWidth:i.windowWidth,windowHeight:i.windowHeight},i.foreignObjectRendering)?(Logger$1.getInstance(r).debug("Document cloned, using foreign object rendering"),[4,new ForeignObjectRenderer(h).render(n)]):[3,3];case 2:return u=e.sent(),[3,5];case 3:return Logger$1.getInstance(r).debug("Document cloned, using computed rendering"),CacheStorage.attachInstance(i.cache),Logger$1.getInstance(r).debug("Starting DOM parsing"),A=parseTree(n),CacheStorage.detachInstance(),d===A.styles.backgroundColor&&(A.styles.backgroundColor=COLORS.TRANSPARENT),Logger$1.getInstance(r).debug("Starting renderer"),[4,new CanvasRenderer(h).render(A)];case 4:u=e.sent(),e.label=5;case 5:return!0!==i.removeContainer||DocumentCloner.destroy(a)||Logger$1.getInstance(r).error("Cannot detach cloned iframe as it is not in the DOM anymore"),Logger$1.getInstance(r).debug("Finished rendering"),Logger$1.destroy(r),CacheStorage.destroy(r),[2,u]}})})});class ImageExporter{constructor(e,t){this.revision=1,checkPropTypes(t,{view:View||DefaultView},{}),this._view=t.view}_dataURIToBlob(e){var t=window.atob(e.split(",")[1]),r=t.length,i=new Uint8Array(r);for(let e=0;e<r;e++)i[e]=t.charCodeAt(e);return new window.Blob([i])}_saveDataURI(e,t){const r=this._dataURIToBlob(t),i=document.createElement("a");i.download=e,i.href=window.URL.createObjectURL(r),i.onclick=()=>{window.setTimeout(()=>{window.URL.revokeObjectURL(r),i.removeAttribute("href")},500)},i.click()}_defaultFileName(e){return((new Date).toLocaleDateString()+" at "+(new Date).toLocaleTimeString()+e).replace(/\//g,"-").replace(/:/g,".")}async export(e,t,{saveToFile:r,transparent:i,html:n,extension:a}={}){a=a??"png",this._view.perspectiveCamera.aspect=(e=e||800)/(t=t||600),this._view.perspectiveCamera.updateProjectionMatrix(),i&&this._view.renderer.setClearColor(0,0),await this._view.update(),this._view.renderer.setSize(e,t),this._view.composer.setSize(e,t),this._view.css2dRenderer.setSize(e,t),this._view.composer.render(this._view.scene,this._view.perspectiveCamera,null,!1);var o=null;return n?(console.log("save html"),this._view.domElement,(n=document.createElement("div")).style.width=e.toString()+"px",n.style.height=t.toString()+"px",n.id="htmlCanvas",n.style.zIndex="-10",n.style.background="white",n.appendChild(this._view.renderer.domElement),n.appendChild(this._view.css2dRenderer.domElement),document.body.appendChild(n),this._view.renderer.setClearColor(16777215,1),this._view.composer.render(this._view.scene,this._view.perspectiveCamera,null,!1),this._view.css2dRenderer.render(this._view.scene,this._view.perspectiveCamera,null,!1),await html2canvas(document.querySelector("#htmlCanvas")).then(e=>{o=e.toDataURL("image/"+a),r&&this._saveDataURI(this._defaultFileName("."+a),o)}),this._view.domElement.appendChild(this._view.renderer.domElement),this._view.domElement.appendChild(this._view.css2dRenderer.domElement),n.remove()):(console.log("save renderer"),o=this._view.renderer.domElement.toDataURL("image/"+a),r&&this._saveDataURI(this._defaultFileName("."+a),o)),i&&this._view.renderer.setClearColor(16777215,1),this._view.updateDOMElementDimensions(),o}}class Project extends StateTracker{constructor(e,t={}){super(e,t),this.bodyChangeHandlePromise=null,this.bodyChangeHandlePromiseResolver=null,this.timer=void 0,this.scene=void 0,this.renderer=void 0,this.server=void 0,this.pkgs=void 0,this.projectIOPromiseChain=Promise.resolve(),this.singleBlockInstances=[],this.configurators=void 0,this.views=[],this.messageApiSubscriptions={},this.allowedIFrameAPIOrigins=[],this.addEvent("price"),window.onerror=(e,t,r,i,n)=>{this.report({msg:"Uncaught error: "+e,level:"error"}),console.error(n)},Object.defineProperty(window,"uuid",{get:InformationSource.uuid});const a=this;this.frontEndClientEventListener=t.onEvent||(()=>""),this.allowedIFrameAPIOrigins=t.allowedIFrameOrigins,this.exportConfig=function(){var t,r=this;window.exportConfig=function(){for(var e of r.configurators)e.visible&&(t=JSON.stringify(pick(["info","blockInstances","connections","materialAssignments","themes"],e.configuration.toJSON())),console.debug("Exported config",t))}},this.exportConfig(),this.rendererSettings={...defaultRendererSettings,...t.rendererSettings||{}},this.renderer=new WebGLRenderer;for(const i in this.rendererSettings)this.rendererSettings.hasOwnProperty(i)&&this.renderer.hasOwnProperty(i)&&(this.renderer[i]=this.rendererSettings[i]),"name"===i&&(this.renderer[i]=this.rendererSettings[i]);this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setClearColor(0,0),this.rendererOrtho=new WebGLRenderer(this.rendererSettings),this.rendererOrtho.setPixelRatio(window.devicePixelRatio),Project.maxAnisotropy=this.renderer.capabilities.getMaxAnisotropy(),this.timer=new Timer(this._reporter),this.timer.on("update",async()=>{if(null===this.bodyChangeHandlePromise)for(var e of this.views)e.update();else{for(var t of this.views){var r=this.configurators.map(e=>({boundingBox:e.configuration.boundingBox,configurationId:e.configuration.id,id:e.id}));t.hideDimensions(),t.onSceneUpdate(r)}let e=!1;var i,n={};for(i of this.actors)!1!==i.visible&&(n[i.slug]=i.cursor,void 0===this.state?.[i.slug]||this.state[i.slug]!==n[i.slug])&&(e=!0);n.cleanUp=function({state:e,stateRegister:r}){console.log("Project state clean up");e=Object.keys(e);const t=Object.keys(r[0]);r=e.filter(e=>!1===t.includes(e));console.info("Removing actors",r);for(let t of r){var i=a.configurators.find(e=>e.slug===t);i?a.removeConfigurator(i):console.error("Missing configurator with slug "+t)}},e&&await this.addState({newState:n,moveCursor:"silent"}),this.bodyChangeHandlePromiseResolver(),this.bodyChangeHandlePromise=null,this.bodyChangeHandlePromiseResolver=null}}),t.server&&(this.server=new ServerConnection(e,{url:t.server||new URL("wss://backend.productbuilder.nl"),reconnectTime:t.reconnectTime||5}));const r=this.loadFromLocalStorage("autosave");r&&(this.autosave={age:((new Date).getTime()-r.meta.time)/1e3,data:r,restore:async()=>(console.log("Restoring autosave"),a.buildProjectFromExport(r))}),this.reset(),this.initIFrameAPI()}async addPackage(e,t=[]){return this.projectIOPromiseChain=this.projectIOPromiseChain.then(()=>this._addPackage(e,t)).catch(e=>(console.error(e),new Error(e))),this.projectIOPromiseChain}async _addPackage(t,r=[]){this.report({msg:"Load package "+t,level:"notice"}),console.assert(t instanceof URL),console.assert(Array.isArray(r));var e=`${t.href}${"/"!==t.href.substr(-1)?"/":""}index.json?r=`+Math.random(),e=(this.report({msg:"Loading index from "+e}),await fetch(e));if(!e.ok)throw console.warn(e),new Error("Load package failed");e=await e.json();if(e.loadingBases){var i,n=e.loadingBases;delete e.loadingBases;for(i of n){let e=null;try{var a="%%package_url%%"===i.url?t:i.url;e=new URL(a)}catch(e){throw new Error("Could not parse loading base url "+i.url)}var o=i.for;if(!o)throw new Error(`Loading base ${i.url} is missing "for" array, maybe it should be "for: [ 'default' ]"?`);o=new LoadingBase(this._reporter,{for:o,url:e});r.push(o)}}0===r.length&&(n=new LoadingBase(this._reporter,{name:"Package URL base",for:["default"],url:t}),r.push(n));n=new ComponentLoader(this._reporter,{name:"PackageLoader",bases:r}),e=Package.createFromJSON(e,this._reporter,null,{loader:n,renderer:this.renderer});return Object.freeze(e),this._addPackageObject(e),this.report({msg:"Package load complete: "+e.label,level:"notice"}),this.triggerWindowAPIEvent("pkg-loaded",e.id),e}_addPackageObject(e){this.report({msg:"Adding "+e.label,level:"notice"}),this.pkgs.push(e)}get actors(){return[...this.configurators,...this.singleBlockInstances]}addActor(e,t,r=!1){console.assert(e instanceof Actor),this.report({msg:"Adding "+e.label,level:"notice"}),t.push(e),this.scene.add(e.body),e.on("bodychange",async(e=0)=>{null===this.bodyChangeHandlePromise&&(this.bodyChangeHandlePromise=new Promise(e=>this.bodyChangeHandlePromiseResolver=e),this.timer.trigger()),await this.bodyChangeHandlePromise,!0===r&&(this.overwritePreviousState(),r=!1),this.timer.trigger()}),this.timer.trigger()}hideActor(e){}addSingleBlockInstance(e,t,r){if(-1===this.pkgs.indexOf(e.tree))throw new Error("Block belongs to unknown tree");var i=new BlockInstance(this._reporter,{block:e}),i=new SingleBlockInstance(this._reporter,{blockInstance:i,loader:e.tree.loader,position:t||new Vector3,quaternion:r||new Quaternion});return this.addActor(i,this.singleBlockInstances),i}async addConfigurator(e,t=!1){if(-1===this.pkgs.indexOf(e.pkg))throw new Error("Unknown package");e=new Configurator(this._reporter,e);return this.timer.trigger(),this.addActor(e,this.configurators,t),this.timer.trigger(),this.triggerWindowAPIEvent("configurator-added",e.id),await e.initialConfigBuiltPromise,this.triggerWindowAPIEvent("configurator-initialized",e.id),e}findConfigurator(t){return this.configurators.find(e=>e.configuration===t&&!0===e.visible)}addView(e){return e=e||new DefaultView(this._reporter,{scene:this.scene,renderer:this.renderer,rendererOrtho:this.rendererOrtho,timer:this.timer,findConfigurator:this.findConfigurator.bind(this),addConfigurator:this.addConfigurator.bind(this),findComponentById:this.findComponentById.bind(this)}),this.views.push(e),e.onSceneUpdate(),e}onStateCursorMoved(e){for(var t of this.actors)void 0===e[t.slug]&&!0===t.visible&&t.hide();for(var r of this.actors)void 0!==e[r.slug]&&(!0!==r.visible&&r.show(),r.setCursor(e[r.slug]))}undo(e=1){for(var t of this.views)t.removeAllMarkers();return super.undo(e)}redo(e=1){for(var t of this.views)t.removeAllMarkers();return super.redo(e)}removeConfigurator(e){var t=this.configurators.indexOf(e);if(-1===t)throw new Error("Unknown configurator",e);this.scene&&this.scene.remove(e.body),e.destroy(),this.configurators.splice(t,1)}reset(e=!1){if(this.report({msg:"Project reset",level:"notice"}),this.resetState(),this.removeAllListeners(),this.configurators)for(var t of this.configurators)this.removeConfigurator(t);if(this.configurators=[],this.pkgs&&!0===e)for(var r of this.pkgs)r.removeAllListeners();this.pkgs&&!0!==e||(this.pkgs=[]),this.scene||(this.scene=new Scene);for(var i of Object.keys(this.timer.updateRequests))this.timer.removeUpdateRequest(i);this.boundingBox=null}async load(e){return this.projectIOPromiseChain=this.projectIOPromiseChain.then(()=>this._load(e)).catch(e=>new Error(e)),this.projectIOPromiseChain}async _load(e){var t;if(this.report({msg:"Loading project "+e,level:"notice"}),this.server&&this.server.connected)return t=null,e=await this.server.request({endpoint:"project",method:"read",data:{identifier:e}}),t=JSON.parse(e.data.export),console.log(t),this.report({msg:"Project data load success",level:"notice"}),e=this.buildProjectFromExport(t),this.report({msg:`Project ${this.id} load complete`,level:"notice"}),e;throw new Error("Unable to load project, not connected to server.")}loadFromLocalStorage(e){let t=null;if(localStorage){e=localStorage.getItem(e);if(e)try{t=JSON.parse(e)}catch(e){console.error("Could not load project from local storage.",e)}}return t}async buildProjectFromExport(e){this.report({msg:"Building project "+e.meta?.id,level:"notice"}),this.reset();for(let t of e.packages){var r=this.pkgs.find(e=>e.id===t.id);r?console.debug(r.label,"already loaded, not loading again"):await this.addPackage(new URL(t.url))}var t=await Promise.all(e.configurations.map(async t=>{var e=this.pkgs.find(e=>e.id===t.configuration.pkg),r=Configuration.createFromJSON(t.configuration,this._reporter,e).copy(),e=await this.addConfigurator({pkg:e,position:new Vector3(t.position.x,t.position.y,t.position.z),quaternion:new Quaternion(t.quaternion._x,t.quaternion._y,t.quaternion._z,t.quaternion._w),configuration:r});return await e.update(r),this.timer.trigger(),e}));return this.id=e.meta.id,t}async share(){return this.projectIOPromiseChain=this.projectIOPromiseChain.then(()=>this._save({copy:!0})).catch(e=>new Error(e)),this.projectIOPromiseChain}toJSON(){for(var e of this.configurators){var t=e.configuration.status.main.medium;if("ready"!==t)throw new Error(`Can't export project to JSON, configurator ${e.id} has a configuration that has not been built yet. (status = ${t})`)}var r={meta:{id:this.id,time:(new Date).getTime()},packages:this.pkgs.map(e=>({id:e.id,url:e.loader.loadingBases[0].url.href})),configurations:this.configurators.filter(e=>e.visible).map(e=>({configuration:e.configuration.toJSON(),position:e.state.position,quaternion:e.state.quaternion}))};return JSON.stringify(r)}async save(e){return this.projectIOPromiseChain=this.projectIOPromiseChain.then(()=>this._save(e)).catch(e=>new Error(e)),this.projectIOPromiseChain}async _save({copy:e=!1,metadata:t=void 0}={}){this.report({msg:`Save project ${this.id}, copy=`+e,level:"notice"}),await Promise.all(this.configurators.filter(e=>e.visible).map(e=>e.configuration.build()));var r,i,n,a=this.toJSON(),o=(localStorage&&localStorage.setItem("autosave",a),{export:a});if(!this.server||!this.server.connected)throw new Error("Unable to save project to server, not connected.");try{!0===e?(r={endpoint:"project",method:"create",data:{name:"",description:"",export:a,readonly:!0,metadata:t?JSON.stringify(t):void 0}},(i=await this.server.request(r)).data?(this.report({msg:"Project shared as "+i.data.slug,level:"notice"}),o.slug=i.data.slug,o.id=i.data.id):this.report({msg:"Project could not be shared: "+i.errors[0]?.description,level:"error"})):((n=await this.server.request({endpoint:"project",method:"update",data:{id:this.id||"<no id>",name:"",description:"",export:a,metadata:t?JSON.stringify(t):void 0}})).data?(this.report({msg:"Project saved",level:"notice"}),o.id=this.id,this.slug=o.slug=n.data.slug,this.price=o.price=n.data.price):(this.report({msg:"Project could not be saved: "+n.errors[0]?.description,level:"error"}),this.price=void 0),this.emit("price",this.price))}catch(e){console.error("Error while saving project:",e)}return o}findComponentById(e){let t=void 0;for(var r of this.pkgs)if(t=r.findComponentById(e))break;if(void 0===t)for(var i of this.configurators)if(i.visible&&(t=i.configuration.findComponentById(e)))break;return t}setTheme(r){for(let e=0,t=this.configurators.length;e<t;e+=1)this.configurators[e].setTheme(r),0<e&&this.overwritePreviousState()}registerUI({name:e="Unnamed UI",onEvent:t}){this.UI={name:e,onEvent:t}}makeMsgApiObject({id:e,type:t,error:r=!1,data:i=""}={}){return{id:e,type:t,target:"pb",error:r,data:i,apiVersion:1}}getEntityArray(e){switch(e){case"preset":return this.pkgs.reduce((e,t)=>[...e,...t.configurations],[]);case"actor":return this.actors;case"configurator":return this.configurators;case"pkg":return this.pkgs;default:throw new Error("Unknown entity type "+e)}}findEntityById(e,t){var r=this.getEntityArray(e);if(!t)throw new Error("Can not find ${entityType} without id");r=r.find(e=>e.id===t);if(r)return r;throw new Error(`Unknown ${e} id `+t)}listPresets(t){var r,i,n=[];let e=[];e=void 0===t?this.pkgs:this.pkgs.find(e=>e.id===t);for(r of this.pkgs)for(var a of r.configurations){let e=void 0;a.thumbnail&&(i=r.loader.findLoadingBaseFor(a.thumbnail?.loadingBase||"default"),e=""+i.url.href+a.thumbnail.source.medium.path),n.push({id:a.id,pkgId:r.id,name:a.name,thumbnail:e})}return n}async selectPreset({configuratorId:t,presetId:r,keepDefaultMaterials:e=!1}={}){var i=this.configurators.find(e=>e.id===t);if(!i)throw new Error("Unknown configurator id "+t);var n=this.listPresets().find(e=>e.id===r);if(!n)throw new Error("Unknown preset id "+r);if(i.pkg.id!==n.pkgId)throw new Error(`Preset/Package mismatch error. Preset with id ${r} does not match the package of configurator `+t);n=i.pkg.configurations.find(e=>e.id===r).toJSON();!0===e&&(e=i.configuration.toJSON(),n.defaultMaterials=e.defaultMaterials);e=Configuration.createFromJSON(n,this._reporter,i.pkg).copy();return i.update(e)}async listComponentOptions(){return this.configurators.reduce((e,t)=>[...e,...t.configuration.options.map(e=>({id:e.id,pkgId:t.id}))],[])}async listAssignableMaterials({configuratorId:t}){const a=this.configurators.find(e=>e.id===t);if(a)return a.configuration.options.materials.map(e=>{let t=void 0;e.thumbnail&&(r=a.pkg.loader.findLoadingBaseFor(e.thumbnail?.loadingBase||"default"),t=""+r.url.href+e.thumbnail.source.medium.path);var r,i={id:e.id,name:e.name,supplierReference:e.supRef,thumbnail:t};for(const n of e.categories)i[n.type.name]=n.name;return i});throw new Error("Unknown configurator id "+t)}async setDefaultMaterial({configuratorId:t,materialId:e}){var r=this.configurators.find(e=>e.id===t);if(r)return e=this.findComponentById(e),e=r.configuration.setDefaultMaterial(e),await r.update(e),!0;throw new Error("Unknown configurator id "+t)}async messageApiRequest(e){switch(e.method){case"set-locale":if(this.server&&this.server.connected){var t=await this.server.request({endpoint:"locale",method:"update",data:{locale:e.locale}});if(t.data)return this.report({msg:"Locale updated",level:"notice"}),!0;throw t="Locale could not be updated: "+t.errors[0]?.description,this.report({msg:t,level:"error"}),new Error(t)}response=makeResponse(!0,"Unable to set locale, not connected.");break;case"project-id":return this.id;case"project-slug":return this.slug;case"share-project":return this.share();case"save":case"save-project":t=await this.save();if(t instanceof Error)throw t;return t;case"load-project":t=await this.load(e.data.identifier);if(t instanceof Error)throw t;return{id:this.id,slug:this.slug};case"list-available-packages":break;case"list-loaded-packages":return this.pkgs.map(e=>({id:e.id}));case"list-configurators":return this.configurators.map(e=>({id:e.id,pkgId:e.pkg.id,initialized:e.initialConfigBuilt}));case"list-presets":return this.listPresets();case"screenshot":return await new ImageExporter(this.reporter,{view:this.views[0]}).export(600,400);case"configuration-summary":break;case"select-preset":await this.selectPreset(e.data);return!0;case"list-component-options":return this.listComponentOptions(e.data);case"list-assignable-materials":return this.listAssignableMaterials(e.data);case"set-default-material":return this.setDefaultMaterial(e.data);case"ui":return this.frontEndClientEventListener(e.data);case"price":return this.price;case"export-project":return await Promise.all(this.configurators.filter(e=>e.visible).map(e=>e.configuration.build())),this.toJSON();default:throw new Error("Unknown Window API method name: "+e.method)}}triggerWindowAPIEvent(e,t){for(var[r,i]of Object.entries(this.messageApiSubscriptions))i.source.postMessage(this.makeMsgApiObject({id:InformationSource.uuid(),type:e,data:t}),r)}enableWindowAPI(e){return console.debug("Set allowed origins for IFrame API",e),e.push(/^https:\/\/moooi-next-ecom-platform.*vercel.app$/g),this.allowedIFrameAPIOrigins=e,!0}setAllowedIFrameOrigins(e){return this.enableWindowAPI(e)}initIFrameAPI(){const a=this;this.on("price",function(e){a.triggerWindowAPIEvent("price",e)}),window.addEventListener("message",async e=>{let t=!1;for(var r of this.allowedIFrameAPIOrigins){if("string"==typeof r&&e.origin===r){t=!0;break}if(r instanceof RegExp&&e.origin.match(r)){t=!0;break}}if("pbping"===e.data)i={target:"pb",type:"pbinfo",originAllowed:t,origin:e.origin},e.source.postMessage(i,e.origin);else if(t){var i=e.data;let t=null;if("object"==typeof i&&"pb"===i.target){if(i.id||(i.id=InformationSource.uuid()),"subscribe"===i.method)this.messageApiSubscriptions[e.origin]={source:e.source},t=a.makeMsgApiObject({id:i.id,type:"response",error:!1,data:!0});else if("unsubscribe"===i.method)delete this.messageApiSubscriptions[e.origin],t=a.makeMsgApiObject({id:i.id,type:"response",error:!1,data:!0});else try{var n=await a.messageApiRequest(i);t=a.makeMsgApiObject({id:i.id,type:"response",error:!1,data:n})}catch(e){console.log(e),t=a.makeMsgApiObject({id:i.id,type:"response",error:!0,data:e.message})}e.source.postMessage(t,e.origin)}}})}}Project.layerMap={grid:1,boundingBoxes:2,dimLines:3,connectorHelpers:4,lightHelpers:5,visibleActors:6,hiddenActors:7,shadowPlane:8,castShadow:9},Project.maxAnisotropy=void 0,Project.standardQuaternions={"+x":(new Quaternion).setFromEuler(new Euler(Math.PI,0,0)),"-x":(new Quaternion).setFromEuler(new Euler(-Math.PI,0,0)),"+y":(new Quaternion).setFromEuler(new Euler(0,Math.PI,0)),"-y":(new Quaternion).setFromEuler(new Euler(0,-Math.PI,0)),"+z":(new Quaternion).setFromEuler(new Euler(0,0,Math.PI)),"-z":(new Quaternion).setFromEuler(new Euler(0,0,-Math.PI))},Project.defaultImages={missing:makeImage(128,128,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAEzklEQVR4nO3dsW7bSBCAYRVJe5DTOEiRGK4CuNEj6BHYEJxZN2pOCFKm8iPcA6W4IkHUB4HdnZtAblLHb5Brdn3rxeYkWTtLkfo/wI2L3SVnSJGzS3IyAQAAAAAAAAAAAAAAAAAAAAAAAEoSkYWqXjdNM+17LE/VNM1UVa9FZNH3WAbFB/+X/xtkEoTgh+0gCbaUBH+QSZAGnyTYUib4d0NLgkzw70iCLYjIWbqjmqaZishN9P9V3+PcRFVX0Tbc+G1YJNt21vc4D1LYUfFREpJARO6dc7Meh7cV59xMRO5D8MP/c9uGjNzR0TTNdAjBD5xzs9zPFUc+AHAqzDiafWJxMdR13QdVPS3V3ib+juV9wfaO4wLR4nZIVa98e7c1kkBEzkRk7cf/rkR7R1EnyAR/sW+by+XyeVJ0+ccyCeLg+234Op/PnxVot/i+OSiWG+icO0mS4NY596ZU+0Em+N/atn1RsP3xJkFczRORdemSbiYJ7komgXXwJ5OHglfcx03J9nuVKekWr+tbJUHbti9rBD+ZObwZwrzHTmongYj8cM6d79umiLxS1e/hGoPg7yFOAqvavnPuREQ+qepFwTbPVfVz27YvS7UZtT0TkfvRBz/wGb8aUm3fmnNupqqr0QcfAIANLH8Lc6uNa6ze5fd9SyLyl1VdX1Wb9DY0s4avKd1vVEi6Kt32qIjIn3FJt/RtV64WYX0PnlYRu65rS7Y/Kqp66o/+hyQofSbIJIFZ8GtUEUenjySwCr6fnXyYqST4W/JJcF0jCSoGv3gVcdQykzt/l+4jXASWbldEPlpeyxyNkASlJnZqcc6di8gPjvwCfBIUm9ipRVXfEnwAAOyoatNHnd2XkIuXjbGDaCVt1XcHxPMHo1q9OzTWawxzcmv4rPvEb9RYaJr2dzQLOIeiVhIQ/ANVKzC1zzbYQu2jkiQ4MNZTujm5JLDuE78RPVdf9fc4ecBlUatfZFAIAgBgnPz6urd9j2NXqnrhnDvpexyDFhZXDnhJ2DVJ8EQ++LfRff7H0n1YLQrV6IXRJMET1FhWHVURLd5U8iZ5toEk2Fbl4JuVdDMPuJAEm7Rt+6KH4JMEh6Lrujb6zV+3bfu6ZPu5ySPryZ3MtcyiZPujo6pXIrK2eHmyRo+Hh/mDzORO8fJudCbg8fBtWL8gIp08ip4TXFj1e3l5+YdV2wAADIH/vf3CiyL/498W+mX0y8uS27CfFkngb7s+l5w7UNULEflkcQ/v3xL6c/RrDGss4EyqiN9F5NW+bUYTOyaFnKNYaFop+I+qiL6QtHcV0df1H33CliTYUbJxdxbBF5FvcfBLFpJqJUHaR8n2e2X5ORTr4AfWSTDqT8ZMJjYbOJ/Pn4nIV+vgB7kkWC6Xz/dtd/TBDyw+Gyci72oEP0jm+veu7R/NZ+MCMfhIoqq+rxH8qL/Trus+lGrPYp8ctJrBGgr2CQBkT4VN00yHNHfgnJvlah2c5jfIXQxFVUSTuYPSotr+o2re0V3o7Sp3O5RZwLnqe5ybaPJMgC/zFr/9HaXMjoo/tjCId/JkvkWwThO77zEetDQJhhT84H++SrLoe2yDECfB0IIfZM4Ei77HNCi51btDU2O1MQAAAAAAAAAAAAAAAAAAAAAAAI7UvxmoXFiIe/GjAAAAAElFTkSuQmCC")},Project.basis="+X+Y+Z";const _position$4=new Vector3$1,_quaternion$5=new Quaternion$1,_scale$3=new Vector3$1,_matrix$1=new Matrix4$1,_matrix2=new Matrix4$1;function drawDimensionsLine(e,t,r,i){var n=Project.layerMap.dimLines;switch(i){case"left":var a=new Vector3(-r,-.01,0);break;case"back":a=new Vector3(0,-.01,-r);break;case"right":a=new Vector3(r,-.01,0);break;case"front":a=new Vector3(0,-.01,r);break;case"height":a=new Vector3(-r,-.01,-r)}for(var o=[],s=0;s<t.length;s++)o.push(t[s].start),o.push(t[s].end);for(var l=new Group,i=(l.name="dimLine",(new BufferGeometry).setFromPoints(o)),c=document.createElement("canvas"),d=(c.width=128,c.height=128,c.getContext("2d")),d=(d.arc(64,64,64,0,2*Math.PI),d.fillStyle="#000000",d.fill(),new CanvasTexture(c)),c=new PointsMaterial({size:.03,map:d,transparent:!1,alphaTest:.5}),d=new Points(i,c),c=new LineBasicMaterial({color:0,linewidth:1}),i=new Line(i,c),h=(i.layers.set(n),d.layers.set(n),l.add(i),l.add(d),new Vector3),s=0;s<t.length;s++){var u=new Line3(t[s].start,t[s].end),A=document.createElement("div"),A=(A.className="label",A.textContent=Math.round(100*u.distance())+" cm",A.style.marginTop="-1em",new CSS2DObject(A));A.name="dimLabel",A.visible=!1,A.position.copy(u.getCenter(h)),A.layers.set(n),l.add(A),e.add(l)}l.position.add(a)}UniformsLib$1.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Vector2$1(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},ShaderLib$1.line={uniforms:UniformsUtils$1.merge([UniformsLib$1.common,UniformsLib$1.fog,UniformsLib$1.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class LineMaterial extends ShaderMaterial$1{constructor(e){super({type:"LineMaterial",uniforms:UniformsUtils$1.clone(ShaderLib$1.line.uniforms),vertexShader:ShaderLib$1.line.vertexShader,fragmentShader:ShaderLib$1.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(e){!0===e?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(e){Boolean(e)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),!0===e?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(e){Boolean(e)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),!0===e?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const _box$4=new Box3$1,_vector$d=new Vector3$1;class LineSegmentsGeometry extends InstancedBufferGeometry$1{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new Float32BufferAttribute$1([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new Float32BufferAttribute$1([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){var t=this.attributes.instanceStart,r=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),r.applyMatrix4(e),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));e=new InstancedInterleavedBuffer$1(t,6,1);return this.setAttribute("instanceStart",new InterleavedBufferAttribute$1(e,3,0)),this.setAttribute("instanceEnd",new InterleavedBufferAttribute$1(e,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));e=new InstancedInterleavedBuffer$1(t,6,1);return this.setAttribute("instanceColorStart",new InterleavedBufferAttribute$1(e,3,0)),this.setAttribute("instanceColorEnd",new InterleavedBufferAttribute$1(e,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new WireframeGeometry$1(e.geometry)),this}fromLineSegments(e){e=e.geometry;return this.setPositions(e.attributes.position.array),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Box3$1);var e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),_box$4.setFromBufferAttribute(t),this.boundingBox.union(_box$4))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Sphere$1),null===this.boundingBox&&this.computeBoundingBox();var i=this.attributes.instanceStart,n=this.attributes.instanceEnd;if(void 0!==i&&void 0!==n){var a=this.boundingSphere.center;this.boundingBox.getCenter(a);let r=0;for(let e=0,t=i.count;e<t;e++)_vector$d.fromBufferAttribute(i,e),r=Math.max(r,a.distanceToSquared(_vector$d)),_vector$d.fromBufferAttribute(n,e),r=Math.max(r,a.distanceToSquared(_vector$d));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}const _start$2=new Vector3$1,_end$2=new Vector3$1,_start4=new Vector4$1,_end4=new Vector4$1,_ssOrigin=new Vector4$1,_ssOrigin3=new Vector3$1,_mvMatrix=new Matrix4$1,_line=new Line3$1,_closestPoint=new Vector3$1,_box$5=new Box3$1,_sphere$7=new Sphere$1,_clipToWorldVector=new Vector4$1;let _ray$4,_lineWidth;function getWorldSpaceHalfWidth(e,t,r){return _clipToWorldVector.set(0,0,-t,1).applyMatrix4(e.projectionMatrix),_clipToWorldVector.multiplyScalar(1/_clipToWorldVector.w),_clipToWorldVector.x=_lineWidth/r.width,_clipToWorldVector.y=_lineWidth/r.height,_clipToWorldVector.applyMatrix4(e.projectionMatrixInverse),_clipToWorldVector.multiplyScalar(1/_clipToWorldVector.w),Math.abs(Math.max(_clipToWorldVector.x,_clipToWorldVector.y))}function raycastWorldUnits(r,i){var n=r.matrixWorld,a=r.geometry,o=a.attributes.instanceStart,s=a.attributes.instanceEnd;for(let e=0,t=Math.min(a.instanceCount,o.count);e<t;e++){_line.start.fromBufferAttribute(o,e),_line.end.fromBufferAttribute(s,e),_line.applyMatrix4(n);var l=new Vector3$1,c=new Vector3$1,d=(_ray$4.distanceSqToSegment(_line.start,_line.end,c,l),c.distanceTo(l)<.5*_lineWidth);d&&i.push({point:c,pointOnLine:l,distance:_ray$4.origin.distanceTo(c),object:r,face:null,faceIndex:e,uv:null,uv1:null})}}function raycastScreenSpace(r,e,i){var n,a,o,s,l=e.projectionMatrix,c=r.material.resolution,d=r.matrixWorld,h=r.geometry,u=h.attributes.instanceStart,A=h.attributes.instanceEnd,h=Math.min(h.instanceCount,u.count),p=-e.near;_ray$4.at(1,_ssOrigin),_ssOrigin.w=1,_ssOrigin.applyMatrix4(e.matrixWorldInverse),_ssOrigin.applyMatrix4(l),_ssOrigin.multiplyScalar(1/_ssOrigin.w),_ssOrigin.x*=c.x/2,_ssOrigin.y*=c.y/2,_ssOrigin.z=0,_ssOrigin3.copy(_ssOrigin),_mvMatrix.multiplyMatrices(e.matrixWorldInverse,d);for(let e=0,t=h;e<t;e++)_start4.fromBufferAttribute(u,e),_end4.fromBufferAttribute(A,e),_start4.w=1,_end4.w=1,_start4.applyMatrix4(_mvMatrix),_end4.applyMatrix4(_mvMatrix),_start4.z>p&&_end4.z>p||(_start4.z>p?(n=_start4.z-_end4.z,n=(_start4.z-p)/n,_start4.lerp(_end4,n)):_end4.z>p&&(n=_end4.z-_start4.z,a=(_end4.z-p)/n,_end4.lerp(_start4,a)),_start4.applyMatrix4(l),_end4.applyMatrix4(l),_start4.multiplyScalar(1/_start4.w),_end4.multiplyScalar(1/_end4.w),_start4.x*=c.x/2,_start4.y*=c.y/2,_end4.x*=c.x/2,_end4.y*=c.y/2,_line.start.copy(_start4),_line.start.z=0,_line.end.copy(_end4),_line.end.z=0,a=_line.closestPointToPointParameter(_ssOrigin3,!0),_line.at(a,_closestPoint),o=-1<=(o=MathUtils$1.lerp(_start4.z,_end4.z,a))&&o<=1,s=_ssOrigin3.distanceTo(_closestPoint)<.5*_lineWidth,o&&s&&(_line.start.fromBufferAttribute(u,e),_line.end.fromBufferAttribute(A,e),_line.start.applyMatrix4(d),_line.end.applyMatrix4(d),o=new Vector3$1,s=new Vector3$1,_ray$4.distanceSqToSegment(_line.start,_line.end,s,o),i.push({point:s,pointOnLine:o,distance:_ray$4.origin.distanceTo(s),object:r,face:null,faceIndex:e,uv:null,uv1:null})))}class LineSegments2 extends Mesh$1{constructor(e=new LineSegmentsGeometry,t=new LineMaterial({color:16777215*Math.random()})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){var e=this.geometry,i=e.attributes.instanceStart,n=e.attributes.instanceEnd,a=new Float32Array(2*i.count);for(let e=0,t=0,r=i.count;e<r;e++,t+=2)_start$2.fromBufferAttribute(i,e),_end$2.fromBufferAttribute(n,e),a[t]=0===t?0:a[t-1],a[t+1]=a[t]+_start$2.distanceTo(_end$2);var t=new InstancedInterleavedBuffer$1(a,2,1);return e.setAttribute("instanceDistanceStart",new InterleavedBufferAttribute$1(t,1,0)),e.setAttribute("instanceDistanceEnd",new InterleavedBufferAttribute$1(t,1,1)),this}raycast(t,r){var i=this.material.worldUnits,n=t.camera,e=(null!==n||i||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.'),void 0!==t.params.Line2&&t.params.Line2.threshold||0),t=(_ray$4=t.ray,this.matrixWorld),a=this.geometry,o=this.material;_lineWidth=o.linewidth+e,null===a.boundingSphere&&a.computeBoundingSphere(),_sphere$7.copy(a.boundingSphere).applyMatrix4(t);let s;if(s=i?.5*_lineWidth:getWorldSpaceHalfWidth(n,Math.max(n.near,_sphere$7.distanceToPoint(_ray$4.origin)),o.resolution),_sphere$7.radius+=s,!1!==_ray$4.intersectsSphere(_sphere$7)){null===a.boundingBox&&a.computeBoundingBox(),_box$5.copy(a.boundingBox).applyMatrix4(t);let e;e=i?.5*_lineWidth:getWorldSpaceHalfWidth(n,Math.max(n.near,_box$5.distanceToPoint(_ray$4.origin)),o.resolution),_box$5.expandByScalar(e),!1!==_ray$4.intersectsBox(_box$5)&&(i?raycastWorldUnits(this,r):raycastScreenSpace(this,n,r))}}}class LineGeometry extends LineSegmentsGeometry{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(t){var r=t.length-3,i=new Float32Array(2*r);for(let e=0;e<r;e+=3)i[2*e]=t[e],i[2*e+1]=t[e+1],i[2*e+2]=t[e+2],i[2*e+3]=t[e+3],i[2*e+4]=t[e+4],i[2*e+5]=t[e+5];return super.setPositions(i),this}setColors(t){var r=t.length-3,i=new Float32Array(2*r);for(let e=0;e<r;e+=3)i[2*e]=t[e],i[2*e+1]=t[e+1],i[2*e+2]=t[e+2],i[2*e+3]=t[e+3],i[2*e+4]=t[e+4],i[2*e+5]=t[e+5];return super.setColors(i),this}fromLine(e){e=e.geometry;return this.setPositions(e.attributes.position.array),this}}class Line2 extends LineSegments2{constructor(e=new LineGeometry,t=new LineMaterial({color:16777215*Math.random()})){super(e,t),this.isLine2=!0,this.type="Line2"}}const _start$3=new Vector3$1,_end$3=new Vector3$1;function drawDimensionsLineBoundingBox(e,t,r){var i=Project.layerMap.dimLines;switch(r){case"left":var n=new Vector3(-t,-.01,0);break;case"back":n=new Vector3(0,-.01,-t);break;case"right":n=new Vector3(t,-.01,0);break;case"front":n=new Vector3(0,-.01,t);break;case"height":n=new Vector3(-t,-.01,-t)}for(var a=[],o=0;o<e.length;o++)a.push(e[o].start),a.push(e[o].end);console.log("geoPoints",a);var s=new Group,r=(s.name="dimLine",(new BufferGeometry).setFromPoints(a)),l=document.createElement("canvas"),c=(l.width=128,l.height=128,l.getContext("2d")),c=(c.arc(64,64,64,0,2*Math.PI),c.fillStyle="#000000",c.fill(),new CanvasTexture(l)),l=new PointsMaterial({size:.03,map:c,transparent:!1,alphaTest:.5}),c=new Points(r,l);const d=[];a.forEach(e=>d.push(e.x,e.y,e.z));createLine2(d);for(var l=new LineBasicMaterial({color:0,linewidth:1}),r=new Line(r,l),h=(r.layers.set(i),c.layers.set(i),s.add(r),s.add(c),new Vector3),o=0;o<e.length;o++){var u=new Line3(e[o].start,e[o].end),A=Math.round(100*u.distance()),p=(Math.round(100*u.distance()/2.54),document.createElement("div")),A=(p.className="label",p.textContent=A+" cm",p.style.marginTop="-1em",new CSS2DObject(p));A.name="dimLabel",A.visible=!1,A.position.copy(u.getCenter(h)),A.layers.set(i),s.add(A)}return s.position.add(n),s}function createLine2(e){var t=[],r=new Color,r=(r.setHSL(.25,1,.5,SRGBColorSpace),t.push(r.r,r.g,r.b),new Float32Array(e)),e=new LineGeometry,r=(e.setPositions(r),e.setColors(t),new LineMaterial({color:16777215,worldUnits:!1,linewidth:1,vertexColors:!0,dashed:!1,alphaToCoverage:!0})),t=new Line2(e,r);return t.computeLineDistances(),t.scale.set(1,1,1),t}class ServerLogger extends Logger{constructor(e,t,r){super(e,r),this._logCache=[],this.log=function(e){this.server.connected?this.server.request({method:"post",endpoint:"log",data:e}):this._logCache.push(e)},this.server=t,this.reporter=r,this.server.on("connection-changed",function(){this._uploadCache()})}async _uploadCache(){!0===this.server.connected&&0<this._logCache.length&&!0===(await this.server.request({method:"post",endpoint:"log",data:this._logCache})).data&&this.reporter.report({msg:"cleared cache"})}}class CacheLogger extends Logger{constructor(e,r,t){super(e,r),this.cache=[],this.cacheSize=t,this._reporter=r,this.report=({msg:e,level:t="debug"})=>r.report({msg:e,level:t,source:"CacheLogger"}),this.report({msg:"Initiated"})}log(e){this.cache=[e,...this.cache.slice(0,this.cacheSize-1)]}}class PositionedBlock extends PositionedComponent{constructor(e,t){super(e,t),checkPropTypes(t,{component:Block},{})}}PositionedBlock._exportName={singular:"positionedBlock",plural:"positionedBlocks"},PositionedBlock._exportLevel="inline";class ConnectorInstance extends InformationSource{constructor(e,t,r){super(e),this.blockInstance=t,this.connector=r}toJSON(){return{UUID:this.UUID,connector:this.connector.UUID,blockInstance:this.blockInstance.UUID}}}class ConfigurationSettings extends Component{constructor(e,t){super(e,t)}get blockInsert(){return this._blockInsert}set blockInsert(e){this.report({msg:"set blockInsert="+e}),this._blockInsert=e,this._dispatchChangeEvent()}get blockExtend(){return this._blockExtend}set blockExtend(e){this.report({msg:"set blockExtend="+e}),this._blockExtend=e,this._dispatchChangeEvent()}get blockReplace(){return this._blockReplace}set blockReplace(e){this.report({msg:"set blockReplace="+e}),this._blockReplace=e,this._dispatchChangeEvent()}}ConfigurationSettings._exportName={singular:"configurationSetting",plural:"configurationSettings"};class NavigationSettings extends Component{constructor(e,t){super(e,t),this._library=t?.library||[]}_dispatchChangeEvent(){this.emit("change",this)}get library(){return this._library}addItem(e,t){this.report({msg:`add ${e} item `+t.label}),this["_"+e].push(t),this._dispatchChangeEvent()}removeItem(e,t){this.report({msg:`remove ${e} item `+t}),this["_"+e]=this["_"+e].filter(e=>e.label!==t),this._dispatchChangeEvent()}}class Preset extends Configuration{constructor(e,t){super(e,t)}}Preset._exportName={singular:"preset",plural:"presets"};const fxaaShader$1=new ShaderPass(FXAAShader),gammaCorrectionShader$1=new ShaderPass(GammaCorrectionShader);class MoooiView extends View{constructor(e,t){super(e,{...t,rendererSettings:{antialias:!1,alpha:!0,preserveDrawingBuffer:!0,precision:"highp",premultipliedAlpha:!0,stencil:!1,logarithmicDepthBuffer:!1,toneMapping:CineonToneMapping,toneMappingExposure:1,toneMappingWhitePoint:1,gammaFactor:2.2,outputEncoding:CineonToneMapping,physicallyCorrectLights:!0,minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,stencilBuffer:!1,type:FloatType,"shadowMap.enabled":!0},cameraSettings:{fov:30,aspect:window.innerWidth/window.innerHeight,near:.5,far:100,maxPolarAngle:90},passes:[fxaaShader$1,gammaCorrectionShader$1]}),this.dragState={_active:!1,get active(){return this._active},set active(e){console.log(`Setting dragState.active [${this._active}] => [${e}]`),this._active=e},_enter:!1,get enter(){return this._enter},set enter(e){console.log(`Setting dragState.enter [${this._enter}] => [${e}]`),this._enter=e},_leave:!1,get leave(){return this._leave},set leave(e){console.log(`Setting dragState.leave [${this._leave}] => [${e}]`),this._leave=e},_over:!1,get over(){return this._over},set over(e){console.log(`Setting dragState.over [${this._over}] => [${e}]`),this._over=e}},this.expectedComponentDrag=null,this.matOptions=[],checkPropTypes(t,{scene:Scene,renderer:WebGLRenderer,timer:Timer},{rendererSettings:Object,cameraSettings:Object,passes:t=>{if(!Array.isArray(t))return"Not an array";for(let e=0;e<t.length;e+=1){var r=t[e];if(!r instanceof Pass)return`Entry ${e} is not a Pass but a `+r.constructor.name}return!0}}),this.dragObject=null,this.dragging=!1,this.allMeshes=[],this.layerMap=Project.layerMap,this.onMouseDownActive=!1,this.shift=new Vector3,this.intersects=new Vector3,this.exrBackground=null,this.pixelRatio=this.renderer.getPixelRatio(),this.on("dimensionsupdate",e=>{fxaaShader$1.uniforms.resolution.value.x=1/(e.width*this.pixelRatio),fxaaShader$1.uniforms.resolution.value.y=1/(e.height*this.pixelRatio)}),fxaaShader$1.name="FXAA Pass",gammaCorrectionShader$1.name="Gamma Correction Pass",this.renderer.setClearColor(16777215,1),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=PCFSoftShadowMap,this.renderer.shadowMap.needsUpdate=!0,this.renderer.antialias=!1,this.renderer.gammaFactor=1.8,this.renderer.physicallyCorrectLights=!0,this.renderer.toneMapping=4,this.renderer.toneMappingExposure=.5,this.renderer.logarithmicDepthBuffer=!0,this.perspectiveCamera.position.set(-2,1,5),this.directionalLight=new DirectionalLight(16777215,3),this.directionalLight.position.set(-40,65,50),this.directionalLight.shadow.mapSize.width=1024,this.directionalLight.shadow.mapSize.height=1024,this.directionalLight.shadow.camera.near=.5,this.directionalLight.shadow.camera.far=500,this.directionalLight.shadow.bias=1e-4;this.directionalLight2=this.directionalLight.clone(),this.directionalLight.castShadow=!0,this.directionalLight2.castShadow=!1,this.directionalLight.intensity=2.2,this.directionalLight2.intensity=4-2.2,this.directionalLight2.shadow.bias=1e-4,this.directionalLightLeft=this.directionalLight.clone(),this.directionalLightLeft.position.set(50,50,50),this.directionalLightLeft.castShadow=!0,this.directionalLightLeft.intensity=1.8,this.directionalLightLeft.shadow.bias=1e-4,this.directionalLightBack=this.directionalLight.clone(),this.directionalLightBack.position.set(0,50,-50),this.directionalLightBack.castShadow=!1,this.directionalLightBack.intensity=1.5,this.directionalLightBack.shadow.bias=1e-4,this.scene.add(this.directionalLight),this.scene.add(this.directionalLight2),this.scene.add(this.directionalLightBack),this.scene.add(this.directionalLightLeft),this.mouse=new Vector2,this.intersectionPlane=new Plane,this.intersectionPlane.setFromCoplanarPoints(new Vector3,new Vector3(1,0,0),new Vector3(0,0,1)),this.intersectionPlaneNormal=new Vector3(0,1,0),this.pointOfIntersection=new Vector3,this.dragPlane=new Plane,this.dragPlane.setFromCoplanarPoints(new Vector3,new Vector3(1,0,0),new Vector3(0,0,1)),this.dragPlaneNormal=new Vector3(0,1,0),this.shift=new Vector3,this.dragging=!1,this.dragObject=null,this.pointOfIntersection=new Vector3,this.onPointerDownActive=!1}onTouchStart(e){var t;this.dragState.active||(this.onPointerDownActive=!1,this.onTouchStartActive=!0,this.lastPointerMove={x:e.touches[0].clientX,y:e.touches[0].clientY,timestamp:(new Date).getTime()},t=this.findFirstIntersectedBlockInstance()||{},console.log(t),t.event=e,this.emit("pointerdown",t),e=this.intersect(this.lastPointerMove.x,this.lastPointerMove.y),console.log(e),t.blockInstance instanceof BlockInstance?(this.selectionActive=!0,this.cameraControls.enabled=!1,t=this.findConfigurator(t.blockInstance.tree),this.dragObject=t,this.dragPlane.setFromNormalAndCoplanarPoint(this.dragPlaneNormal,e[0].point),this.shift.subVectors(this.dragObject.body.position,e[0].point)):(this.dragObject=null,this.hideBoundingBoxes(),this.selectionActive=!1,this.cameraControls.enabled=!0),this.update())}onTouchStart(e){this.onPointerDownActive=!1,this.onTouchStartActive=!0,this.lastPointerMove={x:e.touches[0].clientX,y:e.touches[0].clientY,timestamp:(new Date).getTime()};var t=this.findFirstIntersectedBlockInstance()||{};t.event=e,this.emit("pointerdown",t),this.intersect(this.lastPointerDown.x,this.lastPointerDown.y)}onTouchMove(e){console.log("touch move"),this.dragState.active||(this.lastPointerMove.x=e.touches[0].clientX,this.lastPointerMove.y=e.touches[0].clientY,void 0===this.domElementDimensions&&this.updateDOMElementDimensions(),this.intersect(this.lastPointerMove.x,this.lastPointerMove.y),this.onTouchStartActive?this.dragObject instanceof Configurator&&(!1===this.hideShadowOnDrag&&(this.shadow._update([this.dragObject.body]),this.hideShadowOnDrag=!0),this.rayCaster.ray.intersectPlane(this.dragPlane,this.pointOfIntersection),this.dragObject.body.position.copy(this.pointOfIntersection).add(this.shift),this.dragObject.body.position.setY(0),this.update()):this.hideShadowOnDrag=!1)}onTouchEnd(e){var t;console.log("touch end"),this.dragState.active||(this.hideShadowOnDrag=!1,this.onPointerDownActive=!1,this.onTouchStartActive=!1,this.cameraControls.enabled=!0,this.lastPointerUp={x:this.lastPointerMove.x,y:this.lastPointerMove.y,timestamp:(new Date).getTime()},this.dragObject instanceof Configurator?(this.selectionActive=!0,(t=this.dragObject).position.copy(this.dragObject.body.position),t.position.setY(0)):(this.selectionActive=!1,this.dragObject=null),this.dragObject=null,console.log(this.dragObject),this.shadow._update(),this.update())}onTouchCancel(e){console.log("touch cancel"),this.onTouchCancelActive=!0}onClick(e){console.log("click"),this.dragState.active=!1,this.onPointerDownActive=!1,super.onClick()}onDoubleClick(e){console.log("double click"),this.dragState.active=!1,this.onPointerDownActive=!1,super.onDoubleClick()}onPointerDown(e){var t=this.findFirstIntersectedBlockInstance()||{};t.event=e,this.emit("pointerdown",t)}onPointerMove(e){this.dragState.active||(this.lastPointerMove.x=e.clientX,this.lastPointerMove.y=e.clientY,void 0===this.domElementDimensions&&this.updateDOMElementDimensions(),this.intersect(this.lastPointerMove.x,this.lastPointerMove.y),this.onPointerDownActive?this.dragObject instanceof Configurator&&(!1===this.hideShadowOnDrag&&(this.shadow._update([this.dragObject.body]),this.hideShadowOnDrag=!0),this.rayCaster.ray.intersectPlane(this.dragPlane,this.pointOfIntersection),this.dragObject.body.position.copy(this.pointOfIntersection).add(this.shift),this.dragObject.body.position.setY(0),this.update()):this.hideShadowOnDrag=!1)}onPointerUp(e){var t;this.dragState.active||(this.hideShadowOnDrag=!1,this.onPointerDownActive=!1,this.cameraControls.enabled=!0,this.lastPointerUp={x:this.lastPointerMove.x,y:this.lastPointerMove.y,timestamp:(new Date).getTime()},this.dragObject instanceof Configurator?(this.selectionActive=!0,(t=this.dragObject).position.copy(this.dragObject.body.position),t.position.setY(0)):(console.log("selection de-activated"),this.selectionActive=!1,this.dragObject=null),this.shadow._update(),this.update())}expectComponentDrag(e){this.dragState.active=!0,this.dragState.leave=!1,this.dragState.over=!1,console.assert(e instanceof Component,"expectComponentDrag -> entered component needs to be an instance of the class Component!"),this.expectedComponentDrag&&(console.warn("Another component drag is still being expected... cancelling that one"),this.expectedComponentDrag.reject("A newer component expectation has made this one obsolete"));let r,i=null;var t=new Promise((e,t)=>{r=e,i=t});t.catch(e=>{console.error("Error in expected component drag chain:",e)}).finally(()=>{console.log("Drag promise fulfilled"),this.expectedComponentDrag=null}),this.expectedComponentDrag={component:e,promise:t,resolve:r,reject:i},console.log(this.expectedComponentDrag);const n=this;return this.expectedComponentDrag&&(this.expectedComponentDrag.timeout=setTimeout(function(){console.log("Reject expected drag after timeout"),n.expectedComponentDrag.reject("Timeout")},2e3)),t}checkDrag(e){}async onDragEnter(e){if(e.preventDefault(),this.hideDimensions(),this.dragState.active)if(this.dragState.leave)console.log("drag re-enter"),this.lastPointerMove.x=e.clientX,this.lastPointerMove.y=e.clientY,this.dragState.leave=!1,this.dragState.over=!1;else{this.dragState.enter=!0,this.dragState.leave=!1,this.dragState.over=!1,console.log("drag enter"),this.onPointerDownActive,this.cameraControls.enabled=!1,this.lastPointerMove.x=e.clientX,this.lastPointerMove.y=e.clientY;var t=this.expectedComponentDrag.component;if(t)switch(t.build(),clearTimeout(this.expectedComponentDrag.timeout),t.constructor){case WrappedMaterial:console.log("drag enter wrapped material"),this.dragObject=t;break;case Block:console.log("drag enter block");var r=new Configuration(new Reporter,{pkg:t.tree,blockInstances:[new BlockInstance(new Reporter,{block:t})]}),r=(await r.build(),await this.addConfigurator({pkg:t.tree,configuration:r})),r=(this.dragObject=r,this.expectedComponentDrag.createdConfigurator=r,this.expectedComponentDrag.promise.catch(e=>{throw new Error(e)}),this.intersect(this.lastPointerMove.x,this.lastPointerMove.y));this.dragPlane.setFromNormalAndCoplanarPoint(this.dragPlaneNormal,r[0].point),this.shift.subVectors(this.dragObject.body.position,r[0].point),this.rayCaster.ray.intersectPlane(this.dragPlane,this.pointOfIntersection),console.log(this.pointOfIntersection),this.dragObject.body.position.copy(this.pointOfIntersection),this.dragObject.body.position.setY(0),console.log(this.dragObject.body),this.scene.add(this.dragObject.body),this.shadow._update([this.dragObject.body]),this.update();break;default:this.expectedComponentDrag.reject("Unknown onDragEnter expected component constructor "+this.expectedComponentDrag.component.constructor.name)}}else console.warn("DragEnter event received, but dragState = ",this.dragState)}async onDragOver(e){this.dragState.active&&(console.log("drag over"),e.preventDefault(),this.lastPointerMove.x=e.clientX,this.lastPointerMove.y=e.clientY,!1===this.dragState.over&&(this.dragState.enter&&(console.log("disable shadow"),console.log(this.dragObject.body),this.shadow._update([this.dragObject.body])),this.update(),this.dragState.over=!0),this.intersect(this.lastPointerMove.x,this.lastPointerMove.y),this.rayCaster.ray.intersectPlane(this.dragPlane,this.pointOfIntersection),this.dragObject instanceof Configurator&&(this.dragObject.body.position.copy(this.pointOfIntersection),this.dragObject.body.position.setY(0)),this.update())}async onDrop(t){if(this.dragState.active){console.log("drop"),t.preventDefault();t.dataTransfer.getData("text");if(this.onPointerDownActive=!1,this.cameraControls.enabled=!0,this.dragObject)switch(this.dragObject.constructor){case WrappedMaterial:console.log("drop wrapped material");var r=this.findFirstIntersectedBlockInstance()||{},i=(r.event=t,this.findConfigurator(r.blockInstance.tree));this.matOptions=i.configuration.options.material(this.dragObject),console.log(this.matOptions);const n=r.intersection?.object?.userData?.PB?.assignable;let e=null;n&&(e=this.matOptions.find(e=>e.assignable===n))?this.domElement.style.cursor="cell":this.domElement.style.cursor="no-drop";r=i.configuration.assignMaterial(e);await i.update(r),this.expectedComponentDrag.resolve(r);break;case Configurator:console.log("drop configurator"),this.intersect(this.lastPointerMove.x,this.lastPointerMove.y),this.rayCaster.ray.intersectPlane(this.dragPlane,this.pointOfIntersection),this.dragObject.body.position.copy(this.pointOfIntersection),this.dragObject.position.copy(this.dragObject.body.position),this.dragObject.position.setY(0),this.expectedComponentDrag.resolve(this.expectedComponentDrag.createdConfigurator.configuration);break;default:this.expectedComponentDrag.reject("Unknown onDrop expected component constructor "+this.expectedComponentDrag.component.constructor.name)}this.shadow._update(),this.update(),this.dragState.active=!1,this.dragState.enter=!1,this.dragState.leave=!1,this.dragState.over=!1,this.selectionActive=!0}}onDragLeave(e){this.dragState.active&&(e.preventDefault(),console.log("drag leave"),this.dragState.enter&&(this.dragState.enter=!1,this.dragState.leave=!0,this.dragState.over=!1),this.update())}onDragEnd(){this.dragState.active&&(console.log("drag end"),this.cameraControls.enabled=!0,this.dragObject?this.selectionActive=!0:(this.selectionActive=!1,this.dragObject=null),this.dragState.leave&&this.expectedComponentDrag.reject("The drag event has left the window with a drop event"),this.dragState.active=!1,this.dragState.enter=!1,this.dragState.over=!1,this.dragState.leave=!1,this.shadow._update(),this.update())}onComponentDragLeave(e){Object.keys(listenerObject).length}onKeyUp(e){var t=e.which||e.keyCode;e.shiftKey&&67===t&&(console.log("rotate selection"),this.dragObject)&&(console.log("rotate selection 2"),this.rotateSelection(this.dragObject)),67===t&&(console.log("connectors"),this.toggleConnectorHelpers())}rotateSelection(e){e instanceof Configurator?(e.move(e.body.position,e.quaternion.multiply((new Quaternion).setFromEuler(new Euler(0,Math.PI/2,0)))),this.shadow._update(),this.update()):e instanceof Block&&((e=this.findConfigurator(e.tree)).move(e.body.position,e.quaternion.multiply((new Quaternion).setFromEuler(new Euler(0,Math.PI/2,0)))),this.shadow._update(),this.update())}update(){super.update()}onSceneUpdate(...e){this.dragState.active||this.shadow._update(),super.onSceneUpdate(...e)}toggleConnectorHelpers(){console.log("connector helpers"),console.log(this),this.scene.traverse(function(e){if("Actor"===e.name){console.log(e.userData.origin.configuration.connectors);for(var t of e.userData.origin.configuration.connectors){var t=t.connector._settings.position,r=(console.log(t),new BoxGeometry(.1,.1,.1)),i=new MeshBasicMaterial,r=new Mesh(r,i);r.position.copy(t),scene.add(r)}}})}}class Transform extends InformationSource{constructor(e,t={}){super(e,t),this.targets=[],this.timer=t.timer,this.scene=t.scene,this.realtime=t.realtime}addByReference(e,t){return this.addById(e.id,t.id)}addById(e,t){if(console.log("add",e),this.has(e,t))throw new Error("Target already being transformed");var r=Transform.findTargetInScene(this.scene,e,t),i=r.userData.PB.blockInstance,n=(r.userData.PB.blockInstance="",r.clone()),i=(r.userData.PB.blockInstance=i,n.userData.PB.blockInstance=i,{blockInstanceId:e,subComponentId:t,object3DToTransform:r,startTime:(new Date).getTime(),originalPosition:r.position.clone(),originalQuaternion:r.quaternion.clone(),originalObject3DClone:n});this.targets.push(i),"function"==typeof this.onTransformStart&&this.onTransformStart(i),!0===this.realtime?(this.timer.addUpdateRequest(this.id,this.label+" update method"),1===this.targets.length&&this.timer.on("update",this._onTimerUpdate.bind(this),this.id)):this.timer.trigger()}relinkObject3Ds(){for(var e of this.targets){var t=Transform.findTargetInScene(this.scene,e.blockInstanceId,e.subComponentId);null===t?(console.warn(`Removing ${this.label}, target object not in scene`),this.removeById(e.blockInstanceId,e.subComponentId,!1)):(e.object3DToTransform=t,this.onRelink(e))}}onRelink(e){}static findTargetInScene(e,t,r){e=e.getObjectByName(t);return e?void 0===r?e:e.getObjectByName(r)||null:null}_onTimerUpdate(e){for(var t of this.targets)this.onTransformUpdate(t,e)}has(t,r){return!!this.targets.find(e=>e.blockInstanceId===t&&e.subComponentId===r)}removeById(t,r,e=!0){var i=this.targets.findIndex(e=>e.blockInstanceId===t&&e.subComponentId===r);if(-1===i)throw new Error("Unknown target "+t);if(!0===e){const n=this.targets[i];n.object3DToTransform.parent.children.findIndex(e=>e===n.object3DToTransform);e=n.object3DToTransform.parent;e.remove(n.object3DToTransform),e.add(n.originalObject3DClone)}this.targets.splice(i,1),console.log(this.targets),this.timer.hasListener("update",this.id)?0===this.targets.length&&this.timer.removeListener("update",this.id):this.timer.trigger()}removeAllListeners(e){var t,r;for([t,r]of this.targets.map(e=>[e.blockInstanceId,e.subComponentId]))console.log(this.targets.length,t,r),this.removeById(t,r,e),console.log(this.targets.length);console.log(this.targets)}}class DefaultSelectionTransform extends Transform{constructor(e,t){super(e,{realtime:!0,...t})}onTransformStart(e){}onTransformUpdate({object3DToTransform:e,startTime:t,originalPosition:r},i){e.position.y=r.y-.1*Math.pow(Math.cos(Math.pow(Math.sin((i-t)/500),3)),10)}}class USDZExporter{async parse(e){var t=buildHeader();const n=[],a=[],o={},s={};var l=0,r=(e.traverse(function(e){var t,r,i;e.isMesh&&(console.log(e),t=l,r=e.matrix,console.log(r),r=e.matrixWorld,console.log(r),console.log(r.elements[12]),console.log(r.elements[13]),console.log(r.elements[14]),i=e.geometry.clone(),e=e.material,i.rotateX(-Math.PI/2),i.toNonIndexed(),null!==(o[e.uuid]=e).map&&(s[e.map.uuid]=e.map,s[e.map.uuid].name="diffuse"),null!==e.normalMap&&(s[e.normalMap.uuid]=e.normalMap,s[e.normalMap.uuid].name="normal"),null!==e.aoMap&&(s[e.aoMap.uuid]=e.aoMap,s[e.aoMap.uuid].name="ao"),null!==e.roughnessMap&&(s[e.roughnessMap.uuid]=e.roughnessMap,s[e.roughnessMap.uuid].name="roughness"),null!==e.metalnessMap&&(s[e.metalnessMap.uuid]=e.metalnessMap,s[e.metalnessMap.uuid].name="metalness"),null!==e.emissiveMap&&(s[e.emissiveMap.uuid]=e.emissiveMap,s[e.emissiveMap.uuid].name="emissive"),a.push(buildMesh(t,i,e)),n.push(buildInstancedMesh(t,r,e))),l++}),{"model.usda":strToU8((t+=buildInstancedMeshes(n))+buildMeshes(a)+buildMaterials(o)+buildTextures(s))});for(const u in s){var i=s[u];r["textures/Texture_"+i.id+".jpg"]=await imgToU8(i.image)}let c=0;for(const A in r){var d=r[A],h=34+A.length,h=63&(c+=h);4!=h&&(h=new Uint8Array(64-h),r[A]=[d,{extra:{12345:h}}]),c=d.length}return zipSync(r,{level:0})}}async function imgToU8(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var t=1024/Math.max(e.width,e.height);const r=document.createElement("canvas");r.width=e.width*Math.min(1,t),r.height=e.height*Math.min(1,t);r.getContext("2d").drawImage(e,0,0,r.width,r.height);t=await new Promise(e=>r.toBlob(e,"image/jpeg",1));return new Uint8Array(await t.arrayBuffer())}}function buildHeader(){return`#usda 1.0
    (
        customLayerData = {
            string copyright = "Copyright (c) 2021 Three.js & Product Builder v.o.f. All rights reserved."
            string creator = "Three.js USDZExporter / Product Builder GTLF2USD"
        }
        metersPerUnit = 1
        upAxis = "Y"
    )

    `}function buildInstancedMeshes(e){return`def "InstancedMeshes"
        {
			${e.join("")}
        } 
		`}function buildInstancedMesh(e,t,r){var i="InstancedMesh_"+e,e="Geometry_"+e,n=new Euler,n=(n.setFromRotationMatrix(t),console.log(n),MathUtils.radToDeg(n.x),MathUtils.radToDeg(n.y),MathUtils.radToDeg(n.z));t.elements;return`def Xform "${i}"
        {

			float3 xformOp:rotateXYZ = (0, ${n}, 0  )
			float3 xformOp:scale = (1, 1, 1)
			double3 xformOp:translate = (${t.elements[12]}, ${t.elements[13]}, ${t.elements[14]})
			uniform token[] xformOpOrder = [ "xformOp:translate", "xformOp:rotateXYZ", "xformOp:scale" ]

			def "${e}" ( 
				instanceable = true 
				references = </Assets/Meshes/${e}>
			)
			{
				rel material:binding = </Materials/Material_${r.id}>
			}
        } 
		`}function buildMeshes(e){return`over "Assets"
    { 
        def Scope "Meshes"
        {
            ${e.join("")}
        }   
    }

    `}function buildMesh(e,t,r){var e="Geometry_"+e,i=t.attributes,n=i.position.count,a=t.toNonIndexed().attributes.position.count;return"uv2"in i&&console.warn("THREE.USDZExporter: uv2 not supported yet."),`def Mesh "${e}"
    {
        int[] faceVertexCounts = [${buildMeshVertexCount(t)}]
        int[] faceVertexIndices = [${buildMeshVertexIndices(t)}]
        rel material:binding = </Materials/Material_${r.id}>
        normal3f[] normals = [${buildVector3Array(i.normal,n)}] 
        point3f[] points = [${buildVector3Array(i.position,n)}]
        float2[] primvars:Texture_uv = [${buildVector2Array(t,a)}] (
            interpolation = "faceVarying"
        )
        uniform token subdivisionScheme = "none"
    }
    `}function buildMeshVertexCount(e){e=null!==e.index?e.index.array.length:e.attributes.position.count;return Array(e/3).fill(3).join(", ")}function buildMeshVertexIndices(e){if(null!==e.index)return e.index.array.join(", ");var t=[],r=e.attributes.position.count;for(let e=0;e<r;e++)t.push(e);return t.join(", ")}function buildVector3Array(e,t){if(void 0===e)return console.warn("USDZExporter: Normals missing."),Array(t).fill("(0, 0, 0)").join(", ");var r=[],i=e.array;for(let e=0;e<i.length;e+=3)r.push(`(${i[e+0]}, ${i[e+1]}, ${i[e+2]})`);return r.join(", ")}function buildVector2Array(e,t){e=e.toNonIndexed().attributes.uv;if(void 0===e)return console.warn("USDZExporter: UVs missing."),Array(t).fill("(0, 0)").join(", ");var r=[],i=e.array;for(let e=0;e<i.length;e+=2)r.push(`(${i[e+0]}, ${1-i[e+1]})`);return r.join(", ")}function buildMaterials(e){var t=[];for(const i in e){var r=e[i];t.push(buildMaterial(r))}return`def "Materials"
{
${t.join("")}
}

`}function buildMaterial(e){var t="            ",r=[];return null!==e.map?r.push(t+`color3f inputs:diffuseColor.connect = </Textures/Texture_${e.map.id}.outputs:rgb>`):r.push(t+"color3f inputs:diffuseColor = "+buildColor(e.color)),null!==e.emissiveMap?r.push(t+`color3f inputs:emissiveColor.connect = </Textures/Texture_${e.emissiveMap.id}.outputs:rgb>`):0<e.emissive&&(console.log(e.emissive),r.push(t+"color3f inputs:emissiveColor = "+buildColor(e.emissive))),null!==e.normalMap&&r.push(t+`normal3f inputs:normal.connect = </Textures/Texture_${e.normalMap.id}.outputs:rgb>`),null!==e.aoMap&&r.push(t+`float inputs:occlusion.connect = </Textures/Texture_${e.aoMap.id}.outputs:r>`),null!==e.roughnessMap?r.push(t+`float inputs:roughness.connect = </Textures/Texture_${e.roughnessMap.id}.outputs:g>`):r.push(t+"float inputs:roughness = "+e.roughness),null!==e.metalnessMap?r.push(t+`float inputs:metallic.connect = </Textures/Texture_${e.metalnessMap.id}.outputs:b>`):r.push(t+"float inputs:metallic = "+e.metalness),`
    def Material "Material_${e.id}"
    {
        token outputs:surface.connect = </Materials/Material_${e.id}/PreviewSurface.outputs:surface>

        def Shader "PreviewSurface"
        {
            uniform token info:id = "UsdPreviewSurface"
${r.join("\n")}
            int inputs:useSpecularWorkflow = 0
            token outputs:surface
        }
    }
`}function buildTextures(e){var t=[];for(const i in e){var r=e[i];t.push(buildUvPrimvar(r)),t.push(buildTextureTransform(r)),t.push(buildTexture(r))}return`def "Textures"
{
${t.join("")}
}

`}function buildTexture(e){return`
    def Shader "Texture_${e.id}"
    {
		uniform token info:id = "UsdUVTexture"
        asset inputs:file = @textures/Texture_${e.id}.jpg@
        float2 inputs:st.connect = </Textures/UsdTransform2d_${e.id}.outputs:result>
        token inputs:wrapS = "repeat"
        token inputs:wrapT = "repeat"
        float3 outputs:rgb
    }
`}function buildTextureTransform(e){return console.log(e),`
    def Shader "UsdTransform2d_${e.id}"
    {
        uniform token info:id = "UsdTransform2d"
		float2 inputs:in.connect = </Textures/UvPrimvarFloat2Shader_${e.id}.outputs:result>
		float inputs:rotation = 0.0
		float2 inputs:scale = (${e.repeat.x}, ${e.repeat.y})
		float2 inputs:translation = (0.0, 0.0)
		float2 outputs:result
    }
`}function buildUvPrimvar(e){return`
	def Shader "UvPrimvarFloat2Shader_${e.id}"
	{
		uniform token info:id = "UsdPrimvarReader_float2"
		token inputs:varname = "Texture_uv"
		float2 outputs:result
	}
`}function buildColor(e){return`(${e.r}, ${e.g}, ${e.b})`}class UsdzExporter{constructor(e,t){this.revision=1,this.exporter=new USDZExporter,checkPropTypes(t,{},{})}async export(s){return new Promise(async(e,t)=>{console.log(s);var r,i=new Group,n=[];for(r in s.traverse(function(e){e.isMesh&&"Vertex Helper"!==e.name&&"ContactShadow Plane"!==e.name&&"ContactShadow Blur Plane"!==e.name&&n.push(e)}),n){var a=n[r].clone();i.add(a)}var o=await this.exporter.parse(i);e(new Blob([o],{type:"application/octet-stream"}))})}}let _renderer,fullscreenQuadGeometry,fullscreenQuadMaterial,fullscreenQuad;function decompress(e,t=1/0,r=null){fullscreenQuadGeometry=fullscreenQuadGeometry||new PlaneGeometry$1(2,2,1,1),(fullscreenQuadMaterial=fullscreenQuadMaterial||new ShaderMaterial$1({uniforms:{blitTexture:new Uniform$1(e)},vertexShader:`
            varying vec2 vUv;
            void main(){
                vUv = uv;
                gl_Position = vec4(position.xy * 1.0,0.,.999999);
            }`,fragmentShader:`
            uniform sampler2D blitTexture; 
            varying vec2 vUv;

            void main(){ 
                gl_FragColor = vec4(vUv.xy, 0, 1);
                
                #ifdef IS_SRGB
                gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
                #else
                gl_FragColor = texture2D( blitTexture, vUv);
                #endif
            }`})).uniforms.blitTexture.value=e,fullscreenQuadMaterial.defines.IS_SRGB=e.colorSpace==SRGBColorSpace$1,fullscreenQuadMaterial.needsUpdate=!0,fullscreenQuad||((fullscreenQuad=new Mesh$1(fullscreenQuadGeometry,fullscreenQuadMaterial)).frustrumCulled=!1);var i=new PerspectiveCamera$1,n=new Scene$1,t=(n.add(fullscreenQuad),(r=r||(_renderer=new WebGLRenderer$1({antialias:!1}))).setSize(Math.min(e.image.width,t),Math.min(e.image.height,t)),r.clear(),r.render(n,i),new Texture$1(r.domElement));return t.minFilter=e.minFilter,t.magFilter=e.magFilter,t.wrapS=e.wrapS,t.wrapT=e.wrapT,t.name=e.name,_renderer&&(_renderer.dispose(),_renderer=null),t}const KHR_mesh_quantization_ExtraAttrTypes={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class GLTFExporter{constructor(){this.pluginCallbacks=[],this.register(function(e){return new GLTFLightExtension(e)}),this.register(function(e){return new GLTFMaterialsUnlitExtension$1(e)}),this.register(function(e){return new GLTFMaterialsTransmissionExtension$1(e)}),this.register(function(e){return new GLTFMaterialsVolumeExtension$1(e)}),this.register(function(e){return new GLTFMaterialsIorExtension$1(e)}),this.register(function(e){return new GLTFMaterialsSpecularExtension$1(e)}),this.register(function(e){return new GLTFMaterialsClearcoatExtension$1(e)}),this.register(function(e){return new GLTFMaterialsIridescenceExtension$1(e)}),this.register(function(e){return new GLTFMaterialsSheenExtension$1(e)}),this.register(function(e){return new GLTFMaterialsAnisotropyExtension$1(e)}),this.register(function(e){return new GLTFMaterialsEmissiveStrengthExtension$1(e)})}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,i){var n=new GLTFWriter,a=[];for(let e=0,t=this.pluginCallbacks.length;e<t;e++)a.push(this.pluginCallbacks[e](n));n.setPlugins(a),n.write(e,t,i).catch(r)}parseAsync(r,i){const n=this;return new Promise(function(e,t){n.parse(r,e,t,i)})}}const WEBGL_CONSTANTS$1={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},KHR_MESH_QUANTIZATION="KHR_mesh_quantization",THREE_TO_WEBGL={},PATH_PROPERTIES$1=(THREE_TO_WEBGL[NearestFilter$1]=WEBGL_CONSTANTS$1.NEAREST,THREE_TO_WEBGL[NearestMipmapNearestFilter$1]=WEBGL_CONSTANTS$1.NEAREST_MIPMAP_NEAREST,THREE_TO_WEBGL[NearestMipmapLinearFilter$1]=WEBGL_CONSTANTS$1.NEAREST_MIPMAP_LINEAR,THREE_TO_WEBGL[LinearFilter$1]=WEBGL_CONSTANTS$1.LINEAR,THREE_TO_WEBGL[LinearMipmapNearestFilter$1]=WEBGL_CONSTANTS$1.LINEAR_MIPMAP_NEAREST,THREE_TO_WEBGL[LinearMipmapLinearFilter$1]=WEBGL_CONSTANTS$1.LINEAR_MIPMAP_LINEAR,THREE_TO_WEBGL[ClampToEdgeWrapping$1]=WEBGL_CONSTANTS$1.CLAMP_TO_EDGE,THREE_TO_WEBGL[RepeatWrapping$1]=WEBGL_CONSTANTS$1.REPEAT,THREE_TO_WEBGL[MirroredRepeatWrapping$1]=WEBGL_CONSTANTS$1.MIRRORED_REPEAT,{scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"}),DEFAULT_SPECULAR_COLOR=new Color$1,GLB_HEADER_BYTES=12,GLB_HEADER_MAGIC=1179937895,GLB_VERSION=2,GLB_CHUNK_PREFIX_BYTES=8,GLB_CHUNK_TYPE_JSON=1313821514,GLB_CHUNK_TYPE_BIN=5130562;function equalArray(e,r){return e.length===r.length&&e.every(function(e,t){return e===r[t]})}function stringToArrayBuffer(e){return(new TextEncoder).encode(e).buffer}function isIdentityMatrix(e){return equalArray(e.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function getMinMax(i,e,t){var n={min:new Array(i.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(i.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let r=e;r<e+t;r++)for(let t=0;t<i.itemSize;t++){let e;4<i.itemSize?e=i.array[r*i.itemSize+t]:(0===t?e=i.getX(r):1===t?e=i.getY(r):2===t?e=i.getZ(r):3===t&&(e=i.getW(r)),!0===i.normalized&&(e=MathUtils$1.normalize(e,i.array))),n.min[t]=Math.min(n.min[t],e),n.max[t]=Math.max(n.max[t],e)}return n}function getPaddedBufferSize(e){return 4*Math.ceil(e/4)}function getPaddedArrayBuffer(t,r=0){var i=getPaddedBufferSize(t.byteLength);if(i===t.byteLength)return t;var n=new Uint8Array(i);if(n.set(new Uint8Array(t)),0!==r)for(let e=t.byteLength;e<i;e++)n[e]=r;return n.buffer}function getCanvas(){return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function getToBlobPromise(t,r){if(void 0!==t.toBlob)return new Promise(e=>t.toBlob(e,r));let e;return"image/jpeg"===r?e=.92:"image/webp"===r&&(e=.8),t.convertToBlob({type:r,quality:e})}class GLTFWriter{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,l,t={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},t),0<this.options.animations.length&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);e=this.buffers;const c=this.json;t=this.options;var r=this.extensionsUsed,i=this.extensionsRequired,e=new Blob(e,{type:"application/octet-stream"}),r=Object.keys(r),i=Object.keys(i);if(0<r.length&&(c.extensionsUsed=r),0<i.length&&(c.extensionsRequired=i),c.buffers&&0<c.buffers.length&&(c.buffers[0].byteLength=e.size),!0===t.binary){const d=new FileReader;d.readAsArrayBuffer(e),d.onloadend=function(){var e=getPaddedArrayBuffer(d.result),t=new DataView(new ArrayBuffer(GLB_CHUNK_PREFIX_BYTES)),r=(t.setUint32(0,e.byteLength,!0),t.setUint32(4,GLB_CHUNK_TYPE_BIN,!0),getPaddedArrayBuffer(stringToArrayBuffer(JSON.stringify(c)),32)),i=new DataView(new ArrayBuffer(GLB_CHUNK_PREFIX_BYTES)),n=(i.setUint32(0,r.byteLength,!0),i.setUint32(4,GLB_CHUNK_TYPE_JSON,!0),new ArrayBuffer(GLB_HEADER_BYTES)),a=new DataView(n),o=(a.setUint32(0,GLB_HEADER_MAGIC,!0),a.setUint32(4,GLB_VERSION,!0),GLB_HEADER_BYTES+i.byteLength+r.byteLength+t.byteLength+e.byteLength),a=(a.setUint32(8,o,!0),new Blob([n,i,r,t,e],{type:"application/octet-stream"}));const s=new FileReader;s.readAsArrayBuffer(a),s.onloadend=function(){l(s.result)}}}else if(c.buffers&&0<c.buffers.length){const n=new FileReader;n.readAsDataURL(e),n.onloadend=function(){var e=n.result;c.buffers[0].uri=e,l(c)}}else l(c)}serializeUserData(t,e){if(0!==Object.keys(t.userData).length){var r=this.options,i=this.extensionsUsed;try{var n=JSON.parse(JSON.stringify(t.userData));if(r.includeCustomExtensions&&n.gltfExtensions){void 0===e.extensions&&(e.extensions={});for(const a in n.gltfExtensions)e.extensions[a]=n.gltfExtensions[a],i[a]=!0;delete n.gltfExtensions}0<Object.keys(n).length&&(e.extras=n)}catch(e){console.warn("THREE.GLTFExporter: userData of '"+t.name+"' won't be serialized because of JSON.stringify error - "+e.message)}}}getUID(e,t=!1){if(!1===this.uids.has(e)){const r=new Map;r.set(!0,this.uid++),r.set(!1,this.uid++),this.uids.set(e,r)}const r=this.uids.get(e);return r.get(t)}isNormalizedNormalAttribute(r){if(this.cache.attributesNormalized.has(r))return!1;var i=new Vector3$1;for(let e=0,t=r.count;e<t;e++)if(5e-4<Math.abs(i.fromBufferAttribute(r,e).length()-1))return!1;return!0}createNormalizedNormalAttribute(e){var t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);var r=e.clone(),i=new Vector3$1;for(let e=0,t=r.count;e<t;e++)i.fromBufferAttribute(r,e),0===i.x&&0===i.y&&0===i.z?i.setX(1):i.normalize(),r.setXYZ(e,i.x,i.y,i.z);return t.attributesNormalized.set(e,r),r}applyTextureTransform(e,t){let r=!1;var i={};0===t.offset.x&&0===t.offset.y||(i.offset=t.offset.toArray(),r=!0),0!==t.rotation&&(i.rotation=t.rotation,r=!0),1===t.repeat.x&&1===t.repeat.y||(i.scale=t.repeat.toArray(),r=!0),r&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function r(e){return e.colorSpace===SRGBColorSpace$1?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof CompressedTexture$1&&(e=decompress(e)),t instanceof CompressedTexture$1&&(t=decompress(t));var i=e?e.image:null,n=t?t.image:null,a=Math.max(i?i.width:0,n?n.width:0),o=Math.max(i?i.height:0,n?n.height:0),s=getCanvas(),l=(s.width=a,s.height=o,s.getContext("2d")),c=(l.fillStyle="#00ffff",l.fillRect(0,0,a,o),l.getImageData(0,0,a,o));if(i){l.drawImage(i,0,0,a,o);var d=r(e),h=l.getImageData(0,0,a,o).data;for(let e=2;e<h.length;e+=4)c.data[e]=256*d(h[e]/256)}if(n){l.drawImage(n,0,0,a,o);var u=r(t),A=l.getImageData(0,0,a,o).data;for(let e=1;e<A.length;e+=4)c.data[e]=256*u(A[e]/256)}l.putImageData(c,0,0);i=(e||t).clone();return i.source=new Source$1(s),i.colorSpace=NoColorSpace$1,i.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),i}processBuffer(e){var t=this.json,r=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),r.push(e),0}processBufferView(i,n,e,t,r){var a=this.json;a.bufferViews||(a.bufferViews=[]);let o;switch(n){case WEBGL_CONSTANTS$1.BYTE:case WEBGL_CONSTANTS$1.UNSIGNED_BYTE:o=1;break;case WEBGL_CONSTANTS$1.SHORT:case WEBGL_CONSTANTS$1.UNSIGNED_SHORT:o=2;break;default:o=4}var s=getPaddedBufferSize(t*i.itemSize*o),l=new DataView(new ArrayBuffer(s));let c=0;for(let r=e;r<e+t;r++)for(let t=0;t<i.itemSize;t++){let e;4<i.itemSize?e=i.array[r*i.itemSize+t]:(0===t?e=i.getX(r):1===t?e=i.getY(r):2===t?e=i.getZ(r):3===t&&(e=i.getW(r)),!0===i.normalized&&(e=MathUtils$1.normalize(e,i.array))),n===WEBGL_CONSTANTS$1.FLOAT?l.setFloat32(c,e,!0):n===WEBGL_CONSTANTS$1.INT?l.setInt32(c,e,!0):n===WEBGL_CONSTANTS$1.UNSIGNED_INT?l.setUint32(c,e,!0):n===WEBGL_CONSTANTS$1.SHORT?l.setInt16(c,e,!0):n===WEBGL_CONSTANTS$1.UNSIGNED_SHORT?l.setUint16(c,e,!0):n===WEBGL_CONSTANTS$1.BYTE?l.setInt8(c,e):n===WEBGL_CONSTANTS$1.UNSIGNED_BYTE&&l.setUint8(c,e),c+=o}var d={buffer:this.processBuffer(l.buffer),byteOffset:this.byteOffset,byteLength:s},r=(void 0!==r&&(d.target=r),r===WEBGL_CONSTANTS$1.ARRAY_BUFFER&&(d.byteStride=i.itemSize*o),this.byteOffset+=s,a.bufferViews.push(d),{id:a.bufferViews.length-1,byteLength:0});return r}processBufferViewImage(e){const n=this,a=n.json;return a.bufferViews||(a.bufferViews=[]),new Promise(function(r){const i=new FileReader;i.readAsArrayBuffer(e),i.onloadend=function(){var e=getPaddedArrayBuffer(i.result),t={buffer:n.processBuffer(e),byteOffset:n.byteOffset,byteLength:e.byteLength};n.byteOffset+=e.byteLength,r(a.bufferViews.push(t)-1)}})}processAccessor(e,t,r,i){var n=this.json;let a;if(e.array.constructor===Float32Array)a=WEBGL_CONSTANTS$1.FLOAT;else if(e.array.constructor===Int32Array)a=WEBGL_CONSTANTS$1.INT;else if(e.array.constructor===Uint32Array)a=WEBGL_CONSTANTS$1.UNSIGNED_INT;else if(e.array.constructor===Int16Array)a=WEBGL_CONSTANTS$1.SHORT;else if(e.array.constructor===Uint16Array)a=WEBGL_CONSTANTS$1.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)a=WEBGL_CONSTANTS$1.BYTE;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);a=WEBGL_CONSTANTS$1.UNSIGNED_BYTE}if(0===(i=void 0===i?e.count:i))return null;var o=getMinMax(e,r=void 0===r?0:r,i);let s;void 0!==t&&(s=e===t.index?WEBGL_CONSTANTS$1.ELEMENT_ARRAY_BUFFER:WEBGL_CONSTANTS$1.ARRAY_BUFFER);t=this.processBufferView(e,a,r,i,s),r={bufferView:t.id,byteOffset:t.byteOffset,componentType:a,count:i,max:o.max,min:o.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(r.normalized=!0),n.accessors||(n.accessors=[]),n.accessors.push(r)-1}processImage(t,e,r,i="image/png"){if(null===t)throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.");{const u=this;var n=u.cache,a=u.json,o=u.options,s=u.pending,n=(n.images.has(t)||n.images.set(t,{}),n.images.get(t)),l=i+":flipY/"+r.toString();if(void 0!==n[l])return n[l];a.images||(a.images=[]);const A={mimeType:i};var c=getCanvas(),d=(c.width=Math.min(t.width,o.maxTextureSize),c.height=Math.min(t.height,o.maxTextureSize),c.getContext("2d"));if(!0===r&&(d.translate(0,c.height),d.scale(1,-1)),void 0!==t.data){e!==RGBAFormat$1&&console.error("GLTFExporter: Only RGBAFormat is supported.",e),(t.width>o.maxTextureSize||t.height>o.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",t);var h=new Uint8ClampedArray(t.height*t.width*4);for(let e=0;e<h.length;e+=4)h[e+0]=t.data[e+0],h[e+1]=t.data[e+1],h[e+2]=t.data[e+2],h[e+3]=t.data[e+3];d.putImageData(new ImageData(h,t.width,t.height),0,0)}else d.drawImage(t,0,0,c.width,c.height);!0===o.binary?s.push(getToBlobPromise(c,i).then(e=>u.processBufferViewImage(e)).then(e=>{A.bufferView=e})):void 0!==c.toDataURL?A.uri=c.toDataURL(i):s.push(getToBlobPromise(c,i).then(e=>(new FileReader).readAsDataURL(e)).then(e=>{A.uri=e}));r=a.images.push(A)-1;return n[l]=r}}processSampler(e){var t=this.json,e=(t.samplers||(t.samplers=[]),{magFilter:THREE_TO_WEBGL[e.magFilter],minFilter:THREE_TO_WEBGL[e.minFilter],wrapS:THREE_TO_WEBGL[e.wrapS],wrapT:THREE_TO_WEBGL[e.wrapT]});return t.samplers.push(e)-1}processTexture(t){var e=this.options,r=this.cache,i=this.json;if(r.textures.has(t))return r.textures.get(t);i.textures||(i.textures=[]);let n=(t=t instanceof CompressedTexture$1?decompress(t,e.maxTextureSize):t).userData.mimeType;"image/webp"===n&&(n="image/png");const a={sampler:this.processSampler(t),source:this.processImage(t.image,t.format,t.flipY,n)};t.name&&(a.name=t.name),this._invokeAll(function(e){e.writeTexture&&e.writeTexture(t,a)});e=i.textures.push(a)-1;return r.textures.set(t,e),e}processMaterial(t){var e=this.cache,r=this.json;if(e.materials.has(t))return e.materials.get(t);if(t.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;r.materials||(r.materials=[]);const i={pbrMetallicRoughness:{}};!0!==t.isMeshStandardMaterial&&!0!==t.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");var n=t.color.toArray().concat([t.opacity]),a=(equalArray(n,[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=n),t.isMeshStandardMaterial?(i.pbrMetallicRoughness.metallicFactor=t.metalness,i.pbrMetallicRoughness.roughnessFactor=t.roughness):(i.pbrMetallicRoughness.metallicFactor=.5,i.pbrMetallicRoughness.roughnessFactor=.5),(t.metalnessMap||t.roughnessMap)&&(n=this.buildMetalRoughTexture(t.metalnessMap,t.roughnessMap),a={index:this.processTexture(n),channel:n.channel},this.applyTextureTransform(a,n),i.pbrMetallicRoughness.metallicRoughnessTexture=a),t.map&&(n={index:this.processTexture(t.map),texCoord:t.map.channel},this.applyTextureTransform(n,t.map),i.pbrMetallicRoughness.baseColorTexture=n),t.emissive&&(a=t.emissive,0<Math.max(a.r,a.g,a.b)&&(i.emissiveFactor=t.emissive.toArray()),t.emissiveMap)&&(n={index:this.processTexture(t.emissiveMap),texCoord:t.emissiveMap.channel},this.applyTextureTransform(n,t.emissiveMap),i.emissiveTexture=n),t.normalMap&&(a={index:this.processTexture(t.normalMap),texCoord:t.normalMap.channel},t.normalScale&&1!==t.normalScale.x&&(a.scale=t.normalScale.x),this.applyTextureTransform(a,t.normalMap),i.normalTexture=a),t.aoMap&&(n={index:this.processTexture(t.aoMap),texCoord:t.aoMap.channel},1!==t.aoMapIntensity&&(n.strength=t.aoMapIntensity),this.applyTextureTransform(n,t.aoMap),i.occlusionTexture=n),t.transparent?i.alphaMode="BLEND":0<t.alphaTest&&(i.alphaMode="MASK",i.alphaCutoff=t.alphaTest),t.side===DoubleSide$1&&(i.doubleSided=!0),""!==t.name&&(i.name=t.name),this.serializeUserData(t,i),this._invokeAll(function(e){e.writeMaterial&&e.writeMaterial(t,i)}),r.materials.push(i)-1);return e.materials.set(t,a),a}processMesh(r){var i=this.cache,e=this.json,n=[r.geometry.uuid];if(Array.isArray(r.material))for(let e=0,t=r.material.length;e<t;e++)n.push(r.material[e].uuid);else n.push(r.material.uuid);var t=n.join(":");if(i.meshes.has(t))return i.meshes.get(t);var a=r.geometry;let o;o=r.isLineSegments?WEBGL_CONSTANTS$1.LINES:r.isLineLoop?WEBGL_CONSTANTS$1.LINE_LOOP:r.isLine?WEBGL_CONSTANTS$1.LINE_STRIP:r.isPoints?WEBGL_CONSTANTS$1.POINTS:r.material.wireframe?WEBGL_CONSTANTS$1.LINES:WEBGL_CONSTANTS$1.TRIANGLES;const s={};var l,c,d,h={},u=[],A=[],p={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},m=a.getAttribute("normal");void 0===m||this.isNormalizedNormalAttribute(m)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),a.setAttribute("normal",this.createNormalizedNormalAttribute(m)));let f=null;for(l in a.attributes)"morph"!==l.slice(0,5)&&(c=a.attributes[l],l=p[l]||l.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(l)||(l="_"+l),i.attributes.has(this.getUID(c))?h[l]=i.attributes.get(this.getUID(c)):(f=null,d=c.array,"JOINTS_0"!==l||d instanceof Uint16Array||d instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),f=new BufferAttribute$1(new Uint16Array(d),c.itemSize,c.normalized)),null!==(d=this.processAccessor(f||c,a))&&(l.startsWith("_")||this.detectMeshQuantization(l,c),h[l]=d,i.attributes.set(this.getUID(c),d))));if(void 0!==m&&a.setAttribute("normal",m),0===Object.keys(h).length)return null;if(void 0!==r.morphTargetInfluences&&0<r.morphTargetInfluences.length){var g=[],v=[],_={};if(void 0!==r.morphTargetDictionary)for(const B in r.morphTargetDictionary)_[r.morphTargetDictionary[B]]=B;for(let t=0;t<r.morphTargetInfluences.length;++t){var y={};let e=!1;for(const N in a.morphAttributes)if("position"!==N&&"normal"!==N)e||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),e=!0);else{var E=a.morphAttributes[N][t],T=N.toUpperCase(),x=a.attributes[N];if(i.attributes.has(this.getUID(E,!0)))y[T]=i.attributes.get(this.getUID(E,!0));else{var b=E.clone();if(!a.morphTargetsRelative)for(let t=0,e=E.count;t<e;t++)for(let e=0;e<E.itemSize;e++)0===e&&b.setX(t,E.getX(t)-x.getX(t)),1===e&&b.setY(t,E.getY(t)-x.getY(t)),2===e&&b.setZ(t,E.getZ(t)-x.getZ(t)),3===e&&b.setW(t,E.getW(t)-x.getW(t));y[T]=this.processAccessor(b,a),i.attributes.set(this.getUID(x,!0),y[T])}}A.push(y),g.push(r.morphTargetInfluences[t]),void 0!==r.morphTargetDictionary&&v.push(_[t])}s.weights=g,0<v.length&&(s.extras={},s.extras.targetNames=v)}m=Array.isArray(r.material);if(m&&0===a.groups.length)return null;var w=m?r.material:[r.material],C=m?a.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let t=0,e=C.length;t<e;t++){var S={mode:o,attributes:h};if(this.serializeUserData(a,S),0<A.length&&(S.targets=A),null!==a.index){let e=this.getUID(a.index);void 0===C[t].start&&void 0===C[t].count||(e+=":"+C[t].start+":"+C[t].count),i.attributes.has(e)?S.indices=i.attributes.get(e):(S.indices=this.processAccessor(a.index,a,C[t].start,C[t].count),i.attributes.set(e,S.indices)),null===S.indices&&delete S.indices}var M=this.processMaterial(w[C[t].materialIndex]);null!==M&&(S.material=M),u.push(S)}s.primitives=u,e.meshes||(e.meshes=[]),this._invokeAll(function(e){e.writeMesh&&e.writeMesh(r,s)});m=e.meshes.push(s)-1;return i.meshes.set(t,m),m}detectMeshQuantization(t,r){if(!this.extensionsUsed[KHR_MESH_QUANTIZATION]){let e=void 0;switch(r.array.constructor){case Int8Array:e="byte";break;case Uint8Array:e="unsigned byte";break;case Int16Array:e="short";break;case Uint16Array:e="unsigned short";break;default:return}r.normalized&&(e+=" normalized");r=t.split("_",1)[0];KHR_mesh_quantization_ExtraAttrTypes[r]&&KHR_mesh_quantization_ExtraAttrTypes[r].includes(e)&&(this.extensionsUsed[KHR_MESH_QUANTIZATION]=!0,this.extensionsRequired[KHR_MESH_QUANTIZATION]=!0)}}processCamera(e){var t=this.json,r=(t.cameras||(t.cameras=[]),e.isOrthographicCamera),i={type:r?"orthographic":"perspective"};return r?i.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:i.perspective={aspectRatio:e.aspect,yfov:MathUtils$1.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(i.name=e.type),t.cameras.push(i)-1}processAnimation(e,n){var t=this.json,a=this.nodeMap,o=(t.animations||(t.animations=[]),(e=GLTFExporter.Utils.mergeMorphTargetTracks(e.clone(),n)).tracks),s=[],l=[];for(let i=0;i<o.length;++i){var c=o[i],d=PropertyBinding$1.parseTrackName(c.name);let e=PropertyBinding$1.findNode(n,d.nodeName);var h=PATH_PROPERTIES$1[d.propertyName];if(!(e="bones"===d.objectName?!0===e.isSkinnedMesh?e.skeleton.getBoneByName(d.objectIndex):void 0:e)||!h)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',c.name),null;let t=c.values.length/c.times.length;h===PATH_PROPERTIES$1.morphTargetInfluences&&(t/=e.morphTargetInfluences.length);let r;!0===c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(r="CUBICSPLINE",t/=3):r=c.getInterpolation()===InterpolateDiscrete$1?"STEP":"LINEAR",l.push({input:this.processAccessor(new BufferAttribute$1(c.times,1)),output:this.processAccessor(new BufferAttribute$1(c.values,t)),interpolation:r}),s.push({sampler:l.length-1,target:{node:a.get(e),path:h}})}return t.animations.push({name:e.name||"clip_"+t.animations.length,samplers:l,channels:s}),t.animations.length-1}processSkin(t){var e=this.json,r=this.nodeMap,i=e.nodes[r.get(t)],n=t.skeleton;if(void 0===n)return null;var a=t.skeleton.bones[0];if(void 0===a)return null;var o=[],s=new Float32Array(16*n.bones.length),l=new Matrix4$1;for(let e=0;e<n.bones.length;++e)o.push(r.get(n.bones[e])),l.copy(n.boneInverses[e]),l.multiply(t.bindMatrix).toArray(s,16*e);return void 0===e.skins&&(e.skins=[]),e.skins.push({inverseBindMatrices:this.processAccessor(new BufferAttribute$1(s,16)),joints:o,skeleton:r.get(a)}),i.skin=e.skins.length-1}processNode(r){var e,t,i,n=this.json,a=this.options,o=this.nodeMap;n.nodes||(n.nodes=[]);const s={};if(a.trs?(i=r.quaternion.toArray(),e=r.position.toArray(),t=r.scale.toArray(),equalArray(i,[0,0,0,1])||(s.rotation=i),equalArray(e,[0,0,0])||(s.translation=e),equalArray(t,[1,1,1])||(s.scale=t)):(r.matrixAutoUpdate&&r.updateMatrix(),!1===isIdentityMatrix(r.matrix)&&(s.matrix=r.matrix.elements)),""!==r.name&&(s.name=String(r.name)),this.serializeUserData(r,s),r.isMesh||r.isLine||r.isPoints?null!==(i=this.processMesh(r))&&(s.mesh=i):r.isCamera&&(s.camera=this.processCamera(r)),r.isSkinnedMesh&&this.skins.push(r),0<r.children.length){var l=[];for(let e=0,t=r.children.length;e<t;e++){var c=r.children[e];if(c.visible||!1===a.onlyVisible){const d=this.processNode(c);null!==d&&l.push(d)}}0<l.length&&(s.children=l)}this._invokeAll(function(e){e.writeNode&&e.writeNode(r,s)});const d=n.nodes.push(s)-1;return o.set(r,d),d}processScene(r){var e=this.json,i=this.options,t=(e.scenes||(e.scenes=[],e.scene=0),{}),n=(""!==r.name&&(t.name=r.name),e.scenes.push(t),[]);for(let e=0,t=r.children.length;e<t;e++){var a=r.children[e];!a.visible&&!1!==i.onlyVisible||null===(a=this.processNode(a))||n.push(a)}0<n.length&&(t.nodes=n),this.serializeUserData(r,t)}processObjects(t){var r=new Scene$1;r.name="AuxScene";for(let e=0;e<t.length;e++)r.children.push(t[e]);this.processScene(r)}processInput(t){var r=this.options,i=(t=t instanceof Array?t:[t],this._invokeAll(function(e){e.beforeParse&&e.beforeParse(t)}),[]);for(let e=0;e<t.length;e++)t[e]instanceof Scene$1?this.processScene(t[e]):i.push(t[e]);0<i.length&&this.processObjects(i);for(let e=0;e<this.skins.length;++e)this.processSkin(this.skins[e]);for(let e=0;e<r.animations.length;++e)this.processAnimation(r.animations[e],t[0]);this._invokeAll(function(e){e.afterParse&&e.afterParse(t)})}_invokeAll(r){for(let e=0,t=this.plugins.length;e<t;e++)r(this.plugins[e])}}class GLTFLightExtension{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){var r,i,n;e.isLight&&(e.isDirectionalLight||e.isPointLight||e.isSpotLight?(r=(n=this.writer).json,n=n.extensionsUsed,i={},e.name&&(i.name=e.name),i.color=e.color.toArray(),i.intensity=e.intensity,e.isDirectionalLight?i.type="directional":e.isPointLight?(i.type="point",0<e.distance&&(i.range=e.distance)):e.isSpotLight&&(i.type="spot",0<e.distance&&(i.range=e.distance),i.spot={},i.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,i.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),n[this.name]||(r.extensions=r.extensions||{},r.extensions[this.name]={lights:[]},n[this.name]=!0),(n=r.extensions[this.name].lights).push(i),t.extensions=t.extensions||{},t.extensions[this.name]={light:n.length-1}):console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e))}}class GLTFMaterialsUnlitExtension$1{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){e.isMeshBasicMaterial&&(e=this.writer.extensionsUsed,t.extensions=t.extensions||{},t.extensions[this.name]={},e[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9)}}class GLTFMaterialsClearcoatExtension$1{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){var r,i,n,a;e.isMeshPhysicalMaterial&&0!==e.clearcoat&&(i=(r=this.writer).extensionsUsed,(n={}).clearcoatFactor=e.clearcoat,e.clearcoatMap&&(a={index:r.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel},r.applyTextureTransform(a,e.clearcoatMap),n.clearcoatTexture=a),n.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap&&(a={index:r.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel},r.applyTextureTransform(a,e.clearcoatRoughnessMap),n.clearcoatRoughnessTexture=a),e.clearcoatNormalMap&&(a={index:r.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel},r.applyTextureTransform(a,e.clearcoatNormalMap),n.clearcoatNormalTexture=a),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0)}}class GLTFMaterialsIridescenceExtension$1{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){var r,i,n,a;e.isMeshPhysicalMaterial&&0!==e.iridescence&&(i=(r=this.writer).extensionsUsed,(n={}).iridescenceFactor=e.iridescence,e.iridescenceMap&&(a={index:r.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel},r.applyTextureTransform(a,e.iridescenceMap),n.iridescenceTexture=a),n.iridescenceIor=e.iridescenceIOR,n.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],n.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap&&(a={index:r.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel},r.applyTextureTransform(a,e.iridescenceThicknessMap),n.iridescenceThicknessTexture=a),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0)}}class GLTFMaterialsTransmissionExtension$1{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){var r,i,n,a;e.isMeshPhysicalMaterial&&0!==e.transmission&&(i=(r=this.writer).extensionsUsed,(n={}).transmissionFactor=e.transmission,e.transmissionMap&&(a={index:r.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel},r.applyTextureTransform(a,e.transmissionMap),n.transmissionTexture=a),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0)}}class GLTFMaterialsVolumeExtension$1{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){var r,i,n,a;e.isMeshPhysicalMaterial&&0!==e.transmission&&(i=(r=this.writer).extensionsUsed,(n={}).thicknessFactor=e.thickness,e.thicknessMap&&(a={index:r.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel},r.applyTextureTransform(a,e.thicknessMap),n.thicknessTexture=a),n.attenuationDistance=e.attenuationDistance,n.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0)}}class GLTFMaterialsIorExtension$1{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){var r,i;e.isMeshPhysicalMaterial&&1.5!==e.ior&&(r=this.writer.extensionsUsed,(i={}).ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0)}}class GLTFMaterialsSpecularExtension$1{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){var r,i,n,a;e.isMeshPhysicalMaterial&&(1!==e.specularIntensity||!e.specularColor.equals(DEFAULT_SPECULAR_COLOR)||e.specularIntensityMap||e.specularColorTexture)&&(i=(r=this.writer).extensionsUsed,n={},e.specularIntensityMap&&(a={index:r.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel},r.applyTextureTransform(a,e.specularIntensityMap),n.specularTexture=a),e.specularColorMap&&(a={index:r.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel},r.applyTextureTransform(a,e.specularColorMap),n.specularColorTexture=a),n.specularFactor=e.specularIntensity,n.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0)}}class GLTFMaterialsSheenExtension$1{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){var r,i,n,a;e.isMeshPhysicalMaterial&&0!=e.sheen&&(i=(r=this.writer).extensionsUsed,n={},e.sheenRoughnessMap&&(a={index:r.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel},r.applyTextureTransform(a,e.sheenRoughnessMap),n.sheenRoughnessTexture=a),e.sheenColorMap&&(a={index:r.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel},r.applyTextureTransform(a,e.sheenColorMap),n.sheenColorTexture=a),n.sheenRoughnessFactor=e.sheenRoughness,n.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0)}}class GLTFMaterialsAnisotropyExtension$1{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){var r,i,n,a;e.isMeshPhysicalMaterial&&0!=e.anisotropy&&(i=(r=this.writer).extensionsUsed,n={},e.anisotropyMap&&(a={index:r.processTexture(e.anisotropyMap)},r.applyTextureTransform(a,e.anisotropyMap),n.anisotropyTexture=a),n.anisotropyStrength=e.anisotropy,n.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0)}}class GLTFMaterialsEmissiveStrengthExtension$1{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){var r,i;e.isMeshStandardMaterial&&1!==e.emissiveIntensity&&(r=this.writer.extensionsUsed,(i={}).emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0)}}GLTFExporter.Utils={insertKeyframe:function(t,r){var i=t.getValueSize(),n=new t.TimeBufferType(t.times.length+1),a=new t.ValueBufferType(t.values.length+i),o=t.createInterpolant(new t.ValueBufferType(i));let s;if(0===t.times.length){n[0]=r;for(let e=0;e<i;e++)a[e]=0;s=0}else if(r<t.times[0]){if(Math.abs(t.times[0]-r)<.001)return 0;n[0]=r,n.set(t.times,1),a.set(o.evaluate(r),0),a.set(t.values,i),s=0}else if(r>t.times[t.times.length-1]){if(Math.abs(t.times[t.times.length-1]-r)<.001)return t.times.length-1;n[n.length-1]=r,n.set(t.times,0),a.set(t.values,0),a.set(o.evaluate(r),t.values.length),s=n.length-1}else for(let e=0;e<t.times.length;e++){if(Math.abs(t.times[e]-r)<.001)return e;if(t.times[e]<r&&t.times[e+1]>r){n.set(t.times.slice(0,e+1),0),n[e+1]=r,n.set(t.times.slice(e+1),e+2),a.set(t.values.slice(0,(e+1)*i),0),a.set(o.evaluate(r),(e+1)*i),a.set(t.values.slice((e+1)*i),(e+2)*i),s=e+1;break}}return t.times=n,t.values=a,s},mergeMorphTargetTracks:function(e,t){var i=[],n={},a=e.tracks;for(let e=0;e<a.length;++e){let r=a[e];var o=PropertyBinding$1.parseTrackName(r.name),s=PropertyBinding$1.findNode(t,o.nodeName);if("morphTargetInfluences"!==o.propertyName||void 0===o.propertyIndex)i.push(r);else{if(r.createInterpolant!==r.InterpolantFactoryMethodDiscrete&&r.createInterpolant!==r.InterpolantFactoryMethodLinear){if(r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),(r=r.clone()).setInterpolation(InterpolateLinear$1)}var l=s.morphTargetInfluences.length,c=s.morphTargetDictionary[o.propertyIndex];if(void 0===c)throw new Error("THREE.GLTFExporter: Morph target name not found: "+o.propertyIndex);let t;if(void 0===n[s.uuid]){var d=new(t=r.clone()).ValueBufferType(l*t.times.length);for(let e=0;e<t.times.length;e++)d[e*l+c]=t.values[e];t.name=(o.nodeName||"")+".morphTargetInfluences",t.values=d,n[s.uuid]=t,i.push(t)}else{var h=r.createInterpolant(new r.ValueBufferType(1));t=n[s.uuid];for(let e=0;e<t.times.length;e++)t.values[e*l+c]=h.evaluate(t.times[e]);for(let e=0;e<r.times.length;e++){var u=this.insertKeyframe(t,r.times[e]);t.values[u*l+c]=r.values[e]}}}}return e.tracks=i,e}};class GLBExporter{constructor(e,t){checkPropTypes(t,{},{}),this.params={trs:!1,onlyVisible:!0,binary:!0,maxTextureSize:4096},this.tex_fmt=""}save(e,t){var r=document.createElement("a");r.style.display="none",document.body.appendChild(r),r.href=URL.createObjectURL(e),r.download=t,r.click(),r.remove()}saveArrayBuffer(e,t){this.save(new Blob([e],{type:"application/octet-stream"}),t)}saveString(e,t){this.save(new Blob([e],{type:"text/plain"}),t)}clearUserData(e){e.traverse(function(e){e.userData={}})}async export(e){if(console.log("Exporting and downloading scene as .glb file"),Array.isArray(e))if(0===e.length)console.warn("The specified configurator array is empty");else{var t,i=new GLTFExporter,n={trs:this.params.trs,onlyVisible:this.params.onlyVisible,binary:this.params.binary,maxTextureSize:this.params.maxTextureSize},a=new Scene;let r;for(const o of e)o.visible&&(r="scene.glb",r=o.configuration.name+".glb",console.log(r),(t=o.configuration.content.main.medium.clone()).applyMatrix4(o.body.matrixWorld),a.add(t));this.clearUserData(a),i.parse(a,async e=>{var t;e instanceof ArrayBuffer?(t=await this.draco_compress(new Uint8Array(e)),this.saveArrayBuffer(t,r)):(t=JSON.stringify(e,null,2),console.log(t),this.saveString(t,"scene.gltf"))},e=>{console.error("An error happened during parsing",e)},n)}else console.error("The configurator array is not of type array")}exportToServer(){console.log("exporting glb to server")}async draco_compress(e){var t=(await import("@gltf-transform/core"))["WebIO"],{dedup:r,flatten:i,instance:n,join:a,palette:o,prune:s,unpartition:l}=await import("@gltf-transform/functions"),{KHRONOS_EXTENSIONS:c,KHRDracoMeshCompression:d,EXTMeshGPUInstancing:h}=await import("@gltf-transform/extensions"),u=new t;u.registerExtensions(c),u.registerExtensions([h]),u.registerDependencies({"draco3d.encoder":DracoEncoderModule()});const A=await u.readBinary(e);if(await A.transform(l(),o({min:5}),r(),s(),n({min:2}),i(),a()),""!==this.tex_fmt){t=A.getRoot().listTextures();if(tex_fmt.startsWith("ktx")){var p=(await import("@gltf-transform/functions"))["listTextureSlots"];const E=(await import("@gltf-transform/extensions"))["KHRTextureBasisu"],T=(await import("ktx2-encoder"))["encodeToKTX2"];var m=["normalTexture","occlusionTexture","metallicRoughnessTexture"];for(const x of t){const b=await p(x);var f=await x.getSize();const w=!1===tex_fmt.endsWith("e")&&(m.some(e=>e===b[0])||!0===tex_fmt.endsWith("u"));var g=f[0]%4==0,v=f[1]%4==0;if(g&&v)await T(x.getImage(),{isUASTC:w}).then(e=>{x.setImage(e),x.setMimeType("image/ktx2"),A.createExtension(E).setRequired(!0)});else{const C=!0==g?f[0]:Math.max(4,f[0]-f[0]%4),S=!0==v?f[1]:Math.max(4,f[1]-f[1]%4),M=new FileReader;await new Promise(n=>{M.onload=function(e){const t=new Image;t.onload=async function(){var e=document.createElement("canvas");e.width=C,e.height=S;e.getContext("2d").drawImage(t,0,0,e.width,e.height);var e=e.toDataURL("image/"+x.getMimeType(),1).replace(/^data:image\/(png|jpg|jpeg);base64,/,""),r=atob(e),i=new Uint8Array(r.length);for(let e=0,t=i.length;e<t;e++)i[e]=r.charCodeAt(e);await T(i,{isUASTC:w}).then(e=>{x.setImage(e),x.setMimeType("image/ktx2"),n(A.createExtension(E).setRequired(!0))})},t.src=e.target.result},M.readAsDataURL(new Blob([x.getImage()],{type:x.getMimeType()}))})}}}else{var _=(await import("@gltf-transform/functions"))["compressTexture"],y=(await import("@gltf-transform/extensions"))["EXTTextureWebP"];for(const B of t)await _(B,{targetFormat:tex_fmt}),A.createExtension(y).setRequired(!0),u.registerExtensions([y])}}A.createExtension(d).setRequired(!0).setEncoderOptions({method:d.EncoderMethod.EDGEBREAKER,encodeSpeed:5});c=u.writeBinary(A);for(const N of A.getRoot().listTextures())N.dispose();for(const R of A.getRoot().listMaterials())R.dispose();for(const L of A.getRoot().listMeshes())L.dispose();return c}}class PDF extends Export{constructor(){throw super(),this.revision=1,new Error("Not implemented")}}var extendThree=Object.freeze({__proto__:null,Pass:Pass,RenderPass:RenderPass,ShaderPass:ShaderPass,OutputPass:OutputPass,GammaCorrectionShader:GammaCorrectionShader$1,FXAAShader:FXAAShader,LineGeometry:LineGeometry,Line2:Line2,LineMaterial:LineMaterial});class t{constructor(e,r,i,n,a="div"){this.parent=e,this.object=r,this.property=i,this._disabled=!1,this._hidden=!1,this.initialValue=this.getValue(),this.domElement=document.createElement("div"),this.domElement.classList.add("controller"),this.domElement.classList.add(n),this.$name=document.createElement("div"),this.$name.classList.add("name"),t.nextNameID=t.nextNameID||0,this.$name.id="lil-gui-name-"+ ++t.nextNameID,this.$widget=document.createElement(a),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(i)}name(e){return this._name=e,this.$name.innerHTML=e,this}onChange(e){return this._onChange=e,this}_callOnChange(){this.parent._callOnChange(this),void 0!==this._onChange&&this._onChange.call(this,this.getValue()),this._changed=!0}onFinishChange(e){return this._onFinishChange=e,this}_callOnFinishChange(){this._changed&&(this.parent._callOnFinishChange(this),void 0!==this._onFinishChange)&&this._onFinishChange.call(this,this.getValue()),this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(e=!0){return this.disable(!e)}disable(e=!0){return e!==this._disabled&&(this._disabled=e,this.domElement.classList.toggle("disabled",e),this.$disable.toggleAttribute("disabled",e)),this}show(e=!0){return this._hidden=!e,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}options(e){e=this.parent.add(this.object,this.property,e);return e.name(this._name),this.destroy(),e}min(e){return this}max(e){return this}step(e){return this}decimals(e){return this}listen(e=!0){return this._listening=e,void 0!==this._listenCallbackID&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);var e=this.save();e!==this._listenPrevValue&&this.updateDisplay(),this._listenPrevValue=e}getValue(){return this.object[this.property]}setValue(e){return this.object[this.property]=e,this._callOnChange(),this.updateDisplay(),this}updateDisplay(){return this}load(e){return this.setValue(e),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class i$3 extends t{constructor(e,t,r){super(e,t,r,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",()=>{this.setValue(this.$input.checked),this._callOnFinishChange()}),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function e$1(e){let t,r;return(t=e.match(/(#|0x)?([a-f0-9]{6})/i))?r=t[2]:(t=e.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?r=parseInt(t[1]).toString(16).padStart(2,0)+parseInt(t[2]).toString(16).padStart(2,0)+parseInt(t[3]).toString(16).padStart(2,0):(t=e.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(r=t[1]+t[1]+t[2]+t[2]+t[3]+t[3]),!!r&&"#"+r}const s={isPrimitive:!0,match:e=>"string"==typeof e,fromHexString:e$1,toHexString:e$1},n={isPrimitive:!0,match:e=>"number"==typeof e,fromHexString:e=>parseInt(e.substring(1),16),toHexString:e=>"#"+e.toString(16).padStart(6,0)},l={isPrimitive:!1,match:Array.isArray,fromHexString(e,t,r=1){e=n.fromHexString(e);t[0]=(e>>16&255)/255*r,t[1]=(e>>8&255)/255*r,t[2]=(255&e)/255*r},toHexString:([e,t,r],i=1)=>n.toHexString(e*(i=255/i)<<16^t*i<<8^r*i<<0)},r={isPrimitive:!1,match:e=>Object(e)===e,fromHexString(e,t,r=1){e=n.fromHexString(e);t.r=(e>>16&255)/255*r,t.g=(e>>8&255)/255*r,t.b=(255&e)/255*r},toHexString:({r:e,g:t,b:r},i=1)=>n.toHexString(e*(i=255/i)<<16^t*i<<8^r*i<<0)},o=[s,n,l,r];class a$1 extends t{constructor(e,t,r,i){var n;super(e,t,r,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=(n=this.initialValue,o.find(e=>e.match(n))),this._rgbScale=i,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",()=>{this._setValueFromHexString(this.$input.value)}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$text.addEventListener("input",()=>{var e=e$1(this.$text.value);e&&this._setValueFromHexString(e)}),this.$text.addEventListener("focus",()=>{this._textFocused=!0,this.$text.select()}),this.$text.addEventListener("blur",()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()}),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(e){var t;this._format.isPrimitive?(t=this._format.fromHexString(e),this.setValue(t)):(this._format.fromHexString(e,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay())}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(e){return this._setValueFromHexString(e),this._callOnFinishChange(),this}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class h extends t{constructor(e,t,r){super(e,t,r,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",e=>{e.preventDefault(),this.getValue().call(this.object)}),this.$button.addEventListener("touchstart",()=>{},{passive:!0}),this.$disable=this.$button}}class d extends t{constructor(e,t,r,i,n,a){super(e,t,r,"number"),this._initInput(),this.min(i),this.max(n);e=void 0!==a;this.step(e?a:this._getImplicitStep(),e),this.updateDisplay()}decimals(e){return this._decimals=e,this.updateDisplay(),this}min(e){return this._min=e,this._onUpdateMinMax(),this}max(e){return this._max=e,this._onUpdateMinMax(),this}step(e,t=!0){return this._step=e,this._stepExplicit=t,this}updateDisplay(){var e,t=this.getValue();return this._hasSlider&&(e=(t-this._min)/(this._max-this._min),e=Math.max(0,Math.min(e,1)),this.$fill.style.width=100*e+"%"),this._inputFocused||(this.$input.value=void 0===this._decimals?t:t.toFixed(this._decimals)),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$disable=this.$input;const t=e=>{var t=parseFloat(this.$input.value);isNaN(t)||(this._snapClampSetValue(t+e),this.$input.value=this.getValue())};let r,i,n,a,o,s=!1;const l=e=>{if(s){const n=e.clientX-r,a=e.clientY-i;5<Math.abs(a)?(e.preventDefault(),this.$input.blur(),s=!1,this._setDraggingStyle(!0,"vertical")):5<Math.abs(n)&&c()}if(!s){const r=e.clientY-n;o-=r*this._step*this._arrowKeyMultiplier(e),a+o>this._max?o=this._max-a:a+o<this._min&&(o=this._min-a),this._snapClampSetValue(a+o)}n=e.clientY},c=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",c)};this.$input.addEventListener("input",()=>{let e=parseFloat(this.$input.value);isNaN(e)||(this._stepExplicit&&(e=this._snap(e)),this.setValue(this._clamp(e)))}),this.$input.addEventListener("keydown",e=>{"Enter"===e.code&&this.$input.blur(),"ArrowUp"===e.code&&(e.preventDefault(),t(this._step*this._arrowKeyMultiplier(e))),"ArrowDown"===e.code&&(e.preventDefault(),t(this._step*this._arrowKeyMultiplier(e)*-1))}),this.$input.addEventListener("wheel",e=>{this._inputFocused&&(e.preventDefault(),t(this._step*this._normalizeMouseWheel(e)))},{passive:!1}),this.$input.addEventListener("mousedown",e=>{r=e.clientX,i=n=e.clientY,s=!0,a=this.getValue(),o=0,window.addEventListener("mousemove",l),window.addEventListener("mouseup",c)}),this.$input.addEventListener("focus",()=>{this._inputFocused=!0}),this.$input.addEventListener("blur",()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()})}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const r=e=>{var t,r,i=this.$slider.getBoundingClientRect(),e=(t=i.left,i=i.right,r=this._min,(e-t)/(i-t)*(this._max-r)+r);this._snapClampSetValue(e)},t=e=>{r(e.clientX)},i=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",i)};let n,a,o=!1;const s=e=>{e.preventDefault(),this._setDraggingStyle(!0),r(e.touches[0].clientX),o=!1},l=e=>{if(o){const r=e.touches[0].clientX-n,t=e.touches[0].clientY-a;Math.abs(r)>Math.abs(t)?s(e):(window.removeEventListener("touchmove",l),window.removeEventListener("touchend",c))}else e.preventDefault(),r(e.touches[0].clientX)},c=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",l),window.removeEventListener("touchend",c)},d=this._callOnFinishChange.bind(this);let h;this.$slider.addEventListener("mousedown",e=>{this._setDraggingStyle(!0),r(e.clientX),window.addEventListener("mousemove",t),window.addEventListener("mouseup",i)}),this.$slider.addEventListener("touchstart",e=>{1<e.touches.length||(this._hasScrollBar?(n=e.touches[0].clientX,a=e.touches[0].clientY,o=!0):s(e),window.addEventListener("touchmove",l,{passive:!1}),window.addEventListener("touchend",c))},{passive:!1}),this.$slider.addEventListener("wheel",e=>{Math.abs(e.deltaX)<Math.abs(e.deltaY)&&this._hasScrollBar||(e.preventDefault(),e=this._normalizeMouseWheel(e)*this._step,this._snapClampSetValue(this.getValue()+e),this.$input.value=this.getValue(),clearTimeout(h),h=setTimeout(d,400))},{passive:!1})}_setDraggingStyle(e,t="horizontal"){this.$slider&&this.$slider.classList.toggle("active",e),document.body.classList.toggle("lil-gui-dragging",e),document.body.classList.toggle("lil-gui-"+t,e)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(e){let{deltaX:t,deltaY:r}=e;return Math.floor(e.deltaY)!==e.deltaY&&e.wheelDelta&&(t=0,r=-e.wheelDelta/120,r*=this._stepExplicit?1:10),t+-r}_arrowKeyMultiplier(e){let t=this._stepExplicit?1:10;return e.shiftKey?t*=10:e.altKey&&(t/=10),t}_snap(e){e=Math.round(e/this._step)*this._step;return parseFloat(e.toPrecision(15))}_clamp(e){return e=(e=e<this._min?this._min:e)>this._max?this._max:e}_snapClampSetValue(e){this.setValue(this._clamp(this._snap(e)))}get _hasScrollBar(){var e=this.parent.root.$children;return e.scrollHeight>e.clientHeight}get _hasMin(){return void 0!==this._min}get _hasMax(){return void 0!==this._max}}class c extends t{constructor(e,t,r,i){super(e,t,r,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this._values=Array.isArray(i)?i:Object.values(i),this._names=Array.isArray(i)?i:Object.keys(i),this._names.forEach(e=>{var t=document.createElement("option");t.innerHTML=e,this.$select.appendChild(t)}),this.$select.addEventListener("change",()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()}),this.$select.addEventListener("focus",()=>{this.$display.classList.add("focus")}),this.$select.addEventListener("blur",()=>{this.$display.classList.remove("focus")}),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.updateDisplay()}updateDisplay(){var e=this.getValue(),t=this._values.indexOf(e);return this.$select.selectedIndex=t,this.$display.innerHTML=-1===t?e:this._names[t],this}}class u$1 extends t{constructor(e,t,r){super(e,t,r,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",()=>{this.setValue(this.$input.value)}),this.$input.addEventListener("keydown",e=>{"Enter"===e.code&&this.$input.blur()}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}let p=!1;class g{constructor({parent:e,autoPlace:t=void 0===e,container:r,width:i,title:n="Controls",injectStyles:a=!0,touchStyles:o=!0}={}){this.parent=e,this.root=e?e.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("div"),this.$title.classList.add("title"),this.$title.setAttribute("role","button"),this.$title.setAttribute("aria-expanded",!0),this.$title.setAttribute("tabindex",0),this.$title.addEventListener("click",()=>this.openAnimated(this._closed)),this.$title.addEventListener("keydown",e=>{"Enter"!==e.code&&"Space"!==e.code||(e.preventDefault(),this.$title.click())}),this.$title.addEventListener("touchstart",()=>{},{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(n),o&&this.domElement.classList.add("allow-touch-styles"),this.parent?(this.parent.children.push(this),this.parent.folders.push(this),this.parent.$children.appendChild(this.domElement)):(this.domElement.classList.add("root"),!p&&a&&((n=document.createElement("style")).innerHTML='.lil-gui{--background-color:#1f1f1f;--text-color:#ebebeb;--title-background-color:#111;--title-text-color:#ebebeb;--widget-color:#424242;--hover-color:#4f4f4f;--focus-color:#595959;--number-color:#2cc9ff;--string-color:#a2db3c;--font-size:11px;--input-font-size:11px;--font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;--font-family-mono:Menlo,Monaco,Consolas,"Droid Sans Mono",monospace;--padding:4px;--spacing:4px;--widget-height:20px;--name-width:45%;--slider-knob-width:2px;--slider-input-width:27%;--color-input-width:27%;--slider-input-min-width:45px;--color-input-min-width:45px;--folder-indent:7px;--widget-padding:0 0 0 3px;--widget-border-radius:2px;--checkbox-size:calc(var(--widget-height)*0.75);--scrollbar-width:5px;background-color:var(--background-color);color:var(--text-color);font-family:var(--font-family);font-size:var(--font-size);font-style:normal;font-weight:400;line-height:1;text-align:left;touch-action:manipulation;user-select:none;-webkit-user-select:none}.lil-gui,.lil-gui *{box-sizing:border-box;margin:0;padding:0}.lil-gui.root{display:flex;flex-direction:column;width:var(--width,245px)}.lil-gui.root>.title{background:var(--title-background-color);color:var(--title-text-color)}.lil-gui.root>.children{overflow-x:hidden;overflow-y:auto}.lil-gui.root>.children::-webkit-scrollbar{background:var(--background-color);height:var(--scrollbar-width);width:var(--scrollbar-width)}.lil-gui.root>.children::-webkit-scrollbar-thumb{background:var(--focus-color);border-radius:var(--scrollbar-width)}.lil-gui.force-touch-styles{--widget-height:28px;--padding:6px;--spacing:6px;--font-size:13px;--input-font-size:16px;--folder-indent:10px;--scrollbar-width:7px;--slider-input-min-width:50px;--color-input-min-width:65px}.lil-gui.autoPlace{max-height:100%;position:fixed;right:15px;top:0;z-index:1001}.lil-gui .controller{align-items:center;display:flex;margin:var(--spacing) 0;padding:0 var(--padding)}.lil-gui .controller.disabled{opacity:.5}.lil-gui .controller.disabled,.lil-gui .controller.disabled *{pointer-events:none!important}.lil-gui .controller>.name{flex-shrink:0;line-height:var(--widget-height);min-width:var(--name-width);padding-right:var(--spacing);white-space:pre}.lil-gui .controller .widget{align-items:center;display:flex;min-height:var(--widget-height);position:relative;width:100%}.lil-gui .controller.string input{color:var(--string-color)}.lil-gui .controller.boolean .widget{cursor:pointer}.lil-gui .controller.color .display{border-radius:var(--widget-border-radius);height:var(--widget-height);position:relative;width:100%}.lil-gui .controller.color input[type=color]{cursor:pointer;height:100%;opacity:0;width:100%}.lil-gui .controller.color input[type=text]{flex-shrink:0;font-family:var(--font-family-mono);margin-left:var(--spacing);min-width:var(--color-input-min-width);width:var(--color-input-width)}.lil-gui .controller.option select{max-width:100%;opacity:0;position:absolute;width:100%}.lil-gui .controller.option .display{background:var(--widget-color);border-radius:var(--widget-border-radius);height:var(--widget-height);line-height:var(--widget-height);max-width:100%;overflow:hidden;padding-left:.55em;padding-right:1.75em;pointer-events:none;position:relative;word-break:break-all}.lil-gui .controller.option .display.active{background:var(--focus-color)}.lil-gui .controller.option .display:after{bottom:0;content:"";font-family:lil-gui;padding-right:.375em;position:absolute;right:0;top:0}.lil-gui .controller.option .widget,.lil-gui .controller.option select{cursor:pointer}.lil-gui .controller.number input{color:var(--number-color)}.lil-gui .controller.number.hasSlider input{flex-shrink:0;margin-left:var(--spacing);min-width:var(--slider-input-min-width);width:var(--slider-input-width)}.lil-gui .controller.number .slider{background-color:var(--widget-color);border-radius:var(--widget-border-radius);cursor:ew-resize;height:var(--widget-height);overflow:hidden;padding-right:var(--slider-knob-width);touch-action:pan-y;width:100%}.lil-gui .controller.number .slider.active{background-color:var(--focus-color)}.lil-gui .controller.number .slider.active .fill{opacity:.95}.lil-gui .controller.number .fill{border-right:var(--slider-knob-width) solid var(--number-color);box-sizing:content-box;height:100%}.lil-gui-dragging .lil-gui{--hover-color:var(--widget-color)}.lil-gui-dragging *{cursor:ew-resize!important}.lil-gui-dragging.lil-gui-vertical *{cursor:ns-resize!important}.lil-gui .title{--title-height:calc(var(--widget-height) + var(--spacing)*1.25);-webkit-tap-highlight-color:transparent;text-decoration-skip:objects;cursor:pointer;font-weight:600;height:var(--title-height);line-height:calc(var(--title-height) - 4px);outline:none;padding:0 var(--padding)}.lil-gui .title:before{content:"";display:inline-block;font-family:lil-gui;padding-right:2px}.lil-gui .title:active{background:var(--title-background-color);opacity:.75}.lil-gui.root>.title:focus{text-decoration:none!important}.lil-gui.closed>.title:before{content:""}.lil-gui.closed>.children{opacity:0;transform:translateY(-7px)}.lil-gui.closed:not(.transition)>.children{display:none}.lil-gui.transition>.children{overflow:hidden;pointer-events:none;transition-duration:.3s;transition-property:height,opacity,transform;transition-timing-function:cubic-bezier(.2,.6,.35,1)}.lil-gui .children:empty:before{content:"Empty";display:block;font-style:italic;height:var(--widget-height);line-height:var(--widget-height);margin:var(--spacing) 0;opacity:.5;padding:0 var(--padding)}.lil-gui.root>.children>.lil-gui>.title{border-width:0;border-bottom:1px solid var(--widget-color);border-left:0 solid var(--widget-color);border-right:0 solid var(--widget-color);border-top:1px solid var(--widget-color);transition:border-color .3s}.lil-gui.root>.children>.lil-gui.closed>.title{border-bottom-color:transparent}.lil-gui+.controller{border-top:1px solid var(--widget-color);margin-top:0;padding-top:var(--spacing)}.lil-gui .lil-gui .lil-gui>.title{border:none}.lil-gui .lil-gui .lil-gui>.children{border:none;border-left:2px solid var(--widget-color);margin-left:var(--folder-indent)}.lil-gui .lil-gui .controller{border:none}.lil-gui input{-webkit-tap-highlight-color:transparent;background:var(--widget-color);border:0;border-radius:var(--widget-border-radius);color:var(--text-color);font-family:var(--font-family);font-size:var(--input-font-size);height:var(--widget-height);outline:none;width:100%}.lil-gui input:disabled{opacity:1}.lil-gui input[type=number],.lil-gui input[type=text]{padding:var(--widget-padding)}.lil-gui input[type=number]:focus,.lil-gui input[type=text]:focus{background:var(--focus-color)}.lil-gui input::-webkit-inner-spin-button,.lil-gui input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.lil-gui input[type=number]{-moz-appearance:textfield}.lil-gui input[type=checkbox]{appearance:none;-webkit-appearance:none;border-radius:var(--widget-border-radius);cursor:pointer;height:var(--checkbox-size);text-align:center;width:var(--checkbox-size)}.lil-gui input[type=checkbox]:checked:before{content:"";font-family:lil-gui;font-size:var(--checkbox-size);line-height:var(--checkbox-size)}.lil-gui button{-webkit-tap-highlight-color:transparent;background:var(--widget-color);border:1px solid var(--widget-color);border-radius:var(--widget-border-radius);color:var(--text-color);cursor:pointer;font-family:var(--font-family);font-size:var(--font-size);height:var(--widget-height);line-height:calc(var(--widget-height) - 4px);outline:none;text-align:center;text-transform:none;width:100%}.lil-gui button:active{background:var(--focus-color)}@font-face{font-family:lil-gui;src:url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff")}@media (pointer:coarse){.lil-gui.allow-touch-styles{--widget-height:28px;--padding:6px;--spacing:6px;--font-size:13px;--input-font-size:16px;--folder-indent:10px;--scrollbar-width:7px;--slider-input-min-width:50px;--color-input-min-width:65px}}@media (hover:hover){.lil-gui .controller.color .display:hover:before{border:1px solid #fff9;border-radius:var(--widget-border-radius);bottom:0;content:" ";display:block;left:0;position:absolute;right:0;top:0}.lil-gui .controller.option .display.focus{background:var(--focus-color)}.lil-gui .controller.option .widget:hover .display{background:var(--hover-color)}.lil-gui .controller.number .slider:hover{background-color:var(--hover-color)}body:not(.lil-gui-dragging) .lil-gui .title:hover{background:var(--title-background-color);opacity:.85}.lil-gui .title:focus{text-decoration:underline var(--focus-color)}.lil-gui input:hover{background:var(--hover-color)}.lil-gui input:active{background:var(--focus-color)}.lil-gui input[type=checkbox]:focus{box-shadow:inset 0 0 0 1px var(--focus-color)}.lil-gui button:hover{background:var(--hover-color);border-color:var(--hover-color)}.lil-gui button:focus{border-color:var(--focus-color)}}',(o=document.querySelector("head link[rel=stylesheet], head style"))?document.head.insertBefore(n,o):document.head.appendChild(n),p=!0),r?r.appendChild(this.domElement):t&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),i&&this.domElement.style.setProperty("--width",i+"px"),this.domElement.addEventListener("keydown",e=>e.stopPropagation()),this.domElement.addEventListener("keyup",e=>e.stopPropagation()))}add(e,t,r,i,n){if(Object(r)===r)return new c(this,e,t,r);var a=e[t];switch(typeof a){case"number":return new d(this,e,t,r,i,n);case"boolean":return new i$3(this,e,t);case"string":return new u$1(this,e,t);case"function":return new h(this,e,t)}console.error("gui.add failed\n\tproperty:",t,"\n\tobject:",e,"\n\tvalue:",a)}addColor(e,t,r=1){return new a$1(this,e,t,r)}addFolder(e){return new g({parent:this,title:e})}load(t,e=!0){return t.controllers&&this.controllers.forEach(e=>{e instanceof h||e._name in t.controllers&&e.load(t.controllers[e._name])}),e&&t.folders&&this.folders.forEach(e=>{e._title in t.folders&&e.load(t.folders[e._title])}),this}save(e=!0){const t={controllers:{},folders:{}};return this.controllers.forEach(e=>{if(!(e instanceof h)){if(e._name in t.controllers)throw new Error(`Cannot save GUI with duplicate property "${e._name}"`);t.controllers[e._name]=e.save()}}),e&&this.folders.forEach(e=>{if(e._title in t.folders)throw new Error(`Cannot save GUI with duplicate folder "${e._title}"`);t.folders[e._title]=e.save()}),t}open(e=!0){return this._closed=!e,this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}show(e=!0){return this._hidden=!e,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(i=!0){return this._closed=!i,this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame(()=>{var e=this.$children.clientHeight;this.$children.style.height=e+"px",this.domElement.classList.add("transition");const t=e=>{e.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",t))},r=(this.$children.addEventListener("transitionend",t),i?this.$children.scrollHeight:0);this.domElement.classList.toggle("closed",!i),requestAnimationFrame(()=>{this.$children.style.height=r+"px"})}),this}title(e){return this._title=e,this.$title.innerHTML=e,this}reset(e=!0){return(e?this.controllersRecursive():this.controllers).forEach(e=>e.reset()),this}onChange(e){return this._onChange=e,this}_callOnChange(e){this.parent&&this.parent._callOnChange(e),void 0!==this._onChange&&this._onChange.call(this,{object:e.object,property:e.property,value:e.getValue(),controller:e})}onFinishChange(e){return this._onFinishChange=e,this}_callOnFinishChange(e){this.parent&&this.parent._callOnFinishChange(e),void 0!==this._onFinishChange&&this._onFinishChange.call(this,{object:e.object,property:e.property,value:e.getValue(),controller:e})}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach(e=>e.destroy())}controllersRecursive(){let t=Array.from(this.controllers);return this.folders.forEach(e=>{t=t.concat(e.controllersRecursive())}),t}foldersRecursive(){let t=Array.from(this.folders);return this.folders.forEach(e=>{t=t.concat(e.foldersRecursive())}),t}}console.log("[ ProductBuilder Engine Version: update-threejs ]"),console.log("THREE Version:",REVISION);export{Actor,Atom,Block,BlockCategory,BlockCategoryType,BlockInstance,BlockSet,BoxGeometry,BufferGeometry,BuildableComponent,CacheLogger,Component,ComponentLoader,ComponentTree$1 as ComponentTree,Composer,Configuration,ConfigurationSettings,Configurator,Connectable,Connection,ConnectionType,Connector,ConnectorInstance,ConnectorType,ConsoleLogger,ContactShadow,DefaultSelectionTransform,DefaultView,DirectionalLight,EXR,EXRLoader,extendThree as EXTENDTHREE,Environment,EnvironmentMap,Euler,Export,GLBExporter,GLTF,g as GUI,Geometry,GeometryFile,ImageExporter,InformationSource,Line,LineBasicMaterial,LineSegments,LoadableComponent,LoadingBase,Marker,MaterialAssignment,MaterialCategory,MaterialCategoryType,MaterialSet,Mesh,MeshBasicMaterial,MeshGroup,MeshStandardMaterial,MoooiView,NavigationSettings,Object3D,PDF,PMREMGenerator,Package,PerspectiveCamera,PlaneGeometry,PositionedBlock,PositionedComponent,PositionedMesh,PositionedMeshGroup,Preset,Project,Quaternion,Raycaster,Reporter,Scene,SceneManager,ServerConnection,ServerLogger,SingleBlockInstance,THREE,Theme,ThemeGroup,Timer,Transform,Tween,URLRegex,UUIDRegex,UsdzExporter,Vector3,View,WebGLRenderer,WireframeGeometry,WrappedImage,WrappedMaterial,WrappedMesh,WrappedTexture,buildMateMap,checkPropTypes,copyProps,drawDimensionsLine,drawDimensionsLineBoundingBox,eqArr,getAssigningComponent,getDimensions,getDimensionsBoundingBox,makeImage,omit,pause,pick,semverRegex,sum,ucFirst,unique,v4 as uuid};
