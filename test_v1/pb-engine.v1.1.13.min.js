const REVISION="127",MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,CullFaceFrontBack=3,BasicShadowMap=0,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,FlatShading=1,SmoothShading=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,CubeUVRefractionMapping=307,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipMapNearestFilter=1004,NearestMipmapLinearFilter=1005,NearestMipMapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipMapNearestFilter=1007,LinearMipmapLinearFilter=1008,LinearMipMapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedShort565Type=1019,UnsignedInt248Type=1020,AlphaFormat=1021,RGBFormat=1022,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,RGBEFormat=RGBAFormat,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBIntegerFormat=1032,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,SRGB8_ALPHA8_ASTC_4x4_Format=37840,SRGB8_ALPHA8_ASTC_5x4_Format=37841,SRGB8_ALPHA8_ASTC_5x5_Format=37842,SRGB8_ALPHA8_ASTC_6x5_Format=37843,SRGB8_ALPHA8_ASTC_6x6_Format=37844,SRGB8_ALPHA8_ASTC_8x5_Format=37845,SRGB8_ALPHA8_ASTC_8x6_Format=37846,SRGB8_ALPHA8_ASTC_8x8_Format=37847,SRGB8_ALPHA8_ASTC_10x5_Format=37848,SRGB8_ALPHA8_ASTC_10x6_Format=37849,SRGB8_ALPHA8_ASTC_10x8_Format=37850,SRGB8_ALPHA8_ASTC_10x10_Format=37851,SRGB8_ALPHA8_ASTC_12x10_Format=37852,SRGB8_ALPHA8_ASTC_12x12_Format=37853,LoopOnce=2200,LoopRepeat=2201,LoopPingPong=2202,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,NormalAnimationBlendMode=2500,AdditiveAnimationBlendMode=2501,TrianglesDrawMode=0,TriangleStripDrawMode=1,TriangleFanDrawMode=2,LinearEncoding=3e3,sRGBEncoding=3001,GammaEncoding=3007,RGBEEncoding=3002,LogLuvEncoding=3003,RGBM7Encoding=3004,RGBM16Encoding=3005,RGBDEncoding=3006,BasicDepthPacking=3200,RGBADepthPacking=3201,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,ZeroStencilOp=0,KeepStencilOp=7680,ReplaceStencilOp=7681,IncrementStencilOp=7682,DecrementStencilOp=7683,IncrementWrapStencilOp=34055,DecrementWrapStencilOp=34056,InvertStencilOp=5386,NeverStencilFunc=512,LessStencilFunc=513,EqualStencilFunc=514,LessEqualStencilFunc=515,GreaterStencilFunc=516,NotEqualStencilFunc=517,GreaterEqualStencilFunc=518,AlwaysStencilFunc=519,StaticDrawUsage=35044,DynamicDrawUsage=35048,StreamDrawUsage=35040,StaticReadUsage=35045,DynamicReadUsage=35049,StreamReadUsage=35041,StaticCopyUsage=35046,DynamicCopyUsage=35050,StreamCopyUsage=35042,GLSL1="100",GLSL3="300 es";function EventDispatcher(){}Object.assign(EventDispatcher.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});const r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;const r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){const r=this._listeners[e];void 0===r||-1!==(t=r.indexOf(t))&&r.splice(t,1)}},dispatchEvent:function(r){if(void 0!==this._listeners){const e=this._listeners[r.type];if(void 0!==e){r.target=this;const n=e.slice(0);for(let e=0,t=n.length;e<t;e++)n[e].call(this,r);r.target=null}}}});const _lut=[];for(let e=0;e<256;e++)_lut[e]=(e<16?"0":"")+e.toString(16);let _seed=1234567;const MathUtils={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;const i=_lut[255&e]+_lut[e>>8&255]+_lut[e>>16&255]+_lut[e>>24&255]+"-"+_lut[255&t]+_lut[t>>8&255]+"-"+_lut[t>>16&15|64]+_lut[t>>24&255]+"-"+_lut[63&r|128]+_lut[r>>8&255]+"-"+_lut[r>>16&255]+_lut[r>>24&255]+_lut[255&n]+_lut[n>>8&255]+_lut[n>>16&255]+_lut[n>>24&255];return i.toUpperCase()},clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,n,i){return n+(e-t)*(i-n)/(r-t)},inverseLerp:function(e,t,r){return e!==t?(r-e)/(t-e):0},lerp:function(e,t,r){return(1-r)*e+r*t},damp:function(e,t,r,n){return MathUtils.lerp(e,t,1-Math.exp(-r*n))},pingpong:function(e,t=1){return t-Math.abs(MathUtils.euclideanModulo(e,2*t)-t)},smoothstep:function(e,t,r){return e<=t?0:r<=e?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:r<=e?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(_seed=e%2147483647),_seed=16807*_seed%2147483647,(_seed-1)/2147483646},degToRad:function(e){return e*MathUtils.DEG2RAD},radToDeg:function(e){return e*MathUtils.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,r,n,i){const o=Math.cos,a=Math.sin;var s=o(r/2),l=a(r/2),c=o((t+n)/2),h=a((t+n)/2),u=o((t-n)/2),A=a((t-n)/2),d=o((n-t)/2),p=a((n-t)/2);switch(i){case"XYX":e.set(s*h,l*u,l*A,s*c);break;case"YZY":e.set(l*A,s*h,l*u,s*c);break;case"ZXZ":e.set(l*u,l*A,s*h,s*c);break;case"XZX":e.set(s*h,l*p,l*d,s*c);break;case"YXY":e.set(l*d,s*h,l*p,s*c);break;case"ZYZ":e.set(l*p,l*d,s*h,s*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}};class Vector2{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){var t=this.x,r=this.y,e=e.elements;return this.x=e[0]*t+e[3]*r+e[6],this.y=e[1]*t+e[4]*r+e[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){var r=Math.cos(t),n=Math.sin(t),i=this.x-e.x,t=this.y-e.y;return this.x=i*r-t*n+e.x,this.y=i*n+t*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}Vector2.prototype.isVector2=!0;class Matrix3{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,r,n,i,o,a,s,l){const c=this.elements;return c[0]=e,c[1]=n,c[2]=a,c[3]=t,c[4]=i,c[5]=s,c[6]=r,c[7]=o,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements;e=e.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){e=e.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){var r=e.elements,n=t.elements;const i=this.elements;var o=r[0],a=r[3],s=r[6],l=r[1],c=r[4],h=r[7],u=r[2],A=r[5],d=r[8],p=n[0],m=n[3],f=n[6],g=n[1],v=n[4],e=n[7],t=n[2],r=n[5],n=n[8];return i[0]=o*p+a*g+s*t,i[3]=o*m+a*v+s*r,i[6]=o*f+a*e+s*n,i[1]=l*p+c*g+h*t,i[4]=l*m+c*v+h*r,i[7]=l*f+c*e+h*n,i[2]=u*p+A*g+d*t,i[5]=u*m+A*v+d*r,i[8]=u*f+A*e+d*n,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){var e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],e=e[8];return t*o*e-t*a*l-r*i*e+r*a*s+n*i*l-n*o*s}invert(){const e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8],h=c*o-a*l,u=a*s-c*i,A=l*i-o*s,d=t*h+r*u+n*A;if(0==d)return this.set(0,0,0,0,0,0,0,0,0);var p=1/d;return e[0]=h*p,e[1]=(n*l-c*r)*p,e[2]=(a*r-n*o)*p,e[3]=u*p,e[4]=(c*t-n*s)*p,e[5]=(n*i-a*t)*p,e[6]=A*p,e[7]=(r*s-l*t)*p,e[8]=(o*t-r*i)*p,this}transpose(){var e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,n,i,o,a){var s=Math.cos(i),i=Math.sin(i);return this.set(r*s,r*i,-r*(s*o+i*a)+o+e,-n*i,n*s,-n*(-i*o+s*a)+a+t,0,0,1),this}scale(e,t){const r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this}rotate(e){var t=Math.cos(e),r=Math.sin(e);const n=this.elements;var i=n[0],o=n[3],a=n[6],s=n[1],l=n[4],e=n[7];return n[0]=t*i+r*s,n[3]=t*o+r*l,n[6]=t*a+r*e,n[1]=-r*i+t*s,n[4]=-r*o+t*l,n[7]=-r*a+t*e,this}translate(e,t){const r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this}equals(e){var t=this.elements,r=e.elements;for(let e=0;e<9;e++)if(t[e]!==r[e])return!1;return!0}fromArray(t,r=0){for(let e=0;e<9;e++)this.elements[e]=t[e+r];return this}toArray(e=[],t=0){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}Matrix3.prototype.isMatrix3=!0;let _canvas;const ImageUtils={getDataURL:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===_canvas&&(_canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),_canvas.width=e.width,_canvas.height=e.height;const r=_canvas.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=_canvas}return 2048<t.width||2048<t.height?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}};let textureId=0;class Texture extends EventDispatcher{constructor(e=Texture.DEFAULT_IMAGE,t=Texture.DEFAULT_MAPPING,r=ClampToEdgeWrapping,n=ClampToEdgeWrapping,i=LinearFilter,o=LinearMipmapLinearFilter,a=RGBAFormat,s=UnsignedByteType,l=1,c=LinearEncoding){super(),Object.defineProperty(this,"id",{value:textureId++}),this.uuid=MathUtils.generateUUID(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=r,this.wrapT=n,this.magFilter=i,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=s,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.version=0,this.onUpdate=null}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const n=this.image;if(void 0===n.uuid&&(n.uuid=MathUtils.generateUUID()),!t&&void 0===e.images[n.uuid]){let r;if(Array.isArray(n)){r=[];for(let e=0,t=n.length;e<t;e++)n[e].isDataTexture?r.push(serializeImage(n[e].image)):r.push(serializeImage(n[e]))}else r=serializeImage(n);e.images[n.uuid]={uuid:n.uuid,url:r}}r.image=n.uuid}return t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==UVMapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||1<e.x)switch(this.wrapS){case RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case MirroredRepeatWrapping:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||1<e.y)switch(this.wrapT){case RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case MirroredRepeatWrapping:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function serializeImage(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?ImageUtils.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Texture.DEFAULT_IMAGE=void 0,Texture.DEFAULT_MAPPING=UVMapping,Texture.prototype.isTexture=!0;class Vector4{constructor(e=0,t=0,r=0,n=1){this.x=e,this.y=t,this.z=r,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){var t=this.x,r=this.y,n=this.z,i=this.w,e=e.elements;return this.x=e[0]*t+e[4]*r+e[8]*n+e[12]*i,this.y=e[1]*t+e[5]*r+e[9]*n+e[13]*i,this.z=e[2]*t+e[6]*r+e[10]*n+e[14]*i,this.w=e[3]*t+e[7]*r+e[11]*n+e[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,n,i;var o=e.elements,a=o[0],s=o[4],l=o[8],c=o[1],h=o[5],u=o[9],A=o[2],d=o[6],p=o[10];if(Math.abs(s-c)<.01&&Math.abs(l-A)<.01&&Math.abs(u-d)<.01){if(Math.abs(s+c)<.1&&Math.abs(l+A)<.1&&Math.abs(u+d)<.1&&Math.abs(a+h+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(a+1)/2,f=(h+1)/2,g=(p+1)/2,v=(s+c)/4,e=(l+A)/4,o=(u+d)/4;return f<m&&g<m?i=m<.01?(r=0,n=.707106781):(r=Math.sqrt(m),n=v/r,e/r):g<f?i=f<.01?(r=.707106781,n=0,.707106781):(n=Math.sqrt(f),r=v/n,o/n):g<.01?(r=.707106781,n=.707106781,i=0):(i=Math.sqrt(g),r=e/i,n=o/i),this.set(r,n,i,t),this}let _=Math.sqrt((d-u)*(d-u)+(l-A)*(l-A)+(c-s)*(c-s));return Math.abs(_)<.001&&(_=1),this.x=(d-u)/_,this.y=(l-A)/_,this.z=(c-s)/_,this.w=Math.acos((a+h+p-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}Vector4.prototype.isVector4=!0;class WebGLRenderTarget extends EventDispatcher{constructor(e,t,r){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new Vector4(0,0,e,t),this.scissorTest=!1,this.viewport=new Vector4(0,0,e,t),r=r||{},this.texture=new Texture(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=1,this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:LinearFilter,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0!==r.stencilBuffer&&r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,r=1){this.width===e&&this.height===t&&this.depth===r||(this.width=e,this.height=t,this.depth=r,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}WebGLRenderTarget.prototype.isWebGLRenderTarget=!0;class WebGLMultisampleRenderTarget extends WebGLRenderTarget{constructor(e,t,r){super(e,t,r),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}WebGLMultisampleRenderTarget.prototype.isWebGLMultisampleRenderTarget=!0;class Quaternion{constructor(e=0,t=0,r=0,n=1){this._x=e,this._y=t,this._z=r,this._w=n}static slerp(e,t,r,n){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),r.slerpQuaternions(e,t,n)}static slerpFlat(e,t,r,n,i,o,a){let s=r[n+0],l=r[n+1],c=r[n+2],h=r[n+3];var u=i[o+0],A=i[o+1],d=i[o+2],r=i[o+3];if(0===a)return e[t+0]=s,e[t+1]=l,e[t+2]=c,void(e[t+3]=h);if(1===a)return e[t+0]=u,e[t+1]=A,e[t+2]=d,void(e[t+3]=r);if(h!==r||s!==u||l!==A||c!==d){let e=1-a;var n=s*u+l*A+c*d+h*r,i=0<=n?1:-1,o=1-n*n;o>Number.EPSILON&&(o=Math.sqrt(o),n=Math.atan2(o,n*i),e=Math.sin(e*n)/o,a=Math.sin(a*n)/o);i=a*i;s=s*e+u*i,l=l*e+A*i,c=c*e+d*i,h=h*e+r*i,e===1-a&&(a=1/Math.sqrt(s*s+l*l+c*c+h*h),s*=a,l*=a,c*=a,h*=a)}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,r,n,i,o){var a=r[n],s=r[n+1],l=r[n+2],c=r[n+3],h=i[o],r=i[o+1],n=i[o+2],o=i[o+3];return e[t]=a*o+c*h+s*n-l*r,e[t+1]=s*o+c*r+l*h-a*n,e[t+2]=l*o+c*n+a*r-s*h,e[t+3]=c*o-a*h-s*r-l*n,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=e._x,n=e._y,i=e._z,o=e._order;const a=Math.cos,s=Math.sin;var l=a(r/2),c=a(n/2),h=a(i/2),u=s(r/2),A=s(n/2),d=s(i/2);switch(o){case"XYZ":this._x=u*c*h+l*A*d,this._y=l*A*h-u*c*d,this._z=l*c*d+u*A*h,this._w=l*c*h-u*A*d;break;case"YXZ":this._x=u*c*h+l*A*d,this._y=l*A*h-u*c*d,this._z=l*c*d-u*A*h,this._w=l*c*h+u*A*d;break;case"ZXY":this._x=u*c*h-l*A*d,this._y=l*A*h+u*c*d,this._z=l*c*d+u*A*h,this._w=l*c*h-u*A*d;break;case"ZYX":this._x=u*c*h-l*A*d,this._y=l*A*h+u*c*d,this._z=l*c*d-u*A*h,this._w=l*c*h+u*A*d;break;case"YZX":this._x=u*c*h+l*A*d,this._y=l*A*h+u*c*d,this._z=l*c*d-u*A*h,this._w=l*c*h-u*A*d;break;case"XZY":this._x=u*c*h-l*A*d,this._y=l*A*h-u*c*d,this._z=l*c*d+u*A*h,this._w=l*c*h+u*A*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){var r=t/2,t=Math.sin(r);return this._x=e.x*t,this._y=e.y*t,this._z=e.z*t,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){var t,r=e.elements,n=r[0],i=r[4],o=r[8],a=r[1],s=r[5],l=r[9],c=r[2],h=r[6],e=r[10],r=n+s+e;return 0<r?(r=.5/Math.sqrt(r+1),this._w=.25/r,this._x=(h-l)*r,this._y=(o-c)*r,this._z=(a-i)*r):s<n&&e<n?(t=2*Math.sqrt(1+n-s-e),this._w=(h-l)/t,this._x=.25*t,this._y=(i+a)/t,this._z=(o+c)/t):e<s?(t=2*Math.sqrt(1+s-n-e),this._w=(o-c)/t,this._x=(i+a)/t,this._y=.25*t,this._z=(l+h)/t):(s=2*Math.sqrt(1+e-n-s),this._w=(a-i)/s,this._x=(o+c)/s,this._y=(l+h)/s,this._z=.25*s),this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x),this._w=r,this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(MathUtils.clamp(this.dot(e),-1,1)))}rotateTowards(e,t){var r=this.angleTo(e);if(0===r)return this;r=Math.min(1,t/r);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x=this._x*(e=1/e),this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){var r=e._x,n=e._y,i=e._z,o=e._w,a=t._x,s=t._y,e=t._z,t=t._w;return this._x=r*t+o*a+n*e-i*s,this._y=n*t+o*s+i*a-r*e,this._z=i*t+o*e+r*s-n*a,this._w=o*t-r*a-n*s-i*e,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this._x,n=this._y,i=this._z,o=this._w;let a=o*e._w+r*e._x+n*e._y+i*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),1<=a)return this._w=o,this._x=r,this._y=n,this._z=i,this;var s=1-a*a;if(s<=Number.EPSILON){var l=1-t;return this._w=l*o+t*this._w,this._x=l*r+t*this._x,this._y=l*n+t*this._y,this._z=l*i+t*this._z,this.normalize(),this._onChangeCallback(),this}e=Math.sqrt(s),l=Math.atan2(e,a),s=Math.sin((1-t)*l)/e,e=Math.sin(t*l)/e;return this._w=o*s+this._w*e,this._x=r*s+this._x*e,this._y=n*s+this._y*e,this._z=i*s+this._z*e,this._onChangeCallback(),this}slerpQuaternions(e,t,r){this.copy(e).slerp(t,r)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Quaternion.prototype.isQuaternion=!0;class Vector3{constructor(e=0,t=0,r=0){this.x=e,this.y=t,this.z=r}set(e,t,r){return void 0===r&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(_quaternion$4.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(_quaternion$4.setFromAxisAngle(e,t))}applyMatrix3(e){var t=this.x,r=this.y,n=this.z,e=e.elements;return this.x=e[0]*t+e[3]*r+e[6]*n,this.y=e[1]*t+e[4]*r+e[7]*n,this.z=e[2]*t+e[5]*r+e[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){var t=this.x,r=this.y,n=this.z,i=e.elements,e=1/(i[3]*t+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*t+i[4]*r+i[8]*n+i[12])*e,this.y=(i[1]*t+i[5]*r+i[9]*n+i[13])*e,this.z=(i[2]*t+i[6]*r+i[10]*n+i[14])*e,this}applyQuaternion(e){var t=this.x,r=this.y,n=this.z,i=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*n-a*r,c=s*r+a*t-i*n,e=s*n+i*r-o*t,n=-i*t-o*r-a*n;return this.x=l*s+n*-i+c*-a-e*-o,this.y=c*s+n*-o+e*-i-l*-a,this.z=e*s+n*-a+l*-o-c*-i,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){var t=this.x,r=this.y,n=this.z,e=e.elements;return this.x=e[0]*t+e[4]*r+e[8]*n,this.y=e[1]*t+e[5]*r+e[9]*n,this.z=e[2]*t+e[6]*r+e[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){var r=e.x,n=e.y,i=e.z,o=t.x,e=t.y,t=t.z;return this.x=n*t-i*e,this.y=i*o-r*t,this.z=r*e-n*o,this}projectOnVector(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);t=e.dot(this)/t;return this.copy(e).multiplyScalar(t)}projectOnPlane(e){return _vector$c.copy(this).projectOnVector(e),this.sub(_vector$c)}reflect(e){return this.sub(_vector$c.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;t=this.dot(e)/t;return Math.acos(MathUtils.clamp(t,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){var t=this.x-e.x,r=this.y-e.y,e=this.z-e.z;return t*t+r*r+e*e}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){var n=Math.sin(t)*e;return this.x=n*Math.sin(r),this.y=Math.cos(t)*e,this.z=n*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){e=e.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),e=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=e,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}Vector3.prototype.isVector3=!0;const _vector$c=new Vector3,_quaternion$4=new Quaternion;class Box3{constructor(e=new Vector3(1/0,1/0,1/0),t=new Vector3(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(r){let n=1/0,i=1/0,o=1/0,a=-1/0,s=-1/0,l=-1/0;for(let e=0,t=r.length;e<t;e+=3){var c=r[e],h=r[e+1],u=r[e+2];c<n&&(n=c),h<i&&(i=h),u<o&&(o=u),c>a&&(a=c),h>s&&(s=h),u>l&&(l=u)}return this.min.set(n,i,o),this.max.set(a,s,l),this}setFromBufferAttribute(r){let n=1/0,i=1/0,o=1/0,a=-1/0,s=-1/0,l=-1/0;for(let e=0,t=r.count;e<t;e++){var c=r.getX(e),h=r.getY(e),u=r.getZ(e);c<n&&(n=c),h<i&&(i=h),u<o&&(o=u),c>a&&(a=c),h>s&&(s=h),u>l&&(l=u)}return this.min.set(n,i,o),this.max.set(a,s,l),this}setFromPoints(r){this.makeEmpty();for(let e=0,t=r.length;e<t;e++)this.expandByPoint(r[e]);return this}setFromCenterAndSize(e,t){t=_vector$b.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(t),this.max.copy(e).add(t),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new Vector3),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new Vector3),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),_box$3.copy(t.boundingBox),_box$3.applyMatrix4(e.matrixWorld),this.union(_box$3));var r=e.children;for(let e=0,t=r.length;e<t;e++)this.expandByObject(r[e]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new Vector3),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,_vector$b),_vector$b.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return r=0<e.normal.x?(t=e.normal.x*this.min.x,e.normal.x*this.max.x):(t=e.normal.x*this.max.x,e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){return!this.isEmpty()&&(this.getCenter(_center),_extents.subVectors(this.max,_center),_v0$2.subVectors(e.a,_center),_v1$7.subVectors(e.b,_center),_v2$3.subVectors(e.c,_center),_f0.subVectors(_v1$7,_v0$2),_f1.subVectors(_v2$3,_v1$7),_f2.subVectors(_v0$2,_v2$3),!!satForAxes([0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0],_v0$2,_v1$7,_v2$3,_extents)&&(!!satForAxes([1,0,0,0,1,0,0,0,1],_v0$2,_v1$7,_v2$3,_extents)&&(_triangleNormal.crossVectors(_f0,_f1),satForAxes([_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],_v0$2,_v1$7,_v2$3,_extents))))}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Vector3),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){const t=_vector$b.copy(e).clamp(this.min,this.max);return t.sub(e).length()}getBoundingSphere(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(_vector$b).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(_points)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Box3.prototype.isBox3=!0;const _points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],_vector$b=new Vector3,_box$3=new Box3,_v0$2=new Vector3,_v1$7=new Vector3,_v2$3=new Vector3,_f0=new Vector3,_f1=new Vector3,_f2=new Vector3,_center=new Vector3,_extents=new Vector3,_triangleNormal=new Vector3,_testAxis=new Vector3;function satForAxes(r,n,i,o,a){for(let e=0,t=r.length-3;e<=t;e+=3){_testAxis.fromArray(r,e);var s=a.x*Math.abs(_testAxis.x)+a.y*Math.abs(_testAxis.y)+a.z*Math.abs(_testAxis.z),l=n.dot(_testAxis),c=i.dot(_testAxis),h=o.dot(_testAxis);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>s)return!1}return!0}const _box$2=new Box3,_v1$6=new Vector3,_toFarthestPoint=new Vector3,_toPoint=new Vector3;class Sphere{constructor(e=new Vector3,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(r,e){const n=this.center;void 0!==e?n.copy(e):_box$2.setFromPoints(r).getCenter(n);let i=0;for(let e=0,t=r.length;e<t;e++)i=Math.max(i,n.distanceToSquared(r[e]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){var r=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new Vector3),t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Box3),this.isEmpty()?e.makeEmpty():(e.set(this.center,this.center),e.expandByScalar(this.radius)),e}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){_toPoint.subVectors(e,this.center);var t=_toPoint.lengthSq();return t>this.radius*this.radius&&(t=.5*((e=Math.sqrt(t))-this.radius),this.center.add(_toPoint.multiplyScalar(t/e)),this.radius+=t),this}union(e){return _toFarthestPoint.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(_v1$6.copy(e.center).add(_toFarthestPoint)),this.expandByPoint(_v1$6.copy(e.center).sub(_toFarthestPoint)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const _vector$a=new Vector3,_segCenter=new Vector3,_segDir=new Vector3,_diff=new Vector3,_edge1=new Vector3,_edge2=new Vector3,_normal$1=new Vector3;class Ray{constructor(e=new Vector3,t=new Vector3(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new Vector3),t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,_vector$a)),this}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new Vector3),t.subVectors(e,this.origin);e=t.dot(this.direction);return e<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(e).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){var t=_vector$a.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(_vector$a.copy(this.direction).multiplyScalar(t).add(this.origin),_vector$a.distanceToSquared(e))}distanceSqToSegment(e,t,r,n){_segCenter.copy(e).add(t).multiplyScalar(.5),_segDir.copy(t).sub(e).normalize(),_diff.copy(this.origin).sub(_segCenter);var i=.5*e.distanceTo(t),o=-this.direction.dot(_segDir),a=_diff.dot(this.direction),s=-_diff.dot(_segDir),e=_diff.lengthSq(),t=Math.abs(1-o*o);let l,c,h,u;return h=0<t?(l=o*s-a,c=o*a-s,u=i*t,0<=l?c>=-u?c<=u?(t=1/t,l*=t,c*=t,l*(l+o*c+2*a)+c*(o*l+c+2*s)+e):(c=i,l=Math.max(0,-(o*c+a)),-l*l+c*(c+2*s)+e):(c=-i,l=Math.max(0,-(o*c+a)),-l*l+c*(c+2*s)+e):c<=-u?(l=Math.max(0,-(-o*i+a)),c=0<l?-i:Math.min(Math.max(-i,-s),i),-l*l+c*(c+2*s)+e):c<=u?(l=0,c=Math.min(Math.max(-i,-s),i),c*(c+2*s)+e):(l=Math.max(0,-(o*i+a)),c=0<l?i:Math.min(Math.max(-i,-s),i),-l*l+c*(c+2*s)+e)):(c=0<o?-i:i,l=Math.max(0,-(o*c+a)),-l*l+c*(c+2*s)+e),r&&r.copy(this.direction).multiplyScalar(l).add(this.origin),n&&n.copy(_segDir).multiplyScalar(c).add(_segCenter),h}intersectSphere(e,t){_vector$a.subVectors(e.center,this.origin);var r=_vector$a.dot(this.direction),n=_vector$a.dot(_vector$a)-r*r,e=e.radius*e.radius;if(e<n)return null;e=Math.sqrt(e-n),n=r-e,e=r+e;return n<0&&e<0?null:n<0?this.at(e,t):this.at(n,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;t=-(this.origin.dot(e.normal)+e.constant)/t;return 0<=t?t:null}intersectPlane(e,t){e=this.distanceToPlane(e);return null===e?null:this.at(e,t)}intersectsPlane(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,n,i,o,a,s;var l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return n=0<=l?(r=(e.min.x-u.x)*l,(e.max.x-u.x)*l):(r=(e.max.x-u.x)*l,(e.min.x-u.x)*l),o=0<=c?(i=(e.min.y-u.y)*c,(e.max.y-u.y)*c):(i=(e.max.y-u.y)*c,(e.min.y-u.y)*c),r>o||i>n?null:((i>r||r!=r)&&(r=i),(o<n||n!=n)&&(n=o),s=0<=h?(a=(e.min.z-u.z)*h,(e.max.z-u.z)*h):(a=(e.max.z-u.z)*h,(e.min.z-u.z)*h),r>s||a>n?null:((a>r||r!=r)&&(r=a),(s<n||n!=n)&&(n=s),n<0?null:this.at(0<=r?r:n,t)))}intersectsBox(e){return null!==this.intersectBox(e,_vector$a)}intersectTriangle(e,t,r,n,i){_edge1.subVectors(t,e),_edge2.subVectors(r,e),_normal$1.crossVectors(_edge1,_edge2);let o=this.direction.dot(_normal$1),a;if(0<o){if(n)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}_diff.subVectors(this.origin,e);n=a*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(n<0)return null;e=a*this.direction.dot(_edge1.cross(_diff));if(e<0)return null;if(n+e>o)return null;e=-a*_diff.dot(_normal$1);return e<0?null:this.at(e/o,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Matrix4{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,r,n,i,o,a,s,l,c,h,u,A,d,p,m){const f=this.elements;return f[0]=e,f[4]=t,f[8]=r,f[12]=n,f[1]=i,f[5]=o,f[9]=a,f[13]=s,f[2]=l,f[6]=c,f[10]=h,f[14]=u,f[3]=A,f[7]=d,f[11]=p,f[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Matrix4).fromArray(this.elements)}copy(e){const t=this.elements;e=e.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){e=e.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements;var r=e.elements,n=1/_v1$5.setFromMatrixColumn(e,0).length(),i=1/_v1$5.setFromMatrixColumn(e,1).length(),e=1/_v1$5.setFromMatrixColumn(e,2).length();return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=0,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=0,t[8]=r[8]*e,t[9]=r[9]*e,t[10]=r[10]*e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements;var r,n,i,o,a,s,l,c,h,u,A,d=e.x,p=e.y,m=e.z,f=Math.cos(d),g=Math.sin(d),v=Math.cos(p),_=Math.sin(p),d=Math.cos(m),p=Math.sin(m);return"XYZ"===e.order?(r=f*d,i=f*p,n=g*d,m=g*p,t[0]=v*d,t[4]=-v*p,t[8]=_,t[1]=i+n*_,t[5]=r-m*_,t[9]=-g*v,t[2]=m-r*_,t[6]=n+i*_,t[10]=f*v):"YXZ"===e.order?(o=v*d,r=v*p,n=_*d,i=_*p,t[0]=o+i*g,t[4]=n*g-r,t[8]=f*_,t[1]=f*p,t[5]=f*d,t[9]=-g,t[2]=r*g-n,t[6]=i+o*g,t[10]=f*v):"ZXY"===e.order?(l=v*d,o=v*p,a=_*d,s=_*p,t[0]=l-s*g,t[4]=-f*p,t[8]=a+o*g,t[1]=o+a*g,t[5]=f*d,t[9]=s-l*g,t[2]=-f*_,t[6]=g,t[10]=f*v):"ZYX"===e.order?(a=f*d,s=f*p,c=g*d,l=g*p,t[0]=v*d,t[4]=c*_-s,t[8]=a*_+l,t[1]=v*p,t[5]=l*_+a,t[9]=s*_-c,t[2]=-_,t[6]=g*v,t[10]=f*v):"YZX"===e.order?(u=f*v,c=f*_,h=g*v,A=g*_,t[0]=v*d,t[4]=A-u*p,t[8]=h*p+c,t[1]=p,t[5]=f*d,t[9]=-g*d,t[2]=-_*d,t[6]=c*p+h,t[10]=u-A*p):"XZY"===e.order&&(h=f*v,u=f*_,A=g*v,e=g*_,t[0]=v*d,t[4]=-p,t[8]=_*d,t[1]=h*p+e,t[5]=f*d,t[9]=u*p-A,t[2]=A*p-u,t[6]=g*d,t[10]=e*p+h),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(_zero,e,_one)}lookAt(e,t,r){const n=this.elements;return _z.subVectors(e,t),0===_z.lengthSq()&&(_z.z=1),_z.normalize(),_x.crossVectors(r,_z),0===_x.lengthSq()&&(1===Math.abs(r.z)?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(r,_z)),_x.normalize(),_y.crossVectors(_z,_x),n[0]=_x.x,n[4]=_y.x,n[8]=_z.x,n[1]=_x.y,n[5]=_y.y,n[9]=_z.y,n[2]=_x.z,n[6]=_y.z,n[10]=_z.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){var r=e.elements,n=t.elements;const i=this.elements;var o=r[0],a=r[4],s=r[8],l=r[12],c=r[1],h=r[5],u=r[9],A=r[13],d=r[2],p=r[6],m=r[10],f=r[14],g=r[3],v=r[7],_=r[11],y=r[15],w=n[0],x=n[4],b=n[8],T=n[12],E=n[1],B=n[5],C=n[9],S=n[13],M=n[2],N=n[6],L=n[10],F=n[14],e=n[3],t=n[7],r=n[11],n=n[15];return i[0]=o*w+a*E+s*M+l*e,i[4]=o*x+a*B+s*N+l*t,i[8]=o*b+a*C+s*L+l*r,i[12]=o*T+a*S+s*F+l*n,i[1]=c*w+h*E+u*M+A*e,i[5]=c*x+h*B+u*N+A*t,i[9]=c*b+h*C+u*L+A*r,i[13]=c*T+h*S+u*F+A*n,i[2]=d*w+p*E+m*M+f*e,i[6]=d*x+p*B+m*N+f*t,i[10]=d*b+p*C+m*L+f*r,i[14]=d*T+p*S+m*F+f*n,i[3]=g*w+v*E+_*M+y*e,i[7]=g*x+v*B+_*N+y*t,i[11]=g*b+v*C+_*L+y*r,i[15]=g*T+v*S+_*F+y*n,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){var e=this.elements,t=e[0],r=e[4],n=e[8],i=e[12],o=e[1],a=e[5],s=e[9],l=e[13],c=e[2],h=e[6],u=e[10],A=e[14];return e[3]*(+i*s*h-n*l*h-i*a*u+r*l*u+n*a*A-r*s*A)+e[7]*(+t*s*A-t*l*u+i*o*u-n*o*A+n*l*c-i*s*c)+e[11]*(+t*l*h-t*a*A-i*o*h+r*o*A+i*a*c-r*l*c)+e[15]*(-n*a*c-t*s*h+t*a*u+n*o*h-r*o*u+r*s*c)}transpose(){const e=this.elements;var t=e[1];return e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8],h=e[9],u=e[10],A=e[11],d=e[12],p=e[13],m=e[14],f=e[15],g=h*m*l-p*u*l+p*s*A-a*m*A-h*s*f+a*u*f,v=d*u*l-c*m*l-d*s*A+o*m*A+c*s*f-o*u*f,_=c*p*l-d*h*l+d*a*A-o*p*A-c*a*f+o*h*f,y=d*h*s-c*p*s-d*a*u+o*p*u+c*a*m-o*h*m;var w=t*g+r*v+n*_+i*y;if(0==w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);w=1/w;return e[0]=g*w,e[1]=(p*u*i-h*m*i-p*n*A+r*m*A+h*n*f-r*u*f)*w,e[2]=(a*m*i-p*s*i+p*n*l-r*m*l-a*n*f+r*s*f)*w,e[3]=(h*s*i-a*u*i-h*n*l+r*u*l+a*n*A-r*s*A)*w,e[4]=v*w,e[5]=(c*m*i-d*u*i+d*n*A-t*m*A-c*n*f+t*u*f)*w,e[6]=(d*s*i-o*m*i-d*n*l+t*m*l+o*n*f-t*s*f)*w,e[7]=(o*u*i-c*s*i+c*n*l-t*u*l-o*n*A+t*s*A)*w,e[8]=_*w,e[9]=(d*h*i-c*p*i-d*r*A+t*p*A+c*r*f-t*h*f)*w,e[10]=(o*p*i-d*a*i+d*r*l-t*p*l-o*r*f+t*a*f)*w,e[11]=(c*a*i-o*h*i-c*r*l+t*h*l+o*r*A-t*a*A)*w,e[12]=y*w,e[13]=(c*p*n-d*h*n+d*r*u-t*p*u-c*r*m+t*h*m)*w,e[14]=(d*a*n-o*p*n-d*r*s+t*p*s+o*r*m-t*a*m)*w,e[15]=(o*h*n-c*a*n+c*r*s-t*h*s-o*r*u+t*a*u)*w,this}scale(e){const t=this.elements;var r=e.x,n=e.y,e=e.z;return t[0]*=r,t[4]*=n,t[8]*=e,t[1]*=r,t[5]*=n,t[9]*=e,t[2]*=r,t[6]*=n,t[10]*=e,t[3]*=r,t[7]*=n,t[11]*=e,this}getMaxScaleOnAxis(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,e))}makeTranslation(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){var t=Math.cos(e),e=Math.sin(e);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this}makeRotationY(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this}makeRotationZ(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){var r=Math.cos(t),n=Math.sin(t),i=1-r,o=e.x,a=e.y,s=e.z,t=i*o,e=i*a;return this.set(t*o+r,t*a-n*s,t*s+n*a,0,t*a+n*s,e*a+r,e*s-n*o,0,t*s-n*a,e*s+n*o,i*s*s+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r){return this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1),this}compose(e,t,r){const n=this.elements;var i=t._x,o=t._y,a=t._z,s=t._w,l=i+i,c=o+o,h=a+a,u=i*l,A=i*c,d=i*h,t=o*c,i=o*h,o=a*h,a=s*l,l=s*c,c=s*h,s=r.x,h=r.y,r=r.z;return n[0]=(1-(t+o))*s,n[1]=(A+c)*s,n[2]=(d-l)*s,n[3]=0,n[4]=(A-c)*h,n[5]=(1-(u+o))*h,n[6]=(i+a)*h,n[7]=0,n[8]=(d+l)*r,n[9]=(i-a)*r,n[10]=(1-(u+t))*r,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,r){var n=this.elements;let i=_v1$5.set(n[0],n[1],n[2]).length();var o=_v1$5.set(n[4],n[5],n[6]).length(),a=_v1$5.set(n[8],n[9],n[10]).length();this.determinant()<0&&(i=-i),e.x=n[12],e.y=n[13],e.z=n[14],_m1$2.copy(this);var s=1/i,e=1/o,n=1/a;return _m1$2.elements[0]*=s,_m1$2.elements[1]*=s,_m1$2.elements[2]*=s,_m1$2.elements[4]*=e,_m1$2.elements[5]*=e,_m1$2.elements[6]*=e,_m1$2.elements[8]*=n,_m1$2.elements[9]*=n,_m1$2.elements[10]*=n,t.setFromRotationMatrix(_m1$2),r.x=i,r.y=o,r.z=a,this}makePerspective(e,t,r,n,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements;var s=2*i/(r-n),l=(t+e)/(t-e),r=(r+n)/(r-n),n=-(o+i)/(o-i),o=-2*o*i/(o-i);return a[0]=2*i/(t-e),a[4]=0,a[8]=l,a[12]=0,a[1]=0,a[5]=s,a[9]=r,a[13]=0,a[2]=0,a[6]=0,a[10]=n,a[14]=o,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,r,n,i,o){const a=this.elements;var s=1/(t-e),l=1/(r-n),c=1/(o-i),e=(t+e)*s,n=(r+n)*l,i=(o+i)*c;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-e,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-n,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-i,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){var t=this.elements,r=e.elements;for(let e=0;e<16;e++)if(t[e]!==r[e])return!1;return!0}fromArray(t,r=0){for(let e=0;e<16;e++)this.elements[e]=t[e+r];return this}toArray(e=[],t=0){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}Matrix4.prototype.isMatrix4=!0;const _v1$5=new Vector3,_m1$2=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y=new Vector3,_z=new Vector3,_matrix$1=new Matrix4,_quaternion$3=new Quaternion;class Euler{constructor(e=0,t=0,r=0,n=Euler.DefaultOrder){this._x=e,this._y=t,this._z=r,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._order=n||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t,r){const n=MathUtils.clamp;var e=e.elements,i=e[0],o=e[4],a=e[8],s=e[1],l=e[5],c=e[9],h=e[2],u=e[6],A=e[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(n(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,A),this._z=Math.atan2(-o,i)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-n(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,A),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-h,i),this._z=0);break;case"ZXY":this._x=Math.asin(n(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,A),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(s,i));break;case"ZYX":this._y=Math.asin(-n(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,A),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(n(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,i)):(this._x=0,this._y=Math.atan2(a,A));break;case"XZY":this._z=Math.asin(-n(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-c,A),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!1!==r&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return _matrix$1.makeRotationFromQuaternion(e),this.setFromRotationMatrix(_matrix$1,t,r)}setFromVector3(e,t){return this.set(e.x,e.y,e.z,t||this._order)}reorder(e){return _quaternion$3.setFromEuler(this),this.setFromQuaternion(_quaternion$3,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Euler.prototype.isEuler=!0,Euler.DefaultOrder="XYZ",Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Layers{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}let _object3DId=0;const _v1$4=new Vector3,_q1=new Quaternion,_m1$1=new Matrix4,_target=new Vector3,_position$3=new Vector3,_scale$2=new Vector3,_quaternion$2=new Quaternion,_xAxis=new Vector3(1,0,0),_yAxis=new Vector3(0,1,0),_zAxis=new Vector3(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"};function Object3D(){Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=MathUtils.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();var e=new Vector3;const t=new Euler,r=new Quaternion;var n=new Vector3(1,1,1);t._onChange(function(){r.setFromEuler(t,!1)}),r._onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}Object3D.DefaultUp=new Vector3(0,1,0),Object3D.DefaultMatrixAutoUpdate=!0,Object3D.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Object3D,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return _q1.setFromAxisAngle(e,t),this.quaternion.multiply(_q1),this},rotateOnWorldAxis:function(e,t){return _q1.setFromAxisAngle(e,t),this.quaternion.premultiply(_q1),this},rotateX:function(e){return this.rotateOnAxis(_xAxis,e)},rotateY:function(e){return this.rotateOnAxis(_yAxis,e)},rotateZ:function(e){return this.rotateOnAxis(_zAxis,e)},translateOnAxis:function(e,t){return _v1$4.copy(e).applyQuaternion(this.quaternion),this.position.add(_v1$4.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(_xAxis,e)},translateY:function(e){return this.translateOnAxis(_yAxis,e)},translateZ:function(e){return this.translateOnAxis(_zAxis,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(_m1$1.copy(this.matrixWorld).invert())},lookAt:function(e,t,r){e.isVector3?_target.copy(e):_target.set(e,t,r);r=this.parent;this.updateWorldMatrix(!0,!1),_position$3.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1.lookAt(_position$3,_target,this.up):_m1$1.lookAt(_target,_position$3,this.up),this.quaternion.setFromRotationMatrix(_m1$1),r&&(_m1$1.extractRotation(r.matrixWorld),_q1.setFromRotationMatrix(_m1$1),this.quaternion.premultiply(_q1.invert()))},add:function(e){if(1<arguments.length){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",e):e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),(e.parent=this).children.push(e),e.dispatchEvent(_addedEvent)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this},remove:function(e){if(1<arguments.length){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(_removedEvent)),this},clear:function(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(_removedEvent)}return this.children.length=0,this},attach:function(e){return this.updateWorldMatrix(!0,!1),_m1$1.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),_m1$1.multiply(e.parent.matrixWorld)),e.applyMatrix4(_m1$1),this.add(e),e.updateWorldMatrix(!1,!0),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(r,n){if(this[r]===n)return this;for(let e=0,t=this.children.length;e<t;e++){const o=this.children[e];var i=o.getObjectByProperty(r,n);if(void 0!==i)return i}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Vector3),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new Quaternion),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,e,_scale$2),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new Vector3),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,_quaternion$2,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Vector3),this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(r){r(this);const n=this.children;for(let e=0,t=n.length;e<t;e++)n[e].traverse(r)},traverseVisible:function(r){if(!1!==this.visible){r(this);const n=this.children;for(let e=0,t=n.length;e<t;e++)n[e].traverseVisible(r)}},traverseAncestors:function(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(r){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||r)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),r=!(this.matrixWorldNeedsUpdate=!1));const n=this.children;for(let e=0,t=n.length;e<t;e++)n[e].updateMatrixWorld(r)},updateWorldMatrix:function(e,t){const r=this.parent;if(!0===e&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const n=this.children;for(let e=0,t=n.length;e<t;e++)n[e].updateWorldMatrix(!1,!0)}},toJSON:function(r){var e,t,n,i,o,a=void 0===r||"string"==typeof r;const s={};a&&(r={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},s.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const l={};function c(e,t){return void 0===e[t.uuid]&&(e[t.uuid]=t.toJSON(r)),t.uuid}if(l.uuid=this.uuid,l.type=this.type,""!==this.name&&(l.name=this.name),!0===this.castShadow&&(l.castShadow=!0),!0===this.receiveShadow&&(l.receiveShadow=!0),!1===this.visible&&(l.visible=!1),!1===this.frustumCulled&&(l.frustumCulled=!1),0!==this.renderOrder&&(l.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(l.userData=this.userData),l.layers=this.layers.mask,l.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(l.matrixAutoUpdate=!1),this.isInstancedMesh&&(l.type="InstancedMesh",l.count=this.count,l.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(l.instanceColor=this.instanceColor.toJSON())),this.isMesh||this.isLine||this.isPoints){l.geometry=c(r.geometries,this.geometry);var h=this.geometry.parameters;if(void 0!==h&&void 0!==h.shapes){var u=h.shapes;if(Array.isArray(u))for(let e=0,t=u.length;e<t;e++){var A=u[e];c(r.shapes,A)}else c(r.shapes,u)}}if(this.isSkinnedMesh&&(l.bindMode=this.bindMode,l.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(c(r.skeletons,this.skeleton),l.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const m=[];for(let e=0,t=this.material.length;e<t;e++)m.push(c(r.materials,this.material[e]));l.material=m}else l.material=c(r.materials,this.material);if(0<this.children.length){l.children=[];for(let e=0;e<this.children.length;e++)l.children.push(this.children[e].toJSON(r).object)}if(0<this.animations.length){l.animations=[];for(let e=0;e<this.animations.length;e++){var d=this.animations[e];l.animations.push(c(r.animations,d))}}return a&&(e=p(r.geometries),t=p(r.materials),n=p(r.textures),i=p(r.images),o=p(r.shapes),h=p(r.skeletons),a=p(r.animations),0<e.length&&(s.geometries=e),0<t.length&&(s.materials=t),0<n.length&&(s.textures=n),0<i.length&&(s.images=i),0<o.length&&(s.shapes=o),0<h.length&&(s.skeletons=h),0<a.length&&(s.animations=a)),s.object=l,s;function p(e){const t=[];for(const r in e){const n=e[r];delete n.metadata,t.push(n)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const r=t.children[e];this.add(r.clone())}return this}});const _vector1=new Vector3,_vector2$1=new Vector3,_normalMatrix=new Matrix3;class Plane{constructor(e=new Vector3(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,n){return this.normal.set(e,t,r),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){t=_vector1.subVectors(r,t).cross(_vector2$1.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(t,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new Vector3),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new Vector3);var r=e.delta(_vector1),n=this.normal.dot(r);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;n=-(e.start.dot(this.normal)+this.constant)/n;return n<0||1<n?null:t.copy(r).multiplyScalar(n).add(e.start)}intersectsLine(e){var t=this.distanceToPoint(e.start),e=this.distanceToPoint(e.end);return t<0&&0<e||e<0&&0<t}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new Vector3),e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){t=t||_normalMatrix.getNormalMatrix(e);const r=this.coplanarPoint(_vector1).applyMatrix4(e);t=this.normal.applyMatrix3(t).normalize();return this.constant=-r.dot(t),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Plane.prototype.isPlane=!0;const _v0$1=new Vector3,_v1$3=new Vector3,_v2$2=new Vector3,_v3$1=new Vector3,_vab=new Vector3,_vac=new Vector3,_vbc=new Vector3,_vap=new Vector3,_vbp=new Vector3,_vcp=new Vector3;class Triangle{constructor(e=new Vector3,t=new Vector3,r=new Vector3){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,n){void 0===n&&(console.warn("THREE.Triangle: .getNormal() target is now required"),n=new Vector3),n.subVectors(r,t),_v0$1.subVectors(e,t),n.cross(_v0$1);t=n.lengthSq();return 0<t?n.multiplyScalar(1/Math.sqrt(t)):n.set(0,0,0)}static getBarycoord(e,t,r,n,i){_v0$1.subVectors(n,t),_v1$3.subVectors(r,t),_v2$2.subVectors(e,t);var o=_v0$1.dot(_v0$1),a=_v0$1.dot(_v1$3),n=_v0$1.dot(_v2$2),r=_v1$3.dot(_v1$3),e=_v1$3.dot(_v2$2),t=o*r-a*a;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new Vector3),0==t)return i.set(-2,-1,-1);t=1/t,r=(r*n-a*e)*t,t*=o*e-a*n;return i.set(1-r-t,t,r)}static containsPoint(e,t,r,n){return this.getBarycoord(e,t,r,n,_v3$1),0<=_v3$1.x&&0<=_v3$1.y&&_v3$1.x+_v3$1.y<=1}static getUV(e,t,r,n,i,o,a,s){return this.getBarycoord(e,t,r,n,_v3$1),s.set(0,0),s.addScaledVector(i,_v3$1.x),s.addScaledVector(o,_v3$1.y),s.addScaledVector(a,_v3$1.z),s}static isFrontFacing(e,t,r,n){return _v0$1.subVectors(r,t),_v1$3.subVectors(e,t),_v0$1.cross(_v1$3).dot(n)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,n){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[n]),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),.5*_v0$1.cross(_v1$3).length()}getMidpoint(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new Vector3),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Triangle.getNormal(this.a,this.b,this.c,e)}getPlane(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Plane),e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Triangle.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,r,n,i){return Triangle.getUV(e,this.a,this.b,this.c,t,r,n,i)}containsPoint(e){return Triangle.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Triangle.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new Vector3);var r=this.a,n=this.b,i=this.c;let o,a;_vab.subVectors(n,r),_vac.subVectors(i,r),_vap.subVectors(e,r);var s=_vab.dot(_vap),l=_vac.dot(_vap);if(s<=0&&l<=0)return t.copy(r);_vbp.subVectors(e,n);var c=_vab.dot(_vbp),h=_vac.dot(_vbp);if(0<=c&&h<=c)return t.copy(n);var u=s*h-c*l;if(u<=0&&0<=s&&c<=0)return o=s/(s-c),t.copy(r).addScaledVector(_vab,o);_vcp.subVectors(e,i);var A=_vab.dot(_vcp),e=_vac.dot(_vcp);if(0<=e&&A<=e)return t.copy(i);s=A*l-s*e;if(s<=0&&0<=l&&e<=0)return a=l/(l-e),t.copy(r).addScaledVector(_vac,a);l=c*e-A*h;if(l<=0&&0<=h-c&&0<=A-e)return _vbc.subVectors(i,n),a=(h-c)/(h-c+(A-e)),t.copy(n).addScaledVector(_vbc,a);l=1/(l+s+u);return o=s*l,a=u*l,t.copy(r).addScaledVector(_vab,o).addScaledVector(_vac,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let materialId=0;function Material(){Object.defineProperty(this,"id",{value:materialId++}),this.uuid=MathUtils.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=NormalBlending,this.side=FrontSide,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}Material.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Material,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(e){if(void 0!==e)for(const r in e){var t=e[r];if(void 0!==t)if("shading"!==r){const n=this[r];void 0!==n?n&&n.isColor?n.set(t):n&&n.isVector3&&t&&t.isVector3?n.copy(t):this[r]=t:console.warn("THREE."+this.type+": '"+r+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===FlatShading;else console.warn("THREE.Material: '"+r+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(e){const t=[];for(const r in e){const n=e[r];delete n.metadata,t.push(n)}return t}return r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(r.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,r.reflectivity=this.reflectivity,r.refractionRatio=this.refractionRatio,void 0!==this.combine&&(r.combine=this.combine),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(r.size=this.size),null!==this.shadowSide&&(r.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(r.blending=this.blending),this.side!==FrontSide&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.colorWrite=this.colorWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),0<this.alphaTest&&(r.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(r.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),1<this.wireframeLinewidth&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.morphNormals&&(r.morphNormals=!0),!0===this.skinning&&(r.skinning=!0),!0===this.flatShading&&(r.flatShading=this.flatShading),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),t&&(t=n(e.textures),e=n(e.images),0<t.length&&(r.textures=t),0<e.length&&(r.images=e)),r},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(null!==t){var n=t.length;r=new Array(n);for(let e=0;e!==n;++e)r[e]=t[e].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Material.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}});const _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(e,t,r){return r<0&&(r+=1),1<r&&--r,r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}function SRGBToLinear(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function LinearToSRGB(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class Color{constructor(e,t,r){return void 0===t&&void 0===r?this.set(e):this.setRGB(e,t,r)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,r){return this.r=e,this.g=t,this.b=r,this}setHSL(e,t,r){return e=MathUtils.euclideanModulo(e,1),t=MathUtils.clamp(t,0,1),r=MathUtils.clamp(r,0,1),0===t?this.r=this.g=this.b=r:(this.r=hue2rgb(t=2*r-(r=r<=.5?r*(1+t):r+t-r*t),r,e+1/3),this.g=hue2rgb(t,r,e),this.b=hue2rgb(t,r,e-1/3)),this}setStyle(t){function r(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let e;var i=n[1],o=n[2];switch(i){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,r(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,r(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){var a=parseFloat(e[1])/360,s=parseInt(e[2],10)/100,l=parseInt(e[3],10)/100;return r(e[4]),this.setHSL(a,s,l)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const e=n[1];i=e.length;if(3===i)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===i)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return t&&0<t.length?this.setColorName(t):this}setColorName(e){var t=_colorKeywords[e];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){t=0<t?1/t:1;return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=SRGBToLinear(e.r),this.g=SRGBToLinear(e.g),this.b=SRGBToLinear(e.b),this}copyLinearToSRGB(e){return this.r=LinearToSRGB(e.r),this.g=LinearToSRGB(e.g),this.b=LinearToSRGB(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t=this.r,r=this.g,n=this.b,i=Math.max(t,r,n),o=Math.min(t,r,n);let a,s;var l=(o+i)/2;if(o===i)a=0,s=0;else{var c=i-o;switch(s=l<=.5?c/(i+o):c/(2-i-o),i){case t:a=(r-n)/c+(r<n?6:0);break;case r:a=(n-t)/c+2;break;case n:a=(t-r)/c+4}a/=6}return e.h=a,e.s=s,e.l=l,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,r){return this.getHSL(_hslA),_hslA.h+=e,_hslA.s+=t,_hslA.l+=r,this.setHSL(_hslA.h,_hslA.s,_hslA.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(_hslA),e.getHSL(_hslB);var r=MathUtils.lerp(_hslA.h,_hslB.h,t),e=MathUtils.lerp(_hslA.s,_hslB.s,t),t=MathUtils.lerp(_hslA.l,_hslB.l,t);return this.setHSL(r,e,t),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Color.NAMES=_colorKeywords,Color.prototype.isColor=!0,Color.prototype.r=1,Color.prototype.g=1,Color.prototype.b=1;class MeshBasicMaterial extends Material{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this}}MeshBasicMaterial.prototype.isMeshBasicMaterial=!0;const _vector$9=new Vector3,_vector2=new Vector2;function BufferAttribute(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===r,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0}function Int8BufferAttribute(e,t,r){BufferAttribute.call(this,new Int8Array(e),t,r)}function Uint8BufferAttribute(e,t,r){BufferAttribute.call(this,new Uint8Array(e),t,r)}function Uint8ClampedBufferAttribute(e,t,r){BufferAttribute.call(this,new Uint8ClampedArray(e),t,r)}function Int16BufferAttribute(e,t,r){BufferAttribute.call(this,new Int16Array(e),t,r)}function Uint16BufferAttribute(e,t,r){BufferAttribute.call(this,new Uint16Array(e),t,r)}function Int32BufferAttribute(e,t,r){BufferAttribute.call(this,new Int32Array(e),t,r)}function Uint32BufferAttribute(e,t,r){BufferAttribute.call(this,new Uint32Array(e),t,r)}function Float16BufferAttribute(e,t,r){BufferAttribute.call(this,new Uint16Array(e),t,r)}function Float32BufferAttribute(e,t,r){BufferAttribute.call(this,new Float32Array(e),t,r)}function Float64BufferAttribute(e,t,r){BufferAttribute.call(this,new Float64Array(e),t,r)}function arrayMax(r){if(0===r.length)return-1/0;let n=r[0];for(let e=1,t=r.length;e<t;++e)r[e]>n&&(n=r[e]);return n}Object.defineProperty(BufferAttribute.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(BufferAttribute.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(r,n,i){r*=this.itemSize,i*=n.itemSize;for(let e=0,t=this.itemSize;e<t;e++)this.array[r+e]=n.array[i+e];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(r){const n=this.array;let i=0;for(let t=0,e=r.length;t<e;t++){let e=r[t];void 0===e&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",t),e=new Color),n[i++]=e.r,n[i++]=e.g,n[i++]=e.b}return this},copyVector2sArray:function(r){const n=this.array;let i=0;for(let t=0,e=r.length;t<e;t++){let e=r[t];void 0===e&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",t),e=new Vector2),n[i++]=e.x,n[i++]=e.y}return this},copyVector3sArray:function(r){const n=this.array;let i=0;for(let t=0,e=r.length;t<e;t++){let e=r[t];void 0===e&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",t),e=new Vector3),n[i++]=e.x,n[i++]=e.y,n[i++]=e.z}return this},copyVector4sArray:function(r){const n=this.array;let i=0;for(let t=0,e=r.length;t<e;t++){let e=r[t];void 0===e&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",t),e=new Vector4),n[i++]=e.x,n[i++]=e.y,n[i++]=e.z,n[i++]=e.w}return this},applyMatrix3:function(r){if(2===this.itemSize)for(let e=0,t=this.count;e<t;e++)_vector2.fromBufferAttribute(this,e),_vector2.applyMatrix3(r),this.setXY(e,_vector2.x,_vector2.y);else if(3===this.itemSize)for(let e=0,t=this.count;e<t;e++)_vector$9.fromBufferAttribute(this,e),_vector$9.applyMatrix3(r),this.setXYZ(e,_vector$9.x,_vector$9.y,_vector$9.z);return this},applyMatrix4:function(r){for(let e=0,t=this.count;e<t;e++)_vector$9.x=this.getX(e),_vector$9.y=this.getY(e),_vector$9.z=this.getZ(e),_vector$9.applyMatrix4(r),this.setXYZ(e,_vector$9.x,_vector$9.y,_vector$9.z);return this},applyNormalMatrix:function(r){for(let e=0,t=this.count;e<t;e++)_vector$9.x=this.getX(e),_vector$9.y=this.getY(e),_vector$9.z=this.getZ(e),_vector$9.applyNormalMatrix(r),this.setXYZ(e,_vector$9.x,_vector$9.y,_vector$9.z);return this},transformDirection:function(r){for(let e=0,t=this.count;e<t;e++)_vector$9.x=this.getX(e),_vector$9.y=this.getY(e),_vector$9.z=this.getZ(e),_vector$9.transformDirection(r),this.setXYZ(e,_vector$9.x,_vector$9.y,_vector$9.z);return this},set:function(e,t=0){return this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this},setXYZW:function(e,t,r,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==StaticDrawUsage&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}),Int8BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int8BufferAttribute.prototype.constructor=Int8BufferAttribute,Uint8BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint8BufferAttribute.prototype.constructor=Uint8BufferAttribute,Uint8ClampedBufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint8ClampedBufferAttribute.prototype.constructor=Uint8ClampedBufferAttribute,Int16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int16BufferAttribute.prototype.constructor=Int16BufferAttribute,Uint16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint16BufferAttribute.prototype.constructor=Uint16BufferAttribute,Int32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int32BufferAttribute.prototype.constructor=Int32BufferAttribute,Uint32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint32BufferAttribute.prototype.constructor=Uint32BufferAttribute,Float16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),(Float16BufferAttribute.prototype.constructor=Float16BufferAttribute).prototype.isFloat16BufferAttribute=!0,Float32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float32BufferAttribute.prototype.constructor=Float32BufferAttribute,Float64BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float64BufferAttribute.prototype.constructor=Float64BufferAttribute;const TYPED_ARRAYS={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function getTypedArray(e,t){return new TYPED_ARRAYS[e](t)}let _id=0;const _m1=new Matrix4,_obj=new Object3D,_offset=new Vector3,_box$1=new Box3,_boxMorphTargets=new Box3,_vector$8=new Vector3;function BufferGeometry(){Object.defineProperty(this,"id",{value:_id++}),this.uuid=MathUtils.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}BufferGeometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:BufferGeometry,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){return Array.isArray(e)?this.index=new(65535<arrayMax(e)?Uint32BufferAttribute:Uint16BufferAttribute)(e,1):this.index=e,this},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},hasAttribute:function(e){return void 0!==this.attributes[e]},addGroup:function(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;var n;void 0!==r&&(n=(new Matrix3).getNormalMatrix(e),r.applyNormalMatrix(n),r.needsUpdate=!0);const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return _m1.makeRotationX(e),this.applyMatrix4(_m1),this},rotateY:function(e){return _m1.makeRotationY(e),this.applyMatrix4(_m1),this},rotateZ:function(e){return _m1.makeRotationZ(e),this.applyMatrix4(_m1),this},translate:function(e,t,r){return _m1.makeTranslation(e,t,r),this.applyMatrix4(_m1),this},scale:function(e,t,r){return _m1.makeScale(e,t,r),this.applyMatrix4(_m1),this},lookAt:function(e){return _obj.lookAt(e),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this},setFromPoints:function(r){const n=[];for(let e=0,t=r.length;e<t;e++){var i=r[e];n.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Float32BufferAttribute(n,3)),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3);var e=this.attributes.position,r=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),r)for(let e=0,t=r.length;e<t;e++){var n=r[e];_box$1.setFromBufferAttribute(n),this.morphTargetsRelative?(_vector$8.addVectors(this.boundingBox.min,_box$1.min),this.boundingBox.expandByPoint(_vector$8),_vector$8.addVectors(this.boundingBox.max,_box$1.max),this.boundingBox.expandByPoint(_vector$8)):(this.boundingBox.expandByPoint(_box$1.min),this.boundingBox.expandByPoint(_box$1.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);var n=this.attributes.position,i=this.morphAttributes.position;if(n&&n.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Vector3,1/0);if(n){const l=this.boundingSphere.center;if(_box$1.setFromBufferAttribute(n),i)for(let e=0,t=i.length;e<t;e++){var o=i[e];_boxMorphTargets.setFromBufferAttribute(o),this.morphTargetsRelative?(_vector$8.addVectors(_box$1.min,_boxMorphTargets.min),_box$1.expandByPoint(_vector$8),_vector$8.addVectors(_box$1.max,_boxMorphTargets.max),_box$1.expandByPoint(_vector$8)):(_box$1.expandByPoint(_boxMorphTargets.min),_box$1.expandByPoint(_boxMorphTargets.max))}_box$1.getCenter(l);let r=0;for(let e=0,t=n.count;e<t;e++)_vector$8.fromBufferAttribute(n,e),r=Math.max(r,l.distanceToSquared(_vector$8));if(i)for(let e=0,t=i.length;e<t;e++){var a=i[e],s=this.morphTargetsRelative;for(let e=0,t=a.count;e<t;e++)_vector$8.fromBufferAttribute(a,e),s&&(_offset.fromBufferAttribute(n,e),_vector$8.add(_offset)),r=Math.max(r,l.distanceToSquared(_vector$8))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeTangents:function(){var e=this.index,t=this.attributes;if(null!==e&&void 0!==t.position&&void 0!==t.normal&&void 0!==t.uv){var n=e.array;const h=t.position.array,u=t.normal.array,A=t.uv.array;var i=h.length/3;void 0===t.tangent&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*i),4));const d=t.tangent.array,p=[],m=[];for(let e=0;e<i;e++)p[e]=new Vector3,m[e]=new Vector3;const f=new Vector3,g=new Vector3,v=new Vector3,_=new Vector2,y=new Vector2,w=new Vector2,x=new Vector3,b=new Vector3;let r=this.groups;0===r.length&&(r=[{start:0,count:n.length}]);for(let e=0,t=r.length;e<t;++e){var o=r[e],a=o.start;for(let e=a,t=a+o.count;e<t;e+=3)!function(e,t,r){f.fromArray(h,3*e),g.fromArray(h,3*t),v.fromArray(h,3*r),_.fromArray(A,2*e),y.fromArray(A,2*t),w.fromArray(A,2*r),g.sub(f),v.sub(f),y.sub(_),w.sub(_);var n=1/(y.x*w.y-w.x*y.y);isFinite(n)&&(x.copy(g).multiplyScalar(w.y).addScaledVector(v,-y.y).multiplyScalar(n),b.copy(v).multiplyScalar(y.x).addScaledVector(g,-w.x).multiplyScalar(n),p[e].add(x),p[t].add(x),p[r].add(x),m[e].add(b),m[t].add(b),m[r].add(b))}(n[e+0],n[e+1],n[e+2])}const T=new Vector3,E=new Vector3,B=new Vector3,C=new Vector3;for(let e=0,t=r.length;e<t;++e){var s=r[e],l=s.start;for(let e=l,t=l+s.count;e<t;e+=3)c(n[e+0]),c(n[e+1]),c(n[e+2])}function c(e){B.fromArray(u,3*e),C.copy(B);var t=p[e];T.copy(t),T.sub(B.multiplyScalar(B.dot(t))).normalize(),E.crossVectors(C,t);t=E.dot(m[e])<0?-1:1;d[4*e]=T.x,d[4*e+1]=T.y,d[4*e+2]=T.z,d[4*e+3]=t}}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)")},computeVertexNormals:function(){const n=this.index;var i=this.getAttribute("position");if(void 0!==i){let r=this.getAttribute("normal");if(void 0===r)r=new BufferAttribute(new Float32Array(3*i.count),3),this.setAttribute("normal",r);else for(let e=0,t=r.count;e<t;e++)r.setXYZ(e,0,0,0);const l=new Vector3,c=new Vector3,h=new Vector3,u=new Vector3,A=new Vector3,d=new Vector3,p=new Vector3,m=new Vector3;if(n)for(let e=0,t=n.count;e<t;e+=3){var o=n.getX(e+0),a=n.getX(e+1),s=n.getX(e+2);l.fromBufferAttribute(i,o),c.fromBufferAttribute(i,a),h.fromBufferAttribute(i,s),p.subVectors(h,c),m.subVectors(l,c),p.cross(m),u.fromBufferAttribute(r,o),A.fromBufferAttribute(r,a),d.fromBufferAttribute(r,s),u.add(p),A.add(p),d.add(p),r.setXYZ(o,u.x,u.y,u.z),r.setXYZ(a,A.x,A.y,A.z),r.setXYZ(s,d.x,d.y,d.z)}else for(let e=0,t=i.count;e<t;e+=3)l.fromBufferAttribute(i,e+0),c.fromBufferAttribute(i,e+1),h.fromBufferAttribute(i,e+2),p.subVectors(h,c),m.subVectors(l,c),p.cross(m),r.setXYZ(e+0,p.x,p.y,p.z),r.setXYZ(e+1,p.x,p.y,p.z),r.setXYZ(e+2,p.x,p.y,p.z);this.normalizeNormals(),r.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(const a in r)if(void 0!==e.attributes[a]){const s=r[a].array;var n=e.attributes[a],i=n.array,n=n.itemSize*t,o=Math.min(i.length,s.length-n);for(let e=0,t=n;e<o;e++,t++)s[t]=i[e]}return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){const r=this.attributes.normal;for(let e=0,t=r.count;e<t;e++)_vector$8.fromBufferAttribute(r,e),_vector$8.normalize(),r.setXYZ(e,_vector$8.x,_vector$8.y,_vector$8.z)},toNonIndexed:function(){function r(e,r){const n=e.array;var i=e.itemSize,e=e.normalized;const o=new n.constructor(r.length*i);let a=0,s=0;for(let e=0,t=r.length;e<t;e++){a=r[e]*i;for(let e=0;e<i;e++)o[s++]=n[a++]}return new BufferAttribute(o,i,e)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const n=new BufferGeometry;var i=this.index.array,e=this.attributes;for(const h in e){var t=r(e[h],i);n.setAttribute(h,t)}var o=this.morphAttributes;for(const u in o){const A=[];var a=o[u];for(let e=0,t=a.length;e<t;e++){var s=r(a[e],i);A.push(s)}n.morphAttributes[u]=A}n.morphTargetsRelative=this.morphTargetsRelative;var l=this.groups;for(let e=0,t=l.length;e<t;e++){var c=l[e];n.addGroup(c.start,c.count,c.materialIndex)}return n},toJSON:function(){const r={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),0<Object.keys(this.userData).length&&(r.userData=this.userData),void 0!==this.parameters){var e=this.parameters;for(const l in e)void 0!==e[l]&&(r[l]=e[l]);return r}r.data={attributes:{}};var t=this.index;null!==t&&(r.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});var n=this.attributes;for(const c in n){const h=n[c];r.data.attributes[c]=h.toJSON(r.data)}const i={};let o=!1;for(const u in this.morphAttributes){var a=this.morphAttributes[u];const A=[];for(let e=0,t=a.length;e<t;e++){const d=a[e];A.push(d.toJSON(r.data))}0<A.length&&(i[u]=A,o=!0)}o&&(r.data.morphAttributes=i,r.data.morphTargetsRelative=this.morphTargetsRelative);t=this.groups;0<t.length&&(r.data.groups=JSON.parse(JSON.stringify(t)));const s=this.boundingSphere;return null!==s&&(r.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),r},clone:function(){return(new BufferGeometry).copy(this)},copy:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var r={};this.name=e.name;const t=e.index;null!==t&&this.setIndex(t.clone(r));var n=e.attributes;for(const c in n){const h=n[c];this.setAttribute(c,h.clone(r))}var i=e.morphAttributes;for(const u in i){const A=[],d=i[u];for(let e=0,t=d.length;e<t;e++)A.push(d[e].clone(r));this.morphAttributes[u]=A}this.morphTargetsRelative=e.morphTargetsRelative;var o=e.groups;for(let e=0,t=o.length;e<t;e++){var a=o[e];this.addGroup(a.start,a.count,a.materialIndex)}const s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());const l=e.boundingSphere;return null!==l&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const _inverseMatrix$2=new Matrix4,_ray$2=new Ray,_sphere$3=new Sphere,_vA$1=new Vector3,_vB$1=new Vector3,_vC$1=new Vector3,_tempA=new Vector3,_tempB=new Vector3,_tempC=new Vector3,_morphA=new Vector3,_morphB=new Vector3,_morphC=new Vector3,_uvA$1=new Vector2,_uvB$1=new Vector2,_uvC$1=new Vector2,_intersectionPoint=new Vector3,_intersectionPointWorld=new Vector3;function Mesh(e=new BufferGeometry,t=new MeshBasicMaterial){Object3D.call(this),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}function checkIntersection(e,t,r,n,i,o,a,s){let l;if(l=t.side===BackSide?n.intersectTriangle(a,o,i,!0,s):n.intersectTriangle(i,o,a,t.side!==DoubleSide,s),null===l)return null;_intersectionPointWorld.copy(s),_intersectionPointWorld.applyMatrix4(e.matrixWorld);s=r.ray.origin.distanceTo(_intersectionPointWorld);return s<r.near||s>r.far?null:{distance:s,point:_intersectionPointWorld.clone(),object:e}}function checkBufferGeometryIntersection(e,t,r,n,i,o,a,s,l,c,h,u){_vA$1.fromBufferAttribute(i,c),_vB$1.fromBufferAttribute(i,h),_vC$1.fromBufferAttribute(i,u);var A=e.morphTargetInfluences;if(t.morphTargets&&o&&A){_morphA.set(0,0,0),_morphB.set(0,0,0),_morphC.set(0,0,0);for(let e=0,t=o.length;e<t;e++){var d=A[e],p=o[e];0!==d&&(_tempA.fromBufferAttribute(p,c),_tempB.fromBufferAttribute(p,h),_tempC.fromBufferAttribute(p,u),a?(_morphA.addScaledVector(_tempA,d),_morphB.addScaledVector(_tempB,d),_morphC.addScaledVector(_tempC,d)):(_morphA.addScaledVector(_tempA.sub(_vA$1),d),_morphB.addScaledVector(_tempB.sub(_vB$1),d),_morphC.addScaledVector(_tempC.sub(_vC$1),d)))}_vA$1.add(_morphA),_vB$1.add(_morphB),_vC$1.add(_morphC)}e.isSkinnedMesh&&t.skinning&&(e.boneTransform(c,_vA$1),e.boneTransform(h,_vB$1),e.boneTransform(u,_vC$1));const m=checkIntersection(e,t,r,n,_vA$1,_vB$1,_vC$1,_intersectionPoint);return m&&(s&&(_uvA$1.fromBufferAttribute(s,c),_uvB$1.fromBufferAttribute(s,h),_uvC$1.fromBufferAttribute(s,u),m.uv=Triangle.getUV(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2)),l&&(_uvA$1.fromBufferAttribute(l,c),_uvB$1.fromBufferAttribute(l,h),_uvC$1.fromBufferAttribute(l,u),m.uv2=Triangle.getUV(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2)),l={a:c,b:h,c:u,normal:new Vector3,materialIndex:0},Triangle.getNormal(_vA$1,_vB$1,_vC$1,l.normal),m.face=l),m}Mesh.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Mesh,isMesh:!0,copy:function(e){return Object3D.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,r=Object.keys(t);if(0<r.length){var n=t[r[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){var i=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{e=e.morphTargets;void 0!==e&&0<e.length&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(n,i){const e=this.geometry;var o=this.material,t=this.matrixWorld;if(void 0!==o&&(null===e.boundingSphere&&e.computeBoundingSphere(),_sphere$3.copy(e.boundingSphere),_sphere$3.applyMatrix4(t),!1!==n.ray.intersectsSphere(_sphere$3)&&(_inverseMatrix$2.copy(t).invert(),_ray$2.copy(n.ray).applyMatrix4(_inverseMatrix$2),null===e.boundingBox||!1!==_ray$2.intersectsBox(e.boundingBox)))){let r;if(e.isBufferGeometry){const M=e.index;var a=e.attributes.position,s=e.morphAttributes.position,l=e.morphTargetsRelative,c=e.attributes.uv,h=e.attributes.uv2,u=e.groups,A=e.drawRange;if(null!==M)if(Array.isArray(o))for(let e=0,t=u.length;e<t;e++){var d=u[e],p=o[d.materialIndex];for(let e=Math.max(d.start,A.start),t=Math.min(d.start+d.count,A.start+A.count);e<t;e+=3){var m=M.getX(e),f=M.getX(e+1),g=M.getX(e+2);r=checkBufferGeometryIntersection(this,p,n,_ray$2,a,s,l,c,h,m,f,g),r&&(r.faceIndex=Math.floor(e/3),r.face.materialIndex=d.materialIndex,i.push(r))}}else for(let e=Math.max(0,A.start),t=Math.min(M.count,A.start+A.count);e<t;e+=3){var v=M.getX(e),_=M.getX(e+1),y=M.getX(e+2);r=checkBufferGeometryIntersection(this,o,n,_ray$2,a,s,l,c,h,v,_,y),r&&(r.faceIndex=Math.floor(e/3),i.push(r))}else if(void 0!==a)if(Array.isArray(o))for(let e=0,t=u.length;e<t;e++){var w=u[e],x=o[w.materialIndex];for(let e=Math.max(w.start,A.start),t=Math.min(w.start+w.count,A.start+A.count);e<t;e+=3){var b=e,T=e+1,E=e+2;r=checkBufferGeometryIntersection(this,x,n,_ray$2,a,s,l,c,h,b,T,E),r&&(r.faceIndex=Math.floor(e/3),r.face.materialIndex=w.materialIndex,i.push(r))}}else for(let e=Math.max(0,A.start),t=Math.min(a.count,A.start+A.count);e<t;e+=3){var B=e,C=e+1,S=e+2;r=checkBufferGeometryIntersection(this,o,n,_ray$2,a,s,l,c,h,B,C,S),r&&(r.faceIndex=Math.floor(e/3),i.push(r))}}else e.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}});class BoxGeometry extends BufferGeometry{constructor(e=1,t=1,r=1,n=1,i=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:i,depthSegments:o};const C=this;n=Math.floor(n),i=Math.floor(i),o=Math.floor(o);const S=[],M=[],N=[],L=[];let F=0,U=0;function a(r,n,i,o,a,e,t,s,l,c,h){var u=e/l,A=t/c,d=e/2,p=t/2,m=s/2,f=l+1,g=c+1;let v=0,_=0;const y=new Vector3;for(let t=0;t<g;t++){var w=t*A-p;for(let e=0;e<f;e++){var x=e*u-d;y[r]=x*o,y[n]=w*a,y[i]=m,M.push(y.x,y.y,y.z),y[r]=0,y[n]=0,y[i]=0<s?1:-1,N.push(y.x,y.y,y.z),L.push(e/l),L.push(1-t/c),v+=1}}for(let t=0;t<c;t++)for(let e=0;e<l;e++){var b=F+e+f*t,T=F+e+f*(t+1),E=F+(e+1)+f*(t+1),B=F+(e+1)+f*t;S.push(b,T,B),S.push(T,E,B),_+=6}C.addGroup(U,_,h),U+=_,F+=v}a("z","y","x",-1,-1,r,t,e,o,i,0),a("z","y","x",1,-1,r,t,-e,o,i,1),a("x","z","y",1,1,e,r,t,n,o,2),a("x","z","y",1,-1,e,r,-t,n,o,3),a("x","y","z",1,-1,e,t,r,n,i,4),a("x","y","z",-1,-1,e,t,-r,n,i,5),this.setIndex(S),this.setAttribute("position",new Float32BufferAttribute(M,3)),this.setAttribute("normal",new Float32BufferAttribute(N,3)),this.setAttribute("uv",new Float32BufferAttribute(L,2))}}function cloneUniforms(e){const t={};for(const r in e){t[r]={};for(const n in e[r]){const i=e[r][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?t[r][n]=i.clone():Array.isArray(i)?t[r][n]=i.slice():t[r][n]=i}}return t}function mergeUniforms(t){const r={};for(let e=0;e<t.length;e++){var n=cloneUniforms(t[e]);for(const i in n)r[i]=n[i]}return r}const UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};var default_vertex="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",default_fragment="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function ShaderMaterial(e){Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function Camera(){Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4}function PerspectiveCamera(e=50,t=1,r=.1,n=2e3){Camera.call(this),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}ShaderMaterial.prototype=Object.create(Material.prototype),(ShaderMaterial.prototype.constructor=ShaderMaterial).prototype.isShaderMaterial=!0,ShaderMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=cloneUniforms(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this},ShaderMaterial.prototype.toJSON=function(e){const t=Material.prototype.toJSON.call(this,e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}0<Object.keys(this.defines).length&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const r={};for(const o in this.extensions)!0===this.extensions[o]&&(r[o]=!0);return 0<Object.keys(r).length&&(t.extensions=r),t},Camera.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Camera,isCamera:!0,copy:function(e,t){return Object3D.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Vector3),this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){Object3D.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(e,t){Object3D.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return(new this.constructor).copy(this)}}),PerspectiveCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:PerspectiveCamera,isPerspectiveCamera:!0,copy:function(e,t){return Camera.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){e=.5*this.getFilmHeight()/e;this.fov=2*MathUtils.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*MathUtils.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*MathUtils.RAD2DEG*Math.atan(Math.tan(.5*MathUtils.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,r,n,i,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near;let t=e*Math.tan(.5*MathUtils.DEG2RAD*this.fov)/this.zoom,r=2*t,n=this.aspect*r,i=-.5*n;var o,a=this.view;null!==this.view&&this.view.enabled&&(o=a.fullWidth,s=a.fullHeight,i+=a.offsetX*n/o,t-=a.offsetY*r/s,n*=a.width/o,r*=a.height/s);var s=this.filmOffset;0!==s&&(i+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,t,t-r,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(e){const t=Object3D.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});const fov=90,aspect=1;class CubeCamera extends Object3D{constructor(e,t,r){if(super(),this.type="CubeCamera",!0===r.isWebGLCubeRenderTarget){this.renderTarget=r;const n=new PerspectiveCamera(fov,aspect,e,t);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new Vector3(1,0,0)),this.add(n);const i=new PerspectiveCamera(fov,aspect,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Vector3(-1,0,0)),this.add(i);const o=new PerspectiveCamera(fov,aspect,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new Vector3(0,1,0)),this.add(o);const a=new PerspectiveCamera(fov,aspect,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new Vector3(0,-1,0)),this.add(a);const s=new PerspectiveCamera(fov,aspect,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new Vector3(0,0,1)),this.add(s);const l=new PerspectiveCamera(fov,aspect,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new Vector3(0,0,-1)),this.add(l)}else console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.")}update(e,t){null===this.parent&&this.updateMatrixWorld();const r=this.renderTarget;var[n,i,o,a,s,l]=this.children,c=e.xr.enabled,h=e.getRenderTarget();e.xr.enabled=!1;var u=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(t,n),e.setRenderTarget(r,1),e.render(t,i),e.setRenderTarget(r,2),e.render(t,o),e.setRenderTarget(r,3),e.render(t,a),e.setRenderTarget(r,4),e.render(t,s),r.texture.generateMipmaps=u,e.setRenderTarget(r,5),e.render(t,l),e.setRenderTarget(h),e.xr.enabled=c}}class CubeTexture extends Texture{constructor(e,t,r,n,i,o,a,s,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:CubeReflectionMapping,r,n,i,o,a=void 0!==a?a:RGBFormat,s,l,c),this._needsFlipEnvMap=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}CubeTexture.prototype.isCubeTexture=!0;class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(e,t,r){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=r),super(e,e,t),t=t||{},this.texture=new CubeTexture(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:LinearFilter,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=RGBAFormat,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new BoxGeometry(5,5,5);const i=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:BackSide,blending:NoBlending});i.uniforms.tEquirect.value=t;const o=new Mesh(n,i);n=t.minFilter;t.minFilter===LinearMipmapLinearFilter&&(t.minFilter=LinearFilter);const a=new CubeCamera(1,10,this);return a.update(e,o),t.minFilter=n,o.geometry.dispose(),o.material.dispose(),this}clear(t,r,n,i){var e=t.getRenderTarget();for(let e=0;e<6;e++)t.setRenderTarget(this,e),t.clear(r,n,i);t.setRenderTarget(e)}}WebGLCubeRenderTarget.prototype.isWebGLCubeRenderTarget=!0;class DataTexture extends Texture{constructor(e,t,r,n,i,o,a,s,l,c,h,u){super(null,o,a,s,l,c,n,i,h,u),this.image={data:e||null,width:t||1,height:r||1},this.magFilter=void 0!==l?l:NearestFilter,this.minFilter=void 0!==c?c:NearestFilter,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}DataTexture.prototype.isDataTexture=!0;const _sphere$2=new Sphere,_vector$7=new Vector3;class Frustum{constructor(e=new Plane,t=new Plane,r=new Plane,n=new Plane,i=new Plane,o=new Plane){this.planes=[e,t,r,n,i,o]}set(e,t,r,n,i,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(n),a[4].copy(i),a[5].copy(o),this}copy(t){const r=this.planes;for(let e=0;e<6;e++)r[e].copy(t.planes[e]);return this}setFromProjectionMatrix(e){const t=this.planes;var r=e.elements,n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],l=r[5],c=r[6],h=r[7],u=r[8],A=r[9],d=r[10],p=r[11],m=r[12],f=r[13],e=r[14],r=r[15];return t[0].setComponents(a-n,h-s,p-u,r-m).normalize(),t[1].setComponents(a+n,h+s,p+u,r+m).normalize(),t[2].setComponents(a+i,h+l,p+A,r+f).normalize(),t[3].setComponents(a-i,h-l,p-A,r-f).normalize(),t[4].setComponents(a-o,h-c,p-d,r-e).normalize(),t[5].setComponents(a+o,h+c,p+d,r+e).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),_sphere$2.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(_sphere$2)}intersectsSprite(e){return _sphere$2.center.set(0,0,0),_sphere$2.radius=.7071067811865476,_sphere$2.applyMatrix4(e.matrixWorld),this.intersectsSphere(_sphere$2)}intersectsSphere(e){const t=this.planes;var r=e.center,n=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(r)<n)return!1;return!0}intersectsBox(t){var r=this.planes;for(let e=0;e<6;e++){const n=r[e];if(_vector$7.x=(0<n.normal.x?t.max:t.min).x,_vector$7.y=(0<n.normal.y?t.max:t.min).y,_vector$7.z=(0<n.normal.z?t.max:t.min).z,n.distanceToPoint(_vector$7)<0)return!1}return!0}containsPoint(t){const r=this.planes;for(let e=0;e<6;e++)if(r[e].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function WebGLAnimation(){let r=null,e=!1,n=null,i=null;function o(e,t){n(e,t),i=r.requestAnimationFrame(o)}return{start:function(){!0!==e&&null!==n&&(i=r.requestAnimationFrame(o),e=!0)},stop:function(){r.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(e){n=e},setContext:function(e){r=e}}}function WebGLAttributes(a,e){const s=e.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);var t=i.get(e);t&&(a.deleteBuffer(t.buffer),i.delete(e))},update:function(e,t){if(e.isGLBufferAttribute){var r=i.get(e);(!r||r.version<e.version)&&i.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version})}else{e.isInterleavedBufferAttribute&&(e=e.data);const n=i.get(e);void 0===n?i.set(e,function(e,t){var r=e.array,n=e.usage,i=a.createBuffer();a.bindBuffer(t,i),a.bufferData(t,r,n),e.onUploadCallback();let o=5126;return r instanceof Float32Array?o=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?e.isFloat16BufferAttribute?s?o=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):o=5123:r instanceof Int16Array?o=5122:r instanceof Uint32Array?o=5125:r instanceof Int32Array?o=5124:r instanceof Int8Array?o=5120:r instanceof Uint8Array&&(o=5121),{buffer:i,type:o,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,t)):n.version<e.version&&(function(e,t,r){const n=t.array,i=t.updateRange;a.bindBuffer(r,e),-1===i.count?a.bufferSubData(r,0,n):(s?a.bufferSubData(r,i.offset*n.BYTES_PER_ELEMENT,n,i.offset,i.count):a.bufferSubData(r,i.offset*n.BYTES_PER_ELEMENT,n.subarray(i.offset,i.offset+i.count)),i.count=-1)}(n.buffer,e,t),n.version=e.version)}}}}class PlaneGeometry extends BufferGeometry{constructor(e=1,t=1,r=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};var i=e/2,o=t/2,a=Math.floor(r),s=Math.floor(n),l=a+1,c=s+1,h=e/a,u=t/s;const A=[],d=[],p=[],m=[];for(let t=0;t<c;t++){var f=t*u-o;for(let e=0;e<l;e++){var g=e*h-i;d.push(g,-f,0),p.push(0,0,1),m.push(e/a),m.push(1-t/s)}}for(let t=0;t<s;t++)for(let e=0;e<a;e++){var v=e+l*t,_=e+l*(t+1),y=e+1+l*(t+1),w=e+1+l*t;A.push(v,_,w),A.push(_,y,w)}this.setIndex(A),this.setAttribute("position",new Float32BufferAttribute(d,3)),this.setAttribute("normal",new Float32BufferAttribute(p,3)),this.setAttribute("uv",new Float32BufferAttribute(m,2))}}var alphamap_fragment="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment="#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex="vec3 transformed = vec3( position );",beginnormal_vertex="vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs="vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment="#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex="#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment="#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment="#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex="#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex="#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common="#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment="#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex="vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment="\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment="#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment="#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_vertex="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex="#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex="#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment="#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment="#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment="#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex="vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin="uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",envmap_physical_pars_fragment="#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",lights_toon_fragment="ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment="struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps="#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end="#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment="#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin="float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps="#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin="#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps="#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment="#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex="vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment="#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment="#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment="#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment="#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment="#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment="#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment="#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex="#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex="#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex="#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag="uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert="varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag="#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag="uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert="#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag="#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert="#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag="#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert="#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert="#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag="#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert="#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert="#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert="uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}";const ShaderChunk={alphamap_fragment:alphamap_fragment,alphamap_pars_fragment:alphamap_pars_fragment,alphatest_fragment:alphatest_fragment,aomap_fragment:aomap_fragment,aomap_pars_fragment:aomap_pars_fragment,begin_vertex:begin_vertex,beginnormal_vertex:beginnormal_vertex,bsdfs:bsdfs,bumpmap_pars_fragment:bumpmap_pars_fragment,clipping_planes_fragment:clipping_planes_fragment,clipping_planes_pars_fragment:clipping_planes_pars_fragment,clipping_planes_pars_vertex:clipping_planes_pars_vertex,clipping_planes_vertex:clipping_planes_vertex,color_fragment:color_fragment,color_pars_fragment:color_pars_fragment,color_pars_vertex:color_pars_vertex,color_vertex:color_vertex,common:common,cube_uv_reflection_fragment:cube_uv_reflection_fragment,defaultnormal_vertex:defaultnormal_vertex,displacementmap_pars_vertex:displacementmap_pars_vertex,displacementmap_vertex:displacementmap_vertex,emissivemap_fragment:emissivemap_fragment,emissivemap_pars_fragment:emissivemap_pars_fragment,encodings_fragment:encodings_fragment,encodings_pars_fragment:encodings_pars_fragment,envmap_fragment:envmap_fragment,envmap_common_pars_fragment:envmap_common_pars_fragment,envmap_pars_fragment:envmap_pars_fragment,envmap_pars_vertex:envmap_pars_vertex,envmap_physical_pars_fragment:envmap_physical_pars_fragment,envmap_vertex:envmap_vertex,fog_vertex:fog_vertex,fog_pars_vertex:fog_pars_vertex,fog_fragment:fog_fragment,fog_pars_fragment:fog_pars_fragment,gradientmap_pars_fragment:gradientmap_pars_fragment,lightmap_fragment:lightmap_fragment,lightmap_pars_fragment:lightmap_pars_fragment,lights_lambert_vertex:lights_lambert_vertex,lights_pars_begin:lights_pars_begin,lights_toon_fragment:lights_toon_fragment,lights_toon_pars_fragment:lights_toon_pars_fragment,lights_phong_fragment:lights_phong_fragment,lights_phong_pars_fragment:lights_phong_pars_fragment,lights_physical_fragment:lights_physical_fragment,lights_physical_pars_fragment:lights_physical_pars_fragment,lights_fragment_begin:lights_fragment_begin,lights_fragment_maps:lights_fragment_maps,lights_fragment_end:lights_fragment_end,logdepthbuf_fragment:logdepthbuf_fragment,logdepthbuf_pars_fragment:logdepthbuf_pars_fragment,logdepthbuf_pars_vertex:logdepthbuf_pars_vertex,logdepthbuf_vertex:logdepthbuf_vertex,map_fragment:map_fragment,map_pars_fragment:map_pars_fragment,map_particle_fragment:map_particle_fragment,map_particle_pars_fragment:map_particle_pars_fragment,metalnessmap_fragment:metalnessmap_fragment,metalnessmap_pars_fragment:metalnessmap_pars_fragment,morphnormal_vertex:morphnormal_vertex,morphtarget_pars_vertex:morphtarget_pars_vertex,morphtarget_vertex:morphtarget_vertex,normal_fragment_begin:normal_fragment_begin,normal_fragment_maps:normal_fragment_maps,normalmap_pars_fragment:normalmap_pars_fragment,clearcoat_normal_fragment_begin:clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps:clearcoat_normal_fragment_maps,clearcoat_pars_fragment:clearcoat_pars_fragment,packing:packing,premultiplied_alpha_fragment:premultiplied_alpha_fragment,project_vertex:project_vertex,dithering_fragment:dithering_fragment,dithering_pars_fragment:dithering_pars_fragment,roughnessmap_fragment:roughnessmap_fragment,roughnessmap_pars_fragment:roughnessmap_pars_fragment,shadowmap_pars_fragment:shadowmap_pars_fragment,shadowmap_pars_vertex:shadowmap_pars_vertex,shadowmap_vertex:shadowmap_vertex,shadowmask_pars_fragment:shadowmask_pars_fragment,skinbase_vertex:skinbase_vertex,skinning_pars_vertex:skinning_pars_vertex,skinning_vertex:skinning_vertex,skinnormal_vertex:skinnormal_vertex,specularmap_fragment:specularmap_fragment,specularmap_pars_fragment:specularmap_pars_fragment,tonemapping_fragment:tonemapping_fragment,tonemapping_pars_fragment:tonemapping_pars_fragment,transmissionmap_fragment:transmissionmap_fragment,transmissionmap_pars_fragment:transmissionmap_pars_fragment,uv_pars_fragment:uv_pars_fragment,uv_pars_vertex:uv_pars_vertex,uv_vertex:uv_vertex,uv2_pars_fragment:uv2_pars_fragment,uv2_pars_vertex:uv2_pars_vertex,uv2_vertex:uv2_vertex,worldpos_vertex:worldpos_vertex,background_frag:background_frag,background_vert:background_vert,cube_frag:cube_frag,cube_vert:cube_vert,depth_frag:depth_frag,depth_vert:depth_vert,distanceRGBA_frag:distanceRGBA_frag,distanceRGBA_vert:distanceRGBA_vert,equirect_frag:equirect_frag,equirect_vert:equirect_vert,linedashed_frag:linedashed_frag,linedashed_vert:linedashed_vert,meshbasic_frag:meshbasic_frag,meshbasic_vert:meshbasic_vert,meshlambert_frag:meshlambert_frag,meshlambert_vert:meshlambert_vert,meshmatcap_frag:meshmatcap_frag,meshmatcap_vert:meshmatcap_vert,meshtoon_frag:meshtoon_frag,meshtoon_vert:meshtoon_vert,meshphong_frag:meshphong_frag,meshphong_vert:meshphong_vert,meshphysical_frag:meshphysical_frag,meshphysical_vert:meshphysical_vert,normal_frag:normal_frag,normal_vert:normal_vert,points_frag:points_frag,points_vert:points_vert,shadow_frag:shadow_frag,shadow_vert:shadow_vert,sprite_frag:sprite_frag,sprite_vert:sprite_vert},UniformsLib={common:{diffuse:{value:new Color(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},uv2Transform:{value:new Matrix3},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(15658734)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.normal_vert,fragmentShader:ShaderChunk.normal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},cube:{uniforms:mergeUniforms([UniformsLib.envmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};function WebGLBackground(a,s,r,l,n){const c=new Color(0);let h=0,u,A,d=null,p=0,m=null;function f(e,t){r.buffers.color.setClear(e.r,e.g,e.b,t,n)}return{getClearColor:function(){return c},setClearColor:function(e,t=1){c.set(e),h=t,f(c,h)},getClearAlpha:function(){return h},setClearAlpha:function(e){h=e,f(c,h)},render:function(e,t,r,n){let i=!0===t.isScene?t.background:null;i&&i.isTexture&&(i=s.get(i));const o=a.xr;(t=o.getSession&&o.getSession())&&"additive"===t.environmentBlendMode&&(i=null),null===i?f(c,h):i&&i.isColor&&(f(i,1),n=!0),(a.autoClear||n)&&a.clear(a.autoClearColor,a.autoClearDepth,a.autoClearStencil),i&&(i.isCubeTexture||i.mapping===CubeUVReflectionMapping)?(void 0===A&&(A=new Mesh(new BoxGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.cube.uniforms),vertexShader:ShaderLib.cube.vertexShader,fragmentShader:ShaderLib.cube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1})),A.geometry.deleteAttribute("normal"),A.geometry.deleteAttribute("uv"),A.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(A.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),l.update(A)),A.material.uniforms.envMap.value=i,A.material.uniforms.flipEnvMap.value=i.isCubeTexture&&i._needsFlipEnvMap?-1:1,d===i&&p===i.version&&m===a.toneMapping||(A.material.needsUpdate=!0,d=i,p=i.version,m=a.toneMapping),e.unshift(A,A.geometry,A.material,0,0,null)):i&&i.isTexture&&(void 0===u&&(u=new Mesh(new PlaneGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),l.update(u)),u.material.uniforms.t2D.value=i,!0===i.matrixAutoUpdate&&i.updateMatrix(),u.material.uniforms.uvTransform.value.copy(i.matrix),d===i&&p===i.version&&m===a.toneMapping||(u.material.needsUpdate=!0,d=i,p=i.version,m=a.toneMapping),e.unshift(u,u.geometry,u.material,0,0,null))}}}function WebGLBindingStates(w,x,b,T){const i=w.getParameter(34921),s=T.isWebGL2?null:x.get("OES_vertex_array_object"),l=T.isWebGL2||null!==s,c={},e=A(null);let h=e;function u(e){return T.isWebGL2?w.bindVertexArray(e):s.bindVertexArrayOES(e)}function o(e){return T.isWebGL2?w.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function A(e){const t=[],r=[],n=[];for(let e=0;e<i;e++)t[e]=0,r[e]=0,n[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:r,attributeDivisors:n,object:e,attributes:{},index:null}}function E(){const r=h.newAttributes;for(let e=0,t=r.length;e<t;e++)r[e]=0}function B(e){C(e,0)}function C(e,t){const r=h.newAttributes,n=h.enabledAttributes,i=h.attributeDivisors;if(r[e]=1,0===n[e]&&(w.enableVertexAttribArray(e),n[e]=1),i[e]!==t){const o=T.isWebGL2?w:x.get("ANGLE_instanced_arrays");o[T.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](e,t),i[e]=t}}function S(){var r=h.newAttributes;const n=h.enabledAttributes;for(let e=0,t=n.length;e<t;e++)n[e]!==r[e]&&(w.disableVertexAttribArray(e),n[e]=0)}function M(e,t,r,n,i,o){!0!==T.isWebGL2||5124!==r&&5125!==r?w.vertexAttribPointer(e,t,r,n,i,o):w.vertexAttribIPointer(e,t,r,i,o)}function a(){t(),h!==e&&(h=e,u(h.object))}function t(){e.geometry=null,e.program=null,e.wireframe=!1}return{setup:function(e,t,r,n,i){let o=!1;var a;l?(a=function(e,t,r){r=!0===r.wireframe;let n=c[e.id];void 0===n&&(n={},c[e.id]=n);let i=n[t.id];void 0===i&&(i={},n[t.id]=i);let o=i[r];void 0===o&&(o=A(T.isWebGL2?w.createVertexArray():s.createVertexArrayOES()),i[r]=o);return o}(n,r,t),h!==a&&(h=a,u(h.object)),o=function(e,t){var r=h.attributes,n=e.attributes;let i=0;for(const s in n){var o=r[s],a=n[s];if(void 0===o)return!0;if(o.attribute!==a)return!0;if(o.data!==a.data)return!0;i++}return h.attributesNum!==i||h.index!==t}(n,i),o&&function(e,t){const r={},n=e.attributes;let i=0;for(const a in n){var o=n[a];const s={};(s.attribute=o).data&&(s.data=o.data),r[a]=s,i++}h.attributes=r,h.attributesNum=i,h.index=t}(n,i)):(a=!0===t.wireframe,h.geometry===n.id&&h.program===r.id&&h.wireframe===a||(h.geometry=n.id,h.program=r.id,h.wireframe=a,o=!0)),!0===e.isInstancedMesh&&(o=!0),null!==i&&b.update(i,34963),o&&(function(e,t,r,n){if(!1===T.isWebGL2&&(e.isInstancedMesh||n.isInstancedBufferGeometry)&&null===x.get("ANGLE_instanced_arrays"))return;E();var i=n.attributes,o=r.getAttributes(),a=t.defaultAttributeValues;for(const y in o){var s=o[y];if(0<=s){var l=i[y];if(void 0!==l){var c,h,u,A,d,p=l.normalized,m=l.itemSize,f=b.get(l);void 0!==f&&(c=f.buffer,h=f.type,u=f.bytesPerElement,l.isInterleavedBufferAttribute?(A=l.data,d=A.stride,f=l.offset,A&&A.isInstancedInterleavedBuffer?(C(s,A.meshPerAttribute),void 0===n._maxInstanceCount&&(n._maxInstanceCount=A.meshPerAttribute*A.count)):B(s),w.bindBuffer(34962,c),M(s,m,h,p,d*u,f*u)):(l.isInstancedBufferAttribute?(C(s,l.meshPerAttribute),void 0===n._maxInstanceCount&&(n._maxInstanceCount=l.meshPerAttribute*l.count)):B(s),w.bindBuffer(34962,c),M(s,m,h,p,0,0)))}else if("instanceMatrix"===y){p=b.get(e.instanceMatrix);void 0!==p&&(v=p.buffer,g=p.type,C(s+0,1),C(s+1,1),C(s+2,1),C(s+3,1),w.bindBuffer(34962,v),w.vertexAttribPointer(s+0,4,g,!1,64,0),w.vertexAttribPointer(s+1,4,g,!1,64,16),w.vertexAttribPointer(s+2,4,g,!1,64,32),w.vertexAttribPointer(s+3,4,g,!1,64,48))}else if("instanceColor"===y){var g,v=b.get(e.instanceColor);void 0!==v&&(g=v.buffer,v=v.type,C(s,1),w.bindBuffer(34962,g),w.vertexAttribPointer(s,3,v,!1,12,0))}else if(void 0!==a){var _=a[y];if(void 0!==_)switch(_.length){case 2:w.vertexAttrib2fv(s,_);break;case 3:w.vertexAttrib3fv(s,_);break;case 4:w.vertexAttrib4fv(s,_);break;default:w.vertexAttrib1fv(s,_)}}}}S()}(e,t,r,n),null!==i&&w.bindBuffer(34963,b.get(i).buffer))},reset:a,resetDefaultState:t,dispose:function(){a();for(const e in c){const t=c[e];for(const r in t){const n=t[r];for(const i in n)o(n[i].object),delete n[i];delete t[r]}delete c[e]}},releaseStatesOfGeometry:function(e){if(void 0!==c[e.id]){const t=c[e.id];for(const r in t){const n=t[r];for(const i in n)o(n[i].object),delete n[i];delete t[r]}delete c[e.id]}},releaseStatesOfProgram:function(e){for(const t in c){const r=c[t];if(void 0!==r[e.id]){const n=r[e.id];for(const i in n)o(n[i].object),delete n[i];delete r[e.id]}}},initAttributes:E,enableAttribute:B,disableUnusedAttributes:S}}function WebGLBufferRenderer(o,a,s,e){const l=e.isWebGL2;let c;this.setMode=function(e){c=e},this.render=function(e,t){o.drawArrays(c,e,t),s.update(t,c,1)},this.renderInstances=function(r,n,i){if(0!==i){let e,t;if(l)e=o,t="drawArraysInstanced";else if(e=a.get("ANGLE_instanced_arrays"),t="drawArraysInstancedANGLE",null===e)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");e[t](c,r,n,i),s.update(n,c,i)}}}function WebGLCapabilities(t,r,e){let n;function i(e){if("highp"===e){if(0<t.getShaderPrecisionFormat(35633,36338).precision&&0<t.getShaderPrecisionFormat(35632,36338).precision)return"highp";e="mediump"}return"mediump"===e&&0<t.getShaderPrecisionFormat(35633,36337).precision&&0<t.getShaderPrecisionFormat(35632,36337).precision?"mediump":"lowp"}var o="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let a=void 0!==e.precision?e.precision:"highp";var s=i(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);var l=!0===e.logarithmicDepthBuffer,c=t.getParameter(34930),h=t.getParameter(35660),u=t.getParameter(3379),A=t.getParameter(34076),d=t.getParameter(34921),p=t.getParameter(36347),m=t.getParameter(36348),f=t.getParameter(36349),g=0<h,v=o||r.has("OES_texture_float"),s=g&&v,e=o?t.getParameter(36183):0;return{isWebGL2:o,getMaxAnisotropy:function(){return void 0!==n||(n=!0===r.has("EXT_texture_filter_anisotropic")?(e=r.get("EXT_texture_filter_anisotropic"),t.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT)):0),n;var e},getMaxPrecision:i,precision:a,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:h,maxTextureSize:u,maxCubemapSize:A,maxAttributes:d,maxVertexUniforms:p,maxVaryings:m,maxFragmentUniforms:f,vertexTextures:g,floatFragmentTextures:v,floatVertexTextures:s,maxSamples:e}}function WebGLClipping(t){const s=this;let c=null,h=0,u=!1,A=!1;const l=new Plane,d=new Matrix3,p={value:null,needsUpdate:!1};function m(){p.value!==c&&(p.value=c,p.needsUpdate=0<h),s.numPlanes=h,s.numIntersection=0}function f(r,e,n,t){var i=null!==r?r.length:0;let o=null;if(0!==i){if(o=p.value,!0!==t||null===o){var t=n+4*i,a=e.matrixWorldInverse;d.getNormalMatrix(a),(null===o||o.length<t)&&(o=new Float32Array(t));for(let e=0,t=n;e!==i;++e,t+=4)l.copy(r[e]).applyMatrix4(a,d),l.normal.toArray(o,t),o[t+3]=l.constant}p.value=o,p.needsUpdate=!0}return s.numPlanes=i,s.numIntersection=0,o}this.uniform=p,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,r){var n=0!==e.length||t||0!==h||u;return u=t,c=f(e,r,0),h=e.length,n},this.beginShadows=function(){A=!0,f(null)},this.endShadows=function(){A=!1,m()},this.setState=function(e,r,n){var i=e.clippingPlanes,o=e.clipIntersection,a=e.clipShadows;const s=t.get(e);if(!u||null===i||0===i.length||A&&!a)A?f(null):m();else{var a=A?0:h,l=4*a;let t=s.clippingState||null;p.value=t,t=f(i,r,l,n);for(let e=0;e!==l;++e)t[e]=c[e];s.clippingState=t,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=a}}}function WebGLCubeMaps(i){let o=new WeakMap;function a(e,t){return t===EquirectangularReflectionMapping?e.mapping=CubeReflectionMapping:t===EquirectangularRefractionMapping&&(e.mapping=CubeRefractionMapping),e}function s(e){const t=e.target;t.removeEventListener("dispose",s);const r=o.get(t);void 0!==r&&(o.delete(t),r.dispose())}return{get:function(e){if(e&&e.isTexture){var t=e.mapping;if(t===EquirectangularReflectionMapping||t===EquirectangularRefractionMapping){if(o.has(e))return a(o.get(e).texture,e.mapping);var r=e.image;if(r&&0<r.height){t=i.getRenderTarget();const n=new WebGLCubeRenderTarget(r.height/2);return n.fromEquirectangularTexture(i,e),o.set(e,n),i.setRenderTarget(t),e.addEventListener("dispose",s),a(n.texture,e.mapping)}return null}}return e},dispose:function(){o=new WeakMap}}}function WebGLExtensions(r){const n={};function i(e){if(void 0!==n[e])return n[e];let t;switch(e){case"WEBGL_depth_texture":t=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":t=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":t=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":t=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:t=r.getExtension(e)}return n[e]=t,t}return{has:function(e){return null!==i(e)},init:function(e){e.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float")},get:function(e){var t=i(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function WebGLGeometries(e,p,n,i){const o={},m=new WeakMap;function a(e){const t=e.target;null!==t.index&&p.remove(t.index);for(const r in t.attributes)p.remove(t.attributes[r]);t.removeEventListener("dispose",a),delete o[t.id];e=m.get(t);e&&(p.remove(e),m.delete(t)),i.releaseStatesOfGeometry(t),!0===t.isInstancedBufferGeometry&&delete t._maxInstanceCount,n.memory.geometries--}function s(e){const r=[];var t=e.index,n=e.attributes.position;let i=0;if(null!==t){var o=t.array;i=t.version;for(let e=0,t=o.length;e<t;e+=3){var a=o[e+0],s=o[e+1],l=o[e+2];r.push(a,s,s,l,l,a)}}else{var c=n.array;i=n.version;for(let e=0,t=c.length/3-1;e<t;e+=3){var h=e+0,u=e+1,A=e+2;r.push(h,u,u,A,A,h)}}const d=new(65535<arrayMax(r)?Uint32BufferAttribute:Uint16BufferAttribute)(r,1);d.version=i;c=m.get(e);c&&p.remove(c),m.set(e,d)}return{get:function(e,t){return!0===o[t.id]||(t.addEventListener("dispose",a),o[t.id]=!0,n.memory.geometries++),t},update:function(e){var t=e.attributes;for(const i in t)p.update(t[i],34962);var r=e.morphAttributes;for(const o in r){var n=r[o];for(let e=0,t=n.length;e<t;e++)p.update(n[e],34962)}},getWireframeAttribute:function(e){var t,r=m.get(e);return(!r||null!==(t=e.index)&&r.version<t.version)&&s(e),m.get(e)}}}function WebGLIndexedBufferRenderer(o,a,s,e){const l=e.isWebGL2;let c;let h,u;this.setMode=function(e){c=e},this.setIndex=function(e){h=e.type,u=e.bytesPerElement},this.render=function(e,t){o.drawElements(c,t,h,e*u),s.update(t,c,1)},this.renderInstances=function(r,n,i){if(0!==i){let e,t;if(l)e=o,t="drawElementsInstanced";else if(e=a.get("ANGLE_instanced_arrays"),t="drawElementsInstancedANGLE",null===e)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");e[t](c,n,h,r*u,i),s.update(n,c,i)}}}function WebGLInfo(e){const n={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:n,programs:null,autoReset:!0,reset:function(){n.frame++,n.calls=0,n.triangles=0,n.points=0,n.lines=0},update:function(e,t,r){switch(n.calls++,t){case 4:n.triangles+=r*(e/3);break;case 1:n.lines+=r*(e/2);break;case 3:n.lines+=r*(e-1);break;case 2:n.lines+=r*e;break;case 0:n.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",t)}}}}function numericalSort(e,t){return e[0]-t[0]}function absNumericalSort(e,t){return Math.abs(t[1])-Math.abs(e[1])}function WebGLMorphtargets(d){const p={},m=new Float32Array(8),f=[];for(let e=0;e<8;e++)f[e]=[e,0];return{update:function(e,t,r,n){var i=e.morphTargetInfluences,o=void 0===i?0:i.length;let a=p[t.id];if(void 0===a){a=[];for(let e=0;e<o;e++)a[e]=[e,0];p[t.id]=a}for(let e=0;e<o;e++){const A=a[e];A[0]=e,A[1]=i[e]}a.sort(absNumericalSort);for(let e=0;e<8;e++)e<o&&a[e][1]?(f[e][0]=a[e][0],f[e][1]=a[e][1]):(f[e][0]=Number.MAX_SAFE_INTEGER,f[e][1]=0);f.sort(numericalSort);var s=r.morphTargets&&t.morphAttributes.position,l=r.morphNormals&&t.morphAttributes.normal;let c=0;for(let e=0;e<8;e++){var h=f[e],u=h[0],h=h[1];u!==Number.MAX_SAFE_INTEGER&&h?(s&&t.getAttribute("morphTarget"+e)!==s[u]&&t.setAttribute("morphTarget"+e,s[u]),l&&t.getAttribute("morphNormal"+e)!==l[u]&&t.setAttribute("morphNormal"+e,l[u]),m[e]=h,c+=h):(s&&!0===t.hasAttribute("morphTarget"+e)&&t.deleteAttribute("morphTarget"+e),l&&!0===t.hasAttribute("morphNormal"+e)&&t.deleteAttribute("morphNormal"+e),m[e]=0)}r=t.morphTargetsRelative?1:1-c,n.getUniforms().setValue(d,"morphTargetBaseInfluence",r),n.getUniforms().setValue(d,"morphTargetInfluences",m)}}}function WebGLObjects(e,n,i,o){let a=new WeakMap;function s(e){const t=e.target;t.removeEventListener("dispose",s),i.remove(t.instanceMatrix),null!==t.instanceColor&&i.remove(t.instanceColor)}return{update:function(e){var t=o.render.frame,r=e.geometry,r=n.get(e,r);return a.get(r)!==t&&(n.update(r),a.set(r,t)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",s)&&e.addEventListener("dispose",s),i.update(e.instanceMatrix,34962),null!==e.instanceColor&&i.update(e.instanceColor,34962)),r},dispose:function(){a=new WeakMap}}}ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Color(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};class DataTexture2DArray extends Texture{constructor(e=null,t=1,r=1,n=1){super(null),this.image={data:e,width:t,height:r,depth:n},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}}DataTexture2DArray.prototype.isDataTexture2DArray=!0;class DataTexture3D extends Texture{constructor(e=null,t=1,r=1,n=1){super(null),this.image={data:e,width:t,height:r,depth:n},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}}DataTexture3D.prototype.isDataTexture3D=!0;const emptyTexture=new Texture,emptyTexture2dArray=new DataTexture2DArray,emptyTexture3d=new DataTexture3D,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(r,n,i){const e=r[0];if(e<=0||0<e)return r;var t=n*i;let o=arrayCacheF32[t];if(void 0===o&&(o=new Float32Array(t),arrayCacheF32[t]=o),0!==n){e.toArray(o,0);for(let e=1,t=0;e!==n;++e)t+=i,r[e].toArray(o,t)}return o}function arraysEqual(r,n){if(r.length!==n.length)return!1;for(let e=0,t=r.length;e<t;e++)if(r[e]!==n[e])return!1;return!0}function copyArray(r,n){for(let e=0,t=n.length;e<t;e++)r[e]=n[e]}function allocTexUnits(t,r){let n=arrayCacheI32[r];void 0===n&&(n=new Int32Array(r),arrayCacheI32[r]=n);for(let e=0;e!==r;++e)n[e]=t.allocateTextureUnit();return n}function setValueV1f(e,t){const r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function setValueV2f(e,t){const r=this.cache;void 0!==t.x?r[0]===t.x&&r[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y):arraysEqual(r,t)||(e.uniform2fv(this.addr,t),copyArray(r,t))}function setValueV3f(e,t){const r=this.cache;void 0!==t.x?r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z):void 0!==t.r?r[0]===t.r&&r[1]===t.g&&r[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b):arraysEqual(r,t)||(e.uniform3fv(this.addr,t),copyArray(r,t))}function setValueV4f(e,t){const r=this.cache;void 0!==t.x?r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w):arraysEqual(r,t)||(e.uniform4fv(this.addr,t),copyArray(r,t))}function setValueM2(e,t){var r=this.cache,n=t.elements;void 0===n?arraysEqual(r,t)||(e.uniformMatrix2fv(this.addr,!1,t),copyArray(r,t)):arraysEqual(r,n)||(mat2array.set(n),e.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(r,n))}function setValueM3(e,t){var r=this.cache,n=t.elements;void 0===n?arraysEqual(r,t)||(e.uniformMatrix3fv(this.addr,!1,t),copyArray(r,t)):arraysEqual(r,n)||(mat3array.set(n),e.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(r,n))}function setValueM4(e,t){var r=this.cache,n=t.elements;void 0===n?arraysEqual(r,t)||(e.uniformMatrix4fv(this.addr,!1,t),copyArray(r,t)):arraysEqual(r,n)||(mat4array.set(n),e.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(r,n))}function setValueV1i(e,t){const r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function setValueV2i(e,t){var r=this.cache;arraysEqual(r,t)||(e.uniform2iv(this.addr,t),copyArray(r,t))}function setValueV3i(e,t){var r=this.cache;arraysEqual(r,t)||(e.uniform3iv(this.addr,t),copyArray(r,t))}function setValueV4i(e,t){var r=this.cache;arraysEqual(r,t)||(e.uniform4iv(this.addr,t),copyArray(r,t))}function setValueV1ui(e,t){const r=this.cache;r[0]!==t&&(e.uniform1ui(this.addr,t),r[0]=t)}function setValueV2ui(e,t){var r=this.cache;arraysEqual(r,t)||(e.uniform2uiv(this.addr,t),copyArray(r,t))}function setValueV3ui(e,t){var r=this.cache;arraysEqual(r,t)||(e.uniform3uiv(this.addr,t),copyArray(r,t))}function setValueV4ui(e,t){var r=this.cache;arraysEqual(r,t)||(e.uniform4uiv(this.addr,t),copyArray(r,t))}function setValueT1(e,t,r){const n=this.cache;var i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.safeSetTexture2D(t||emptyTexture,i)}function setValueT3D1(e,t,r){const n=this.cache;var i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.setTexture3D(t||emptyTexture3d,i)}function setValueT6(e,t,r){const n=this.cache;var i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.safeSetTextureCube(t||emptyCubeTexture,i)}function setValueT2DArray1(e,t,r){const n=this.cache;var i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.setTexture2DArray(t||emptyTexture2dArray,i)}function getSingularSetter(e){switch(e){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 36294:return setValueV2ui;case 36295:return setValueV3ui;case 36296:return setValueV4ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(e,t){e.uniform1fv(this.addr,t)}function setValueV2fArray(e,t){t=flatten(t,this.size,2);e.uniform2fv(this.addr,t)}function setValueV3fArray(e,t){t=flatten(t,this.size,3);e.uniform3fv(this.addr,t)}function setValueV4fArray(e,t){t=flatten(t,this.size,4);e.uniform4fv(this.addr,t)}function setValueM2Array(e,t){t=flatten(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,t)}function setValueM3Array(e,t){t=flatten(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,t)}function setValueM4Array(e,t){t=flatten(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,t)}function setValueV1iArray(e,t){e.uniform1iv(this.addr,t)}function setValueV2iArray(e,t){e.uniform2iv(this.addr,t)}function setValueV3iArray(e,t){e.uniform3iv(this.addr,t)}function setValueV4iArray(e,t){e.uniform4iv(this.addr,t)}function setValueV1uiArray(e,t){e.uniform1uiv(this.addr,t)}function setValueV2uiArray(e,t){e.uniform2uiv(this.addr,t)}function setValueV3uiArray(e,t){e.uniform3uiv(this.addr,t)}function setValueV4uiArray(e,t){e.uniform4uiv(this.addr,t)}function setValueT1Array(e,t,r){var n=t.length,i=allocTexUnits(r,n);e.uniform1iv(this.addr,i);for(let e=0;e!==n;++e)r.safeSetTexture2D(t[e]||emptyTexture,i[e])}function setValueT6Array(e,t,r){var n=t.length,i=allocTexUnits(r,n);e.uniform1iv(this.addr,i);for(let e=0;e!==n;++e)r.safeSetTextureCube(t[e]||emptyCubeTexture,i[e])}function getPureArraySetter(e){switch(e){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 5125:return setValueV1uiArray;case 36294:return setValueV2uiArray;case 36295:return setValueV3uiArray;case 36296:return setValueV4uiArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35680:case 36300:case 36308:case 36293:return setValueT6Array}}function SingleUniform(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=getSingularSetter(t.type)}function PureArrayUniform(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=getPureArraySetter(t.type)}function StructuredUniform(e){this.id=e,this.seq=[],this.map={}}PureArrayUniform.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),copyArray(t,e)},StructuredUniform.prototype.setValue=function(r,n,i){var o=this.seq;for(let e=0,t=o.length;e!==t;++e){const a=o[e];a.setValue(r,n[a.id],i)}};const RePathPart=/(\w+)(\])?(\[|\.)?/g;function addUniform(e,t){e.seq.push(t),e.map[t.id]=t}function parseUniform(e,r,n){var i=e.name,o=i.length;for(RePathPart.lastIndex=0;;){var a=RePathPart.exec(i),s=RePathPart.lastIndex;let t=a[1];var l="]"===a[2],a=a[3];if(l&&(t|=0),void 0===a||"["===a&&s+2===o){addUniform(n,new(void 0===a?SingleUniform:PureArrayUniform)(t,e,r));break}{let e=n.map[t];void 0===e&&(e=new StructuredUniform(t),addUniform(n,e)),n=e}}}function WebGLUniforms(t,r){this.seq=[],this.map={};var n=t.getProgramParameter(r,35718);for(let e=0;e<n;++e){var i=t.getActiveUniform(r,e);parseUniform(i,t.getUniformLocation(r,i.name),this)}}function WebGLShader(e,t,r){t=e.createShader(t);return e.shaderSource(t,r),e.compileShader(t),t}WebGLUniforms.prototype.setValue=function(e,t,r,n){const i=this.map[t];void 0!==i&&i.setValue(e,r,n)},WebGLUniforms.prototype.setOptional=function(e,t,r){t=t[r];void 0!==t&&this.setValue(e,r,t)},WebGLUniforms.upload=function(r,n,i,o){for(let e=0,t=n.length;e!==t;++e){const a=n[e],s=i[a.id];!1!==s.needsUpdate&&a.setValue(r,s.value,o)}},WebGLUniforms.seqWithValue=function(r,n){const i=[];for(let e=0,t=r.length;e!==t;++e){var o=r[e];o.id in n&&i.push(o)}return i};let programIdCount=0;function addLineNumbers(e){const t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}function getEncodingComponents(e){switch(e){case LinearEncoding:return["Linear","( value )"];case sRGBEncoding:return["sRGB","( value )"];case RGBEEncoding:return["RGBE","( value )"];case RGBM7Encoding:return["RGBM","( value, 7.0 )"];case RGBM16Encoding:return["RGBM","( value, 16.0 )"];case RGBDEncoding:return["RGBD","( value, 256.0 )"];case GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case LogLuvEncoding:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function getShaderErrors(e,t,r){var n=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();return n&&""===i?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+r+"\n"+i+addLineNumbers(e.getShaderSource(t))}function getTexelDecodingFunction(e,t){t=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function getTexelEncodingFunction(e,t){t=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function getToneMappingFunction(e,t){let r;switch(t){case LinearToneMapping:r="Linear";break;case ReinhardToneMapping:r="Reinhard";break;case CineonToneMapping:r="OptimizedCineon";break;case ACESFilmicToneMapping:r="ACESFilmic";break;case CustomToneMapping:r="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),r="Linear"}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function generateExtensions(e){const t=[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""];return t.filter(filterEmptyLine).join("\n")}function generateDefines(e){const t=[];for(const n in e){var r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}function fetchAttributeLocations(t,r){const n={};var i=t.getProgramParameter(r,35721);for(let e=0;e<i;e++){var o=t.getActiveAttrib(r,e).name;n[o]=t.getAttribLocation(r,o)}return n}function filterEmptyLine(e){return""!==e}function replaceLightNums(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function replaceClippingPlaneNums(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(e){return e.replace(includePattern,includeReplacer)}function includeReplacer(e,t){var r=ShaderChunk[t];if(void 0===r)throw new Error("Can not resolve #include <"+t+">");return resolveIncludes(r)}const deprecatedUnrollLoopPattern=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,unrollLoopPattern=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(e){return e.replace(unrollLoopPattern,loopReplacer).replace(deprecatedUnrollLoopPattern,deprecatedLoopReplacer)}function deprecatedLoopReplacer(e,t,r,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),loopReplacer(e,t,r,n)}function loopReplacer(e,t,r,n){let i="";for(let e=parseInt(t);e<parseInt(r);e++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return i}function generatePrecision(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function generateShadowMapTypeDefine(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===PCFShadowMap?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===PCFSoftShadowMap?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===VSMShadowMap&&(t="SHADOWMAP_TYPE_VSM"),t}function generateEnvMapTypeDefine(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:t="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:case CubeUVRefractionMapping:t="ENVMAP_TYPE_CUBE_UV"}return t}function generateEnvMapModeDefine(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case CubeRefractionMapping:case CubeUVRefractionMapping:t="ENVMAP_MODE_REFRACTION"}return t}function generateEnvMapBlendingDefine(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case MultiplyOperation:t="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:t="ENVMAP_BLENDING_MIX";break;case AddOperation:t="ENVMAP_BLENDING_ADD"}return t}function WebGLProgram(r,e,t,n){const i=r.getContext();var o=t.defines,a=t.vertexShader,s=t.fragmentShader,l=generateShadowMapTypeDefine(t),c=generateEnvMapTypeDefine(t),h=generateEnvMapModeDefine(t),u=generateEnvMapBlendingDefine(t),A=0<r.gammaFactor?r.gammaFactor:1;const d=t.isWebGL2?"":generateExtensions(t),p=generateDefines(o),m=i.createProgram();let f,g,v=t.glslVersion?"#version "+t.glslVersion+"\n":"";t.isRawShaderMaterial?(f=[p].filter(filterEmptyLine).join("\n"),0<f.length&&(f+="\n"),g=[d,p].filter(filterEmptyLine).join("\n"),0<g.length&&(g+="\n")):(f=[generatePrecision(t),"#define SHADER_NAME "+t.shaderName,p,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+A,"#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&!1===t.flatShading?"#define USE_MORPHNORMALS":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(filterEmptyLine).join("\n"),g=[d,generatePrecision(t),"#define SHADER_NAME "+t.shaderName,p,t.alphaTest?"#define ALPHATEST "+t.alphaTest+(t.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+A,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.sheen?"#define USE_SHEEN":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",t.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",t.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",ShaderChunk.encodings_pars_fragment,t.map?getTexelDecodingFunction("mapTexelToLinear",t.mapEncoding):"",t.matcap?getTexelDecodingFunction("matcapTexelToLinear",t.matcapEncoding):"",t.envMap?getTexelDecodingFunction("envMapTexelToLinear",t.envMapEncoding):"",t.emissiveMap?getTexelDecodingFunction("emissiveMapTexelToLinear",t.emissiveMapEncoding):"",t.lightMap?getTexelDecodingFunction("lightMapTexelToLinear",t.lightMapEncoding):"",getTexelEncodingFunction("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter(filterEmptyLine).join("\n")),a=replaceClippingPlaneNums(replaceLightNums(resolveIncludes(a),t),t),s=replaceClippingPlaneNums(replaceLightNums(resolveIncludes(s),t),t),a=unrollLoops(a),s=unrollLoops(s),t.isWebGL2&&!0!==t.isRawShaderMaterial&&(v="#version 300 es\n",f=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+f,g=["#define varying in",t.glslVersion===GLSL3?"":"out highp vec4 pc_fragColor;",t.glslVersion===GLSL3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+g);c=v+f+a,h=v+g+s,u=WebGLShader(i,35633,c),l=WebGLShader(i,35632,h);if(i.attachShader(m,u),i.attachShader(m,l),void 0!==t.index0AttributeName?i.bindAttribLocation(m,0,t.index0AttributeName):!0===t.morphTargets&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),r.debug.checkShaderErrors){a=i.getProgramInfoLog(m).trim(),s=i.getShaderInfoLog(u).trim(),c=i.getShaderInfoLog(l).trim();let e=!0,t=!0;!1===i.getProgramParameter(m,35714)?(e=!1,h=getShaderErrors(i,u,"vertex"),r=getShaderErrors(i,l,"fragment"),console.error("THREE.WebGLProgram: shader error: ",i.getError(),"35715",i.getProgramParameter(m,35715),"gl.getProgramInfoLog",a,h,r)):""!==a?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",a):""!==s&&""!==c||(t=!1),t&&(this.diagnostics={runnable:e,programLog:a,vertexShader:{log:s,prefix:f},fragmentShader:{log:c,prefix:g}})}i.deleteShader(u),i.deleteShader(l);let _;this.getUniforms=function(){return void 0===_&&(_=new WebGLUniforms(i,m)),_};let y;return this.getAttributes=function(){return void 0===y&&(y=fetchAttributeLocations(i,m)),y},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.name=t.shaderName,this.id=programIdCount++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=u,this.fragmentShader=l,this}function WebGLPrograms(A,d,p,m,t,f){const o=[],g=m.isWebGL2,v=m.logarithmicDepthBuffer,_=m.floatVertexTextures,y=m.maxVertexUniforms,w=m.vertexTextures;let x=m.precision;const b={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},n=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function T(e){let t;return t=e&&e.isTexture?e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e.texture.encoding):LinearEncoding,t}return{getParameters:function(e,t,r,n,i){var o=n.fog,a=e.isMeshStandardMaterial?n.environment:null,s=d.get(e.envMap||a),n=b[e.type],l=i.isSkinnedMesh?(a=(l=i).skeleton.bones,_?1024:(l=y,l=Math.floor((l-20)/4),(l=Math.min(l,a.length))<a.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+a.length+" bones. This GPU supports "+l+"."),0):l)):0;null!==e.precision&&(x=m.getMaxPrecision(e.precision),x!==e.precision&&console.warn("THREE.WebGLProgram.getParameters:",e.precision,"not supported, using",x,"instead."));let c,h;h=n?(u=ShaderLib[n],c=u.vertexShader,u.fragmentShader):(c=e.vertexShader,e.fragmentShader);var u=A.getRenderTarget();return{isWebGL2:g,shaderID:n,shaderName:e.type,vertexShader:c,fragmentShader:h,defines:e.defines,isRawShaderMaterial:!0===e.isRawShaderMaterial,glslVersion:e.glslVersion,precision:x,instancing:!0===i.isInstancedMesh,instancingColor:!0===i.isInstancedMesh&&null!==i.instanceColor,supportsVertexTextures:w,outputEncoding:null!==u?T(u.texture):A.outputEncoding,map:!!e.map,mapEncoding:T(e.map),matcap:!!e.matcap,matcapEncoding:T(e.matcap),envMap:!!s,envMapMode:s&&s.mapping,envMapEncoding:T(s),envMapCubeUV:!!s&&(s.mapping===CubeUVReflectionMapping||s.mapping===CubeUVRefractionMapping),lightMap:!!e.lightMap,lightMapEncoding:T(e.lightMap),aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,emissiveMapEncoding:T(e.emissiveMap),bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,objectSpaceNormalMap:e.normalMapType===ObjectSpaceNormalMap,tangentSpaceNormalMap:e.normalMapType===TangentSpaceNormalMap,clearcoatMap:!!e.clearcoatMap,clearcoatRoughnessMap:!!e.clearcoatRoughnessMap,clearcoatNormalMap:!!e.clearcoatNormalMap,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,gradientMap:!!e.gradientMap,sheen:!!e.sheen,transmissionMap:!!e.transmissionMap,combine:e.combine,vertexTangents:e.normalMap&&e.vertexTangents,vertexColors:e.vertexColors,vertexAlphas:!0===e.vertexColors&&i.geometry.attributes.color&&4===i.geometry.attributes.color.itemSize,vertexUvs:!!(e.map||e.bumpMap||e.normalMap||e.specularMap||e.alphaMap||e.emissiveMap||e.roughnessMap||e.metalnessMap||e.clearcoatMap||e.clearcoatRoughnessMap||e.clearcoatNormalMap||e.displacementMap||e.transmissionMap),uvsVertexOnly:!(e.map||e.bumpMap||e.normalMap||e.specularMap||e.alphaMap||e.emissiveMap||e.roughnessMap||e.metalnessMap||e.clearcoatNormalMap||e.transmissionMap||!e.displacementMap),fog:!!o,useFog:e.fog,fogExp2:o&&o.isFogExp2,flatShading:!!e.flatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:v,skinning:e.skinning&&0<l,maxBones:l,useVertexTexture:_,morphTargets:e.morphTargets,morphNormals:e.morphNormals,numDirLights:t.directional.length,numPointLights:t.point.length,numSpotLights:t.spot.length,numRectAreaLights:t.rectArea.length,numHemiLights:t.hemi.length,numDirLightShadows:t.directionalShadowMap.length,numPointLightShadows:t.pointShadowMap.length,numSpotLightShadows:t.spotShadowMap.length,numClippingPlanes:f.numPlanes,numClipIntersection:f.numIntersection,dithering:e.dithering,shadowMapEnabled:A.shadowMap.enabled&&0<r.length,shadowMapType:A.shadowMap.type,toneMapping:e.toneMapped?A.toneMapping:NoToneMapping,physicallyCorrectLights:A.physicallyCorrectLights,premultipliedAlpha:e.premultipliedAlpha,alphaTest:e.alphaTest,doubleSided:e.side===DoubleSide,flipSided:e.side===BackSide,depthPacking:void 0!==e.depthPacking&&e.depthPacking,index0AttributeName:e.index0AttributeName,extensionDerivatives:e.extensions&&e.extensions.derivatives,extensionFragDepth:e.extensions&&e.extensions.fragDepth,extensionDrawBuffers:e.extensions&&e.extensions.drawBuffers,extensionShaderTextureLOD:e.extensions&&e.extensions.shaderTextureLOD,rendererExtensionFragDepth:g||p.has("EXT_frag_depth"),rendererExtensionDrawBuffers:g||p.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:g||p.has("EXT_shader_texture_lod"),customProgramCacheKey:e.customProgramCacheKey()}},getProgramCacheKey:function(t){const r=[];if(t.shaderID?r.push(t.shaderID):(r.push(t.fragmentShader),r.push(t.vertexShader)),void 0!==t.defines)for(const e in t.defines)r.push(e),r.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<n.length;e++)r.push(t[n[e]]);r.push(A.outputEncoding),r.push(A.gammaFactor)}return r.push(t.customProgramCacheKey),r.join()},getUniforms:function(e){var t=b[e.type];let r;return r=t?(t=ShaderLib[t],UniformsUtils.clone(t.uniforms)):e.uniforms,r},acquireProgram:function(e,r){let n;for(let e=0,t=o.length;e<t;e++){var i=o[e];if(i.cacheKey===r){n=i,++n.usedTimes;break}}return void 0===n&&(n=new WebGLProgram(A,r,e,t),o.push(n)),n},releaseProgram:function(e){var t;0==--e.usedTimes&&(t=o.indexOf(e),o[t]=o[o.length-1],o.pop(),e.destroy())},programs:o}}function WebGLProperties(){let n=new WeakMap;return{get:function(e){let t=n.get(e);return void 0===t&&(t={},n.set(e,t)),t},remove:function(e){n.delete(e)},update:function(e,t,r){n.get(e)[t]=r},dispose:function(){n=new WeakMap}}}function painterSortStable(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function reversePainterSortStable(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function WebGLRenderList(l){const c=[];let h=0;const a=[],s=[],u={id:-1};function A(e,t,r,n,i,o){let a=c[h];var s=l.get(r);return void 0===a?(a={id:e.id,object:e,geometry:t,material:r,program:s.program||u,groupOrder:n,renderOrder:e.renderOrder,z:i,group:o},c[h]=a):(a.id=e.id,a.object=e,a.geometry=t,a.material=r,a.program=s.program||u,a.groupOrder=n,a.renderOrder=e.renderOrder,a.z=i,a.group=o),h++,a}return{opaque:a,transparent:s,init:function(){h=0,a.length=0,s.length=0},push:function(e,t,r,n,i,o){o=A(e,t,r,n,i,o),(!0===r.transparent?s:a).push(o)},unshift:function(e,t,r,n,i,o){o=A(e,t,r,n,i,o),(!0===r.transparent?s:a).unshift(o)},finish:function(){for(let e=h,t=c.length;e<t;e++){const r=c[e];if(null===r.id)break;r.id=null,r.object=null,r.geometry=null,r.material=null,r.program=null,r.group=null}},sort:function(e,t){1<a.length&&a.sort(e||painterSortStable),1<s.length&&s.sort(t||reversePainterSortStable)}}}function WebGLRenderLists(n){let i=new WeakMap;return{get:function(e,t){let r;return!1===i.has(e)?(r=new WebGLRenderList(n),i.set(e,[r])):t>=i.get(e).length?(r=new WebGLRenderList(n),i.get(e).push(r)):r=i.get(e)[t],r},dispose:function(){i=new WeakMap}}}function UniformsCache(){const r={};return{get:function(e){if(void 0!==r[e.id])return r[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Vector3,color:new Color};break;case"SpotLight":t={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":t={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3}}return r[e.id]=t,t}}}function ShadowUniformsCache(){const r={};return{get:function(e){if(void 0!==r[e.id])return r[e.id];let t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3}}return r[e.id]=t,t}}}let nextVersion=0;function shadowCastingLightsFirst(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function WebGLLights(t,S){const M=new UniformsCache,N=ShadowUniformsCache(),L={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)L.probe.push(new Vector3);const m=new Vector3,f=new Matrix4,g=new Matrix4;return{setup:function(r){let n=0,i=0,o=0;for(let e=0;e<9;e++)L.probe[e].set(0,0,0);let a=0,s=0,l=0,c=0,h=0,u=0,A=0,d=0;r.sort(shadowCastingLightsFirst);for(let e=0,t=r.length;e<t;e++){var p=r[e],m=p.color,f=p.intensity,g=p.distance,v=p.shadow&&p.shadow.map?p.shadow.map.texture:null;if(p.isAmbientLight)n+=m.r*f,i+=m.g*f,o+=m.b*f;else if(p.isLightProbe)for(let e=0;e<9;e++)L.probe[e].addScaledVector(p.sh.coefficients[e],f);else if(p.isDirectionalLight){const y=M.get(p);if(y.color.copy(p.color).multiplyScalar(p.intensity),p.castShadow){var _=p.shadow;const w=N.get(p);w.shadowBias=_.bias,w.shadowNormalBias=_.normalBias,w.shadowRadius=_.radius,w.shadowMapSize=_.mapSize,L.directionalShadow[a]=w,L.directionalShadowMap[a]=v,L.directionalShadowMatrix[a]=p.shadow.matrix,u++}L.directional[a]=y,a++}else if(p.isSpotLight){const x=M.get(p);if(x.position.setFromMatrixPosition(p.matrixWorld),x.color.copy(m).multiplyScalar(f),x.distance=g,x.coneCos=Math.cos(p.angle),x.penumbraCos=Math.cos(p.angle*(1-p.penumbra)),x.decay=p.decay,p.castShadow){g=p.shadow;const b=N.get(p);b.shadowBias=g.bias,b.shadowNormalBias=g.normalBias,b.shadowRadius=g.radius,b.shadowMapSize=g.mapSize,L.spotShadow[l]=b,L.spotShadowMap[l]=v,L.spotShadowMatrix[l]=p.shadow.matrix,d++}L.spot[l]=x,l++}else if(p.isRectAreaLight){const T=M.get(p);T.color.copy(m).multiplyScalar(f),T.halfWidth.set(.5*p.width,0,0),T.halfHeight.set(0,.5*p.height,0),L.rectArea[c]=T,c++}else if(p.isPointLight){const E=M.get(p);if(E.color.copy(p.color).multiplyScalar(p.intensity),E.distance=p.distance,E.decay=p.decay,p.castShadow){m=p.shadow;const B=N.get(p);B.shadowBias=m.bias,B.shadowNormalBias=m.normalBias,B.shadowRadius=m.radius,B.shadowMapSize=m.mapSize,B.shadowCameraNear=m.camera.near,B.shadowCameraFar=m.camera.far,L.pointShadow[s]=B,L.pointShadowMap[s]=v,L.pointShadowMatrix[s]=p.shadow.matrix,A++}L.point[s]=E,s++}else if(p.isHemisphereLight){const C=M.get(p);C.skyColor.copy(p.color).multiplyScalar(f),C.groundColor.copy(p.groundColor).multiplyScalar(f),L.hemi[h]=C,h++}}0<c&&(S.isWebGL2||!0===t.has("OES_texture_float_linear")?(L.rectAreaLTC1=UniformsLib.LTC_FLOAT_1,L.rectAreaLTC2=UniformsLib.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(L.rectAreaLTC1=UniformsLib.LTC_HALF_1,L.rectAreaLTC2=UniformsLib.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),L.ambient[0]=n,L.ambient[1]=i,L.ambient[2]=o;const e=L.hash;e.directionalLength===a&&e.pointLength===s&&e.spotLength===l&&e.rectAreaLength===c&&e.hemiLength===h&&e.numDirectionalShadows===u&&e.numPointShadows===A&&e.numSpotShadows===d||(L.directional.length=a,L.spot.length=l,L.rectArea.length=c,L.point.length=s,L.hemi.length=h,L.directionalShadow.length=u,L.directionalShadowMap.length=u,L.pointShadow.length=A,L.pointShadowMap.length=A,L.spotShadow.length=d,L.spotShadowMap.length=d,L.directionalShadowMatrix.length=u,L.pointShadowMatrix.length=A,L.spotShadowMatrix.length=d,e.directionalLength=a,e.pointLength=s,e.spotLength=l,e.rectAreaLength=c,e.hemiLength=h,e.numDirectionalShadows=u,e.numPointShadows=A,e.numSpotShadows=d,L.version=nextVersion++)},setupView:function(r,e){let n=0,i=0,o=0,a=0,s=0;var l=e.matrixWorldInverse;for(let e=0,t=r.length;e<t;e++){var c=r[e];if(c.isDirectionalLight){const h=L.directional[n];h.direction.setFromMatrixPosition(c.matrixWorld),m.setFromMatrixPosition(c.target.matrixWorld),h.direction.sub(m),h.direction.transformDirection(l),n++}else if(c.isSpotLight){const u=L.spot[o];u.position.setFromMatrixPosition(c.matrixWorld),u.position.applyMatrix4(l),u.direction.setFromMatrixPosition(c.matrixWorld),m.setFromMatrixPosition(c.target.matrixWorld),u.direction.sub(m),u.direction.transformDirection(l),o++}else if(c.isRectAreaLight){const A=L.rectArea[a];A.position.setFromMatrixPosition(c.matrixWorld),A.position.applyMatrix4(l),g.identity(),f.copy(c.matrixWorld),f.premultiply(l),g.extractRotation(f),A.halfWidth.set(.5*c.width,0,0),A.halfHeight.set(0,.5*c.height,0),A.halfWidth.applyMatrix4(g),A.halfHeight.applyMatrix4(g),a++}else if(c.isPointLight){const d=L.point[i];d.position.setFromMatrixPosition(c.matrixWorld),d.position.applyMatrix4(l),i++}else if(c.isHemisphereLight){const p=L.hemi[s];p.direction.setFromMatrixPosition(c.matrixWorld),p.direction.transformDirection(l),p.direction.normalize(),s++}}},state:L}}function WebGLRenderState(e,t){const r=new WebGLLights(e,t),n=[],i=[];return{init:function(){n.length=0,i.length=0},state:{lightsArray:n,shadowsArray:i,lights:r},setupLights:function(){r.setup(n)},setupLightsView:function(e){r.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){i.push(e)}}}function WebGLRenderStates(n,i){let o=new WeakMap;return{get:function(e,t=0){let r;return!1===o.has(e)?(r=new WebGLRenderState(n,i),o.set(e,[r])):t>=o.get(e).length?(r=new WebGLRenderState(n,i),o.get(e).push(r)):r=o.get(e)[t],r},dispose:function(){o=new WeakMap}}}class MeshDepthMaterial extends Material{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}MeshDepthMaterial.prototype.isMeshDepthMaterial=!0;class MeshDistanceMaterial extends Material{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new Vector3,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}MeshDistanceMaterial.prototype.isMeshDistanceMaterial=!0;var vsm_frag="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",vsm_vert="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function WebGLShadowMap(m,f,e){let g=new Frustum;const p=new Vector2,v=new Vector2,_=new Vector4,i=[],o=[],u={},y=e.maxTextureSize,A={0:BackSide,1:FrontSide,2:DoubleSide},w=new ShaderMaterial({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vsm_vert,fragmentShader:vsm_frag}),x=w.clone();x.defines.HORIZONTAL_PASS=1;const t=new BufferGeometry;t.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const b=new Mesh(t,w),T=this;function d(e,t,r){r=e<<0|t<<1|r<<2;let n=i[r];return void 0===n&&(n=new MeshDepthMaterial({depthPacking:RGBADepthPacking,morphTargets:e,skinning:t}),i[r]=n),n}function E(e,t,r){r=e<<0|t<<1|r<<2;let n=o[r];return void 0===n&&(n=new MeshDistanceMaterial({morphTargets:e,skinning:t}),o[r]=n),n}function B(r,n,i,e,t,o,a){let s=null,l=d,c=r.customDepthMaterial;if(!0===e.isPointLight&&(l=E,c=r.customDistanceMaterial),void 0===c){let e=!1;!0===i.morphTargets&&(e=n.morphAttributes&&n.morphAttributes.position&&0<n.morphAttributes.position.length);let t=!1;!0===r.isSkinnedMesh&&(!0===i.skinning?t=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",r));var h=!0===r.isInstancedMesh;s=l(e,t,h)}else s=c;if(m.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){r=s.uuid,h=i.uuid;let e=u[r];void 0===e&&(e={},u[r]=e);let t=e[h];void 0===t&&(t=s.clone(),e[h]=t),s=t}return s.visible=i.visible,s.wireframe=i.wireframe,a===VSMShadowMap?s.side=null!==i.shadowSide?i.shadowSide:i.side:s.side=null!==i.shadowSide?i.shadowSide:A[i.side],s.clipShadows=i.clipShadows,s.clippingPlanes=i.clippingPlanes,s.clipIntersection=i.clipIntersection,s.wireframeLinewidth=i.wireframeLinewidth,s.linewidth=i.linewidth,!0===e.isPointLight&&!0===s.isMeshDistanceMaterial&&(s.referencePosition.setFromMatrixPosition(e.matrixWorld),s.nearDistance=t,s.farDistance=o),s}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap,this.render=function(r,n,i){if(!1!==T.enabled&&(!1!==T.autoUpdate||!1!==T.needsUpdate)&&0!==r.length){var e=m.getRenderTarget(),t=m.getActiveCubeFace(),o=m.getActiveMipmapLevel();const A=m.state;A.setBlending(NoBlending),A.buffers.color.setClear(1,1,1,1),A.buffers.depth.setTest(!0),A.setScissorTest(!1);for(let e=0,t=r.length;e<t;e++){var a=r[e];const d=a.shadow;if(void 0!==d){if(!1!==d.autoUpdate||!1!==d.needsUpdate){p.copy(d.mapSize);var s,l,c=d.getFrameExtents();p.multiply(c),v.copy(d.mapSize),(p.x>y||p.y>y)&&(p.x>y&&(v.x=Math.floor(y/c.x),p.x=v.x*c.x,d.mapSize.x=v.x),p.y>y&&(v.y=Math.floor(y/c.y),p.y=v.y*c.y,d.mapSize.y=v.y)),null!==d.map||d.isPointLightShadow||this.type!==VSMShadowMap||(s={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat},d.map=new WebGLRenderTarget(p.x,p.y,s),d.map.texture.name=a.name+".shadowMap",d.mapPass=new WebGLRenderTarget(p.x,p.y,s),d.camera.updateProjectionMatrix()),null===d.map&&(l={minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat},d.map=new WebGLRenderTarget(p.x,p.y,l),d.map.texture.name=a.name+".shadowMap",d.camera.updateProjectionMatrix()),m.setRenderTarget(d.map),m.clear();var h=d.getViewportCount();for(let e=0;e<h;e++){var u=d.getViewport(e);_.set(v.x*u.x,v.y*u.y,v.x*u.z,v.y*u.w),A.viewport(_),d.updateMatrices(a,e),g=d.getFrustum(),function r(n,i,o,a,s){if(!1===n.visible)return;const e=n.layers.test(i.layers);if(e&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&s===VSMShadowMap)&&(!n.frustumCulled||g.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const c=f.update(n),h=n.material;if(Array.isArray(h)){const u=c.groups;for(let e=0,t=u.length;e<t;e++){const A=u[e],d=h[A.materialIndex];if(d&&d.visible){const p=B(n,c,d,a,o.near,o.far,s);m.renderBufferDirect(o,null,c,p,n,A)}}}else if(h.visible){const t=B(n,c,h,a,o.near,o.far,s);m.renderBufferDirect(o,null,c,t,n,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)r(l[e],i,o,a,s)}(n,i,d.camera,a,this.type)}d.isPointLightShadow||this.type!==VSMShadowMap||(c=d,s=i,l=void 0,l=f.update(b),w.uniforms.shadow_pass.value=c.map.texture,w.uniforms.resolution.value=c.mapSize,w.uniforms.radius.value=c.radius,m.setRenderTarget(c.mapPass),m.clear(),m.renderBufferDirect(s,null,l,w,b,null),x.uniforms.shadow_pass.value=c.mapPass.texture,x.uniforms.resolution.value=c.mapSize,x.uniforms.radius.value=c.radius,m.setRenderTarget(c.map),m.clear(),m.renderBufferDirect(s,null,l,x,b,null)),d.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",a,"has no shadow.")}T.needsUpdate=!1,m.setRenderTarget(e,t,o)}}}function WebGLState(h,e,t){const r=t.isWebGL2;const n=new function(){let t=!1;const o=new Vector4;let r=null;const a=new Vector4(0,0,0,0);return{setMask:function(e){r===e||t||(h.colorMask(e,e,e,e),r=e)},setLocked:function(e){t=e},setClear:function(e,t,r,n,i){!0===i&&(e*=n,t*=n,r*=n),o.set(e,t,r,n),!1===a.equals(o)&&(h.clearColor(e,t,r,n),a.copy(o))},reset:function(){t=!1,r=null,a.set(-1,0,0,0)}}},i=new function(){let t=!1,r=null,n=null,i=null;return{setTest:function(e){(e?I:P)(2929)},setMask:function(e){r===e||t||(h.depthMask(e),r=e)},setFunc:function(e){if(n!==e){if(e)switch(e){case NeverDepth:h.depthFunc(512);break;case AlwaysDepth:h.depthFunc(519);break;case LessDepth:h.depthFunc(513);break;case LessEqualDepth:h.depthFunc(515);break;case EqualDepth:h.depthFunc(514);break;case GreaterEqualDepth:h.depthFunc(518);break;case GreaterDepth:h.depthFunc(516);break;case NotEqualDepth:h.depthFunc(517);break;default:h.depthFunc(515)}else h.depthFunc(515);n=e}},setLocked:function(e){t=e},setClear:function(e){i!==e&&(h.clearDepth(e),i=e)},reset:function(){t=!1,r=null,n=null,i=null}}},o=new function(){let t=!1,r=null,n=null,i=null,o=null,a=null,s=null,l=null,c=null;return{setTest:function(e){t||(e?I:P)(2960)},setMask:function(e){r===e||t||(h.stencilMask(e),r=e)},setFunc:function(e,t,r){n===e&&i===t&&o===r||(h.stencilFunc(e,t,r),n=e,i=t,o=r)},setOp:function(e,t,r){a===e&&s===t&&l===r||(h.stencilOp(e,t,r),a=e,s=t,l=r)},setLocked:function(e){t=e},setClear:function(e){c!==e&&(h.clearStencil(e),c=e)},reset:function(){t=!1,r=null,n=null,i=null,o=null,a=null,s=null,l=null,c=null}}};let a={},s=null,l={},c=null,u=!1,A=null,d=null,p=null,m=null,f=null,g=null,v=null,_=!1,y=null,w=null,x=null,b=null,T=null;const E=h.getParameter(35661);let B=!1,C=0;const S=h.getParameter(7938);-1!==S.indexOf("WebGL")?(C=parseFloat(/^WebGL (\d)/.exec(S)[1]),B=1<=C):-1!==S.indexOf("OpenGL ES")&&(C=parseFloat(/^OpenGL ES (\d)/.exec(S)[1]),B=2<=C);let M=null,N={};const L=new Vector4(0,0,h.canvas.width,h.canvas.height),F=new Vector4(0,0,h.canvas.width,h.canvas.height);function U(e,t,r){var n=new Uint8Array(4),i=h.createTexture();h.bindTexture(e,i),h.texParameteri(e,10241,9728),h.texParameteri(e,10240,9728);for(let e=0;e<r;e++)h.texImage2D(t+e,0,6408,1,1,0,6408,5121,n);return i}const R={};function I(e){!0!==a[e]&&(h.enable(e),a[e]=!0)}function P(e){!1!==a[e]&&(h.disable(e),a[e]=!1)}R[3553]=U(3553,3553,1),R[34067]=U(34067,34069,6),n.setClear(0,0,0,1),i.setClear(1),o.setClear(0),I(2929),i.setFunc(LessEqualDepth),Q(!1),k(CullFaceBack),I(2884),H(NoBlending);const O={[AddEquation]:32774,[SubtractEquation]:32778,[ReverseSubtractEquation]:32779};r?(O[MinEquation]=32775,O[MaxEquation]=32776):null!==(e=e.get("EXT_blend_minmax"))&&(O[MinEquation]=e.MIN_EXT,O[MaxEquation]=e.MAX_EXT);const D={[ZeroFactor]:0,[OneFactor]:1,[SrcColorFactor]:768,[SrcAlphaFactor]:770,[SrcAlphaSaturateFactor]:776,[DstColorFactor]:774,[DstAlphaFactor]:772,[OneMinusSrcColorFactor]:769,[OneMinusSrcAlphaFactor]:771,[OneMinusDstColorFactor]:775,[OneMinusDstAlphaFactor]:773};function H(e,t,r,n,i,o,a,s){if(e!==NoBlending){if(!1===u&&(I(3042),u=!0),e===CustomBlending)i=i||t,o=o||r,a=a||n,t===d&&i===f||(h.blendEquationSeparate(O[t],O[i]),d=t,f=i),r===p&&n===m&&o===g&&a===v||(h.blendFuncSeparate(D[r],D[n],D[o],D[a]),p=r,m=n,g=o,v=a),A=e,_=null;else if(e!==A||s!==_){if(d===AddEquation&&f===AddEquation||(h.blendEquation(32774),d=AddEquation,f=AddEquation),s)switch(e){case NormalBlending:h.blendFuncSeparate(1,771,1,771);break;case AdditiveBlending:h.blendFunc(1,1);break;case SubtractiveBlending:h.blendFuncSeparate(0,0,769,771);break;case MultiplyBlending:h.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case NormalBlending:h.blendFuncSeparate(770,771,1,771);break;case AdditiveBlending:h.blendFunc(770,1);break;case SubtractiveBlending:h.blendFunc(0,769);break;case MultiplyBlending:h.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}p=null,m=null,g=null,v=null,A=e,_=s}}else!0===u&&(P(3042),u=!1)}function Q(e){y!==e&&(e?h.frontFace(2304):h.frontFace(2305),y=e)}function k(e){e!==CullFaceNone?(I(2884),e!==w&&(e===CullFaceBack?h.cullFace(1029):e===CullFaceFront?h.cullFace(1028):h.cullFace(1032))):P(2884),w=e}function V(e,t,r){e?(I(32823),b===t&&T===r||(h.polygonOffset(t,r),b=t,T=r)):P(32823)}function G(e){void 0===e&&(e=33984+E-1),M!==e&&(h.activeTexture(e),M=e)}return{buffers:{color:n,depth:i,stencil:o},enable:I,disable:P,bindFramebuffer:function(e,t){null===t&&null!==s&&(t=s),l[e]!==t&&(h.bindFramebuffer(e,t),l[e]=t)},bindXRFramebuffer:function(e){e!==s&&(h.bindFramebuffer(36160,e),s=e)},useProgram:function(e){return c!==e&&(h.useProgram(e),c=e,!0)},setBlending:H,setMaterial:function(e,t){(e.side===DoubleSide?P:I)(2884);let r=e.side===BackSide;t&&(r=!r),Q(r),e.blending===NormalBlending&&!1===e.transparent?H(NoBlending):H(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),i.setFunc(e.depthFunc),i.setTest(e.depthTest),i.setMask(e.depthWrite),n.setMask(e.colorWrite),t=e.stencilWrite,o.setTest(t),t&&(o.setMask(e.stencilWriteMask),o.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),o.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),V(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),(!0===e.alphaToCoverage?I:P)(32926)},setFlipSided:Q,setCullFace:k,setLineWidth:function(e){e!==x&&(B&&h.lineWidth(e),x=e)},setPolygonOffset:V,setScissorTest:function(e){(e?I:P)(3089)},activeTexture:G,bindTexture:function(e,t){null===M&&G();let r=N[M];void 0===r&&(r={type:void 0,texture:void 0},N[M]=r),r.type===e&&r.texture===t||(h.bindTexture(e,t||R[e]),r.type=e,r.texture=t)},unbindTexture:function(){const e=N[M];void 0!==e&&void 0!==e.type&&(h.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{h.compressedTexImage2D.apply(h,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{h.texImage2D.apply(h,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{h.texImage3D.apply(h,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(e){!1===L.equals(e)&&(h.scissor(e.x,e.y,e.z,e.w),L.copy(e))},viewport:function(e){!1===F.equals(e)&&(h.viewport(e.x,e.y,e.z,e.w),F.copy(e))},reset:function(){h.disable(3042),h.disable(2884),h.disable(2929),h.disable(32823),h.disable(3089),h.disable(2960),h.disable(32926),h.blendEquation(32774),h.blendFunc(1,0),h.blendFuncSeparate(1,0,1,0),h.colorMask(!0,!0,!0,!0),h.clearColor(0,0,0,0),h.depthMask(!0),h.depthFunc(513),h.clearDepth(1),h.stencilMask(4294967295),h.stencilFunc(519,0,4294967295),h.stencilOp(7680,7680,7680),h.clearStencil(0),h.cullFace(1029),h.frontFace(2305),h.polygonOffset(0,0),h.activeTexture(33984),h.bindFramebuffer(36160,null),!0===r&&(h.bindFramebuffer(36009,null),h.bindFramebuffer(36008,null)),h.useProgram(null),h.lineWidth(1),h.scissor(0,0,h.canvas.width,h.canvas.height),h.viewport(0,0,h.canvas.width,h.canvas.height),a={},M=null,N={},s=null,l={},c=null,u=!1,A=null,d=null,p=null,m=null,f=null,g=null,v=null,_=!1,y=null,w=null,x=null,b=null,T=null,L.set(0,0,h.canvas.width,h.canvas.height),F.set(0,0,h.canvas.width,h.canvas.height),n.reset(),i.reset(),o.reset()}}}function WebGLTextures(p,i,m,c,n,f,h){const g=n.isWebGL2,t=n.maxTextures,v=n.maxCubemapSize,u=n.maxTextureSize,r=n.maxSamples,o=new WeakMap;let l,a=!1;try{a="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function A(e,t){return a?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function _(e,t,r,n){let i=1;if((e.width>n||e.height>n)&&(i=n/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const o=t?MathUtils.floorPowerOfTwo:Math.floor;n=o(i*e.width),t=o(i*e.height);void 0===l&&(l=A(n,t));const a=r?A(n,t):l;a.width=n,a.height=t;const s=a.getContext("2d");return s.drawImage(e,0,0,n,t),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+n+"x"+t+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function y(e){return MathUtils.isPowerOfTwo(e.width)&&MathUtils.isPowerOfTwo(e.height)}function w(e,t){return e.generateMipmaps&&t&&e.minFilter!==NearestFilter&&e.minFilter!==LinearFilter}function x(e,t,r,n){p.generateMipmap(e);const i=c.get(t);i.__maxMipLevel=Math.log2(Math.max(r,n))}function b(e,t,r){if(!1===g)return t;if(null!==e){if(void 0!==p[e])return p[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let n=t;return 6403===t&&(5126===r&&(n=33326),5131===r&&(n=33325),5121===r&&(n=33321)),6407===t&&(5126===r&&(n=34837),5131===r&&(n=34843),5121===r&&(n=32849)),6408===t&&(5126===r&&(n=34836),5131===r&&(n=34842),5121===r&&(n=32856)),33325!==n&&33326!==n&&34842!==n&&34836!==n||i.get("EXT_color_buffer_float"),n}function s(e){return e===NearestFilter||e===NearestMipmapNearestFilter||e===NearestMipmapLinearFilter?9728:9729}function d(e){const t=e.target;var r;t.removeEventListener("dispose",d),r=t,void 0!==(e=c.get(r)).__webglInit&&(p.deleteTexture(e.__webglTexture),c.remove(r)),t.isVideoTexture&&o.delete(t),h.memory.textures--}function T(e){const t=e.target;t.removeEventListener("dispose",T),function(e){var t=e.texture,r=c.get(e),n=c.get(t);if(e){if(void 0!==n.__webglTexture&&p.deleteTexture(n.__webglTexture),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)p.deleteFramebuffer(r.__webglFramebuffer[e]),r.__webglDepthbuffer&&p.deleteRenderbuffer(r.__webglDepthbuffer[e]);else p.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&p.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&p.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&p.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&p.deleteRenderbuffer(r.__webglDepthRenderbuffer);c.remove(t),c.remove(e)}}(t),h.memory.textures--}let E=0;function B(e,t){var r,n=c.get(e);if(e.isVideoTexture&&(i=e,r=h.render.frame,o.get(i)!==r&&(o.set(i,r),i.update())),0<e.version&&n.__version!==e.version){var i=e.image;if(void 0===i)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==i.complete)return void F(n,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}m.activeTexture(33984+t),m.bindTexture(3553,n.__webglTexture)}function C(e,t){var r=c.get(e);0<e.version&&r.__version!==e.version?function(e,n,t){if(6===n.image.length){L(e,n),m.activeTexture(33984+t),m.bindTexture(34067,e.__webglTexture),p.pixelStorei(37440,n.flipY),p.pixelStorei(37441,n.premultiplyAlpha),p.pixelStorei(3317,n.unpackAlignment),p.pixelStorei(37443,0);var i=n&&(n.isCompressedTexture||n.image[0].isCompressedTexture),o=n.image[0]&&n.image[0].isDataTexture;const d=[];for(let e=0;e<6;e++)d[e]=i||o?o?n.image[e].image:n.image[e]:_(n.image[e],!1,!0,v);var a=d[0],t=y(a)||g,s=f.convert(n.format),l=f.convert(n.type),c=b(n.internalFormat,s,l);N(34067,n,t);let r;if(i){for(let t=0;t<6;t++){r=d[t].mipmaps;for(let e=0;e<r.length;e++){var h=r[e];n.format!==RGBAFormat&&n.format!==RGBFormat?null!==s?m.compressedTexImage2D(34069+t,e,c,h.width,h.height,0,h.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):m.texImage2D(34069+t,e,c,h.width,h.height,0,s,l,h.data)}}e.__maxMipLevel=r.length-1}else{r=n.mipmaps;for(let t=0;t<6;t++)if(o){m.texImage2D(34069+t,0,c,d[t].width,d[t].height,0,s,l,d[t].data);for(let e=0;e<r.length;e++){var u=r[e].image[t].image;m.texImage2D(34069+t,e+1,c,u.width,u.height,0,s,l,u.data)}}else{m.texImage2D(34069+t,0,c,s,l,d[t]);for(let e=0;e<r.length;e++){var A=r[e];m.texImage2D(34069+t,e+1,c,s,l,A.image[t])}}e.__maxMipLevel=r.length}w(n,t)&&x(34067,n,a.width,a.height),e.__version=n.version,n.onUpdate&&n.onUpdate(n)}}(r,e,t):(m.activeTexture(33984+t),m.bindTexture(34067,r.__webglTexture))}const S={[RepeatWrapping]:10497,[ClampToEdgeWrapping]:33071,[MirroredRepeatWrapping]:33648},M={[NearestFilter]:9728,[NearestMipmapNearestFilter]:9984,[NearestMipmapLinearFilter]:9986,[LinearFilter]:9729,[LinearMipmapNearestFilter]:9985,[LinearMipmapLinearFilter]:9987};function N(e,t,r){r?(p.texParameteri(e,10242,S[t.wrapS]),p.texParameteri(e,10243,S[t.wrapT]),32879!==e&&35866!==e||p.texParameteri(e,32882,S[t.wrapR]),p.texParameteri(e,10240,M[t.magFilter]),p.texParameteri(e,10241,M[t.minFilter])):(p.texParameteri(e,10242,33071),p.texParameteri(e,10243,33071),32879!==e&&35866!==e||p.texParameteri(e,32882,33071),t.wrapS===ClampToEdgeWrapping&&t.wrapT===ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),p.texParameteri(e,10240,s(t.magFilter)),p.texParameteri(e,10241,s(t.minFilter)),t.minFilter!==NearestFilter&&t.minFilter!==LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===i.has("EXT_texture_filter_anisotropic")&&(r=i.get("EXT_texture_filter_anisotropic"),t.type===FloatType&&!1===i.has("OES_texture_float_linear")||!1===g&&t.type===HalfFloatType&&!1===i.has("OES_texture_half_float_linear")||(1<t.anisotropy||c.get(t).__currentAnisotropy)&&(p.texParameterf(e,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,n.getMaxAnisotropy())),c.get(t).__currentAnisotropy=t.anisotropy))}function L(e,t){void 0===e.__webglInit&&(e.__webglInit=!0,t.addEventListener("dispose",d),e.__webglTexture=p.createTexture(),h.memory.textures++)}function F(e,r,t){let n=3553;r.isDataTexture2DArray&&(n=35866),r.isDataTexture3D&&(n=32879),L(e,r),m.activeTexture(33984+t),m.bindTexture(n,e.__webglTexture),p.pixelStorei(37440,r.flipY),p.pixelStorei(37441,r.premultiplyAlpha),p.pixelStorei(3317,r.unpackAlignment),p.pixelStorei(37443,0);var t=(i=r,!g&&(i.wrapS!==ClampToEdgeWrapping||i.wrapT!==ClampToEdgeWrapping||i.minFilter!==NearestFilter&&i.minFilter!==LinearFilter)&&!1===y(r.image)),i=_(r.image,t,!1,u),t=y(i)||g,o=f.convert(r.format);let a=f.convert(r.type),s=b(r.internalFormat,o,a);N(n,r,t);let l;var c=r.mipmaps;if(r.isDepthTexture)s=6402,g?s=r.type===FloatType?36012:r.type===UnsignedIntType?33190:r.type===UnsignedInt248Type?35056:33189:r.type===FloatType&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===DepthFormat&&6402===s&&r.type!==UnsignedShortType&&r.type!==UnsignedIntType&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=UnsignedShortType,a=f.convert(r.type)),r.format===DepthStencilFormat&&6402===s&&(s=34041,r.type!==UnsignedInt248Type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=UnsignedInt248Type,a=f.convert(r.type))),m.texImage2D(3553,0,s,i.width,i.height,0,o,a,null);else if(r.isDataTexture)if(0<c.length&&t){for(let e=0,t=c.length;e<t;e++)l=c[e],m.texImage2D(3553,e,s,l.width,l.height,0,o,a,l.data);r.generateMipmaps=!1,e.__maxMipLevel=c.length-1}else m.texImage2D(3553,0,s,i.width,i.height,0,o,a,i.data),e.__maxMipLevel=0;else if(r.isCompressedTexture){for(let e=0,t=c.length;e<t;e++)l=c[e],r.format!==RGBAFormat&&r.format!==RGBFormat?null!==o?m.compressedTexImage2D(3553,e,s,l.width,l.height,0,l.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):m.texImage2D(3553,e,s,l.width,l.height,0,o,a,l.data);e.__maxMipLevel=c.length-1}else if(r.isDataTexture2DArray)m.texImage3D(35866,0,s,i.width,i.height,i.depth,0,o,a,i.data),e.__maxMipLevel=0;else if(r.isDataTexture3D)m.texImage3D(32879,0,s,i.width,i.height,i.depth,0,o,a,i.data),e.__maxMipLevel=0;else if(0<c.length&&t){for(let e=0,t=c.length;e<t;e++)l=c[e],m.texImage2D(3553,e,s,o,a,l);r.generateMipmaps=!1,e.__maxMipLevel=c.length-1}else m.texImage2D(3553,0,s,o,a,i),e.__maxMipLevel=0;w(r,t)&&x(n,r,i.width,i.height),e.__version=r.version,r.onUpdate&&r.onUpdate(r)}function U(e,t,r,n){var i=t.texture,o=f.convert(i.format),a=f.convert(i.type),s=b(i.internalFormat,o,a);32879===n||35866===n?m.texImage3D(n,0,s,t.width,t.height,t.depth,0,o,a,null):m.texImage2D(n,0,s,t.width,t.height,0,o,a,null),m.bindFramebuffer(36160,e),p.framebufferTexture2D(36160,r,n,c.get(i).__webglTexture,0),m.bindFramebuffer(36160,null)}function R(t,r,n){if(p.bindRenderbuffer(36161,t),r.depthBuffer&&!r.stencilBuffer){let e=33189;n?((i=r.depthTexture)&&i.isDepthTexture&&(i.type===FloatType?e=36012:i.type===UnsignedIntType&&(e=33190)),i=P(r),p.renderbufferStorageMultisample(36161,i,e,r.width,r.height)):p.renderbufferStorage(36161,e,r.width,r.height),p.framebufferRenderbuffer(36160,36096,36161,t)}else{var i,e;r.depthBuffer&&r.stencilBuffer?(n?(e=P(r),p.renderbufferStorageMultisample(36161,e,35056,r.width,r.height)):p.renderbufferStorage(36161,34041,r.width,r.height),p.framebufferRenderbuffer(36160,33306,36161,t)):(i=r.texture,e=f.convert(i.format),t=f.convert(i.type),t=b(i.internalFormat,e,t),n?(n=P(r),p.renderbufferStorageMultisample(36161,n,t,r.width,r.height)):p.renderbufferStorage(36161,t,r.width,r.height))}p.bindRenderbuffer(36161,null)}function I(t){const r=c.get(t);var e=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(e)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,t){if(t&&t.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(m.bindFramebuffer(36160,e),!t.depthTexture||!t.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");if(c.get(t.depthTexture).__webglTexture&&t.depthTexture.image.width===t.width&&t.depthTexture.image.height===t.height||(t.depthTexture.image.width=t.width,t.depthTexture.image.height=t.height,t.depthTexture.needsUpdate=!0),B(t.depthTexture,0),e=c.get(t.depthTexture).__webglTexture,t.depthTexture.format===DepthFormat)p.framebufferTexture2D(36160,36096,3553,e,0);else{if(t.depthTexture.format!==DepthStencilFormat)throw new Error("Unknown depthTexture format");p.framebufferTexture2D(36160,33306,3553,e,0)}}(r.__webglFramebuffer,t)}else if(e){r.__webglDepthbuffer=[];for(let e=0;e<6;e++)m.bindFramebuffer(36160,r.__webglFramebuffer[e]),r.__webglDepthbuffer[e]=p.createRenderbuffer(),R(r.__webglDepthbuffer[e],t,!1)}else m.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=p.createRenderbuffer(),R(r.__webglDepthbuffer,t,!1);m.bindFramebuffer(36160,null)}function P(e){return g&&e.isWebGLMultisampleRenderTarget?Math.min(r,e.samples):0}let O=!1,D=!1;this.allocateTextureUnit=function(){var e=E;return e>=t&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+t),E+=1,e},this.resetTextureUnits=function(){E=0},this.setTexture2D=B,this.setTexture2DArray=function(e,t){var r=c.get(e);0<e.version&&r.__version!==e.version?F(r,e,t):(m.activeTexture(33984+t),m.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(e,t){var r=c.get(e);0<e.version&&r.__version!==e.version?F(r,e,t):(m.activeTexture(33984+t),m.bindTexture(32879,r.__webglTexture))},this.setTextureCube=C,this.setupRenderTarget=function(t){const r=t.texture,n=c.get(t),i=c.get(r);t.addEventListener("dispose",T),i.__webglTexture=p.createTexture(),i.__version=r.version,h.memory.textures++;var e,o=!0===t.isWebGLCubeRenderTarget,a=!0===t.isWebGLMultisampleRenderTarget,s=r.isDataTexture3D||r.isDataTexture2DArray,l=y(t)||g;if(!g||r.format!==RGBFormat||r.type!==FloatType&&r.type!==HalfFloatType||(r.format=RGBAFormat,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),o){n.__webglFramebuffer=[];for(let e=0;e<6;e++)n.__webglFramebuffer[e]=p.createFramebuffer()}else n.__webglFramebuffer=p.createFramebuffer(),a&&(g?(n.__webglMultisampledFramebuffer=p.createFramebuffer(),n.__webglColorRenderbuffer=p.createRenderbuffer(),p.bindRenderbuffer(36161,n.__webglColorRenderbuffer),e=f.convert(r.format),a=f.convert(r.type),e=b(r.internalFormat,e,a),a=P(t),p.renderbufferStorageMultisample(36161,a,e,t.width,t.height),m.bindFramebuffer(36160,n.__webglMultisampledFramebuffer),p.framebufferRenderbuffer(36160,36064,36161,n.__webglColorRenderbuffer),p.bindRenderbuffer(36161,null),t.depthBuffer&&(n.__webglDepthRenderbuffer=p.createRenderbuffer(),R(n.__webglDepthRenderbuffer,t,!0)),m.bindFramebuffer(36160,null)):console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2."));if(o){m.bindTexture(34067,i.__webglTexture),N(34067,r,l);for(let e=0;e<6;e++)U(n.__webglFramebuffer[e],t,36064,34069+e);w(r,l)&&x(34067,r,t.width,t.height),m.bindTexture(34067,null)}else{let e=3553;s&&(g?(s=r.isDataTexture3D,e=s?32879:35866):console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),m.bindTexture(e,i.__webglTexture),N(e,r,l),U(n.__webglFramebuffer,t,36064,e),w(r,l)&&x(3553,r,t.width,t.height),m.bindTexture(3553,null)}t.depthBuffer&&I(t)},this.updateRenderTargetMipmap=function(e){var t,r,n=e.texture;w(n,y(e)||g)&&(t=e.isWebGLCubeRenderTarget?34067:3553,r=c.get(n).__webglTexture,m.bindTexture(t,r),x(t,n,e.width,e.height),m.bindTexture(t,null))},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(g){var r=c.get(t);m.bindFramebuffer(36008,r.__webglMultisampledFramebuffer),m.bindFramebuffer(36009,r.__webglFramebuffer);var n=t.width,i=t.height;let e=16384;t.depthBuffer&&(e|=256),t.stencilBuffer&&(e|=1024),p.blitFramebuffer(0,0,n,i,0,0,n,i,e,9728),m.bindFramebuffer(36160,r.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===O&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),O=!0),e=e.texture),B(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===D&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),D=!0),e=e.texture),C(e,t)}}function WebGLUtils(e,r,t){const n=t.isWebGL2;return{convert:function(e){let t;if(e===UnsignedByteType)return 5121;if(e===UnsignedShort4444Type)return 32819;if(e===UnsignedShort5551Type)return 32820;if(e===UnsignedShort565Type)return 33635;if(e===ByteType)return 5120;if(e===ShortType)return 5122;if(e===UnsignedShortType)return 5123;if(e===IntType)return 5124;if(e===UnsignedIntType)return 5125;if(e===FloatType)return 5126;if(e===HalfFloatType)return n?5131:(t=r.get("OES_texture_half_float"),null!==t?t.HALF_FLOAT_OES:null);if(e===AlphaFormat)return 6406;if(e===RGBFormat)return 6407;if(e===RGBAFormat)return 6408;if(e===LuminanceFormat)return 6409;if(e===LuminanceAlphaFormat)return 6410;if(e===DepthFormat)return 6402;if(e===DepthStencilFormat)return 34041;if(e===RedFormat)return 6403;if(e===RedIntegerFormat)return 36244;if(e===RGFormat)return 33319;if(e===RGIntegerFormat)return 33320;if(e===RGBIntegerFormat)return 36248;if(e===RGBAIntegerFormat)return 36249;if(e===RGB_S3TC_DXT1_Format||e===RGBA_S3TC_DXT1_Format||e===RGBA_S3TC_DXT3_Format||e===RGBA_S3TC_DXT5_Format){if(t=r.get("WEBGL_compressed_texture_s3tc"),null===t)return null;if(e===RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===RGB_PVRTC_4BPPV1_Format||e===RGB_PVRTC_2BPPV1_Format||e===RGBA_PVRTC_4BPPV1_Format||e===RGBA_PVRTC_2BPPV1_Format){if(t=r.get("WEBGL_compressed_texture_pvrtc"),null===t)return null;if(e===RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===RGB_ETC1_Format)return t=r.get("WEBGL_compressed_texture_etc1"),null!==t?t.COMPRESSED_RGB_ETC1_WEBGL:null;if((e===RGB_ETC2_Format||e===RGBA_ETC2_EAC_Format)&&(t=r.get("WEBGL_compressed_texture_etc"),null!==t)){if(e===RGB_ETC2_Format)return t.COMPRESSED_RGB8_ETC2;if(e===RGBA_ETC2_EAC_Format)return t.COMPRESSED_RGBA8_ETC2_EAC}return e===RGBA_ASTC_4x4_Format||e===RGBA_ASTC_5x4_Format||e===RGBA_ASTC_5x5_Format||e===RGBA_ASTC_6x5_Format||e===RGBA_ASTC_6x6_Format||e===RGBA_ASTC_8x5_Format||e===RGBA_ASTC_8x6_Format||e===RGBA_ASTC_8x8_Format||e===RGBA_ASTC_10x5_Format||e===RGBA_ASTC_10x6_Format||e===RGBA_ASTC_10x8_Format||e===RGBA_ASTC_10x10_Format||e===RGBA_ASTC_12x10_Format||e===RGBA_ASTC_12x12_Format||e===SRGB8_ALPHA8_ASTC_4x4_Format||e===SRGB8_ALPHA8_ASTC_5x4_Format||e===SRGB8_ALPHA8_ASTC_5x5_Format||e===SRGB8_ALPHA8_ASTC_6x5_Format||e===SRGB8_ALPHA8_ASTC_6x6_Format||e===SRGB8_ALPHA8_ASTC_8x5_Format||e===SRGB8_ALPHA8_ASTC_8x6_Format||e===SRGB8_ALPHA8_ASTC_8x8_Format||e===SRGB8_ALPHA8_ASTC_10x5_Format||e===SRGB8_ALPHA8_ASTC_10x6_Format||e===SRGB8_ALPHA8_ASTC_10x8_Format||e===SRGB8_ALPHA8_ASTC_10x10_Format||e===SRGB8_ALPHA8_ASTC_12x10_Format||e===SRGB8_ALPHA8_ASTC_12x12_Format?(t=r.get("WEBGL_compressed_texture_astc"),null!==t?e:null):e===RGBA_BPTC_Format?(t=r.get("EXT_texture_compression_bptc"),null!==t?e:null):e===UnsignedInt248Type?n?34042:(t=r.get("WEBGL_depth_texture"),null!==t?t.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class ArrayCamera extends PerspectiveCamera{constructor(e=[]){super(),this.cameras=e}}ArrayCamera.prototype.isArrayCamera=!0;class Group extends Object3D{constructor(){super(),this.type="Group"}}function WebXRController(){this._targetRay=null,this._grip=null,this._hand=null}function WebXRManager(e,t){const r=this,h=e.state;let u=null,n=1,A=null,i="local-floor",d=null;const p=[],s=new Map,o=new PerspectiveCamera;o.layers.enable(1),o.viewport=new Vector4;const a=new PerspectiveCamera;a.layers.enable(2),a.viewport=new Vector4;const m=[o,a],f=new ArrayCamera;f.layers.enable(1),f.layers.enable(2);let l=null,c=null;function g(e){const t=s.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function v(){s.forEach(function(e,t){e.disconnect(t)}),s.clear(),l=null,c=null,h.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),T.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}function _(t){var r=u.inputSources;for(let e=0;e<p.length;e++)s.set(r[e],p[e]);for(let e=0;e<t.removed.length;e++){var n=t.removed[e];const o=s.get(n);o&&(o.dispatchEvent({type:"disconnected",data:n}),s.delete(n))}for(let e=0;e<t.added.length;e++){var i=t.added[e];const a=s.get(i);a&&a.dispatchEvent({type:"connected",data:i})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=p[e];return void 0===t&&(t=new WebXRController,p[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=p[e];return void 0===t&&(t=new WebXRController,p[e]=t),t.getGripSpace()},this.getHand=function(e){let t=p[e];return void 0===t&&(t=new WebXRController,p[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){n=e,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){i=e,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return A},this.getSession=function(){return u},this.setSession=async function(e){u=e,null!==u&&(u.addEventListener("select",g),u.addEventListener("selectstart",g),u.addEventListener("selectend",g),u.addEventListener("squeeze",g),u.addEventListener("squeezestart",g),u.addEventListener("squeezeend",g),u.addEventListener("end",v),u.addEventListener("inputsourceschange",_),!0!==(e=t.getContextAttributes()).xrCompatible&&await t.makeXRCompatible(),e={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:n},e=new XRWebGLLayer(u,t,e),u.updateRenderState({baseLayer:e}),A=await u.requestReferenceSpace(i),T.setContext(u),T.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"}))};const y=new Vector3,w=new Vector3;function x(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.getCamera=function(e){f.near=a.near=o.near=e.near,f.far=a.far=o.far=e.far,l===f.near&&c===f.far||(u.updateRenderState({depthNear:f.near,depthFar:f.far}),l=f.near,c=f.far);var t=e.parent,r=f.cameras;x(f,t);for(let e=0;e<r.length;e++)x(r[e],t);e.matrixWorld.copy(f.matrixWorld),e.matrix.copy(f.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);const n=e.children;for(let e=0,t=n.length;e<t;e++)n[e].updateMatrixWorld(!0);return 2===r.length?function(e,t,r){y.setFromMatrixPosition(t.matrixWorld),w.setFromMatrixPosition(r.matrixWorld);var n=y.distanceTo(w),i=t.projectionMatrix.elements,o=r.projectionMatrix.elements,a=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],h=(i[8]-1)/i[0],r=(o[8]+1)/o[0],i=a*h,o=a*r,h=(r=n/(r-h))*-h;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(h),e.translateZ(r),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),a+=r,r=s+r,e.projectionMatrix.makePerspective(i-h,n-h+o,l*s/r*a,c*s/r*a,a,r)}(f,o,a):f.projectionMatrix.copy(o.projectionMatrix),f};let b=null;const T=new WebGLAnimation;T.setAnimationLoop(function(e,t){if(d=t.getViewerPose(A),null!==d){var r=d.views;const s=u.renderState.baseLayer;h.bindXRFramebuffer(s.framebuffer);let t=!1;r.length!==f.cameras.length&&(f.cameras.length=0,t=!0);for(let e=0;e<r.length;e++){var n=r[e],i=s.getViewport(n);const l=m[e];l.matrix.fromArray(n.transform.matrix),l.projectionMatrix.fromArray(n.projectionMatrix),l.viewport.set(i.x,i.y,i.width,i.height),0===e&&f.matrix.copy(l.matrix),!0===t&&f.cameras.push(l)}}var o=u.inputSources;for(let e=0;e<p.length;e++){const c=p[e];var a=o[e];c.update(a,t,A)}b&&b(e,t)}),this.setAnimationLoop=function(e){b=e},this.dispose=function(){}}function WebGLMaterials(o){function l(e,t){e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap);var r=o.get(t).envMap;r&&(e.envMap.value=r,e.flipEnvMap.value=r.isCubeTexture&&r._needsFlipEnvMap?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,void 0!==(r=o.get(r).__maxMipLevel)&&(e.maxMipLevel.value=r)),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity);let n;t.map?n=t.map:t.specularMap?n=t.specularMap:t.displacementMap?n=t.displacementMap:t.normalMap?n=t.normalMap:t.bumpMap?n=t.bumpMap:t.roughnessMap?n=t.roughnessMap:t.metalnessMap?n=t.metalnessMap:t.alphaMap?n=t.alphaMap:t.emissiveMap?n=t.emissiveMap:t.clearcoatMap?n=t.clearcoatMap:t.clearcoatNormalMap?n=t.clearcoatNormalMap:t.clearcoatRoughnessMap&&(n=t.clearcoatRoughnessMap),void 0!==n&&(n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix));let i;t.aoMap?i=t.aoMap:t.lightMap&&(i=t.lightMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uv2Transform.value.copy(i.matrix))}function c(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===BackSide&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===BackSide&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),o.get(t).envMap&&(e.envMapIntensity.value=t.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,t,r,n){var i,o,a,s;t.isMeshBasicMaterial?l(e,t):t.isMeshLambertMaterial?(l(e,t),a=e,(s=t).emissiveMap&&(a.emissiveMap.value=s.emissiveMap)):t.isMeshToonMaterial?(l(e,t),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===BackSide&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===BackSide&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,t)):t.isMeshPhongMaterial?(l(e,t),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===BackSide&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===BackSide&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,t)):t.isMeshStandardMaterial?(l(e,t),(t.isMeshPhysicalMaterial?function(e,t){c(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen);t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap);t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap);t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===BackSide&&e.clearcoatNormalScale.value.negate());e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap)}:c)(e,t)):t.isMeshMatcapMaterial?(l(e,t),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===BackSide&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===BackSide&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,t)):t.isMeshDepthMaterial?(l(e,t),i=e,(o=t).displacementMap&&(i.displacementMap.value=o.displacementMap,i.displacementScale.value=o.displacementScale,i.displacementBias.value=o.displacementBias)):t.isMeshDistanceMaterial?(l(e,t),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,t)):t.isMeshNormalMaterial?(l(e,t),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===BackSide&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===BackSide&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,t)):t.isLineBasicMaterial?(i=t,(o=e).diffuse.value.copy(i.color),o.opacity.value=i.opacity,t.isLineDashedMaterial&&(o=t,(i=e).dashSize.value=o.dashSize,i.totalSize.value=o.dashSize+o.gapSize,i.scale.value=o.scale)):t.isPointsMaterial?function(e,t,r,n){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*r,e.scale.value=.5*n,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);let i;t.map?i=t.map:t.alphaMap&&(i=t.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,t,r,n):t.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);let r;t.map?r=t.map:t.alphaMap&&(r=t.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(e,t):t.isShadowMaterial?(e.color.value.copy(t.color),e.opacity.value=t.opacity):t.isShaderMaterial&&(t.uniformsNeedUpdate=!1)}}}function createCanvasElement(){const e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}function WebGLRenderer(e){const i=void 0!==(e=e||{}).canvas?e.canvas:createCanvasElement(),t=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,n=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",h=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let p=null,b=null;const u=[],A=[];this.domElement=i,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=LinearEncoding,this.physicallyCorrectLights=!1,this.toneMapping=NoToneMapping,this.toneMappingExposure=1;const T=this;let d=!1,m=0,f=0,E=null,B=-1,C=null;const g=new Vector4,v=new Vector4;let _=null,y=i.width,S=i.height,M=1,w=null,x=null;const N=new Vector4(0,0,y,S),L=new Vector4(0,0,y,S);let F=!1;const U=new Frustum;let R=!1,I=!1;const P=new Matrix4,O=new Vector3,D={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function H(){return null===E?M:1}let Q=t;function k(t,r){for(let e=0;e<t.length;e++){var n=t[e],n=i.getContext(n,r);if(null!==n)return n}return null}try{var V={alpha:r,depth:n,stencil:o,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if(i.addEventListener("webglcontextlost",de,!1),i.addEventListener("webglcontextrestored",pe,!1),null===Q){const Ee=["webgl2","webgl","experimental-webgl"];if(!0===T.isWebGL1Renderer&&Ee.shift(),Q=k(Ee,V),null===Q)throw k(Ee)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===Q.getShaderPrecisionFormat&&(Q.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}let G,z,K,W,j,X,Y,J,q,$,Z,ee,te,re,ne,ie,oe,ae,se,le,ce,he;function ue(){G=new WebGLExtensions(Q),z=new WebGLCapabilities(Q,G,e),G.init(z),ce=new WebGLUtils(Q,G,z),K=new WebGLState(Q,G,z),W=new WebGLInfo(Q),j=new WebGLProperties,X=new WebGLTextures(Q,G,K,j,z,ce,W),Y=new WebGLCubeMaps(T),J=new WebGLAttributes(Q,z),he=new WebGLBindingStates(Q,G,J,z),q=new WebGLGeometries(Q,J,W,he),$=new WebGLObjects(Q,q,J,W),ae=new WebGLMorphtargets(Q),ne=new WebGLClipping(j),Z=new WebGLPrograms(T,Y,G,z,he,ne),ee=new WebGLMaterials(j),te=new WebGLRenderLists(j),re=new WebGLRenderStates(G,z),oe=new WebGLBackground(T,Y,K,$,s),ie=new WebGLShadowMap(T,$,z),se=new WebGLBufferRenderer(Q,G,W,z),le=new WebGLIndexedBufferRenderer(Q,G,W,z),W.programs=Z.programs,T.capabilities=z,T.extensions=G,T.properties=j,T.renderLists=te,T.shadowMap=ie,T.state=K,T.info=W}ue();const Ae=new WebXRManager(T,Q);function de(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),d=!0}function pe(){console.log("THREE.WebGLRenderer: Context Restored."),d=!1;var e=W.autoReset,t=ie.enabled,r=ie.autoUpdate,n=ie.needsUpdate,i=ie.type;ue(),W.autoReset=e,ie.enabled=t,ie.autoUpdate=r,ie.needsUpdate=n,ie.type=i}function me(e){const t=e.target;t.removeEventListener("dispose",me),function(e){const t=j.get(e).programs;void 0!==t&&t.forEach(function(e){Z.releaseProgram(e)})}(e=t),j.remove(e)}this.xr=Ae,this.getContext=function(){return Q},this.getContextAttributes=function(){return Q.getContextAttributes()},this.forceContextLoss=function(){const e=G.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=G.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return M},this.setPixelRatio=function(e){void 0!==e&&(M=e,this.setSize(y,S,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new Vector2),e.set(y,S)},this.setSize=function(e,t,r){Ae.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(y=e,S=t,i.width=Math.floor(e*M),i.height=Math.floor(t*M),!1!==r&&(i.style.width=e+"px",i.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new Vector2),e.set(y*M,S*M).floor()},this.setDrawingBufferSize=function(e,t,r){y=e,S=t,M=r,i.width=Math.floor(e*r),i.height=Math.floor(t*r),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new Vector4),e.copy(g)},this.getViewport=function(e){return e.copy(N)},this.setViewport=function(e,t,r,n){e.isVector4?N.set(e.x,e.y,e.z,e.w):N.set(e,t,r,n),K.viewport(g.copy(N).multiplyScalar(M).floor())},this.getScissor=function(e){return e.copy(L)},this.setScissor=function(e,t,r,n){e.isVector4?L.set(e.x,e.y,e.z,e.w):L.set(e,t,r,n),K.scissor(v.copy(L).multiplyScalar(M).floor())},this.getScissorTest=function(){return F},this.setScissorTest=function(e){K.setScissorTest(F=e)},this.setOpaqueSort=function(e){w=e},this.setTransparentSort=function(e){x=e},this.getClearColor=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),e=new Color),e.copy(oe.getClearColor())},this.setClearColor=function(){oe.setClearColor.apply(oe,arguments)},this.getClearAlpha=function(){return oe.getClearAlpha()},this.setClearAlpha=function(){oe.setClearAlpha.apply(oe,arguments)},this.clear=function(e,t,r){let n=0;void 0!==e&&!e||(n|=16384),void 0!==t&&!t||(n|=256),void 0!==r&&!r||(n|=1024),Q.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",de,!1),i.removeEventListener("webglcontextrestored",pe,!1),te.dispose(),re.dispose(),j.dispose(),Y.dispose(),$.dispose(),he.dispose(),Ae.dispose(),Ae.removeEventListener("sessionstart",ge),Ae.removeEventListener("sessionend",ve),_e.stop()},this.renderBufferImmediate=function(e,t){he.initAttributes();const r=j.get(e);e.hasPositions&&!r.position&&(r.position=Q.createBuffer()),e.hasNormals&&!r.normal&&(r.normal=Q.createBuffer()),e.hasUvs&&!r.uv&&(r.uv=Q.createBuffer()),e.hasColors&&!r.color&&(r.color=Q.createBuffer());t=t.getAttributes();e.hasPositions&&(Q.bindBuffer(34962,r.position),Q.bufferData(34962,e.positionArray,35048),he.enableAttribute(t.position),Q.vertexAttribPointer(t.position,3,5126,!1,0,0)),e.hasNormals&&(Q.bindBuffer(34962,r.normal),Q.bufferData(34962,e.normalArray,35048),he.enableAttribute(t.normal),Q.vertexAttribPointer(t.normal,3,5126,!1,0,0)),e.hasUvs&&(Q.bindBuffer(34962,r.uv),Q.bufferData(34962,e.uvArray,35048),he.enableAttribute(t.uv),Q.vertexAttribPointer(t.uv,2,5126,!1,0,0)),e.hasColors&&(Q.bindBuffer(34962,r.color),Q.bufferData(34962,e.colorArray,35048),he.enableAttribute(t.color),Q.vertexAttribPointer(t.color,3,5126,!1,0,0)),he.disableUnusedAttributes(),Q.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,r,n,i,o){null===t&&(t=D);var a=i.isMesh&&i.matrixWorld.determinant()<0,s=Te(e,t,n,i);K.setMaterial(n,a);let l=r.index;e=r.attributes.position;if(null===l){if(void 0===e||0===e.count)return}else if(0===l.count)return;let c=1;!0===n.wireframe&&(l=q.getWireframeAttribute(r),c=2),(n.morphTargets||n.morphNormals)&&ae.update(i,r,n,s),he.setup(i,n,s,r,l);let h=se;null!==l&&(u=J.get(l),h=le,h.setIndex(u));var t=(null!==l?l:e).count,a=r.drawRange.start*c,s=r.drawRange.count*c,u=null!==o?o.start*c:0,e=null!==o?o.count*c:1/0,o=Math.max(a,u),e=Math.min(t,a+s,u+e)-1,e=Math.max(0,e-o+1);if(0!==e){if(i.isMesh)!0===n.wireframe?(K.setLineWidth(n.wireframeLinewidth*H()),h.setMode(1)):h.setMode(4);else if(i.isLine){let e=n.linewidth;void 0===e&&(e=1),K.setLineWidth(e*H()),i.isLineSegments?h.setMode(1):i.isLineLoop?h.setMode(2):h.setMode(3)}else i.isPoints?h.setMode(0):i.isSprite&&h.setMode(4);i.isInstancedMesh?h.renderInstances(o,e,i.count):r.isInstancedBufferGeometry?(r=Math.min(r.instanceCount,r._maxInstanceCount),h.renderInstances(o,e,r)):h.render(o,e)}},this.compile=function(n,t){b=re.get(n),b.init(),n.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(b.pushLight(e),e.castShadow&&b.pushShadow(e))}),b.setupLights(),n.traverse(function(t){var r=t.material;if(r)if(Array.isArray(r))for(let e=0;e<r.length;e++)xe(r[e],n,t);else xe(r,n,t)})};let fe=null;function ge(){_e.stop()}function ve(){_e.start()}const _e=new WebGLAnimation;function ye(r,n,i){var o=!0===n.isScene?n.overrideMaterial:null;for(let e=0,t=r.length;e<t;e++){var a=r[e];const A=a.object;var s=a.geometry,l=null===o?a.material:o,c=a.group;if(i.isArrayCamera){var h=i.cameras;for(let e=0,t=h.length;e<t;e++){var u=h[e];A.layers.test(u.layers)&&(K.viewport(g.copy(u.viewport)),b.setupLightsView(u),we(A,n,u,s,l,c))}}else we(A,n,i,s,l,c)}}function we(e,t,r,n,i,o){var a,s;e.onBeforeRender(T,t,r,n,i,o),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject?(a=Te(r,t,i,e),K.setMaterial(i),he.reset(),s=a,e.render(function(e){T.renderBufferImmediate(e,s)})):T.renderBufferDirect(r,t,n,i,e,o),e.onAfterRender(T,t,r,n,i,o)}function xe(e,t,r){!0!==t.isScene&&(t=D);const n=j.get(e);var i=b.state.lights,o=b.state.shadowsArray,a=i.state.version;const s=Z.getParameters(e,i.state,o,t,r);r=Z.getProgramCacheKey(s);let l=n.programs;n.environment=e.isMeshStandardMaterial?t.environment:null,n.fog=t.fog,n.envMap=Y.get(e.envMap||n.environment),void 0===l&&(e.addEventListener("dispose",me),l=new Map,n.programs=l);let c=l.get(r);if(void 0!==c){if(n.currentProgram===c&&n.lightsStateVersion===a)return be(e,s),c}else s.uniforms=Z.getUniforms(e),e.onBeforeCompile(s,T),c=Z.acquireProgram(s,r),l.set(r,c),n.uniforms=s.uniforms;const h=n.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=ne.uniform),be(e,s),n.needsLights=(e=e).isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights,n.lightsStateVersion=a,n.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotShadowMatrix.value=i.state.spotShadowMatrix,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);i=c.getUniforms(),i=WebGLUniforms.seqWithValue(i.seq,h);return n.currentProgram=c,n.uniformsList=i,c}function be(e,t){const r=j.get(e);r.outputEncoding=t.outputEncoding,r.instancing=t.instancing,r.numClippingPlanes=t.numClippingPlanes,r.numIntersection=t.numClipIntersection,r.vertexAlphas=t.vertexAlphas}function Te(e,t,r,n){!0!==t.isScene&&(t=D),X.resetTextureUnits();var i=t.fog,o=r.isMeshStandardMaterial?t.environment:null,a=null===E?T.outputEncoding:E.texture.encoding,s=Y.get(r.envMap||o),l=!0===r.vertexColors&&n.geometry.attributes.color&&4===n.geometry.attributes.color.itemSize;const c=j.get(r);var h=b.state.lights;!0===R&&(!0!==I&&e===C||(o=e===C&&r.id===B,ne.setState(r,e,o)));let u=!1;r.version===c.__version?(c.needsLights&&c.lightsStateVersion!==h.state.version||c.outputEncoding!==a||n.isInstancedMesh&&!1===c.instancing||!n.isInstancedMesh&&!0===c.instancing||c.envMap!==s||r.fog&&c.fog!==i||void 0!==c.numClippingPlanes&&(c.numClippingPlanes!==ne.numPlanes||c.numIntersection!==ne.numIntersection)||c.vertexAlphas!==l)&&(u=!0):(u=!0,c.__version=r.version);let A=c.currentProgram;!0===u&&(A=xe(r,t,n));let d=!1,p=!1,m=!1;const f=A.getUniforms(),g=c.uniforms;if(K.useProgram(A.program)&&(d=!0,p=!0,m=!0),r.id!==B&&(B=r.id,p=!0),d||C!==e){if(f.setValue(Q,"projectionMatrix",e.projectionMatrix),z.logarithmicDepthBuffer&&f.setValue(Q,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),C!==e&&(C=e,p=!0,m=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){const y=f.map.cameraPosition;void 0!==y&&y.setValue(Q,O.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&f.setValue(Q,"isOrthographic",!0===e.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.isShadowMaterial||r.skinning)&&f.setValue(Q,"viewMatrix",e.matrixWorldInverse)}if(r.skinning){f.setOptional(Q,n,"bindMatrix"),f.setOptional(Q,n,"bindMatrixInverse");const w=n.skeleton;if(w){e=w.bones;if(z.floatVertexTextures){if(null===w.boneTexture){var v=Math.sqrt(4*e.length),v=MathUtils.ceilPowerOfTwo(v);v=Math.max(v,4);const x=new Float32Array(v*v*4);x.set(w.boneMatrices);var _=new DataTexture(x,v,v,RGBAFormat,FloatType);w.boneMatrices=x,w.boneTexture=_,w.boneTextureSize=v}f.setValue(Q,"boneTexture",w.boneTexture,X),f.setValue(Q,"boneTextureSize",w.boneTextureSize)}else f.setOptional(Q,w,"boneMatrices")}}return!p&&c.receiveShadow===n.receiveShadow||(c.receiveShadow=n.receiveShadow,f.setValue(Q,"receiveShadow",n.receiveShadow)),p&&(f.setValue(Q,"toneMappingExposure",T.toneMappingExposure),c.needsLights&&(_=g,v=m,_.ambientLightColor.needsUpdate=v,_.lightProbe.needsUpdate=v,_.directionalLights.needsUpdate=v,_.directionalLightShadows.needsUpdate=v,_.pointLights.needsUpdate=v,_.pointLightShadows.needsUpdate=v,_.spotLights.needsUpdate=v,_.spotLightShadows.needsUpdate=v,_.rectAreaLights.needsUpdate=v,_.hemisphereLights.needsUpdate=v),i&&r.fog&&ee.refreshFogUniforms(g,i),ee.refreshMaterialUniforms(g,r,M,S),WebGLUniforms.upload(Q,c.uniformsList,g,X)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(WebGLUniforms.upload(Q,c.uniformsList,g,X),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&f.setValue(Q,"center",n.center),f.setValue(Q,"modelViewMatrix",n.modelViewMatrix),f.setValue(Q,"normalMatrix",n.normalMatrix),f.setValue(Q,"modelMatrix",n.matrixWorld),A}_e.setAnimationLoop(function(e){fe&&fe(e)}),"undefined"!=typeof window&&_e.setContext(window),this.setAnimationLoop=function(e){fe=e,Ae.setAnimationLoop(e),null===e?_e.stop():_e.start()},Ae.addEventListener("sessionstart",ge),Ae.addEventListener("sessionend",ve),this.render=function(e,t){let r,n;var i,o;void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),r=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),n=arguments[3]),void 0===t||!0===t.isCamera?!0!==d&&(!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===Ae.enabled&&!0===Ae.isPresenting&&(t=Ae.getCamera(t)),!0===e.isScene&&e.onBeforeRender(T,e,t,r||E),b=re.get(e,A.length),b.init(),A.push(b),P.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),U.setFromProjectionMatrix(P),I=this.localClippingEnabled,R=ne.init(this.clippingPlanes,I,t),p=te.get(e,u.length),p.init(),u.push(p),function r(n,i,o,a){if(!1===n.visible)return;const e=n.layers.test(i.layers);if(e)if(n.isGroup)o=n.renderOrder;else if(n.isLOD)!0===n.autoUpdate&&n.update(i);else if(n.isLight)b.pushLight(n),n.castShadow&&b.pushShadow(n);else if(n.isSprite){if(!n.frustumCulled||U.intersectsSprite(n)){a&&O.setFromMatrixPosition(n.matrixWorld).applyMatrix4(P);const t=$.update(n),l=n.material;l.visible&&p.push(n,t,l,o,O.z,null)}}else if(n.isImmediateRenderObject)a&&O.setFromMatrixPosition(n.matrixWorld).applyMatrix4(P),p.push(n,null,n.material,o,O.z,null);else if((n.isMesh||n.isLine||n.isPoints)&&(n.isSkinnedMesh&&n.skeleton.frame!==W.render.frame&&(n.skeleton.update(),n.skeleton.frame=W.render.frame),!n.frustumCulled||U.intersectsObject(n))){a&&O.setFromMatrixPosition(n.matrixWorld).applyMatrix4(P);const c=$.update(n),h=n.material;if(Array.isArray(h)){const u=c.groups;for(let e=0,t=u.length;e<t;e++){const A=u[e],d=h[A.materialIndex];d&&d.visible&&p.push(n,c,d,o,O.z,A)}}else h.visible&&p.push(n,c,h,o,O.z,null)}const s=n.children;for(let e=0,t=s.length;e<t;e++)r(s[e],i,o,a)}(e,t,0,T.sortObjects),p.finish(),!0===T.sortObjects&&p.sort(w,x),!0===R&&ne.beginShadows(),o=b.state.shadowsArray,ie.render(o,e,t),b.setupLights(),b.setupLightsView(t),!0===R&&ne.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==r&&this.setRenderTarget(r),oe.render(p,e,t,n),i=p.opaque,o=p.transparent,0<i.length&&ye(i,e,t),0<o.length&&ye(o,e,t),null!==E&&(X.updateRenderTargetMipmap(E),X.updateMultisampleRenderTarget(E)),!0===e.isScene&&e.onAfterRender(T,e,t),K.buffers.depth.setTest(!0),K.buffers.depth.setMask(!0),K.buffers.color.setMask(!0),K.setPolygonOffset(!1),he.resetDefaultState(),B=-1,C=null,A.pop(),b=0<A.length?A[A.length-1]:null,u.pop(),p=0<u.length?u[u.length-1]:null):console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return m},this.getActiveMipmapLevel=function(){return f},this.getRenderTarget=function(){return E},this.setRenderTarget=function(e,t=0,r=0){E=e,m=t,f=r,e&&void 0===j.get(e).__webglFramebuffer&&X.setupRenderTarget(e);let n=null,i=!1,o=!1;var a;_=e?(((a=e.texture).isDataTexture3D||a.isDataTexture2DArray)&&(o=!0),a=j.get(e).__webglFramebuffer,e.isWebGLCubeRenderTarget?(n=a[t],i=!0):n=e.isWebGLMultisampleRenderTarget?j.get(e).__webglMultisampledFramebuffer:a,g.copy(e.viewport),v.copy(e.scissor),e.scissorTest):(g.copy(N).multiplyScalar(M).floor(),v.copy(L).multiplyScalar(M).floor(),F),K.bindFramebuffer(36160,n),K.viewport(g),K.scissor(v),K.setScissorTest(_),i?(a=j.get(e.texture),Q.framebufferTexture2D(36160,36064,34069+t,a.__webglTexture,r)):o&&(e=j.get(e.texture),t=t||0,Q.framebufferTextureLayer(36160,36064,e.__webglTexture,r||0,t))},this.readRenderTargetPixels=function(t,r,n,i,o,a,s){if(t&&t.isWebGLRenderTarget){let e=j.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==s&&(e=e[s]),e){K.bindFramebuffer(36160,e);try{var l=t.texture,c=l.format,h=l.type;if(c!==RGBAFormat&&ce.convert(c)!==Q.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var u=h===HalfFloatType&&(G.has("EXT_color_buffer_half_float")||z.isWebGL2&&G.has("EXT_color_buffer_float"));if(!(h===UnsignedByteType||ce.convert(h)===Q.getParameter(35738)||h===FloatType&&(z.isWebGL2||G.has("OES_texture_float")||G.has("WEBGL_color_buffer_float"))||u))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===Q.checkFramebufferStatus(36160)?0<=r&&r<=t.width-i&&0<=n&&n<=t.height-o&&Q.readPixels(r,n,i,o,ce.convert(c),ce.convert(h),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const e=null!==E?j.get(E).__webglFramebuffer:null;K.bindFramebuffer(36160,e)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,r=0){var n=Math.pow(2,-r),i=Math.floor(t.image.width*n),o=Math.floor(t.image.height*n),n=ce.convert(t.format);X.setTexture2D(t,0),Q.copyTexImage2D(3553,r,n,e.x,e.y,i,o,0),K.unbindTexture()},this.copyTextureToTexture=function(e,t,r,n=0){var i=t.image.width,o=t.image.height,a=ce.convert(r.format),s=ce.convert(r.type);X.setTexture2D(r,0),Q.pixelStorei(37440,r.flipY),Q.pixelStorei(37441,r.premultiplyAlpha),Q.pixelStorei(3317,r.unpackAlignment),t.isDataTexture?Q.texSubImage2D(3553,n,e.x,e.y,i,o,a,s,t.image.data):t.isCompressedTexture?Q.compressedTexSubImage2D(3553,n,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,a,t.mipmaps[0].data):Q.texSubImage2D(3553,n,e.x,e.y,a,s,t.image),0===n&&r.generateMipmaps&&Q.generateMipmap(3553),K.unbindTexture()},this.copyTextureToTexture3D=function(t,r,n,i,o=0){if(T.isWebGL1Renderer)console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");else{var{width:a,height:s,data:l}=n.image,c=ce.convert(i.format),h=ce.convert(i.type);let e;if(i.isDataTexture3D)X.setTexture3D(i,0),e=32879;else{if(!i.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");X.setTexture2DArray(i,0),e=35866}Q.pixelStorei(37440,i.flipY),Q.pixelStorei(37441,i.premultiplyAlpha),Q.pixelStorei(3317,i.unpackAlignment);var u=Q.getParameter(3314),A=Q.getParameter(32878),d=Q.getParameter(3316),p=Q.getParameter(3315),n=Q.getParameter(32877);Q.pixelStorei(3314,a),Q.pixelStorei(32878,s),Q.pixelStorei(3316,t.min.x),Q.pixelStorei(3315,t.min.y),Q.pixelStorei(32877,t.min.z),Q.texSubImage3D(e,o,r.x,r.y,r.z,t.max.x-t.min.x+1,t.max.y-t.min.y+1,t.max.z-t.min.z+1,c,h,l),Q.pixelStorei(3314,u),Q.pixelStorei(32878,A),Q.pixelStorei(3316,d),Q.pixelStorei(3315,p),Q.pixelStorei(32877,n),0===o&&i.generateMipmaps&&Q.generateMipmap(e),K.unbindTexture()}},this.initTexture=function(e){X.setTexture2D(e,0),K.unbindTexture()},this.resetState=function(){m=0,f=0,E=null,K.reset(),he.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Group.prototype.isGroup=!0,Object.assign(WebXRController.prototype,{constructor:WebXRController,getHandSpace:function(){return null===this._hand&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this},disconnect:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(e,t,r){let n=null,i=null,o=null;const a=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==a&&(n=t.getPose(e.targetRaySpace,r),null!==n&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale))),l&&e.hand){o=!0;for(const A of e.hand.values()){var c=t.getJointPose(A,r);if(void 0===l.joints[A.jointName]){const p=new Group;p.matrixAutoUpdate=!1,p.visible=!1,l.joints[A.jointName]=p,l.add(p)}const d=l.joints[A.jointName];null!==c&&(d.matrix.fromArray(c.transform.matrix),d.matrix.decompose(d.position,d.rotation,d.scale),d.jointRadius=c.radius),d.visible=null!==c}const u=l.joints["index-finger-tip"];var h=l.joints["thumb-tip"],h=u.position.distanceTo(h.position);l.inputState.pinching&&.025<h?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&h<=.015&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&(i=t.getPose(e.gripSpace,r),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale)));return null!==a&&(a.visible=null!==n),null!==s&&(s.visible=null!==i),null!==l&&(l.visible=null!==o),this}}),Object.assign(WebXRManager.prototype,EventDispatcher.prototype);class WebGL1Renderer extends WebGLRenderer{}WebGL1Renderer.prototype.isWebGL1Renderer=!0;class FogExp2{constructor(e,t=25e-5){this.name="",this.color=new Color(e),this.density=t}clone(){return new FogExp2(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}FogExp2.prototype.isFogExp2=!0;class Fog{constructor(e,t=1,r=1e3){this.name="",this.color=new Color(e),this.near=t,this.far=r}clone(){return new Fog(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Fog.prototype.isFog=!0;class Scene extends Object3D{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}function InterleavedBuffer(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=MathUtils.generateUUID()}Scene.prototype.isScene=!0,Object.defineProperty(InterleavedBuffer.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(InterleavedBuffer.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(r,n,i){r*=this.stride,i*=n.stride;for(let e=0,t=this.stride;e<t;e++)this.array[r+e]=n.array[i+e];return this},set:function(e,t=0){return this.array.set(e,t),this},clone:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=MathUtils.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new InterleavedBuffer(new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),this.stride);return t.setUsage(this.usage),t},onUpload:function(e){return this.onUploadCallback=e,this},toJSON:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=MathUtils.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const _vector$6=new Vector3;function InterleavedBufferAttribute(e,t,r,n){this.name="",this.data=e,this.itemSize=t,this.offset=r,this.normalized=!0===n}Object.defineProperties(InterleavedBufferAttribute.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(e){this.data.needsUpdate=e}}}),Object.assign(InterleavedBufferAttribute.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(r){for(let e=0,t=this.data.count;e<t;e++)_vector$6.x=this.getX(e),_vector$6.y=this.getY(e),_vector$6.z=this.getZ(e),_vector$6.applyMatrix4(r),this.setXYZ(e,_vector$6.x,_vector$6.y,_vector$6.z);return this},applyNormalMatrix:function(r){for(let e=0,t=this.count;e<t;e++)_vector$6.x=this.getX(e),_vector$6.y=this.getY(e),_vector$6.z=this.getZ(e),_vector$6.applyNormalMatrix(r),this.setXYZ(e,_vector$6.x,_vector$6.y,_vector$6.z);return this},transformDirection:function(r){for(let e=0,t=this.count;e<t;e++)_vector$6.x=this.getX(e),_vector$6.y=this.getY(e),_vector$6.z=this.getZ(e),_vector$6.transformDirection(r),this.setXYZ(e,_vector$6.x,_vector$6.y,_vector$6.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this},setXYZW:function(e,t,r,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this.data.array[e+3]=i,this},clone:function(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new InterleavedBufferAttribute(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized);{console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const r=[];for(let e=0;e<this.count;e++){var t=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)r.push(this.data.array[t+e])}return new BufferAttribute(new this.array.constructor(r),this.itemSize,this.normalized)}},toJSON:function(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized};{console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const r=[];for(let e=0;e<this.count;e++){var t=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)r.push(this.data.array[t+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:r,normalized:this.normalized}}}});class SpriteMaterial extends Material{constructor(e){super(),this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}SpriteMaterial.prototype.isSpriteMaterial=!0;let _geometry;const _intersectPoint=new Vector3,_worldScale=new Vector3,_mvPosition=new Vector3,_alignedPosition=new Vector2,_rotatedPosition=new Vector2,_viewWorldMatrix=new Matrix4,_vA=new Vector3,_vB=new Vector3,_vC=new Vector3,_uvA=new Vector2,_uvB=new Vector2,_uvC=new Vector2;class Sprite extends Object3D{constructor(e){var t;super(),this.type="Sprite",void 0===_geometry&&(_geometry=new BufferGeometry,t=new InterleavedBuffer(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5),_geometry.setIndex([0,1,2,0,2,3]),_geometry.setAttribute("position",new InterleavedBufferAttribute(t,3,0,!1)),_geometry.setAttribute("uv",new InterleavedBufferAttribute(t,2,3,!1))),this.geometry=_geometry,this.material=void 0!==e?e:new SpriteMaterial,this.center=new Vector2(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_worldScale.setFromMatrixScale(this.matrixWorld),_viewWorldMatrix.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),_mvPosition.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&_worldScale.multiplyScalar(-_mvPosition.z);var r=this.material.rotation;let n,i;0!==r&&(i=Math.cos(r),n=Math.sin(r));var r=this.center;transformVertex(_vA.set(-.5,-.5,0),_mvPosition,r,_worldScale,n,i),transformVertex(_vB.set(.5,-.5,0),_mvPosition,r,_worldScale,n,i),transformVertex(_vC.set(.5,.5,0),_mvPosition,r,_worldScale,n,i),_uvA.set(0,0),_uvB.set(1,0),_uvC.set(1,1),null===e.ray.intersectTriangle(_vA,_vB,_vC,!1,_intersectPoint)&&(transformVertex(_vB.set(-.5,.5,0),_mvPosition,r,_worldScale,n,i),_uvB.set(0,1),null===e.ray.intersectTriangle(_vA,_vC,_vB,!1,_intersectPoint))||((r=e.ray.origin.distanceTo(_intersectPoint))<e.near||r>e.far||t.push({distance:r,point:_intersectPoint.clone(),uv:Triangle.getUV(_intersectPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2),face:null,object:this}))}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function transformVertex(e,t,r,n,i,o){_alignedPosition.subVectors(e,r).addScalar(.5).multiply(n),void 0!==i?(_rotatedPosition.x=o*_alignedPosition.x-i*_alignedPosition.y,_rotatedPosition.y=i*_alignedPosition.x+o*_alignedPosition.y):_rotatedPosition.copy(_alignedPosition),e.copy(t),e.x+=_rotatedPosition.x,e.y+=_rotatedPosition.y,e.applyMatrix4(_viewWorldMatrix)}Sprite.prototype.isSprite=!0;const _v1$2=new Vector3,_v2$1=new Vector3;class LOD extends Object3D{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);var r=e.levels;for(let e=0,t=r.length;e<t;e++){const n=r[e];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const r=this.levels;let n;for(n=0;n<r.length&&!(t<r[n].distance);n++);return r.splice(n,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(r){var n=this.levels;if(0<n.length){let e,t;for(e=1,t=n.length;e<t&&!(r<n[e].distance);e++);return n[e-1].object}return null}raycast(e,t){var r;0<this.levels.length&&(_v1$2.setFromMatrixPosition(this.matrixWorld),r=e.ray.origin.distanceTo(_v1$2),this.getObjectForDistance(r).raycast(e,t))}update(r){const n=this.levels;if(1<n.length){_v1$2.setFromMatrixPosition(r.matrixWorld),_v2$1.setFromMatrixPosition(this.matrixWorld);var i=_v1$2.distanceTo(_v2$1)/r.zoom;n[0].object.visible=!0;let e,t;for(e=1,t=n.length;e<t&&i>=n[e].distance;e++)n[e-1].object.visible=!1,n[e].object.visible=!0;for(this._currentLevel=e-1;e<t;e++)n[e].object.visible=!1}}toJSON(e){const r=super.toJSON(e);!1===this.autoUpdate&&(r.object.autoUpdate=!1),r.object.levels=[];var n=this.levels;for(let e=0,t=n.length;e<t;e++){var i=n[e];r.object.levels.push({object:i.object.uuid,distance:i.distance})}return r}}const _basePosition=new Vector3,_skinIndex=new Vector4,_skinWeight=new Vector4,_vector$5=new Vector3,_matrix=new Matrix4;function SkinnedMesh(e,t){Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4}function Bone(){Object3D.call(this),this.type="Bone"}SkinnedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:SkinnedMesh,isSkinnedMesh:!0,copy:function(e){return Mesh.prototype.copy.call(this,e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const r=new Vector4,n=this.geometry.attributes.skinWeight;for(let e=0,t=n.count;e<t;e++){r.x=n.getX(e),r.y=n.getY(e),r.z=n.getZ(e),r.w=n.getW(e);var i=1/r.manhattanLength();i!=1/0?r.multiplyScalar(i):r.set(1,0,0,0),n.setXYZW(e,r.x,r.y,r.z,r.w)}},updateMatrixWorld:function(e){Mesh.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(e,t){var r=this.skeleton,n=this.geometry;_skinIndex.fromBufferAttribute(n.attributes.skinIndex,e),_skinWeight.fromBufferAttribute(n.attributes.skinWeight,e),_basePosition.fromBufferAttribute(n.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){var i,o=_skinWeight.getComponent(e);0!==o&&(i=_skinIndex.getComponent(e),_matrix.multiplyMatrices(r.bones[i].matrixWorld,r.boneInverses[i]),t.addScaledVector(_vector$5.copy(_basePosition).applyMatrix4(_matrix),o))}return t.applyMatrix4(this.bindMatrixInverse)}}),Bone.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Bone,isBone:!0});const _offsetMatrix=new Matrix4,_identityMatrix=new Matrix4;class Skeleton{constructor(e=[],t=[]){this.uuid=MathUtils.generateUUID(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){var e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Matrix4)}}calculateInverses(){for(let e=this.boneInverses.length=0,t=this.bones.length;e<t;e++){const r=new Matrix4;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){var r=this.bones,n=this.boneInverses,i=this.boneMatrices;const e=this.boneTexture;for(let e=0,t=r.length;e<t;e++){var o=r[e]?r[e].matrixWorld:_identityMatrix;_offsetMatrix.multiplyMatrices(o,n[e]),_offsetMatrix.toArray(i,16*e)}null!==e&&(e.needsUpdate=!0)}clone(){return new Skeleton(this.bones,this.boneInverses)}getBoneByName(r){for(let e=0,t=this.bones.length;e<t;e++){var n=this.bones[e];if(n.name===r)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(r,n){this.uuid=r.uuid;for(let t=0,e=r.bones.length;t<e;t++){var i=r.bones[t];let e=n[i];void 0===e&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),e=new Bone),this.bones.push(e),this.boneInverses.push((new Matrix4).fromArray(r.boneInverses[t]))}return this.init(),this}toJSON(){const r={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};r.uuid=this.uuid;var n=this.bones,i=this.boneInverses;for(let e=0,t=n.length;e<t;e++){var o=n[e];r.bones.push(o.uuid);const a=i[e];r.boneInverses.push(a.toArray())}return r}}const _instanceLocalMatrix=new Matrix4,_instanceWorldMatrix=new Matrix4,_instanceIntersects=[],_mesh=new Mesh;function InstancedMesh(e,t,r){Mesh.call(this,e,t),this.instanceMatrix=new BufferAttribute(new Float32Array(16*r),16),this.instanceColor=null,this.count=r,this.frustumCulled=!1}InstancedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:InstancedMesh,isInstancedMesh:!0,copy:function(e){return Mesh.prototype.copy.call(this,e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this},getColorAt:function(e,t){t.fromArray(this.instanceColor.array,3*e)},getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,n){var t=this.matrixWorld,i=this.count;if(_mesh.geometry=this.geometry,_mesh.material=this.material,void 0!==_mesh.material)for(let r=0;r<i;r++){this.getMatrixAt(r,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(t,_instanceLocalMatrix),_mesh.matrixWorld=_instanceWorldMatrix,_mesh.raycast(e,_instanceIntersects);for(let e=0,t=_instanceIntersects.length;e<t;e++){const o=_instanceIntersects[e];o.instanceId=r,o.object=this,n.push(o)}_instanceIntersects.length=0}},setColorAt:function(e,t){null===this.instanceColor&&(this.instanceColor=new BufferAttribute(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*e)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}});class LineBasicMaterial extends Material{constructor(e){super(),this.type="LineBasicMaterial",this.color=new Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this}}LineBasicMaterial.prototype.isLineBasicMaterial=!0;const _start$1=new Vector3,_end$1=new Vector3,_inverseMatrix$1=new Matrix4,_ray$1=new Ray,_sphere$1=new Sphere;function Line(e=new BufferGeometry,t=new LineBasicMaterial){Object3D.call(this),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}Line.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Line,isLine:!0,copy:function(e){return Object3D.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},computeLineDistances:function(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){var r=e.attributes.position;const n=[0];for(let e=1,t=r.count;e<t;e++)_start$1.fromBufferAttribute(r,e-1),_end$1.fromBufferAttribute(r,e),n[e]=n[e-1],n[e]+=_start$1.distanceTo(_end$1);e.setAttribute("lineDistance",new Float32BufferAttribute(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this},raycast:function(r,n){const e=this.geometry;var t=this.matrixWorld,i=r.params.Line.threshold,o=e.drawRange;if(null===e.boundingSphere&&e.computeBoundingSphere(),_sphere$1.copy(e.boundingSphere),_sphere$1.applyMatrix4(t),_sphere$1.radius+=i,!1!==r.ray.intersectsSphere(_sphere$1)){_inverseMatrix$1.copy(t).invert(),_ray$1.copy(r.ray).applyMatrix4(_inverseMatrix$1);var i=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=i*i;const A=new Vector3,d=new Vector3,p=new Vector3,m=new Vector3;var s=this.isLineSegments?2:1;if(e.isBufferGeometry){const f=e.index;var l,c=e.attributes.position;if(null!==f)for(let e=Math.max(0,o.start),t=Math.min(f.count,o.start+o.count)-1;e<t;e+=s){var h=f.getX(e),u=f.getX(e+1);A.fromBufferAttribute(c,h),d.fromBufferAttribute(c,u),a<_ray$1.distanceSqToSegment(A,d,m,p)||(m.applyMatrix4(this.matrixWorld),(u=r.ray.origin.distanceTo(m))<r.near||u>r.far||n.push({distance:u,point:p.clone().applyMatrix4(this.matrixWorld),index:e,face:null,faceIndex:null,object:this}))}else for(let e=Math.max(0,o.start),t=Math.min(c.count,o.start+o.count)-1;e<t;e+=s)A.fromBufferAttribute(c,e),d.fromBufferAttribute(c,e+1),a<_ray$1.distanceSqToSegment(A,d,m,p)||(m.applyMatrix4(this.matrixWorld),(l=r.ray.origin.distanceTo(m))<r.near||l>r.far||n.push({distance:l,point:p.clone().applyMatrix4(this.matrixWorld),index:e,face:null,faceIndex:null,object:this}))}else e.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,r=Object.keys(t);if(0<r.length){var n=t[r[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){var i=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{e=e.morphTargets;void 0!==e&&0<e.length&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const _start=new Vector3,_end=new Vector3;function LineSegments(e,t){Line.call(this,e,t),this.type="LineSegments"}LineSegments.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineSegments,isLineSegments:!0,computeLineDistances:function(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){var r=e.attributes.position;const n=[];for(let e=0,t=r.count;e<t;e+=2)_start.fromBufferAttribute(r,e),_end.fromBufferAttribute(r,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+_start.distanceTo(_end);e.setAttribute("lineDistance",new Float32BufferAttribute(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}});class LineLoop extends Line{constructor(e,t){super(e,t),this.type="LineLoop"}}LineLoop.prototype.isLineLoop=!0;class PointsMaterial extends Material{constructor(e){super(),this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this}}PointsMaterial.prototype.isPointsMaterial=!0;const _inverseMatrix=new Matrix4,_ray=new Ray,_sphere=new Sphere,_position$2=new Vector3;function Points(e=new BufferGeometry,t=new PointsMaterial){Object3D.call(this),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}function testPoint(e,t,r,n,i,o,a){var s=_ray.distanceSqToPoint(e);if(s<r){const l=new Vector3;_ray.closestPointToPoint(e,l),l.applyMatrix4(n);n=i.ray.origin.distanceTo(l);n<i.near||n>i.far||o.push({distance:n,distanceToRay:Math.sqrt(s),point:l,index:t,face:null,object:a})}}Points.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Points,isPoints:!0,copy:function(e){return Object3D.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},raycast:function(r,n){const e=this.geometry;var i=this.matrixWorld,t=r.params.Points.threshold,o=e.drawRange;if(null===e.boundingSphere&&e.computeBoundingSphere(),_sphere.copy(e.boundingSphere),_sphere.applyMatrix4(i),_sphere.radius+=t,!1!==r.ray.intersectsSphere(_sphere)){_inverseMatrix.copy(i).invert(),_ray.copy(r.ray).applyMatrix4(_inverseMatrix);var t=t/((this.scale.x+this.scale.y+this.scale.z)/3),a=t*t;if(e.isBufferGeometry){const c=e.index;var s=e.attributes.position;if(null!==c)for(let e=Math.max(0,o.start),t=Math.min(c.count,o.start+o.count);e<t;e++){var l=c.getX(e);_position$2.fromBufferAttribute(s,l),testPoint(_position$2,l,a,i,r,n,this)}else for(let e=Math.max(0,o.start),t=Math.min(s.count,o.start+o.count);e<t;e++)_position$2.fromBufferAttribute(s,e),testPoint(_position$2,e,a,i,r,n,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,r=Object.keys(t);if(0<r.length){var n=t[r[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){var i=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{e=e.morphTargets;void 0!==e&&0<e.length&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});class VideoTexture extends Texture{constructor(t,e,r,n,i,o,a,s,l){super(t,e,r,n,i,o,a,s,l),this.format=void 0!==a?a:RGBFormat,this.minFilter=void 0!==o?o:LinearFilter,this.magFilter=void 0!==i?i:LinearFilter,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)})}clone(){return new this.constructor(this.image).copy(this)}update(){var e=this.image;!1=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}VideoTexture.prototype.isVideoTexture=!0;class CompressedTexture extends Texture{constructor(e,t,r,n,i,o,a,s,l,c,h,u){super(null,o,a,s,l,c,n,i,h,u),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}CompressedTexture.prototype.isCompressedTexture=!0;class CanvasTexture extends Texture{constructor(e,t,r,n,i,o,a,s,l){super(e,t,r,n,i,o,a,s,l),this.needsUpdate=!0}}CanvasTexture.prototype.isCanvasTexture=!0;class DepthTexture extends Texture{constructor(e,t,r,n,i,o,a,s,l,c){if((c=void 0!==c?c:DepthFormat)!==DepthFormat&&c!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super(null,n,i,o,a,s,c,r=void 0===(r=void 0===r&&c===DepthFormat?UnsignedShortType:r)&&c===DepthStencilFormat?UnsignedInt248Type:r,l),this.image={width:e,height:t},this.magFilter=void 0!==a?a:NearestFilter,this.minFilter=void 0!==s?s:NearestFilter,this.flipY=!1,this.generateMipmaps=!1}}DepthTexture.prototype.isDepthTexture=!0;class CircleGeometry extends BufferGeometry{constructor(r=1,n=8,i=0,o=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:r,segments:n,thetaStart:i,thetaLength:o},n=Math.max(3,n);const t=[],a=[],s=[],l=[],c=new Vector3,h=new Vector2;a.push(0,0,0),s.push(0,0,1),l.push(.5,.5);for(let e=0,t=3;e<=n;e++,t+=3){var u=i+e/n*o;c.x=r*Math.cos(u),c.y=r*Math.sin(u),a.push(c.x,c.y,c.z),s.push(0,0,1),h.x=(a[t]/r+1)/2,h.y=(a[t+1]/r+1)/2,l.push(h.x,h.y)}for(let e=1;e<=n;e++)t.push(e,e+1,0);this.setIndex(t),this.setAttribute("position",new Float32BufferAttribute(a,3)),this.setAttribute("normal",new Float32BufferAttribute(s,3)),this.setAttribute("uv",new Float32BufferAttribute(l,2))}}class CylinderGeometry extends BufferGeometry{constructor(m=1,f=1,g=1,v=8,_=1,e=!1,y=0,w=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:m,radiusBottom:f,height:g,radialSegments:v,heightSegments:_,openEnded:e,thetaStart:y,thetaLength:w};const x=this;v=Math.floor(v),_=Math.floor(_);const b=[],T=[],E=[],B=[];let C=0;const S=[],M=g/2;let N=0;function t(t){var r=C;const n=new Vector2,i=new Vector3;let o=0;var a=!0===t?m:f,s=!0===t?1:-1;for(let e=1;e<=v;e++)T.push(0,M*s,0),E.push(0,s,0),B.push(.5,.5),C++;var l=C;for(let e=0;e<=v;e++){var c=e/v*w+y,h=Math.cos(c),c=Math.sin(c);i.x=a*c,i.y=M*s,i.z=a*h,T.push(i.x,i.y,i.z),E.push(0,s,0),n.x=.5*h+.5,n.y=.5*c*s+.5,B.push(n.x,n.y),C++}for(let e=0;e<v;e++){var u=r+e,A=l+e;!0===t?b.push(A,A+1,u):b.push(A+1,A,u),o+=3}x.addGroup(N,o,!0===t?1:2),N+=o}!function(){const t=new Vector3,r=new Vector3;let n=0;var i=(f-m)/g;for(let e=0;e<=_;e++){const p=[];var o=e/_,a=o*(f-m)+m;for(let e=0;e<=v;e++){var s=e/v,l=s*w+y,c=Math.sin(l),l=Math.cos(l);r.x=a*c,r.y=-o*g+M,r.z=a*l,T.push(r.x,r.y,r.z),t.set(c,i,l).normalize(),E.push(t.x,t.y,t.z),B.push(s,1-o),p.push(C++)}S.push(p)}for(let t=0;t<v;t++)for(let e=0;e<_;e++){var h=S[e][t],u=S[e+1][t],A=S[e+1][t+1],d=S[e][t+1];b.push(h,u,d),b.push(u,A,d),n+=6}x.addGroup(N,n,0),N+=n}(),!1===e&&(0<m&&t(!0),0<f&&t(!1)),this.setIndex(b),this.setAttribute("position",new Float32BufferAttribute(T,3)),this.setAttribute("normal",new Float32BufferAttribute(E,3)),this.setAttribute("uv",new Float32BufferAttribute(B,2))}}class ConeGeometry extends CylinderGeometry{constructor(e=1,t=1,r=8,n=1,i=!1,o=0,a=2*Math.PI){super(0,e,t,r,n,i,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:a}}}class PolyhedronGeometry extends BufferGeometry{constructor(r,o,e=1,t=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:r,indices:o,radius:e,detail:t};const h=[],u=[];function A(e){h.push(e.x,e.y,e.z)}function a(e,t){e*=3;t.x=r[0+e],t.y=r[1+e],t.z=r[2+e]}function d(e,t,r,n){n<0&&1===e.x&&(u[t]=e.x-1),0===r.x&&0===r.z&&(u[t]=n/2/Math.PI+.5)}function p(e){return Math.atan2(e.z,-e.x)}!function(t){var r=new Vector3,n=new Vector3,i=new Vector3;for(let e=0;e<o.length;e+=3)a(o[e+0],r),a(o[e+1],n),a(o[e+2],i),function(e,r,n,t){const i=t+1,o=[];for(let t=0;t<=i;t++){o[t]=[];const c=e.clone().lerp(n,t/i);var a=r.clone().lerp(n,t/i),s=i-t;for(let e=0;e<=s;e++)0===e&&t===i?o[t][e]=c:o[t][e]=c.clone().lerp(a,e/s)}for(let t=0;t<i;t++)for(let e=0;e<2*(i-t)-1;e++){var l=Math.floor(e/2);e%2==0?(A(o[t][l+1]),A(o[t+1][l]),A(o[t][l])):(A(o[t][l+1]),A(o[t+1][l+1]),A(o[t+1][l]))}}(r,n,i,t)}(t),function(t){const r=new Vector3;for(let e=0;e<h.length;e+=3)r.x=h[e+0],r.y=h[e+1],r.z=h[e+2],r.normalize().multiplyScalar(t),h[e+0]=r.x,h[e+1]=r.y,h[e+2]=r.z}(e),function(){const t=new Vector3;for(let e=0;e<h.length;e+=3){t.x=h[e+0],t.y=h[e+1],t.z=h[e+2];var r=p(t)/2/Math.PI+.5,n=function(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(t)/Math.PI+.5;u.push(r,1-n)}(function(){const r=new Vector3,n=new Vector3,i=new Vector3,o=new Vector3,a=new Vector2,s=new Vector2,l=new Vector2;for(let e=0,t=0;e<h.length;e+=9,t+=6){r.set(h[e+0],h[e+1],h[e+2]),n.set(h[e+3],h[e+4],h[e+5]),i.set(h[e+6],h[e+7],h[e+8]),a.set(u[t+0],u[t+1]),s.set(u[t+2],u[t+3]),l.set(u[t+4],u[t+5]),o.copy(r).add(n).add(i).divideScalar(3);var c=p(o);d(a,t+0,r,c),d(s,t+2,n,c),d(l,t+4,i,c)}})(),function(){for(let e=0;e<u.length;e+=6){var t=u[e+0],r=u[e+2],n=u[e+4],i=Math.max(t,r,n),o=Math.min(t,r,n);.9<i&&o<.1&&(t<.2&&(u[e+0]+=1),r<.2&&(u[e+2]+=1),n<.2&&(u[e+4]+=1))}}()}(),this.setAttribute("position",new Float32BufferAttribute(h,3)),this.setAttribute("normal",new Float32BufferAttribute(h.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(u,2)),0===t?this.computeVertexNormals():this.normalizeNormals()}}class DodecahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){var r=(1+Math.sqrt(5))/2,n=1/r;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}}const _v0=new Vector3,_v1$1=new Vector3,_normal=new Vector3,_triangle=new Triangle;class EdgesGeometry extends BufferGeometry{constructor(e,t){if(super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1,!0!==e.isGeometry){var r=Math.pow(10,4),n=Math.cos(MathUtils.DEG2RAD*t);const m=e.getIndex();var i=e.getAttribute("position"),o=(m||i).count;const f=[0,0,0];var a,s,l=["a","b","c"];const g=new Array(3),v={},_=[];for(let e=0;e<o;e+=3){m?(f[0]=m.getX(e),f[1]=m.getX(e+1),f[2]=m.getX(e+2)):(f[0]=e,f[1]=e+1,f[2]=e+2);const{a:y,b:w,c:x}=_triangle;if(y.fromBufferAttribute(i,f[0]),w.fromBufferAttribute(i,f[1]),x.fromBufferAttribute(i,f[2]),_triangle.getNormal(_normal),g[0]=`${Math.round(y.x*r)},${Math.round(y.y*r)},`+Math.round(y.z*r),g[1]=`${Math.round(w.x*r)},${Math.round(w.y*r)},`+Math.round(w.z*r),g[2]=`${Math.round(x.x*r)},${Math.round(x.y*r)},`+Math.round(x.z*r),g[0]!==g[1]&&g[1]!==g[2]&&g[2]!==g[0])for(let e=0;e<3;e++){var c=(e+1)%3,h=g[e],u=g[c],A=_triangle[l[e]],d=_triangle[l[c]],p=h+"_"+u,h=u+"_"+h;h in v&&v[h]?(_normal.dot(v[h].normal)<=n&&(_.push(A.x,A.y,A.z),_.push(d.x,d.y,d.z)),v[h]=null):p in v||(v[p]={index0:f[e],index1:f[c],normal:_normal.clone()})}}for(const b in v)v[b]&&({index0:a,index1:s}=v[b],_v0.fromBufferAttribute(i,a),_v1$1.fromBufferAttribute(i,s),_.push(_v0.x,_v0.y,_v0.z),_.push(_v1$1.x,_v1$1.y,_v1$1.z));this.setAttribute("position",new Float32BufferAttribute(_,3))}else console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}const Earcut={triangulate:function(t,e,r){r=r||2;var n=e&&e.length,i=n?e[0]*r:t.length;let o=linkedList(t,0,i,r,!0);var a=[];if(!o||o.next===o.prev)return a;let s,l,c,h,u,A,d;if(n&&(o=eliminateHoles(t,e,o,r)),t.length>80*r){s=c=t[0],l=h=t[1];for(let e=r;e<i;e+=r)u=t[e],A=t[e+1],u<s&&(s=u),A<l&&(l=A),u>c&&(c=u),A>h&&(h=A);d=Math.max(c-s,h-l),d=0!==d?1/d:0}return earcutLinked(o,a,r,s,l,d),a}};function linkedList(e,t,r,n,i){let o,a;if(i===0<signedArea(e,t,r,n))for(o=t;o<r;o+=n)a=insertNode(o,e[o],e[o+1],a);else for(o=r-n;o>=t;o-=n)a=insertNode(o,e[o],e[o+1],a);return a&&equals(a,a.next)&&(removeNode(a),a=a.next),a}function filterPoints(e,t){if(!e)return e;t=t||e;let r=e,n;do{if(n=!1,r.steiner||!equals(r,r.next)&&0!==area(r.prev,r,r.next))r=r.next;else{if(removeNode(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function earcutLinked(n,i,o,a,s,l,c){if(n){!c&&l&&indexCurve(n,a,s,l);let e=n,t,r;for(;n.prev!==n.next;)if(t=n.prev,r=n.next,l?isEarHashed(n,a,s,l):isEar(n))i.push(t.i/o),i.push(n.i/o),i.push(r.i/o),removeNode(n),n=r.next,e=r.next;else if((n=r)===e){c?1===c?earcutLinked(n=cureLocalIntersections(filterPoints(n),i,o),i,o,a,s,l,2):2===c&&splitEarcut(n,i,o,a,s,l):earcutLinked(filterPoints(n),i,o,a,s,l,1);break}}}function isEar(e){var t=e.prev,r=e,n=e.next;if(0<=area(t,r,n))return!1;let i=e.next.next;for(;i!==e.prev;){if(pointInTriangle(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&0<=area(i.prev,i,i.next))return!1;i=i.next}return!0}function isEarHashed(e,t,r,n){var i=e.prev,o=e,a=e.next;if(0<=area(i,o,a))return!1;var s=(i.x<o.x?i.x<a.x?i:a:o.x<a.x?o:a).x,l=(i.y<o.y?i.y<a.y?i:a:o.y<a.y?o:a).y,c=(i.x>o.x?i.x>a.x?i:a:o.x>a.x?o:a).x,h=(i.y>o.y?i.y>a.y?i:a:o.y>a.y?o:a).y,u=zOrder(s,l,t,r,n),A=zOrder(c,h,t,r,n);let d=e.prevZ,p=e.nextZ;for(;d&&d.z>=u&&p&&p.z<=A;){if(d!==e.prev&&d!==e.next&&pointInTriangle(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&0<=area(d.prev,d,d.next))return!1;if(d=d.prevZ,p!==e.prev&&p!==e.next&&pointInTriangle(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&0<=area(p.prev,p,p.next))return!1;p=p.nextZ}for(;d&&d.z>=u;){if(d!==e.prev&&d!==e.next&&pointInTriangle(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&0<=area(d.prev,d,d.next))return!1;d=d.prevZ}for(;p&&p.z<=A;){if(p!==e.prev&&p!==e.next&&pointInTriangle(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&0<=area(p.prev,p,p.next))return!1;p=p.nextZ}return!0}function cureLocalIntersections(e,t,r){let n=e;do{var i=n.prev,o=n.next.next;!equals(i,o)&&intersects(i,n,n.next,o)&&locallyInside(i,o)&&locallyInside(o,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(o.i/r),removeNode(n),removeNode(n.next),n=e=o),n=n.next}while(n!==e);return filterPoints(n)}function splitEarcut(e,t,r,n,i,o){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&isValidDiagonal(a,e)){var s=splitPolygon(a,e);return a=filterPoints(a,a.next),s=filterPoints(s,s.next),earcutLinked(a,t,r,n,i,o),void earcutLinked(s,t,r,n,i,o)}e=e.next}}while(a=a.next,a!==e)}function eliminateHoles(e,t,r,n){const i=[];let o,a,s,l,c;for(o=0,a=t.length;o<a;o++)s=t[o]*n,l=o<a-1?t[o+1]*n:e.length,c=linkedList(e,s,l,n,!1),c===c.next&&(c.steiner=!0),i.push(getLeftmost(c));for(i.sort(compareX),o=0;o<i.length;o++)eliminateHole(i[o],r),r=filterPoints(r,r.next);return r}function compareX(e,t){return e.x-t.x}function eliminateHole(e,t){(t=findHoleBridge(e,t))&&(e=splitPolygon(t,e),filterPoints(t,t.next),filterPoints(e,e.next))}function findHoleBridge(e,t){let r=t;var n=e.x,i=e.y;let o=-1/0,a;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var s=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=n&&s>o){if((o=s)===n){if(i===r.y)return r;if(i===r.next.y)return r.next}a=r.x<r.next.x?r:r.next}}}while(r=r.next,r!==t);if(!a)return null;if(n===o)return a;var l=a,c=a.x,h=a.y;let u=1/0,A;for(r=a;n>=r.x&&r.x>=c&&n!==r.x&&pointInTriangle(i<h?n:o,i,c,h,i<h?o:n,i,r.x,r.y)&&(A=Math.abs(i-r.y)/(n-r.x),locallyInside(r,e)&&(A<u||A===u&&(r.x>a.x||r.x===a.x&&sectorContainsSector(a,r)))&&(a=r,u=A)),r=r.next,r!==l;);return a}function sectorContainsSector(e,t){return area(e.prev,e,t.prev)<0&&area(t.next,e,e.next)<0}function indexCurve(e,t,r,n){let i=e;for(;null===i.z&&(i.z=zOrder(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next,i!==e;);i.prevZ.nextZ=null,i.prevZ=null,sortLinked(i)}function sortLinked(e){let t,r,n,i,o,a,s,l,c=1;do{for(r=e,e=null,o=null,a=0;r;){for(a++,n=r,s=0,t=0;t<c&&(s++,n=n.nextZ,n);t++);for(l=c;0<s||0<l&&n;)0!==s&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,l--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=n}}while(o.nextZ=null,c*=2,1<a);return e}function zOrder(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function getLeftmost(e){let t=e,r=e;for(;(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next,t!==e;);return r}function pointInTriangle(e,t,r,n,i,o,a,s){return 0<=(i-a)*(t-s)-(e-a)*(o-s)&&0<=(e-a)*(n-s)-(r-a)*(t-s)&&0<=(r-a)*(o-s)-(i-a)*(n-s)}function isValidDiagonal(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!intersectsPolygon(e,t)&&(locallyInside(e,t)&&locallyInside(t,e)&&middleInside(e,t)&&(area(e.prev,e,t.prev)||area(e,t.prev,t))||equals(e,t)&&0<area(e.prev,e,e.next)&&0<area(t.prev,t,t.next))}function area(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function equals(e,t){return e.x===t.x&&e.y===t.y}function intersects(e,t,r,n){var i=sign(area(e,t,r)),o=sign(area(e,t,n)),a=sign(area(r,n,e)),s=sign(area(r,n,t));return i!==o&&a!==s||(!(0!==i||!onSegment(e,r,t))||(!(0!==o||!onSegment(e,n,t))||(!(0!==a||!onSegment(r,e,n))||!(0!==s||!onSegment(r,t,n)))))}function onSegment(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function sign(e){return 0<e?1:e<0?-1:0}function intersectsPolygon(e,t){let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&intersects(r,r.next,e,t))return!0}while(r=r.next,r!==e);return!1}function locallyInside(e,t){return area(e.prev,e,e.next)<0?0<=area(e,t,e.next)&&0<=area(e,e.prev,t):area(e,t,e.prev)<0||area(e,e.next,t)<0}function middleInside(e,t){let r=e,n=!1;for(var i=(e.x+t.x)/2,o=(e.y+t.y)/2;r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next,r!==e;);return n}function splitPolygon(e,t){const r=new Node$1(e.i,e.x,e.y),n=new Node$1(t.i,t.x,t.y),i=e.next,o=t.prev;return(e.next=t).prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function insertNode(e,t,r,n){const i=new Node$1(e,t,r);return n?(i.next=n.next,(i.prev=n).next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node$1(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(r,n,i,o){let a=0;for(let e=n,t=i-o;e<i;e+=o)a+=(r[t]-r[e])*(r[e+1]+r[t+1]),t=e;return a}const ShapeUtils={area:function(r){var n=r.length;let i=0;for(let e=n-1,t=0;t<n;e=t++)i+=r[e].x*r[t].y-r[t].x*r[e].y;return.5*i},isClockWise:function(e){return ShapeUtils.area(e)<0},triangulateShape:function(e,t){var r=[];const n=[],i=[];removeDupEndPts(e),addContour(r,e);let o=e.length;t.forEach(removeDupEndPts);for(let e=0;e<t.length;e++)n.push(o),o+=t[e].length,addContour(r,t[e]);const a=Earcut.triangulate(r,n);for(let e=0;e<a.length;e+=3)i.push(a.slice(e,e+3));return i}};function removeDupEndPts(e){var t=e.length;2<t&&e[t-1].equals(e[0])&&e.pop()}function addContour(t,r){for(let e=0;e<r.length;e++)t.push(r[e].x),t.push(r[e].y)}class ExtrudeGeometry extends BufferGeometry{constructor(r,$){super(),this.type="ExtrudeGeometry",this.parameters={shapes:r,options:$},r=Array.isArray(r)?r:[r];const Z=this,ee=[],te=[];for(let e=0,t=r.length;e<t;e++)!function(e){const n=[],t=void 0!==$.curveSegments?$.curveSegments:12,s=void 0!==$.steps?$.steps:1;let r=void 0!==$.depth?$.depth:100,a=void 0===$.bevelEnabled||$.bevelEnabled,i=void 0!==$.bevelThickness?$.bevelThickness:6,o=void 0!==$.bevelSize?$.bevelSize:i-2,l=void 0!==$.bevelOffset?$.bevelOffset:0,c=void 0!==$.bevelSegments?$.bevelSegments:3;const h=$.extrudePath,u=void 0!==$.UVGenerator?$.UVGenerator:WorldUVGenerator;void 0!==$.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),r=$.amount);let A,d=!1,p,m,f,g;h&&(A=h.getSpacedPoints(s),d=!0,a=!1,p=h.computeFrenetFrames(s,!1),m=new Vector3,f=new Vector3,g=new Vector3);a||(c=0,i=0,o=0,l=0);e=e.extractPoints(t);let v=e.shape;const _=e.holes,y=!ShapeUtils.isClockWise(v);if(y){v=v.reverse();for(let e=0,t=_.length;e<t;e++){const q=_[e];ShapeUtils.isClockWise(q)&&(_[e]=q.reverse())}}const w=ShapeUtils.triangulateShape(v,_),x=v;for(let e=0,t=_.length;e<t;e++){var b=_[e];v=v.concat(b)}function T(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}const E=v.length,B=w.length;function C(e,t,r){let n,i,o;var a=e.x-t.x,s=e.y-t.y,l=r.x-e.x,c=r.y-e.y,h=a*a+s*s;if(Math.abs(a*c-s*l)>Number.EPSILON){var u=Math.sqrt(h),A=Math.sqrt(l*l+c*c),d=t.x-s/u,u=t.y+a/u,A=((r.x-c/A-d)*c-(r.y+l/A-u)*l)/(a*c-s*l);n=d+a*A-e.x,i=u+s*A-e.y;e=n*n+i*i;if(e<=2)return new Vector2(n,i);o=Math.sqrt(e/2)}else{let e=!1;a>Number.EPSILON?l>Number.EPSILON&&(e=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(s)===Math.sign(c)&&(e=!0),o=e?(n=-s,i=a,Math.sqrt(h)):(n=a,i=s,Math.sqrt(h/2))}return new Vector2(n/o,i/o)}const S=[];for(let e=0,t=x.length,r=t-1,n=e+1;e<t;e++,r++,n++)r===t&&(r=0),n===t&&(n=0),S[e]=C(x[e],x[r],x[n]);const M=[];let N,L=S.concat();for(let e=0,t=_.length;e<t;e++){var F=_[e];N=[];for(let e=0,t=F.length,r=t-1,n=e+1;e<t;e++,r++,n++)r===t&&(r=0),n===t&&(n=0),N[e]=C(F[e],F[r],F[n]);M.push(N),L=L.concat(N)}for(let e=0;e<c;e++){var U=e/c,R=i*Math.cos(U*Math.PI/2);const D=o*Math.sin(U*Math.PI/2)+l;for(let e=0,t=x.length;e<t;e++){var I=T(x[e],S[e],D);j(I.x,I.y,-R)}for(let e=0,t=_.length;e<t;e++){var P=_[e];N=M[e];for(let e=0,t=P.length;e<t;e++){var O=T(P[e],N[e],D);j(O.x,O.y,-R)}}}const D=o+l;for(let e=0;e<E;e++){var H=a?T(v[e],L[e],D):v[e];d?(f.copy(p.normals[0]).multiplyScalar(H.x),m.copy(p.binormals[0]).multiplyScalar(H.y),g.copy(A[0]).add(f).add(m),j(g.x,g.y,g.z)):j(H.x,H.y,0)}for(let t=1;t<=s;t++)for(let e=0;e<E;e++){var Q=a?T(v[e],L[e],D):v[e];d?(f.copy(p.normals[t]).multiplyScalar(Q.x),m.copy(p.binormals[t]).multiplyScalar(Q.y),g.copy(A[t]).add(f).add(m),j(g.x,g.y,g.z)):j(Q.x,Q.y,r/s*t)}for(let e=c-1;0<=e;e--){var k=e/c,V=i*Math.cos(k*Math.PI/2);const D=o*Math.sin(k*Math.PI/2)+l;for(let e=0,t=x.length;e<t;e++){var G=T(x[e],S[e],D);j(G.x,G.y,r+V)}for(let e=0,t=_.length;e<t;e++){var z=_[e];N=M[e];for(let e=0,t=z.length;e<t;e++){var K=T(z[e],N[e],D);d?j(K.x,K.y+A[s-1].y,A[s-1].x+V):j(K.x,K.y,r+V)}}}function W(e,n){let t=e.length;for(;0<=--t;){var i=t;let r=t-1;r<0&&(r=e.length-1);for(let e=0,t=s+2*c;e<t;e++){var o=E*e,a=E*(e+1);!function(e,t,r,n){Y(e),Y(t),Y(n),Y(t),Y(r),Y(n);n=ee.length/3,n=u.generateSideWallUV(Z,ee,n-6,n-3,n-2,n-1);J(n[0]),J(n[1]),J(n[3]),J(n[1]),J(n[2]),J(n[3])}(n+i+o,n+r+o,n+r+a,n+i+a)}}}function j(e,t,r){n.push(e),n.push(t),n.push(r)}function X(e,t,r){Y(e),Y(t),Y(r);r=ee.length/3,r=u.generateTopUV(Z,ee,r-3,r-2,r-1);J(r[0]),J(r[1]),J(r[2])}function Y(e){ee.push(n[3*e+0]),ee.push(n[3*e+1]),ee.push(n[3*e+2])}function J(e){te.push(e.x),te.push(e.y)}(function(){var e,t=ee.length/3;if(a){let t=0*E;for(let e=0;e<B;e++){var r=w[e];X(r[2]+t,r[1]+t,r[0]+t)}e=s+2*c,t=E*e;for(let e=0;e<B;e++){var n=w[e];X(n[0]+t,n[1]+t,n[2]+t)}}else{for(let e=0;e<B;e++){var i=w[e];X(i[2],i[1],i[0])}for(let e=0;e<B;e++){var o=w[e];X(o[0]+E*s,o[1]+E*s,o[2]+E*s)}}Z.addGroup(t,ee.length/3-t,0)})(),function(){var e=ee.length/3;let r=0;W(x,r),r+=x.length;for(let e=0,t=_.length;e<t;e++){var n=_[e];W(n,r),r+=n.length}Z.addGroup(e,ee.length/3-e,1)}()}(r[e]);this.setAttribute("position",new Float32BufferAttribute(ee,3)),this.setAttribute("uv",new Float32BufferAttribute(te,2)),this.computeVertexNormals()}toJSON(){var e=BufferGeometry.prototype.toJSON.call(this);return toJSON$1(this.parameters.shapes,this.parameters.options,e)}}const WorldUVGenerator={generateTopUV:function(e,t,r,n,i){var o=t[3*r],a=t[3*r+1],s=t[3*n],r=t[3*n+1],n=t[3*i],i=t[3*i+1];return[new Vector2(o,a),new Vector2(s,r),new Vector2(n,i)]},generateSideWallUV:function(e,t,r,n,i,o){var a=t[3*r],s=t[3*r+1],l=t[3*r+2],c=t[3*n],h=t[3*n+1],u=t[3*n+2],A=t[3*i],d=t[3*i+1],r=t[3*i+2],n=t[3*o],i=t[3*o+1],o=t[3*o+2];return Math.abs(s-h)<.01?[new Vector2(a,1-l),new Vector2(c,1-u),new Vector2(A,1-r),new Vector2(n,1-o)]:[new Vector2(s,1-l),new Vector2(h,1-u),new Vector2(d,1-r),new Vector2(i,1-o)]}};function toJSON$1(r,e,n){if(n.shapes=[],Array.isArray(r))for(let e=0,t=r.length;e<t;e++){var i=r[e];n.shapes.push(i.uuid)}else n.shapes.push(r.uuid);return void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON()),n}class IcosahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){var r=(1+Math.sqrt(5))/2;super([-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}}class LatheGeometry extends BufferGeometry{constructor(r,n=12,e=0,i=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:r,segments:n,phiStart:e,phiLength:i},n=Math.floor(n),i=MathUtils.clamp(i,0,2*Math.PI);const o=[],a=[],s=[];var l=1/n;const c=new Vector3,h=new Vector2;for(let t=0;t<=n;t++){var u=e+t*l*i,A=Math.sin(u),d=Math.cos(u);for(let e=0;e<=r.length-1;e++)c.x=r[e].x*A,c.y=r[e].y,c.z=r[e].x*d,a.push(c.x,c.y,c.z),h.x=t/n,h.y=e/(r.length-1),s.push(h.x,h.y)}for(let t=0;t<n;t++)for(let e=0;e<r.length-1;e++){var p=e+t*r.length,m=p+r.length,f=p+r.length+1,g=p+1;o.push(p,m,g),o.push(m,f,g)}if(this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(a,3)),this.setAttribute("uv",new Float32BufferAttribute(s,2)),this.computeVertexNormals(),i===2*Math.PI){const _=this.attributes.normal.array,y=new Vector3,w=new Vector3,x=new Vector3;var v=n*r.length*3;for(let e=0,t=0;e<r.length;e++,t+=3)y.x=_[t+0],y.y=_[t+1],y.z=_[t+2],w.x=_[v+t+0],w.y=_[v+t+1],w.z=_[v+t+2],x.addVectors(y,w).normalize(),_[t+0]=_[v+t+0]=x.x,_[t+1]=_[v+t+1]=x.y,_[t+2]=_[v+t+2]=x.z}}}class OctahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}}function ParametricGeometry(t,r,n){BufferGeometry.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:r,stacks:n};const i=[],o=[],a=[],s=[];const l=new Vector3;var c=new Vector3,h=new Vector3;const u=new Vector3,A=new Vector3;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var d=r+1;for(let e=0;e<=n;e++){var p=e/n;for(let e=0;e<=r;e++){var m=e/r;t(m,p,c),o.push(c.x,c.y,c.z),0<=m-1e-5?(t(m-1e-5,p,h),u.subVectors(c,h)):(t(1e-5+m,p,h),u.subVectors(h,c)),0<=p-1e-5?(t(m,p-1e-5,h),A.subVectors(c,h)):(t(m,1e-5+p,h),A.subVectors(h,c)),l.crossVectors(u,A).normalize(),a.push(l.x,l.y,l.z),s.push(m,p)}}for(let t=0;t<n;t++)for(let e=0;e<r;e++){var f=t*d+e,g=t*d+e+1,v=(t+1)*d+e+1,_=(t+1)*d+e;i.push(f,g,_),i.push(g,v,_)}this.setIndex(i),this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("normal",new Float32BufferAttribute(a,3)),this.setAttribute("uv",new Float32BufferAttribute(s,2))}ParametricGeometry.prototype=Object.create(BufferGeometry.prototype),ParametricGeometry.prototype.constructor=ParametricGeometry;class RingGeometry extends BufferGeometry{constructor(e=.5,t=1,r=8,n=1,i=0,o=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},r=Math.max(3,r);const a=[],s=[],l=[],c=[];let h=e;var u=(t-e)/(n=Math.max(1,n));const A=new Vector3,d=new Vector2;for(let e=0;e<=n;e++){for(let e=0;e<=r;e++){var p=i+e/r*o;A.x=h*Math.cos(p),A.y=h*Math.sin(p),s.push(A.x,A.y,A.z),l.push(0,0,1),d.x=(A.x/t+1)/2,d.y=(A.y/t+1)/2,c.push(d.x,d.y)}h+=u}for(let e=0;e<n;e++){var m=e*(r+1);for(let e=0;e<r;e++){var f=e+m,g=f+r+1,v=f+r+2,_=f+1;a.push(f,g,_),a.push(g,v,_)}}this.setIndex(a),this.setAttribute("position",new Float32BufferAttribute(s,3)),this.setAttribute("normal",new Float32BufferAttribute(l,3)),this.setAttribute("uv",new Float32BufferAttribute(c,2))}}class ShapeGeometry extends BufferGeometry{constructor(t,A=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:A};const d=[],p=[],m=[],f=[];let r=0,g=0;if(!1===Array.isArray(t))n(t);else for(let e=0;e<t.length;e++)n(t[e]),this.addGroup(r,g,e),r+=g,g=0;function n(e){var r=p.length/3,e=e.extractPoints(A);let n=e.shape;const i=e.holes;!1===ShapeUtils.isClockWise(n)&&(n=n.reverse());for(let e=0,t=i.length;e<t;e++){const u=i[e];!0===ShapeUtils.isClockWise(u)&&(i[e]=u.reverse())}var o=ShapeUtils.triangulateShape(n,i);for(let e=0,t=i.length;e<t;e++){var a=i[e];n=n.concat(a)}for(let e=0,t=n.length;e<t;e++){var s=n[e];p.push(s.x,s.y,0),m.push(0,0,1),f.push(s.x,s.y)}for(let e=0,t=o.length;e<t;e++){var l=o[e],c=l[0]+r,h=l[1]+r,l=l[2]+r;d.push(c,h,l),g+=3}}this.setIndex(d),this.setAttribute("position",new Float32BufferAttribute(p,3)),this.setAttribute("normal",new Float32BufferAttribute(m,3)),this.setAttribute("uv",new Float32BufferAttribute(f,2))}toJSON(){var e=BufferGeometry.prototype.toJSON.call(this);return toJSON(this.parameters.shapes,e)}}function toJSON(r,n){if(n.shapes=[],Array.isArray(r))for(let e=0,t=r.length;e<t;e++){var i=r[e];n.shapes.push(i.uuid)}else n.shapes.push(r.uuid);return n}class SphereGeometry extends BufferGeometry{constructor(r=1,n=8,i=6,o=0,a=2*Math.PI,s=0,l=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:r,widthSegments:n,heightSegments:i,phiStart:o,phiLength:a,thetaStart:s,thetaLength:l},n=Math.max(3,Math.floor(n)),i=Math.max(2,Math.floor(i));var c=Math.min(s+l,Math.PI);let h=0;const u=[],A=new Vector3,d=new Vector3,p=[],m=[],f=[],g=[];for(let e=0;e<=i;e++){const T=[];var v=e/i;let t=0;0==e&&0==s?t=.5/n:e==i&&c==Math.PI&&(t=-.5/n);for(let e=0;e<=n;e++){var _=e/n;A.x=-r*Math.cos(o+_*a)*Math.sin(s+v*l),A.y=r*Math.cos(s+v*l),A.z=r*Math.sin(o+_*a)*Math.sin(s+v*l),m.push(A.x,A.y,A.z),d.copy(A).normalize(),f.push(d.x,d.y,d.z),g.push(_+t,1-v),T.push(h++)}u.push(T)}for(let t=0;t<i;t++)for(let e=0;e<n;e++){var y=u[t][e+1],w=u[t][e],x=u[t+1][e],b=u[t+1][e+1];(0!==t||0<s)&&p.push(y,w,b),(t!==i-1||c<Math.PI)&&p.push(w,x,b)}this.setIndex(p),this.setAttribute("position",new Float32BufferAttribute(m,3)),this.setAttribute("normal",new Float32BufferAttribute(f,3)),this.setAttribute("uv",new Float32BufferAttribute(g,2))}}class TetrahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}}class TextGeometry extends ExtrudeGeometry{constructor(e,t={}){const r=t.font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new BufferGeometry;e=r.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),super(e,t),this.type="TextGeometry"}}class TorusGeometry extends BufferGeometry{constructor(r=1,n=.4,i=8,o=6,a=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:r,tube:n,radialSegments:i,tubularSegments:o,arc:a},i=Math.floor(i),o=Math.floor(o);const s=[],l=[],c=[],h=[],u=new Vector3,A=new Vector3,d=new Vector3;for(let t=0;t<=i;t++)for(let e=0;e<=o;e++){var p=e/o*a,m=t/i*Math.PI*2;A.x=(r+n*Math.cos(m))*Math.cos(p),A.y=(r+n*Math.cos(m))*Math.sin(p),A.z=n*Math.sin(m),l.push(A.x,A.y,A.z),u.x=r*Math.cos(p),u.y=r*Math.sin(p),d.subVectors(A,u).normalize(),c.push(d.x,d.y,d.z),h.push(e/o),h.push(t/i)}for(let t=1;t<=i;t++)for(let e=1;e<=o;e++){var f=(o+1)*t+e-1,g=(o+1)*(t-1)+e-1,v=(o+1)*(t-1)+e,_=(o+1)*t+e;s.push(f,g,_),s.push(g,v,_)}this.setIndex(s),this.setAttribute("position",new Float32BufferAttribute(l,3)),this.setAttribute("normal",new Float32BufferAttribute(c,3)),this.setAttribute("uv",new Float32BufferAttribute(h,2))}}class TorusKnotGeometry extends BufferGeometry{constructor(e=1,r=.4,n=64,i=8,o=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:r,tubularSegments:n,radialSegments:i,p:o,q:a},n=Math.floor(n),i=Math.floor(i);const s=[],l=[],c=[],h=[],u=new Vector3,A=new Vector3;var d=new Vector3,p=new Vector3;const m=new Vector3,f=new Vector3,g=new Vector3;for(let t=0;t<=n;++t){var v=t/n*o*Math.PI*2;E(v,o,a,e,d),E(.01+v,o,a,e,p),f.subVectors(p,d),g.addVectors(p,d),m.crossVectors(f,g),g.crossVectors(m,f),m.normalize(),g.normalize();for(let e=0;e<=i;++e){var _=e/i*Math.PI*2,y=-r*Math.cos(_),_=r*Math.sin(_);u.x=d.x+(y*g.x+_*m.x),u.y=d.y+(y*g.y+_*m.y),u.z=d.z+(y*g.z+_*m.z),l.push(u.x,u.y,u.z),A.subVectors(u,d).normalize(),c.push(A.x,A.y,A.z),h.push(t/n),h.push(e/i)}}for(let t=1;t<=n;t++)for(let e=1;e<=i;e++){var w=(i+1)*(t-1)+(e-1),x=(i+1)*t+(e-1),b=(i+1)*t+e,T=(i+1)*(t-1)+e;s.push(w,x,T),s.push(x,b,T)}function E(e,t,r,n,i){var o=Math.cos(e),a=Math.sin(e),t=r/t*e,e=Math.cos(t);i.x=n*(2+e)*.5*o,i.y=n*(2+e)*a*.5,i.z=n*Math.sin(t)*.5}this.setIndex(s),this.setAttribute("position",new Float32BufferAttribute(l,3)),this.setAttribute("normal",new Float32BufferAttribute(c,3)),this.setAttribute("uv",new Float32BufferAttribute(h,2))}}class TubeGeometry extends BufferGeometry{constructor(o,a=64,s=1,l=8,e=!1){super(),this.type="TubeGeometry",this.parameters={path:o,tubularSegments:a,radius:s,radialSegments:l,closed:e};const c=o.computeFrenetFrames(a,e);this.tangents=c.tangents,this.normals=c.normals,this.binormals=c.binormals;const h=new Vector3,u=new Vector3,r=new Vector2;let A=new Vector3;const d=[],p=[],n=[],m=[];function t(e){A=o.getPointAt(e/a,A);var t=c.normals[e],r=c.binormals[e];for(let e=0;e<=l;e++){var n=e/l*Math.PI*2,i=Math.sin(n),n=-Math.cos(n);u.x=n*t.x+i*r.x,u.y=n*t.y+i*r.y,u.z=n*t.z+i*r.z,u.normalize(),p.push(u.x,u.y,u.z),h.x=A.x+s*u.x,h.y=A.y+s*u.y,h.z=A.z+s*u.z,d.push(h.x,h.y,h.z)}}!function(){for(let e=0;e<a;e++)t(e);t(!1===e?a:0),function(){for(let t=0;t<=a;t++)for(let e=0;e<=l;e++)r.x=t/a,r.y=e/l,n.push(r.x,r.y)}(),function(){for(let t=1;t<=a;t++)for(let e=1;e<=l;e++){var r=(l+1)*(t-1)+(e-1),n=(l+1)*t+(e-1),i=(l+1)*t+e,o=(l+1)*(t-1)+e;m.push(r,n,o),m.push(n,i,o)}}()}(),this.setIndex(m),this.setAttribute("position",new Float32BufferAttribute(d,3)),this.setAttribute("normal",new Float32BufferAttribute(p,3)),this.setAttribute("uv",new Float32BufferAttribute(n,2))}toJSON(){const e=BufferGeometry.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e}}class WireframeGeometry extends BufferGeometry{constructor(e){if(super(),this.type="WireframeGeometry",!0!==e.isGeometry){const c=[],h=[0,0],u={},A=new Vector3;if(null!==e.index){var t=e.attributes.position;const d=e.index;let r=e.groups;0===r.length&&(r=[{start:0,count:d.count,materialIndex:0}]);for(let e=0,t=r.length;e<t;++e){var n=r[e],i=n.start;for(let t=i,e=i+n.count;t<e;t+=3)for(let e=0;e<3;e++){var o=d.getX(t+e),a=d.getX(t+(e+1)%3);h[0]=Math.min(o,a),h[1]=Math.max(o,a);a=h[0]+","+h[1];void 0===u[a]&&(u[a]={index1:h[0],index2:h[1]})}}for(const p in u){var s=u[p];A.fromBufferAttribute(t,s.index1),c.push(A.x,A.y,A.z),A.fromBufferAttribute(t,s.index2),c.push(A.x,A.y,A.z)}}else{var r=e.attributes.position;for(let t=0,e=r.count/3;t<e;t++)for(let e=0;e<3;e++){var l=3*t+e;A.fromBufferAttribute(r,l),c.push(A.x,A.y,A.z);l=3*t+(e+1)%3;A.fromBufferAttribute(r,l),c.push(A.x,A.y,A.z)}}this.setAttribute("position",new Float32BufferAttribute(c,3))}else console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}var Geometries=Object.freeze({__proto__:null,BoxGeometry:BoxGeometry,BoxBufferGeometry:BoxGeometry,CircleGeometry:CircleGeometry,CircleBufferGeometry:CircleGeometry,ConeGeometry:ConeGeometry,ConeBufferGeometry:ConeGeometry,CylinderGeometry:CylinderGeometry,CylinderBufferGeometry:CylinderGeometry,DodecahedronGeometry:DodecahedronGeometry,DodecahedronBufferGeometry:DodecahedronGeometry,EdgesGeometry:EdgesGeometry,ExtrudeGeometry:ExtrudeGeometry,ExtrudeBufferGeometry:ExtrudeGeometry,IcosahedronGeometry:IcosahedronGeometry,IcosahedronBufferGeometry:IcosahedronGeometry,LatheGeometry:LatheGeometry,LatheBufferGeometry:LatheGeometry,OctahedronGeometry:OctahedronGeometry,OctahedronBufferGeometry:OctahedronGeometry,ParametricGeometry:ParametricGeometry,ParametricBufferGeometry:ParametricGeometry,PlaneGeometry:PlaneGeometry,PlaneBufferGeometry:PlaneGeometry,PolyhedronGeometry:PolyhedronGeometry,PolyhedronBufferGeometry:PolyhedronGeometry,RingGeometry:RingGeometry,RingBufferGeometry:RingGeometry,ShapeGeometry:ShapeGeometry,ShapeBufferGeometry:ShapeGeometry,SphereGeometry:SphereGeometry,SphereBufferGeometry:SphereGeometry,TetrahedronGeometry:TetrahedronGeometry,TetrahedronBufferGeometry:TetrahedronGeometry,TextGeometry:TextGeometry,TextBufferGeometry:TextGeometry,TorusGeometry:TorusGeometry,TorusBufferGeometry:TorusGeometry,TorusKnotGeometry:TorusKnotGeometry,TorusKnotBufferGeometry:TorusKnotGeometry,TubeGeometry:TubeGeometry,TubeBufferGeometry:TubeGeometry,WireframeGeometry:WireframeGeometry});class ShadowMaterial extends Material{constructor(e){super(),this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}ShadowMaterial.prototype.isShadowMaterial=!0;class RawShaderMaterial extends ShaderMaterial{constructor(e){super(e),this.type="RawShaderMaterial"}}function MeshStandardMaterial(e){Material.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(e)}function MeshPhysicalMaterial(e){MeshStandardMaterial.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=MathUtils.clamp(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(e)}RawShaderMaterial.prototype.isRawShaderMaterial=!0,MeshStandardMaterial.prototype=Object.create(Material.prototype),(MeshStandardMaterial.prototype.constructor=MeshStandardMaterial).prototype.isMeshStandardMaterial=!0,MeshStandardMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this},MeshPhysicalMaterial.prototype=Object.create(MeshStandardMaterial.prototype),(MeshPhysicalMaterial.prototype.constructor=MeshPhysicalMaterial).prototype.isMeshPhysicalMaterial=!0,MeshPhysicalMaterial.prototype.copy=function(e){return MeshStandardMaterial.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new Color).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this};class MeshPhongMaterial extends Material{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}MeshPhongMaterial.prototype.isMeshPhongMaterial=!0;class MeshToonMaterial extends Material{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}MeshToonMaterial.prototype.isMeshToonMaterial=!0;class MeshNormalMaterial extends Material{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}MeshNormalMaterial.prototype.isMeshNormalMaterial=!0;class MeshLambertMaterial extends Material{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this}}MeshLambertMaterial.prototype.isMeshLambertMaterial=!0;class MeshMatcapMaterial extends Material{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}MeshMatcapMaterial.prototype.isMeshMatcapMaterial=!0;class LineDashedMaterial extends LineBasicMaterial{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}LineDashedMaterial.prototype.isLineDashedMaterial=!0;var Materials=Object.freeze({__proto__:null,ShadowMaterial:ShadowMaterial,SpriteMaterial:SpriteMaterial,RawShaderMaterial:RawShaderMaterial,ShaderMaterial:ShaderMaterial,PointsMaterial:PointsMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshToonMaterial:MeshToonMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshBasicMaterial:MeshBasicMaterial,MeshMatcapMaterial:MeshMatcapMaterial,LineDashedMaterial:LineDashedMaterial,LineBasicMaterial:LineBasicMaterial,Material:Material});const AnimationUtils={arraySlice:function(e,t,r){return AnimationUtils.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==r?r:e.length)):e.slice(t,r)},convertArray:function(e,t,r){return!e||!r&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(r){var t=r.length;const n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort(function(e,t){return r[e]-r[t]}),n},sortedArray:function(r,n,i){var o=r.length;const a=new r.constructor(o);for(let e=0,t=0;t!==o;++e){var s=i[e]*n;for(let e=0;e!==n;++e)a[t++]=r[s+e]}return a},flattenJSON:function(t,r,n,i){let o=1,a=t[0];for(;void 0!==a&&void 0===a[i];)a=t[o++];if(void 0!==a){let e=a[i];if(void 0!==e)if(Array.isArray(e))for(;e=a[i],void 0!==e&&(r.push(a.time),n.push.apply(n,e)),a=t[o++],void 0!==a;);else if(void 0!==e.toArray)for(;e=a[i],void 0!==e&&(r.push(a.time),e.toArray(n,n.length)),a=t[o++],void 0!==a;);else for(;e=a[i],void 0!==e&&(r.push(a.time),n.push(e)),a=t[o++],void 0!==a;);}},subclip:function(e,t,r,n,i=30){const o=e.clone();o.name=t;const a=[];for(let e=0;e<o.tracks.length;++e){const h=o.tracks[e];var s=h.getValueSize();const u=[],A=[];for(let t=0;t<h.times.length;++t){var l=h.times[t]*i;if(!(l<r||n<=l)){u.push(h.times[t]);for(let e=0;e<s;++e)A.push(h.values[t*s+e])}}0!==u.length&&(h.times=AnimationUtils.convertArray(u,h.times.constructor),h.values=AnimationUtils.convertArray(A,h.values.constructor),a.push(h))}o.tracks=a;let c=1/0;for(let e=0;e<o.tracks.length;++e)c>o.tracks[e].times[0]&&(c=o.tracks[e].times[0]);for(let e=0;e<o.tracks.length;++e)o.tracks[e].shift(-1*c);return o.resetDuration(),o},makeClipAdditive:function(t,e=0,r=t,n=30){var i=r.tracks.length,o=e/(n=n<=0?30:n);for(let e=0;e<i;++e){const m=r.tracks[e],f=m.ValueTypeName;if("bool"!==f&&"string"!==f){const g=t.tracks.find(function(e){return e.name===m.name&&e.ValueTypeName===f});if(void 0!==g){let e=0;var a=m.getValueSize();m.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(e=a/3);let t=0;var s=g.getValueSize();g.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(t=s/3);var l=m.times.length-1;let r;if(o<=m.times[0]){var c=e,h=a-e;r=AnimationUtils.arraySlice(m.values,c,h)}else if(o>=m.times[l]){var l=l*a+e,u=l+a-e;r=AnimationUtils.arraySlice(m.values,l,u)}else{const v=m.createInterpolant();u=e,a=a-e;v.evaluate(o),r=AnimationUtils.arraySlice(v.resultBuffer,u,a)}if("quaternion"===f){const _=(new Quaternion).fromArray(r).normalize().conjugate();_.toArray(r)}var A=g.times.length;for(let e=0;e<A;++e){var d=e*s+t;if("quaternion"===f)Quaternion.multiplyQuaternionsFlat(g.values,d,r,0,g.values,d);else{var p=s-2*t;for(let e=0;e<p;++e)g.values[d+e]-=r[e]}}}}}return t.blendMode=AdditiveAnimationBlendMode,t}};function Interpolant(e,t,r,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(r),this.sampleValues=t,this.valueSize=r}function CubicInterpolant(e,t,r,n){Interpolant.call(this,e,t,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function LinearInterpolant(e,t,r,n){Interpolant.call(this,e,t,r,n)}function DiscreteInterpolant(e,t,r,n){Interpolant.call(this,e,t,r,n)}Object.assign(Interpolant.prototype,{evaluate:function(t){var r=this.parameterPositions;let n=this._cachedIndex,i=r[n],o=r[n-1];e:{t:{let e;r:{n:if(!(t<i)){for(var a=n+2;;){if(void 0===i){if(t<o)break n;return n=r.length,this._cachedIndex=n,this.afterEnd_(n-1,t,o)}if(n===a)break;if(o=i,i=r[++n],t<i)break t}e=r.length;break r}if(t>=o)break e;var s=r[1];t<s&&(n=2,o=s);for(var l=n-2;;){if(void 0===o)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(n===l)break;if(i=o,o=r[--n-1],t>=o)break t}e=n,n=0}for(;n<e;){var c=n+e>>>1;t<r[c]?e=c:n=1+c}if(i=r[n],o=r[n-1],void 0===o)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(void 0===i)return n=r.length,this._cachedIndex=n,this.afterEnd_(n-1,o,t)}this._cachedIndex=n,this.intervalChanged_(n,o,i)}return this.interpolate_(n,o,t,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){const t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n;for(let e=0;e!==n;++e)t[e]=r[i+e];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Interpolant.prototype,{beforeStart_:Interpolant.prototype.copySampleValue_,afterEnd_:Interpolant.prototype.copySampleValue_}),CubicInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:CubicInterpolant,DefaultSettings_:{endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding},intervalChanged_:function(e,t,r){var n=this.parameterPositions;let i=e-2,o=e+1,a=n[i],s=n[o];if(void 0===a)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:i=e,a=2*t-r;break;case WrapAroundEnding:i=n.length-2,a=t+n[i]-n[i+1];break;default:i=e,a=r}if(void 0===s)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:o=e,s=2*r-t;break;case WrapAroundEnding:o=1,s=r+n[1]-n[0];break;default:o=e-1,s=t}var l=.5*(r-t),c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(s-r),this._offsetPrev=i*c,this._offsetNext=o*c},interpolate_:function(e,t,r,n){const i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,A=this._weightNext,d=(r-t)/(n-t),p=d*d,m=p*d;var f=-u*m+2*u*p-u*d,g=(1+u)*m+(-1.5-2*u)*p+(-.5+u)*d+1,v=(-1-A)*m+(1.5+A)*p+.5*d,_=A*m-A*p;for(let e=0;e!==a;++e)i[e]=f*o[c+e]+g*o[l+e]+v*o[s+e]+_*o[h+e];return i}}),LinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:LinearInterpolant,interpolate_:function(e,t,r,n){const i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,c=(r-t)/(n-t),h=1-c;for(let e=0;e!==a;++e)i[e]=o[l+e]*h+o[s+e]*c;return i}}),DiscreteInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:DiscreteInterpolant,interpolate_:function(e){return this.copySampleValue_(e-1)}});class KeyframeTrack{constructor(e,t,r,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=AnimationUtils.convertArray(t,this.TimeBufferType),this.values=AnimationUtils.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let r;var n;return t.toJSON!==this.toJSON?r=t.toJSON(e):(r={name:e.name,times:AnimationUtils.convertArray(e.times,Array),values:AnimationUtils.convertArray(e.values,Array)},(n=e.getInterpolation())!==e.DefaultInterpolation&&(r.interpolation=n)),r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new LinearInterpolant(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new CubicInterpolant(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case InterpolateDiscrete:t=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:t=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:t=this.InterpolantFactoryMethodSmooth}if(void 0!==t)return this.createInterpolant=t,this;var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}}getValueSize(){return this.values.length/this.times.length}shift(r){if(0!==r){const n=this.times;for(let e=0,t=n.length;e!==t;++e)n[e]+=r}return this}scale(r){if(1!==r){const n=this.times;for(let e=0,t=n.length;e!==t;++e)n[e]*=r}return this}trim(e,t){var r,n=this.times,i=n.length;let o=0,a=i-1;for(;o!==i&&n[o]<e;)++o;for(;-1!==a&&n[a]>t;)--a;return++a,0===o&&a===i||(o>=a&&(a=Math.max(a,1),o=a-1),r=this.getValueSize(),this.times=AnimationUtils.arraySlice(n,o,a),this.values=AnimationUtils.arraySlice(this.values,o*r,a*r)),this}validate(){let r=!0;var e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),r=!1);var t=this.times,n=this.values,i=t.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),r=!1);let o=null;for(let e=0;e!==i;e++){var a=t[e];if("number"==typeof a&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,a),r=!1;break}if(null!==o&&o>a){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,a,o),r=!1;break}o=a}if(void 0!==n&&AnimationUtils.isTypedArray(n))for(let e=0,t=n.length;e!==t;++e){var s=n[e];if(isNaN(s)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,s),r=!1;break}}return r}optimize(){const r=AnimationUtils.arraySlice(this.times),n=AnimationUtils.arraySlice(this.values),i=this.getValueSize(),o=this.getInterpolation()===InterpolateSmooth,a=r.length-1;let s=1;for(let e=1;e<a;++e){let t=!1;var l=r[e];if(l!==r[e+1]&&(1!==e||l!==r[0]))if(o)t=!0;else{var c=e*i,h=c-i,u=c+i;for(let e=0;e!==i;++e){var A=n[c+e];if(A!==n[h+e]||A!==n[u+e]){t=!0;break}}}if(t){if(e!==s){r[s]=r[e];var d=e*i,p=s*i;for(let e=0;e!==i;++e)n[p+e]=n[d+e]}++s}}if(0<a){r[s]=r[a];for(let e=a*i,t=s*i,r=0;r!==i;++r)n[t+r]=n[e+r];++s}return s!==r.length?(this.times=AnimationUtils.arraySlice(r,0,s),this.values=AnimationUtils.arraySlice(n,0,s*i)):(this.times=r,this.values=n),this}clone(){var e=AnimationUtils.arraySlice(this.times,0),t=AnimationUtils.arraySlice(this.values,0);const r=this.constructor,n=new r(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}KeyframeTrack.prototype.TimeBufferType=Float32Array,KeyframeTrack.prototype.ValueBufferType=Float32Array,KeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;class BooleanKeyframeTrack extends KeyframeTrack{}BooleanKeyframeTrack.prototype.ValueTypeName="bool",BooleanKeyframeTrack.prototype.ValueBufferType=Array,BooleanKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete,BooleanKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0,BooleanKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class ColorKeyframeTrack extends KeyframeTrack{}ColorKeyframeTrack.prototype.ValueTypeName="color";class NumberKeyframeTrack extends KeyframeTrack{}function QuaternionLinearInterpolant(e,t,r,n){Interpolant.call(this,e,t,r,n)}NumberKeyframeTrack.prototype.ValueTypeName="number",QuaternionLinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:QuaternionLinearInterpolant,interpolate_:function(e,t,r,n){var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=(r-t)/(n-t);let l=e*a;for(var c=l+a;l!==c;l+=4)Quaternion.slerpFlat(i,0,o,l-a,o,l,s);return i}});class QuaternionKeyframeTrack extends KeyframeTrack{InterpolantFactoryMethodLinear(e){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),e)}}QuaternionKeyframeTrack.prototype.ValueTypeName="quaternion",QuaternionKeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear,QuaternionKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class StringKeyframeTrack extends KeyframeTrack{}StringKeyframeTrack.prototype.ValueTypeName="string",StringKeyframeTrack.prototype.ValueBufferType=Array,StringKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete,StringKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0,StringKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class VectorKeyframeTrack extends KeyframeTrack{}VectorKeyframeTrack.prototype.ValueTypeName="vector";class AnimationClip{constructor(e,t=-1,r,n=NormalAnimationBlendMode){this.name=e,this.tracks=r,this.duration=t,this.blendMode=n,this.uuid=MathUtils.generateUUID(),this.duration<0&&this.resetDuration()}static parse(e){const r=[],n=e.tracks,i=1/(e.fps||1);for(let e=0,t=n.length;e!==t;++e)r.push(parseKeyframeTrack(n[e]).scale(i));const t=new this(e.name,e.duration,r,e.blendMode);return t.uuid=e.uuid,t}static toJSON(e){const r=[],n=e.tracks;e={name:e.name,duration:e.duration,tracks:r,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,t=n.length;e!==t;++e)r.push(KeyframeTrack.toJSON(n[e]));return e}static CreateFromMorphTargetSequence(e,n,i,o){var a=n.length;const s=[];for(let r=0;r<a;r++){let e=[],t=[];e.push((r+a-1)%a,r,(r+1)%a),t.push(0,1,0);var l=AnimationUtils.getKeyframeOrder(e);e=AnimationUtils.sortedArray(e,1,l),t=AnimationUtils.sortedArray(t,1,l),o||0!==e[0]||(e.push(a),t.push(t[0])),s.push(new NumberKeyframeTrack(".morphTargetInfluences["+n[r].name+"]",e,t).scale(1/i))}return new this(e,-1,s)}static findByName(e,t){let r=e;Array.isArray(e)||(r=e.geometry&&e.geometry.animations||e.animations);for(let e=0;e<r.length;e++)if(r[e].name===t)return r[e];return null}static CreateClipsFromMorphTargetSequences(r,e,t){const n={};var i=/^([\w-]*?)([\d]+)$/;for(let e=0,t=r.length;e<t;e++){const s=r[e];var o=s.name.match(i);if(o&&1<o.length){o=o[1];let e=n[o];e||(n[o]=e=[]),e.push(s)}}const a=[];for(const l in n)a.push(this.CreateFromMorphTargetSequence(l,n[l],e,t));return a}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;function r(e,t,r,n,i){var o,a;0!==r.length&&(o=[],a=[],AnimationUtils.flattenJSON(r,o,a,n),0!==o.length&&i.push(new e(t,o,a)))}const n=[];var i=e.name||"default",o=e.fps||30,a=e.blendMode;let s=e.length||-1;var l=e.hierarchy||[];for(let e=0;e<l.length;e++){var c=l[e].keys;if(c&&0!==c.length)if(c[0].morphTargets){const A={};let t;for(t=0;t<c.length;t++)if(c[t].morphTargets)for(let e=0;e<c[t].morphTargets.length;e++)A[c[t].morphTargets[e]]=-1;for(const d in A){const p=[],m=[];for(let e=0;e!==c[t].morphTargets.length;++e){var h=c[t];p.push(h.time),m.push(h.morphTarget===d?1:0)}n.push(new NumberKeyframeTrack(".morphTargetInfluence["+d+"]",p,m))}s=A.length*(o||1)}else{var u=".bones["+t[e].name+"]";r(VectorKeyframeTrack,u+".position",c,"pos",n),r(QuaternionKeyframeTrack,u+".quaternion",c,"rot",n),r(VectorKeyframeTrack,u+".scale",c,"scl",n)}}return 0===n.length?null:new this(i,s,n,a)}resetDuration(){let r=0;for(let e=0,t=this.tracks.length;e!==t;++e){var n=this.tracks[e];r=Math.max(r,n.times[n.times.length-1])}return this.duration=r,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function getTrackTypeForValueTypeName(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function parseKeyframeTrack(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=getTrackTypeForValueTypeName(e.type);var r,n;return void 0===e.times&&(r=[],n=[],AnimationUtils.flattenJSON(e.keys,r,n,"value"),e.times=r,e.values=n),void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Cache={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function LoadingManager(e,t,r){const n=this;let i=!1,o=0,a=0,s=void 0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){a++,!1===i&&void 0!==n.onStart&&n.onStart(e,o,a),i=!0},this.itemEnd=function(e){o++,void 0!==n.onProgress&&n.onProgress(e,o,a),o===a&&(i=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){e=l.indexOf(e);return-1!==e&&l.splice(e,2),this},this.getHandler=function(r){for(let e=0,t=l.length;e<t;e+=2){const i=l[e];var n=l[e+1];if(i.global&&(i.lastIndex=0),i.test(r))return n}return null}}const DefaultLoadingManager=new LoadingManager;function Loader(e){this.manager=void 0!==e?e:DefaultLoadingManager,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(Loader.prototype,{load:function(){},loadAsync:function(r,n){const i=this;return new Promise(function(e,t){i.load(r,e,n,t)})},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}});const loading={};function FileLoader(e){Loader.call(this,e)}FileLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:FileLoader,load:function(s,r,t,n){void 0===s&&(s=""),void 0!==this.path&&(s=this.path+s),s=this.manager.resolveURL(s);const l=this,e=Cache.get(s);if(void 0!==e)return l.manager.itemStart(s),setTimeout(function(){r&&r(e),l.manager.itemEnd(s)},0),e;if(void 0===loading[s]){var i=s.match(/^data:(.*?)(;base64)?,(.*)$/);let e;if(i){var o=i[1],a=!!i[2];let t=i[3];t=decodeURIComponent(t),a&&(t=atob(t));try{let e;var c=(this.responseType||"").toLowerCase();switch(c){case"arraybuffer":case"blob":const h=new Uint8Array(t.length);for(let e=0;e<t.length;e++)h[e]=t.charCodeAt(e);e="blob"===c?new Blob([h.buffer],{type:o}):h.buffer;break;case"document":const u=new DOMParser;e=u.parseFromString(t,o);break;case"json":e=JSON.parse(t);break;default:e=t}setTimeout(function(){r&&r(e),l.manager.itemEnd(s)},0)}catch(e){setTimeout(function(){n&&n(e),l.manager.itemError(s),l.manager.itemEnd(s)},0)}}else{loading[s]=[],loading[s].push({onLoad:r,onProgress:t,onError:n}),e=new XMLHttpRequest,e.open("GET",s,!0),e.addEventListener("load",function(r){var n=this.response,i=loading[s];if(delete loading[s],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Cache.add(s,n);for(let e=0,t=i.length;e<t;e++){const o=i[e];o.onLoad&&o.onLoad(n)}l.manager.itemEnd(s)}else{for(let e=0,t=i.length;e<t;e++){const a=i[e];a.onError&&a.onError(r)}l.manager.itemError(s),l.manager.itemEnd(s)}},!1),e.addEventListener("progress",function(r){var n=loading[s];for(let e=0,t=n.length;e<t;e++){const i=n[e];i.onProgress&&i.onProgress(r)}},!1),e.addEventListener("error",function(r){var n=loading[s];delete loading[s];for(let e=0,t=n.length;e<t;e++){const i=n[e];i.onError&&i.onError(r)}l.manager.itemError(s),l.manager.itemEnd(s)},!1),e.addEventListener("abort",function(r){var n=loading[s];delete loading[s];for(let e=0,t=n.length;e<t;e++){const i=n[e];i.onError&&i.onError(r)}l.manager.itemError(s),l.manager.itemEnd(s)},!1),void 0!==this.responseType&&(e.responseType=this.responseType),void 0!==this.withCredentials&&(e.withCredentials=this.withCredentials),e.overrideMimeType&&e.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const A in this.requestHeader)e.setRequestHeader(A,this.requestHeader[A]);e.send(null)}return l.manager.itemStart(s),e}loading[s].push({onLoad:r,onProgress:t,onError:n})},setResponseType:function(e){return this.responseType=e,this},setMimeType:function(e){return this.mimeType=e,this}});class AnimationLoader extends Loader{constructor(e){super(e)}load(t,r,e,n){const i=this,o=new FileLoader(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(e){try{r(i.parse(JSON.parse(e)))}catch(e){n?n(e):console.error(e),i.manager.itemError(t)}},e,n)}parse(t){const r=[];for(let e=0;e<t.length;e++){var n=AnimationClip.parse(t[e]);r.push(n)}return r}}function CompressedTextureLoader(e){Loader.call(this,e)}CompressedTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:CompressedTextureLoader,load:function(r,i,n,o){const a=this,s=[],l=new CompressedTexture,c=new FileLoader(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(a.withCredentials);let h=0;if(Array.isArray(r))for(let e=0,t=r.length;e<t;++e)!function(t){c.load(r[t],function(e){e=a.parse(e,!0);s[t]={width:e.width,height:e.height,format:e.format,mipmaps:e.mipmaps},h+=1,6===h&&(1===e.mipmapCount&&(l.minFilter=LinearFilter),l.image=s,l.format=e.format,l.needsUpdate=!0,i&&i(l))},n,o)}(e);else c.load(r,function(e){var r=a.parse(e,!0);if(r.isCubemap){var n=r.mipmaps.length/r.mipmapCount;for(let t=0;t<n;t++){s[t]={mipmaps:[]};for(let e=0;e<r.mipmapCount;e++)s[t].mipmaps.push(r.mipmaps[t*r.mipmapCount+e]),s[t].format=r.format,s[t].width=r.width,s[t].height=r.height}l.image=s}else l.image.width=r.width,l.image.height=r.height,l.mipmaps=r.mipmaps;1===r.mipmapCount&&(l.minFilter=LinearFilter),l.format=r.format,l.needsUpdate=!0,i&&i(l)},n,o);return l}});class ImageLoader extends Loader{constructor(e){super(e)}load(t,e,r,n){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,o=Cache.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout(function(){e&&e(o),i.manager.itemEnd(t)},0),o;const a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),Cache.add(t,this),e&&e(this),i.manager.itemEnd(t)}function l(e){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),n&&n(e),i.manager.itemError(t),i.manager.itemEnd(t)}return a.addEventListener("load",s,!1),a.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(t),a.src=t,a}}class CubeTextureLoader extends Loader{constructor(e){super(e)}load(r,n,e,i){const o=new CubeTexture,a=new ImageLoader(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let s=0;for(let e=0;e<r.length;++e)!function(t){a.load(r[t],function(e){o.images[t]=e,s++,6===s&&(o.needsUpdate=!0,n&&n(o))},void 0,i)}(e);return o}}function DataTextureLoader(e){Loader.call(this,e)}function TextureLoader(e){Loader.call(this,e)}function Curve(){this.type="Curve",this.arcLengthDivisions=200}DataTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:DataTextureLoader,load:function(e,t,r,n){const i=this,o=new DataTexture,a=new FileLoader(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(i.withCredentials),a.load(e,function(e){e=i.parse(e);e&&(void 0!==e.image?o.image=e.image:void 0!==e.data&&(o.image.width=e.width,o.image.height=e.height,o.image.data=e.data),o.wrapS=void 0!==e.wrapS?e.wrapS:ClampToEdgeWrapping,o.wrapT=void 0!==e.wrapT?e.wrapT:ClampToEdgeWrapping,o.magFilter=void 0!==e.magFilter?e.magFilter:LinearFilter,o.minFilter=void 0!==e.minFilter?e.minFilter:LinearFilter,o.anisotropy=void 0!==e.anisotropy?e.anisotropy:1,void 0!==e.encoding&&(o.encoding=e.encoding),void 0!==e.flipY&&(o.flipY=e.flipY),void 0!==e.format&&(o.format=e.format),void 0!==e.type&&(o.type=e.type),void 0!==e.mipmaps&&(o.mipmaps=e.mipmaps,o.minFilter=LinearMipmapLinearFilter),1===e.mipmapCount&&(o.minFilter=LinearFilter),void 0!==e.generateMipmaps&&(o.generateMipmaps=e.generateMipmaps),o.needsUpdate=!0,t&&t(o,e))},r,n),o}}),TextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:TextureLoader,load:function(t,r,e,n){const i=new Texture,o=new ImageLoader(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,function(e){i.image=e;e=0<t.search(/\.jpe?g($|\?)/i)||0===t.search(/^data\:image\/jpeg/);i.format=e?RGBFormat:RGBAFormat,i.needsUpdate=!0,void 0!==r&&r(i)},e,n),i}}),Object.assign(Curve.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){e=this.getUtoTmapping(e);return this.getPoint(e,t)},getPoints:function(t=5){const r=[];for(let e=0;e<=t;e++)r.push(this.getPoint(e/t));return r},getSpacedPoints:function(t=5){const r=[];for(let e=0;e<=t;e++)r.push(this.getPointAt(e/t));return r},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const r=[];let n,i=this.getPoint(0),o=0;r.push(0);for(let e=1;e<=t;e++)n=this.getPoint(e/t),o+=n.distanceTo(i),r.push(o),i=n;return this.cacheArcLengths=r,r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var r=this.getLengths();let n=0;var i=r.length;let o;o=t||e*r[i-1];let a=0,s=i-1,l;for(;a<=s;)if(n=Math.floor(a+(s-a)/2),(l=r[n]-o)<0)a=n+1;else{if(!(0<l)){s=n;break}s=n-1}if(n=s,r[n]===o)return n/(i-1);t=r[n],e=r[n+1],t=(o-t)/(e-t);return(n+t)/(i-1)},getTangent:function(e,t){let r=e-1e-4,n=e+1e-4;r<0&&(r=0),1<n&&(n=1);var i=this.getPoint(r),e=this.getPoint(n);const o=t||new(i.isVector2?Vector2:Vector3);return o.copy(e).sub(i).normalize(),o},getTangentAt:function(e,t){e=this.getUtoTmapping(e);return this.getTangent(e,t)},computeFrenetFrames:function(r,e){const t=new Vector3,n=[],i=[],o=[],a=new Vector3,s=new Matrix4;for(let e=0;e<=r;e++){var l=e/r;n[e]=this.getTangentAt(l,new Vector3),n[e].normalize()}i[0]=new Vector3,o[0]=new Vector3;let c=Number.MAX_VALUE;var h,u=Math.abs(n[0].x),A=Math.abs(n[0].y),d=Math.abs(n[0].z);u<=c&&(c=u,t.set(1,0,0)),A<=c&&(c=A,t.set(0,1,0)),d<=c&&t.set(0,0,1),a.crossVectors(n[0],t).normalize(),i[0].crossVectors(n[0],a),o[0].crossVectors(n[0],i[0]);for(let e=1;e<=r;e++)i[e]=i[e-1].clone(),o[e]=o[e-1].clone(),a.crossVectors(n[e-1],n[e]),a.length()>Number.EPSILON&&(a.normalize(),h=Math.acos(MathUtils.clamp(n[e-1].dot(n[e]),-1,1)),i[e].applyMatrix4(s.makeRotationAxis(a,h))),o[e].crossVectors(n[e],i[e]);if(!0===e){let t=Math.acos(MathUtils.clamp(i[0].dot(i[r]),-1,1));t/=r,0<n[0].dot(a.crossVectors(i[0],i[r]))&&(t=-t);for(let e=1;e<=r;e++)i[e].applyMatrix4(s.makeRotationAxis(n[e],t*e)),o[e].crossVectors(n[e],i[e])}return{tangents:n,normals:i,binormals:o}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}});class EllipseCurve extends Curve{constructor(e=0,t=0,r=1,n=1,i=0,o=2*Math.PI,a=!1,s=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=n,this.aStartAngle=i,this.aEndAngle=o,this.aClockwise=a,this.aRotation=s}getPoint(e,t){const r=t||new Vector2;var n=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;for(var o=Math.abs(i)<Number.EPSILON;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=o?0:n),!0!==this.aClockwise||o||(i===n?i=-n:i-=n);var a=this.aStartAngle+e*i;let s=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);return 0!==this.aRotation&&(t=Math.cos(this.aRotation),o=Math.sin(this.aRotation),e=s-this.aX,a=l-this.aY,s=e*t-a*o+this.aX,l=e*o+a*t+this.aY),r.set(s,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}EllipseCurve.prototype.isEllipseCurve=!0;class ArcCurve extends EllipseCurve{constructor(e,t,r,n,i,o){super(e,t,r,r,n,i,o),this.type="ArcCurve"}}function CubicPoly(){let i=0,o=0,a=0,s=0;function l(e,t,r,n){i=e,o=r,a=-3*e+3*t-2*r-n,s=2*e-2*t+r+n}return{initCatmullRom:function(e,t,r,n,i){l(t,r,i*(r-e),i*(n-t))},initNonuniformCatmullRom:function(e,t,r,n,i,o,a){i=(t-e)/i-(r-e)/(i+o)+(r-t)/o,a=(r-t)/o-(n-t)/(o+a)+(n-r)/a;l(t,r,i*=o,a*=o)},calc:function(e){var t=e*e,r=t*e;return i+o*e+a*t+s*r}}}ArcCurve.prototype.isArcCurve=!0;const tmp=new Vector3,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;class CatmullRomCurve3 extends Curve{constructor(e=[],t=!1,r="centripetal",n=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=r,this.tension=n}getPoint(e,n=new Vector3){const t=n;var r=this.points,n=r.length,e=(n-(this.closed?0:1))*e;let i=Math.floor(e),o=e-i;this.closed?i+=0<i?0:(Math.floor(Math.abs(i)/n)+1)*n:0===o&&i===n-1&&(i=n-2,o=1);let a,s;a=this.closed||0<i?r[(i-1)%n]:(tmp.subVectors(r[0],r[1]).add(r[0]),tmp);const l=r[i%n],c=r[(i+1)%n];if(s=this.closed||i+2<n?r[(i+2)%n]:(tmp.subVectors(r[n-1],r[n-2]).add(r[n-1]),tmp),"centripetal"===this.curveType||"chordal"===this.curveType){n="chordal"===this.curveType?.5:.25;let e=Math.pow(a.distanceToSquared(l),n),t=Math.pow(l.distanceToSquared(c),n),r=Math.pow(c.distanceToSquared(s),n);t<1e-4&&(t=1),e<1e-4&&(e=t),r<1e-4&&(r=t),px.initNonuniformCatmullRom(a.x,l.x,c.x,s.x,e,t,r),py.initNonuniformCatmullRom(a.y,l.y,c.y,s.y,e,t,r),pz.initNonuniformCatmullRom(a.z,l.z,c.z,s.z,e,t,r)}else"catmullrom"===this.curveType&&(px.initCatmullRom(a.x,l.x,c.x,s.x,this.tension),py.initCatmullRom(a.y,l.y,c.y,s.y,this.tension),pz.initCatmullRom(a.z,l.z,c.z,s.z,this.tension));return t.set(px.calc(o),py.calc(o),pz.calc(o)),t}copy(r){super.copy(r),this.points=[];for(let e=0,t=r.points.length;e<t;e++){const n=r.points[e];this.points.push(n.clone())}return this.closed=r.closed,this.curveType=r.curveType,this.tension=r.tension,this}toJSON(){const r=super.toJSON();r.points=[];for(let e=0,t=this.points.length;e<t;e++){const n=this.points[e];r.points.push(n.toArray())}return r.closed=this.closed,r.curveType=this.curveType,r.tension=this.tension,r}fromJSON(r){super.fromJSON(r),this.points=[];for(let e=0,t=r.points.length;e<t;e++){var n=r.points[e];this.points.push((new Vector3).fromArray(n))}return this.closed=r.closed,this.curveType=r.curveType,this.tension=r.tension,this}}function CatmullRom(e,t,r,n,i){var o=.5*(n-t),t=.5*(i-r),i=e*e;return(2*r-2*n+o+t)*(e*i)+(-3*r+3*n-2*o-t)*i+o*e+r}function QuadraticBezierP0(e,t){e=1-e;return e*e*t}function QuadraticBezierP1(e,t){return 2*(1-e)*e*t}function QuadraticBezierP2(e,t){return e*e*t}function QuadraticBezier(e,t,r,n){return QuadraticBezierP0(e,t)+QuadraticBezierP1(e,r)+QuadraticBezierP2(e,n)}function CubicBezierP0(e,t){e=1-e;return e*e*e*t}function CubicBezierP1(e,t){var r=1-e;return 3*r*r*e*t}function CubicBezierP2(e,t){return 3*(1-e)*e*e*t}function CubicBezierP3(e,t){return e*e*e*t}function CubicBezier(e,t,r,n,i){return CubicBezierP0(e,t)+CubicBezierP1(e,r)+CubicBezierP2(e,n)+CubicBezierP3(e,i)}CatmullRomCurve3.prototype.isCatmullRomCurve3=!0;class CubicBezierCurve extends Curve{constructor(e=new Vector2,t=new Vector2,r=new Vector2,n=new Vector2){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=r,this.v3=n}getPoint(e,t=new Vector2){const r=t;var n=this.v0,i=this.v1,o=this.v2,t=this.v3;return r.set(CubicBezier(e,n.x,i.x,o.x,t.x),CubicBezier(e,n.y,i.y,o.y,t.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}CubicBezierCurve.prototype.isCubicBezierCurve=!0;class CubicBezierCurve3 extends Curve{constructor(e=new Vector3,t=new Vector3,r=new Vector3,n=new Vector3){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=r,this.v3=n}getPoint(e,t=new Vector3){const r=t;var n=this.v0,i=this.v1,o=this.v2,t=this.v3;return r.set(CubicBezier(e,n.x,i.x,o.x,t.x),CubicBezier(e,n.y,i.y,o.y,t.y),CubicBezier(e,n.z,i.z,o.z,t.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}CubicBezierCurve3.prototype.isCubicBezierCurve3=!0;class LineCurve extends Curve{constructor(e=new Vector2,t=new Vector2){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Vector2){const r=t;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const r=t||new Vector2;return r.copy(this.v2).sub(this.v1).normalize(),r}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}LineCurve.prototype.isLineCurve=!0;class LineCurve3 extends Curve{constructor(e=new Vector3,t=new Vector3){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new Vector3){const r=t;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class QuadraticBezierCurve extends Curve{constructor(e=new Vector2,t=new Vector2,r=new Vector2){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new Vector2){const r=t;var n=this.v0,i=this.v1,t=this.v2;return r.set(QuadraticBezier(e,n.x,i.x,t.x),QuadraticBezier(e,n.y,i.y,t.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}QuadraticBezierCurve.prototype.isQuadraticBezierCurve=!0;class QuadraticBezierCurve3 extends Curve{constructor(e=new Vector3,t=new Vector3,r=new Vector3){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new Vector3){const r=t;var n=this.v0,i=this.v1,t=this.v2;return r.set(QuadraticBezier(e,n.x,i.x,t.x),QuadraticBezier(e,n.y,i.y,t.y),QuadraticBezier(e,n.z,i.z,t.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}QuadraticBezierCurve3.prototype.isQuadraticBezierCurve3=!0;class SplineCurve extends Curve{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new Vector2){const r=t;var n=this.points,i=(n.length-1)*e,o=Math.floor(i),a=i-o,t=n[0===o?o:o-1],e=n[o],i=n[o>n.length-2?n.length-1:o+1],o=n[o>n.length-3?n.length-1:o+2];return r.set(CatmullRom(a,t.x,e.x,i.x,o.x),CatmullRom(a,t.y,e.y,i.y,o.y)),r}copy(r){super.copy(r),this.points=[];for(let e=0,t=r.points.length;e<t;e++){const n=r.points[e];this.points.push(n.clone())}return this}toJSON(){const r=super.toJSON();r.points=[];for(let e=0,t=this.points.length;e<t;e++){const n=this.points[e];r.points.push(n.toArray())}return r}fromJSON(r){super.fromJSON(r),this.points=[];for(let e=0,t=r.points.length;e<t;e++){var n=r.points[e];this.points.push((new Vector2).fromArray(n))}return this}}SplineCurve.prototype.isSplineCurve=!0;var Curves=Object.freeze({__proto__:null,ArcCurve:ArcCurve,CatmullRomCurve3:CatmullRomCurve3,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,EllipseCurve:EllipseCurve,LineCurve:LineCurve,LineCurve3:LineCurve3,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,SplineCurve:SplineCurve});class CurvePath extends Curve{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0);var t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new LineCurve(t,e))}getPoint(e){var t=e*this.getLength(),r=this.getCurveLengths();let n=0;for(;n<r.length;){if(r[n]>=t){var i=r[n]-t;const a=this.curves[n];var o=a.getLength();return a.getPointAt(0===o?0:1-i/o)}n++}return null}getLength(){var e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const r=[];let n=0;for(let e=0,t=this.curves.length;e<t;e++)n+=this.curves[e].getLength(),r.push(n);return this.cacheLengths=r,r}getSpacedPoints(t=40){const r=[];for(let e=0;e<=t;e++)r.push(this.getPoint(e/t));return this.autoClose&&r.push(r[0]),r}getPoints(r=12){const n=[];let i;for(let e=0,t=this.curves;e<t.length;e++){const l=t[e];var o=l&&l.isEllipseCurve?2*r:l&&(l.isLineCurve||l.isLineCurve3)?1:l&&l.isSplineCurve?r*l.points.length:r,a=l.getPoints(o);for(let e=0;e<a.length;e++){var s=a[e];i&&i.equals(s)||(n.push(s),i=s)}}return this.autoClose&&1<n.length&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}copy(r){super.copy(r),this.curves=[];for(let e=0,t=r.curves.length;e<t;e++){const n=r.curves[e];this.curves.push(n.clone())}return this.autoClose=r.autoClose,this}toJSON(){const r=super.toJSON();r.autoClose=this.autoClose,r.curves=[];for(let e=0,t=this.curves.length;e<t;e++){const n=this.curves[e];r.curves.push(n.toJSON())}return r}fromJSON(r){super.fromJSON(r),this.autoClose=r.autoClose,this.curves=[];for(let e=0,t=r.curves.length;e<t;e++){var n=r.curves[e];this.curves.push((new Curves[n.type]).fromJSON(n))}return this}}class Path extends CurvePath{constructor(e){super(),this.type="Path",this.currentPoint=new Vector2,e&&this.setFromPoints(e)}setFromPoints(r){this.moveTo(r[0].x,r[0].y);for(let e=1,t=r.length;e<t;e++)this.lineTo(r[e].x,r[e].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){var r=new LineCurve(this.currentPoint.clone(),new Vector2(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,r,n){t=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(r,n));return this.curves.push(t),this.currentPoint.set(r,n),this}bezierCurveTo(e,t,r,n,i,o){n=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(r,n),new Vector2(i,o));return this.curves.push(n),this.currentPoint.set(i,o),this}splineThru(e){var t=[this.currentPoint.clone()].concat(e),t=new SplineCurve(t);return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,r,n,i,o){var a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+a,t+s,r,n,i,o),this}absarc(e,t,r,n,i,o){return this.absellipse(e,t,r,r,n,i,o),this}ellipse(e,t,r,n,i,o,a,s){var l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,r,n,i,o,a,s),this}absellipse(e,t,r,n,i,o,a,s){const l=new EllipseCurve(e,t,r,n,i,o,a,s);if(0<this.curves.length){const c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);s=l.getPoint(1);return this.currentPoint.copy(s),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Shape extends Path{constructor(e){super(e),this.uuid=MathUtils.generateUUID(),this.type="Shape",this.holes=[]}getPointsHoles(r){const n=[];for(let e=0,t=this.holes.length;e<t;e++)n[e]=this.holes[e].getPoints(r);return n}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(r){super.copy(r),this.holes=[];for(let e=0,t=r.holes.length;e<t;e++){const n=r.holes[e];this.holes.push(n.clone())}return this}toJSON(){const r=super.toJSON();r.uuid=this.uuid,r.holes=[];for(let e=0,t=this.holes.length;e<t;e++){const n=this.holes[e];r.holes.push(n.toJSON())}return r}fromJSON(r){super.fromJSON(r),this.uuid=r.uuid,this.holes=[];for(let e=0,t=r.holes.length;e<t;e++){var n=r.holes[e];this.holes.push((new Path).fromJSON(n))}return this}}class Light extends Object3D{constructor(e,t=1){super(),this.type="Light",this.color=new Color(e),this.intensity=t}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}Light.prototype.isLight=!0;class HemisphereLight extends Light{constructor(e,t,r){super(e,r),this.type="HemisphereLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.groundColor=new Color(t)}copy(e){return Light.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}HemisphereLight.prototype.isHemisphereLight=!0;const _projScreenMatrix$1=new Matrix4,_lightPositionWorld$1=new Vector3,_lookTarget$1=new Vector3;class LightShadow{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,r=this.matrix;_lightPositionWorld$1.setFromMatrixPosition(e.matrixWorld),t.position.copy(_lightPositionWorld$1),_lookTarget$1.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(_lookTarget$1),t.updateMatrixWorld(),_projScreenMatrix$1.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix$1),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(t.projectionMatrix),r.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class SpotLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera;var r=2*MathUtils.RAD2DEG*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;r===t.fov&&n===t.aspect&&i===t.far||(t.fov=r,t.aspect=n,t.far=i,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}SpotLightShadow.prototype.isSpotLightShadow=!0;class SpotLight extends Light{constructor(e,t,r=0,n=Math.PI/3,i=0,o=1){super(e,t),this.type="SpotLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.distance=r,this.angle=n,this.penumbra=i,this.decay=o,this.shadow=new SpotLightShadow}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}SpotLight.prototype.isSpotLight=!0;const _projScreenMatrix=new Matrix4,_lightPositionWorld=new Vector3,_lookTarget=new Vector3;class PointLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(90,1,.5,500)),this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}updateMatrices(e,t=0){const r=this.camera,n=this.matrix;var i=e.distance||r.far;i!==r.far&&(r.far=i,r.updateProjectionMatrix()),_lightPositionWorld.setFromMatrixPosition(e.matrixWorld),r.position.copy(_lightPositionWorld),_lookTarget.copy(r.position),_lookTarget.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(_lookTarget),r.updateMatrixWorld(),n.makeTranslation(-_lightPositionWorld.x,-_lightPositionWorld.y,-_lightPositionWorld.z),_projScreenMatrix.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix)}}PointLightShadow.prototype.isPointLightShadow=!0;class PointLight extends Light{constructor(e,t,r=0,n=1){super(e,t),this.type="PointLight",this.distance=r,this.decay=n,this.shadow=new PointLightShadow}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}PointLight.prototype.isPointLight=!0;class OrthographicCamera extends Camera{constructor(e=-1,t=1,r=1,n=-1,i=.1,o=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=n,this.near=i,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,r,n,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let i=r-e,o=r+e,a=n+t,s=n-t;null!==this.view&&this.view.enabled&&(n=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom,i+=n*this.view.offsetX,o=i+n*this.view.width,a-=t*this.view.offsetY,s=a-t*this.view.height),this.projectionMatrix.makeOrthographic(i,o,a,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=Object3D.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}OrthographicCamera.prototype.isOrthographicCamera=!0;class DirectionalLightShadow extends LightShadow{constructor(){super(new OrthographicCamera(-5,5,5,-5,.5,500))}}DirectionalLightShadow.prototype.isDirectionalLightShadow=!0;class DirectionalLight extends Light{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}DirectionalLight.prototype.isDirectionalLight=!0;class AmbientLight extends Light{constructor(e,t){super(e,t),this.type="AmbientLight"}}AmbientLight.prototype.isAmbientLight=!0;class RectAreaLight extends Light{constructor(e,t,r=10,n=10){super(e,t),this.type="RectAreaLight",this.width=r,this.height=n}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}RectAreaLight.prototype.isRectAreaLight=!0;class SphericalHarmonics3{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Vector3)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){var r=e.x,n=e.y,i=e.z,e=this.coefficients;return t.copy(e[0]).multiplyScalar(.282095),t.addScaledVector(e[1],.488603*n),t.addScaledVector(e[2],.488603*i),t.addScaledVector(e[3],.488603*r),t.addScaledVector(e[4],r*n*1.092548),t.addScaledVector(e[5],n*i*1.092548),t.addScaledVector(e[6],.315392*(3*i*i-1)),t.addScaledVector(e[7],r*i*1.092548),t.addScaledVector(e[8],.546274*(r*r-n*n)),t}getIrradianceAt(e,t){var r=e.x,n=e.y,i=e.z,e=this.coefficients;return t.copy(e[0]).multiplyScalar(.886227),t.addScaledVector(e[1],1.023328*n),t.addScaledVector(e[2],1.023328*i),t.addScaledVector(e[3],1.023328*r),t.addScaledVector(e[4],.858086*r*n),t.addScaledVector(e[5],.858086*n*i),t.addScaledVector(e[6],.743125*i*i-.247708),t.addScaledVector(e[7],.858086*r*i),t.addScaledVector(e[8],.429043*(r*r-n*n)),t}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,r){for(let e=0;e<9;e++)this.coefficients[e].addScaledVector(t.coefficients[e],r);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,r){for(let e=0;e<9;e++)this.coefficients[e].lerp(t.coefficients[e],r);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,r=0){const n=this.coefficients;for(let e=0;e<9;e++)n[e].fromArray(t,r+3*e);return this}toArray(t=[],r=0){const n=this.coefficients;for(let e=0;e<9;e++)n[e].toArray(t,r+3*e);return t}static getBasisAt(e,t){var r=e.x,n=e.y,e=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*e,t[3]=.488603*r,t[4]=1.092548*r*n,t[5]=1.092548*n*e,t[6]=.315392*(3*e*e-1),t[7]=1.092548*r*e,t[8]=.546274*(r*r-n*n)}}SphericalHarmonics3.prototype.isSphericalHarmonics3=!0;class LightProbe extends Light{constructor(e=new SphericalHarmonics3,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}LightProbe.prototype.isLightProbe=!0;class MaterialLoader extends Loader{constructor(e){super(e),this.textures={}}load(t,r,e,n){const i=this,o=new FileLoader(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,function(e){try{r(i.parse(JSON.parse(e)))}catch(e){n?n(e):console.error(e),i.manager.itemError(t)}},e,n)}parse(t){const r=this.textures;function e(e){return void 0===r[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),r[e]}const n=new Materials[t.type];if(void 0!==t.uuid&&(n.uuid=t.uuid),void 0!==t.name&&(n.name=t.name),void 0!==t.color&&void 0!==n.color&&n.color.setHex(t.color),void 0!==t.roughness&&(n.roughness=t.roughness),void 0!==t.metalness&&(n.metalness=t.metalness),void 0!==t.sheen&&(n.sheen=(new Color).setHex(t.sheen)),void 0!==t.emissive&&void 0!==n.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==n.specular&&n.specular.setHex(t.specular),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.clearcoat&&(n.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(n.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(n.fog=t.fog),void 0!==t.flatShading&&(n.flatShading=t.flatShading),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.combine&&(n.combine=t.combine),void 0!==t.side&&(n.side=t.side),void 0!==t.shadowSide&&(n.shadowSide=t.shadowSide),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.alphaTest&&(n.alphaTest=t.alphaTest),void 0!==t.depthTest&&(n.depthTest=t.depthTest),void 0!==t.depthWrite&&(n.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(n.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(n.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(n.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(n.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(n.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(n.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(n.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(n.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(n.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(n.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(n.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(n.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(n.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(n.rotation=t.rotation),1!==t.linewidth&&(n.linewidth=t.linewidth),void 0!==t.dashSize&&(n.dashSize=t.dashSize),void 0!==t.gapSize&&(n.gapSize=t.gapSize),void 0!==t.scale&&(n.scale=t.scale),void 0!==t.polygonOffset&&(n.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(n.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(n.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(n.skinning=t.skinning),void 0!==t.morphTargets&&(n.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(n.morphNormals=t.morphNormals),void 0!==t.dithering&&(n.dithering=t.dithering),void 0!==t.alphaToCoverage&&(n.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(n.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.vertexTangents&&(n.vertexTangents=t.vertexTangents),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.toneMapped&&(n.toneMapped=t.toneMapped),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?n.vertexColors=0<t.vertexColors:n.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const o in t.uniforms){var i=t.uniforms[o];switch(n.uniforms[o]={},i.type){case"t":n.uniforms[o].value=e(i.value);break;case"c":n.uniforms[o].value=(new Color).setHex(i.value);break;case"v2":n.uniforms[o].value=(new Vector2).fromArray(i.value);break;case"v3":n.uniforms[o].value=(new Vector3).fromArray(i.value);break;case"v4":n.uniforms[o].value=(new Vector4).fromArray(i.value);break;case"m3":n.uniforms[o].value=(new Matrix3).fromArray(i.value);break;case"m4":n.uniforms[o].value=(new Matrix4).fromArray(i.value);break;default:n.uniforms[o].value=i.value}}if(void 0!==t.defines&&(n.defines=t.defines),void 0!==t.vertexShader&&(n.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(n.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const a in t.extensions)n.extensions[a]=t.extensions[a];if(void 0!==t.shading&&(n.flatShading=1===t.shading),void 0!==t.size&&(n.size=t.size),void 0!==t.sizeAttenuation&&(n.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(n.map=e(t.map)),void 0!==t.matcap&&(n.matcap=e(t.matcap)),void 0!==t.alphaMap&&(n.alphaMap=e(t.alphaMap)),void 0!==t.bumpMap&&(n.bumpMap=e(t.bumpMap)),void 0!==t.bumpScale&&(n.bumpScale=t.bumpScale),void 0!==t.normalMap&&(n.normalMap=e(t.normalMap)),void 0!==t.normalMapType&&(n.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),n.normalScale=(new Vector2).fromArray(e)}return void 0!==t.displacementMap&&(n.displacementMap=e(t.displacementMap)),void 0!==t.displacementScale&&(n.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(n.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(n.roughnessMap=e(t.roughnessMap)),void 0!==t.metalnessMap&&(n.metalnessMap=e(t.metalnessMap)),void 0!==t.emissiveMap&&(n.emissiveMap=e(t.emissiveMap)),void 0!==t.emissiveIntensity&&(n.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(n.specularMap=e(t.specularMap)),void 0!==t.envMap&&(n.envMap=e(t.envMap)),void 0!==t.envMapIntensity&&(n.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(n.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(n.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(n.lightMap=e(t.lightMap)),void 0!==t.lightMapIntensity&&(n.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(n.aoMap=e(t.aoMap)),void 0!==t.aoMapIntensity&&(n.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(n.gradientMap=e(t.gradientMap)),void 0!==t.clearcoatMap&&(n.clearcoatMap=e(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap=e(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(n.clearcoatNormalMap=e(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(n.clearcoatNormalScale=(new Vector2).fromArray(t.clearcoatNormalScale)),void 0!==t.transmission&&(n.transmission=t.transmission),void 0!==t.transmissionMap&&(n.transmissionMap=e(t.transmissionMap)),n}setTextures(e){return this.textures=e,this}}const LoaderUtils={decodeText:function(r){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(r);let n="";for(let e=0,t=r.length;e<t;e++)n+=String.fromCharCode(r[e]);try{return decodeURIComponent(escape(n))}catch(e){return n}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function InstancedBufferGeometry(){BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function InstancedBufferAttribute(e,t,r,n){"number"==typeof r&&(n=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),BufferAttribute.call(this,e,t,r),this.meshPerAttribute=n||1}InstancedBufferGeometry.prototype=Object.assign(Object.create(BufferGeometry.prototype),{constructor:InstancedBufferGeometry,isInstancedBufferGeometry:!0,copy:function(e){return BufferGeometry.prototype.copy.call(this,e),this.instanceCount=e.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const e=BufferGeometry.prototype.toJSON.call(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}),InstancedBufferAttribute.prototype=Object.assign(Object.create(BufferAttribute.prototype),{constructor:InstancedBufferAttribute,isInstancedBufferAttribute:!0,copy:function(e){return BufferAttribute.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){const e=BufferAttribute.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}});class BufferGeometryLoader extends Loader{constructor(e){super(e)}load(t,r,e,n){const i=this,o=new FileLoader(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,function(e){try{r(i.parse(JSON.parse(e)))}catch(e){n?n(e):console.error(e),i.manager.itemError(t)}},e,n)}parse(r){const i={},o={};function n(e,t){if(void 0!==i[t])return i[t];var r=e.interleavedBuffers[t],e=function(e,t){if(void 0!==o[t])return o[t];e=e.arrayBuffers,e=e[t],e=new Uint32Array(e).buffer;return o[t]=e}(e,r.buffer);const n=new InterleavedBuffer(getTypedArray(r.type,e),r.stride);return n.uuid=r.uuid,i[t]=n,n}const a=new(r.isInstancedBufferGeometry?InstancedBufferGeometry:BufferGeometry);var e=r.data.index;void 0!==e&&(p=getTypedArray(e.type,e.array),a.setIndex(new BufferAttribute(p,1)));var t=r.data.attributes;for(const m in t){var s=t[m];let e;if(s.isInterleavedBufferAttribute){var l=n(r.data,s.data);e=new InterleavedBufferAttribute(l,s.itemSize,s.offset,s.normalized)}else{l=getTypedArray(s.type,s.array);const f=s.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute;e=new f(l,s.itemSize,s.normalized)}void 0!==s.name&&(e.name=s.name),void 0!==s.usage&&e.setUsage(s.usage),void 0!==s.updateRange&&(e.updateRange.offset=s.updateRange.offset,e.updateRange.count=s.updateRange.count),a.setAttribute(m,e)}var c=r.data.morphAttributes;if(c)for(const g in c){var h=c[g];const v=[];for(let t=0,e=h.length;t<e;t++){var u=h[t];let e;e=u.isInterleavedBufferAttribute?new InterleavedBufferAttribute(n(r.data,u.data),u.itemSize,u.offset,u.normalized):new BufferAttribute(getTypedArray(u.type,u.array),u.itemSize,u.normalized),void 0!==u.name&&(e.name=u.name),v.push(e)}a.morphAttributes[g]=v}r.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);var A=r.data.groups||r.data.drawcalls||r.data.offsets;if(void 0!==A)for(let e=0,t=A.length;e!==t;++e){var d=A[e];a.addGroup(d.start,d.count,d.materialIndex)}var p=r.data.boundingSphere;if(void 0!==p){const _=new Vector3;void 0!==p.center&&_.fromArray(p.center),a.boundingSphere=new Sphere(_,p.radius)}return r.name&&(a.name=r.name),r.userData&&(a.userData=r.userData),a}}class ObjectLoader extends Loader{constructor(e){super(e)}load(n,i,e,o){const a=this;var t=""===this.path?LoaderUtils.extractUrlBase(n):this.path;this.resourcePath=this.resourcePath||t;const r=new FileLoader(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(n,function(e){let t=null;try{t=JSON.parse(e)}catch(e){return void 0!==o&&o(e),void console.error("THREE:ObjectLoader: Can't parse "+n+".",e.message)}const r=t.metadata;void 0!==r&&void 0!==r.type&&"geometry"!==r.type.toLowerCase()?a.parse(t,i):console.error("THREE.ObjectLoader: Can't load "+n)},e,o)}parse(e,t){var r=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),o=this.parseImages(e.images,function(){void 0!==t&&t(a)}),n=this.parseTextures(e.textures,o),n=this.parseMaterials(e.materials,n);const a=this.parseObject(e.object,i,n,r);e=this.parseSkeletons(e.skeletons,a);if(this.bindSkeletons(a,e),void 0!==t){let e=!1;for(const s in o)if(o[s]instanceof HTMLImageElement){e=!0;break}!1===e&&t(a)}return a}parseShapes(r){const n={};if(void 0!==r)for(let e=0,t=r.length;e<t;e++){var i=(new Shape).fromJSON(r[e]);n[i.uuid]=i}return n}parseSkeletons(r,e){const n={},i={};if(e.traverse(function(e){e.isBone&&(i[e.uuid]=e)}),void 0!==r)for(let e=0,t=r.length;e<t;e++){var o=(new Skeleton).fromJSON(r[e],i);n[o.uuid]=o}return n}parseGeometries(r,n){const i={};let o;if(void 0!==r){const c=new BufferGeometryLoader;for(let t=0,e=r.length;t<e;t++){let e;const h=r[t];switch(h.type){case"PlaneGeometry":case"PlaneBufferGeometry":e=new Geometries[h.type](h.width,h.height,h.widthSegments,h.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":e=new Geometries[h.type](h.width,h.height,h.depth,h.widthSegments,h.heightSegments,h.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":e=new Geometries[h.type](h.radius,h.segments,h.thetaStart,h.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":e=new Geometries[h.type](h.radiusTop,h.radiusBottom,h.height,h.radialSegments,h.heightSegments,h.openEnded,h.thetaStart,h.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":e=new Geometries[h.type](h.radius,h.height,h.radialSegments,h.heightSegments,h.openEnded,h.thetaStart,h.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":e=new Geometries[h.type](h.radius,h.widthSegments,h.heightSegments,h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":e=new Geometries[h.type](h.radius,h.detail);break;case"RingGeometry":case"RingBufferGeometry":e=new Geometries[h.type](h.innerRadius,h.outerRadius,h.thetaSegments,h.phiSegments,h.thetaStart,h.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":e=new Geometries[h.type](h.radius,h.tube,h.radialSegments,h.tubularSegments,h.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":e=new Geometries[h.type](h.radius,h.tube,h.tubularSegments,h.radialSegments,h.p,h.q);break;case"TubeGeometry":case"TubeBufferGeometry":e=new Geometries[h.type]((new Curves[h.path.type]).fromJSON(h.path),h.tubularSegments,h.radius,h.radialSegments,h.closed);break;case"LatheGeometry":case"LatheBufferGeometry":e=new Geometries[h.type](h.points,h.segments,h.phiStart,h.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":e=new Geometries[h.type](h.vertices,h.indices,h.radius,h.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":o=[];for(let e=0,t=h.shapes.length;e<t;e++){var a=n[h.shapes[e]];o.push(a)}e=new Geometries[h.type](o,h.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":o=[];for(let e=0,t=h.shapes.length;e<t;e++){var s=n[h.shapes[e]];o.push(s)}var l=h.options.extrudePath;void 0!==l&&(h.options.extrudePath=(new Curves[l.type]).fromJSON(l)),e=new Geometries[h.type](o,h.options);break;case"BufferGeometry":case"InstancedBufferGeometry":e=c.parse(h);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+h.type+'"');continue}e.uuid=h.uuid,void 0!==h.name&&(e.name=h.name),!0===e.isBufferGeometry&&void 0!==h.userData&&(e.userData=h.userData),i[h.uuid]=e}}return i}parseMaterials(r,e){const n={},i={};if(void 0!==r){const s=new MaterialLoader;s.setTextures(e);for(let e=0,t=r.length;e<t;e++){var o=r[e];if("MultiMaterial"===o.type){const l=[];for(let e=0;e<o.materials.length;e++){var a=o.materials[e];void 0===n[a.uuid]&&(n[a.uuid]=s.parse(a)),l.push(n[a.uuid])}i[o.uuid]=l}else void 0===n[o.uuid]&&(n[o.uuid]=s.parse(o)),i[o.uuid]=n[o.uuid]}}return i}parseAnimations(t){const r={};if(void 0!==t)for(let e=0;e<t.length;e++){var n=t[e],n=AnimationClip.parse(n);r[n.uuid]=n}return r}parseImages(r,e){const n=this,i={};let o;function a(e){if("string"!=typeof e)return e.data?{data:getTypedArray(e.type,e.data),width:e.width,height:e.height}:null;var t,e=e,e=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:n.resourcePath+e;return t=e,n.manager.itemStart(t),o.load(t,function(){n.manager.itemEnd(t)},void 0,function(){n.manager.itemError(t),n.manager.itemEnd(t)})}if(void 0!==r&&0<r.length){e=new LoadingManager(e);o=new ImageLoader(e),o.setCrossOrigin(this.crossOrigin);for(let e=0,t=r.length;e<t;e++){var s=r[e],l=s.url;if(Array.isArray(l)){i[s.uuid]=[];for(let e=0,t=l.length;e<t;e++){var c=a(l[e]);null!==c&&(c instanceof HTMLImageElement?i[s.uuid].push(c):i[s.uuid].push(new DataTexture(c.data,c.width,c.height)))}}else{var h=a(s.url);null!==h&&(i[s.uuid]=h)}}}return i}parseTextures(r,n){function i(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const o={};if(void 0!==r)for(let t=0,e=r.length;t<e;t++){var a=r[t];void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===n[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);let e;var s=n[a.image];Array.isArray(s)?(e=new CubeTexture(s),6===s.length&&(e.needsUpdate=!0)):(e=s&&s.data?new DataTexture(s.data,s.width,s.height):new Texture(s),s&&(e.needsUpdate=!0)),e.uuid=a.uuid,void 0!==a.name&&(e.name=a.name),void 0!==a.mapping&&(e.mapping=i(a.mapping,TEXTURE_MAPPING)),void 0!==a.offset&&e.offset.fromArray(a.offset),void 0!==a.repeat&&e.repeat.fromArray(a.repeat),void 0!==a.center&&e.center.fromArray(a.center),void 0!==a.rotation&&(e.rotation=a.rotation),void 0!==a.wrap&&(e.wrapS=i(a.wrap[0],TEXTURE_WRAPPING),e.wrapT=i(a.wrap[1],TEXTURE_WRAPPING)),void 0!==a.format&&(e.format=a.format),void 0!==a.type&&(e.type=a.type),void 0!==a.encoding&&(e.encoding=a.encoding),void 0!==a.minFilter&&(e.minFilter=i(a.minFilter,TEXTURE_FILTER)),void 0!==a.magFilter&&(e.magFilter=i(a.magFilter,TEXTURE_FILTER)),void 0!==a.anisotropy&&(e.anisotropy=a.anisotropy),void 0!==a.flipY&&(e.flipY=a.flipY),void 0!==a.premultiplyAlpha&&(e.premultiplyAlpha=a.premultiplyAlpha),void 0!==a.unpackAlignment&&(e.unpackAlignment=a.unpackAlignment),o[a.uuid]=e}return o}parseObject(e,t,o,r){let n;function i(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function a(r){if(void 0!==r){if(Array.isArray(r)){const i=[];for(let e=0,t=r.length;e<t;e++){var n=r[e];void 0===o[n]&&console.warn("THREE.ObjectLoader: Undefined material",n),i.push(o[n])}return i}return void 0===o[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),o[r]}}let s,l;switch(e.type){case"Scene":n=new Scene,void 0!==e.background&&Number.isInteger(e.background)&&(n.background=new Color(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?n.fog=new Fog(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(n.fog=new FogExp2(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":n=new PerspectiveCamera(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(n.focus=e.focus),void 0!==e.zoom&&(n.zoom=e.zoom),void 0!==e.filmGauge&&(n.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(n.filmOffset=e.filmOffset),void 0!==e.view&&(n.view=Object.assign({},e.view));break;case"OrthographicCamera":n=new OrthographicCamera(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(n.zoom=e.zoom),void 0!==e.view&&(n.view=Object.assign({},e.view));break;case"AmbientLight":n=new AmbientLight(e.color,e.intensity);break;case"DirectionalLight":n=new DirectionalLight(e.color,e.intensity);break;case"PointLight":n=new PointLight(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":n=new RectAreaLight(e.color,e.intensity,e.width,e.height);break;case"SpotLight":n=new SpotLight(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":n=new HemisphereLight(e.color,e.groundColor,e.intensity);break;case"LightProbe":n=(new LightProbe).fromJSON(e);break;case"SkinnedMesh":s=i(e.geometry),l=a(e.material),n=new SkinnedMesh(s,l),void 0!==e.bindMode&&(n.bindMode=e.bindMode),void 0!==e.bindMatrix&&n.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(n.skeleton=e.skeleton);break;case"Mesh":s=i(e.geometry),l=a(e.material),n=new Mesh(s,l);break;case"InstancedMesh":s=i(e.geometry),l=a(e.material);var c=e.count,h=e.instanceMatrix,u=e.instanceColor;n=new InstancedMesh(s,l,c),n.instanceMatrix=new BufferAttribute(new Float32Array(h.array),16),void 0!==u&&(n.instanceColor=new BufferAttribute(new Float32Array(u.array),u.itemSize));break;case"LOD":n=new LOD;break;case"Line":n=new Line(i(e.geometry),a(e.material));break;case"LineLoop":n=new LineLoop(i(e.geometry),a(e.material));break;case"LineSegments":n=new LineSegments(i(e.geometry),a(e.material));break;case"PointCloud":case"Points":n=new Points(i(e.geometry),a(e.material));break;case"Sprite":n=new Sprite(a(e.material));break;case"Group":n=new Group;break;case"Bone":n=new Bone;break;default:n=new Object3D}if(n.uuid=e.uuid,void 0!==e.name&&(n.name=e.name),void 0!==e.matrix?(n.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(n.matrixAutoUpdate=e.matrixAutoUpdate),n.matrixAutoUpdate&&n.matrix.decompose(n.position,n.quaternion,n.scale)):(void 0!==e.position&&n.position.fromArray(e.position),void 0!==e.rotation&&n.rotation.fromArray(e.rotation),void 0!==e.quaternion&&n.quaternion.fromArray(e.quaternion),void 0!==e.scale&&n.scale.fromArray(e.scale)),void 0!==e.castShadow&&(n.castShadow=e.castShadow),void 0!==e.receiveShadow&&(n.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(n.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(n.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(n.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&n.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(n.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.frustumCulled&&(n.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(n.renderOrder=e.renderOrder),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.layers&&(n.layers.mask=e.layers),void 0!==e.children){var A=e.children;for(let e=0;e<A.length;e++)n.add(this.parseObject(A[e],t,o,r))}if(void 0!==e.animations){var d=e.animations;for(let e=0;e<d.length;e++){var p=d[e];n.animations.push(r[p])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(n.autoUpdate=e.autoUpdate);var m=e.levels;for(let e=0;e<m.length;e++){var f=m[e],g=n.getObjectByProperty("uuid",f.object);void 0!==g&&n.addLevel(g,f.distance)}}return n}bindSkeletons(e,r){0!==Object.keys(r).length&&e.traverse(function(e){var t;!0===e.isSkinnedMesh&&void 0!==e.skeleton&&(void 0===(t=r[e.skeleton])?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(t,e.bindMatrix))})}setTexturePath(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}const TEXTURE_MAPPING={UVMapping:UVMapping,CubeReflectionMapping:CubeReflectionMapping,CubeRefractionMapping:CubeRefractionMapping,EquirectangularReflectionMapping:EquirectangularReflectionMapping,EquirectangularRefractionMapping:EquirectangularRefractionMapping,CubeUVReflectionMapping:CubeUVReflectionMapping,CubeUVRefractionMapping:CubeUVRefractionMapping},TEXTURE_WRAPPING={RepeatWrapping:RepeatWrapping,ClampToEdgeWrapping:ClampToEdgeWrapping,MirroredRepeatWrapping:MirroredRepeatWrapping},TEXTURE_FILTER={NearestFilter:NearestFilter,NearestMipmapNearestFilter:NearestMipmapNearestFilter,NearestMipmapLinearFilter:NearestMipmapLinearFilter,LinearFilter:LinearFilter,LinearMipmapNearestFilter:LinearMipmapNearestFilter,LinearMipmapLinearFilter:LinearMipmapLinearFilter};function ImageBitmapLoader(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Loader.call(this,e),this.options={premultiplyAlpha:"none"}}ImageBitmapLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ImageBitmapLoader,isImageBitmapLoader:!0,setOptions:function(e){return this.options=e,this},load:function(t,r,e,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,o=Cache.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout(function(){r&&r(o),i.manager.itemEnd(t)},0),o;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(t,a).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(i.options,{colorSpaceConversion:"none"}))}).then(function(e){Cache.add(t,e),r&&r(e),i.manager.itemEnd(t)}).catch(function(e){n&&n(e),i.manager.itemError(t),i.manager.itemEnd(t)}),i.manager.itemStart(t)}});class ShapePath{constructor(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,r,n){return this.currentPath.quadraticCurveTo(e,t,r,n),this}bezierCurveTo(e,t,r,n,i,o){return this.currentPath.bezierCurveTo(e,t,r,n,i,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(r,e){function t(r){const n=[];for(let e=0,t=r.length;e<t;e++){var i=r[e];const o=new Shape;o.curves=i.curves,n.push(o)}return n}const n=ShapeUtils.isClockWise,i=this.subPaths;if(0===i.length)return[];if(!0===e)return t(i);let o,a,s;const l=[];if(1===i.length)return a=i[0],s=new Shape,s.curves=a.curves,l.push(s),l;let c=!n(i[0].getPoints());c=r?!c:c;const h=[],u=[];let A=[],d=0;var p,m;u[d]=void 0,A[d]=[];for(let e=0,t=i.length;e<t;e++)a=i[e],p=a.getPoints(),o=n(p),o=r?!o:o,o?(!c&&u[d]&&d++,u[d]={s:new Shape,p:p},u[d].s.curves=a.curves,c&&d++,A[d]=[]):A[d].push({h:a,p:p[0]});if(!u[0])return t(i);if(1<u.length){let i=!1;const v=[];for(let e=0,t=u.length;e<t;e++)h[e]=[];for(let n=0,e=u.length;n<e;n++){var f=A[n];for(let r=0;r<f.length;r++){var g=f[r];let t=!0;for(let e=0;e<u.length;e++)!function(a,s){var e=s.length;let l=!1;for(let i=e-1,o=0;o<e;i=o++){let e=s[i],t=s[o],r=t.x-e.x,n=t.y-e.y;if(Math.abs(n)>Number.EPSILON){if(n<0&&(e=s[o],r=-r,t=s[i],n=-n),!(a.y<e.y||a.y>t.y))if(a.y===e.y){if(a.x===e.x)return 1}else{var c=n*(a.x-e.x)-r*(a.y-e.y);if(0==c)return 1;c<0||(l=!l)}}else if(a.y===e.y&&(t.x<=a.x&&a.x<=e.x||e.x<=a.x&&a.x<=t.x))return 1}return l}(g.p,u[e].p)||(n!==e&&v.push({froms:n,tos:e,hole:r}),t?(t=!1,h[e].push(g)):i=!0);t&&h[n].push(g)}}0<v.length&&(i||(A=h))}for(let r=0,e=u.length;r<e;r++){s=u[r].s,l.push(s);for(let e=0,t=(m=A[r]).length;e<t;e++)s.holes.push(m[e].h)}return l}}class Font{constructor(e){this.type="Font",this.data=e}generateShapes(e,t=100){var r=[];const n=createPaths(e,t,this.data);for(let e=0,t=n.length;e<t;e++)Array.prototype.push.apply(r,n[e].toShapes());return r}}function createPaths(e,t,r){var n=Array.from(e),i=t/r.resolution,o=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*i;const a=[];let s=0,l=0;for(let e=0;e<n.length;e++){var c=n[e];"\n"===c?(s=0,l-=o):(c=createPath(c,i,s,l,r),s+=c.offsetX,a.push(c.path))}return a}function createPath(e,h,u,A,t){const d=t.glyphs[e]||t.glyphs["?"];if(d){const m=new ShapePath;let r,n,i,o,a,s,l,c;if(d.o){var p=d._cachedOutline||(d._cachedOutline=d.o.split(" "));for(let e=0,t=p.length;e<t;)switch(p[e++]){case"m":r=p[e++]*h+u,n=p[e++]*h+A,m.moveTo(r,n);break;case"l":r=p[e++]*h+u,n=p[e++]*h+A,m.lineTo(r,n);break;case"q":i=p[e++]*h+u,o=p[e++]*h+A,a=p[e++]*h+u,s=p[e++]*h+A,m.quadraticCurveTo(a,s,i,o);break;case"b":i=p[e++]*h+u,o=p[e++]*h+A,a=p[e++]*h+u,s=p[e++]*h+A,l=p[e++]*h+u,c=p[e++]*h+A,m.bezierCurveTo(a,s,l,c,i,o)}}return{offsetX:d.ha*h,path:m}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+t.familyName+".")}Font.prototype.isFont=!0;class FontLoader extends Loader{constructor(e){super(e)}load(e,n,t,r){const i=this,o=new FileLoader(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,function(t){let r;try{r=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(t.substring(65,t.length-2))}t=i.parse(r);n&&n(t)},t,r)}parse(e){return new Font(e)}}let _context;const AudioContext={getContext:function(){return void 0===_context&&(_context=new(window.AudioContext||window.webkitAudioContext)),_context},setContext:function(e){_context=e}};class AudioLoader extends Loader{constructor(e){super(e)}load(n,i,e,o){const a=this,t=new FileLoader(this.manager);t.setResponseType("arraybuffer"),t.setPath(this.path),t.setRequestHeader(this.requestHeader),t.setWithCredentials(this.withCredentials),t.load(n,function(e){try{var t=e.slice(0);const r=AudioContext.getContext();r.decodeAudioData(t,function(e){i(e)})}catch(e){o?o(e):console.error(e),a.manager.itemError(n)}},e,o)}}class HemisphereLightProbe extends LightProbe{constructor(e,t,r=1){super(void 0,r);var n=(new Color).set(e),r=(new Color).set(t),e=new Vector3(n.r,n.g,n.b),t=new Vector3(r.r,r.g,r.b),n=Math.sqrt(Math.PI),r=n*Math.sqrt(.75);this.sh.coefficients[0].copy(e).add(t).multiplyScalar(n),this.sh.coefficients[1].copy(e).sub(t).multiplyScalar(r)}}HemisphereLightProbe.prototype.isHemisphereLightProbe=!0;class AmbientLightProbe extends LightProbe{constructor(e,t=1){super(void 0,t);e=(new Color).set(e);this.sh.coefficients[0].set(e.r,e.g,e.b).multiplyScalar(2*Math.sqrt(Math.PI))}}AmbientLightProbe.prototype.isAmbientLightProbe=!0;const _eyeRight=new Matrix4,_eyeLeft=new Matrix4;class StereoCamera{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const a=e.projectionMatrix.clone();var r,n=t.eyeSep/2,i=n*t.near/t.focus,o=t.near*Math.tan(MathUtils.DEG2RAD*t.fov*.5)/t.zoom;_eyeLeft.elements[12]=-n,_eyeRight.elements[12]=n,r=-o*t.aspect+i,n=o*t.aspect+i,a.elements[0]=2*t.near/(n-r),a.elements[8]=(n+r)/(n-r),this.cameraL.projectionMatrix.copy(a),r=-o*t.aspect-i,n=o*t.aspect-i,a.elements[0]=2*t.near/(n-r),a.elements[8]=(n+r)/(n-r),this.cameraR.projectionMatrix.copy(a)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(_eyeLeft),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(_eyeRight)}}class Clock{constructor(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;return this.autoStart&&!this.running?(this.start(),0):(this.running&&(t=now(),e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e),e);var t}}function now(){return("undefined"==typeof performance?Date:performance).now()}const _position$1=new Vector3,_quaternion$1=new Quaternion,_scale$1=new Vector3,_orientation$1=new Vector3;class AudioListener extends Object3D{constructor(){super(),this.type="AudioListener",this.context=AudioContext.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener;var r=this.up;this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(_position$1,_quaternion$1,_scale$1),_orientation$1.set(0,0,-1).applyQuaternion(_quaternion$1),t.positionX?(e=this.context.currentTime+this.timeDelta,t.positionX.linearRampToValueAtTime(_position$1.x,e),t.positionY.linearRampToValueAtTime(_position$1.y,e),t.positionZ.linearRampToValueAtTime(_position$1.z,e),t.forwardX.linearRampToValueAtTime(_orientation$1.x,e),t.forwardY.linearRampToValueAtTime(_orientation$1.y,e),t.forwardZ.linearRampToValueAtTime(_orientation$1.z,e),t.upX.linearRampToValueAtTime(r.x,e),t.upY.linearRampToValueAtTime(r.y,e),t.upZ.linearRampToValueAtTime(r.z,e)):(t.setPosition(_position$1.x,_position$1.y,_position$1.z),t.setOrientation(_orientation$1.x,_orientation$1.y,_orientation$1.z,r.x,r.y,r.z))}}class Audio extends Object3D{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e=e||[],!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const _position=new Vector3,_quaternion=new Quaternion,_scale=new Vector3,_orientation=new Vector3;class PositionalAudio extends Audio{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(_position,_quaternion,_scale),_orientation.set(0,0,1).applyQuaternion(_quaternion);const t=this.panner;t.positionX?(e=this.context.currentTime+this.listener.timeDelta,t.positionX.linearRampToValueAtTime(_position.x,e),t.positionY.linearRampToValueAtTime(_position.y,e),t.positionZ.linearRampToValueAtTime(_position.z,e),t.orientationX.linearRampToValueAtTime(_orientation.x,e),t.orientationY.linearRampToValueAtTime(_orientation.y,e),t.orientationZ.linearRampToValueAtTime(_orientation.z,e)):(t.setPosition(_position.x,_position.y,_position.z),t.setOrientation(_orientation.x,_orientation.y,_orientation.z))}}}class AudioAnalyser{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;var r=this.getFrequencyData();for(let e=0;e<r.length;e++)t+=r[e];return t/r.length}}class PropertyMixer{constructor(e,t,r){this.binding=e,this.valueSize=r;let n,i,o;switch(t){case"quaternion":n=this._slerp,i=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*r),this._workIndex=5;break;case"string":case"bool":n=this._select,i=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*r);break;default:n=this._lerp,i=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*r)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=i,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const r=this.buffer,n=this.valueSize,i=e*n+n;let o=this.cumulativeWeight;if(0===o){for(let e=0;e!==n;++e)r[i+e]=r[e];o=t}else{o+=t;t=t/o;this._mixBufferRegion(r,i,0,t,n)}this.cumulativeWeight=o}accumulateAdditive(e){var t=this.buffer,r=this.valueSize,n=r*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){const r=this.valueSize,n=this.buffer,i=e*r+r,t=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,t<1&&(e=r*this._origIndex,this._mixBufferRegion(n,i,e,1-t,r)),0<o&&this._mixBufferRegionAdditive(n,i,this._addIndex*r,1,r);for(let e=r,t=r+r;e!==t;++e)if(n[e]!==n[e+r]){a.setValue(n,i);break}}saveOriginalState(){const e=this.binding,r=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(r,i);for(let e=n,t=i;e!==t;++e)r[e]=r[i+e%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){var t=this._addIndex*this.valueSize,r=t+this.valueSize;for(let e=t;e<r;e++)this.buffer[e]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){var t=this._origIndex*this.valueSize,r=this._addIndex*this.valueSize;for(let e=0;e<this.valueSize;e++)this.buffer[r+e]=this.buffer[t+e]}_select(t,r,n,e,i){if(.5<=e)for(let e=0;e!==i;++e)t[r+e]=t[n+e]}_slerp(e,t,r,n){Quaternion.slerpFlat(e,t,e,t,e,r,n)}_slerpAdditive(e,t,r,n,i){i=this._workIndex*i;Quaternion.multiplyQuaternionsFlat(e,i,e,t,e,r),Quaternion.slerpFlat(e,t,e,t,e,i,n)}_lerp(t,r,n,i,o){var a=1-i;for(let e=0;e!==o;++e){var s=r+e;t[s]=t[s]*a+t[n+e]*i}}_lerpAdditive(t,r,n,i,o){for(let e=0;e!==o;++e){var a=r+e;t[a]=t[a]+t[n+e]*i}}}const _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g"),_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones"];function Composite(e,t,r){r=r||PropertyBinding.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}function PropertyBinding(e,t,r){this.path=t,this.parsedPath=r||PropertyBinding.parseTrackName(t),this.node=PropertyBinding.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}Object.assign(Composite.prototype,{getValue:function(e,t){this.bind();const r=this._targetGroup.nCachedObjects_,n=this._bindings[r];void 0!==n&&n.getValue(e,t)},setValue:function(r,n){const i=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=i.length;e!==t;++e)i[e].setValue(r,n)},bind:function(){const r=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=r.length;e!==t;++e)r[e].bind()},unbind:function(){const r=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=r.length;e!==t;++e)r[e].unbind()}}),Object.assign(PropertyBinding,{Composite:Composite,create:function(e,t,r){return new(e&&e.isAnimationObjectGroup?PropertyBinding.Composite:PropertyBinding)(e,t,r)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(_reservedRe,"")},parseTrackName:function(e){var t=_trackRe.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]};var n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n&&(t=r.nodeName.substring(n+1),-1!==_supportedObjectNames.indexOf(t)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=t)),null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r},findNode:function(e,n){if(!n||""===n||"."===n||-1===n||n===e.name||n===e.uuid)return e;if(e.skeleton){var t=e.skeleton.getBoneByName(n);if(void 0!==t)return t}if(e.children){const i=function(t){for(let e=0;e<t.length;e++){var r=t[e];if(r.name===n||r.uuid===n)return r;r=i(r.children);if(r)return r}return null};e=i(e.children);if(e)return e}return null}}),Object.assign(PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(r,n){var i=this.resolvedProperty;for(let e=0,t=i.length;e!==t;++e)r[n++]=i[e]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(r,n){const i=this.resolvedProperty;for(let e=0,t=i.length;e!==t;++e)i[e]=r[n++]},function(r,n){const i=this.resolvedProperty;for(let e=0,t=i.length;e!==t;++e)i[e]=r[n++];this.targetObject.needsUpdate=!0},function(r,n){const i=this.resolvedProperty;for(let e=0,t=i.length;e!==t;++e)i[e]=r[n++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){let r=this.node;var e=this.parsedPath,n=e.objectName,i=e.propertyName;let o=e.propertyIndex;if(r||(r=PropertyBinding.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=r),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,r){if(n){let t=e.objectIndex;switch(n){case"materials":if(!r.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!r.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);r=r.material.materials;break;case"bones":if(!r.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);r=r.skeleton.bones;for(let e=0;e<r.length;e++)if(r[e].name===t){t=e;break}break;default:if(void 0===r[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);r=r[n]}if(void 0!==t){if(void 0===r[t])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,r);r=r[t]}}var a=r[i];if(void 0!==a){let e=this.Versioning.None;this.targetObject=r,void 0!==r.needsUpdate?e=this.Versioning.NeedsUpdate:void 0!==r.matrixWorldNeedsUpdate&&(e=this.Versioning.MatrixWorldNeedsUpdate);let t=this.BindingType.Direct;if(void 0!==o){if("morphTargetInfluences"===i){if(!r.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!r.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!r.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==r.morphTargetDictionary[o]&&(o=r.morphTargetDictionary[o])}t=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=o}else void 0!==a.fromArray&&void 0!==a.toArray?(t=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(t=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=i;this.getValue=this.GetterByBindingType[t],this.setValue=this.SetterByBindingTypeAndVersioning[t][e]}else{e=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+e+"."+i+" but it wasn't found.",r)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(PropertyBinding.prototype,{_getValue_unbound:PropertyBinding.prototype.getValue,_setValue_unbound:PropertyBinding.prototype.setValue});class AnimationObjectGroup{constructor(){this.uuid=MathUtils.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const r={};this._indicesByUUID=r;for(let e=0,t=arguments.length;e!==t;++e)r[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const n=this._objects,i=this._indicesByUUID,o=this._paths,a=this._parsedPaths,s=this._bindings,l=s.length;let c=void 0,h=n.length,u=this.nCachedObjects_;for(let e=0,t=arguments.length;e!==t;++e){var A=arguments[e],d=A.uuid;let r=i[d];if(void 0===r){r=h++,i[d]=r,n.push(A);for(let e=0,t=l;e!==t;++e)s[e].push(new PropertyBinding(A,o[e],a[e]))}else if(r<u){c=n[r];var p=--u,m=n[p];i[m.uuid]=r,n[r]=m,i[d]=p,n[p]=A;for(let t=0,e=l;t!==e;++t){const f=s[t],g=f[p];let e=f[r];f[r]=g,void 0===e&&(e=new PropertyBinding(A,o[t],a[t])),f[p]=e}}else n[r]!==c&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=u}remove(){const r=this._objects,n=this._indicesByUUID,i=this._bindings,o=i.length;let a=this.nCachedObjects_;for(let e=0,t=arguments.length;e!==t;++e){var s=arguments[e],l=s.uuid,c=n[l];if(void 0!==c&&c>=a){var h=a++,u=r[h];n[u.uuid]=c,r[c]=u,n[l]=h,r[h]=s;for(let e=0,t=o;e!==t;++e){const A=i[e],d=A[h],p=A[c];A[c]=d,A[h]=p}}}this.nCachedObjects_=a}uncache(){const r=this._objects,n=this._indicesByUUID,i=this._bindings,o=i.length;let a=this.nCachedObjects_,s=r.length;for(let e=0,t=arguments.length;e!==t;++e){var l=arguments[e].uuid,c=n[l];if(void 0!==c)if(delete n[l],c<a){var h=--a,l=r[h],u=--s,A=r[u];n[l.uuid]=c,r[c]=l,n[A.uuid]=h,r[h]=A,r.pop();for(let e=0,t=o;e!==t;++e){const p=i[e],m=p[h],f=p[u];p[c]=m,p[h]=f,p.pop()}}else{var d=--s,A=r[d];0<d&&(n[A.uuid]=c),r[c]=A,r.pop();for(let e=0,t=o;e!==t;++e){const g=i[e];g[c]=g[d],g.pop()}}}this.nCachedObjects_=a}subscribe_(r,n){const e=this._bindingsIndicesByPath;let t=e[r];const i=this._bindings;if(void 0!==t)return i[t];const o=this._paths,a=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,h=new Array(l);t=i.length,e[r]=t,o.push(r),a.push(n),i.push(h);for(let e=c,t=s.length;e!==t;++e){var u=s[e];h[e]=new PropertyBinding(u,r,n)}return h}unsubscribe_(e){const t=this._bindingsIndicesByPath,r=t[e];if(void 0!==r){const n=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a],l=e[a];t[l]=r,o[r]=s,o.pop(),i[r]=i[a],i.pop(),n[r]=n[a],n.pop()}}}AnimationObjectGroup.prototype.isAnimationObjectGroup=!0;class AnimationAction{constructor(e,t,r=null,n=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=r,this.blendMode=n;const i=t.tracks,o=i.length,a=new Array(o);var s={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding};for(let e=0;e!==o;++e){const l=i[e].createInterpolant(null);a[e]=l,l.settings=s}this._interpolantSettings=s,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,r){var n,i;return e.fadeOut(t),this.fadeIn(t),r&&(r=(n=this._clip.duration)/(i=e._clip.duration),e.warp(1,i/n,t),this.warp(r,1,t)),this}crossFadeTo(e,t,r){return e.crossFadeFrom(this,t,r)}stopFading(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,r){const n=this._mixer,i=n.time,o=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);const s=a.parameterPositions,l=a.sampleValues;return s[0]=i,s[1]=i+r,l[0]=e/o,l[1]=t/o,this}stopWarping(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,r,n){if(this.enabled){var i=this._startTime;if(null!==i){i=(e-i)*r;if(i<0||0===r)return;this._startTime=null,t=r*i}t*=this._updateTimeScale(e);var o=this._updateTime(t),a=this._updateWeight(e);if(0<a){const s=this._interpolants,l=this._propertyBindings;if(this.blendMode===AdditiveAnimationBlendMode)for(let e=0,t=s.length;e!==t;++e)s[e].evaluate(o),l[e].accumulateAdditive(a);else{NormalAnimationBlendMode;for(let e=0,t=s.length;e!==t;++e)s[e].evaluate(o),l[e].accumulate(n,a)}}}else this._updateWeight(e)}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;var r;null!==n&&(r=n.evaluate(e)[0],t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1)))}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;var r;null!==n&&(r=n.evaluate(e)[0],t*=r,e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){var t=this._clip.duration,r=this.loop;let n=this.time+e,i=this._loopCount;var o,a=r===LoopPingPong;if(0===e)return-1!==i&&a&&1==(1&i)?t-n:n;if(r===LoopOnce){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else{if(!(n<0)){this.time=n;break e}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else if(-1===i&&(0<=e?(i=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),n>=t||n<0?(o=Math.floor(n/t),n-=t*o,i+=Math.abs(o),(r=this.repetitions-i)<=0?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=0<e?t:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<e?1:-1})):(1==r?this._setEndings(r=e<0,!r,a):this._setEndings(!1,!1,a),this._loopCount=i,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o}))):this.time=n,a&&1==(1&i))return t-n;return n}_setEndings(e,t,r){const n=this._interpolantSettings;r?(n.endingStart=ZeroSlopeEnding,n.endingEnd=ZeroSlopeEnding):(n.endingStart=e?this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding:WrapAroundEnding,n.endingEnd=t?this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding:WrapAroundEnding)}_scheduleFading(e,t,r){const n=this._mixer,i=n.time;let o=this._weightInterpolant;null===o&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,s=o.sampleValues;return a[0]=i,s[0]=t,a[1]=i+e,s[1]=r,this}}class AnimationMixer extends EventDispatcher{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,r){const n=e._localRoot||this._root,i=e._clip.tracks,o=i.length,a=e._propertyBindings,s=e._interpolants,l=n.uuid,t=this._bindingsByRootAndName;let c=t[l];void 0===c&&(c={},t[l]=c);for(let t=0;t!==o;++t){const u=i[t],A=u.name;let e=c[A];if(void 0!==e)a[t]=e;else{if(e=a[t],void 0!==e){null===e._cacheIndex&&(++e.referenceCount,this._addInactiveBinding(e,l,A));continue}var h=r&&r._propertyBindings[t].binding.parsedPath;e=new PropertyMixer(PropertyBinding.create(n,A,h),u.ValueTypeName,u.getValueSize()),++e.referenceCount,this._addInactiveBinding(e,l,A),a[t]=e}s[t].resultBuffer=e.buffer}}_activateAction(e){if(!this._isActiveAction(e)){var t,r,n;null===e._cacheIndex&&(t=(e._localRoot||this._root).uuid,r=e._clip.uuid,n=this._actionsByClip[r],this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,r,t));var i=e._propertyBindings;for(let e=0,t=i.length;e!==t;++e){const o=i[e];0==o.useCount++&&(this._lendBinding(o),o.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){var r=e._propertyBindings;for(let e=0,t=r.length;e!==t;++e){const n=r[e];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){e=e._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(e,t,r){const n=this._actions,i=this._actionsByClip;let o=i[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=n.length,n.push(e),o.actionByRoot[r]=e}_removeInactiveAction(e){const t=this._actions,r=t[t.length-1],n=e._cacheIndex;r._cacheIndex=n,t[n]=r,t.pop(),e._cacheIndex=null;const i=e._clip.uuid,o=this._actionsByClip,a=o[i],s=a.knownActions,l=s[s.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),e._byClipCacheIndex=null;const h=a.actionByRoot,u=(e._localRoot||this._root).uuid;delete h[u],0===s.length&&delete o[i],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){var r=e._propertyBindings;for(let e=0,t=r.length;e!==t;++e){const n=r[e];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(e){const t=this._actions,r=e._cacheIndex,n=this._nActiveActions++,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i}_takeBackAction(e){const t=this._actions,r=e._cacheIndex,n=--this._nActiveActions,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i}_addInactiveBinding(e,t,r){const n=this._bindingsByRootAndName,i=this._bindings;let o=n[t];void 0===o&&(o={},n[t]=o),(o[r]=e)._cacheIndex=i.length,i.push(e)}_removeInactiveBinding(e){const t=this._bindings,r=e.binding,n=r.rootNode.uuid,i=r.path,o=this._bindingsByRootAndName,a=o[n],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete a[i],0===Object.keys(a).length&&delete o[n]}_lendBinding(e){const t=this._bindings,r=e._cacheIndex,n=this._nActiveBindings++,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i}_takeBackBinding(e){const t=this._bindings,r=e._cacheIndex,n=--this._nActiveBindings,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let r=e[t];return void 0===r&&(r=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),r.__cacheIndex=t,e[t]=r),r}_takeBackControlInterpolant(e){const t=this._controlInterpolants,r=e.__cacheIndex,n=--this._nActiveControlInterpolants,i=t[n];e.__cacheIndex=n,t[n]=e,i.__cacheIndex=r,t[r]=i}clipAction(e,t,r){var n=t||this._root,i=n.uuid;let o="string"==typeof e?AnimationClip.findByName(n,e):e;var a=null!==o?o.uuid:e,n=this._actionsByClip[a];let s=null;if(void 0===r&&(r=null!==o?o.blendMode:NormalAnimationBlendMode),void 0!==n){e=n.actionByRoot[i];if(void 0!==e&&e.blendMode===r)return e;s=n.knownActions[0],null===o&&(o=s._clip)}if(null===o)return null;r=new AnimationAction(this,o,t,r);return this._bindAction(r,s),this._addInactiveAction(r,a,i),r}existingAction(e,t){var r=t||this._root,t=r.uuid,r="string"==typeof e?AnimationClip.findByName(r,e):e,e=r?r.uuid:e,e=this._actionsByClip[e];return void 0!==e&&e.actionByRoot[t]||null}stopAllAction(){const t=this._actions,r=this._nActiveActions;for(let e=r-1;0<=e;--e)t[e].stop();return this}update(t){t*=this.timeScale;var r=this._actions,n=this._nActiveActions,i=this.time+=t,o=Math.sign(t),a=this._accuIndex^=1;for(let e=0;e!==n;++e){const c=r[e];c._update(i,t,o,a)}const s=this._bindings,l=this._nActiveBindings;for(let e=0;e!==l;++e)s[e].apply(a);return this}setTime(e){for(let e=this.time=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const r=this._actions,t=e.uuid,n=this._actionsByClip,i=n[t];if(void 0!==i){var o=i.knownActions;for(let e=0,t=o.length;e!==t;++e){const a=o[e];this._deactivateAction(a);const s=a._cacheIndex,l=r[r.length-1];a._cacheIndex=null,a._byClipCacheIndex=null,l._cacheIndex=s,r[s]=l,r.pop(),this._removeInactiveBindingsForAction(a)}delete n[t]}}uncacheRoot(e){var t=e.uuid,r=this._actionsByClip;for(const o in r){var n=r[o].actionByRoot[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}var i=this._bindingsByRootAndName[t];if(void 0!==i)for(const a in i){const s=i[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}}uncacheAction(e,t){t=this.existingAction(e,t);null!==t&&(this._deactivateAction(t),this._removeInactiveAction(t))}}AnimationMixer.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Uniform{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new Uniform(void 0===this.value.clone?this.value:this.value.clone())}}function InstancedInterleavedBuffer(e,t,r){InterleavedBuffer.call(this,e,t),this.meshPerAttribute=r||1}function GLBufferAttribute(e,t,r,n,i){this.buffer=e,this.type=t,this.itemSize=r,this.elementSize=n,this.count=i,this.version=0}function Raycaster(e,t,r=0,n=1/0){this.ray=new Ray(e,t),this.near=r,this.far=n,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function ascSort(e,t){return e.distance-t.distance}function intersectObject(e,r,n,t){if(e.layers.test(r.layers)&&e.raycast(r,n),!0===t){var i=e.children;for(let e=0,t=i.length;e<t;e++)intersectObject(i[e],r,n,!0)}}InstancedInterleavedBuffer.prototype=Object.assign(Object.create(InterleavedBuffer.prototype),{constructor:InstancedInterleavedBuffer,isInstancedInterleavedBuffer:!0,copy:function(e){return InterleavedBuffer.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},clone:function(e){const t=InterleavedBuffer.prototype.clone.call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t},toJSON:function(e){const t=InterleavedBuffer.prototype.toJSON.call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}),Object.defineProperty(GLBufferAttribute.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(GLBufferAttribute.prototype,{isGLBufferAttribute:!0,setBuffer:function(e){return this.buffer=e,this},setType:function(e,t){return this.type=e,this.elementSize=t,this},setItemSize:function(e){return this.itemSize=e,this},setCount:function(e){return this.count=e,this}}),Object.assign(Raycaster.prototype,{set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)},intersectObject:function(e,t=!1,r=[]){return intersectObject(e,this,r,t),r.sort(ascSort),r},intersectObjects:function(r,n=!1,i=[]){for(let e=0,t=r.length;e<t;e++)intersectObject(r[e],this,i,n);return i.sort(ascSort),i}});class Spherical{constructor(e=1,t=0,r=0){return this.radius=e,this.phi=t,this.theta=r,this}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(MathUtils.clamp(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class Cylindrical{constructor(e=1,t=0,r=0){return this.radius=e,this.theta=t,this.y=r,this}set(e,t,r){return this.radius=e,this.theta=t,this.y=r,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const _vector$4=new Vector2;class Box2{constructor(e=new Vector2(1/0,1/0),t=new Vector2(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(r){this.makeEmpty();for(let e=0,t=r.length;e<t;e++)this.expandByPoint(r[e]);return this}setFromCenterAndSize(e,t){t=_vector$4.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(t),this.max.copy(e).add(t),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Vector2),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Vector2),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Vector2),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Vector2),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){const t=_vector$4.copy(e).clamp(this.min,this.max);return t.sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Box2.prototype.isBox2=!0;const _startP=new Vector3,_startEnd=new Vector3;class Line3{constructor(e=new Vector3,t=new Vector3){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new Vector3),e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new Vector3),e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new Vector3),this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){_startP.subVectors(e,this.start),_startEnd.subVectors(this.end,this.start);e=_startEnd.dot(_startEnd);let r=_startEnd.dot(_startP)/e;return t&&(r=MathUtils.clamp(r,0,1)),r}closestPointToPoint(e,t,r){t=this.closestPointToPointParameter(e,t);return void 0===r&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new Vector3),this.delta(r).multiplyScalar(t).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}function ImmediateRenderObject(e){Object3D.call(this),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}ImmediateRenderObject.prototype=Object.create(Object3D.prototype),(ImmediateRenderObject.prototype.constructor=ImmediateRenderObject).prototype.isImmediateRenderObject=!0;const _vector$3=new Vector3;class SpotLightHelper extends Object3D{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const r=new BufferGeometry,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1;e<32;e++,t++){var i=e/32*Math.PI*2,o=t/32*Math.PI*2;n.push(Math.cos(i),Math.sin(i),1,Math.cos(o),Math.sin(o),1)}r.setAttribute("position",new Float32BufferAttribute(n,3));t=new LineBasicMaterial({fog:!1,toneMapped:!1});this.cone=new LineSegments(r,t),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();var e=this.light.distance||1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),_vector$3.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(_vector$3),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const _vector$2=new Vector3,_boneMatrix=new Matrix4,_matrixWorldInv=new Matrix4;class SkeletonHelper extends LineSegments{constructor(e){var t=getBoneList(e);const r=new BufferGeometry,n=[],i=[];var o=new Color(0,0,1),a=new Color(0,1,0);for(let e=0;e<t.length;e++){var s=t[e];s.parent&&s.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(o.r,o.g,o.b),i.push(a.r,a.g,a.b))}r.setAttribute("position",new Float32BufferAttribute(n,3)),r.setAttribute("color",new Float32BufferAttribute(i,3));var l=new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(r,l),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){var r=this.bones;const t=this.geometry,n=t.getAttribute("position");_matrixWorldInv.copy(this.root.matrixWorld).invert();for(let e=0,t=0;e<r.length;e++){var i=r[e];i.parent&&i.parent.isBone&&(_boneMatrix.multiplyMatrices(_matrixWorldInv,i.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),n.setXYZ(t,_vector$2.x,_vector$2.y,_vector$2.z),_boneMatrix.multiplyMatrices(_matrixWorldInv,i.parent.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),n.setXYZ(t+1,_vector$2.x,_vector$2.y,_vector$2.z),t+=2)}t.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function getBoneList(t){const r=[];t&&t.isBone&&r.push(t);for(let e=0;e<t.children.length;e++)r.push.apply(r,getBoneList(t.children[e]));return r}class PointLightHelper extends Mesh{constructor(e,t,r){super(new SphereGeometry(t,4,2),new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.light.updateMatrixWorld(),this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const _vector$1=new Vector3,_color1=new Color,_color2=new Color;class HemisphereLightHelper extends Object3D{constructor(e,t,r){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;const n=new OctahedronGeometry(t);n.rotateY(.5*Math.PI),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);t=n.getAttribute("position"),t=new Float32Array(3*t.count);n.setAttribute("color",new BufferAttribute(t,3)),this.add(new Mesh(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const n=e.geometry.getAttribute("color");_color1.copy(this.light.color),_color2.copy(this.light.groundColor);for(let e=0,t=n.count;e<t;e++){var r=e<t/2?_color1:_color2;n.setXYZ(e,r.r,r.g,r.b)}n.needsUpdate=!0}e.lookAt(_vector$1.setFromMatrixPosition(this.light.matrixWorld).negate())}}class GridHelper extends LineSegments{constructor(e=10,n=10,i=4473924,o=8947848){i=new Color(i),o=new Color(o);var a=n/2,s=e/n,l=e/2;const c=[],h=[];for(let e=0,t=0,r=-l;e<=n;e++,r+=s){c.push(-l,0,r,l,0,r),c.push(r,0,-l,r,0,l);const u=e===a?i:o;u.toArray(h,t),t+=3,u.toArray(h,t),t+=3,u.toArray(h,t),t+=3,u.toArray(h,t),t+=3}const t=new BufferGeometry;t.setAttribute("position",new Float32BufferAttribute(c,3)),t.setAttribute("color",new Float32BufferAttribute(h,3));e=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(t,e),this.type="GridHelper"}}class PolarGridHelper extends LineSegments{constructor(t=10,r=16,n=8,i=64,o=4473924,a=8947848){o=new Color(o),a=new Color(a);const s=[],l=[];for(let e=0;e<=r;e++){var c=e/r*(2*Math.PI),h=Math.sin(c)*t,c=Math.cos(c)*t;s.push(0,0,0),s.push(h,0,c);c=1&e?o:a;l.push(c.r,c.g,c.b),l.push(c.r,c.g,c.b)}for(let e=0;e<=n;e++){var u=1&e?o:a,A=t-t/n*e;for(let e=0;e<i;e++){var d=e/i*(2*Math.PI),p=Math.sin(d)*A,m=Math.cos(d)*A;s.push(p,0,m),l.push(u.r,u.g,u.b),d=(e+1)/i*(2*Math.PI),p=Math.sin(d)*A,m=Math.cos(d)*A,s.push(p,0,m),l.push(u.r,u.g,u.b)}}const e=new BufferGeometry;e.setAttribute("position",new Float32BufferAttribute(s,3)),e.setAttribute("color",new Float32BufferAttribute(l,3));var f=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(e,f),this.type="PolarGridHelper"}}const _v1=new Vector3,_v2=new Vector3,_v3=new Vector3;class DirectionalLightHelper extends Object3D{constructor(e,t,r){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===t&&(t=1);let n=new BufferGeometry;n.setAttribute("position",new Float32BufferAttribute([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));t=new LineBasicMaterial({fog:!1,toneMapped:!1});this.lightPlane=new Line(n,t),this.add(this.lightPlane),n=new BufferGeometry,n.setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(n,t),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){_v1.setFromMatrixPosition(this.light.matrixWorld),_v2.setFromMatrixPosition(this.light.target.matrixWorld),_v3.subVectors(_v2,_v1),this.lightPlane.lookAt(_v2),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_v2),this.targetLine.scale.z=_v3.length()}}const _vector=new Vector3,_camera=new Camera;class CameraHelper extends LineSegments{constructor(e){const t=new BufferGeometry;var r=new LineBasicMaterial({color:16777215,vertexColors:!0,toneMapped:!1});const n=[],i=[],o={};var a=new Color(16755200),s=new Color(16711680),l=new Color(43775),c=new Color(16777215),h=new Color(3355443);function u(e,t,r){A(e,r),A(t,r)}function A(e,t){n.push(0,0,0),i.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(n.length/3-1)}u("n1","n2",a),u("n2","n4",a),u("n4","n3",a),u("n3","n1",a),u("f1","f2",a),u("f2","f4",a),u("f4","f3",a),u("f3","f1",a),u("n1","f1",a),u("n2","f2",a),u("n3","f3",a),u("n4","f4",a),u("p","n1",s),u("p","n2",s),u("p","n3",s),u("p","n4",s),u("u1","u2",l),u("u2","u3",l),u("u3","u1",l),u("c","t",c),u("p","c",h),u("cn1","cn2",h),u("cn3","cn4",h),u("cf1","cf2",h),u("cf3","cf4",h),t.setAttribute("position",new Float32BufferAttribute(n,3)),t.setAttribute("color",new Float32BufferAttribute(i,3)),super(t,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}update(){const e=this.geometry;var t=this.pointMap;_camera.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),setPoint("c",t,e,_camera,0,0,-1),setPoint("t",t,e,_camera,0,0,1),setPoint("n1",t,e,_camera,-1,-1,-1),setPoint("n2",t,e,_camera,1,-1,-1),setPoint("n3",t,e,_camera,-1,1,-1),setPoint("n4",t,e,_camera,1,1,-1),setPoint("f1",t,e,_camera,-1,-1,1),setPoint("f2",t,e,_camera,1,-1,1),setPoint("f3",t,e,_camera,-1,1,1),setPoint("f4",t,e,_camera,1,1,1),setPoint("u1",t,e,_camera,.7,1.1,-1),setPoint("u2",t,e,_camera,-.7,1.1,-1),setPoint("u3",t,e,_camera,0,2,-1),setPoint("cf1",t,e,_camera,-1,0,1),setPoint("cf2",t,e,_camera,1,0,1),setPoint("cf3",t,e,_camera,0,-1,1),setPoint("cf4",t,e,_camera,0,1,1),setPoint("cn1",t,e,_camera,-1,0,-1),setPoint("cn2",t,e,_camera,1,0,-1),setPoint("cn3",t,e,_camera,0,-1,-1),setPoint("cn4",t,e,_camera,0,1,-1),e.getAttribute("position").needsUpdate=!0}}function setPoint(e,t,r,n,i,o,a){_vector.set(i,o,a).unproject(n);var s=t[e];if(void 0!==s){const l=r.getAttribute("position");for(let e=0,t=s.length;e<t;e++)l.setXYZ(s[e],_vector.x,_vector.y,_vector.z)}}const _box=new Box3;class BoxHelper extends LineSegments{constructor(e,t=16776960){var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24);const i=new BufferGeometry;i.setIndex(new BufferAttribute(r,1)),i.setAttribute("position",new BufferAttribute(n,3)),super(i,new LineBasicMaterial({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&_box.setFromObject(this.object),!_box.isEmpty()){var t=_box.min,e=_box.max;const r=this.geometry.attributes.position,n=r.array;n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=t.x,n[4]=e.y,n[5]=e.z,n[6]=t.x,n[7]=t.y,n[8]=e.z,n[9]=e.x,n[10]=t.y,n[11]=e.z,n[12]=e.x,n[13]=e.y,n[14]=t.z,n[15]=t.x,n[16]=e.y,n[17]=t.z,n[18]=t.x,n[19]=t.y,n[20]=t.z,n[21]=e.x,n[22]=t.y,n[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}}setFromObject(e){return this.object=e,this.update(),this}copy(e){return LineSegments.prototype.copy.call(this,e),this.object=e.object,this}}class Box3Helper extends LineSegments{constructor(e,t=16776960){var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);const n=new BufferGeometry;n.setIndex(new BufferAttribute(r,1)),n.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(n,new LineBasicMaterial({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}class PlaneHelper extends Line{constructor(e,t=1,r=16776960){const n=new BufferGeometry;n.setAttribute("position",new Float32BufferAttribute([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),n.computeBoundingSphere(),super(n,new LineBasicMaterial({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const i=new BufferGeometry;i.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),i.computeBoundingSphere(),this.add(new Mesh(i,new MeshBasicMaterial({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?BackSide:FrontSide,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}}const _axis=new Vector3;let _lineGeometry,_coneGeometry;class ArrowHelper extends Object3D{constructor(e=new Vector3(0,0,1),t=new Vector3(0,0,0),r=1,n=16776960,i=.2*r,o=.2*i){super(),this.type="ArrowHelper",void 0===_lineGeometry&&(_lineGeometry=new BufferGeometry,_lineGeometry.setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),_coneGeometry=new CylinderGeometry(0,.5,1,5,1),_coneGeometry.translate(0,-.5,0)),this.position.copy(t),this.line=new Line(_lineGeometry,new LineBasicMaterial({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(_coneGeometry,new MeshBasicMaterial({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,i,o)}setDirection(e){.99999<e.y?this.quaternion.set(0,0,0,1):e.y<-.99999?this.quaternion.set(1,0,0,0):(_axis.set(e.z,0,-e.x).normalize(),e=Math.acos(e.y),this.quaternion.setFromAxisAngle(_axis,e))}setLength(e,t=.2*e,r=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}class AxesHelper extends LineSegments{constructor(e=1){e=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e];const t=new BufferGeometry;t.setAttribute("position",new Float32BufferAttribute(e,3)),t.setAttribute("color",new Float32BufferAttribute([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));e=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(t,e),this.type="AxesHelper"}}const _floatView=new Float32Array(1),_int32View=new Int32Array(_floatView.buffer),DataUtils={toHalfFloat:function(e){_floatView[0]=e;var t=_int32View[0];let r=t>>16&32768,n=t>>12&2047;e=t>>23&255;return e<103||(142<e?(r|=31744,r|=(255==e?0:1)&&8388607&t):e<113?(n|=2048,r|=(n>>114-e)+(n>>113-e&1)):(r|=e-112<<10|n>>1,r+=1&n)),r}},LOD_MIN=4,LOD_MAX=8,SIZE_MAX=Math.pow(2,LOD_MAX),EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582],TOTAL_LODS=LOD_MAX-LOD_MIN+1+EXTRA_LOD_SIGMA.length,MAX_SAMPLES=20,ENCODINGS={[LinearEncoding]:0,[sRGBEncoding]:1,[RGBEEncoding]:2,[RGBM7Encoding]:3,[RGBM16Encoding]:4,[RGBDEncoding]:5,[GammaEncoding]:6},backgroundMaterial=new MeshBasicMaterial({side:BackSide,depthWrite:!1,depthTest:!1}),backgroundBox=new Mesh(new BoxGeometry,backgroundMaterial),_flatCamera=new OrthographicCamera,{_lodPlanes,_sizeLods,_sigmas}=_createPlanes(),_clearColor=new Color;let _oldTarget=null;const PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI,_axisDirections=[new Vector3(1,1,1),new Vector3(-1,1,1),new Vector3(1,1,-1),new Vector3(-1,1,-1),new Vector3(0,PHI,INV_PHI),new Vector3(0,PHI,-INV_PHI),new Vector3(INV_PHI,0,PHI),new Vector3(-INV_PHI,0,PHI),new Vector3(PHI,INV_PHI,0),new Vector3(-PHI,INV_PHI,0)];function convertLinearToRGBE(e){var t=Math.max(e.r,e.g,e.b),t=Math.min(Math.max(Math.ceil(Math.log2(t)),-128),127);return e.multiplyScalar(Math.pow(2,-t)),(t+128)/255}class PMREMGenerator{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=_getBlurShader(MAX_SAMPLES),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,n=100){_oldTarget=this._renderer.getRenderTarget();var i=this._allocateTargets();return this._sceneToCubeUV(e,r,n,i),0<t&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=_getCubemapShader(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=_getEquirectShader(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let e=0;e<_lodPlanes.length;e++)_lodPlanes[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(_oldTarget),e.scissorTest=!1,_setViewport(e,0,0,e.width,e.height)}_fromTexture(e){_oldTarget=this._renderer.getRenderTarget();var t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){var t={magFilter:NearestFilter,minFilter:NearestFilter,generateMipmaps:!1,type:UnsignedByteType,format:RGBEFormat,encoding:_isLDR(e)?e.encoding:RGBEEncoding,depthBuffer:!1};const r=_createRenderTarget(t);return r.depthBuffer=!e,this._pingPongRenderTarget=_createRenderTarget(t),r}_compileMaterial(e){e=new Mesh(_lodPlanes[0],e);this._renderer.compile(e,_flatCamera)}_sceneToCubeUV(t,e,r,n){const i=new PerspectiveCamera(90,1,e,r);var o=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1];const s=this._renderer;var l=s.autoClear,c=s.outputEncoding,e=s.toneMapping;s.getClearColor(_clearColor),s.toneMapping=NoToneMapping,s.outputEncoding=LinearEncoding;let h=s.autoClear=!1;var u,r=t.background;r?r.isColor&&(backgroundMaterial.color.copy(r).convertSRGBToLinear(),t.background=null,u=convertLinearToRGBE(backgroundMaterial.color),backgroundMaterial.opacity=u,h=!0):(backgroundMaterial.color.copy(_clearColor).convertSRGBToLinear(),u=convertLinearToRGBE(backgroundMaterial.color),backgroundMaterial.opacity=u,h=!0);for(let e=0;e<6;e++){var A=e%3;0==A?(i.up.set(0,o[e],0),i.lookAt(a[e],0,0)):1==A?(i.up.set(0,0,o[e]),i.lookAt(0,a[e],0)):(i.up.set(0,o[e],0),i.lookAt(0,0,a[e])),_setViewport(n,A*SIZE_MAX,2<e?SIZE_MAX:0,SIZE_MAX,SIZE_MAX),s.setRenderTarget(n),h&&s.render(backgroundBox,i),s.render(t,i)}s.toneMapping=e,s.outputEncoding=c,s.autoClear=l}_textureToCubeUV(e,t){const r=this._renderer;e.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=_getCubemapShader()):null==this._equirectShader&&(this._equirectShader=_getEquirectShader());var n=e.isCubeTexture?this._cubemapShader:this._equirectShader,i=new Mesh(_lodPlanes[0],n);const o=n.uniforms;(o.envMap.value=e).isCubeTexture||o.texelSize.value.set(1/e.image.width,1/e.image.height),o.inputEncoding.value=ENCODINGS[e.encoding],o.outputEncoding.value=ENCODINGS[t.texture.encoding],_setViewport(t,0,0,3*SIZE_MAX,2*SIZE_MAX),r.setRenderTarget(t),r.render(i,_flatCamera)}_applyPMREM(t){const e=this._renderer;var r=e.autoClear;e.autoClear=!1;for(let e=1;e<TOTAL_LODS;e++){var n=Math.sqrt(_sigmas[e]*_sigmas[e]-_sigmas[e-1]*_sigmas[e-1]),i=_axisDirections[(e-1)%_axisDirections.length];this._blur(t,e-1,e,n,i)}e.autoClear=r}_blur(e,t,r,n,i){var o=this._pingPongRenderTarget;this._halfBlur(e,o,t,r,n,"latitudinal",i),this._halfBlur(o,e,r,r,n,"longitudinal",i)}_halfBlur(e,t,r,n,i,o,a){const s=this._renderer;var l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");var c=new Mesh(_lodPlanes[n],l);const h=l.uniforms;var l=_sizeLods[r]-1,l=isFinite(i)?Math.PI/(2*l):2*Math.PI/(2*MAX_SAMPLES-1),u=i/l,A=isFinite(i)?1+Math.floor(3*u):MAX_SAMPLES;A>MAX_SAMPLES&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${A} samples when the maximum is set to `+MAX_SAMPLES);const d=[];let p=0;for(let e=0;e<MAX_SAMPLES;++e){const f=e/u;var m=Math.exp(-f*f/2);d.push(m),0==e?p+=m:e<A&&(p+=2*m)}for(let e=0;e<d.length;e++)d[e]=d[e]/p;h.envMap.value=e.texture,h.samples.value=A,h.weights.value=d,h.latitudinal.value="latitudinal"===o,a&&(h.poleAxis.value=a),h.dTheta.value=l,h.mipInt.value=LOD_MAX-r,h.inputEncoding.value=ENCODINGS[e.texture.encoding],h.outputEncoding.value=ENCODINGS[e.texture.encoding];e=_sizeLods[n];const f=3*Math.max(0,SIZE_MAX-2*e);n=(0===n?0:2*SIZE_MAX)+2*e*(n>LOD_MAX-LOD_MIN?n-LOD_MAX+LOD_MIN:0);_setViewport(t,f,n,3*e,2*e),s.setRenderTarget(t),s.render(c,_flatCamera)}}function _isLDR(e){return void 0!==e&&e.type===UnsignedByteType&&(e.encoding===LinearEncoding||e.encoding===sRGBEncoding||e.encoding===GammaEncoding)}function _createPlanes(){const r=[],n=[],i=[];let o=LOD_MAX;for(let t=0;t<TOTAL_LODS;t++){var a=Math.pow(2,o);n.push(a);let e=1/a;t>LOD_MAX-LOD_MIN?e=EXTRA_LOD_SIGMA[t-LOD_MAX+LOD_MIN-1]:0==t&&(e=0),i.push(e);var s=1/(a-1),a=-s/2,s=1+s/2,l=[a,a,s,a,s,s,a,a,s,s,a,s];const u=new Float32Array(108),A=new Float32Array(72),d=new Float32Array(36);for(let e=0;e<6;e++){var c=e%3*2/3-1,h=2<e?0:-1;u.set([c,h,0,c+2/3,h,0,c+2/3,1+h,0,c,h,0,c+2/3,1+h,0,c,1+h,0],18*e),A.set(l,12*e);h=[e,e,e,e,e,e];d.set(h,6*e)}const p=new BufferGeometry;p.setAttribute("position",new BufferAttribute(u,3)),p.setAttribute("uv",new BufferAttribute(A,2)),p.setAttribute("faceIndex",new BufferAttribute(d,1)),r.push(p),o>LOD_MIN&&o--}return{_lodPlanes:r,_sizeLods:n,_sigmas:i}}function _createRenderTarget(e){const t=new WebGLRenderTarget(3*SIZE_MAX,3*SIZE_MAX,e);return t.texture.mapping=CubeUVReflectionMapping,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function _setViewport(e,t,r,n,i){e.viewport.set(t,r,n,i),e.scissor.set(t,r,n,i)}function _getBlurShader(e){var t=new Float32Array(e),r=new Vector3(0,1,0);return new RawShaderMaterial({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			${_getEncodings()}

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getEquirectShader(){var e=new Vector2(1,1);return new RawShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			${_getEncodings()}

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x += texelSize.x;
				vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.y += texelSize.y;
				vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCubemapShader(){return new RawShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			${_getEncodings()}

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;
				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCommonVertexShader(){return`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function _getEncodings(){return`

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	`}const LineStrip=0,LinePieces=1,NoColors=0,FaceColors=1,VertexColors=2;function MeshFaceMaterial(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e}function MultiMaterial(e=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,(e.materials=e).clone=function(){return e.slice()},e}function PointCloud(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Points(e,t)}function Particle(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Sprite(e)}function ParticleSystem(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Points(e,t)}function PointCloudMaterial(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(e)}function ParticleBasicMaterial(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(e)}function ParticleSystemMaterial(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(e)}function Vertex(e,t,r){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Vector3(e,t,r)}function DynamicBufferAttribute(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new BufferAttribute(e,t).setUsage(DynamicDrawUsage)}function Int8Attribute(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Int8BufferAttribute(e,t)}function Uint8Attribute(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Uint8BufferAttribute(e,t)}function Uint8ClampedAttribute(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Uint8ClampedBufferAttribute(e,t)}function Int16Attribute(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Int16BufferAttribute(e,t)}function Uint16Attribute(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Uint16BufferAttribute(e,t)}function Int32Attribute(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Int32BufferAttribute(e,t)}function Uint32Attribute(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Uint32BufferAttribute(e,t)}function Float32Attribute(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Float32BufferAttribute(e,t)}function Float64Attribute(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Float64BufferAttribute(e,t)}function AxisHelper(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new AxesHelper(e)}function BoundingBoxHelper(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new BoxHelper(e,t)}function EdgesHelper(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new LineSegments(new EdgesGeometry(e.geometry),new LineBasicMaterial({color:void 0!==t?t:16777215}))}function WireframeHelper(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new LineSegments(new WireframeGeometry(e.geometry),new LineBasicMaterial({color:void 0!==t?t:16777215}))}function XHRLoader(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new FileLoader(e)}function BinaryTextureLoader(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new DataTextureLoader(e)}function WebGLRenderTargetCube(e,t,r){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new WebGLCubeRenderTarget(e,r)}function CanvasRenderer(){console.error("THREE.CanvasRenderer has been removed")}function JSONLoader(){console.error("THREE.JSONLoader has been removed.")}Curve.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Curve.prototype),(e.prototype.constructor=e).prototype.getPoint=t,e},Path.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},SkeletonHelper.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Loader.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),LoaderUtils.extractUrlBase(e)},Loader.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Box2.prototype.center=function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},Box2.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Box2.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Box2.prototype.size=function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)},Box3.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Box3.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Box3.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Box3.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},Box3.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},Sphere.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Frustum.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},Line3.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},MathUtils.random16=function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},MathUtils.nearestPowerOfTwo=function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),MathUtils.floorPowerOfTwo(e)},MathUtils.nextPowerOfTwo=function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),MathUtils.ceilPowerOfTwo(e)},Matrix3.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Matrix3.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},Matrix3.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Matrix3.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},Matrix3.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Matrix3.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Matrix4.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},Matrix4.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Matrix4.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Vector3).setFromMatrixColumn(this,3)},Matrix4.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},Matrix4.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Matrix4.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Matrix4.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Matrix4.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Matrix4.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},Matrix4.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Matrix4.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Matrix4.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Matrix4.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Matrix4.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Matrix4.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Matrix4.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Matrix4.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Matrix4.prototype.makeFrustum=function(e,t,r,n,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,n,r,i,o)},Matrix4.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Plane.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Quaternion.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Quaternion.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Ray.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Ray.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},Ray.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},Triangle.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Triangle.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},Triangle.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},Triangle.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},Triangle.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},Triangle.barycoordFromPoint=function(e,t,r,n,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Triangle.getBarycoord(e,t,r,n,i)},Triangle.normal=function(e,t,r,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Triangle.getNormal(e,t,r,n)},Shape.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},Shape.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ExtrudeGeometry(this,e)},Shape.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ShapeGeometry(this,e)},Vector2.prototype.fromAttribute=function(e,t,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},Vector2.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Vector2.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Vector3.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},Vector3.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},Vector3.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},Vector3.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},Vector3.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},Vector3.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},Vector3.prototype.fromAttribute=function(e,t,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},Vector3.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Vector3.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Vector4.prototype.fromAttribute=function(e,t,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},Vector4.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Object3D.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},Object3D.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Object3D.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},Object3D.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Object3D.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(Object3D.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Mesh.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Mesh.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),TrianglesDrawMode},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),SkinnedMesh.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Curve.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),PerspectiveCamera.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Light.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(BufferAttribute.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===DynamicDrawUsage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(DynamicDrawUsage)}}}),BufferAttribute.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?DynamicDrawUsage:StaticDrawUsage),this},BufferAttribute.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},BufferAttribute.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},BufferGeometry.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},BufferGeometry.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new BufferAttribute(t,arguments[2])))},BufferGeometry.prototype.addDrawCall=function(e,t,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},BufferGeometry.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},BufferGeometry.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},BufferGeometry.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},BufferGeometry.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(BufferGeometry.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(InstancedBufferGeometry.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(e){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=e}}}),Object.defineProperties(Raycaster.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(e){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=e}}}),Object.defineProperties(InterleavedBuffer.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===DynamicDrawUsage},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),InterleavedBuffer.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?DynamicDrawUsage:StaticDrawUsage),this},InterleavedBuffer.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},ExtrudeGeometry.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},ExtrudeGeometry.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},ExtrudeGeometry.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Scene.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Uniform.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(Material.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Color}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===FlatShading}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(MeshPhysicalMaterial.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(e){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=e}}}),Object.defineProperties(ShaderMaterial.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),WebGLRenderer.prototype.clearTarget=function(e,t,r,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,r,n)},WebGLRenderer.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},WebGLRenderer.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},WebGLRenderer.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},WebGLRenderer.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},WebGLRenderer.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},WebGLRenderer.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},WebGLRenderer.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},WebGLRenderer.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},WebGLRenderer.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},WebGLRenderer.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},WebGLRenderer.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},WebGLRenderer.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},WebGLRenderer.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},WebGLRenderer.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},WebGLRenderer.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},WebGLRenderer.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},WebGLRenderer.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},WebGLRenderer.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},WebGLRenderer.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},WebGLRenderer.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},WebGLRenderer.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},WebGLRenderer.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},WebGLRenderer.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},WebGLRenderer.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?sRGBEncoding:LinearEncoding}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(WebGLShadowMap.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(WebGLRenderTarget.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Audio.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this,r=new AudioLoader;return r.load(e,function(e){t.setBuffer(e)}),this},AudioAnalyser.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},CubeCamera.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},CubeCamera.prototype.clear=function(e,t,r,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,r,n)},ImageUtils.crossOrigin=void 0,ImageUtils.loadTexture=function(e,t,r,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const i=new TextureLoader;i.setCrossOrigin(this.crossOrigin);const o=i.load(e,r,void 0,n);return t&&(o.mapping=t),o},ImageUtils.loadTextureCube=function(e,t,r,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const i=new CubeTextureLoader;i.setCrossOrigin(this.crossOrigin);const o=i.load(e,r,void 0,n);return t&&(o.mapping=t),o},ImageUtils.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},ImageUtils.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const SceneUtils={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function LensFlare(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=REVISION);var THREE=Object.freeze({__proto__:null,ACESFilmicToneMapping:ACESFilmicToneMapping,AddEquation:AddEquation,AddOperation:AddOperation,AdditiveAnimationBlendMode:AdditiveAnimationBlendMode,AdditiveBlending:AdditiveBlending,AlphaFormat:AlphaFormat,AlwaysDepth:AlwaysDepth,AlwaysStencilFunc:AlwaysStencilFunc,AmbientLight:AmbientLight,AmbientLightProbe:AmbientLightProbe,AnimationClip:AnimationClip,AnimationLoader:AnimationLoader,AnimationMixer:AnimationMixer,AnimationObjectGroup:AnimationObjectGroup,AnimationUtils:AnimationUtils,ArcCurve:ArcCurve,ArrayCamera:ArrayCamera,ArrowHelper:ArrowHelper,Audio:Audio,AudioAnalyser:AudioAnalyser,AudioContext:AudioContext,AudioListener:AudioListener,AudioLoader:AudioLoader,AxesHelper:AxesHelper,AxisHelper:AxisHelper,BackSide:BackSide,BasicDepthPacking:BasicDepthPacking,BasicShadowMap:BasicShadowMap,BinaryTextureLoader:BinaryTextureLoader,Bone:Bone,BooleanKeyframeTrack:BooleanKeyframeTrack,BoundingBoxHelper:BoundingBoxHelper,Box2:Box2,Box3:Box3,Box3Helper:Box3Helper,BoxBufferGeometry:BoxGeometry,BoxGeometry:BoxGeometry,BoxHelper:BoxHelper,BufferAttribute:BufferAttribute,BufferGeometry:BufferGeometry,BufferGeometryLoader:BufferGeometryLoader,ByteType:ByteType,Cache:Cache,Camera:Camera,CameraHelper:CameraHelper,CanvasRenderer:CanvasRenderer,CanvasTexture:CanvasTexture,CatmullRomCurve3:CatmullRomCurve3,CineonToneMapping:CineonToneMapping,CircleBufferGeometry:CircleGeometry,CircleGeometry:CircleGeometry,ClampToEdgeWrapping:ClampToEdgeWrapping,Clock:Clock,Color:Color,ColorKeyframeTrack:ColorKeyframeTrack,CompressedTexture:CompressedTexture,CompressedTextureLoader:CompressedTextureLoader,ConeBufferGeometry:ConeGeometry,ConeGeometry:ConeGeometry,CubeCamera:CubeCamera,CubeReflectionMapping:CubeReflectionMapping,CubeRefractionMapping:CubeRefractionMapping,CubeTexture:CubeTexture,CubeTextureLoader:CubeTextureLoader,CubeUVReflectionMapping:CubeUVReflectionMapping,CubeUVRefractionMapping:CubeUVRefractionMapping,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,CubicInterpolant:CubicInterpolant,CullFaceBack:CullFaceBack,CullFaceFront:CullFaceFront,CullFaceFrontBack:CullFaceFrontBack,CullFaceNone:CullFaceNone,Curve:Curve,CurvePath:CurvePath,CustomBlending:CustomBlending,CustomToneMapping:CustomToneMapping,CylinderBufferGeometry:CylinderGeometry,CylinderGeometry:CylinderGeometry,Cylindrical:Cylindrical,DataTexture:DataTexture,DataTexture2DArray:DataTexture2DArray,DataTexture3D:DataTexture3D,DataTextureLoader:DataTextureLoader,DataUtils:DataUtils,DecrementStencilOp:DecrementStencilOp,DecrementWrapStencilOp:DecrementWrapStencilOp,DefaultLoadingManager:DefaultLoadingManager,DepthFormat:DepthFormat,DepthStencilFormat:DepthStencilFormat,DepthTexture:DepthTexture,DirectionalLight:DirectionalLight,DirectionalLightHelper:DirectionalLightHelper,DiscreteInterpolant:DiscreteInterpolant,DodecahedronBufferGeometry:DodecahedronGeometry,DodecahedronGeometry:DodecahedronGeometry,DoubleSide:DoubleSide,DstAlphaFactor:DstAlphaFactor,DstColorFactor:DstColorFactor,DynamicBufferAttribute:DynamicBufferAttribute,DynamicCopyUsage:DynamicCopyUsage,DynamicDrawUsage:DynamicDrawUsage,DynamicReadUsage:DynamicReadUsage,EdgesGeometry:EdgesGeometry,EdgesHelper:EdgesHelper,EllipseCurve:EllipseCurve,EqualDepth:EqualDepth,EqualStencilFunc:EqualStencilFunc,EquirectangularReflectionMapping:EquirectangularReflectionMapping,EquirectangularRefractionMapping:EquirectangularRefractionMapping,Euler:Euler,EventDispatcher:EventDispatcher,ExtrudeBufferGeometry:ExtrudeGeometry,ExtrudeGeometry:ExtrudeGeometry,FaceColors:FaceColors,FileLoader:FileLoader,FlatShading:FlatShading,Float16BufferAttribute:Float16BufferAttribute,Float32Attribute:Float32Attribute,Float32BufferAttribute:Float32BufferAttribute,Float64Attribute:Float64Attribute,Float64BufferAttribute:Float64BufferAttribute,FloatType:FloatType,Fog:Fog,FogExp2:FogExp2,Font:Font,FontLoader:FontLoader,FrontSide:FrontSide,Frustum:Frustum,GLBufferAttribute:GLBufferAttribute,GLSL1:GLSL1,GLSL3:GLSL3,GammaEncoding:GammaEncoding,GreaterDepth:GreaterDepth,GreaterEqualDepth:GreaterEqualDepth,GreaterEqualStencilFunc:GreaterEqualStencilFunc,GreaterStencilFunc:GreaterStencilFunc,GridHelper:GridHelper,Group:Group,HalfFloatType:HalfFloatType,HemisphereLight:HemisphereLight,HemisphereLightHelper:HemisphereLightHelper,HemisphereLightProbe:HemisphereLightProbe,IcosahedronBufferGeometry:IcosahedronGeometry,IcosahedronGeometry:IcosahedronGeometry,ImageBitmapLoader:ImageBitmapLoader,ImageLoader:ImageLoader,ImageUtils:ImageUtils,ImmediateRenderObject:ImmediateRenderObject,IncrementStencilOp:IncrementStencilOp,IncrementWrapStencilOp:IncrementWrapStencilOp,InstancedBufferAttribute:InstancedBufferAttribute,InstancedBufferGeometry:InstancedBufferGeometry,InstancedInterleavedBuffer:InstancedInterleavedBuffer,InstancedMesh:InstancedMesh,Int16Attribute:Int16Attribute,Int16BufferAttribute:Int16BufferAttribute,Int32Attribute:Int32Attribute,Int32BufferAttribute:Int32BufferAttribute,Int8Attribute:Int8Attribute,Int8BufferAttribute:Int8BufferAttribute,IntType:IntType,InterleavedBuffer:InterleavedBuffer,InterleavedBufferAttribute:InterleavedBufferAttribute,Interpolant:Interpolant,InterpolateDiscrete:InterpolateDiscrete,InterpolateLinear:InterpolateLinear,InterpolateSmooth:InterpolateSmooth,InvertStencilOp:InvertStencilOp,JSONLoader:JSONLoader,KeepStencilOp:KeepStencilOp,KeyframeTrack:KeyframeTrack,LOD:LOD,LatheBufferGeometry:LatheGeometry,LatheGeometry:LatheGeometry,Layers:Layers,LensFlare:LensFlare,LessDepth:LessDepth,LessEqualDepth:LessEqualDepth,LessEqualStencilFunc:LessEqualStencilFunc,LessStencilFunc:LessStencilFunc,Light:Light,LightProbe:LightProbe,Line:Line,Line3:Line3,LineBasicMaterial:LineBasicMaterial,LineCurve:LineCurve,LineCurve3:LineCurve3,LineDashedMaterial:LineDashedMaterial,LineLoop:LineLoop,LinePieces:LinePieces,LineSegments:LineSegments,LineStrip:LineStrip,LinearEncoding:LinearEncoding,LinearFilter:LinearFilter,LinearInterpolant:LinearInterpolant,LinearMipMapLinearFilter:LinearMipMapLinearFilter,LinearMipMapNearestFilter:LinearMipMapNearestFilter,LinearMipmapLinearFilter:LinearMipmapLinearFilter,LinearMipmapNearestFilter:LinearMipmapNearestFilter,LinearToneMapping:LinearToneMapping,Loader:Loader,LoaderUtils:LoaderUtils,LoadingManager:LoadingManager,LogLuvEncoding:LogLuvEncoding,LoopOnce:LoopOnce,LoopPingPong:LoopPingPong,LoopRepeat:LoopRepeat,LuminanceAlphaFormat:LuminanceAlphaFormat,LuminanceFormat:LuminanceFormat,MOUSE:MOUSE,Material:Material,MaterialLoader:MaterialLoader,Math:MathUtils,MathUtils:MathUtils,Matrix3:Matrix3,Matrix4:Matrix4,MaxEquation:MaxEquation,Mesh:Mesh,MeshBasicMaterial:MeshBasicMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshFaceMaterial:MeshFaceMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshMatcapMaterial:MeshMatcapMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshToonMaterial:MeshToonMaterial,MinEquation:MinEquation,MirroredRepeatWrapping:MirroredRepeatWrapping,MixOperation:MixOperation,MultiMaterial:MultiMaterial,MultiplyBlending:MultiplyBlending,MultiplyOperation:MultiplyOperation,NearestFilter:NearestFilter,NearestMipMapLinearFilter:NearestMipMapLinearFilter,NearestMipMapNearestFilter:NearestMipMapNearestFilter,NearestMipmapLinearFilter:NearestMipmapLinearFilter,NearestMipmapNearestFilter:NearestMipmapNearestFilter,NeverDepth:NeverDepth,NeverStencilFunc:NeverStencilFunc,NoBlending:NoBlending,NoColors:NoColors,NoToneMapping:NoToneMapping,NormalAnimationBlendMode:NormalAnimationBlendMode,NormalBlending:NormalBlending,NotEqualDepth:NotEqualDepth,NotEqualStencilFunc:NotEqualStencilFunc,NumberKeyframeTrack:NumberKeyframeTrack,Object3D:Object3D,ObjectLoader:ObjectLoader,ObjectSpaceNormalMap:ObjectSpaceNormalMap,OctahedronBufferGeometry:OctahedronGeometry,OctahedronGeometry:OctahedronGeometry,OneFactor:OneFactor,OneMinusDstAlphaFactor:OneMinusDstAlphaFactor,OneMinusDstColorFactor:OneMinusDstColorFactor,OneMinusSrcAlphaFactor:OneMinusSrcAlphaFactor,OneMinusSrcColorFactor:OneMinusSrcColorFactor,OrthographicCamera:OrthographicCamera,PCFShadowMap:PCFShadowMap,PCFSoftShadowMap:PCFSoftShadowMap,PMREMGenerator:PMREMGenerator,ParametricBufferGeometry:ParametricGeometry,ParametricGeometry:ParametricGeometry,Particle:Particle,ParticleBasicMaterial:ParticleBasicMaterial,ParticleSystem:ParticleSystem,ParticleSystemMaterial:ParticleSystemMaterial,Path:Path,PerspectiveCamera:PerspectiveCamera,Plane:Plane,PlaneBufferGeometry:PlaneGeometry,PlaneGeometry:PlaneGeometry,PlaneHelper:PlaneHelper,PointCloud:PointCloud,PointCloudMaterial:PointCloudMaterial,PointLight:PointLight,PointLightHelper:PointLightHelper,Points:Points,PointsMaterial:PointsMaterial,PolarGridHelper:PolarGridHelper,PolyhedronBufferGeometry:PolyhedronGeometry,PolyhedronGeometry:PolyhedronGeometry,PositionalAudio:PositionalAudio,PropertyBinding:PropertyBinding,PropertyMixer:PropertyMixer,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,Quaternion:Quaternion,QuaternionKeyframeTrack:QuaternionKeyframeTrack,QuaternionLinearInterpolant:QuaternionLinearInterpolant,REVISION:REVISION,RGBADepthPacking:RGBADepthPacking,RGBAFormat:RGBAFormat,RGBAIntegerFormat:RGBAIntegerFormat,RGBA_ASTC_10x10_Format:RGBA_ASTC_10x10_Format,RGBA_ASTC_10x5_Format:RGBA_ASTC_10x5_Format,RGBA_ASTC_10x6_Format:RGBA_ASTC_10x6_Format,RGBA_ASTC_10x8_Format:RGBA_ASTC_10x8_Format,RGBA_ASTC_12x10_Format:RGBA_ASTC_12x10_Format,RGBA_ASTC_12x12_Format:RGBA_ASTC_12x12_Format,RGBA_ASTC_4x4_Format:RGBA_ASTC_4x4_Format,RGBA_ASTC_5x4_Format:RGBA_ASTC_5x4_Format,RGBA_ASTC_5x5_Format:RGBA_ASTC_5x5_Format,RGBA_ASTC_6x5_Format:RGBA_ASTC_6x5_Format,RGBA_ASTC_6x6_Format:RGBA_ASTC_6x6_Format,RGBA_ASTC_8x5_Format:RGBA_ASTC_8x5_Format,RGBA_ASTC_8x6_Format:RGBA_ASTC_8x6_Format,RGBA_ASTC_8x8_Format:RGBA_ASTC_8x8_Format,RGBA_BPTC_Format:RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:RGBA_ETC2_EAC_Format,RGBA_PVRTC_2BPPV1_Format:RGBA_PVRTC_2BPPV1_Format,RGBA_PVRTC_4BPPV1_Format:RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format:RGBA_S3TC_DXT1_Format,RGBA_S3TC_DXT3_Format:RGBA_S3TC_DXT3_Format,RGBA_S3TC_DXT5_Format:RGBA_S3TC_DXT5_Format,RGBDEncoding:RGBDEncoding,RGBEEncoding:RGBEEncoding,RGBEFormat:RGBEFormat,RGBFormat:RGBFormat,RGBIntegerFormat:RGBIntegerFormat,RGBM16Encoding:RGBM16Encoding,RGBM7Encoding:RGBM7Encoding,RGB_ETC1_Format:RGB_ETC1_Format,RGB_ETC2_Format:RGB_ETC2_Format,RGB_PVRTC_2BPPV1_Format:RGB_PVRTC_2BPPV1_Format,RGB_PVRTC_4BPPV1_Format:RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format:RGB_S3TC_DXT1_Format,RGFormat:RGFormat,RGIntegerFormat:RGIntegerFormat,RawShaderMaterial:RawShaderMaterial,Ray:Ray,Raycaster:Raycaster,RectAreaLight:RectAreaLight,RedFormat:RedFormat,RedIntegerFormat:RedIntegerFormat,ReinhardToneMapping:ReinhardToneMapping,RepeatWrapping:RepeatWrapping,ReplaceStencilOp:ReplaceStencilOp,ReverseSubtractEquation:ReverseSubtractEquation,RingBufferGeometry:RingGeometry,RingGeometry:RingGeometry,SRGB8_ALPHA8_ASTC_10x10_Format:SRGB8_ALPHA8_ASTC_10x10_Format,SRGB8_ALPHA8_ASTC_10x5_Format:SRGB8_ALPHA8_ASTC_10x5_Format,SRGB8_ALPHA8_ASTC_10x6_Format:SRGB8_ALPHA8_ASTC_10x6_Format,SRGB8_ALPHA8_ASTC_10x8_Format:SRGB8_ALPHA8_ASTC_10x8_Format,SRGB8_ALPHA8_ASTC_12x10_Format:SRGB8_ALPHA8_ASTC_12x10_Format,SRGB8_ALPHA8_ASTC_12x12_Format:SRGB8_ALPHA8_ASTC_12x12_Format,SRGB8_ALPHA8_ASTC_4x4_Format:SRGB8_ALPHA8_ASTC_4x4_Format,SRGB8_ALPHA8_ASTC_5x4_Format:SRGB8_ALPHA8_ASTC_5x4_Format,SRGB8_ALPHA8_ASTC_5x5_Format:SRGB8_ALPHA8_ASTC_5x5_Format,SRGB8_ALPHA8_ASTC_6x5_Format:SRGB8_ALPHA8_ASTC_6x5_Format,SRGB8_ALPHA8_ASTC_6x6_Format:SRGB8_ALPHA8_ASTC_6x6_Format,SRGB8_ALPHA8_ASTC_8x5_Format:SRGB8_ALPHA8_ASTC_8x5_Format,SRGB8_ALPHA8_ASTC_8x6_Format:SRGB8_ALPHA8_ASTC_8x6_Format,SRGB8_ALPHA8_ASTC_8x8_Format:SRGB8_ALPHA8_ASTC_8x8_Format,Scene:Scene,SceneUtils:SceneUtils,ShaderChunk:ShaderChunk,ShaderLib:ShaderLib,ShaderMaterial:ShaderMaterial,ShadowMaterial:ShadowMaterial,Shape:Shape,ShapeBufferGeometry:ShapeGeometry,ShapeGeometry:ShapeGeometry,ShapePath:ShapePath,ShapeUtils:ShapeUtils,ShortType:ShortType,Skeleton:Skeleton,SkeletonHelper:SkeletonHelper,SkinnedMesh:SkinnedMesh,SmoothShading:SmoothShading,Sphere:Sphere,SphereBufferGeometry:SphereGeometry,SphereGeometry:SphereGeometry,Spherical:Spherical,SphericalHarmonics3:SphericalHarmonics3,SplineCurve:SplineCurve,SpotLight:SpotLight,SpotLightHelper:SpotLightHelper,Sprite:Sprite,SpriteMaterial:SpriteMaterial,SrcAlphaFactor:SrcAlphaFactor,SrcAlphaSaturateFactor:SrcAlphaSaturateFactor,SrcColorFactor:SrcColorFactor,StaticCopyUsage:StaticCopyUsage,StaticDrawUsage:StaticDrawUsage,StaticReadUsage:StaticReadUsage,StereoCamera:StereoCamera,StreamCopyUsage:StreamCopyUsage,StreamDrawUsage:StreamDrawUsage,StreamReadUsage:StreamReadUsage,StringKeyframeTrack:StringKeyframeTrack,SubtractEquation:SubtractEquation,SubtractiveBlending:SubtractiveBlending,TOUCH:TOUCH,TangentSpaceNormalMap:TangentSpaceNormalMap,TetrahedronBufferGeometry:TetrahedronGeometry,TetrahedronGeometry:TetrahedronGeometry,TextBufferGeometry:TextGeometry,TextGeometry:TextGeometry,Texture:Texture,TextureLoader:TextureLoader,TorusBufferGeometry:TorusGeometry,TorusGeometry:TorusGeometry,TorusKnotBufferGeometry:TorusKnotGeometry,TorusKnotGeometry:TorusKnotGeometry,Triangle:Triangle,TriangleFanDrawMode:TriangleFanDrawMode,TriangleStripDrawMode:TriangleStripDrawMode,TrianglesDrawMode:TrianglesDrawMode,TubeBufferGeometry:TubeGeometry,TubeGeometry:TubeGeometry,UVMapping:UVMapping,Uint16Attribute:Uint16Attribute,Uint16BufferAttribute:Uint16BufferAttribute,Uint32Attribute:Uint32Attribute,Uint32BufferAttribute:Uint32BufferAttribute,Uint8Attribute:Uint8Attribute,Uint8BufferAttribute:Uint8BufferAttribute,Uint8ClampedAttribute:Uint8ClampedAttribute,Uint8ClampedBufferAttribute:Uint8ClampedBufferAttribute,Uniform:Uniform,UniformsLib:UniformsLib,UniformsUtils:UniformsUtils,UnsignedByteType:UnsignedByteType,UnsignedInt248Type:UnsignedInt248Type,UnsignedIntType:UnsignedIntType,UnsignedShort4444Type:UnsignedShort4444Type,UnsignedShort5551Type:UnsignedShort5551Type,UnsignedShort565Type:UnsignedShort565Type,UnsignedShortType:UnsignedShortType,VSMShadowMap:VSMShadowMap,Vector2:Vector2,Vector3:Vector3,Vector4:Vector4,VectorKeyframeTrack:VectorKeyframeTrack,Vertex:Vertex,VertexColors:VertexColors,VideoTexture:VideoTexture,WebGL1Renderer:WebGL1Renderer,WebGLCubeRenderTarget:WebGLCubeRenderTarget,WebGLMultisampleRenderTarget:WebGLMultisampleRenderTarget,WebGLRenderTarget:WebGLRenderTarget,WebGLRenderTargetCube:WebGLRenderTargetCube,WebGLRenderer:WebGLRenderer,WebGLUtils:WebGLUtils,WireframeGeometry:WireframeGeometry,WireframeHelper:WireframeHelper,WrapAroundEnding:WrapAroundEnding,XHRLoader:XHRLoader,ZeroCurvatureEnding:ZeroCurvatureEnding,ZeroFactor:ZeroFactor,ZeroSlopeEnding:ZeroSlopeEnding,ZeroStencilOp:ZeroStencilOp,sRGBEncoding:sRGBEncoding});const pause=t=>new Promise(e=>setTimeout(e,1e3*t)),sum=e=>e.reduce((e,t)=>e+t,0),eqArr=(e,t)=>{if(e.length!==t.length)return!1;for(const r=0,n=e.length;r<n;r++)if(e[r]instanceof Array&&t[r]instanceof Array){if(!eqArr(e[r],t[r]))return!1}else if(e[r]!==t[r])return!1;return!0},omit=(e,t)=>e.reduce((e,t)=>{const{[t]:r,...n}=e;return n},t),pick=(e,r)=>e.reduce((e,t)=>t in r?Object.assign(e,{[t]:r[t]}):e,{}),unique=(e,t,r)=>r.indexOf(e)===t,makeImage=(e,t,r)=>{const n=new Image(128,128);return n.src=r,n},copyProps=function({from:e,into:t,required:r=[],optional:n=[]}){const i=[];for(var o of r||[]){if(void 0===e[o])throw new Error(`Missing property "${o}"`);t[o]=e[o],i.push(o)}for(var a of n||[])void 0!==e[a]&&(t[a]=e[a],i.push(a));return i},UUIDRegex=new RegExp(/^(?:\{[0-9a-fA-F]{8}-(?:[0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}\}|[0-9a-fA-F]{8}-(?:[0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12})$/i),URLRegex=new RegExp(/[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)?/gi),semverRegex=new RegExp(/ ^([0-9]+)\.([0-9]+)\.([0-9]+)(?:-([0-9A-Za-z-]+(?:\.[0-9A-Za-z-]+)*))?(?:\+[0-9A-Za-z-]+)?$\b/gi),getAssigningComponent=e=>e.positionedMesh||e.positionedMeshGroup||e.blockInstance;function isConstructor(e){return!!e.prototype&&!!e.prototype.constructor.name}const checkPropTypes=function(r,n={},i={}){const o=(e,t,r)=>{let n=null;if("object"==typeof r&&r.msg&&(n=r.msg||null,r=r.test),"string"==typeof r){if(typeof t!==r)throw new Error(`Property [${e}] is a ${typeof t} not a ${r}. `+(n||""))}else if(r instanceof RegExp){if(!t.match(r))throw new Error(`Property [${e}] format is incorrect. `+(n||""))}else if("function"!=typeof r||isConstructor(r)){if("function"!=typeof r)throw console.error(r),new Error("Unknown check type ");if(!(t instanceof r))throw new Error(`Property [${e}] is a ${t.constructor.name} not a ${r.name||r}. `+(n||""))}else{t=r(t);if(!0!==t)throw new Error(`Invalid property [${e}]. ${"string"==typeof t?t:""} `+(n||"a "+n))}};for(let[t,e]of Object.entries(n)){const a=r[t];if(void 0===a)throw new Error(`Required property [${t}] is undefined in keys [${Object.keys(r).join(", ")}]`);Array.isArray(e)?e.forEach(e=>o(t,a,e)):o(t,a,e)}for(let[t,e]of Object.entries(i)){const s=r[t];void 0!==s&&(Array.isArray(e)?e.forEach(e=>o(t,s,e)):o(t,s,e))}return!0},buildMateMap=({connectionTypes:e,connectorTypes:r,connectors:n})=>{const i=new Map;for(let t of r){const a={};a.connectionTypes=e.filter(e=>e.settings.connectorTypes.includes(t)),a.connectorTypes=[];for(var o of a.connectionTypes){o=o.settings.connectorTypes,o=o[0]===t?o[1]:o[0];-1===a.connectorTypes.indexOf(o)&&a.connectorTypes.push(o)}a.connectors=n.filter(e=>a.connectorTypes.includes(e.type)),i.set(t,a)}return i},ucFirst=e=>e.charAt(0).toUpperCase()+e.slice(1);var getRandomValues="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),rnds8=new Uint8Array(16);function rng(){if(!getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}var REGEX=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function validate(e){return"string"==typeof e&&REGEX.test(e)}for(var byteToHex=[],i=0;i<256;++i)byteToHex.push((i+256).toString(16).substr(1));function stringify(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,t=(byteToHex[e[t+0]]+byteToHex[e[t+1]]+byteToHex[e[t+2]]+byteToHex[e[t+3]]+"-"+byteToHex[e[t+4]]+byteToHex[e[t+5]]+"-"+byteToHex[e[t+6]]+byteToHex[e[t+7]]+"-"+byteToHex[e[t+8]]+byteToHex[e[t+9]]+"-"+byteToHex[e[t+10]]+byteToHex[e[t+11]]+byteToHex[e[t+12]]+byteToHex[e[t+13]]+byteToHex[e[t+14]]+byteToHex[e[t+15]]).toLowerCase();if(!validate(t))throw TypeError("Stringified UUID is invalid");return t}function parse(e){if(!validate(e))throw TypeError("Invalid UUID");var t,r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r}function stringToBytes(e){e=unescape(encodeURIComponent(e));for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}var DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",URL$1="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function v35(e,a,s){function t(e,t,r,n){if("string"==typeof e&&(e=stringToBytes(e)),16!==(t="string"==typeof t?parse(t):t).length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var i=new Uint8Array(16+e.length);if(i.set(t),i.set(e,t.length),(i=s(i))[6]=15&i[6]|a,i[8]=63&i[8]|128,r){n=n||0;for(var o=0;o<16;++o)r[n+o]=i[o];return r}return stringify(i)}try{t.name=e}catch(e){}return t.DNS=DNS,t.URL=URL$1,t}function md5(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return md5ToHexEncodedArray(wordsToMd5(bytesToWords(e),8*e.length))}function md5ToHexEncodedArray(e){for(var t=[],r=32*e.length,n="0123456789abcdef",i=0;i<r;i+=8){var o=e[i>>5]>>>i%32&255,o=parseInt(n.charAt(o>>>4&15)+n.charAt(15&o),16);t.push(o)}return t}function getOutputLength(e){return 14+(e+64>>>9<<4)+1}function wordsToMd5(e,t){e[t>>5]|=128<<t%32,e[getOutputLength(t)-1]=t;for(var r=1732584193,n=-271733879,i=-1732584194,o=271733878,a=0;a<e.length;a+=16){var s=r,l=n,c=i,h=o,r=md5ff(r,n,i,o,e[a],7,-680876936),o=md5ff(o,r,n,i,e[a+1],12,-389564586),i=md5ff(i,o,r,n,e[a+2],17,606105819),n=md5ff(n,i,o,r,e[a+3],22,-1044525330);r=md5ff(r,n,i,o,e[a+4],7,-176418897),o=md5ff(o,r,n,i,e[a+5],12,1200080426),i=md5ff(i,o,r,n,e[a+6],17,-1473231341),n=md5ff(n,i,o,r,e[a+7],22,-45705983),r=md5ff(r,n,i,o,e[a+8],7,1770035416),o=md5ff(o,r,n,i,e[a+9],12,-1958414417),i=md5ff(i,o,r,n,e[a+10],17,-42063),n=md5ff(n,i,o,r,e[a+11],22,-1990404162),r=md5ff(r,n,i,o,e[a+12],7,1804603682),o=md5ff(o,r,n,i,e[a+13],12,-40341101),i=md5ff(i,o,r,n,e[a+14],17,-1502002290),r=md5gg(r,n=md5ff(n,i,o,r,e[a+15],22,1236535329),i,o,e[a+1],5,-165796510),o=md5gg(o,r,n,i,e[a+6],9,-1069501632),i=md5gg(i,o,r,n,e[a+11],14,643717713),n=md5gg(n,i,o,r,e[a],20,-373897302),r=md5gg(r,n,i,o,e[a+5],5,-701558691),o=md5gg(o,r,n,i,e[a+10],9,38016083),i=md5gg(i,o,r,n,e[a+15],14,-660478335),n=md5gg(n,i,o,r,e[a+4],20,-405537848),r=md5gg(r,n,i,o,e[a+9],5,568446438),o=md5gg(o,r,n,i,e[a+14],9,-1019803690),i=md5gg(i,o,r,n,e[a+3],14,-187363961),n=md5gg(n,i,o,r,e[a+8],20,1163531501),r=md5gg(r,n,i,o,e[a+13],5,-1444681467),o=md5gg(o,r,n,i,e[a+2],9,-51403784),i=md5gg(i,o,r,n,e[a+7],14,1735328473),r=md5hh(r,n=md5gg(n,i,o,r,e[a+12],20,-1926607734),i,o,e[a+5],4,-378558),o=md5hh(o,r,n,i,e[a+8],11,-2022574463),i=md5hh(i,o,r,n,e[a+11],16,1839030562),n=md5hh(n,i,o,r,e[a+14],23,-35309556),r=md5hh(r,n,i,o,e[a+1],4,-1530992060),o=md5hh(o,r,n,i,e[a+4],11,1272893353),i=md5hh(i,o,r,n,e[a+7],16,-155497632),n=md5hh(n,i,o,r,e[a+10],23,-1094730640),r=md5hh(r,n,i,o,e[a+13],4,681279174),o=md5hh(o,r,n,i,e[a],11,-358537222),i=md5hh(i,o,r,n,e[a+3],16,-722521979),n=md5hh(n,i,o,r,e[a+6],23,76029189),r=md5hh(r,n,i,o,e[a+9],4,-640364487),o=md5hh(o,r,n,i,e[a+12],11,-421815835),i=md5hh(i,o,r,n,e[a+15],16,530742520),r=md5ii(r,n=md5hh(n,i,o,r,e[a+2],23,-995338651),i,o,e[a],6,-198630844),o=md5ii(o,r,n,i,e[a+7],10,1126891415),i=md5ii(i,o,r,n,e[a+14],15,-1416354905),n=md5ii(n,i,o,r,e[a+5],21,-57434055),r=md5ii(r,n,i,o,e[a+12],6,1700485571),o=md5ii(o,r,n,i,e[a+3],10,-1894986606),i=md5ii(i,o,r,n,e[a+10],15,-1051523),n=md5ii(n,i,o,r,e[a+1],21,-2054922799),r=md5ii(r,n,i,o,e[a+8],6,1873313359),o=md5ii(o,r,n,i,e[a+15],10,-30611744),i=md5ii(i,o,r,n,e[a+6],15,-1560198380),n=md5ii(n,i,o,r,e[a+13],21,1309151649),r=md5ii(r,n,i,o,e[a+4],6,-145523070),o=md5ii(o,r,n,i,e[a+11],10,-1120210379),i=md5ii(i,o,r,n,e[a+2],15,718787259),n=md5ii(n,i,o,r,e[a+9],21,-343485551),r=safeAdd(r,s),n=safeAdd(n,l),i=safeAdd(i,c),o=safeAdd(o,h)}return[r,n,i,o]}function bytesToWords(e){if(0===e.length)return[];for(var t=8*e.length,r=new Uint32Array(getOutputLength(t)),n=0;n<t;n+=8)r[n>>5]|=(255&e[n/8])<<n%32;return r}function safeAdd(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function bitRotateLeft(e,t){return e<<t|e>>>32-t}function md5cmn(e,t,r,n,i,o){return safeAdd(bitRotateLeft(safeAdd(safeAdd(t,e),safeAdd(n,o)),i),r)}function md5ff(e,t,r,n,i,o,a){return md5cmn(t&r|~t&n,e,t,i,o,a)}function md5gg(e,t,r,n,i,o,a){return md5cmn(t&n|r&~n,e,t,i,o,a)}function md5hh(e,t,r,n,i,o,a){return md5cmn(t^r^n,e,t,i,o,a)}function md5ii(e,t,r,n,i,o,a){return md5cmn(r^(t|~n),e,t,i,o,a)}var v3=v35("v3",48,md5);function v4(e,t,r){var n=(e=e||{}).random||(e.rng||rng)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var i=0;i<16;++i)t[r+i]=n[i];return t}return stringify(n)}function f(e,t,r,n){switch(e){case 0:return t&r^~t&n;case 1:return t^r^n;case 2:return t&r^t&n^r&n;case 3:return t^r^n}}function ROTL(e,t){return e<<t|e>>>32-t}function sha1(e){var t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var n=unescape(encodeURIComponent(e));e=[];for(var i=0;i<n.length;++i)e.push(n.charCodeAt(i))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var o=e.length/4+2,a=Math.ceil(o/16),s=new Array(a),l=0;l<a;++l){for(var c=new Uint32Array(16),h=0;h<16;++h)c[h]=e[64*l+4*h]<<24|e[64*l+4*h+1]<<16|e[64*l+4*h+2]<<8|e[64*l+4*h+3];s[l]=c}s[a-1][14]=8*(e.length-1)/Math.pow(2,32),s[a-1][14]=Math.floor(s[a-1][14]),s[a-1][15]=8*(e.length-1)&4294967295;for(var u=0;u<a;++u){for(var A=new Uint32Array(80),d=0;d<16;++d)A[d]=s[u][d];for(var p=16;p<80;++p)A[p]=ROTL(A[p-3]^A[p-8]^A[p-14]^A[p-16],1);for(var m=r[0],g=r[1],v=r[2],_=r[3],y=r[4],w=0;w<80;++w)var x=Math.floor(w/20),x=ROTL(m,5)+f(x,g,v,_)+y+t[x]+A[w]>>>0,y=_,_=v,v=ROTL(g,30)>>>0,g=m,m=x;r[0]=r[0]+m>>>0,r[1]=r[1]+g>>>0,r[2]=r[2]+v>>>0,r[3]=r[3]+_>>>0,r[4]=r[4]+y>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]}var v5=v35("v5",80,sha1);class EventEmitter{constructor(){this._events={}}addEvent(e){this._events[e]||(this._events[e]={})}on(e,t,r){this._events[e]||(this._events[e]={});r=r||v4();this._events[e][r]=t,this._events.listenerChange&&this.emit("listenerChange",{event:e,listenerObject:this._events[e]})}once(t,r){const n=v4();this.on(t,(...e)=>{this.removeListener(t,n),r(...e)},n)}hasListener(e,t){return!!this._events&&(this._events[e]&&this._events[e][t])}removeListener(e,t){if(!this._events[e])throw new Error(`Can't remove listener for unknown event "${e}".`);if(!this._events[e][t])throw new Error(`Can't remove ${e} listener with unknown id "${t}".`);delete this._events[e][t],this._events.listenerChange&&this.emit("listenerChange",{event:e,listenerObject:this._events[e]})}emit(e,t){return this._events[e]||(this._events[e]={}),Promise.all(Object.values(this._events[e]).map(e=>e(t)))}removeAllListeners(){for(var[e,t]of Object.entries(this._events))for(var[r,n]of Object.entries(t))this.removeListener(e,r)}}class InformationSource extends EventEmitter{constructor(r,e={}){if(!(r instanceof Reporter))throw new Error("No reporter");checkPropTypes(e,{},{id:UUIDRegex,name:"string"}),super(),this.id=e.id||v4(),this.slug=e.slug||this.id.substr(0,4),this.name=e.name||"",this.label=this.constructor.name+" "+(this.name||this.slug),this._reporter=r,this.report=({msg:e,level:t="debug"})=>r.report({msg:e,level:t,time:(new Date).getTime(),source:{id:this.id,name:this.name,type:this.constructor.name}})}static uuid(){return v4()}}class Logger extends InformationSource{constructor(e,t){super(t),this.fromLevel=e,this.fromLevelNum=Reporter.syslogLevelsIndexed[e],this._reporter=t}log({}){}}class Reporter{constructor(){this._actions={},this._loggers=[],this._rebuildActionDictionary()}_rebuildActionDictionary(){this._actions=Reporter.logLevels.reduce((e,t)=>Object.assign(e,{[t]:[]}),{});for(var t of this._loggers)for(let e=0;e<=7;e+=1)e<=t.fromLevelNum&&this._actions[Reporter.logLevels[e]].push(t)}addLogger(e){this._loggers.push(e),this._rebuildActionDictionary()}async report({msg:t,level:r="debug",source:n}){return Promise.all(this._actions[r].map(e=>e.log({msg:t,level:r,source:n})))}}Reporter.logLevels=["emergency","alert","critical","error","warning","notice","info","debug"],Reporter.syslogLevelsIndexed={emergency:0,alert:1,critical:2,error:3,warning:4,notice:5,info:6,debug:8};class ServerConnection extends InformationSource{constructor(e,t){if(!["ws:","wss:"].includes(t.url.protocol))throw new Error("URL must be of a websocket server");super(e,{...t,name:t.url.hostname}),this.reporter=e,this.reconnectTime=t.reconnectTime||30,this.url=t.url,this._connected=!1,this._socket=null,this.autoReconnectFlag=0<this.reconnectTime,this._requestRegister={},this._connectionChangeHandlers=[],this._connect()}get connected(){return this._connected}_notificationHandler(e){this.report({level:"notice",msg:"Unhandled notification "+e.meta.type})}set notificationHandler(e){if("function"!=typeof e)throw new Error("Notification handler must be a function");this._notificationHandler=e}async _connect(){const t=this,r=function(e){return t.report({msg:"Closed",level:"notice"}),t._socket.removeEventListener("close",r),t._socket.removeEventListener("message",n),t._socket=null,t._connected=!1,t.emit("connection-changed",!1),t._connect()},n=this._handleMessage.bind(this);for(;!0!==this._connected&&!0===this.autoReconnectFlag;){let e=null;try{e=await ServerConnection.openWebsocket(this.url)}catch(e){this.report({msg:"Failed"})}if(e){this.report({msg:"Opened",level:"notice"}),this._socket=e,this._connected=!0,this._socket.addEventListener("close",r),this._socket.addEventListener("message",n),this.emit("connection-changed",!0);break}0<this.reconnectTime&&await pause(this.reconnectTime)}}static openWebsocket(e){let t=new WebSocket(e.href),r=null,n=null;e=new Promise(function(e,t){r=e,n=t});function i(){t.removeEventListener("open",o),t.removeEventListener("close",a),t.removeEventListener("error",a)}const o=function(e){i(),r(t)},a=function(){i();try{t.close()}catch(e){}t=null,n(null)};return t.addEventListener("open",o),t.addEventListener("close",a),t.addEventListener("error",a),e}_handleMessage(t){let e={};try{e=JSON.parse(t.data)}catch(e){return void this.report({level:"error",msg:"Could not parse msg as JSON: "+t.message})}e.meta&&e.meta.id?e.meta.type?this._notificationHandler(e):e.errors?(console.error("Error response from server:",e),this._requestRegister[e.meta.id].reject(e.errors[0].detail)):this._requestRegister[e.meta.id]?(this._requestRegister[e.meta.id].resolve(e),delete this._requestRegister[e.meta.id]):this.report({level:"notice",msg:"Unhandled response "+JSON.stringify(t.message)}):this.report({level:"error",msg:"Malformed message: "+t.message})}request({method:e,endpoint:t,data:r}){if(!0!==this._connected)throw new Error("ServerConnection not available (yet)");const n=v4();var i=new Promise((e,t)=>this._requestRegister[n]={resolve:e,reject:t});return this._socket.send(JSON.stringify({meta:{id:n,method:e,endpoint:t},data:r})),i}}class ConsoleLogger extends Logger{constructor(e,t){super(e,t)}log(e){var t=e.source.name?e.source.type+" "+e.source.name:e.source.type+" "+(e.source.id||"xxxx").substr(0,4);return console[ConsoleLogger.levelMap[e.level]](t+": "+e.msg)}}ConsoleLogger.levelMap={emergency:"error",critical:"error",alert:"error",error:"error",warning:"warn",notice:"info",info:"log",debug:"debug"};class ServerLogger extends Logger{constructor(e,t,r){super(e,r),this._logCache=[],this.log=function(e){this.server.connected?this.server.request({method:"post",endpoint:"log",data:e}):this._logCache.push(e)},this.server=t,this.reporter=r,this.server.on("connection-changed",function(){this._uploadCache()})}async _uploadCache(){!0===this.server.connected&&0<this._logCache.length&&!0===(await this.server.request({method:"post",endpoint:"log",data:this._logCache})).data&&this.reporter.report({msg:"cleared cache"})}}class CacheLogger extends Logger{constructor(e,r,t){super(e,r),this.cache=[],this.cacheSize=t,this._reporter=r,this.report=({msg:e,level:t="debug"})=>r.report({msg:e,level:t,source:"CacheLogger"}),this.report({msg:"Initiated"})}log(e){this.cache=[e,...this.cache.slice(0,this.cacheSize-1)]}}class Atom extends InformationSource{constructor(e,t,r,n){super(e,{name:t}),this._state=void 0,this._states=void 0,this.addEvent("change");for(const o in r){var i=r[o];if(!Array.isArray(i))throw new Error("Missing state transitions array");for(const a of i)if(!r.hasOwnProperty(a))throw new Error("State transition to unknown state specified")}if(!r[n])throw new Error("Unknown initial state "+n);this._states=r,this._state=n}async setState(e,t){if(e!==this._state){if(this._states[e]){var r=this._state;if(!r||this._states[r].includes(e))return this._state=e,this.emit("change",{state:this._state,previousState:r,bubbleState:t});r=`Transition from state ${r} to state ${e} not allowed`;throw this.report({msg:r,level:"error"}),new Error(r)}throw new Error("Unknown state "+e)}}get state(){return this._state}}class Component extends InformationSource{constructor(e,t){if(super(e,pick(["id","name"],t)),this._status={main:{medium:Component.partQualityStatusAtom(this.label+" medium quality main",this._reporter)},UI:{medium:Component.partQualityStatusAtom(this.label+" medium quality UI",this._reporter)},specs:{medium:Component.partQualityStatusAtom(this.label+" medium quality specs",this._reporter)}},this._debug=!1,this.mainPlaceholder=void 0,this._settings=void 0,this._tree=void 0,this._content={},this._resetContent=()=>{this._content={main:{medium:null},UI:{medium:null},specs:{medium:null}}},this._error={main:{medium:null},UI:{medium:null},specs:{medium:null}},this.destroyed=!1,!this.constructor._exportName)throw new Error("Class constructor is missing a static exportName field");this._resetContent(),this._debug=t.debug||!1,delete t.debug,this._settings=t,this.addEvent("status-change");for(let i of Component.parts)for(let n of Component.qualities){const r=this._status[i][n];r.on("change",({state:e,previousState:t,bubbleState:r})=>("main"===i&&"medium"===n&&"ready"===e&&this.report({msg:`${n} quality ${i} status: ${t} -> `+e,level:"debug"}),"error"===e&&console.error(this.label,`${n} quality ${i} status: ${t} -> `+e),!1===r||this.emit("status-change",{quality:n,part:i,status:e,previousStatus:t,bubbleState:r})))}for(let e of Object.keys(this._settings))"source"!==e&&void 0===this[e]&&void 0===Object.getOwnPropertyDescriptor(this,e)&&Object.defineProperty(this,e,{get:()=>this._settings[e]})}static get exportLevel(){return this._exportLevel}get exportLevel(){return this.constructor.exportLevel}static get exportName(){return this._exportName.plural}get exportName(){return this.constructor.exportName}static partQualityStatusAtom(e,t){return new Atom(t,e+" status",{"not-loaded":["loading","partially-loaded","ready","error"],loading:["partially-loaded","ready","error"],"partially-loaded":["not-loaded","loading","ready","error"],ready:["not-loaded","loading","partially-loaded","error"],error:[]},"not-loaded")}get status(){return{main:{medium:this._status.main.medium.state},UI:{medium:this._status.UI.medium.state},specs:{medium:this._status.specs.medium.state}}}get materializable(){return void 0!==this._settings.materialVariantGroup}get settings(){return this._settings}_onTreeSet(){}_onTreeUnset(){}get tree(){return this._tree}set tree(e){if(void 0===e)this._onTreeUnset(),this._tree=void 0;else{if(void 0!==this._tree&&!0===this.constructor.treeLock)throw new Error(this.label+" tree property already set.");this._tree=e,this._onTreeSet()}}get content(){return this._content}get error(){return this._error}_setContent(e,t,r,n=!0){return this._content[e][t]=r,this._status[e][t].setState("ready",n)}_setError(e,t,r){if(null!==this._error[e][t])throw console.error(r),new Error(`Can not set ${this.label} ${e} ${t} to error state twice. New error ignored.`);return this._error[e][t]=r,this._status[e][t].setState("error")}clone(e={}){return new this.constructor(this._reporter,{...this._settings,...e})}static sortStatusArray(e){return e.slice().sort((e,t)=>Component.loadStatusSortMap[t]-Component.loadStatusSortMap[e])}static sortQualityArray(e){return e.slice().sort((e,t)=>Component.qualitySortMap[t]-Component.qualitySortMap[e])}static highestQualityLoaded(e){return e.high||e.medium||e.low||null}static unlink(e){return Array.isArray(e)?e.map(Component.unlink):e instanceof Package?void 0:e instanceof Component?e.id:e instanceof URL?e.href:"object"==typeof e?Object.entries(e).reduce((e,[t,r])=>Object.assign(e,{[t]:Component.unlink(r)}),{}):e}toJSON(){const r=Object.entries(this._settings).reduce((e,[t,r])=>{r=Component.unlink(r);return void 0===r||(e[t]=r),e},{id:this.id,name:this.name});if("Configuration"===this.constructor.name)if(this.assignedMaterials){const d={};for(var e of this.blockInstances||[]){d[e.id]={assignables:[],block:{id:e.block.id,name:e.block.name}};for(var t of this.assignedMaterials[e.id]||[]){const p={assignments:[]};for(var[n,i]of Object.entries(t.mvg)){var o=this.pkg.findComponentById(n),i={mvg:{id:n,name:o.name},material:{id:i.id,name:i.name}};p.assignments.push(i)}t.positionedMeshGroup&&(p.positionedMeshGroup={id:positionedMeshGroup.id,name:positionedMeshGroup.id}),t.positionedMesh&&(p.positionedMesh={id:positionedMesh.id,name:positionedMesh.id}),d[e.id].assignables.push(p)}}r.materialOverview=d}else console.warn("Not exporting assigned materials, configuration not build yet");this._settings&&this._settings.source&&1===Object.keys(this._settings.source).length&&(r.source=this._settings.source.medium);const a={[this.exportName]:[r]};for(var s of Component.parts){const m=this.dependencies?Object.values(this.dependencies[s]):[];var l;if("main"!==s||!this._exportOnlyDependencies||0<(s=Object.values(this._exportOnlyDependencies)).length&&m.push(...s),0<m.length){const f=m.flat();let e=[];e="ComponentTree"===this.constructor.name?this.constructor.importInstructions.map(e=>e.cls):this._tree?this._tree.constructor.importInstructions.map(e=>e.cls):f.filter(unique).map(e=>e.constructor);for(let t of e)for(l of f.filter(e=>e.constructor===t))if("ComponentTree"!==l.constructor.name)if("configurations"!==l.exportName){var c,h=l.toJSON();for(let[e,t]of Object.entries(h))"root"!==l.exportLevel&&e===l.exportName?(r[l.exportName]=r[l.exportName]||[],r[l.exportName].push(...t),c=r[l.exportName].indexOf(l.id),r[l.exportName].splice(c,1),delete a[l.exportName]):(a[e]=a[e]||[],c=t.filter(t=>void 0===a[e].find(e=>e.id===t.id)),a[e].push(...c))}else a.configurations=a.configurations||[],a.configurations.push(l.toJSON());else this.report({msg:"Not exporting external component tree "+ComponentTree.label})}}for(var[u,A]of Object.entries(a))Array.isArray(A)&&A.sort((e,t)=>e.id>t.id?1:-1);return a}destroy(){if(!1===this.destroyed){this.destroyed=!0;for(var e of Component.parts)for(var t of Component.qualities){const i=this._status[e][t];i.removeAllListeners(),this._content[e][t]&&"function"==typeof this._content[e][t].dispose&&this._content[e][t].dispose()}this._resetContent();for(var r of Object.keys(this.settings))["options"].includes(r)||(this.settings[r]=void 0);for(var n of Object.keys(this))this[n]=void 0;super.destroy&&super.destroy()}else console.warn(this.label,"was already destroyed")}}Component._exportLevel="root",Component._exportName={singular:"component",plural:"components"},Component.qualities=["medium"],Component.parts=["UI","main","specs"],Component.treeLock=!0,Component.loadStatusSortMap={"not-loaded":1,loading:2,"partially-loaded":3,ready:4,error:5},Component.qualitySortMap={high:3,medium:2,low:1};class LoadingBase extends InformationSource{constructor(e,t){super(e,t),checkPropTypes(t,{url:URL},{}),"/"!==t.url.href.substr(-1)&&(t.url.href+="/"),this.url=t.url}}class LoadableComponent extends Component{constructor(e,t){if(super(e,t),this.source={},!t.source)throw new Error("Missing source property");if(!t.source.medium)throw new Error("Source should always specify a medium quality file");checkPropTypes(t.source,{medium:e=>"string"!=typeof e.path||""===e.path?`Property path = ${e.path}, should be a non-empty string.`:"number"==typeof e.sizeBytes||`Property sizeBytes = ${e.sizeBytes}, should be a number.`},{}),this.source={medium:t.source.medium},this.source.high=t.source.high||t.source.medium,this.source.low=t.source.low||t.source.medium}async _load(e,t){return this.report({level:"notice",msg:"Override LoadableComponent _load method!"}),Promise.reject()}async load(e,t="medium"){await this._status.main[t].setState("loading");let r=null;try{var n=await this._load(e,t);return await this._setContent("main",t,n),this}catch(e){r=e.message?"Load errored: "+e.message:"Unknown loading error.",this.report({msg:r,level:"error"}),console.error(`Error loading ${t} quality `+this.label,e),this._setError("main",t,new Error(r))}}}class InfoComponent extends Component{constructor(e,t){super(e,t)}autoUpdateStatus(){for(var e of Component.parts)for(var t of Component.qualities)this._status[e][t].setState("ready")}async _build(e,t,r){return this._setContent(e,t,this),this}toJSON(){var e=super.toJSON();return{[this.exportName]:e[this.exportName][0]}}}InfoComponent._exportName={singular:"info",plural:"info"};class ComponentLoader extends InformationSource{constructor(e,t={}){var r;super(e,t),this._defaultLoadingQuality="medium",this._loadingBases=void 0,this._concurrentLoadsPerBase=2,this._buildQueue=[],this._loadableQueue=[],this._currentLoads=[],this._qualitiesLowToHigh=Component.sortQualityArray(Component.qualities).reverse(),checkPropTypes(t,{},{bases:e=>Array.isArray(e)&&e.every(e=>e instanceof LoadingBase),concurrentLoadsPerBase:"number",defaultLoadingQuality:e=>Component.qualities.includes(e)}),t.bases?this.loadingBases=t.bases:(r=location.origin,this.report({msg:"No loading bases specified, auto generating from origin "+r}),this.loadingBases=[new LoadingBase(e,{name:"Autogen",url:new URL(r)})]),t.concurrentLoadsPerBase&&(this._concurrentLoadsPerBase=t.concurrentLoadsPerBase),t.defaultLoadingQuality&&(this._defaultLoadingQuality=t.defaultLoadingQuality)}set defaultLoadingQuality(e){this._defaultLoadingQuality=e}get loadingBases(){return this._loadingBases}set loadingBases(e){if(0<this._buildQueue.length)throw new Error("Can't change loading bases while loading resources");this._loadingBases=e,this._currentLoads=this.loadingBases.map(e=>({base:e,loads:{},maxConcurrentLoads:this._concurrentLoadsPerBase}))}_loadNext(){var e=this._loadableQueue.length;let t=0;if(this.report({msg:"Load next: "+(0<e?e+" in queue.":"Queue empty."),level:"info"}),0<e){for(let e of this._currentLoads)if(this._debug&&console.debug(e.base.label,"current loads:",Object.keys(e.loads).length),Object.keys(e.loads).length<e.maxConcurrentLoads){t+=1;const n=this._loadableQueue.shift();this.report({msg:`Free slot in base ${e.base.url.href}, start ${this._defaultLoadingQuality} quality loading `+n.label,level:"debug"});const i=v4();var r=n.load(e.base,this._defaultLoadingQuality).finally(()=>(delete e.loads[i],this.report({msg:`Load process ${n.label} finished, calling loadNext`,level:"debug"}),this._loadNext()));e.loads[i]=r}0===t&&this.report({msg:"Could not assign loads to bases, all slots are taken.",level:"debug"})}}async build(o,a="main",s="medium",e=!1){if(this.report({msg:`Build request for ${s} quality ${a} part `+o.label,level:"info"}),"ready"===o.status[a][s])return this.report({msg:"Component already ready, returning"}),Promise.resolve(o);const t=new Promise((n,i)=>{o.on("status-change",({status:e,quality:t,part:r})=>{if(t===s&&r===a){switch(!0===o._debug&&(console.warn(o.label,a,s,e),console.log(JSON.parse(JSON.stringify(o.dependencyStatus)))),e){case"loading":case"partially-loaded":return;case"ready":n(o);break;case"error":i(o.error[a][s]);break;default:throw new Error("Component Loader unable to handle new component status "+e)}o.hasListener("status-change",this.id)&&o.removeListener("status-change",this.id)}},this.id)}).finally(()=>{var e=this._buildQueue.filter(e=>e.component!==o||e.part!==a||e.quality!==s),t=this._buildQueue.length-e.length;0<t&&(this.report({msg:`Cleaned up ${t} old build requests`}),this._buildQueue=e)});var r={component:o,part:a,quality:s};if(void 0!==this._buildQueue.find(e=>e.component===o&&e.part===a&&e.quality===s))return t;!0!==e?this._buildQueue.push(r):this._buildQueue=[r,...this._buildQueue];const n=[o,...o.allDependencies];e=n.filter(e=>e instanceof BuildableComponent&&e.dependencies&&0===Object.values(e.dependencies[a]).length),r=n.filter(e=>e instanceof BuildableComponent&&e.dependencies&&Object.values(e.dependencies[a]).every(e=>Array.isArray(e)?e.find(e=>"ready"===e.status[a][s]):"ready"===e.status[a][s]));const i=[...e,...r].filter(unique);r=i.filter(e=>"not-loaded"===e.status[a][s]).map(e=>e.autoUpdateStatus());return this._rescheduleLoadingOrder(),Promise.all(r).then(()=>t)}_rescheduleLoadingOrder(){const r={};var e,t=this._loadableQueue.length,n=this._buildQueue.length;for(let t of Component.qualities){const a=[];for(e of this._buildQueue.filter(e=>e.quality===t))"UI"===e.part?e.component.dependencies.UI&&a.push(...Object.values(e.component.dependencies.UI)):"specs"===e.part?e.component.dependencies.specs&&a.push(...Object.values(e.component.dependencies.specs)):a.push(e.component);0<a.length&&(r[t]=ComponentLoader.optimalLoadingOrder(a,t))}this._loadableQueue=this._qualitiesLowToHigh.map(e=>r[e]?.relevantDependencies||[]).flat();var i=this._loadableQueue.length,o=this._buildQueue.length;this.report({msg:`Rescheduled loading order, ${t} => ${i}, ${n} - `+o}),this._loadNext()}static optimalLoadingOrder(e,n="medium"){const t=ComponentLoader.getLoadableDependencies(e),i=["not-loaded","partially-loaded"],r=t.map(e=>{const t=[...e],r=t.filter(e=>i.includes(e.status.main[n]));return{dependencies:t,relevantDependencies:r,sizeBytes:r.reduce((e,t)=>i.includes(t.status.main[n])?e+t.source[n].sizeBytes:e,0)}});return r.sort((e,t)=>e.sizeBytes-t.sizeBytes)[0]}static getLoadableDependencies(t,r=[new Set],n=[]){if(t instanceof LoadableComponent)r.forEach(e=>e.add(t));else{let e=null;if(t instanceof BuildableComponent)e=Object.values(t.dependencies.main);else if(Array.isArray(t)&&t.every(e=>e instanceof Component))e=t;else{if(!(t instanceof InfoComponent))throw new Error("Cannot get dependencies of "+typeof t);e=[]}for(var i of e)if(i instanceof Component)-1===n.indexOf(i)&&(n.push(t),r=this.getLoadableDependencies(i,r,n));else if(Array.isArray(i)){const s=[];for(var o of i){var a;-1===n.indexOf(o)&&(a=r.map(e=>new Set(e)),s.push(...this.getLoadableDependencies(o,a,n.slice())))}0<s.length&&(r=s)}}return r}}ComponentLoader.socketTable={IE:8,Safari:4,Firefox:6,Opera:6,Chrome:4};const imageLoader=new ImageLoader;class WrappedImage extends LoadableComponent{constructor(e,t){super(e,t),checkPropTypes(t,{},{})}async _load(e,t){this._status,this._setContent.bind(this);const n=new URL(e.url.href+this.source[t].path);return this.report({msg:"Loading image from "+n}),new Promise((t,r)=>{imageLoader.load(n.href,function(e){t(e)},void 0,function(e){r("Could not load image from "+n+(e.message?", "+e.message:""))})})}}WrappedImage._exportName={singular:"image",plural:"images"};let defaultLoader=null;class BuildableComponent extends Component{constructor(e,t,r={}){super(e,t),this._placeHolderContent=null,this.defaultContent=this._placeHolderContent,this._dependencies=void 0,this._exportOnlyDependencies={},this._applicableMaterialVariantGroups=void 0,this._materializableDependencies=void 0,this._assignableDependencies=void 0,this._allDependencies=void 0,this._directDependencies=void 0,this._buildPromises={main:{medium:null},UI:{medium:null},specs:{medium:null}},checkPropTypes(t,{},{thumbnail:WrappedImage}),this._resetDependencies(),!1!==r.autoLinkDependencies&&this._autoLink(t,r),t.assignable}static autogenIntegralInstruction(e){return{parse:Object.entries(e).reduce((e,[t,r])=>Array.isArray(r)?Object.assign(e,{[t]:"integral"}):e,{})}}_autoLink(e,r){this.report({msg:"Auto-linking"}),this.removeDependencyListeners(),this._resetDependencies();for(var[n,i]of Object.entries(e)){!0===this._debug&&console.log(this.label,`Process settings "${n}" =`,i);var o=void 0!==BuildableComponent.partSettings[n]?BuildableComponent.partSettings[n]:"main";if(i instanceof Component)!0===this._debug&&console.log(this.label,"Simple setting, adding to _dependencies."+o),this._dependencies[o][n]=i;else if(Array.isArray(i)){if(!0===this._debug&&console.log(this.label,"Setting value is an array"),void 0===r.parse?.[n])throw new Error(`Unspecified array setting ${this.constructor.name}.`+n);let t=[];for(var a of i)if("object"!=typeof a||Array.isArray(a)||a instanceof Component)a instanceof Component&&(!0===this._debug&&console.log(this.label,"Subvalue looks like Component. Adding",a,"to _dependencies"),t.push(a));else{!0===this._debug&&console.log(this.label,"Subvalue",a,"looks like an object");var s=Object.values(a).filter(e=>e instanceof Component);switch(!0===this._debug&&console.log(this.label,"Found",s,"components in subvalue"),s.length){case 0:break;case 1:!0===this._debug&&console.log(this.label,"Adding",s[0],"to ._dependencies"),t.push(s[0]);break;default:if("alternatives"===r.parse[n])throw new Error(`${this.label}.key setting holds ${s.length} Components, but 1 is the maximum`);!0===this._debug&&console.log(this.label,"Adding",s.length,"in-object-dependencies to ._dependencies"),t.push(...s)}}if("integral"===r.parse[n])for(let e=0;e<t.length;e+=1)this._dependencies[o][n+"-"+e]=t[e];else"alternatives"===r.parse[n]&&(this._dependencies[o][n]=t)}else if("object"==typeof i){let e=0;for(var[t,l]of Object.entries(i))e+=1,l instanceof Component&&(this._dependencies[o][n+"-"+e]=l)}}for(var c of Component.parts)for(var h of Object.values(this._dependencies[c]).flat())this._debug&&console.log(this.label,"subscribe status change",h.label),this.autoBuildOnStatusChange(h)}async _dependencyStatusChangeHandler(e){await this.autoUpdateStatus(),this._debug&&console.warn(this.status)}autoBuildOnStatusChange(e){e.on("status-change",this._dependencyStatusChangeHandler.bind(this),this.id)}removeDependencyListeners(){for(var e of Component.parts)for(var t of Object.values(this._dependencies[e]).flat())t.hasListener("status-change",this.id)&&t.removeListener("status-change",this.id)}addExportDependency(e,t){this.dependsDirectlyOn(t)||(this._exportOnlyDependencies[e]=t)}async autoUpdateStatus(){var e=this.dependencyStatus;!0===this._debug&&console.log("_autoUpdateStatus",this.label,e);var r,t=this.status;for(r of Component.parts)for(var n of Component.qualities){this._debug;var i=this._status[r][n].state;if(t[r][n]===i){var o=e[r][n].status;if("error"!==i){if("ready"===o&&"ready"!==i&&null===this._content[r][n]){!0===this._debug&&console.log(this.label,`Auto building: ${i}->`+o);let t=null;try{await this._build(r,n,e[r][n].dependencies)}catch(e){t=e}var a=this._status[r][n].state;if("ready"!==a||null!==t){var s=`${this.label} status should've been "ready" after auto-build but is "${this._status[r][n].state}" ${t?t.message:""}. `+("error"!==a?"Going to error state.":"");if(this.report({msg:s,level:"error"}),"error"!==a)throw this._setError(r,n,t||new Error(s)),!0===this._debug&&console.log("Component set to error state",r,n),t}}else if(o!==i){let t=null;!0===this._debug&&console.log(`Auto updating ${r} ${n}: ${i}->`+o),"error"===o&&(this._error[r][n]=new Error("Error in dependency chain"));try{await this._status[r][n].setState(o)}catch(e){-1===e.message.toLowerCase().indexOf("transition")?t=e:this.report({msg:`Status update ${i}->${o} failed, probably because the state changed intermediately to "${this._status[r][n].state}"`,level:"debug"})}s=this._status[r][n].state;null===t||(o=`Status change ${i}->${o} failed. Current status: "${this._status[r][n].state}".`,this.report({msg:o,level:"error"}),"error"!==s&&(this._setError(r,n,t||new Error(o)),!0===this._debug&&console.log(this.label+" set to error state",r,n)))}}else!0===this._debug&&console.log(this.label,"Skip (comp in error state)")}}}_resetDependencies(){this._dependencies={main:{},UI:{},specs:{}}}get dependencies(){return this._dependencies}get dependencyStatus(){const e={main:{medium:{}},UI:{medium:{}},specs:{medium:{}}};for(var r of Component.parts){var n=Object.entries(this._dependencies[r]);if(!0===this._debug&&console.log(r,"dep entries",n,this._dependencies),0===n.length)e[r]={medium:{status:"ready",dependencies:{}}};else{!0===this._debug&&console.log("deps!",n);for(let t of Component.qualities){!0===this._debug&&console.debug("dep quality",r,t);const s={},l={};for(var[i,o]of n)if(Array.isArray(o)){const h=o.map(e=>e.status.main[t]);var a=Component.sortStatusArray(h)[0];l[i]=o[h.indexOf(a)],s[a]=(s[a]||0)+1}else!0===this._debug&&console.debug(o.label,o.status),s[o.status.main[t]]=(s[o.status.main[t]]||0)+1,l[i]=o;!0===this._debug&&console.debug(this.label,s,l);const c=Object.keys(s);1===c.length?(e[r][t].status=c[0],"ready"===c[0]&&(e[r][t].dependencies=l)):c.find(e=>"error"===e)?e[r][t].status="error":c.find(e=>"loading"===e)?e[r][t].status="loading":c.find(e=>"ready"===e)||c.find(e=>"partially-loaded"===e)?e[r][t].status="partially-loaded":e[r][t].status="not-loaded"}}}return e}get applicableMaterialVariantGroups(){if(!this._applicableMaterialVariantGroups){const t=[];for(var e of this.allDependencies)e.materialVariantGroup&&-1===t.indexOf(e.materialVariantGroup)&&t.push(e.materialVariantGroup);this._applicableMaterialVariantGroups=t}return this._applicableMaterialVariantGroups}get materializableDependencies(){return this._materializableDependencies||(this._materializableDependencies=this.allDependencies.filter(e=>!0===e.materializable)),this._materializableDependencies}get assignableDependencies(){return this._assignableDependencies||(this._assignableDependencies=this.allDependencies.filter(e=>!0===e.assignable)),this._assignableDependencies}get allDependencies(){return this._allDependencies||(this._allDependencies=this.directDependencies.reduce((e,t)=>t.allDependencies?e.concat(t,...t.allDependencies):e.concat(t),[]).filter(unique)),this._allDependencies}get directDependencies(){return this._directDependencies||(this._directDependencies=Component.parts.map(e=>Object.values(this._dependencies[e])).flat().flat().filter(unique)),this._directDependencies}dependsDirectlyOn(e){return this.directDependencies.includes(e)}dependsOn(e){return this.allDependencies.includes(e)}highestMainQuality(){var e=this.dependencyStatus;return"ready"!==e.high.status?{quality:"high",dependencies:e.dependencies}:null!==e.medium.status?{quality:"medium",dependencies:e.dependencies}:null!==e.low.status?{quality:"low",dependencies:e.dependencies}:null}async _build(e,t,r){return this.report({level:"notice",msg:"Override BuildableComponent._build interface method!"}),this._setContent(e,t,"-"),this}_rebuild(e="main"){for(var t of Component.qualities)"ready"===this.status[e][t]&&this._build("main",t)}async build({componentLoader:e,part:t="main",quality:r="medium",highPriority:n=!1}={}){if(this._buildPromises[t][r])return this._buildPromises[t][r];let i=e;if(i){if(!(i instanceof ComponentLoader))throw new Error("Loader does not instance class ComponentLoader");this.report({msg:"Using specified loader"})}else i=this._tree&&this._tree.loader?(this.report({msg:"Using component loader from component tree"}),this._tree.loader):(this.report({msg:"No loader specified, using default loader"}),defaultLoader||(this.report({msg:"Creating default loader"}),console.log("Creating default loader"),defaultLoader=new ComponentLoader(this._reporter,{name:"Default loader"})),defaultLoader);return this._buildPromises[t][r]=i.build(this,t,r,n),this._buildPromises[t][r]}destroy(){this.removeDependencyListeners(),super.destroy&&super.destroy()}}BuildableComponent.partSettings={thumbnail:"UI",dimensionsImage:"specs","*":"main"};class ConnectorType extends BuildableComponent{constructor(e,t){super(e,t,{autoLinkDependencies:!1}),checkPropTypes(t,{name:"string"},{}),t.thumbnail&&(this._dependencies.UI={thumbnail:t.thumbnail})}get connectors(){return this._tree?this._tree.connectorsByType[this]:[]}_onTreeSet(){const t=this;this._tree.on("change",({cls:e=[]})=>{e.includes(Connector)&&(t.report({msg:"Connector changed in package. Rebuilding."}),this._rebuild())},this.id),this._rebuild()}_onTreeUnset(){this._tree.hasListener("change",this.id)&&this._tree.removeListener("change",this.id)}async _build(e,t){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":var r=this._tree?.connectors?this._tree.connectors.filter(e=>e.settings.type===this):[];this._setContent("main",t,r);break;default:this._setContent(e,t,null)}return this}}ConnectorType._exportName={singular:"connectorType",plural:"connectorTypes"};class Theme extends BuildableComponent{constructor(e,t){super(e,t),checkPropTypes(t,{name:"string",group:ThemeGroup},{})}async _build(e,t){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":for(var r of Component.qualities)this._setContent("main",r,{id:this._settings.id,name:this._settings.name,group:this._settings.group.id});break;default:this._setContent(e,t,null)}return this}}Theme._exportName={singular:"theme",plural:"themes"};class ThemeGroup extends BuildableComponent{constructor(e,t){super(e,t,{autoLinkDependencies:!1}),checkPropTypes(t,{name:"string"},{}),t.thumbnail&&(this._dependencies.UI={thumbnail:t.thumbnail})}_onTreeSet(){const t=this;this._tree.on("change",({cls:e=[]})=>{e.includes(Theme)&&(t.report({msg:"Theme(s) changed in package. Rebuilding."}),t._build("main"))},this.id),this._build("main")}_onTreeUnset(){this._tree.hasListener("change",this.id)&&this._tree.removeListener("change",this.id)}async _build(e,t){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":var r,n=this._tree?this._tree.themes.filter(e=>e.settings.group===this):[];for(r of Component.qualities)this._setContent("main",r,n);this.report({msg:`Built theme group of ${n.length} themes.`});break;default:this._setContent(e,t,null)}return this}}ThemeGroup._exportName={singular:"themeGroup",plural:"themeGroups"};class Connector extends BuildableComponent{constructor(e,t){void 0===t.position&&(t.position=new Vector3),void 0===t.quaternion&&(t.quaternion=new Quaternion),super(e,t),this._block=void 0,this.mate=void 0,this.mate={},checkPropTypes(t,{type:ConnectorType,position:Vector3,quaternion:Quaternion},{themeGroup:ThemeGroup})}get mateMap(){return this._tree?this._tree.mateMap[this.settings.type]:{}}get block(){return this._block}set block(e){if(this._block)throw new Error("Reference block setter called for a subsequent time.");console.assert(e instanceof Block),this._block=e}_updatePotentialMateList(){this._tree?this._tree.connectorTypeMateMap?this.mate=this._tree.connectorTypeMateMap.get(this.settings.type):console.warn("Can not update mate list, no connectorTypeMateMap in "+this._tree.label):console.warn("Can not update mate list, no tree")}_onTreeSet(){const e=this;this._updatePotentialMateList(),this._tree.on("mate-map-update",()=>{e._updatePotentialMateList.bind(e)()},this.id)}_onTreeUnset(){this.mate={},this._tree.removeListener("mate-map-update",this.id)}async _build(e,t,r){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":var n={id:this._settings.id,name:this._settings.name,themeGroup:this._settings.themeGroup,type:this._settings.type,position:this._settings.position,quaternion:this._settings.quaternion};this._setContent("main",t,n);break;default:this._setContent(e,t,null)}return this}}Connector._exportName={singular:"connector",plural:"connectors"},Connector._exportLevel="inline";const wrapTypes=[RepeatWrapping,ClampToEdgeWrapping,MirroredRepeatWrapping],checkWrapType=e=>!!wrapTypes.includes(e)||"Unknown wrapping "+e;class WrappedTexture extends BuildableComponent{constructor(e,t){checkPropTypes(t,{image:WrappedImage},{id:UUIDRegex,name:"string",wrapS:checkWrapType,wrapT:checkWrapType,repeat:Vector2,anisotropy:"number"}),super(e,t)}async _build(e,t,r){switch(this.report({msg:`Building ${t} `+e}),e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":const i=new Texture;var n=Object.keys(i).filter(e=>"image"!==e);copyProps({from:this._settings,into:i,required:[],optional:n});n=Project.maxAnisotropy;i.anisotropy=n,i.image=r.image.content.main[t],i.flipY=!1,i.encoding=sRGBEncoding,i.needsUpdate=!0,this._setContent("main",t,i);break;default:this._setContent(e,t,null)}return this}}function Node$2(e){this.uuid=MathUtils.generateUUID(),this.name="",this.type=e,this.userData={}}function TempNode(e,t){Node$2.call(this,e),this.shared=void 0===(t=t||{}).shared||t.shared,this.unique=void 0!==t.unique&&t.unique}function InputNode(e,t){(t=t||{}).shared=void 0!==t.shared&&t.shared,TempNode.call(this,e,t),this.readonly=!1}WrappedTexture._exportName={singular:"texture",plural:"textures"},Node$2.prototype={constructor:Node$2,isNode:!0,hashProperties:void 0,analyze:function(e,t){t=t||{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1},analyzeAndFlow:function(e,t,r){return this.analyze(e,r=r||{}),this.flow(e,t,r)},flow:function(e,t,r){e.addFlow((r=r||{}).slot,r.cache,r.context);r={};return r.result=this.build(e,t),r.code=e.clearNodeCode(),r.extra=e.context.extra,e.removeFlow(),r},build:function(e,t,r){t=t||this.getType(e,t);var n=e.getNodeData(r||this);return e.analyzing&&this.appendDepsNode(e,n,t),-1===e.nodes.indexOf(this)&&e.nodes.push(this),void 0!==this.updateFrame&&-1===e.updaters.indexOf(this)&&e.updaters.push(this),this.generate(e,t,r)},generate:function(){},getHash:function(){var e,t,r="{";for(e in this)(t=this[e])instanceof Node$2&&(r+='"'+e+'":'+t.getHash()+",");if(this.hashProperties)for(var n=0;n<this.hashProperties.length;n++)t=this[e=this.hashProperties[n]],r+='"'+e+'":"'+String(t)+'",';return r+='"id":"'+this.uuid+'"}'},appendDepsNode:function(e,t,r){t.deps=(t.deps||0)+1;var n=e.getTypeLength(r);(n>(t.outputMax||0)||this.getType(e,r))&&(t.outputMax=n,t.output=r)},setName:function(e){return this.name=e,this},getName:function(){return this.name},getType:function(e,t){return"sampler2D"===t||"samplerCube"===t?t:this.type},getJSONNode:function(e){if(!(void 0===e||"string"==typeof e)&&void 0!==e.nodes[this.uuid])return e.nodes[this.uuid]},copy:function(e){return void 0!==e.name&&(this.name=e.name),void 0!==e.userData&&(this.userData=JSON.parse(JSON.stringify(e.userData))),this},createJSONNode:function(e){var t=void 0===e||"string"==typeof e,r={};if("string"!=typeof this.nodeType)throw new Error("Node does not allow serialization.");return r.uuid=this.uuid,r.nodeType=this.nodeType,""!==this.name&&(r.name=this.name),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),t||(e.nodes[this.uuid]=r),r},toJSON:function(e){return this.getJSONNode(e)||this.createJSONNode(e)}},TempNode.prototype=Object.create(Node$2.prototype),(TempNode.prototype.constructor=TempNode).prototype.build=function(e,t,r,n){if(t=t||this.getType(e),this.getShared(e,t)){var i=this.getUnique(e,t);i&&void 0===this.constructor.uuid&&(this.constructor.uuid=MathUtils.generateUUID()),r=e.getUuid(r||this.getUuid(),!i);var o=e.getNodeData(r),a=o.output||this.getType(e);if(e.analyzing)return 0<(o.deps||0)||this.getLabel()?(this.appendDepsNode(e,o,t),this.generate(e,t,r)):Node$2.prototype.build.call(this,e,t,r);if(i)return o.name=o.name||Node$2.prototype.build.call(this,e,t,r),o.name;if(!this.getLabel()&&(!this.getShared(e,a)||e.context.ignoreCache||1===o.deps))return Node$2.prototype.build.call(this,e,t,r);if(r=this.getUuid(!1),i=this.getTemp(e,r))return e.format(i,a,t);i=TempNode.prototype.generate.call(this,e,t,r,o.output,n),n=this.generate(e,a,r);return e.addNodeCode(i+" = "+n+";"),e.format(i,a,t)}return Node$2.prototype.build.call(this,e,t,r)},TempNode.prototype.getShared=function(e,t){return"sampler2D"!==t&&"samplerCube"!==t&&this.shared},TempNode.prototype.getUnique=function(){return this.unique},TempNode.prototype.setLabel=function(e){return this.label=e,this},TempNode.prototype.getLabel=function(){return this.label},TempNode.prototype.getUuid=function(e){e=(e||null==e)&&this.constructor.uuid||this.uuid;return e="string"==typeof this.scope?this.scope+"-"+e:e},TempNode.prototype.getTemp=function(e,t){t=t||this.uuid;t=e.getVars()[t];return t?t.name:void 0},TempNode.prototype.generate=function(e,t,r,n,i){return this.getShared(e,t)||console.error("THREE.TempNode is not shared!"),r=r||this.uuid,e.getTempVar(r,n||this.getType(e),i,this.getLabel()).name},InputNode.prototype=Object.create(TempNode.prototype),(InputNode.prototype.constructor=InputNode).prototype.setReadonly=function(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this},InputNode.prototype.getReadonly=function(){return this.readonly},InputNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),void 0!==e.readonly&&(this.readonly=e.readonly),this},InputNode.prototype.createJSONNode=function(e){e=TempNode.prototype.createJSONNode.call(this,e);return!0===this.readonly&&(e.readonly=this.readonly),e},InputNode.prototype.generate=function(e,t,r,n,i,o){r=e.getUuid(r||this.getUuid()),n=n||this.getType(e);var a=e.getNodeData(r);return this.getReadonly(e)&&void 0!==this.generateReadonly?this.generateReadonly(e,t,r,n,i,o):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(n,this,i,o,this.getLabel())),e.format(a.vertex.name,n,t)):(a.fragment||(a.fragment=e.createFragmentUniform(n,this,i,o,this.getLabel())),e.format(a.fragment.name,n,t))};var declarationRegexp=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i;function ConstNode(e,t){TempNode.call(this),this.parse(e||ConstNode.PI,t)}function VarNode(e,t){Node$2.call(this,e),this.value=t}ConstNode.PI="PI",ConstNode.PI2="PI2",ConstNode.RECIPROCAL_PI="RECIPROCAL_PI",ConstNode.RECIPROCAL_PI2="RECIPROCAL_PI2",ConstNode.LOG2="LOG2",ConstNode.EPSILON="EPSILON",ConstNode.prototype=Object.create(TempNode.prototype),(ConstNode.prototype.constructor=ConstNode).prototype.nodeType="Const",ConstNode.prototype.getType=function(e){return e.getTypeByFormat(this.type)},ConstNode.prototype.parse=function(e,t){this.src=e||"";var r,n,i="",e=this.src.match(declarationRegexp);this.useDefine=t||"#"===this.src.charAt(0),e&&1<e.length?(n=e[1],r=e[2],i=e[3]):(r=this.src,n="f"),this.name=r,this.type=n,this.value=i},ConstNode.prototype.build=function(e,t){return"source"===t?this.value?this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";":this.useDefine?this.src:void 0:(e.include(this),e.format(this.name,this.getType(e),t))},ConstNode.prototype.generate=function(e,t){return e.format(this.name,this.getType(e),t)},ConstNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.parse(e.src,e.useDefine),this},ConstNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).src=this.src,!0===t.useDefine&&(t.useDefine=!0)),t},VarNode.prototype=Object.create(Node$2.prototype),(VarNode.prototype.constructor=VarNode).prototype.nodeType="Var",VarNode.prototype.getType=function(e){return e.getTypeByFormat(this.type)},VarNode.prototype.generate=function(e,t){var r=e.getVar(this.uuid,this.type);return this.value&&e.isShader("vertex")&&e.addNodeCode(r.name+" = "+this.value.build(e,this.getType(e))+";"),e.format(r.name,this.getType(e),t)},VarNode.prototype.copy=function(e){return Node$2.prototype.copy.call(this,e),this.type=e.type,this.value=e.value,this},VarNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).type=this.type,this.value&&(t.value=this.value.toJSON(e).uuid)),t};var declarationRegexp$1=/^struct\s*([a-z_0-9]+)\s*{\s*((.|\n)*?)}/gim,propertiesRegexp=/\s*(\w*?)\s*(\w*?)(\=|\;)/gim;function StructNode(e){TempNode.call(this),this.parse(e)}function AttributeNode(e,t){Node$2.call(this,t),this.name=e}StructNode.prototype=Object.create(TempNode.prototype),(StructNode.prototype.constructor=StructNode).prototype.nodeType="Struct",StructNode.prototype.getType=function(e){return e.getTypeByFormat(this.name)},StructNode.prototype.getInputByName=function(e){for(var t=this.inputs.length;t--;)if(this.inputs[t].name===e)return this.inputs[t]},StructNode.prototype.generate=function(e,t){return"source"===t?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)},StructNode.prototype.parse=function(e){this.src=e||"",this.inputs=[];e=declarationRegexp$1.exec(this.src);if(e){for(var t,r=e[2];t=propertiesRegexp.exec(r);)this.inputs.push({type:t[1],name:t[2]});this.name=e[1]}else this.name="";this.type=this.name},StructNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).src=this.src),t},AttributeNode.prototype=Object.create(Node$2.prototype),(AttributeNode.prototype.constructor=AttributeNode).prototype.nodeType="Attribute",AttributeNode.prototype.getAttributeType=function(e){return"number"==typeof this.type?e.getConstructorFromLength(this.type):this.type},AttributeNode.prototype.getType=function(e){var t=this.getAttributeType(e);return e.getTypeByFormat(t)},AttributeNode.prototype.generate=function(e,t){var r=this.getAttributeType(e),r=e.getAttribute(this.name,r),r=(e.isShader("vertex")?this:r.varying).name;return e.format(r,this.getType(e),t)},AttributeNode.prototype.copy=function(e){return Node$2.prototype.copy.call(this,e),this.type=e.type,this},AttributeNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).type=this.type),t};var NodeLib={nodes:{},keywords:{},add:function(e){this.nodes[e.name]=e},addKeyword:function(e,t,r){this.keywords[e]={callback:t,cache:r=void 0===r||r}},remove:function(e){delete this.nodes[e.name]},removeKeyword:function(e){delete this.keywords[e]},get:function(e){return this.nodes[e]},getKeyword:function(e,t){return this.keywords[e].callback.call(this,t)},getKeywordData:function(e){return this.keywords[e]},contains:function(e){return void 0!==this.nodes[e]},containsKeyword:function(e){return void 0!==this.keywords[e]}},declarationRegexp$2=/^\s*([a-z_0-9]+)\s+([a-z_0-9]+)\s*\(([\s\S]*?)\)/i,propertiesRegexp$1=/[a-z_0-9]+/gi;function FunctionNode(e,t,r,n,i){this.isMethod=void 0===i,this.isInterface=!1,TempNode.call(this,i),this.parse(e,t,r,n)}function ExpressionNode(e,t,r,n,i){FunctionNode.call(this,e,i,n,r,t)}function FunctionCallNode(e,t){TempNode.call(this),this.setFunction(e,t)}FunctionNode.prototype=Object.create(TempNode.prototype),(FunctionNode.prototype.constructor=FunctionNode).prototype.nodeType="Function",FunctionNode.prototype.useKeywords=!0,FunctionNode.prototype.getShared=function(){return!this.isMethod},FunctionNode.prototype.getType=function(e){return e.getTypeByFormat(this.type)},FunctionNode.prototype.getInputByName=function(e){for(var t=this.inputs.length;t--;)if(this.inputs[t].name===e)return this.inputs[t]},FunctionNode.prototype.getIncludeByName=function(e){for(var t=this.includes.length;t--;)if(this.includes[t].name===e)return this.includes[t]},FunctionNode.prototype.generate=function(e,t){for(var r,n=0,i=this.src,o=0;o<this.includes.length;o++)e.include(this.includes[o],this);for(r in this.extensions)e.extensions[r]=!0;for(var a=[];s=propertiesRegexp$1.exec(this.src);)a.push(s);for(o=0;o<a.length;o++){var s,l,c=(s=a[o])[0],h=!this.isMethod||!this.getInputByName(c),u=c;(this.keywords[c]||this.useKeywords&&h&&NodeLib.containsKeyword(c))&&((l=this.keywords[c])||(l=(l=(h=NodeLib.getKeywordData(c)).cache?e.keywords[c]:l)||NodeLib.getKeyword(c,e),h.cache&&(e.keywords[c]=l)),u=l.build(e)),c!==u&&(i=i.substring(0,s.index+n)+u+i.substring(s.index+c.length+n),n+=u.length-c.length),void 0===this.getIncludeByName(u)&&NodeLib.contains(u)&&e.include(NodeLib.get(u))}return"source"===t?i:this.isMethod?(this.isInterface||e.include(this,!1,i),this.name):e.format("( "+i+" )",this.getType(e),t)},FunctionNode.prototype.parse=function(e,t,r,n){if(this.src=e||"",this.includes=t||[],this.extensions=r||{},this.keywords=n||{},this.isMethod){n=this.src.match(declarationRegexp$2);if(this.inputs=[],n&&4==n.length){this.type=n[1],this.name=n[2];var i=n[3].match(propertiesRegexp$1);if(i)for(var o=0;o<i.length;){var a,s,l=i[o++];"in"===l||"out"===l||"inout"===l?a=i[o++]:(a=l,l=""),s=i[o++],this.inputs.push({name:s,type:a,qualifier:l})}this.isInterface=-1===this.src.indexOf("{")}else this.type="",this.name=""}},FunctionNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.isMethod=e.isMethod,this.useKeywords=e.useKeywords,this.parse(e.src,e.includes,e.extensions,e.keywords),void 0!==e.type&&(this.type=e.type),this},FunctionNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);if(!t){for(var r in(t=this.createJSONNode(e)).src=this.src,t.isMethod=this.isMethod,t.useKeywords=this.useKeywords,this.isMethod||(t.type=this.type),t.extensions=JSON.parse(JSON.stringify(this.extensions)),t.keywords={},this.keywords)t.keywords[r]=this.keywords[r].toJSON(e).uuid;if(this.includes.length){t.includes=[];for(var n=0;n<this.includes.length;n++)t.includes.push(this.includes[n].toJSON(e).uuid)}}return t},ExpressionNode.prototype=Object.create(FunctionNode.prototype),(ExpressionNode.prototype.constructor=ExpressionNode).prototype.nodeType="Expression",FunctionCallNode.prototype=Object.create(TempNode.prototype),(FunctionCallNode.prototype.constructor=FunctionCallNode).prototype.nodeType="FunctionCall",FunctionCallNode.prototype.setFunction=function(e,t){this.value=e,this.inputs=t||[]},FunctionCallNode.prototype.getFunction=function(){return this.value},FunctionCallNode.prototype.getType=function(e){return this.value.getType(e)},FunctionCallNode.prototype.generate=function(e,t){for(var r=this.getType(e),n=this.value,i=n.build(e,t)+"( ",o=[],a=0;a<n.inputs.length;a++){var s=n.inputs[a],l=this.inputs[a]||this.inputs[s.name];o.push(l.build(e,e.getTypeByFormat(s.type)))}return i+=o.join(", ")+" )",e.format(i,r,t)},FunctionCallNode.prototype.copy=function(e){for(var t in TempNode.prototype.copy.call(this,e),e.inputs)this.inputs[t]=e.inputs[t];return this.value=e.value,this},FunctionCallNode.prototype.toJSON=function(e){if(!(t=this.getJSONNode(e))){var t,r=this.value;if((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid,r.inputs.length){t.inputs={};for(var n=0;n<r.inputs.length;n++){var i=r.inputs[n],o=this.inputs[n]||this.inputs[i.name];t.inputs[i.name]=o.toJSON(e).uuid}}}return t};var NodeUtils={elements:["x","y","z","w"],addShortcuts:function(e,t,r){for(var n={},i=0;i<r.length;++i){var o=r[i].split("."),a=o[0],o=o[1];n[a]=function(t,r,n){return n?{get:function(){return this[t][r][n]},set:function(e){this[t][r][n]=e}}:{get:function(){return this[t][r]},set:function(e){this[t][r]=e}}}(t,a,o)}Object.defineProperties(e,n)}};function NodeFrame(e){this.time=void 0!==e?e:0,this.id=0}function NodeUniform(e){this.name=(e=e||{}).name,this.type=e.type,this.node=e.node,this.needsUpdate=e.needsUpdate}function Vector2Node(e,t){InputNode.call(this,"v2"),this.value=e instanceof Vector2?e:new Vector2(e,t)}function Vector3Node(e,t,r){InputNode.call(this,"v3"),this.value=e instanceof Vector3?e:new Vector3(e,t,r)}function Vector4Node(e,t,r,n){InputNode.call(this,"v4"),this.value=e instanceof Vector4?e:new Vector4(e,t,r,n)}function UVNode(e){TempNode.call(this,"v2",{shared:!1}),this.index=e||0}function FloatNode(e){InputNode.call(this,"f"),this.value=e||0}function ColorSpaceNode(e,t){TempNode.call(this,"v4"),this.input=e,this.method=t||ColorSpaceNode.LINEAR_TO_LINEAR}function TextureNode(e,t,r,n){InputNode.call(this,"v4",{shared:!0}),this.value=e,this.uv=t||new UVNode,this.bias=r,this.project=void 0!==n&&n}function PositionNode(e){TempNode.call(this,"v3"),this.scope=e||PositionNode.LOCAL}function NormalNode(e){TempNode.call(this,"v3"),this.scope=e||NormalNode.VIEW}function ReflectNode(e){TempNode.call(this,"v3"),this.scope=e||ReflectNode.CUBE}function CubeTextureNode(e,t,r){InputNode.call(this,"v4",{shared:!0}),this.value=e,this.uv=t||new ReflectNode,this.bias=r}function OperatorNode(e,t,r){TempNode.call(this),this.a=e,this.b=t,this.op=r}function MathNode(e,t,r,n){TempNode.call(this),this.a=e,"string"!=typeof t?this.b=t:n=t,"string"!=typeof r?this.c=r:n=r,this.method=n}function TextureCubeUVNode(e,t,r){TempNode.call(this,"v4"),this.value=e,this.uv=t,this.bias=r}function TextureCubeNode(e,t,r){TempNode.call(this,"v4"),this.value=e,this.radianceNode=new TextureCubeUVNode(this.value,t||new ReflectNode(ReflectNode.VECTOR),r),this.irradianceNode=new TextureCubeUVNode(this.value,new NormalNode(NormalNode.WORLD),new FloatNode(1).setReadonly(!0))}NodeFrame.prototype={constructor:NodeFrame,update:function(e){return++this.id,this.time+=e,this.delta=e,this},setRenderer:function(e){return this.renderer=e,this},setRenderTexture:function(e){return this.renderTexture=e,this},updateNode:function(e){return e.frameId===this.id||(e.updateFrame(this),e.frameId=this.id),this}},Object.defineProperties(NodeUniform.prototype,{value:{get:function(){return this.node.value},set:function(e){this.node.value=e}}}),Vector2Node.prototype=Object.create(InputNode.prototype),(Vector2Node.prototype.constructor=Vector2Node).prototype.nodeType="Vector2",NodeUtils.addShortcuts(Vector2Node.prototype,"value",["x","y"]),Vector2Node.prototype.generateReadonly=function(e,t,r,n){return e.format("vec2( "+this.x+", "+this.y+" )",n,t)},Vector2Node.prototype.copy=function(e){return InputNode.prototype.copy.call(this,e),this.value.copy(e),this},Vector2Node.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).x=this.x,t.y=this.y,!0===this.readonly&&(t.readonly=!0)),t},Vector3Node.prototype=Object.create(InputNode.prototype),(Vector3Node.prototype.constructor=Vector3Node).prototype.nodeType="Vector3",NodeUtils.addShortcuts(Vector3Node.prototype,"value",["x","y","z"]),Vector3Node.prototype.generateReadonly=function(e,t,r,n){return e.format("vec3( "+this.x+", "+this.y+", "+this.z+" )",n,t)},Vector3Node.prototype.copy=function(e){return InputNode.prototype.copy.call(this,e),this.value.copy(e),this},Vector3Node.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).x=this.x,t.y=this.y,t.z=this.z,!0===this.readonly&&(t.readonly=!0)),t},Vector4Node.prototype=Object.create(InputNode.prototype),(Vector4Node.prototype.constructor=Vector4Node).prototype.nodeType="Vector4",NodeUtils.addShortcuts(Vector4Node.prototype,"value",["x","y","z","w"]),Vector4Node.prototype.generateReadonly=function(e,t,r,n){return e.format("vec4( "+this.x+", "+this.y+", "+this.z+", "+this.w+" )",n,t)},Vector4Node.prototype.copy=function(e){return InputNode.prototype.copy.call(this,e),this.value.copy(e),this},Vector4Node.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).x=this.x,t.y=this.y,t.z=this.z,t.w=this.w,!0===this.readonly&&(t.readonly=!0)),t},UVNode.prototype=Object.create(TempNode.prototype),(UVNode.prototype.constructor=UVNode).prototype.nodeType="UV",UVNode.prototype.generate=function(e,t){e.requires.uv[this.index]=!0;var r=0<this.index?this.index+1:"",r=e.isShader("vertex")?"uv"+r:"vUv"+r;return e.format(r,this.getType(e),t)},UVNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.index=e.index,this},UVNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).index=this.index),t},NodeLib.addKeyword("uv",function(){return new UVNode}),NodeLib.addKeyword("uv2",function(){return new UVNode(1)}),FloatNode.prototype=Object.create(InputNode.prototype),(FloatNode.prototype.constructor=FloatNode).prototype.nodeType="Float",FloatNode.prototype.generateReadonly=function(e,t,r,n){return e.format(this.value+(this.value%1?"":".0"),n,t)},FloatNode.prototype.copy=function(e){return InputNode.prototype.copy.call(this,e),this.value=e.value,this},FloatNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value,!0===this.readonly&&(t.readonly=!0)),t},ColorSpaceNode.Nodes=function(){var e=new FunctionNode(["vec4 LinearToLinear( in vec4 value ) {","\treturn value;","}"].join("\n")),t=new FunctionNode(["vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {","\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );","}"].join("\n")),r=new FunctionNode(["vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {","\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );","}"].join("\n")),n=new FunctionNode(["vec4 sRGBToLinear( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join("\n")),i=new FunctionNode(["vec4 LinearTosRGB( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join("\n")),o=new FunctionNode(["vec4 RGBEToLinear( in vec4 value ) {","\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );","}"].join("\n")),a=new FunctionNode(["vec4 LinearToRGBE( in vec4 value ) {","\tfloat maxComponent = max( max( value.r, value.g ), value.b );","\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );","\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );","}"].join("\n")),s=new FunctionNode(["vec3 RGBMToLinear( in vec4 value, in float maxRange ) {","\treturn vec4( value.xyz * value.w * maxRange, 1.0 );","}"].join("\n")),l=new FunctionNode(["vec3 LinearToRGBM( in vec4 value, in float maxRange ) {","\tfloat maxRGB = max( value.x, max( value.g, value.b ) );","\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );","\tM            = ceil( M * 255.0 ) / 255.0;","\treturn vec4( value.rgb / ( M * maxRange ), M );","}"].join("\n")),c=new FunctionNode(["vec3 RGBDToLinear( in vec4 value, in float maxRange ) {","\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );","}"].join("\n")),h=new FunctionNode(["vec3 LinearToRGBD( in vec4 value, in float maxRange ) {","\tfloat maxRGB = max( value.x, max( value.g, value.b ) );","\tfloat D      = max( maxRange / maxRGB, 1.0 );","\tD            = clamp( floor( D ) / 255.0, 0.0, 1.0 );","\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );","}"].join("\n")),u=new ConstNode("const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );"),A=new FunctionNode(["vec4 LinearToLogLuv( in vec4 value ) {","\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;","\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));","\tvec4 vResult;","\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;","\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;","\tvResult.w = fract(Le);","\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;","\treturn vResult;","}"].join("\n"),[u]),d=new ConstNode("const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );");return{LinearToLinear:e,GammaToLinear:t,LinearToGamma:r,sRGBToLinear:n,LinearTosRGB:i,RGBEToLinear:o,LinearToRGBE:a,RGBMToLinear:s,LinearToRGBM:l,RGBDToLinear:c,LinearToRGBD:h,cLogLuvM:u,LinearToLogLuv:A,cLogLuvInverseM:d,LogLuvToLinear:new FunctionNode(["vec4 LogLuvToLinear( in vec4 value ) {","\tfloat Le = value.z * 255.0 + value.w;","\tvec3 Xp_Y_XYZp;","\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);","\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;","\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;","\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;","\treturn vec4( max(vRGB, 0.0), 1.0 );","}"].join("\n"),[d])}}(),ColorSpaceNode.LINEAR_TO_LINEAR="LinearToLinear",ColorSpaceNode.GAMMA_TO_LINEAR="GammaToLinear",ColorSpaceNode.LINEAR_TO_GAMMA="LinearToGamma",ColorSpaceNode.SRGB_TO_LINEAR="sRGBToLinear",ColorSpaceNode.LINEAR_TO_SRGB="LinearTosRGB",ColorSpaceNode.RGBE_TO_LINEAR="RGBEToLinear",ColorSpaceNode.LINEAR_TO_RGBE="LinearToRGBE",ColorSpaceNode.RGBM_TO_LINEAR="RGBMToLinear",ColorSpaceNode.LINEAR_TO_RGBM="LinearToRGBM",ColorSpaceNode.RGBD_TO_LINEAR="RGBDToLinear",ColorSpaceNode.LINEAR_TO_RGBD="LinearToRGBD",ColorSpaceNode.LINEAR_TO_LOG_LUV="LinearToLogLuv",ColorSpaceNode.LOG_LUV_TO_LINEAR="LogLuvToLinear",ColorSpaceNode.getEncodingComponents=function(e){switch(e){case LinearEncoding:return["Linear"];case sRGBEncoding:return["sRGB"];case RGBEEncoding:return["RGBE"];case RGBM7Encoding:return["RGBM",new FloatNode(7).setReadonly(!0)];case RGBM16Encoding:return["RGBM",new FloatNode(16).setReadonly(!0)];case RGBDEncoding:return["RGBD",new FloatNode(256).setReadonly(!0)];case GammaEncoding:return["Gamma",new ExpressionNode("float( GAMMA_FACTOR )","f")]}},ColorSpaceNode.prototype=Object.create(TempNode.prototype),(ColorSpaceNode.prototype.constructor=ColorSpaceNode).prototype.nodeType="ColorSpace",ColorSpaceNode.prototype.hashProperties=["method"],ColorSpaceNode.prototype.generate=function(e,t){var r=this.input.build(e,"v4"),n=this.getType(e),i=ColorSpaceNode.Nodes[this.method],o=e.include(i);if(o===ColorSpaceNode.LINEAR_TO_LINEAR)return e.format(r,n,t);if(2!==i.inputs.length)return e.format(o+"( "+r+" )",n,t);i=this.factor.build(e,"f");return e.format(o+"( "+r+", "+i+" )",n,t)},ColorSpaceNode.prototype.fromEncoding=function(e){e=ColorSpaceNode.getEncodingComponents(e);this.method="LinearTo"+e[0],this.factor=e[1]},ColorSpaceNode.prototype.fromDecoding=function(e){e=ColorSpaceNode.getEncodingComponents(e);this.method=e[0]+"ToLinear",this.factor=e[1]},ColorSpaceNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.input=e.input,this.method=e.method,this},ColorSpaceNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).input=this.input.toJSON(e).uuid,t.method=this.method),t},TextureNode.prototype=Object.create(InputNode.prototype),(TextureNode.prototype.constructor=TextureNode).prototype.nodeType="Texture",TextureNode.prototype.getTexture=function(e,t){return InputNode.prototype.generate.call(this,e,t,this.value.uuid,"t")},TextureNode.prototype.generate=function(e,t){if("sampler2D"===t)return this.getTexture(e,t);var r=this.getTexture(e,t),n=this.uv.build(e,this.project?"v4":"v2"),i=this.bias?this.bias.build(e,"f"):void 0;void 0===i&&e.context.bias&&(i=e.context.bias.setTexture(this).build(e,"f"));var o=this.project?"texture2DProj":i?"tex2DBias":"tex2D",o=i?o+"( "+r+", "+n+", "+i+" )":o+"( "+r+", "+n+" )",r={include:e.isShader("vertex"),ignoreCache:!0},n=this.getType(e);return e.addContext(r),this.colorSpace=this.colorSpace||new ColorSpaceNode(new ExpressionNode("",n)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(o),o=this.colorSpace.build(e,n),e.removeContext(),e.format(o,n,t)},TextureNode.prototype.copy=function(e){return InputNode.prototype.copy.call(this,e),e.value&&(this.value=e.value),this.uv=e.uv,e.bias&&(this.bias=e.bias),void 0!==e.project&&(this.project=e.project),this},TextureNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.value&&(t.value=this.value.uuid),t.uv=this.uv.toJSON(e).uuid,t.project=this.project,this.bias&&(t.bias=this.bias.toJSON(e).uuid)),t},PositionNode.LOCAL="local",PositionNode.WORLD="world",PositionNode.VIEW="view",PositionNode.PROJECTION="projection",PositionNode.prototype=Object.create(TempNode.prototype),(PositionNode.prototype.constructor=PositionNode).prototype.nodeType="Position",PositionNode.prototype.getType=function(){return this.scope===PositionNode.PROJECTION?"v4":this.type},PositionNode.prototype.getShared=function(){switch(this.scope){case PositionNode.LOCAL:case PositionNode.WORLD:return!1}return!0},PositionNode.prototype.generate=function(e,t){var r;switch(this.scope){case PositionNode.LOCAL:r=e.isShader("vertex")?"transformed":(e.requires.position=!0,"vPosition");break;case PositionNode.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,r="vWPosition";break;case PositionNode.VIEW:r=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case PositionNode.PROJECTION:r=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )"}return e.format(r,this.getType(e),t)},PositionNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.scope=e.scope,this},PositionNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope),t},NodeLib.addKeyword("position",function(){return new PositionNode}),NodeLib.addKeyword("worldPosition",function(){return new PositionNode(PositionNode.WORLD)}),NodeLib.addKeyword("viewPosition",function(){return new PositionNode(PositionNode.VIEW)}),NormalNode.LOCAL="local",NormalNode.WORLD="world",NormalNode.VIEW="view",NormalNode.prototype=Object.create(TempNode.prototype),(NormalNode.prototype.constructor=NormalNode).prototype.nodeType="Normal",NormalNode.prototype.getShared=function(){return this.scope===NormalNode.WORLD},NormalNode.prototype.build=function(e,t,r,n){var i=e.context[this.scope+"Normal"];return i?i.build(e,t,r,n):TempNode.prototype.build.call(this,e,t,r)},NormalNode.prototype.generate=function(e,t){var r;switch(this.scope){case NormalNode.VIEW:r=e.isShader("vertex")?"transformedNormal":"geometryNormal";break;case NormalNode.LOCAL:r=e.isShader("vertex")?"objectNormal":(e.requires.normal=!0,"vObjectNormal");break;case NormalNode.WORLD:r=e.isShader("vertex")?"inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,"vWNormal")}return e.format(r,this.getType(e),t)},NormalNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.scope=e.scope,this},NormalNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope),t},NodeLib.addKeyword("viewNormal",function(){return new NormalNode(NormalNode.VIEW)}),NodeLib.addKeyword("localNormal",function(){return new NormalNode(NormalNode.NORMAL)}),NodeLib.addKeyword("worldNormal",function(){return new NormalNode(NormalNode.WORLD)}),ReflectNode.CUBE="cube",ReflectNode.SPHERE="sphere",ReflectNode.VECTOR="vector",ReflectNode.prototype=Object.create(TempNode.prototype),(ReflectNode.prototype.constructor=ReflectNode).prototype.nodeType="Reflect",ReflectNode.prototype.getUnique=function(e){return!e.context.viewNormal},ReflectNode.prototype.getType=function(){return this.scope===ReflectNode.SPHERE?"v2":this.type},ReflectNode.prototype.generate=function(e,t){var r=this.getUnique(e);if(e.isShader("fragment")){switch(this.scope){case ReflectNode.VECTOR:var n=new NormalNode(NormalNode.VIEW),i=e.context.roughness,o=n.build(e,"v3"),n=new PositionNode(PositionNode.VIEW).build(e,"v3"),i=i?i.build(e,"f"):void 0,n=`reflect( -normalize( ${n} ), ${o} )`,n=`inverseTransformDirection( ${n=i?`normalize( mix( ${n}, ${o}, ${i} * ${i} ) )`:n}, viewMatrix )`,a=r?(e.addNodeCode(`vec3 reflectVec = ${n};`),"reflectVec"):n;break;case ReflectNode.CUBE:n="vec3( -"+(s=new ReflectNode(ReflectNode.VECTOR).build(e,"v3"))+".x, "+s+".yz )";a=r?(e.addNodeCode(`vec3 reflectCubeVec = ${n};`),"reflectCubeVec"):n;break;case ReflectNode.SPHERE:var s,n="normalize( ( viewMatrix * vec4( "+(s=new ReflectNode(ReflectNode.VECTOR).build(e,"v3"))+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";a=r?(e.addNodeCode(`vec2 reflectSphereVec = ${n};`),"reflectSphereVec"):n}return e.format(a,this.getType(e),t)}return console.warn("THREE.ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)},ReflectNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope),t},CubeTextureNode.prototype=Object.create(InputNode.prototype),(CubeTextureNode.prototype.constructor=CubeTextureNode).prototype.nodeType="CubeTexture",CubeTextureNode.prototype.getTexture=function(e,t){return InputNode.prototype.generate.call(this,e,t,this.value.uuid,"tc")},CubeTextureNode.prototype.generate=function(e,t){if("samplerCube"===t)return this.getTexture(e,t);var r=this.getTexture(e,t),n=this.uv.build(e,"v3"),i=this.bias?this.bias.build(e,"f"):void 0,i=(i=void 0===i&&e.context.bias?e.context.bias.setTexture(this).build(e,"f"):i)?"texCubeBias( "+r+", "+n+", "+i+" )":"texCube( "+r+", "+n+" )",r={include:e.isShader("vertex"),ignoreCache:!0},n=this.getType(e);return e.addContext(r),this.colorSpace=this.colorSpace||new ColorSpaceNode(new ExpressionNode("",n)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(i),i=this.colorSpace.build(e,n),e.removeContext(),e.format(i,n,t)},CubeTextureNode.prototype.copy=function(e){return InputNode.prototype.copy.call(this,e),e.value&&(this.value=e.value),this.uv=e.uv,e.bias&&(this.bias=e.bias),this},CubeTextureNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.uuid,t.uv=this.uv.toJSON(e).uuid,this.bias&&(t.bias=this.bias.toJSON(e).uuid)),t},OperatorNode.ADD="+",OperatorNode.SUB="-",OperatorNode.MUL="*",OperatorNode.DIV="/",OperatorNode.prototype=Object.create(TempNode.prototype),(OperatorNode.prototype.constructor=OperatorNode).prototype.nodeType="Operator",OperatorNode.prototype.getType=function(e){var t=this.a.getType(e),r=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(r)>e.getTypeLength(t)?r:t},OperatorNode.prototype.generate=function(e,t){var r=this.getType(e),n=this.a.build(e,r),i=this.b.build(e,r);return e.format("( "+n+" "+this.op+" "+i+" )",r,t)},OperatorNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.a=e.a,this.b=e.b,this.op=e.op,this},OperatorNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).a=this.a.toJSON(e).uuid,t.b=this.b.toJSON(e).uuid,t.op=this.op),t},MathNode.RAD="radians",MathNode.DEG="degrees",MathNode.EXP="exp",MathNode.EXP2="exp2",MathNode.LOG="log",MathNode.LOG2="log2",MathNode.SQRT="sqrt",MathNode.INV_SQRT="inversesqrt",MathNode.FLOOR="floor",MathNode.CEIL="ceil",MathNode.NORMALIZE="normalize",MathNode.FRACT="fract",MathNode.SATURATE="saturate",MathNode.SIN="sin",MathNode.COS="cos",MathNode.TAN="tan",MathNode.ASIN="asin",MathNode.ACOS="acos",MathNode.ARCTAN="atan",MathNode.ABS="abs",MathNode.SIGN="sign",MathNode.LENGTH="length",MathNode.NEGATE="negate",MathNode.INVERT="invert",MathNode.MIN="min",MathNode.MAX="max",MathNode.MOD="mod",MathNode.STEP="step",MathNode.REFLECT="reflect",MathNode.DISTANCE="distance",MathNode.DOT="dot",MathNode.CROSS="cross",MathNode.POW="pow",MathNode.MIX="mix",MathNode.CLAMP="clamp",MathNode.REFRACT="refract",MathNode.SMOOTHSTEP="smoothstep",MathNode.FACEFORWARD="faceforward",MathNode.prototype=Object.create(TempNode.prototype),(MathNode.prototype.constructor=MathNode).prototype.nodeType="Math",MathNode.prototype.hashProperties=["method"],MathNode.prototype.getNumInputs=function(){switch(this.method){case MathNode.MIX:case MathNode.CLAMP:case MathNode.REFRACT:case MathNode.SMOOTHSTEP:case MathNode.FACEFORWARD:return 3;case MathNode.MIN:case MathNode.MAX:case MathNode.MOD:case MathNode.STEP:case MathNode.REFLECT:case MathNode.DISTANCE:case MathNode.DOT:case MathNode.CROSS:case MathNode.POW:return 2;default:return 1}},MathNode.prototype.getInputType=function(e){var t=e.getTypeLength(this.a.getType(e)),r=this.b?e.getTypeLength(this.b.getType(e)):0,n=this.c?e.getTypeLength(this.c.getType(e)):0;return(r<t&&n<t?this.a:n<r?this.b:this.c).getType(e)},MathNode.prototype.getType=function(e){switch(this.method){case MathNode.LENGTH:case MathNode.DISTANCE:case MathNode.DOT:return"f";case MathNode.CROSS:return"v3"}return this.getInputType(e)},MathNode.prototype.generate=function(e,t){var r,n,i,o=this.a?e.getTypeLength(this.a.getType(e)):0,a=this.b?e.getTypeLength(this.b.getType(e)):0,s=this.c?e.getTypeLength(this.c.getType(e)):0,l=this.getInputType(e),c=this.getType(e);switch(this.method){case MathNode.NEGATE:return e.format("( -"+this.a.build(e,l)+" )",l,t);case MathNode.INVERT:return e.format("( 1.0 - "+this.a.build(e,l)+" )",l,t);case MathNode.CROSS:r=this.a.build(e,"v3"),n=this.b.build(e,"v3");break;case MathNode.STEP:r=this.a.build(e,1===o?"f":l),n=this.b.build(e,l);break;case MathNode.MIN:case MathNode.MAX:case MathNode.MOD:r=this.a.build(e,l),n=this.b.build(e,1===a?"f":l);break;case MathNode.REFRACT:r=this.a.build(e,l),n=this.b.build(e,l),i=this.c.build(e,"f");break;case MathNode.MIX:r=this.a.build(e,l),n=this.b.build(e,l),i=this.c.build(e,1===s?"f":l);break;default:r=this.a.build(e,l),this.b&&(n=this.b.build(e,l)),this.c&&(i=this.c.build(e,l))}var h=[];h.push(r),n&&h.push(n),i&&h.push(i);var u=this.getNumInputs(e);if(h.length!==u)throw Error(`Arguments not match used in "${this.method}". Require ${u}, currently ${h.length}.`);return e.format(this.method+"( "+h.join(", ")+" )",c,t)},MathNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.a=e.a,this.b=e.b,this.c=e.c,this.method=e.method,this},MathNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).a=this.a.toJSON(e).uuid,this.b&&(t.b=this.b.toJSON(e).uuid),this.c&&(t.c=this.c.toJSON(e).uuid),t.method=this.method),t},TextureCubeUVNode.Nodes=function(){var e=new StructNode(`struct TextureCubeUVData {
			vec4 tl;
			vec4 tr;
			vec4 br;
			vec4 bl;
			vec2 f;
		}`),t=new ConstNode("float cubeUV_maxMipLevel 8.0",!0),r=new ConstNode("float cubeUV_minMipLevel 4.0",!0),n=new ConstNode("float cubeUV_maxTileSize 256.0",!0),i=new ConstNode("float cubeUV_minTileSize 16.0",!0),o=new FunctionNode(`float getFace(vec3 direction) {
				vec3 absDirection = abs(direction);
				float face = -1.0;
				if (absDirection.x > absDirection.z) {
					if (absDirection.x > absDirection.y)
						face = direction.x > 0.0 ? 0.0 : 3.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				} else {
					if (absDirection.z > absDirection.y)
						face = direction.z > 0.0 ? 2.0 : 5.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				}
				return face;
		}`);o.useKeywords=!1;var a=new FunctionNode(`vec2 getUV(vec3 direction, float face) {
				vec2 uv;
				if (face == 0.0) {
					uv = vec2(direction.z, direction.y) / abs(direction.x); // pos x
				} else if (face == 1.0) {
					uv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y
				} else if (face == 2.0) {
					uv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z
				} else if (face == 3.0) {
					uv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x
				} else if (face == 4.0) {
					uv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y
				} else {
					uv = vec2(direction.x, direction.y) / abs(direction.z); // neg z
				}
				return 0.5 * (uv + 1.0);
		}`);a.useKeywords=!1;a=new FunctionNode(`TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {

			float face = getFace(direction);
			float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
			mipInt = max(mipInt, cubeUV_minMipLevel);
			float faceSize = exp2(mipInt);

			float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);

			vec2 uv = getUV(direction, face) * (faceSize - 1.0);
			vec2 f = fract(uv);
			uv += 0.5 - f;
			if (face > 2.0) {
				uv.y += faceSize;
				face -= 3.0;
			}
			uv.x += face * faceSize;
			if(mipInt < cubeUV_maxMipLevel){
				uv.y += 2.0 * cubeUV_maxTileSize;
			}
			uv.y += filterInt * 2.0 * cubeUV_minTileSize;
			uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
			uv *= texelSize;

			vec4 tl = texture2D(envMap, uv);
			uv.x += texelSize;
			vec4 tr = texture2D(envMap, uv);
			uv.y += texelSize;
			vec4 br = texture2D(envMap, uv);
			uv.x -= texelSize;
			vec4 bl = texture2D(envMap, uv);

			return TextureCubeUVData( tl, tr, br, bl, f );
		}`,[e,o,a,t,r,n,i]),r=new ConstNode("float r0 1.0",!(a.useKeywords=!1)),n=new ConstNode("float v0 0.339",!0),i=new ConstNode("float m0 -2.0",!0);return{bilinearCubeUV:a,roughnessToMip:new FunctionNode(`float roughnessToMip(float roughness) {
			float mip = 0.0;
			if (roughness >= r1) {
				mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
			} else if (roughness >= r4) {
				mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
			} else if (roughness >= r5) {
				mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
			} else if (roughness >= r6) {
				mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
			} else {
				mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
			}
			return mip;
		}`,[r,n,i,new ConstNode("float r1 0.8",!0),new ConstNode("float v1 0.276",!0),new ConstNode("float m1 -1.0",!0),new ConstNode("float r4 0.4",!0),new ConstNode("float v4 0.046",!0),new ConstNode("float m4 2.0",!0),new ConstNode("float r5 0.305",!0),new ConstNode("float v5 0.016",!0),new ConstNode("float m5 3.0",!0),new ConstNode("float r6 0.21",!0),new ConstNode("float v6 0.0038",!0),new ConstNode("float m6 4.0",!0)]),m0:i,cubeUV_maxMipLevel:t}}(),TextureCubeUVNode.prototype=Object.create(TempNode.prototype),(TextureCubeUVNode.prototype.constructor=TextureCubeUVNode).prototype.nodeType="TextureCubeUV",TextureCubeUVNode.prototype.bilinearCubeUV=function(e,t,r,n){r=new FunctionCallNode(TextureCubeUVNode.Nodes.bilinearCubeUV,[t,r,n]);this.colorSpaceTL=this.colorSpaceTL||new ColorSpaceNode(new ExpressionNode("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(r.build(e)+".tl"),this.colorSpaceTR=this.colorSpaceTR||new ColorSpaceNode(new ExpressionNode("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(r.build(e)+".tr"),this.colorSpaceBL=this.colorSpaceBL||new ColorSpaceNode(new ExpressionNode("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(r.build(e)+".bl"),this.colorSpaceBR=this.colorSpaceBR||new ColorSpaceNode(new ExpressionNode("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(r.build(e)+".br");n={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(n),this.colorSpaceTLExp=new ExpressionNode(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new ExpressionNode(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new ExpressionNode(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new ExpressionNode(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();e=new ExpressionNode("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return e.keywords.cubeUV_TL=this.colorSpaceTLExp,e.keywords.cubeUV_TR=this.colorSpaceTRExp,e.keywords.cubeUV_BL=this.colorSpaceBLExp,e.keywords.cubeUV_BR=this.colorSpaceBRExp,e.keywords.cubeUV=r,e},TextureCubeUVNode.prototype.generate=function(e,t){if(e.isShader("fragment")){var r=this.uv,n=this.bias||e.context.roughness,i=new MathNode(new FunctionCallNode(TextureCubeUVNode.Nodes.roughnessToMip,[n]),TextureCubeUVNode.Nodes.m0,TextureCubeUVNode.Nodes.cubeUV_maxMipLevel,MathNode.CLAMP),n=new MathNode(i,MathNode.FLOOR),i=new MathNode(i,MathNode.FRACT),i=new MathNode(this.bilinearCubeUV(e,this.value,r,n),this.bilinearCubeUV(e,this.value,r,new OperatorNode(n,new FloatNode(1).setReadonly(!0),OperatorNode.ADD)),i,MathNode.MIX);return e.format(i.build(e),"v4",t)}return console.warn("THREE.TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)},TextureCubeUVNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid,t.uv=this.uv.toJSON(e).uuid,t.bias=this.bias.toJSON(e).uuid),t},TextureCubeNode.prototype=Object.create(TempNode.prototype),(TextureCubeNode.prototype.constructor=TextureCubeNode).prototype.nodeType="TextureCube",TextureCubeNode.prototype.generate=function(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),("irradiance"===e.slot?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("THREE.TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))},TextureCubeNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.value=e.value,this},TextureCubeNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid),t};var elements=NodeUtils.elements,constructors=["float","vec2","vec3","vec4"],convertFormatToType={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b"},convertTypeToFormat={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4"};function NodeBuilder(){this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.requires={uv:[],color:[],lights:!1,fog:!1,transparent:!1,irradiance:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCube(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif","#include <packing>","#include <common>"].join("\n"),this.parsCode={vertex:"",fragment:""},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={},this.updaters=[],this.nodes=[],this.analyzing=!1}function BoolNode(e){InputNode.call(this,"b"),this.value=Boolean(e)}function IntNode(e){InputNode.call(this,"i"),this.value=Math.floor(e||0)}function ColorNode(e,t,r){InputNode.call(this,"c"),this.value=e instanceof Color?e:new Color(e||0,t,r)}function Matrix3Node(e){InputNode.call(this,"m3"),this.value=e||new Matrix3}function Matrix4Node(e){InputNode.call(this,"m4"),this.value=e||new Matrix4}function ScreenNode(e){TextureNode.call(this,void 0,e)}function ReflectorNode(e){TempNode.call(this,"v4"),e&&this.setMirror(e)}function PropertyNode(e,t,r){InputNode.call(this,r),this.object=e,this.property=t}function RawNode(e){Node$2.call(this,"v4"),this.value=e}function NodeMaterial(e,t){ShaderMaterial.call(this),this.vertex=e||new RawNode(new PositionNode(PositionNode.PROJECTION)),this.fragment=t||new RawNode(new ColorNode(16711680)),this.updaters=[]}function RTTNode(e,t,r,n){n=n||{},this.input=r,this.clear=void 0===n.clear||n.clear,this.renderTarget=new WebGLRenderTarget(e,t,n),this.material=new NodeMaterial,this.camera=new OrthographicCamera(-1,1,1,-1,0,1),this.scene=new Scene,this.quad=new Mesh(new PlaneGeometry(2,2),this.material),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.render=!0,TextureNode.call(this,this.renderTarget.texture)}NodeBuilder.prototype={constructor:NodeBuilder,build:function(e,t){this.buildShader("vertex",e),this.buildShader("fragment",t);for(var r,n=0;n<this.requires.uv.length;n++)this.requires.uv[n]&&(this.addVaryCode("varying vec2 vUv"+(r=0<n?n+1:"")+";"),0<n&&this.addVertexParsCode("attribute vec2 uv"+r+";"),this.addVertexFinalCode("vUv"+r+" = uv"+r+";"));return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition&&(this.addVaryCode("varying vec3 vWPosition;"),this.addVertexFinalCode("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;")),this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this},buildShader:function(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")},setMaterial:function(e,t){return this.material=e,this.renderer=t,this.requires.lights=e.lights,this.requires.fog=e.fog,this.mergeDefines(e.defines),this},addFlow:function(e,t,r){return this.addSlot(e).addCache(t).addContext(r)},removeFlow:function(){return this.removeSlot().removeCache().removeContext()},addCache:function(e){return this.cache=e||"",this.caches.push(this.cache),this},removeCache:function(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this},addContext:function(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this},removeContext:function(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this},addSlot:function(e){return this.slot=e||"",this.slots.push(this.slot),this},removeSlot:function(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this},addVertexCode:function(e){this.addCode(e,"vertex")},addFragmentCode:function(e){this.addCode(e,"fragment")},addCode:function(e,t){this.code[t||this.shader]+=e+"\n"},addVertexNodeCode:function(e){this.addNodeCode(e,"vertex")},addFragmentNodeCode:function(e){this.addNodeCode(e,"fragment")},addNodeCode:function(e,t){this.nodeCode[t||this.shader]+=e+"\n"},clearNodeCode:function(e){e=e||this.shader;var t=this.nodeCode[e];return this.nodeCode[e]="",t},clearVertexNodeCode:function(){return this.clearNodeCode("vertex")},clearFragmentNodeCode:function(){return this.clearNodeCode("fragment")},addVertexFinalCode:function(e){this.addFinalCode(e,"vertex")},addFragmentFinalCode:function(e){this.addFinalCode(e,"fragment")},addFinalCode:function(e,t){this.finalCode[t||this.shader]+=e+"\n"},addVertexParsCode:function(e){this.addParsCode(e,"vertex")},addFragmentParsCode:function(e){this.addParsCode(e,"fragment")},addParsCode:function(e,t){this.parsCode[t||this.shader]+=e+"\n"},addVaryCode:function(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)},isCache:function(e){return-1!==this.caches.indexOf(e)},isSlot:function(e){return-1!==this.slots.indexOf(e)},define:function(e,t){this.defines[e]=void 0===t?1:t},require:function(e){this.requires[e]=!0},isDefined:function(e){return void 0!==this.defines[e]},getVar:function(e,t,r,n="varying",i="V",o=""){var a=this.getVars(n),s=a[e];return s||(n=a.length,a.push(s={name:r||"node"+i+n+(o?"_"+o:""),type:t}),a[e]=s),s},getTempVar:function(e,t,r,n){return this.getVar(e,t,r,this.shader,"T",n)},getAttribute:function(e,t){var r;return this.attributes[e]||(r=this.getVar(e,t),this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(r.name+" = "+e+";"),this.attributes[e]={varying:r,name:e,type:t}),this.attributes[e]},getCode:function(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join("\n")},getVarListCode:function(e,t){t=t||"";for(var r="",n=0,i=e.length;n<i;++n){var o=e[n],a=o.type,o=o.name,a=this.getFormatByType(a);if(void 0===a)throw new Error("Node pars "+a+" not found.");r+=t+" "+a+" "+o+";\n"}return r},getVars:function(e){return this.inputs.vars[e||this.shader]},getNodeData:function(e){e=e.isNode?e.uuid:e;return this.nodeData[e]=this.nodeData[e]||{}},createUniform:function(e,t,r,n,i,o){var a=this.inputs.uniforms,s=a.list.length,i=new NodeUniform({type:t,name:n||"nodeU"+s+(o?"_"+o:""),node:r,needsUpdate:i});return a.list.push(i),a[e].push(i),a[e][i.name]=i,this.uniforms[i.name]=i},createVertexUniform:function(e,t,r,n,i){return this.createUniform("vertex",e,t,r,n,i)},createFragmentUniform:function(e,t,r,n,i){return this.createUniform("fragment",e,t,r,n,i)},include:function(e,t,r){if(e="string"==typeof e?NodeLib.get(e):e,!1===this.context.include)return e.name;e instanceof FunctionNode?i=this.includes.functions:e instanceof ConstNode?i=this.includes.consts:e instanceof StructNode&&(i=this.includes.structs);var n=i[this.shader]=i[this.shader]||[];if(e){var i=n[e.name];if(i||(i=n[e.name]={node:e,deps:[]},n.push(i),i.src=e.build(this,"source")),e instanceof FunctionNode&&t&&n[t.name]&&-1==n[t.name].deps.indexOf(e)&&(n[t.name].deps.push(e),e.includes&&e.includes.length))for(var o=0;this.include(e.includes[o++],t),o<e.includes.length;);return r&&(i.src=r),e.name}throw new Error("Include not found.")},colorToVectorProperties:function(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")},colorToVector:function(e){return e.replace(/c/g,"v3")},getIncludes:function(e,t){return this.includes[e][t||this.shader]},getIncludesCode:function(){function o(e,t){return e.deps.length-t.deps.length}return function(e,t){if(!(n=this.getIncludes(e,t)))return"";for(var r="",n=n.sort(o),i=0;i<n.length;i++)n[i].src&&(r+=n[i].src+"\n");return r}}(),getConstructorFromLength:function(e){return constructors[e-1]},isTypeMatrix:function(e){return/^m/.test(e)},getTypeLength:function(e){return"f"===e?1:parseInt(this.colorToVector(e).substr(1))},getTypeFromLength:function(e){return 1===e?"f":"v"+e},findNode:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];if(void 0!==t&&t.isNode)return t}},resolve:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];if(void 0!==t){if(t.isNode)return t;if(t.isTexture)switch(t.mapping){case CubeReflectionMapping:case CubeRefractionMapping:return new CubeTextureNode(t);case CubeUVReflectionMapping:case CubeUVRefractionMapping:return new TextureCubeNode(new TextureNode(t));default:return new TextureNode(t)}else{if(t.isVector2)return new Vector2Node(t);if(t.isVector3)return new Vector3Node(t);if(t.isVector4)return new Vector4Node(t)}}}},format:function(e,t,r){switch(this.colorToVector(r+" <- "+t)){case"f <- v2":case"f <- v3":case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":case"i <- v3":case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e},getTypeByFormat:function(e){return convertFormatToType[e]||e},getFormatByType:function(e){return convertTypeToFormat[e]||e},getUuid:function(e,t){return e=(t=void 0===t||t)&&this.cache?this.cache+"-"+e:e},getElementByIndex:function(e){return elements[e]},getIndexByElement:function(e){return elements.indexOf(e)},isShader:function(e){return this.shader===e},setShader:function(e){return this.shader=e,this},mergeDefines:function(e){for(var t in e)this.defines[t]=e[t];return this.defines},mergeUniform:function(e){for(var t in e)this.uniforms[t]=e[t];return this.uniforms},getTextureEncodingFromMap:function(e){var t;return e?e.isTexture?t=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=LinearEncoding,t=t===LinearEncoding&&this.context.gamma?GammaEncoding:t}},BoolNode.prototype=Object.create(InputNode.prototype),(BoolNode.prototype.constructor=BoolNode).prototype.nodeType="Bool",BoolNode.prototype.generateReadonly=function(e,t,r,n){return e.format(this.value,n,t)},BoolNode.prototype.copy=function(e){return InputNode.prototype.copy.call(this,e),this.value=e.value,this},BoolNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value,!0===this.readonly&&(t.readonly=!0)),t},IntNode.prototype=Object.create(InputNode.prototype),(IntNode.prototype.constructor=IntNode).prototype.nodeType="Int",IntNode.prototype.generateReadonly=function(e,t,r,n){return e.format(this.value,n,t)},IntNode.prototype.copy=function(e){return InputNode.prototype.copy.call(this,e),this.value=e.value,this},IntNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value,!0===this.readonly&&(t.readonly=!0)),t},ColorNode.prototype=Object.create(InputNode.prototype),(ColorNode.prototype.constructor=ColorNode).prototype.nodeType="Color",NodeUtils.addShortcuts(ColorNode.prototype,"value",["r","g","b"]),ColorNode.prototype.generateReadonly=function(e,t,r,n){return e.format("vec3( "+this.r+", "+this.g+", "+this.b+" )",n,t)},ColorNode.prototype.copy=function(e){return InputNode.prototype.copy.call(this,e),this.value.copy(e),this},ColorNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).r=this.r,t.g=this.g,t.b=this.b,!0===this.readonly&&(t.readonly=!0)),t},Matrix3Node.prototype=Object.create(InputNode.prototype),(Matrix3Node.prototype.constructor=Matrix3Node).prototype.nodeType="Matrix3",Object.defineProperties(Matrix3Node.prototype,{elements:{set:function(e){this.value.elements=e},get:function(){return this.value.elements}}}),Matrix3Node.prototype.generateReadonly=function(e,t,r,n){return e.format("mat3( "+this.value.elements.join(", ")+" )",n,t)},Matrix3Node.prototype.copy=function(e){return InputNode.prototype.copy.call(this,e),this.value.fromArray(e.elements),this},Matrix3Node.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).elements=this.value.elements.concat()),t},Matrix4Node.prototype=Object.create(InputNode.prototype),(Matrix4Node.prototype.constructor=Matrix4Node).prototype.nodeType="Matrix4",Object.defineProperties(Matrix4Node.prototype,{elements:{set:function(e){this.value.elements=e},get:function(){return this.value.elements}}}),Matrix4Node.prototype.generateReadonly=function(e,t,r,n){return e.format("mat4( "+this.value.elements.join(", ")+" )",n,t)},Matrix4Node.prototype.copy=function(e){return InputNode.prototype.copy.call(this,e),this.scope.value.fromArray(e.elements),this},Matrix4Node.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).elements=this.value.elements.concat()),t},ScreenNode.prototype=Object.create(TextureNode.prototype),(ScreenNode.prototype.constructor=ScreenNode).prototype.nodeType="Screen",ScreenNode.prototype.getUnique=function(){return!0},ScreenNode.prototype.getTexture=function(e,t){return InputNode.prototype.generate.call(this,e,t,this.getUuid(),"t","renderTexture")},ReflectorNode.prototype=Object.create(TempNode.prototype),(ReflectorNode.prototype.constructor=ReflectorNode).prototype.nodeType="Reflector",ReflectorNode.prototype.setMirror=function(e){this.mirror=e,this.textureMatrix=new Matrix4Node(this.mirror.material.uniforms.textureMatrix.value),this.localPosition=new PositionNode(PositionNode.LOCAL),this.uv=new OperatorNode(this.textureMatrix,this.localPosition,OperatorNode.MUL),this.uvResult=new OperatorNode(null,this.uv,OperatorNode.ADD),this.texture=new TextureNode(this.mirror.material.uniforms.tDiffuse.value,this.uv,null,!0)},ReflectorNode.prototype.generate=function(e,t){return e.isShader("fragment")?(this.uvResult.a=this.offset,this.texture.uv=this.offset?this.uvResult:this.uv,"sampler2D"===t?this.texture.build(e,t):e.format(this.texture.build(e,this.type),this.type,t)):(console.warn("THREE.ReflectorNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.type,t))},ReflectorNode.prototype.copy=function(e){return InputNode.prototype.copy.call(this,e),this.scope.mirror=e.mirror,this},ReflectorNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).mirror=this.mirror.uuid,this.offset&&(t.offset=this.offset.toJSON(e).uuid)),t},PropertyNode.prototype=Object.create(InputNode.prototype),(PropertyNode.prototype.constructor=PropertyNode).prototype.nodeType="Property",Object.defineProperties(PropertyNode.prototype,{value:{get:function(){return this.object[this.property]},set:function(e){this.object[this.property]=e}}}),PropertyNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value,t.property=this.property),t},RawNode.prototype=Object.create(Node$2.prototype),(RawNode.prototype.constructor=RawNode).prototype.nodeType="Raw",RawNode.prototype.generate=function(e){var t=this.value.analyzeAndFlow(e,this.type),r=t.code+"\n";return e.isShader("vertex")?r+="gl_Position = "+t.result+";":r+="gl_FragColor = "+t.result+";",r},RawNode.prototype.copy=function(e){return Node$2.prototype.copy.call(this,e),this.value=e.value,this},RawNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid),t},NodeMaterial.prototype=Object.create(ShaderMaterial.prototype),(NodeMaterial.prototype.constructor=NodeMaterial).prototype.type="NodeMaterial",NodeMaterial.prototype.isNodeMaterial=!0,Object.defineProperties(NodeMaterial.prototype,{properties:{get:function(){return this.fragment.properties}},needsUpdate:{set:function(e){!0===e&&this.version++,this.needsCompile=e},get:function(){return this.needsCompile}}}),NodeMaterial.prototype.onBeforeCompile=function(e,t){this.build({renderer:t}),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=!0===this.extensions.derivatives,e.extensionFragDepth=!0===this.extensions.fragDepth,e.extensionDrawBuffers=!0===this.extensions.drawBuffers,e.extensionShaderTextureLOD=!0===this.extensions.shaderTextureLOD},NodeMaterial.prototype.customProgramCacheKey=function(){return this.getHash()},NodeMaterial.prototype.getHash=function(){var e="{";return e+='"vertex":'+this.vertex.getHash()+",",e+='"fragment":'+this.fragment.getHash(),e+="}"},NodeMaterial.prototype.updateFrame=function(e){for(var t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])},NodeMaterial.prototype.build=function(e){var t=(e=e||{}).builder||new NodeBuilder;return t.setMaterial(this,e.renderer),t.build(this.vertex,this.fragment),this.vertexShader=t.getCode("vertex"),this.fragmentShader=t.getCode("fragment"),this.defines=t.defines,this.uniforms=t.uniforms,this.extensions=t.extensions,this.updaters=t.updaters,this.fog=t.requires.fog,this.lights=t.requires.lights,this.transparent=t.requires.transparent||this.blending>NormalBlending,this},NodeMaterial.prototype.copy=function(e){var t,r=this.uuid;for(t in e)this[t]=e[t];return this.uuid=r,void 0!==e.userData&&(this.userData=JSON.parse(JSON.stringify(e.userData))),this},NodeMaterial.prototype.toJSON=function(e){var t;return(e=void 0===e||"string"==typeof e?{nodes:{}}:e)&&!e.materials&&(e.materials={}),e.materials[this.uuid]||((t={}).uuid=this.uuid,t.type=this.type,e.materials[t.uuid]=t,""!==this.name&&(t.name=this.name),void 0!==this.size&&(t.size=this.size),void 0!==this.sizeAttenuation&&(t.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(t.blending=this.blending),!0===this.flatShading&&(t.flatShading=this.flatShading),this.side!==FrontSide&&(t.side=this.side),this.vertexColors!==NoColors&&(t.vertexColors=this.vertexColors),this.depthFunc!==LessEqualDepth&&(t.depthFunc=this.depthFunc),!1===this.depthTest&&(t.depthTest=this.depthTest),!1===this.depthWrite&&(t.depthWrite=this.depthWrite),1!==this.linewidth&&(t.linewidth=this.linewidth),void 0!==this.dashSize&&(t.dashSize=this.dashSize),void 0!==this.gapSize&&(t.gapSize=this.gapSize),void 0!==this.scale&&(t.scale=this.scale),!0===this.dithering&&(t.dithering=!0),!0===this.wireframe&&(t.wireframe=this.wireframe),1<this.wireframeLinewidth&&(t.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(t.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(t.wireframeLinejoin=this.wireframeLinejoin),0<this.alphaTest&&(t.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(t.premultipliedAlpha=this.premultipliedAlpha),!0===this.morphTargets&&(t.morphTargets=!0),!0===this.skinning&&(t.skinning=!0),!1===this.visible&&(t.visible=!1),"{}"!==JSON.stringify(this.userData)&&(t.userData=this.userData),t.fog=this.fog,t.lights=this.lights,t.vertex=this.vertex.toJSON(e).uuid,t.fragment=this.fragment.toJSON(e).uuid),e.material=this.uuid,e},RTTNode.prototype=Object.create(TextureNode.prototype),(RTTNode.prototype.constructor=RTTNode).prototype.nodeType="RTT",RTTNode.prototype.build=function(e,t,r){var n=new NodeBuilder;return n.nodes=e.nodes,n.updaters=e.updaters,this.material.fragment.value=this.input,this.material.build({builder:n}),TextureNode.prototype.build.call(this,e,t,r)},RTTNode.prototype.updateFramesaveTo=function(e){var t,r,n;this.saveTo.render=!1,this.saveTo!==this.saveToCurrent&&(this.saveToMaterial&&this.saveToMaterial.dispose(),(t=new NodeMaterial).fragment.value=this,t.build(),r=new Scene,(n=new Mesh(new PlaneGeometry(2,2),t)).frustumCulled=!1,r.add(n),this.saveToScene=r,this.saveToMaterial=t),this.saveToCurrent=this.saveTo,e.renderer.setRenderTarget(this.saveTo.renderTarget),this.saveTo.clear&&e.renderer.clear(),e.renderer.render(this.saveToScene,this.camera)},RTTNode.prototype.updateFrame=function(e){e.renderer?(this.saveTo&&!1===this.saveTo.render&&this.updateFramesaveTo(e),this.render&&(this.material.uniforms.renderTexture&&(this.material.uniforms.renderTexture.value=e.renderTexture),e.renderer.setRenderTarget(this.renderTarget),this.clear&&e.renderer.clear(),e.renderer.render(this.scene,this.camera)),this.saveTo&&!0===this.saveTo.render&&this.updateFramesaveTo(e)):console.warn("RTTNode need a renderer in NodeFrame")},RTTNode.prototype.copy=function(e){return TextureNode.prototype.copy.call(this,e),this.saveTo=e.saveTo,this},RTTNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=TextureNode.prototype.toJSON.call(this,e),this.saveTo&&(t.saveTo=this.saveTo.toJSON(e).uuid)),t};var vertexDict=["color","color2"],fragmentDict=["vColor","vColor2"];function ColorsNode(e){TempNode.call(this,"v4",{shared:!1}),this.index=e||0}function CameraNode(e,t){TempNode.call(this,"v3"),this.setScope(e||CameraNode.POSITION),this.setCamera(t)}function LightNode(e){TempNode.call(this,"v3",{shared:!1}),this.scope=e||LightNode.TOTAL}function ResolutionNode(){Vector2Node.call(this),this.size=new Vector2}function ScreenUVNode(e){TempNode.call(this,"v2"),this.resolution=e||new ResolutionNode}function CondNode(e,t,r,n,i){TempNode.call(this),this.a=e,this.b=t,this.op=r,this.ifNode=n,this.elseNode=i}function NoiseNode(e){TempNode.call(this,"f"),this.uv=e||new UVNode}function CheckerNode(e){TempNode.call(this,"f"),this.uv=e||new UVNode}function NormalMapNode(e,t){TempNode.call(this,"v3"),this.value=e,this.scale=t||new Vector2Node(1,1)}function BumpMapNode(e,t){TempNode.call(this,"v3"),this.value=e,this.scale=t||new FloatNode(1),this.toNormalMap=!1}function BypassNode(e,t){Node$2.call(this),this.code=e,this.value=t}ColorsNode.prototype=Object.create(TempNode.prototype),(ColorsNode.prototype.constructor=ColorsNode).prototype.nodeType="Colors",ColorsNode.prototype.generate=function(e,t){e.requires.color[this.index]=!0;var r=(e.isShader("vertex")?vertexDict:fragmentDict)[this.index];return e.format(r,this.getType(e),t)},ColorsNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.index=e.index,this},ColorsNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).index=this.index),t},CameraNode.Nodes={depthColor:new FunctionNode(["float depthColor( float mNear, float mFar ) {","\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\treturn 1.0 - smoothstep( mNear, mFar, depth );","}"].join("\n"))},CameraNode.POSITION="position",CameraNode.DEPTH="depth",CameraNode.TO_VERTEX="toVertex",CameraNode.prototype=Object.create(TempNode.prototype),(CameraNode.prototype.constructor=CameraNode).prototype.nodeType="Camera",CameraNode.prototype.setCamera=function(e){this.camera=e,this.updateFrame=void 0!==e?this.onUpdateFrame:void 0},CameraNode.prototype.setScope=function(e){this.scope===CameraNode.DEPTH&&(delete this.near,delete this.far),(this.scope=e)===CameraNode.DEPTH&&(e=this.camera,this.near=new FloatNode(e?e.near:1),this.far=new FloatNode(e?e.far:1200))},CameraNode.prototype.getType=function(){return this.scope===CameraNode.DEPTH?"f":this.type},CameraNode.prototype.getUnique=function(){switch(this.scope){case CameraNode.DEPTH:case CameraNode.TO_VERTEX:return!0}return!1},CameraNode.prototype.getShared=function(){return this.scope!==CameraNode.POSITION},CameraNode.prototype.generate=function(e,t){switch(this.scope){case CameraNode.POSITION:r="cameraPosition";break;case CameraNode.DEPTH:var r=e.include(CameraNode.Nodes.depthColor)+"( "+this.near.build(e,"f")+", "+this.far.build(e,"f")+" )";break;case CameraNode.TO_VERTEX:r="normalize( "+new PositionNode(PositionNode.WORLD).build(e,"v3")+" - cameraPosition )"}return e.format(r,this.getType(e),t)},CameraNode.prototype.onUpdateFrame=function(){var e;this.scope===CameraNode.DEPTH&&(e=this.camera,this.near.value=e.near,this.far.value=e.far)},CameraNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.setScope(e.scope),e.camera&&this.setCamera(e.camera),e.scope===CameraNode.DEPTH&&(this.near.number=e.near,this.far.number=e.far),this},CameraNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope,this.camera&&(t.camera=this.camera.uuid),this.scope===CameraNode.DEPTH&&(t.near=this.near.value,t.far=this.far.value)),t},LightNode.TOTAL="total",LightNode.prototype=Object.create(TempNode.prototype),(LightNode.prototype.constructor=LightNode).prototype.nodeType="Light",LightNode.prototype.generate=function(e,t){return e.isCache("light")?e.format("reflectedLight.directDiffuse",this.type,t):(console.warn('THREE.LightNode is only compatible in "light" channel.'),e.format("vec3( 0.0 )",this.type,t))},LightNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.scope=e.scope,this},LightNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope),t},ResolutionNode.prototype=Object.create(Vector2Node.prototype),(ResolutionNode.prototype.constructor=ResolutionNode).prototype.nodeType="Resolution",ResolutionNode.prototype.updateFrame=function(e){e.renderer?(e.renderer.getSize(this.size),e=e.renderer.getPixelRatio(),this.x=this.size.width*e,this.y=this.size.height*e):console.warn("ResolutionNode need a renderer in NodeFrame")},ResolutionNode.prototype.copy=function(e){return Vector2Node.prototype.copy.call(this,e),this.renderer=e.renderer,this},ResolutionNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).renderer=this.renderer.uuid),t},ScreenUVNode.prototype=Object.create(TempNode.prototype),(ScreenUVNode.prototype.constructor=ScreenUVNode).prototype.nodeType="ScreenUV",ScreenUVNode.prototype.generate=function(e,t){var r=e.isShader("fragment")?"( gl_FragCoord.xy / "+this.resolution.build(e,"v2")+")":(console.warn("THREE.ScreenUVNode is not compatible with "+e.shader+" shader."),"vec2( 0.0 )");return e.format(r,this.getType(e),t)},ScreenUVNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.resolution=e.resolution,this},ScreenUVNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).resolution=this.resolution.toJSON(e).uuid),t},CondNode.EQUAL="==",CondNode.NOT_EQUAL="!=",CondNode.GREATER=">",CondNode.GREATER_EQUAL=">=",CondNode.LESS="<",CondNode.LESS_EQUAL="<=",CondNode.AND="&&",CondNode.OR="||",CondNode.prototype=Object.create(TempNode.prototype),(CondNode.prototype.constructor=CondNode).prototype.nodeType="Cond",CondNode.prototype.getType=function(e){if(this.ifNode){var t=this.ifNode.getType(e),r=this.elseNode.getType(e);return e.getTypeLength(r)>e.getTypeLength(t)?r:t}return"b"},CondNode.prototype.getCondType=function(e){return(e.getTypeLength(this.b.getType(e))>e.getTypeLength(this.a.getType(e))?this.b:this.a).getType(e)},CondNode.prototype.generate=function(e,t){var r=this.getType(e),n=this.getCondType(e),i=this.a.build(e,n),o=this.b.build(e,n);return o=this.ifNode?(n=this.ifNode.build(e,r),r=this.elseNode.build(e,r),"( "+[i,this.op,o,"?",n,":",r].join(" ")+" )"):"( "+i+" "+this.op+" "+o+" )",e.format(o,this.getType(e),t)},CondNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.a=e.a,this.b=e.b,this.op=e.op,this.ifNode=e.ifNode,this.elseNode=e.elseNode,this},CondNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).a=this.a.toJSON(e).uuid,t.b=this.b.toJSON(e).uuid,t.op=this.op,t.ifNode&&(t.ifNode=this.ifNode.toJSON(e).uuid),t.elseNode&&(t.elseNode=this.elseNode.toJSON(e).uuid)),t},NoiseNode.prototype=Object.create(TempNode.prototype),(NoiseNode.prototype.constructor=NoiseNode).prototype.nodeType="Noise",NoiseNode.Nodes={snoise:new FunctionNode(["float snoise(vec2 co) {","\treturn fract( sin( dot( co.xy, vec2( 12.9898, 78.233 ) ) ) * 43758.5453 );","}"].join("\n"))},NoiseNode.prototype.generate=function(e,t){var r=e.include(NoiseNode.Nodes.snoise);return e.format(r+"( "+this.uv.build(e,"v2")+" )",this.getType(e),t)},NoiseNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.uv=e.uv,this},NoiseNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).uv=this.uv.toJSON(e).uuid),t},CheckerNode.prototype=Object.create(TempNode.prototype),(CheckerNode.prototype.constructor=CheckerNode).prototype.nodeType="Noise",CheckerNode.Nodes={checker:new FunctionNode(["float checker( vec2 uv ) {","\tfloat cx = floor( uv.x );","\tfloat cy = floor( uv.y ); ","\tfloat result = mod( cx + cy, 2.0 );","\treturn sign( result );","}"].join("\n"))},CheckerNode.prototype.generate=function(e,t){var r=e.include(CheckerNode.Nodes.checker);return e.format(r+"( "+this.uv.build(e,"v2")+" )",this.getType(e),t)},CheckerNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.uv=e.uv,this},CheckerNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).uv=this.uv.toJSON(e).uuid),t},NormalMapNode.Nodes={perturbNormal2Arb:new FunctionNode(`vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 map, vec2 vUv, vec2 normalScale ) {

		// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988

		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );

		float scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude

		vec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );
		vec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );
		vec3 N = normalize( surf_norm );

		vec3 mapN = map * 2.0 - 1.0;

		mapN.xy *= normalScale;

		#ifdef DOUBLE_SIDED

			// Workaround for Adreno GPUs gl_FrontFacing bug. See #15850 and #10331

			if ( dot( cross( S, T ), N ) < 0.0 ) mapN.xy *= - 1.0;

		#else

			mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );

		#endif

		mat3 tsn = mat3( S, T, N );
		return normalize( tsn * mapN );

	}`,null,{derivatives:!0})},NormalMapNode.prototype=Object.create(TempNode.prototype),(NormalMapNode.prototype.constructor=NormalMapNode).prototype.nodeType="NormalMap",NormalMapNode.prototype.generate=function(e,t){if(e.isShader("fragment")){var r=e.include(NormalMapNode.Nodes.perturbNormal2Arb);this.normal=this.normal||new NormalNode,this.position=this.position||new PositionNode(PositionNode.VIEW),this.uv=this.uv||new UVNode;var n=this.scale.build(e,"v2");return e.material.side===BackSide&&(n="-"+n),e.format(r+"( -"+this.position.build(e,"v3")+", "+this.normal.build(e,"v3")+", "+this.value.build(e,"v3")+", "+this.uv.build(e,"v2")+", "+n+" )",this.getType(e),t)}return console.warn("THREE.NormalMapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)},NormalMapNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.value=e.value,this.scale=e.scale,this},NormalMapNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid,t.scale=this.scale.toJSON(e).uuid),t},BumpMapNode.Nodes=function(){var e=new FunctionNode(["vec2 dHdxy_fwd( sampler2D bumpMap, vec2 vUv, float bumpScale ) {","\tvec2 dSTdx = dFdx( vUv );","\tvec2 dSTdy = dFdy( vUv );","\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;","\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","\treturn vec2( dBx, dBy );","}"].join("\n"),null,{derivatives:!0});return{dHdxy_fwd:e,perturbNormalArb:new FunctionNode(["vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );","\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );","\tvec3 vN = surf_norm;","\tvec3 R1 = cross( vSigmaY, vN );","\tvec3 R2 = cross( vN, vSigmaX );","\tfloat fDet = dot( vSigmaX, R1 );","\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );","\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","\treturn normalize( abs( fDet ) * surf_norm - vGrad );","}"].join("\n"),[e],{derivatives:!0}),bumpToNormal:new FunctionNode(["vec3 bumpToNormal( sampler2D bumpMap, vec2 uv, float scale ) {","\tvec2 dSTdx = dFdx( uv );","\tvec2 dSTdy = dFdy( uv );","\tfloat Hll = texture2D( bumpMap, uv ).x;","\tfloat dBx = texture2D( bumpMap, uv + dSTdx ).x - Hll;","\tfloat dBy = texture2D( bumpMap, uv + dSTdy ).x - Hll;","\treturn vec3( .5 - ( dBx * scale ), .5 - ( dBy * scale ), 1.0 );","}"].join("\n"),null,{derivatives:!0})}}(),BumpMapNode.prototype=Object.create(TempNode.prototype),(BumpMapNode.prototype.constructor=BumpMapNode).prototype.nodeType="BumpMap",BumpMapNode.prototype.hashProperties=["toNormalMap"],BumpMapNode.prototype.generate=function(e,t){if(e.isShader("fragment")){if(this.toNormalMap){var r=e.include(BumpMapNode.Nodes.bumpToNormal);return e.format(r+"( "+this.value.build(e,"sampler2D")+", "+this.value.uv.build(e,"v2")+", "+this.scale.build(e,"f")+" )",this.getType(e),t)}var n=e.include(BumpMapNode.Nodes.dHdxy_fwd),r=e.include(BumpMapNode.Nodes.perturbNormalArb);this.normal=this.normal||new NormalNode,this.position=this.position||new PositionNode(PositionNode.VIEW);n=n+"( "+this.value.build(e,"sampler2D")+", "+this.value.uv.build(e,"v2")+", "+this.scale.build(e,"f")+" )";return e.format(r+"( -"+this.position.build(e,"v3")+", "+this.normal.build(e,"v3")+", "+n+" )",this.getType(e),t)}return console.warn("THREE.BumpMapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)},BumpMapNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.value=e.value,this.scale=e.scale,this},BumpMapNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid,t.scale=this.scale.toJSON(e).uuid),t},BypassNode.prototype=Object.create(Node$2.prototype),(BypassNode.prototype.constructor=BypassNode).prototype.nodeType="Bypass",BypassNode.prototype.getType=function(e){return this.value?this.value.getType(e):e.isShader("fragment")?"f":"void"},BypassNode.prototype.generate=function(e,t){var r=this.code.build(e,t)+";";return e.addNodeCode(r),e.isShader("vertex")?this.value?this.value.build(e,t):void 0:this.value?this.value.build(e,t):e.format("0.0","f",t)},BypassNode.prototype.copy=function(e){return Node$2.prototype.copy.call(this,e),this.code=e.code,this.value=e.value,this},BypassNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).code=this.code.toJSON(e).uuid,this.value&&(t.value=this.value.toJSON(e).uuid)),t};var inputs=NodeUtils.elements;function JoinNode(e,t,r,n){TempNode.call(this,"f"),this.x=e,this.y=t,this.z=r,this.w=n}function SwitchNode(e,t){Node$2.call(this),this.node=e,this.components=t||"x"}function TimerNode(e,t,r){FloatNode.call(this),this.scale=void 0!==e?e:1,this.scope=t||TimerNode.GLOBAL,this.timeScale=void 0!==r?r:void 0!==e}function VelocityNode(e,t){Vector3Node.call(this),this.params={},this.velocity=new Vector3,this.setTarget(e),this.setParams(t)}function UVTransformNode(e,t){ExpressionNode.call(this,"( uvTransform * vec3( uvNode, 1 ) ).xy","vec2"),this.uv=e||new UVNode,this.position=t||new Matrix3Node}function MaxMIPLevelNode(e){FloatNode.call(this),this.texture=e,this.maxMIPLevel=0}function SpecularMIPLevelNode(e,t){TempNode.call(this,"f"),this.roughness=e,this.texture=t,this.maxMIPLevel=void 0}function SubSlotNode(e){TempNode.call(this),this.slots=e||{}}function BlurNode(e,t,r,n){TempNode.call(this,"v4"),this.value=e,this.uv=t||new UVNode,this.radius=r||new Vector2Node(1,1),this.size=n,this.blurX=!0,this.blurY=!0,this.horizontal=new FloatNode(1/64),this.vertical=new FloatNode(1/64)}function LuminanceNode(e){TempNode.call(this,"f"),this.rgb=e}function ColorAdjustmentNode(e,t,r){TempNode.call(this,"v3"),this.rgb=e,this.adjustment=t,this.method=r||ColorAdjustmentNode.SATURATION}function BasicNode(){Node$2.call(this),this.color=new ColorNode(16777215)}function SpriteNode(){Node$2.call(this),this.color=new ColorNode(15658734),this.spherical=!0}function PhongNode(){Node$2.call(this),this.color=new ColorNode(15658734),this.specular=new ColorNode(1118481),this.shininess=new FloatNode(30)}function StandardNode(){Node$2.call(this),this.color=new ColorNode(16777215),this.roughness=new FloatNode(1),this.metalness=new FloatNode(0)}function MeshStandardNode(){StandardNode.call(this),this.properties={color:new Color(16777215),roughness:.5,metalness:.5,normalScale:new Vector2(1,1)},this.inputs={color:new PropertyNode(this.properties,"color","c"),roughness:new PropertyNode(this.properties,"roughness","f"),metalness:new PropertyNode(this.properties,"metalness","f"),normalScale:new PropertyNode(this.properties,"normalScale","v2")}}function BasicNodeMaterial(){var e=new BasicNode;NodeMaterial.call(this,e,e),this.type="BasicNodeMaterial"}function SpriteNodeMaterial(){var e=new SpriteNode;NodeMaterial.call(this,e,e),this.type="SpriteNodeMaterial"}function PhongNodeMaterial(){var e=new PhongNode;NodeMaterial.call(this,e,e),this.type="PhongNodeMaterial"}function StandardNodeMaterial(){var e=new StandardNode;NodeMaterial.call(this,e,e),this.type="StandardNodeMaterial"}function MeshStandardNodeMaterial(){var e=new MeshStandardNode;NodeMaterial.call(this,e,e),this.type="MeshStandardNodeMaterial"}function NodePostProcessing(e,t){var r,n;void 0===t&&(r={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat},n=e.getDrawingBufferSize(new Vector2),t=new WebGLRenderTarget(n.width,n.height,r)),this.renderer=e,this.renderTarget=t,this.output=new ScreenNode,this.material=new NodeMaterial,this.camera=new OrthographicCamera(-1,1,1,-1,0,1),this.scene=new Scene,this.quad=new Mesh(new PlaneGeometry(2,2),this.material),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.needsUpdate=!0}JoinNode.prototype=Object.create(TempNode.prototype),(JoinNode.prototype.constructor=JoinNode).prototype.nodeType="Join",JoinNode.prototype.getNumElements=function(){for(var e=inputs.length;e--;)if(void 0!==this[inputs[e]]){++e;break}return Math.max(e,2)},JoinNode.prototype.getType=function(e){return e.getTypeFromLength(this.getNumElements())},JoinNode.prototype.generate=function(e,t){for(var r=this.getType(e),n=this.getNumElements(),i=[],o=0;o<n;o++){var a=this[inputs[o]];i.push(a?a.build(e,"f"):"0.0")}var s=(1<n?e.getConstructorFromLength(n):"")+"( "+i.join(", ")+" )";return e.format(s,r,t)},JoinNode.prototype.copy=function(e){for(var t in TempNode.prototype.copy.call(this,e),e.inputs)this[t]=e.inputs[t];return this},JoinNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);if(!t){(t=this.createJSONNode(e)).inputs={};for(var r=this.getNumElements(),n=0;n<r;n++){var i=this[inputs[n]];i&&(t.inputs[inputs[n]]=i.toJSON(e).uuid)}}return t},SwitchNode.prototype=Object.create(Node$2.prototype),(SwitchNode.prototype.constructor=SwitchNode).prototype.nodeType="Switch",SwitchNode.prototype.getType=function(e){return e.getTypeFromLength(this.components.length)},SwitchNode.prototype.generate=function(e,t){var r=this.node.getType(e),n=this.node.build(e,r),i=e.getTypeLength(r)-1;if(0<i){for(var o=0,a=e.colorToVectorProperties(this.components),s=a.length,l=0;l<s;l++)o=Math.max(o,e.getIndexByElement(a.charAt(l)));for(i<o&&(o=i),n+=".",l=0;l<s;l++){var c=e.getIndexByElement(a.charAt(l));o<c&&(c=o),n+=e.getElementByIndex(c)}return e.format(n,this.getType(e),t)}return e.format(n,r,t)},SwitchNode.prototype.copy=function(e){return Node$2.prototype.copy.call(this,e),this.node=e.node,this.components=e.components,this},SwitchNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).node=this.node.toJSON(e).uuid,t.components=this.components),t},TimerNode.GLOBAL="global",TimerNode.LOCAL="local",TimerNode.DELTA="delta",TimerNode.prototype=Object.create(FloatNode.prototype),(TimerNode.prototype.constructor=TimerNode).prototype.nodeType="Timer",TimerNode.prototype.getReadonly=function(){return!1},TimerNode.prototype.getUnique=function(){return this.timeScale&&(this.scope===TimerNode.GLOBAL||this.scope===TimerNode.DELTA)},TimerNode.prototype.updateFrame=function(e){var t=this.timeScale?this.scale:1;switch(this.scope){case TimerNode.LOCAL:this.value+=e.delta*t;break;case TimerNode.DELTA:this.value=e.delta*t;break;default:this.value=e.time*t}},TimerNode.prototype.copy=function(e){return FloatNode.prototype.copy.call(this,e),this.scope=e.scope,this.scale=e.scale,this.timeScale=e.timeScale,this},TimerNode.prototype.toJSON=function(e){e=FloatNode.prototype.toJSON.call(this,e);return e.scope=this.scope,e.scale=this.scale,e.timeScale=this.timeScale,e},NodeLib.addKeyword("time",function(){return new TimerNode}),VelocityNode.prototype=Object.create(Vector3Node.prototype),(VelocityNode.prototype.constructor=VelocityNode).prototype.nodeType="Velocity",VelocityNode.prototype.getReadonly=function(){return!1},VelocityNode.prototype.setParams=function(e){"elastic"===this.params.type&&(delete this.moment,delete this.speed,delete this.springVelocity,delete this.lastVelocity),this.params=e||{},"elastic"===this.params.type&&(this.moment=new Vector3,this.speed=new Vector3,this.springVelocity=new Vector3,this.lastVelocity=new Vector3)},VelocityNode.prototype.setTarget=function(e){this.target&&(delete this.position,delete this.oldPosition),(this.target=e)&&(this.position=e.getWorldPosition(this.position||new Vector3),this.oldPosition=this.position.clone())},VelocityNode.prototype.updateFrameVelocity=function(){this.target&&(this.position=this.target.getWorldPosition(this.position||new Vector3),this.velocity.subVectors(this.position,this.oldPosition),this.oldPosition.copy(this.position))},VelocityNode.prototype.updateFrame=function(e){var t,r;this.updateFrameVelocity(e),"elastic"===this.params.type?(t=e.delta*(this.params.fps||60),r=Math.pow(this.params.spring,t),e=Math.pow(this.params.damping,t),this.velocity.multiplyScalar(Math.exp(-this.params.damping*t)),this.velocity.add(this.springVelocity),this.velocity.add(this.speed.multiplyScalar(e).multiplyScalar(1-r)),this.speed.subVectors(this.velocity,this.lastVelocity),this.springVelocity.add(this.speed),this.springVelocity.multiplyScalar(r),this.moment.add(this.springVelocity),this.moment.multiplyScalar(e),this.lastVelocity.copy(this.velocity),this.value.copy(this.moment)):this.value.copy(this.velocity)},VelocityNode.prototype.copy=function(e){return Vector3Node.prototype.copy.call(this,e),e.target&&this.setTarget(e.target),this.setParams(e.params),this},VelocityNode.prototype.toJSON=function(e){e=Vector3Node.prototype.toJSON.call(this,e);return this.target&&(e.target=this.target.uuid),e.params=JSON.parse(JSON.stringify(this.params)),e},UVTransformNode.prototype=Object.create(ExpressionNode.prototype),(UVTransformNode.prototype.constructor=UVTransformNode).prototype.nodeType="UVTransform",UVTransformNode.prototype.generate=function(e,t){return this.keywords.uvNode=this.uv,this.keywords.uvTransform=this.position,ExpressionNode.prototype.generate.call(this,e,t)},UVTransformNode.prototype.setUvTransform=function(e,t,r,n,i,o,a){this.position.value.setUvTransform(e,t,r,n,i,o=void 0!==o?o:.5,a=void 0!==a?a:.5)},UVTransformNode.prototype.copy=function(e){return ExpressionNode.prototype.copy.call(this,e),this.uv=e.uv,this.position=e.position,this},UVTransformNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).uv=this.uv.toJSON(e).uuid,t.position=this.position.toJSON(e).uuid),t},MaxMIPLevelNode.prototype=Object.create(FloatNode.prototype),(MaxMIPLevelNode.prototype.constructor=MaxMIPLevelNode).prototype.nodeType="MaxMIPLevel",Object.defineProperties(MaxMIPLevelNode.prototype,{value:{get:function(){var e;return 0===this.maxMIPLevel&&(e=this.texture.value.image,Array.isArray(e)&&(e=e[0]),this.maxMIPLevel=void 0!==e?Math.log(Math.max(e.width,e.height))*Math.LOG2E:0),this.maxMIPLevel},set:function(){}}}),MaxMIPLevelNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).texture=this.texture.uuid),t},SpecularMIPLevelNode.Nodes={getSpecularMIPLevel:new FunctionNode(["float getSpecularMIPLevel( const in float roughness, const in float maxMIPLevelScalar ) {","\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );","\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );","\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );","}"].join("\n"))},SpecularMIPLevelNode.prototype=Object.create(TempNode.prototype),(SpecularMIPLevelNode.prototype.constructor=SpecularMIPLevelNode).prototype.nodeType="SpecularMIPLevel",SpecularMIPLevelNode.prototype.setTexture=function(e){return this.texture=e,this},SpecularMIPLevelNode.prototype.generate=function(e,t){if(e.isShader("fragment")){this.maxMIPLevel=this.maxMIPLevel||new MaxMIPLevelNode,this.maxMIPLevel.texture=this.texture;var r=e.include(SpecularMIPLevelNode.Nodes.getSpecularMIPLevel);return e.format(r+"( "+this.roughness.build(e,"f")+", "+this.maxMIPLevel.build(e,"f")+" )",this.type,t)}return console.warn("THREE.SpecularMIPLevelNode is not compatible with "+e.shader+" shader."),e.format("0.0",this.type,t)},SpecularMIPLevelNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.texture=e.texture,this.roughness=e.roughness,this},SpecularMIPLevelNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).texture=this.texture,t.roughness=this.roughness),t},SubSlotNode.prototype=Object.create(TempNode.prototype),(SubSlotNode.prototype.constructor=SubSlotNode).prototype.nodeType="SubSlot",SubSlotNode.prototype.getType=function(e,t){return t},SubSlotNode.prototype.generate=function(e,t){return this.slots[e.slot]?this.slots[e.slot].build(e,t):e.format("0.0","f",t)},SubSlotNode.prototype.copy=function(e){for(var t in TempNode.prototype.copy.call(this,e),e.slots)this.slots[t]=e.slots[t];return this},SubSlotNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);if(!t)for(var r in(t=this.createJSONNode(e)).slots={},this.slots){var n=this.slots[r];n&&(t.slots[r]=n.toJSON(e).uuid)}return t},BlurNode.Nodes={blurX:new FunctionNode(["vec4 blurX( sampler2D tex, vec2 uv, float s ) {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( tex, vec2( uv.x - 4.0 * s, uv.y ) ) * 0.051;","\tsum += texture2D( tex, vec2( uv.x - 3.0 * s, uv.y ) ) * 0.0918;","\tsum += texture2D( tex, vec2( uv.x - 2.0 * s, uv.y ) ) * 0.12245;","\tsum += texture2D( tex, vec2( uv.x - 1.0 * s, uv.y ) ) * 0.1531;","\tsum += texture2D( tex, vec2( uv.x, uv.y ) ) * 0.1633;","\tsum += texture2D( tex, vec2( uv.x + 1.0 * s, uv.y ) ) * 0.1531;","\tsum += texture2D( tex, vec2( uv.x + 2.0 * s, uv.y ) ) * 0.12245;","\tsum += texture2D( tex, vec2( uv.x + 3.0 * s, uv.y ) ) * 0.0918;","\tsum += texture2D( tex, vec2( uv.x + 4.0 * s, uv.y ) ) * 0.051;","\treturn sum * .667;","}"].join("\n")),blurY:new FunctionNode(["vec4 blurY( sampler2D tex, vec2 uv, float s ) {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( tex, vec2( uv.x, uv.y - 4.0 * s ) ) * 0.051;","\tsum += texture2D( tex, vec2( uv.x, uv.y - 3.0 * s ) ) * 0.0918;","\tsum += texture2D( tex, vec2( uv.x, uv.y - 2.0 * s ) ) * 0.12245;","\tsum += texture2D( tex, vec2( uv.x, uv.y - 1.0 * s ) ) * 0.1531;","\tsum += texture2D( tex, vec2( uv.x, uv.y ) ) * 0.1633;","\tsum += texture2D( tex, vec2( uv.x, uv.y + 1.0 * s ) ) * 0.1531;","\tsum += texture2D( tex, vec2( uv.x, uv.y + 2.0 * s ) ) * 0.12245;","\tsum += texture2D( tex, vec2( uv.x, uv.y + 3.0 * s ) ) * 0.0918;","\tsum += texture2D( tex, vec2( uv.x, uv.y + 4.0 * s ) ) * 0.051;","\treturn sum * .667;","}"].join("\n"))},BlurNode.prototype=Object.create(TempNode.prototype),(BlurNode.prototype.constructor=BlurNode).prototype.nodeType="Blur",BlurNode.prototype.hashProperties=["blurX","blurY"],BlurNode.prototype.updateFrame=function(){var e;this.size?(this.horizontal.value=this.radius.x/this.size.x,this.vertical.value=this.radius.y/this.size.y):this.value.value&&this.value.value.image&&(e=this.value.value.image,this.horizontal.value=this.radius.x/e.width,this.vertical.value=this.radius.y/e.height)},BlurNode.prototype.generate=function(e,t){if(e.isShader("fragment")){var r=[],n=e.include(BlurNode.Nodes.blurX),i=e.include(BlurNode.Nodes.blurY);return this.blurX&&r.push(n+"( "+this.value.build(e,"sampler2D")+", "+this.uv.build(e,"v2")+", "+this.horizontal.build(e,"f")+" )"),this.blurY&&r.push(i+"( "+this.value.build(e,"sampler2D")+", "+this.uv.build(e,"v2")+", "+this.vertical.build(e,"f")+" )"),r=2==r.length?"( "+r.join(" + ")+" / 2.0 )":r.length?"( "+r[0]+" )":"vec4( 0.0 )",e.format(r,this.getType(e),t)}return console.warn("THREE.BlurNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)},BlurNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.value=e.value,this.uv=e.uv,this.radius=e.radius,void 0!==e.size&&(this.size=new Vector2(e.size.x,e.size.y)),this.blurX=e.blurX,this.blurY=e.blurY,this},BlurNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid,t.uv=this.uv.toJSON(e).uuid,t.radius=this.radius.toJSON(e).uuid,this.size&&(t.size={x:this.size.x,y:this.size.y}),t.blurX=this.blurX,t.blurY=this.blurY),t},LuminanceNode.Nodes=function(){var e=new ConstNode("vec3 LUMA vec3( 0.2125, 0.7154, 0.0721 )");return{LUMA:e,luminance:new FunctionNode(["float luminance( vec3 rgb ) {","\treturn dot( rgb, LUMA );","}"].join("\n"),[e])}}(),LuminanceNode.prototype=Object.create(TempNode.prototype),(LuminanceNode.prototype.constructor=LuminanceNode).prototype.nodeType="Luminance",LuminanceNode.prototype.generate=function(e,t){var r=e.include(LuminanceNode.Nodes.luminance);return e.format(r+"( "+this.rgb.build(e,"v3")+" )",this.getType(e),t)},LuminanceNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.rgb=e.rgb,this},LuminanceNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).rgb=this.rgb.toJSON(e).uuid),t},ColorAdjustmentNode.Nodes={hue:new FunctionNode(["vec3 hue(vec3 rgb, float adjustment) {","\tconst mat3 RGBtoYIQ = mat3(0.299, 0.587, 0.114, 0.595716, -0.274453, -0.321263, 0.211456, -0.522591, 0.311135);","\tconst mat3 YIQtoRGB = mat3(1.0, 0.9563, 0.6210, 1.0, -0.2721, -0.6474, 1.0, -1.107, 1.7046);","\tvec3 yiq = RGBtoYIQ * rgb;","\tfloat hue = atan(yiq.z, yiq.y) + adjustment;","\tfloat chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);","\treturn YIQtoRGB * vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));","}"].join("\n")),saturation:new FunctionNode(["vec3 saturation(vec3 rgb, float adjustment) {","\tvec3 intensity = vec3( luminance( rgb ) );","\treturn mix( intensity, rgb, adjustment );","}"].join("\n"),[LuminanceNode.Nodes.luminance]),vibrance:new FunctionNode(["vec3 vibrance(vec3 rgb, float adjustment) {","\tfloat average = (rgb.r + rgb.g + rgb.b) / 3.0;","\tfloat mx = max(rgb.r, max(rgb.g, rgb.b));","\tfloat amt = (mx - average) * (-3.0 * adjustment);","\treturn mix(rgb.rgb, vec3(mx), amt);","}"].join("\n"))},ColorAdjustmentNode.SATURATION="saturation",ColorAdjustmentNode.HUE="hue",ColorAdjustmentNode.VIBRANCE="vibrance",ColorAdjustmentNode.BRIGHTNESS="brightness",ColorAdjustmentNode.CONTRAST="contrast",ColorAdjustmentNode.prototype=Object.create(TempNode.prototype),(ColorAdjustmentNode.prototype.constructor=ColorAdjustmentNode).prototype.nodeType="ColorAdjustment",ColorAdjustmentNode.prototype.hashProperties=["method"],ColorAdjustmentNode.prototype.generate=function(e,t){var r=this.rgb.build(e,"v3"),n=this.adjustment.build(e,"f");switch(this.method){case ColorAdjustmentNode.BRIGHTNESS:return e.format("( "+r+" + "+n+" )",this.getType(e),t);case ColorAdjustmentNode.CONTRAST:return e.format("( "+r+" * "+n+" )",this.getType(e),t)}var i=e.include(ColorAdjustmentNode.Nodes[this.method]);return e.format(i+"( "+r+", "+n+" )",this.getType(e),t)},ColorAdjustmentNode.prototype.copy=function(e){return TempNode.prototype.copy.call(this,e),this.rgb=e.rgb,this.adjustment=e.adjustment,this.method=e.method,this},ColorAdjustmentNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).rgb=this.rgb.toJSON(e).uuid,t.adjustment=this.adjustment.toJSON(e).uuid,t.method=this.method),t},BasicNode.prototype=Object.create(Node$2.prototype),(BasicNode.prototype.constructor=BasicNode).prototype.nodeType="Basic",BasicNode.prototype.generate=function(e){var t,r,n,i=(e.isShader("vertex")?(n=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0,e.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED"," varying vec3 vNormal;","#endif"].join("\n")),i=["#include <beginnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED"," vNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"],n&&i.push(n.code,n.result?"transformed = "+n.result+";":""),i.push("#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","#include <fog_vertex>","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>")):(this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.mask&&this.mask.analyze(e),t=this.color.flow(e,"c",{slot:"color"}),r=this.alpha?this.alpha.flow(e,"f"):void 0,n=this.mask?this.mask.flow(e,"b"):void 0,e.requires.transparent=void 0!==r,e.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED"," varying vec3 vNormal;","#endif"].join("\n")),i=["#include <normal_fragment_begin>",t.code],n&&i.push(n.code,"if ( ! "+n.result+" ) discard;"),r&&i.push(r.code,"#ifdef ALPHATEST"," if ( "+r.result+" <= ALPHATEST ) discard;","#endif"),r?i.push("gl_FragColor = vec4("+t.result+", "+r.result+" );"):i.push("gl_FragColor = vec4("+t.result+", 1.0 );")),i.join("\n"));return i},BasicNode.prototype.copy=function(e){return Node$2.prototype.copy.call(this,e),this.color=e.color,e.position&&(this.position=e.position),e.alpha&&(this.alpha=e.alpha),e.mask&&(this.mask=e.mask),this},BasicNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).color=this.color.toJSON(e).uuid,this.position&&(t.position=this.position.toJSON(e).uuid),this.alpha&&(t.alpha=this.alpha.toJSON(e).uuid),this.mask&&(t.mask=this.mask.toJSON(e).uuid)),t},SpriteNode.prototype=Object.create(Node$2.prototype),(SpriteNode.prototype.constructor=SpriteNode).prototype.nodeType="Sprite",SpriteNode.prototype.build=function(e){var t,r,n;return e.define("SPRITE"),e.requires.lights=!1,e.requires.transparent=void 0!==this.alpha,e.isShader("vertex")?(r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0,e.mergeUniform(UniformsUtils.merge([UniformsLib.fog])),e.addParsCode(["#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n")),n=["#include <clipping_planes_fragment>","#include <begin_vertex>"],r&&n.push(r.code,r.result?"transformed = "+r.result+";":""),n.push("#include <project_vertex>","#include <fog_vertex>","mat4 modelViewMtx = modelViewMatrix;","mat4 modelMtx = modelMatrix;","modelMtx[3][0] = 0.0;","modelMtx[3][1] = 0.0;","modelMtx[3][2] = 0.0;"),this.spherical||n.push("modelMtx[1][1] = 1.0;"),n.push("modelViewMtx[0][0] = 1.0;","modelViewMtx[0][1] = 0.0;","modelViewMtx[0][2] = 0.0;"),this.spherical&&n.push("modelViewMtx[1][0] = 0.0;","modelViewMtx[1][1] = 1.0;","modelViewMtx[1][2] = 0.0;"),n.push("modelViewMtx[2][0] = 0.0;","modelViewMtx[2][1] = 0.0;","modelViewMtx[2][2] = 1.0;","gl_Position = projectionMatrix * modelViewMtx * modelMtx * vec4( transformed, 1.0 );","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","#include <fog_vertex>")):(e.addParsCode(["#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <clipping_planes_pars_fragment>"].join("\n")),e.addCode(["#include <clipping_planes_fragment>","#include <logdepthbuf_fragment>"].join("\n")),this.mask&&this.mask.analyze(e),this.alpha&&this.alpha.analyze(e),this.color.analyze(e,{slot:"color"}),t=this.mask?this.mask.flow(e,"b"):void 0,r=this.alpha?this.alpha.flow(e,"f"):void 0,e=this.color.flow(e,"c",{slot:"color"}),n=[],t&&n.push(t.code,"if ( ! "+t.result+" ) discard;"),r?n.push(r.code,"#ifdef ALPHATEST","if ( "+r.result+" <= ALPHATEST ) discard;","#endif",e.code,"gl_FragColor = vec4( "+e.result+", "+r.result+" );"):n.push(e.code,"gl_FragColor = vec4( "+e.result+", 1.0 );"),n.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>")),n.join("\n")},SpriteNode.prototype.copy=function(e){return Node$2.prototype.copy.call(this,e),e.position&&(this.position=e.position),this.color=e.color,void 0!==e.spherical&&(this.spherical=e.spherical),e.mask&&(this.mask=e.mask),e.alpha&&(this.alpha=e.alpha),this},SpriteNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.position&&(t.position=this.position.toJSON(e).uuid),t.color=this.color.toJSON(e).uuid,!1===this.spherical&&(t.spherical=!1),this.mask&&(t.mask=this.mask.toJSON(e).uuid),this.alpha&&(t.alpha=this.alpha.toJSON(e).uuid)),t},PhongNode.prototype=Object.create(Node$2.prototype),(PhongNode.prototype.constructor=PhongNode).prototype.nodeType="Phong",PhongNode.prototype.build=function(e){var t,r,n,i,o,a,s,l,c,h,u,A,d,p;return e.define("PHONG"),e.requires.lights=!0,e.isShader("vertex")?(d=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0,e.mergeUniform(UniformsUtils.merge([UniformsLib.fog,UniformsLib.lights])),e.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n")),p=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"],d&&p.push(d.code,d.result?"transformed = "+d.result+";":""),p.push("\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <logdepthbuf_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>")):(this.mask&&this.mask.analyze(e),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.alpha&&this.alpha.analyze(e),this.normal&&this.normal.analyze(e),this.light&&this.light.analyze(e,{cache:"light"}),this.ao&&this.ao.analyze(e),this.ambient&&this.ambient.analyze(e),this.shadow&&this.shadow.analyze(e),this.emissive&&this.emissive.analyze(e,{slot:"emissive"}),this.environment&&this.environment.analyze(e,{slot:"environment"}),this.environmentAlpha&&this.environment&&this.environmentAlpha.analyze(e),t=this.mask?this.mask.flow(e,"b"):void 0,r=this.color.flow(e,"c",{slot:"color"}),n=this.specular.flow(e,"c"),i=this.shininess.flow(e,"f"),o=this.alpha?this.alpha.flow(e,"f"):void 0,a=this.normal?this.normal.flow(e,"v3"):void 0,s=this.light?this.light.flow(e,"v3",{cache:"light"}):void 0,l=this.ao?this.ao.flow(e,"f"):void 0,c=this.ambient?this.ambient.flow(e,"c"):void 0,h=this.shadow?this.shadow.flow(e,"c"):void 0,u=this.emissive?this.emissive.flow(e,"c",{slot:"emissive"}):void 0,A=this.environment?this.environment.flow(e,"c",{slot:"environment"}):void 0,d=this.environmentAlpha&&this.environment?this.environmentAlpha.flow(e,"f"):void 0,e.requires.transparent=void 0!==o,e.addParsCode(["#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>"].join("\n")),p=["#include <normal_fragment_begin>","\tBlinnPhongMaterial material;"],t&&p.push(t.code,"if ( ! "+t.result+" ) discard;"),p.push(r.code,"\tvec3 diffuseColor = "+r.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",n.code,"\tvec3 specular = "+n.result+";",i.code,"\tfloat shininess = max( 0.0001, "+i.result+" );","\tfloat specularStrength = 1.0;"),o&&p.push(o.code,"#ifdef ALPHATEST","if ( "+o.result+" <= ALPHATEST ) discard;","#endif"),a&&p.push(a.code,"normal = "+a.result+";"),p.push("material.diffuseColor = "+(s?"vec3( 1.0 )":"diffuseColor")+";"),p.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),s&&(p.push(s.code,"reflectedLight.directDiffuse = "+s.result+";"),p.push("reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),l&&p.push(l.code,"reflectedLight.indirectDiffuse *= "+l.result+";"),c&&p.push(c.code,"reflectedLight.indirectDiffuse += "+c.result+";"),h&&p.push(h.code,"reflectedLight.directDiffuse *= "+h.result+";","reflectedLight.directSpecular *= "+h.result+";"),u&&p.push(u.code,"reflectedLight.directDiffuse += "+u.result+";"),p.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;"),A&&(p.push(A.code),d?p.push(d.code,"outgoingLight = mix( outgoingLight, "+A.result+", "+d.result+" );"):p.push("outgoingLight = "+A.result+";")),o?p.push("gl_FragColor = vec4( outgoingLight, "+o.result+" );"):p.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),p.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>","#include <premultiplied_alpha_fragment>")),p.join("\n")},PhongNode.prototype.copy=function(e){return Node$2.prototype.copy.call(this,e),e.position&&(this.position=e.position),this.color=e.color,this.specular=e.specular,this.shininess=e.shininess,e.mask&&(this.mask=e.mask),e.alpha&&(this.alpha=e.alpha),e.normal&&(this.normal=e.normal),e.light&&(this.light=e.light),e.shadow&&(this.shadow=e.shadow),e.ao&&(this.ao=e.ao),e.emissive&&(this.emissive=e.emissive),e.ambient&&(this.ambient=e.ambient),e.environment&&(this.environment=e.environment),e.environmentAlpha&&(this.environmentAlpha=e.environmentAlpha),this},PhongNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.position&&(t.position=this.position.toJSON(e).uuid),t.color=this.color.toJSON(e).uuid,t.specular=this.specular.toJSON(e).uuid,t.shininess=this.shininess.toJSON(e).uuid,this.mask&&(t.mask=this.mask.toJSON(e).uuid),this.alpha&&(t.alpha=this.alpha.toJSON(e).uuid),this.normal&&(t.normal=this.normal.toJSON(e).uuid),this.light&&(t.light=this.light.toJSON(e).uuid),this.ao&&(t.ao=this.ao.toJSON(e).uuid),this.ambient&&(t.ambient=this.ambient.toJSON(e).uuid),this.shadow&&(t.shadow=this.shadow.toJSON(e).uuid),this.emissive&&(t.emissive=this.emissive.toJSON(e).uuid),this.environment&&(t.environment=this.environment.toJSON(e).uuid),this.environmentAlpha&&(t.environmentAlpha=this.environmentAlpha.toJSON(e).uuid)),t},StandardNode.prototype=Object.create(Node$2.prototype),(StandardNode.prototype.constructor=StandardNode).prototype.nodeType="Standard",StandardNode.prototype.build=function(e){e.define("STANDARD");var t,r,n,i,o,a,s,l,c,h,u,A,d,p,m,f,g,v,_,y=this.clearcoat||this.clearcoatRoughness||this.clearCoatNormal;return y&&e.define("CLEARCOAT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")?(d=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0,e.mergeUniform(UniformsUtils.merge([UniformsLib.fog,UniformsLib.lights])),UniformsLib.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n")),_=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"],d&&_.push(d.code,d.result?"transformed = "+d.result+";":""),_.push("#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","#include <fog_vertex>","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>")):(p=new ExpressionNode("material.specularRoughness","f"),l=new ExpressionNode("material.clearcoatRoughness","f"),g={roughness:p,bias:new SpecularMIPLevelNode(p),viewNormal:new ExpressionNode("normal","v3"),worldNormal:new ExpressionNode("inverseTransformDirection( geometry.normal, viewMatrix )","v3"),gamma:!0},m={gamma:!0},v={roughness:l,bias:new SpecularMIPLevelNode(l),viewNormal:new ExpressionNode("clearcoatNormal","v3"),worldNormal:new ExpressionNode("inverseTransformDirection( geometry.clearcoatNormal, viewMatrix )","v3"),gamma:!0},this.mask&&this.mask.analyze(e),this.color.analyze(e,{slot:"color",context:m}),this.roughness.analyze(e),this.metalness.analyze(e),this.alpha&&this.alpha.analyze(e),this.normal&&this.normal.analyze(e),this.clearcoat&&this.clearcoat.analyze(e),this.clearcoatRoughness&&this.clearcoatRoughness.analyze(e),this.clearcoatNormal&&this.clearcoatNormal.analyze(e),this.reflectivity&&this.reflectivity.analyze(e),this.light&&this.light.analyze(e,{cache:"light"}),this.ao&&this.ao.analyze(e),this.ambient&&this.ambient.analyze(e),this.shadow&&this.shadow.analyze(e),this.emissive&&this.emissive.analyze(e,{slot:"emissive"}),this.environment&&(this.environment.analyze(e,{cache:"radiance",context:g,slot:"radiance"}),e.requires.irradiance&&this.environment.analyze(e,{cache:"irradiance",context:g,slot:"irradiance"})),this.sheen&&this.sheen.analyze(e),t=this.mask?this.mask.flow(e,"b"):void 0,r=this.color.flow(e,"c",{slot:"color",context:m}),n=this.roughness.flow(e,"f"),i=this.metalness.flow(e,"f"),o=this.alpha?this.alpha.flow(e,"f"):void 0,a=this.normal?this.normal.flow(e,"v3"):void 0,s=this.clearcoat?this.clearcoat.flow(e,"f"):void 0,l=this.clearcoatRoughness?this.clearcoatRoughness.flow(e,"f"):void 0,c=this.clearcoatNormal?this.clearcoatNormal.flow(e,"v3"):void 0,h=this.reflectivity?this.reflectivity.flow(e,"f"):void 0,u=this.light?this.light.flow(e,"v3",{cache:"light"}):void 0,A=this.ao?this.ao.flow(e,"f"):void 0,d=this.ambient?this.ambient.flow(e,"c"):void 0,p=this.shadow?this.shadow.flow(e,"c"):void 0,m=this.emissive?this.emissive.flow(e,"c",{slot:"emissive"}):void 0,this.environment&&(f={radiance:this.environment.flow(e,"c",{cache:"radiance",context:g,slot:"radiance"})},e.requires.irradiance&&(f.irradiance=this.environment.flow(e,"c",{cache:"irradiance",context:g,slot:"irradiance"}))),g=y&&f?this.environment.flow(e,"c",{cache:"clearcoat",context:v,slot:"environment"}):void 0,v=this.sheen?this.sheen.flow(e,"c"):void 0,e.requires.transparent=void 0!==o,e.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>"].join("\n")),_=["#include <clipping_planes_fragment>","\t#include <normal_fragment_begin>","\t#include <clearcoat_normal_fragment_begin>","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );"],t&&_.push(t.code,"if ( ! "+t.result+" ) discard;"),_.push(r.code,"\tvec3 diffuseColor = "+r.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",n.code,"\tfloat roughnessFactor = "+n.result+";",i.code,"\tfloat metalnessFactor = "+i.result+";"),o&&_.push(o.code,"#ifdef ALPHATEST","\tif ( "+o.result+" <= ALPHATEST ) discard;","#endif"),a&&_.push(a.code,"normal = "+a.result+";"),c&&_.push(c.code,"clearcoatNormal = "+c.result+";"),_.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),_.push("material.diffuseColor = "+(u?"vec3( 1.0 )":"diffuseColor * ( 1.0 - metalnessFactor )")+";","material.specularRoughness = max( roughnessFactor, 0.0525 );","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );"),s?_.push(s.code,"material.clearcoat = saturate( "+s.result+" );"):y&&_.push("material.clearcoat = 0.0;"),l?_.push(l.code,"material.clearcoatRoughness = max( "+l.result+", 0.0525 );","material.clearcoatRoughness += geometryRoughness;","material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );"):y&&_.push("material.clearcoatRoughness = 0.0;"),v&&_.push("material.sheenColor = "+v.result+";"),h?_.push(h.code,"material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( "+h.result+" ) ), diffuseColor, metalnessFactor );"):_.push("material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor, metalnessFactor );"),_.push("#include <lights_fragment_begin>"),u&&(_.push(u.code,"reflectedLight.directDiffuse = "+u.result+";"),_.push("diffuseColor *= 1.0 - metalnessFactor;","reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),A&&_.push(A.code,"reflectedLight.indirectDiffuse *= "+A.result+";","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, "+A.result+", material.specularRoughness );"),d&&_.push(d.code,"reflectedLight.indirectDiffuse += "+d.result+";"),p&&_.push(p.code,"reflectedLight.directDiffuse *= "+p.result+";","reflectedLight.directSpecular *= "+p.result+";"),m&&_.push(m.code,"reflectedLight.directDiffuse += "+m.result+";"),f&&(_.push(f.radiance.code),e.requires.irradiance&&_.push(f.irradiance.code),g&&_.push(g.code,"clearcoatRadiance += "+g.result+";"),_.push("radiance += "+f.radiance.result+";"),e.requires.irradiance&&_.push("iblIrradiance += PI * "+f.irradiance.result+";")),_.push("#include <lights_fragment_end>"),_.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;"),o?_.push("gl_FragColor = vec4( outgoingLight, "+o.result+" );"):_.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),_.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>","#include <premultiplied_alpha_fragment>","#include <dithering_fragment>")),_.join("\n")},StandardNode.prototype.copy=function(e){return Node$2.prototype.copy.call(this,e),e.position&&(this.position=e.position),this.color=e.color,this.roughness=e.roughness,this.metalness=e.metalness,e.mask&&(this.mask=e.mask),e.alpha&&(this.alpha=e.alpha),e.normal&&(this.normal=e.normal),e.clearcoat&&(this.clearcoat=e.clearcoat),e.clearcoatRoughness&&(this.clearcoatRoughness=e.clearcoatRoughness),e.clearcoatNormal&&(this.clearcoatNormal=e.clearcoatNormal),e.reflectivity&&(this.reflectivity=e.reflectivity),e.light&&(this.light=e.light),e.shadow&&(this.shadow=e.shadow),e.ao&&(this.ao=e.ao),e.emissive&&(this.emissive=e.emissive),e.ambient&&(this.ambient=e.ambient),e.environment&&(this.environment=e.environment),e.sheen&&(this.sheen=e.sheen),this},StandardNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.position&&(t.position=this.position.toJSON(e).uuid),t.color=this.color.toJSON(e).uuid,t.roughness=this.roughness.toJSON(e).uuid,t.metalness=this.metalness.toJSON(e).uuid,this.mask&&(t.mask=this.mask.toJSON(e).uuid),this.alpha&&(t.alpha=this.alpha.toJSON(e).uuid),this.normal&&(t.normal=this.normal.toJSON(e).uuid),this.clearcoat&&(t.clearcoat=this.clearcoat.toJSON(e).uuid),this.clearcoatRoughness&&(t.clearcoatRoughness=this.clearcoatRoughness.toJSON(e).uuid),this.clearcoatNormal&&(t.clearcoatNormal=this.clearcoatNormal.toJSON(e).uuid),this.reflectivity&&(t.reflectivity=this.reflectivity.toJSON(e).uuid),this.light&&(t.light=this.light.toJSON(e).uuid),this.shadow&&(t.shadow=this.shadow.toJSON(e).uuid),this.ao&&(t.ao=this.ao.toJSON(e).uuid),this.emissive&&(t.emissive=this.emissive.toJSON(e).uuid),this.ambient&&(t.ambient=this.ambient.toJSON(e).uuid),this.environment&&(t.environment=this.environment.toJSON(e).uuid),this.sheen&&(t.sheen=this.sheen.toJSON(e).uuid)),t},MeshStandardNode.prototype=Object.create(StandardNode.prototype),(MeshStandardNode.prototype.constructor=MeshStandardNode).prototype.nodeType="MeshStandard",MeshStandardNode.prototype.build=function(e){var t,r,n=this.properties,i=this.inputs;return e.isShader("fragment")&&(t=e.findNode(n.color,i.color),r=e.resolve(n.map),this.color=r?new OperatorNode(t,r,OperatorNode.MUL):t,r=e.findNode(n.roughness,i.roughness),t=e.resolve(n.roughnessMap),this.roughness=t?new OperatorNode(r,new SwitchNode(t,"g"),OperatorNode.MUL):r,t=e.findNode(n.metalness,i.metalness),r=e.resolve(n.metalnessMap),this.metalness=r?new OperatorNode(t,new SwitchNode(r,"b"),OperatorNode.MUL):t,n.normalMap?(this.normal=new NormalMapNode(e.resolve(n.normalMap)),this.normal.scale=e.findNode(n.normalScale,i.normalScale)):this.normal=void 0,this.environment=e.resolve(n.envMap)),StandardNode.prototype.build.call(this,e)},MeshStandardNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),console.warn(".toJSON not implemented in",this)),t},BasicNodeMaterial.prototype=Object.create(NodeMaterial.prototype),BasicNodeMaterial.prototype.constructor=BasicNodeMaterial,NodeUtils.addShortcuts(BasicNodeMaterial.prototype,"fragment",["color","alpha","mask","position"]),SpriteNodeMaterial.prototype=Object.create(NodeMaterial.prototype),SpriteNodeMaterial.prototype.constructor=SpriteNodeMaterial,NodeUtils.addShortcuts(SpriteNodeMaterial.prototype,"fragment",["color","alpha","mask","position","spherical"]),PhongNodeMaterial.prototype=Object.create(NodeMaterial.prototype),PhongNodeMaterial.prototype.constructor=PhongNodeMaterial,NodeUtils.addShortcuts(PhongNodeMaterial.prototype,"fragment",["color","alpha","specular","shininess","normal","emissive","ambient","light","shadow","ao","environment","environmentAlpha","mask","position"]),StandardNodeMaterial.prototype=Object.create(NodeMaterial.prototype),StandardNodeMaterial.prototype.constructor=StandardNodeMaterial,NodeUtils.addShortcuts(StandardNodeMaterial.prototype,"fragment",["color","alpha","roughness","metalness","reflectivity","clearcoat","clearcoatRoughness","clearcoatNormal","normal","emissive","ambient","light","shadow","ao","environment","mask","position","sheen"]),MeshStandardNodeMaterial.prototype=Object.create(NodeMaterial.prototype),MeshStandardNodeMaterial.prototype.constructor=MeshStandardNodeMaterial,NodeUtils.addShortcuts(MeshStandardNodeMaterial.prototype,"properties",["color","roughness","metalness","map","normalMap","normalScale","metalnessMap","roughnessMap","envMap"]),NodePostProcessing.prototype={constructor:NodePostProcessing,render:function(e,t,r){this.needsUpdate&&(this.material.dispose(),this.material.fragment.value=this.output,this.material.build(),this.material.uniforms.renderTexture&&(this.material.uniforms.renderTexture.value=this.renderTarget.texture),this.needsUpdate=!1),r.setRenderer(this.renderer).setRenderTexture(this.renderTarget.texture),this.renderer.setRenderTarget(this.renderTarget),this.renderer.render(e,t),r.updateNode(this.material),this.renderer.setRenderTarget(null),this.renderer.render(this.scene,this.camera)},setPixelRatio:function(e){this.renderer.setPixelRatio(e);e=this.renderer.getSize(new Vector2);this.setSize(e.width,e.height)},setSize:function(e,t){var r=this.renderer.getPixelRatio();this.renderTarget.setSize(e*r,t*r),this.renderer.setSize(e,t)},copy:function(e){return this.output=e.output,this},toJSON:function(e){var t;return(e=void 0===e||"string"==typeof e?{nodes:{}}:e)&&!e.post&&(e.post={}),e.post[this.uuid]||((t={}).uuid=this.uuid,t.type="NodePostProcessing",e.post[this.uuid]=t,""!==this.name&&(t.name=this.name),"{}"!==JSON.stringify(this.userData)&&(t.userData=this.userData),t.output=this.output.toJSON(e).uuid),e.post=this.uuid,e}};var Nodes=Object.freeze({__proto__:null,Node:Node$2,TempNode:TempNode,InputNode:InputNode,ConstNode:ConstNode,VarNode:VarNode,StructNode:StructNode,AttributeNode:AttributeNode,FunctionNode:FunctionNode,ExpressionNode:ExpressionNode,FunctionCallNode:FunctionCallNode,NodeLib:NodeLib,NodeUtils:NodeUtils,NodeFrame:NodeFrame,NodeUniform:NodeUniform,NodeBuilder:NodeBuilder,BoolNode:BoolNode,IntNode:IntNode,FloatNode:FloatNode,Vector2Node:Vector2Node,Vector3Node:Vector3Node,Vector4Node:Vector4Node,ColorNode:ColorNode,Matrix3Node:Matrix3Node,Matrix4Node:Matrix4Node,TextureNode:TextureNode,CubeTextureNode:CubeTextureNode,ScreenNode:ScreenNode,ReflectorNode:ReflectorNode,PropertyNode:PropertyNode,RTTNode:RTTNode,UVNode:UVNode,ColorsNode:ColorsNode,PositionNode:PositionNode,NormalNode:NormalNode,CameraNode:CameraNode,LightNode:LightNode,ReflectNode:ReflectNode,ScreenUVNode:ScreenUVNode,ResolutionNode:ResolutionNode,MathNode:MathNode,OperatorNode:OperatorNode,CondNode:CondNode,NoiseNode:NoiseNode,CheckerNode:CheckerNode,TextureCubeUVNode:TextureCubeUVNode,TextureCubeNode:TextureCubeNode,NormalMapNode:NormalMapNode,BumpMapNode:BumpMapNode,BypassNode:BypassNode,JoinNode:JoinNode,SwitchNode:SwitchNode,TimerNode:TimerNode,VelocityNode:VelocityNode,UVTransformNode:UVTransformNode,MaxMIPLevelNode:MaxMIPLevelNode,SpecularMIPLevelNode:SpecularMIPLevelNode,ColorSpaceNode:ColorSpaceNode,SubSlotNode:SubSlotNode,BlurNode:BlurNode,ColorAdjustmentNode:ColorAdjustmentNode,LuminanceNode:LuminanceNode,RawNode:RawNode,BasicNode:BasicNode,SpriteNode:SpriteNode,PhongNode:PhongNode,StandardNode:StandardNode,MeshStandardNode:MeshStandardNode,NodeMaterial:NodeMaterial,BasicNodeMaterial:BasicNodeMaterial,SpriteNodeMaterial:SpriteNodeMaterial,PhongNodeMaterial:PhongNodeMaterial,StandardNodeMaterial:StandardNodeMaterial,MeshStandardNodeMaterial:MeshStandardNodeMaterial,NodePostProcessing:NodePostProcessing}),NodeMaterialLoader=function(e,t){this.manager=void 0!==e?e:DefaultLoadingManager,this.nodes={},this.materials={},this.passes={},this.names={},this.library=t||{}};Object.assign(NodeMaterialLoader.prototype,{load:function(e,t,r,n){var i=this,o=new FileLoader(i.manager);return o.setPath(i.path),o.load(e,function(e){t(i.parse(JSON.parse(e)))},r,n),this},setPath:function(e){return this.path=e,this},getObjectByName:function(e){return this.names[e]},getObjectById:function(e){return this.library[e]||this.nodes[e]||this.materials[e]||this.passes[e]||this.names[e]},getNode:function(e){var t=this.getObjectById(e);return t||console.warn('Node "'+e+'" not found.'),t},resolve:function(e){switch(typeof e){case"boolean":case"number":return e;case"string":return/^\w{8}-\w{4}-\w{4}-\w{4}-\w{12}$/i.test(e)||this.library[e]?this.getNode(e):e;default:if(Array.isArray(e))for(var t=0;t<e.length;t++)e[t]=this.resolve(e[t]);else for(var r in e)"uuid"!==r&&(e[r]=this.resolve(e[r]))}return e},declare:function(e){var t,r,n;for(t in e.nodes)r=e.nodes[t],n=new Nodes[r.nodeType+"Node"],r.name&&(n.name=r.name,this.names[n.name]=n),this.nodes[t]=n;for(t in e.materials)r=e.materials[t],n=new Nodes[r.type],r.name&&(n.name=r.name,this.names[n.name]=n),this.materials[t]=n;for(t in e.passes)r=e.passes[t],n=new Nodes[r.type],r.name&&(n.name=r.name,this.names[n.name]=n),this.passes[t]=n;return e.material&&(this.material=this.materials[e.material]),e.pass&&(this.pass=this.passes[e.pass]),e},parse:function(e){for(var t in(e=this.resolve(this.declare(e))).nodes)this.nodes[t].copy(e.nodes[t]);for(t in e.materials)this.materials[t].copy(e.materials[t]);for(t in e.passes)this.passes[t].copy(e.passes[t]);return this.material||this.pass||this}});const{ADD,SUB,MUL,DIV}=OperatorNode,buildNodeMaterial=(e,t,r)=>{var n,i=new Vector2(1,1),o=e.map.repeat;const a={};for(n of["map","bumpMap","diffuseMap","roughnessMap","normalMap"])e[n]&&(a[n]=new TextureNode(e[n]),a[n].uv=new UVTransformNode,a[n].uv.setUvTransform(i.x,i.y,o.x,o.y,MathUtils.degToRad(0)));const s=new MeshStandardNodeMaterial;if(s.color=a.map||e.color,s.roughness=new FloatNode(e.roughness),s.metalness=new FloatNode(e.metalness),t){t.uv=new UVTransformNode,t.uv.setUvTransform(1,1,r.x,r.y,MathUtils.degToRad(0));var l=new NormalMapNode(t);if(console.log(l),a.bumpMap){const c=new BumpMapNode(a.bumpMap);c.toNormalMap=!0;r=new OperatorNode(l,c,ADD);new OperatorNode(r,new ColorNode(8421631),SUB);s.normal=t}else a.normalMap&&(l=new OperatorNode(l,new NormalMapNode(a.normalMap),ADD),l=new OperatorNode(l,new ColorNode(8421631),SUB),console.log(l)),s.normalMap=t;s.normalMap=s.normalMap||{},s.normalMap.scale=new FloatNode(e.normalScale)}return s.needsUpdate=!0,s};class MaterialCategoryType extends BuildableComponent{constructor(e,t){super(e,t),checkPropTypes(t,{name:"string"},{})}_onTreeSet(){const t=this;this._tree.on("change",({cls:e=[]})=>{e.includes(MaterialCategory)&&(t.report({msg:"Material categories changed in package. Rebuilding."}),t._rebuild("main"))},this.id),this._rebuild("main")}_onTreeUnset(){this._tree.hasListener("change",this.id)&&this._tree.removeListener("change",this.id)}async _build(e,t){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":var r,n=this._tree?this._tree.materialCategories.filter(e=>e.settings.type===this):[];for(r of Component.qualities)this._setContent("main",r,n);this.report({msg:`Built material category type of ${n.length} material categories.`});break;default:this._setContent(e,t,null)}return this}}MaterialCategoryType._exportName={singular:"materialCategoryType",plural:"materialCategoryTypes"};class MaterialCategory extends BuildableComponent{constructor(e,t){super(e,t),checkPropTypes(t,{name:"string",type:MaterialCategoryType},{id:UUIDRegex})}_onTreeSet(){const t=this;this._tree.on("change",({cls:e=[]})=>{e.includes(WrappedMaterial)&&(t.report({msg:"Materials changed in package. Rebuilding."}),t._rebuild())},this.id),this._rebuild()}_onTreeUnset(){this._tree.hasListener("change",this.id)&&this._tree.removeListener("change",this.id)}async _build(e,t){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":var r=this._tree?this._tree.materials.filter(e=>(e.settings.categories||[]).find(e=>e===this)):[];this._setContent("main",t,r),this.report({msg:`Built category of ${r.length} materials.`});break;default:this._setContent(e,t,null)}return this}}MaterialCategory._exportName={singular:"materialCategory",plural:"materialCategories"};var gn={},bn=function(e,t,r,n,i){e=gn[t]||(gn[t]=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))),e=new Worker(e);return e.onerror=function(e){return i(e.error,null)},e.onmessage=function(e){return i(null,e.data)},e.postMessage(r,n),e},A=Uint8Array,R=Uint16Array,nr=Uint32Array,ur=new A([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),lr=new A([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Mr=new A([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),wn=function(e,t){for(var r=new R(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];for(var i=new nr(r[30]),n=1;n<30;++n)for(var o=r[n];o<r[n+1];++o)i[o]=o-r[n]<<5|n;return[r,i]},yn=wn(ur,2),Nr=yn[0],Ir=yn[1];Nr[28]=258,Ir[258]=28;for(var mn=wn(lr,0),zn=mn[0],Qr=mn[1],Ur=new R(32768),T=0;T<32768;++T){var ir=(52428&(ir=(43690&T)>>>1|(21845&T)<<1))>>>2|(13107&ir)<<2;Ur[T]=((65280&(ir=(61680&ir)>>>4|(3855&ir)<<4))>>>8|(255&ir)<<8)>>>1}for(var V=function(e,t,r){for(var n=e.length,i=0,o=new R(t);i<n;++i)++o[e[i]-1];var a=new R(t);for(i=0;i<t;++i)a[i]=a[i-1]+o[i-1]<<1;if(r){for(var s=new R(1<<t),l=15-t,i=0;i<n;++i)if(e[i])for(var c=i<<4|e[i],h=t-e[i],u=a[e[i]-1]++<<h,A=u|(1<<h)-1;u<=A;++u)s[Ur[u]>>>l]=c}else for(s=new R(n),i=0;i<n;++i)e[i]&&(s[i]=Ur[a[e[i]-1]++]>>>15-e[i]);return s},tr=new A(288),T=0;T<144;++T)tr[T]=8;for(T=144;T<256;++T)tr[T]=9;for(T=256;T<280;++T)tr[T]=7;for(T=280;T<288;++T)tr[T]=8;for(var vr=new A(32),T=0;T<32;++T)vr[T]=5;var xn=V(tr,9,0),An=V(tr,9,1),Dn=V(vr,5,0),Mn=V(vr,5,1),Gr=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},X=function(e,t,r){var n=t/8|0;return(e[n]|e[1+n]<<8)>>(7&t)&r},Or=function(e,t){var r=t/8|0;return(e[r]|e[1+r]<<8|e[2+r]<<16)>>(7&t)},Cr=function(e){return(e/8|0)+(7&e&&1)},$=function(e,t,r){(null==r||r>e.length)&&(r=e.length);var n=new(e instanceof R?R:e instanceof nr?nr:A)(r-(t=null==t||t<0?0:t));return n.set(e.subarray(t,r)),n},Fr=function(e,r,t){var n=e.length;if(!n||t&&!t.l&&n<5)return r||new A(0);var i=!r||t,o=!t||t.i;t=t||{},r=r||new A(3*n);function a(e){var t=r.length;t<e&&((e=new A(Math.max(2*t,e))).set(r),r=e)}var s=t.f||0,l=t.p||0,c=t.b||0,h=t.l,u=t.d,d=t.m,p=t.n,m=8*n;do{if(!h){t.f=s=X(e,l,1);var f=X(e,l+1,3);if(l+=3,!f){var g=e[(B=Cr(l)+4)-4]|e[B-3]<<8,v=B+g;if(n<v){if(o)throw"unexpected EOF";break}i&&a(c+g),r.set(e.subarray(B,v),c),t.b=c+=g,t.p=l=8*v;continue}if(1==f)h=An,u=Mn,d=9,p=5;else{if(2!=f)throw"invalid block type";var g=X(e,l,31)+257,_=X(e,l+10,15)+4,y=g+X(e,l+5,31)+1;l+=14;for(var w=new A(y),x=new A(19),b=0;b<_;++b)x[Mr[b]]=X(e,l+3*b,7);l+=3*_;var v=Gr(x),T=(1<<v)-1;if(!o&&m<l+y*(v+7))break;for(var E=V(x,v,1),b=0;b<y;){var B,C=E[X(e,l,T)];if(l+=15&C,(B=C>>>4)<16)w[b++]=B;else{var S=0,M=0;for(16==B?(M=3+X(e,l,3),l+=2,S=w[b-1]):17==B?(M=3+X(e,l,7),l+=3):18==B&&(M=11+X(e,l,127),l+=7);M--;)w[b++]=S}}var v=w.subarray(0,g),N=w.subarray(g),d=Gr(v),p=Gr(N),h=V(v,d,1),u=V(N,p,1)}if(m<l)throw"unexpected EOF"}i&&a(c+131072);for(var L=(1<<d)-1,F=(1<<p)-1,U=d+p+18;o||l+U<m;){var R=(S=h[Or(e,l)&L])>>>4;if(m<(l+=15&S))throw"unexpected EOF";if(!S)throw"invalid length/literal";if(R<256)r[c++]=R;else{if(256==R){h=null;break}var I=R-254;264<R&&(O=ur[b=R-257],I=X(e,l,(1<<O)-1)+Nr[b],l+=O);var P=u[Or(e,l)&F],R=P>>>4;if(!P)throw"invalid distance";l+=15&P;var O,N=zn[R];if(3<R&&(O=lr[R],N+=Or(e,l)&(1<<O)-1,l+=O),m<l)throw"unexpected EOF";i&&a(c+131072);for(var D=c+I;c<D;c+=4)r[c]=r[c-N],r[c+1]=r[c+1-N],r[c+2]=r[c+2-N],r[c+3]=r[c+3-N];c=D}}t.l=h,t.p=l,t.b=c,h&&(s=1,t.m=d,t.d=u,t.n=p)}while(!s);return c==r.length?r:$(r,0,c)},b=function(e,t,r){var n=t/8|0;e[n]|=r<<=7&t,e[1+n]|=r>>>8},cr=function(e,t,r){var n=t/8|0;e[n]|=r<<=7&t,e[1+n]|=r>>>8,e[2+n]|=r>>>16},Er=function(e,t){for(var r=[],n=0;n<e.length;++n)e[n]&&r.push({s:n,f:e[n]});var i=r.length,o=r.slice();if(!i)return[er,0];if(1==i){var a=new A(r[0].s+1);return a[r[0].s]=1,[a,1]}r.sort(function(e,t){return e.f-t.f}),r.push({s:-1,f:25001});var s=r[0],l=r[1],c=0,h=1,u=2;for(r[0]={s:-1,f:s.f+l.f,l:s,r:l};h!=i-1;)s=r[r[c].f<r[u].f?c++:u++],l=r[c!=h&&r[c].f<r[u].f?c++:u++],r[h++]={s:-1,f:s.f+l.f,l:s,r:l};for(var d=o[0].s,n=1;n<i;++n)o[n].s>d&&(d=o[n].s);var p=new R(d+1),m=Pr(r[h-1],p,0);if(t<m){var n=0,f=0,a=m-t,g=1<<a;for(o.sort(function(e,t){return p[t.s]-p[e.s]||e.f-t.f});n<i;++n){var v=o[n].s;if(!(p[v]>t))break;f+=g-(1<<m-p[v]),p[v]=t}for(f>>>=a;0<f;){var _=o[n].s;p[_]<t?f-=1<<t-p[_]++-1:++n}for(;0<=n&&f;--n){var y=o[n].s;p[y]==t&&(--p[y],++f)}m=t}return[new A(p),m]},Pr=function(e,t,r){return-1==e.s?Math.max(Pr(e.l,t,r+1),Pr(e.r,t,r+1)):t[e.s]=r},Vr=function(e){for(var t=e.length;t&&!e[--t];);function r(e){n[i++]=e}for(var n=new R(++t),i=0,o=e[0],a=1,s=1;s<=t;++s)if(e[s]==o&&s!=t)++a;else{if(!o&&2<a){for(;138<a;a-=138)r(32754);2<a&&(r(10<a?a-11<<5|28690:a-3<<5|12305),a=0)}else if(3<a){for(r(o),--a;6<a;a-=6)r(8304);2<a&&(r(a-3<<5|8208),a=0)}for(;a--;)r(o);a=1,o=e[s]}return[n.subarray(0,i),t]},pr=function(e,t){for(var r=0,n=0;n<t.length;++n)r+=e[n]*t[n];return r},Sr=function(e,t,r){var n=r.length,i=Cr(t+2);e[i]=255&n,e[i+1]=n>>>8,e[i+2]=255^e[i],e[i+3]=255^e[i+1];for(var o=0;o<n;++o)e[i+o+4]=r[o];return 8*(i+4+n)},Xr=function(e,t,r,n,i,o,a,s,l,c,h){b(t,h++,r),++i[256];for(var u=Er(i,15),A=u[0],d=u[1],p=Er(o,15),m=p[0],f=p[1],g=Vr(A),v=g[0],_=g[1],r=Vr(m),y=r[0],u=r[1],w=new R(19),x=0;x<v.length;++x)w[31&v[x]]++;for(x=0;x<y.length;++x)w[31&y[x]]++;for(var p=Er(w,7),T=p[0],g=p[1],E=19;4<E&&!T[Mr[E-1]];--E);r=c+5<<3,p=pr(i,tr)+pr(o,vr)+a,a=pr(i,A)+pr(o,m)+a+14+3*E+pr(w,T)+(2*w[16]+3*w[17]+7*w[18]);if(r<=p&&r<=a)return Sr(t,h,e.subarray(l,l+c));if(b(t,h,1+(a<p)),h+=2,a<p){var B=V(A,d,0),C=A,S=V(m,f,0),M=m,N=V(T,g,0);b(t,h,_-257),b(t,h+5,u-1),b(t,h+10,E-4),h+=14;for(x=0;x<E;++x)b(t,h+3*x,T[Mr[x]]);h+=3*E;for(var L=[v,y],F=0;F<2;++F)for(var U=L[F],x=0;x<U.length;++x){var I=31&U[x];b(t,h,N[I]),h+=T[I],15<I&&(b(t,h,U[x]>>>5&127),h+=U[x]>>>12)}}else B=xn,C=tr,S=Dn,M=vr;for(var P,x=0;x<s;++x)255<n[x]?(I=n[x]>>>18&31,cr(t,h,B[I+257]),h+=C[I+257],7<I&&(b(t,h,n[x]>>>23&31),h+=ur[I]),P=31&n[x],cr(t,h,S[P]),h+=M[P],3<P&&(cr(t,h,n[x]>>>5&8191),h+=lr[P])):(cr(t,h,B[n[x]]),h+=C[n[x]]);return cr(t,h,B[256]),h+C[256]},Un=new nr([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),er=new A(0),Cn=function(t,e,r,n,i,o){var a=t.length,s=new A(n+a+5*(1+Math.ceil(a/7e3))+i),l=s.subarray(n,s.length-i),c=0;if(!e||a<8)for(var h=0;h<=a;h+=65535)var u=h+65535,c=u<a?Sr(l,c,t.subarray(h,u)):(l[h]=o,Sr(l,c,t.subarray(h,a)));else{function d(e){return(t[e]^t[e+1]<<_^t[e+2]<<y)&f}for(var e=Un[e-1],p=e>>>13,m=8191&e,f=(1<<r)-1,g=new R(32768),v=new R(1+f),_=Math.ceil(r/3),y=2*_,w=new nr(25e3),x=new R(288),b=new R(32),T=0,E=0,h=0,B=0,C=0,S=0;h<a;++h){var M=d(h),N=32767&h,L=v[M];if(g[N]=L,v[M]=N,C<=h){var F=a-h;if((7e3<T||24576<B)&&423<F){c=Xr(t,l,0,w,x,b,E,B,S,h-S,c);for(var B=T=E=0,S=h,U=0;U<286;++U)x[U]=0;for(U=0;U<30;++U)b[U]=0}var I=2,P=0,O=m,D=N-L&32767;if(2<F&&M==d(h-D))for(var H=Math.min(p,F)-1,Q=Math.min(32767,h),k=Math.min(258,F);D<=Q&&--O&&N!=L;){if(t[h+I]==t[h+I-D]){for(var V=0;V<k&&t[h+V]==t[h+V-D];++V);if(I<V){if(P=D,H<(I=V))break;for(var G=Math.min(D,V-2),z=0,U=0;U<G;++U){var K=h-D+U+32768&32767,W=K-g[K]+32768&32767;z<W&&(z=W,L=K)}}}D+=(N=L)-(L=g[N])+32768&32767}P?(w[B++]=268435456|Ir[I]<<18|Qr[P],M=31&Ir[I],F=31&Qr[P],E+=ur[M]+lr[F],++x[257+M],++b[F],C=h+I,++T):(w[B++]=t[h],++x[t[h]])}}c=Xr(t,l,o,w,x,b,E,B,S,h-S,c),!o&&7&c&&(c=Sr(l,c+1,er))}return $(s,0,n+Cr(c)+i)},Fn=function(){for(var e=new nr(256),t=0;t<256;++t){for(var r=t,n=9;--n;)r=(1&r&&3988292384)^r>>>1;e[t]=r}return e}(),gr=function(){var n=-1;return{p:function(e){for(var t=n,r=0;r<e.length;++r)t=Fn[255&t^e[r]]^t>>>8;n=t},d:function(){return~n}}},$r=function(){var a=1,s=0;return{p:function(e){for(var t=a,r=s,n=e.length,i=0;i!=n;){for(var o=Math.min(i+2655,n);i<o;++i)r+=t+=e[i];t=(65535&t)+15*(t>>16),r=(65535&r)+15*(r>>16)}a=t,s=r},d:function(){return((a%=65521)>>>8<<16|(255&(s%=65521))<<8|s>>>8)+2*((255&a)<<23)}}},sr=function(e,t,r,n,i){return Cn(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,r,n,!i)},Zr=function(e,t){var r,n={};for(r in e)n[r]=e[r];for(r in t)n[r]=t[r];return n},Sn=function(e,t,r){for(var n=e(),e=e.toString(),i=e.slice(e.indexOf("[")+1,e.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<n.length;++o){var a=n[o],s=i[o];if("function"==typeof a){t+=";"+s+"=";var l=a.toString();if(a.prototype)if(-1!=l.indexOf("[native code]")){var c=l.indexOf(" ",8)+1;t+=l.slice(c,l.indexOf("(",c))}else for(var h in t+=l,a.prototype)t+=";"+s+".prototype."+h+"="+a.prototype[h].toString();else t+=l}else r[s]=a}return[t,r]},Rr=[],rt=function(e){var t,r=[];for(t in e)(e[t]instanceof A||e[t]instanceof R||e[t]instanceof nr)&&r.push((e[t]=new e[t].constructor(e[t])).buffer);return r},Zn=function(e,t,r,n){var i;if(!Rr[r]){for(var o="",a={},s=e.length-1,l=0;l<s;++l)o=(i=Sn(e[l],o,a))[0],a=i[1];Rr[r]=Sn(e[s],o,a)}var c=Zr({},Rr[r][1]);return bn(Rr[r][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",r,c,rt(c),n)},wr=function(){return[A,R,nr,ur,lr,Mr,Nr,zn,An,Mn,Ur,V,Gr,X,Or,Cr,$,Fr,xr,ar,Lr]},yr=function(){return[A,R,nr,ur,lr,Mr,Ir,Qr,xn,tr,Dn,vr,Ur,Un,er,V,b,cr,Er,Pr,Vr,pr,Sr,Xr,Cr,$,Cn,sr,kr,ar]},kn=function(){return[_r,rn,F,gr,Fn]},Bn=function(){return[br,Gn]},Tn=function(){return[nn,F,$r]},In=function(){return[On]},ar=function(e){return postMessage(e,[e.buffer])},Lr=function(e){return e&&e.size&&new A(e.size)},mr=function(e,t,r,n,i,o){var a=Zn(r,n,i,function(e,t){a.terminate(),o(e,t)});return a.postMessage([e,t],t.consume?[e.buffer]:[]),function(){a.terminate()}},L=function(t){return t.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return t.push(e.data[0],e.data[1])}},zr=function(e,r,t,n,i){var o,a=Zn(e,n,i,function(e,t){e?(a.terminate(),r.ondata.call(r,e)):(t[1]&&a.terminate(),r.ondata.call(r,e,t[0],t[1]))});a.postMessage(t),r.push=function(e,t){if(o)throw"stream finished";if(!r.ondata)throw"no stream handler";a.postMessage([e,o=t],[e.buffer])},r.terminate=function(){a.terminate()}},Y=function(e,t){return e[t]|e[t+1]<<8},P=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+2*(e[t+3]<<23)},dr=function(e,t){return P(e,t)|4294967296*P(e,t)},F=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},_r=function(e,t){var r=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&F(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),r){e[3]=8;for(var n=0;n<=r.length;++n)e[n+10]=r.charCodeAt(n)}},br=function(e){if(31!=e[0]||139!=e[1]||8!=e[2])throw"invalid gzip data";var t=e[3],r=10;4&t&&(r+=e[10]|2+(e[11]<<8));for(var n=(t>>3&1)+(t>>4&1);0<n;n-=!e[r++]);return r+(2&t)},Gn=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16)+2*(e[t-1]<<23)},rn=function(e){return 10+(e.filename&&e.filename.length+1||0)},nn=function(e,t){t=t.level,t=0==t?0:t<6?1:9==t?3:2;e[0]=120,e[1]=t<<6|(t?32-2*t:1)},On=function(e){if(8!=(15&e[0])||7<e[0]>>>4||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function tn(e,t){return t||"function"!=typeof e||(t=e,e={}),this.ondata=t,e}var rr=function(){function e(e,t){t||"function"!=typeof e||(t=e,e={}),this.ondata=t,this.o=e||{}}return e.prototype.p=function(e,t){this.ondata(sr(e,this.o,0,0,!t),t)},e.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},e}(),En=function(e,t){zr([yr,function(){return[L,rr]}],this,tn.call(this,e,t),function(e){e=new rr(e.data);onmessage=L(e)},6)};function Pn(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return mr(e,t,[yr],function(e){return ar(kr(e.data[0],e.data[1]))},0,r)}function kr(e,t){return sr(e,t||{},0,0)}var J=function(){function e(e){this.s={},this.p=new A(0),this.ondata=e}return e.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,r=new A(t+e.length);r.set(this.p),r.set(e,t),this.p=r},e.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,e=Fr(this.p,this.o,this.s);this.ondata($(e,t,this.s.b),this.d),this.o=$(e,this.s.b-32768),this.s.b=this.o.length,this.p=$(this.p,this.s.p/8|0),this.s.p&=7},e.prototype.push=function(e,t){this.e(e),this.c(t)},e}(),en=function(e){this.ondata=e,zr([wr,function(){return[L,J]}],this,0,function(){var e=new J;onmessage=L(e)},7)};function an(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return mr(e,t,[wr],function(e){return ar(xr(e.data[0],Lr(e.data[1])))},1,r)}function xr(e,t){return Fr(e,t)}var qr=function(){function e(e,t){this.c=gr(),this.l=0,this.v=1,rr.call(this,e,t)}return e.prototype.push=function(e,t){rr.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;e=sr(e,this.o,this.v&&rn(this.o),t&&8,!t);this.v&&(_r(e,this.o),this.v=0),t&&(F(e,e.length-8,this.c.d()),F(e,e.length-4,this.l)),this.ondata(e,t)},e}(),Rn=function(e,t){zr([yr,kn,function(){return[L,rr,qr]}],this,tn.call(this,e,t),function(e){e=new qr(e.data);onmessage=L(e)},8)};function qn(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return mr(e,t,[yr,kn,function(){return[Hr]}],function(e){return ar(Hr(e.data[0],e.data[1]))},2,r)}function Hr(e,t){t=t||{};var r=gr(),n=e.length;r.p(e);var i=sr(e,t,rn(t),8),e=i.length;return _r(i,t),F(i,e-8,r.d()),F(i,e-4,n),i}var Wr=function(){function e(e){this.v=1,J.call(this,e)}return e.prototype.push=function(e,t){if(J.prototype.e.call(this,e),this.v){e=3<this.p.length?br(this.p):4;if(e>=this.p.length&&!t)return;this.p=this.p.subarray(e),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}J.prototype.c.call(this,t)},e}(),Hn=function(e){this.ondata=e,zr([wr,Bn,function(){return[L,J,Wr]}],this,0,function(){var e=new Wr;onmessage=L(e)},9)};function Wn(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return mr(e,t,[wr,Bn,function(){return[Yr]}],function(e){return ar(Yr(e.data[0]))},3,r)}function Yr(e,t){return Fr(e.subarray(br(e),-8),t||new A(Gn(e)))}var on=function(){function e(e,t){this.c=$r(),this.v=1,rr.call(this,e,t)}return e.prototype.push=function(e,t){rr.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e);e=sr(e,this.o,this.v&&2,t&&4,!t);this.v&&(nn(e,this.o),this.v=0),t&&F(e,e.length-4,this.c.d()),this.ondata(e,t)},e}(),nt=function(e,t){zr([yr,Tn,function(){return[L,rr,on]}],this,tn.call(this,e,t),function(e){e=new on(e.data);onmessage=L(e)},10)};function tt(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return mr(e,t,[yr,Tn,function(){return[fn]}],function(e){return ar(fn(e.data[0],e.data[1]))},4,r)}function fn(e,t){t=t||{};var r=$r();r.p(e);e=sr(e,t,2,4);return nn(e,t),F(e,e.length-4,r.d()),e}var jr=function(){function e(e){this.v=1,J.call(this,e)}return e.prototype.push=function(e,t){if(J.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}J.prototype.c.call(this,t)},e}(),Yn=function(e){this.ondata=e,zr([wr,In,function(){return[L,J,jr]}],this,0,function(){var e=new jr;onmessage=L(e)},11)};function jn(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return mr(e,t,[wr,In,function(){return[Jr]}],function(e){return ar(Jr(e.data[0],Lr(e.data[1])))},5,r)}function Jr(e,t){return Fr((On(e),e.subarray(2,-4)),t)}var Jn=function(){function e(e){this.G=Wr,this.I=J,this.Z=jr,this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";var r,n;this.s?this.s.push(e,t):(this.p&&this.p.length?((r=new A(this.p.length+e.length)).set(this.p),r.set(e,this.p.length)):this.p=e,2<this.p.length&&((n=this).s=new(31==this.p[0]&&139==this.p[1]&&8==this.p[2]?this.G:8!=(15&this.p[0])||7<this.p[0]>>4||(this.p[0]<<8|this.p[1])%31?this.I:this.Z)(function(){n.ondata.apply(n,arguments)}),this.s.push(this.p,t),this.p=null))},e}(),et=function(){function e(e){this.G=Hn,this.I=en,this.Z=Yn,this.ondata=e}return e.prototype.push=function(e,t){Jn.prototype.push.call(this,e,t)},e}();function it(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return(31==e[0]&&139==e[1]&&8==e[2]?Wn:8!=(15&e[0])||7<e[0]>>4||(e[0]<<8|e[1])%31?an:jn)(e,t,r)}function at(e,t){return(31==e[0]&&139==e[1]&&8==e[2]?Yr:8!=(15&e[0])||7<e[0]>>4||(e[0]<<8|e[1])%31?xr:Jr)(e,t)}var sn=function(e,t,r,n){for(var i in e){var o=e[i],i=t+i;o instanceof A?r[i]=[o,n]:Array.isArray(o)?r[i]=[o[0],Zr(n,o[1])]:sn(o,i+"/",r,n)}},Kn="undefined"!=typeof TextEncoder&&new TextEncoder,hn="undefined"!=typeof TextDecoder&&new TextDecoder,Nn=0;try{hn.decode(er,{stream:!0}),Nn=1}catch(e){}var Qn=function(e){for(var t="",r=0;;){var n=e[r++],i=(127<n)+(223<n)+(239<n);if(r+i>e.length)return[t,$(e,r-1)];i?3==i?(n=((15&n)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536,t+=String.fromCharCode(55296|n>>10,56320|1023&n)):t+=1&i?String.fromCharCode((31&n)<<6|63&e[r++]):String.fromCharCode((15&n)<<12|(63&e[r++])<<6|63&e[r++]):t+=String.fromCharCode(n)}},ot=function(){function e(e){this.ondata=e,Nn?this.t=new TextDecoder:this.p=er}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=t||!1,this.t)return this.ondata(this.t.decode(e,{stream:!t}),t);var r=new A(this.p.length+e.length);r.set(this.p),r.set(e,this.p.length);e=Qn(r),r=e[0],e=e[1];if(t&&e.length)throw"invalid utf-8 data";this.p=e,this.ondata(r,t)},e}(),ft=function(){function e(e){this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";this.ondata(or(e),t||!1)},e}();function or(e,t){if(t){for(var r=new A(e.length),n=0;n<e.length;++n)r[n]=e.charCodeAt(n);return r}if(Kn)return Kn.encode(e);function i(e){a[s++]=e}for(var o=e.length,a=new A(e.length+(e.length>>1)),s=0,n=0;n<o;++n){s+5>a.length&&((l=new A(s+8+(o-n<<1))).set(a),a=l);var l=e.charCodeAt(n);l<128||t?i(l):(l<2048?i(192|l>>>6):(55295<l&&l<57344?(i(240|(l=65536+(1047552&l)|1023&e.charCodeAt(++n))>>>18),i(128|l>>>12&63)):i(224|l>>>12),i(128|l>>>6&63)),i(128|63&l))}return $(a,0,s)}function un(e,t){if(t){for(var r="",n=0;n<e.length;n+=16384)r+=String.fromCharCode.apply(null,e.subarray(n,n+16384));return r}if(hn)return hn.decode(e);var i=Qn(e),t=i[0];if(i[1].length)throw"invalid utf-8 data";return t}var Vn=function(e){return 1==e?3:e<6?2:9==e?1:0},Xn=function(e,t){return t+30+Y(e,t+26)+Y(e,t+28)},$n=function(e,t,r){var n=Y(e,t+28),i=un(e.subarray(t+46,t+46+n),!(2048&Y(e,t+8))),o=t+46+n,a=P(e,t+20),n=r&&4294967295==a?Ln(e,o):[a,P(e,t+24),P(e,t+42)],r=n[0],a=n[1],n=n[2];return[Y(e,t+10),r,a,i,o+Y(e,t+30)+Y(e,t+32),n]},Ln=function(e,t){for(;1!=Y(e,t);t+=4+Y(e,t+2));return[dr(e,t+12),dr(e,t+4),dr(e,t+20)]},fr=function(e){var t=0;if(e)for(var r in e){r=e[r].length;if(65535<r)throw"extra field too long";t+=r+4}return t},Ar=function(e,t,r,n,i,o,a,s){var l=n.length,c=r.extra,h=s&&s.length,u=fr(c);F(e,t,null!=a?33639248:67324752),t+=4,null!=a&&(e[t++]=20,e[t++]=r.os),e[t]=20,t+=2,e[t++]=r.flag<<1|(null==o&&8),e[t++]=i&&8,e[t++]=255&r.compression,e[t++]=r.compression>>8;var A=new Date(null==r.mtime?Date.now():r.mtime),i=A.getFullYear()-1980;if(i<0||119<i)throw"date not in range 1980-2099";if(F(e,t,2*(i<<24)|A.getMonth()+1<<21|A.getDate()<<16|A.getHours()<<11|A.getMinutes()<<5|A.getSeconds()>>>1),t+=4,null!=o&&(F(e,t,r.crc),F(e,t+4,o),F(e,t+8,r.size)),F(e,t+12,l),F(e,t+14,u),t+=16,null!=a&&(F(e,t,h),F(e,t+6,r.attrs),F(e,t+10,a),t+=14),e.set(n,t),t+=l,u)for(var d in c){var p=c[d],m=p.length;F(e,t,+d),F(e,t+2,m),e.set(p,t+4),t+=4+m}return h&&(e.set(s,t),t+=h),t},ln=function(e,t,r,n,i){F(e,t,101010256),F(e,t+8,r),F(e,t+10,r),F(e,t+12,n),F(e,t+16,i)},Br=function(){function e(e){this.filename=e,this.c=gr(),this.size=0,this.compression=0}return e.prototype.process=function(e,t){this.ondata(null,e,t)},e.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},e}(),st=function(){function e(e,t){var r=this;t=t||{},Br.call(this,e),this.d=new rr(t,function(e,t){r.ondata(null,e,t)}),this.compression=8,this.flag=Vn(t.level)}return e.prototype.process=function(e,t){try{this.d.push(e,t)}catch(e){this.ondata(e,null,t)}},e.prototype.push=function(e,t){Br.prototype.push.call(this,e,t)},e}(),ht=function(){function e(e,t){var n=this;t=t||{},Br.call(this,e),this.d=new En(t,function(e,t,r){n.ondata(e,t,r)}),this.compression=8,this.flag=Vn(t.level),this.terminate=this.d.terminate}return e.prototype.process=function(e,t){this.d.push(e,t)},e.prototype.push=function(e,t){Br.prototype.push.call(this,e,t)},e}(),ut=function(){function e(e){this.ondata=e,this.u=[],this.d=1}return e.prototype.add=function(n){var i=this;if(2&this.d)throw"stream finished";var e=or(n.filename),t=e.length,r=n.comment,o=r&&or(r),r=t!=n.filename.length||o&&r.length!=o.length,a=t+fr(n.extra)+30;if(65535<t)throw"filename too long";t=new A(a);Ar(t,0,n,e,r);function s(){for(var e=0,t=l;e<t.length;e++){var r=t[e];i.ondata(null,r,!1)}l=[]}var l=[t],c=this.d;this.d=0;var h=this.u.length,u=Zr(n,{f:e,u:r,o:o,t:function(){n.terminate&&n.terminate()},r:function(){var e;s(),c&&((e=i.u[h+1])?e.r():i.d=1),c=1}}),d=0;n.ondata=function(e,t,r){e?(i.ondata(e,t,r),i.terminate()):(d+=t.length,l.push(t),r?(r=new A(16),F(r,0,134695760),F(r,4,n.crc),F(r,8,d),F(r,12,n.size),l.push(r),u.c=d,u.b=a+d+16,u.crc=n.crc,u.size=n.size,c&&u.r(),c=1):c&&s())},this.u.push(u)},e.prototype.end=function(){var e=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var e=0,t=0,r=0,n=0,i=this.u;n<i.length;n++)r+=46+(l=i[n]).f.length+fr(l.extra)+(l.o?l.o.length:0);for(var o=new A(r+22),a=0,s=this.u;a<s.length;a++){var l=s[a];Ar(o,e,l,l.f,l.u,l.c,t,l.o),e+=46+l.f.length+fr(l.extra)+(l.o?l.o.length:0),t+=l.b}ln(o,e,this.u.length,r,t),this.ondata(null,o,!0),this.d=2},e.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++)t[e].t();this.d=2},e}();function lt(e,t,m){if(m||(m=t,t={}),"function"!=typeof m)throw"no callback";var f={};sn(e,"",f,t);function g(){for(var e=0;e<T.length;++e)T[e]()}function v(){for(var e=new A(x+22),t=w,r=x-w,n=x=0;n<l;++n){var i=b[n];try{var o=i.c.length;Ar(e,x,i,i.f,i.u,o);var a=30+i.f.length+fr(i.extra),s=x+a;e.set(i.c,s),Ar(e,w,i,i.f,i.u,o,x,i.m),w+=16+a+(i.m?i.m.length:0),x=s+o}catch(e){return m(e,null)}}ln(e,w,b.length,r,t),m(null,e)}var _=Object.keys(f),y=_.length,w=0,x=0,l=y,b=new Array(y),T=[];y||v();for(var r=0;r<l;++r)!function(r){var n=_[r],e=f[n],t=e[0],i=e[1],o=gr(),a=t.length;o.p(t);function s(e,t){e?(g(),m(e,null)):(e=t.length,b[r]=Zr(i,{size:a,crc:o.d(),c:t,f:l,m:u,u:c!=n.length||u&&h.length!=A,compression:p}),w+=30+c+d+e,x+=76+2*(c+d)+(A||0)+e,--y||v())}var l=or(n),c=l.length,h=i.comment,u=h&&or(h),A=u&&u.length,d=fr(i.extra),p=0==i.level?0:8;if(65535<c&&s("filename too long",null),p)if(a<16e4)try{s(null,kr(t,i))}catch(e){s(e,null)}else T.push(Pn(t,i,s));else s(null,t)}(r);return g}function vt(e,t){var r={},n=[];sn(e,"",r,t=t||{});var i,o=0,a=0;for(i in r){var s=r[i],l=s[0],c=s[1],h=0==c.level?0:8,u=(w=or(i)).length,d=c.comment,p=d&&or(d),m=p&&p.length,f=fr(c.extra);if(65535<u)throw"filename too long";var g=h?kr(l,c):l,v=g.length,s=gr();s.p(l),n.push(Zr(c,{size:l.length,crc:s.d(),c:g,f:w,m:p,u:u!=i.length||p&&d.length!=m,o:o,compression:h})),o+=30+u+f+v,a+=76+2*(u+f)+(m||0)+v}for(var _=new A(a+22),e=o,t=a-o,y=0;y<n.length;++y){var w=n[y];Ar(_,w.o,w,w.f,w.u,w.c.length);var x=30+w.f.length+fr(w.extra);_.set(w.c,w.o+x),Ar(_,o,w,w.f,w.u,w.c.length,w.o,w.m),o+=16+x+(w.m?w.m.length:0)}return ln(_,o,n.length,t,e),_}var dn=function(){function e(){}return e.prototype.push=function(e,t){this.ondata(null,e,t)},e.compression=0,e}(),ct=function(){function e(){var r=this;this.i=new J(function(e,t){r.ondata(null,e,t)})}return e.prototype.push=function(t,r){try{this.i.push(t,r)}catch(e){this.ondata(e,t,r)}},e.compression=8,e}(),pt=function(){function e(e,t){var n=this;t<32e4?this.i=new J(function(e,t){n.ondata(null,e,t)}):(this.i=new en(function(e,t,r){n.ondata(e,t,r)}),this.terminate=this.i.terminate)}return e.prototype.push=function(e,t){this.i.terminate&&(e=$(e,0)),this.i.push(e,t)},e.compression=8,e}(),gt=function(){function e(e){this.onfile=e,this.k=[],this.o={0:dn},this.p=er}return e.prototype.push=function(e,t){var u=this;if(!this.onfile)throw"no callback";if(0<this.c){var r=Math.min(this.c,e.length),n=e.subarray(0,r);if(this.c-=r,this.d?this.d.push(n,!this.c):this.k[0].push(n),(e=e.subarray(r)).length)return this.push(e,t)}else{var d=0,p=0,m=void 0,f=void 0;this.p.length?e.length?((f=new A(this.p.length+e.length)).set(this.p),f.set(e,this.p.length)):f=this.p:f=e;for(var g=f.length,v=this.c,r=v&&this.d,_=this;p<g-4;++p)if("break"===function(){var e=P(f,p);if(67324752==e){d=1,m=p,_.d=null,_.c=0;var i,o,a,s,l,t=Y(f,p+6),c=Y(f,p+8),r=2048&t,n=8&t,h=Y(f,p+26),t=Y(f,p+28);return p+30+h+t<g&&(_.k.unshift(i=[]),d=2,o=P(f,p+18),a=P(f,p+22),s=un(f.subarray(p+30,p+=30+h),!r),4294967295==o?(r=n?[-2]:Ln(f,p),o=r[0],a=r[1]):n&&(o=-1),p+=t,_.c=o,l={name:s,compression:c,start:function(){if(!l.ondata)throw"no callback";if(o){var e=u.o[c];if(!e)throw"unknown compression type "+c;var t=o<0?new e(s):new e(s,o,a);t.ondata=function(e,t,r){l.ondata(e,t,r)};for(var r=0,n=i;r<n.length;r++)t.push(n[r],!1);u.k[0]==i?u.d=t:t.push(er,!0)}else l.ondata(null,er,!0)},terminate:function(){u.k[0]==i&&u.d.terminate&&u.d.terminate()}},0<=o&&(l.size=o,l.originalSize=a),_.onfile(l)),"break"}if(v)return 134695760==e?(m=p+=12+(-2==v&&8),d=2,_.c=0,"break"):33639248==e?(m=p-=4,d=2,_.c=0,"break"):void 0}())break;if(this.p=er,v<0&&(e=d?f.subarray(0,m-12-(-2==v&&8)-(134695760==P(f,m-16)&&4)):f.subarray(0,p),r?r.push(e,!!d):this.k[+(2==d)].push(e)),2&d)return this.push(f.subarray(p),t);this.p=f.subarray(p)}if(t&&this.c)throw"invalid zip file"},e.prototype.register=function(e){this.o[e.compression]=e},e}();function wt(s,l){if("function"!=typeof l)throw"no callback";function c(){for(var e=0;e<h.length;++e)h[e]()}for(var h=[],u={},e=s.length-22;101010256!=P(s,e);--e)if(!e||65558<s.length-e)return void l("invalid zip file",null);var d=Y(s,e+8);d||l(null,{});var t=d,p=P(s,e+16),m=4294967295==p;if(m){if(e=P(s,e-12),101075792!=P(s,e))return void l("invalid zip file",null);t=d=P(s,e+32),p=P(s,e+48)}for(var r=0;r<t;++r)!function(){var e=$n(s,p,m),t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],e=e[5],e=Xn(s,e);p=o;function a(e,t){e?(c(),l(e,null)):(u[i]=t,--d||l(null,u))}if(t)if(8==t){o=s.subarray(e,e+r);if(r<32e4)try{a(null,xr(o,new A(n)))}catch(e){a(e,null)}else h.push(an(o,{size:n},a))}else a("unknown compression type "+t,null);else a(null,$(s,e,e+r))}();return c}function yt(e){for(var t={},r=e.length-22;101010256!=P(e,r);--r)if(!r||65558<e.length-r)throw"invalid zip file";var n=Y(e,r+8);if(!n)return{};var i=4294967295==(d=P(e,r+16));if(i){if(r=P(e,r-12),101075792!=P(e,r))throw"invalid zip file";n=P(e,r+32),d=P(e,r+48)}for(var o=0;o<n;++o){var a=$n(e,d,i),s=a[0],l=a[1],c=a[2],h=a[3],u=a[4],a=a[5],a=Xn(e,a),d=u;if(s){if(8!=s)throw"unknown compression type "+s;t[h]=xr(e.subarray(a,a+l),new A(c))}else t[h]=$(e,a,a+l)}return t}var fflate_module_min=null,fflate=Object.freeze({__proto__:null,AsyncCompress:Rn,AsyncDecompress:et,AsyncDeflate:En,AsyncGunzip:Hn,AsyncGzip:Rn,AsyncInflate:en,AsyncUnzipInflate:pt,AsyncUnzlib:Yn,AsyncZipDeflate:ht,AsyncZlib:nt,Compress:qr,DecodeUTF8:ot,Decompress:Jn,Deflate:rr,EncodeUTF8:ft,Gunzip:Wr,Gzip:qr,Inflate:J,Unzip:gt,UnzipInflate:ct,UnzipPassThrough:dn,Unzlib:jr,Zip:ut,ZipDeflate:st,ZipPassThrough:Br,Zlib:on,compress:qn,compressSync:Hr,decompress:it,decompressSync:at,deflate:Pn,deflateSync:kr,gunzip:Wn,gunzipSync:Yr,gzip:qn,gzipSync:Hr,inflate:an,inflateSync:xr,strFromU8:un,strToU8:or,unzip:wt,unzipSync:yt,unzlib:jn,unzlibSync:Jr,zip:lt,zipSync:vt,zlib:tt,zlibSync:fn,default:fflate_module_min}),EXRLoader=function(e){DataTextureLoader.call(this,e),this.type=FloatType};EXRLoader.prototype=Object.assign(Object.create(DataTextureLoader.prototype),{constructor:EXRLoader,parse:function(e){const w=65536,x=w>>3;const f=14,A=65537,u=1<<f,g=u-1;const r=32768,n=65535,d=59,p=63,m=2+p-d,i=8,o=4,a=4,U=2,s=1,F=0,R=1,I=0,P=1,O=2,D=Math.pow(2.7182818,2.2);var l=new DataView(new ArrayBuffer(8));function c(e){if(0===e)return[e,0];l.setFloat64(0,e);var t=l.getUint32(0)>>>20&2047;0===t&&(l.setFloat64(0,e*Math.pow(2,64)),t=(l.getUint32(0)>>>20&2047)-64);t-=1022;return[function(e,t){for(var r=Math.min(3,Math.ceil(Math.abs(t)/1023)),n=e,i=0;i<r;i++)n*=Math.pow(2,Math.floor((t+i)/r));return n}(e,-t),t]}const v={l:0,c:0,lc:0};function _(e,t,r,n,i){for(;r<e;)t=t<<8|Y(n,i),r+=8;r-=e,v.l=t>>r&(1<<e)-1,v.c=t,v.lc=r}const y=new Array(59);function b(e,t,r,n,i,o,a){for(var s=r,l=0,c=0;i<=o;i++){if(s.value-r.value>n)return;_(6,l,c,e,s);var h=v.l;if(l=v.c,c=v.lc,(a[i]=h)==p){if(s.value-r.value>n)throw"Something wrong with hufUnpackEncTable";_(8,l,c,e,s);var u=v.l+m,l=v.c,c=v.lc;if(o+1<i+u)throw"Something wrong with hufUnpackEncTable";for(;u--;)a[i++]=0;i--}else if(h>=d){if(o+1<i+(u=h-d+2))throw"Something wrong with hufUnpackEncTable";for(;u--;)a[i++]=0;i--}}!function(e){for(var t=0;t<=58;++t)y[t]=0;for(t=0;t<A;++t)y[e[t]]+=1;for(var r=0,t=58;0<t;--t){var n=r+y[t]>>1;y[t]=r,r=n}for(t=0;t<A;++t){var i=e[t];0<i&&(e[t]=i|y[i]++<<6)}}(a)}const T={c:0,lc:0};function E(e,t,r,n){e=e<<8|Y(r,n),t+=8,T.c=e,T.lc=t}const B={c:0,lc:0};function C(e,t,r,n,i,o,a,s,l,c){if(e==t){n<8&&(E(r,n,i,a),r=T.c,n=T.lc);var h=r>>(n-=8),h=new Uint8Array([h])[0];if(l.value+h>c)return;for(var u=s[l.value-1];0<h--;)s[l.value++]=u}else{if(!(l.value<c))return;s[l.value++]=e}B.c=r,B.lc=n}function h(e){return 65535&e}function S(e){e=h(e);return 32767<e?e-65536:e}const M={a:0,b:0};function N(e,t){var r=S(e),e=S(t),t=r+(1&e)+(e>>1),r=t,e=t-e;M.a=r,M.b=e}function L(e,t){e=h(e),t=h(t),e=e-(t>>1)&n,t=t+e-r&n;M.a=t,M.b=e}function H(e,t,r,n,i,o){var a=r.value,s=X(t,r),l=X(t,r);r.value+=4;var c=X(t,r);if(r.value+=4,s<0||s>=A||l<0||l>=A)throw"Something wrong with HUF_ENCSIZE";var h=new Array(A),t=new Array(u);if(!function(e){for(var t=0;t<u;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(t),b(e,0,r,n-(r.value-a),s,l,h),c>8*(n-(r.value-a)))throw"Something wrong with hufUncompress";!function(e,t,r,n){for(;t<=r;t++){var i=e[t]>>6,o=63&e[t];if(i>>o)throw"Invalid table entry";if(o>f){if((l=n[i>>o-f]).len)throw"Invalid table entry";if(l.lit++,l.p){var a=l.p;l.p=new Array(l.lit);for(var s=0;s<l.lit-1;++s)l.p[s]=a[s]}else l.p=new Array(1);l.p[l.lit-1]=t}else if(o)for(var l,c=0,s=1<<f-o;0<s;s--){if((l=n[(i<<f-o)+c]).len||l.p)throw"Invalid table entry";l.len=o,l.lit=t,c++}}}(h,s,l,t),function(e,t,r,n,i,o,a,s,l){for(var c,h=0,u=0,A=a,d=Math.trunc(n.value+(i+7)/8);n.value<d;)for(E(h,u,r,n),h=T.c,u=T.lc;u>=f;)if((c=t[h>>u-f&g]).len)u-=c.len,C(c.lit,o,h,u,r,0,n,s,l,A),h=B.c,u=B.lc;else{if(!c.p)throw"hufDecode issues";for(var p=0;p<c.lit;p++){for(var m=63&e[c.p[p]];u<m&&n.value<d;)E(h,u,r,n),h=T.c,u=T.lc;if(m<=u&&e[c.p[p]]>>6==(h>>u-m&(1<<m)-1)){u-=m,C(c.p[p],o,h,u,r,0,n,s,l,A),h=B.c,u=B.lc;break}}if(p==c.lit)throw"hufDecode issues"}for(h>>=i=8-i&7,u-=i;0<u;){if(!(c=t[h<<f-u&g]).len)throw"hufDecode issues";u-=c.len,C(c.lit,o,h,u,r,0,n,s,l,A),h=B.c,u=B.lc}}(h,t,e,r,c,l,o,i,{value:0})}function Q(e){for(var t=1;t<e.length;t++){var r=e[t-1]+e[t]-128;e[t]=r}}function k(e,t){for(var r=0,n=Math.floor((e.length+1)/2),i=0,o=e.length-1;;){if(o<i)break;if(t[i++]=e[r++],o<i)break;t[i++]=e[n++]}}function V(e){for(var t=e.byteLength,r=new Array,n=0,i=new DataView(e);0<t;){var o=i.getInt8(n++);if(o<0){t-=(s=-o)+1;for(var a=0;a<s;a++)r.push(i.getUint8(n++))}else{var s=o;t-=2;for(var l=i.getUint8(n++),a=0;a<s+1;a++)r.push(l)}}return r}function G(t,r,e,o,a,n){var s,l,c=new DataView(n.buffer),i=e[t.idx[0]].width,h=e[t.idx[0]].height,u=Math.floor(i/8),A=Math.ceil(i/8),d=Math.ceil(h/8),p=i-8*(A-1),m=h-8*(d-1),f={value:0},g=new Array(3),v=new Array(3),_=new Array(3),y=new Array(3),w=new Array(3);for(let e=0;e<3;++e)w[e]=r[t.idx[e]],g[e]=e<1?0:g[e-1]+A*d,v[e]=new Float32Array(64),_[e]=new Uint16Array(64),y[e]=new Uint16Array(64*A);for(let i=0;i<d;++i){var x=8;i==d-1&&(x=m);var b=8;for(let t=0;t<A;++t){t==A-1&&(b=p);for(let e=0;e<3;++e)_[e].fill(0),_[e][0]=a[g[e]++],function(e,t,r){var n,i=1;for(;i<64;)65280==(n=t[e.value])?i=64:n>>8==255?i+=255&n:(r[i]=n,i++),e.value++}(f,o,_[e]),s=_[e],(l=v[e])[0]=Z(s[0]),l[1]=Z(s[1]),l[2]=Z(s[5]),l[3]=Z(s[6]),l[4]=Z(s[14]),l[5]=Z(s[15]),l[6]=Z(s[27]),l[7]=Z(s[28]),l[8]=Z(s[2]),l[9]=Z(s[4]),l[10]=Z(s[7]),l[11]=Z(s[13]),l[12]=Z(s[16]),l[13]=Z(s[26]),l[14]=Z(s[29]),l[15]=Z(s[42]),l[16]=Z(s[3]),l[17]=Z(s[8]),l[18]=Z(s[12]),l[19]=Z(s[17]),l[20]=Z(s[25]),l[21]=Z(s[30]),l[22]=Z(s[41]),l[23]=Z(s[43]),l[24]=Z(s[9]),l[25]=Z(s[11]),l[26]=Z(s[18]),l[27]=Z(s[24]),l[28]=Z(s[31]),l[29]=Z(s[40]),l[30]=Z(s[44]),l[31]=Z(s[53]),l[32]=Z(s[10]),l[33]=Z(s[19]),l[34]=Z(s[23]),l[35]=Z(s[32]),l[36]=Z(s[39]),l[37]=Z(s[45]),l[38]=Z(s[52]),l[39]=Z(s[54]),l[40]=Z(s[20]),l[41]=Z(s[22]),l[42]=Z(s[33]),l[43]=Z(s[38]),l[44]=Z(s[46]),l[45]=Z(s[51]),l[46]=Z(s[55]),l[47]=Z(s[60]),l[48]=Z(s[21]),l[49]=Z(s[34]),l[50]=Z(s[37]),l[51]=Z(s[47]),l[52]=Z(s[50]),l[53]=Z(s[56]),l[54]=Z(s[59]),l[55]=Z(s[61]),l[56]=Z(s[35]),l[57]=Z(s[36]),l[58]=Z(s[48]),l[59]=Z(s[49]),l[60]=Z(s[57]),l[61]=Z(s[58]),l[62]=Z(s[62]),l[63]=Z(s[63]),function(e){var t=.5*Math.cos(.7853975),r=.5*Math.cos(.196349375),n=.5*Math.cos(.39269875),i=.5*Math.cos(3*3.14159/16),o=.5*Math.cos(.981746875),a=.5*Math.cos(3*3.14159/8),s=.5*Math.cos(1.374445625);for(var l=new Array(4),c=new Array(4),h=new Array(4),u=new Array(4),A=0;A<8;++A){var d=8*A;l[0]=n*e[2+d],l[1]=a*e[2+d],l[2]=n*e[6+d],l[3]=a*e[6+d],c[0]=r*e[1+d]+i*e[3+d]+o*e[5+d]+s*e[7+d],c[1]=i*e[1+d]-s*e[3+d]-r*e[5+d]-o*e[7+d],c[2]=o*e[1+d]-r*e[3+d]+s*e[5+d]+i*e[7+d],c[3]=s*e[1+d]-o*e[3+d]+i*e[5+d]-r*e[7+d],h[0]=t*(e[0+d]+e[4+d]),h[3]=t*(e[0+d]-e[4+d]),h[1]=l[0]+l[3],h[2]=l[1]-l[2],u[0]=h[0]+h[1],u[1]=h[3]+h[2],u[2]=h[3]-h[2],u[3]=h[0]-h[1],e[0+d]=u[0]+c[0],e[1+d]=u[1]+c[1],e[2+d]=u[2]+c[2],e[3+d]=u[3]+c[3],e[4+d]=u[3]-c[3],e[5+d]=u[2]-c[2],e[6+d]=u[1]-c[1],e[7+d]=u[0]-c[0]}for(var p=0;p<8;++p)l[0]=n*e[16+p],l[1]=a*e[16+p],l[2]=n*e[48+p],l[3]=a*e[48+p],c[0]=r*e[8+p]+i*e[24+p]+o*e[40+p]+s*e[56+p],c[1]=i*e[8+p]-s*e[24+p]-r*e[40+p]-o*e[56+p],c[2]=o*e[8+p]-r*e[24+p]+s*e[40+p]+i*e[56+p],c[3]=s*e[8+p]-o*e[24+p]+i*e[40+p]-r*e[56+p],h[0]=t*(e[p]+e[32+p]),h[3]=t*(e[p]-e[32+p]),h[1]=l[0]+l[3],h[2]=l[1]-l[2],u[0]=h[0]+h[1],u[1]=h[3]+h[2],u[2]=h[3]-h[2],u[3]=h[0]-h[1],e[0+p]=u[0]+c[0],e[8+p]=u[1]+c[1],e[16+p]=u[2]+c[2],e[24+p]=u[3]+c[3],e[32+p]=u[3]-c[3],e[40+p]=u[2]-c[2],e[48+p]=u[1]-c[1],e[56+p]=u[0]-c[0]}(v[e]);!function(e){for(var t=0;t<64;++t){var r=e[0][t],n=e[1][t],i=e[2][t];e[0][t]=r+1.5747*i,e[1][t]=r-.1873*n-.4682*i,e[2][t]=r+1.8556*n}}(v);for(let e=0;e<3;++e)!function(e,t,r){for(var n=0;n<64;++n)t[r+n]=DataUtils.toHalfFloat(function(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(D,Math.abs(e)-1)}(e[n]))}(v[e],y[e],64*t)}let n=0;for(let r=0;r<3;++r){const M=e[t.idx[r]].type;for(let t=8*i;t<8*i+x;++t){n=w[r][t];for(let e=0;e<u;++e){var T=64*e+8*(7&t);c.setUint16(n+0*U*M,y[r][T],!0),c.setUint16(n+ +U*M,y[r][1+T],!0),c.setUint16(n+2*U*M,y[r][2+T],!0),c.setUint16(n+3*U*M,y[r][3+T],!0),c.setUint16(n+4*U*M,y[r][4+T],!0),c.setUint16(n+5*U*M,y[r][5+T],!0),c.setUint16(n+6*U*M,y[r][6+T],!0),c.setUint16(n+7*U*M,y[r][7+T],!0),n+=8*U*M}}if(u!=A)for(let e=8*i;e<8*i+x;++e){var E=w[r][e]+8*u*U*M,B=64*u+8*(7&e);for(let e=0;e<b;++e)c.setUint16(E+e*U*M,y[r][B+e],!0)}}}for(var C=new Uint16Array(i),c=new DataView(n.buffer),S=0;S<3;++S){e[t.idx[S]].decoded=!0;var M=e[t.idx[S]].type;if(2==e[S].type)for(var N=0;N<h;++N){for(var L=w[S][N],F=0;F<i;++F)C[F]=c.getUint16(L+F*U*M,!0);for(F=0;F<i;++F)c.setFloat32(L+F*U*M,Z(C[F]),!0)}}}function z(e){var t=e.array.slice(e.offset.value,e.offset.value+e.size);void 0===fflate&&console.error("THREE.EXRLoader: External library fflate.min.js required.");e=Jr(t),t=new Uint8Array(e.length);return Q(e),k(e,t),new DataView(t.buffer)}function t(e){for(var t=e.viewer,r={value:e.offset.value},n=e.width*ue*(ie.channels.length*e.type),i=new Uint16Array(n),o=new Uint8Array(x),a=0,s=new Array(e.channels),l=0;l<e.channels;l++)s[l]={},s[l].start=a,s[l].end=s[l].start,s[l].nx=e.width,s[l].ny=e.lines,s[l].size=e.type,a+=s[l].nx*s[l].ny*s[l].size;var c=ee(t,r),h=ee(t,r);if(h>=x)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(c<=h)for(l=0;l<h-c+1;l++)o[l+c]=J(t,r);var u=new Uint16Array(w),A=function(e,t){for(var r=0,n=0;n<w;++n)(0==n||e[n>>3]&1<<(7&n))&&(t[r++]=n);for(var i=r-1;r<w;)t[r++]=0;return i}(o,u),n=X(t,r);H(e.array,t,r,n,i,a);for(l=0;l<e.channels;++l)for(var d=s[l],p=0;p<s[l].size;++p)!function(e,t,r,n,i,o,a){for(var s,l=a<16384,c=i<r?i:r,h=1;h<=c;)h<<=1;for(s=h>>=1,h>>=1;1<=h;){for(var u,A,d,p,m=0,f=m+o*(i-s),g=o*h,v=o*s,_=n*h,y=n*s;m<=f;m+=v){for(var w=m,x=m+n*(r-s);w<=x;w+=y){var b,T=w+_,E=(b=w+g)+_;l?(N(e[w+t],e[b+t]),u=M.a,d=M.b,N(e[T+t],e[E+t]),A=M.a,p=M.b,N(u,A),e[w+t]=M.a,e[T+t]=M.b,N(d,p)):(L(e[w+t],e[b+t]),u=M.a,d=M.b,L(e[T+t],e[E+t]),A=M.a,p=M.b,L(u,A),e[w+t]=M.a,e[T+t]=M.b,L(d,p)),e[b+t]=M.a,e[E+t]=M.b}r&h&&((l?N:L)(e[w+t],e[(b=w+g)+t]),u=M.a,e[b+t]=M.b,e[w+t]=u)}if(i&h)for(w=m,x=m+n*(r-s);w<=x;w+=y){T=w+_;(l?N:L)(e[w+t],e[T+t]),u=M.a,e[T+t]=M.b,e[w+t]=u}s=h,h>>=1}}(i,d.start+p,d.nx,d.size,d.ny,d.nx*d.size,A);!function(e,t,r){for(var n=0;n<r;++n)t[n]=e[t[n]]}(u,i,a);for(var m=0,f=new Uint8Array(i.buffer.byteLength),g=0;g<e.lines;g++)for(var v=0;v<e.channels;v++){var _=(d=s[v]).nx*d.size,y=new Uint8Array(i.buffer,d.end*U,_*U);f.set(y,m),m+=_*U,d.end+=_}return new DataView(f.buffer)}function K(e){var t=e.viewer,r={value:e.offset.value},n=new Uint8Array(e.width*e.lines*(ie.channels.length*e.type*U)),i={version:q(t,r),unknownUncompressedSize:q(t,r),unknownCompressedSize:q(t,r),acCompressedSize:q(t,r),dcCompressedSize:q(t,r),rleCompressedSize:q(t,r),rleUncompressedSize:q(t,r),rleRawSize:q(t,r),totalAcUncompressedCount:q(t,r),totalDcUncompressedCount:q(t,r),acCompression:q(t,r)};if(i.version<2)throw"EXRLoader.parse: "+ie.compression+" version "+i.version+" is unsupported";for(var o=new Array,a=ee(t,r)-U;0<a;){var s=W(t.buffer,r),l=J(t,r),c=l>>2&3,h=new Int8Array([(l>>4)-1])[0],l=J(t,r);o.push({name:s,index:h,type:l,compression:c}),a-=s.length+3}for(var u=ie.channels,A=new Array(e.channels),d=0;d<e.channels;++d){var p=A[d]={},m=u[d];p.name=m.name,p.compression=I,p.decoded=!1,p.type=m.pixelType,p.pLinear=m.pLinear,p.width=e.width,p.height=e.lines}for(var f,g,v={idx:new Array(3)},_=0;_<e.channels;++_)for(p=A[_],d=0;d<o.length;++d){var y=o[d];p.name==y.name&&(p.compression=y.compression,0<=y.index&&(v.idx[y.index]=_),p.offset=_)}if(0<i.acCompressedSize)switch(i.acCompression){case F:var w=new Uint16Array(i.totalAcUncompressedCount);H(e.array,t,r,i.acCompressedSize,w,i.totalAcUncompressedCount);break;case R:var x=Jr(e.array.slice(r.value,r.value+i.totalAcUncompressedCount)),w=new Uint16Array(x.buffer);r.value+=i.totalAcUncompressedCount}0<i.dcCompressedSize&&(f={array:e.array,offset:r,size:i.dcCompressedSize},f=new Uint16Array(z(f).buffer),r.value+=i.dcCompressedSize),0<i.rleRawSize&&(g=V((x=Jr(e.array.slice(r.value,r.value+i.rleCompressedSize))).buffer),r.value+=i.rleCompressedSize);for(var b=0,T=new Array(A.length),d=0;d<T.length;++d)T[d]=new Array;for(var E=0;E<e.lines;++E)for(var B=0;B<A.length;++B)T[B].push(b),b+=A[B].width*e.type*U;G(v,T,A,w,f,n);for(d=0;d<A.length;++d)if(!(p=A[d]).decoded){if(p.compression!==O)throw P,"EXRLoader.parse: unsupported channel compression";for(var C=0,S=0,E=0;E<e.lines;++E){for(var M=T[d][C],N=0;N<p.width;++N){for(var L=0;L<U*p.type;++L)n[M++]=g[S+L*p.width*p.height];S++}C++}}return new DataView(n.buffer)}function W(e,t){for(var r=new Uint8Array(e),n=0;0!=r[t.value+n];)n+=1;e=(new TextDecoder).decode(r.slice(t.value,t.value+n));return t.value=t.value+n+1,e}function j(e,t){e=e.getInt32(t.value,!0);return t.value=t.value+a,e}function X(e,t){e=e.getUint32(t.value,!0);return t.value=t.value+a,e}function Y(e,t){e=e[t.value];return t.value=t.value+s,e}function J(e,t){e=e.getUint8(t.value);return t.value=t.value+s,e}function q(e,t){e=Number(e.getBigInt64(t.value,!0));return t.value+=i,e}function $(e,t){e=e.getFloat32(t.value,!0);return t.value+=o,e}function Z(e){var t=(31744&e)>>10,r=1023&e;return(e>>15?-1:1)*(t?31==t?r?NaN:1/0:Math.pow(2,t-15)*(1+r/1024):r/1024*6103515625e-14)}function ee(e,t){e=e.getUint16(t.value,!0);return t.value+=U,e}function te(e,t,r,n,i){return"string"===n||"stringvector"===n||"iccProfile"===n?(h=t,u=r,A=i,h=(new TextDecoder).decode(new Uint8Array(h).slice(u.value,u.value+A)),u.value=u.value+A,h):"chlist"===n?function(e,t,r,n){for(var i=r.value,o=[];r.value<i+n-1;){var a=W(t,r),s=j(e,r),l=J(e,r);r.value+=3;var c=j(e,r),h=j(e,r);o.push({name:a,pixelType:s,pLinear:l,xSampling:c,ySampling:h})}return r.value+=1,o}(e,t,r,i):"chromaticities"===n?{redX:$(t=e,c=r),redY:$(t,c),greenX:$(t,c),greenY:$(t,c),blueX:$(t,c),blueY:$(t,c),whiteX:$(t,c),whiteY:$(t,c)}:"compression"===n?["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][J(e,r)]:"box2i"===n?{xMin:X(c=e,l=r),yMin:X(c,l),xMax:X(c,l),yMax:X(c,l)}:"lineOrder"===n?["INCREASING_Y"][J(e,r)]:"float"===n?$(e,r):"v2f"===n?[$(l=e,s=r),$(l,s)]:"v3f"===n?[$(s=e,a=r),$(s,a),$(s,a)]:"int"===n?j(e,r):"rational"===n?[j(a=e,o=r),X(a,o)]:"timecode"===n?[X(o=e,e=r),X(o,e)]:"preview"===n?(r.value+=i,"skipped"):void(r.value+=i);var o,a,s,l,c,h,u,A}var re=new DataView(e),ne=new Uint8Array(e),ie={};re.getUint32(0,!0),re.getUint8(4,!0),re.getUint8(5,!0);for(var oe={value:8},ae=!0;ae;){var se,le,ce=W(e,oe);0==ce?ae=!1:void 0===(le=te(re,e,oe,se=W(e,oe),X(re,oe)))?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${se}'.`):ie[ce]=le}var he,ue,Ae,de,pe=ie.dataWindow.yMax+1;switch(ie.compression){case"NO_COMPRESSION":ue=1,he=function(e){return new DataView(e.array.buffer,e.offset.value,e.size)};break;case"RLE_COMPRESSION":ue=1,he=function(e){var t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),e=new Uint8Array(V(t)),t=new Uint8Array(e.length);return Q(e),k(e,t),new DataView(t.buffer)};break;case"ZIPS_COMPRESSION":ue=1,he=z;break;case"ZIP_COMPRESSION":ue=16,he=z;break;case"PIZ_COMPRESSION":ue=32,he=t;break;case"PXR24_COMPRESSION":ue=16,he=function(r){var e=r.array.slice(r.offset.value,r.offset.value+r.size);void 0===fflate&&console.error("THREE.EXRLoader: External library fflate.min.js required.");var n=Jr(e),e=r.lines*r.channels*r.width;const i=new(1==r.type?Uint16Array:Uint32Array)(e);let o=0,a=0;const s=new Array(4);for(let e=0;e<r.lines;e++)for(let e=0;e<r.channels;e++){let t=0;switch(r.type){case 1:s[0]=o,s[1]=s[0]+r.width,o=s[1]+r.width;for(let e=0;e<r.width;++e){var l=n[s[0]++]<<8|n[s[1]++];t+=l,i[a]=t,a++}break;case 2:s[0]=o,s[1]=s[0]+r.width,s[2]=s[1]+r.width,o=s[2]+r.width;for(let e=0;e<r.width;++e){var c=n[s[0]++]<<24|n[s[1]++]<<16|n[s[2]++]<<8;t+=c,i[a]=t,a++}}}return new DataView(i.buffer)};break;case"DWAA_COMPRESSION":ue=32,he=K;break;case"DWAB_COMPRESSION":ue=256,he=K;break;default:throw"EXRLoader.parse: "+ie.compression+" is unsupported"}var me=ie.channels[0].pixelType;if(1===me)switch(this.type){case UnsignedByteType:case FloatType:de=function(e,t){return Z(ee(e,t))},Ae=U;break;case HalfFloatType:de=ee,Ae=U}else{if(2!==me)throw"EXRLoader.parse: unsupported pixelType "+me+" for "+ie.compression+".";switch(this.type){case UnsignedByteType:case FloatType:de=$,Ae=o;break;case HalfFloatType:de=function(e,t){return DataUtils.toHalfFloat($(e,t))},Ae=o}}for(var fe,ge=pe/ue,ve=0;ve<ge;ve++)fe=oe,re.getUint32(0,!0),fe.value=fe.value+i;var _e=ie.dataWindow.xMax-ie.dataWindow.xMin+1,ye=ie.dataWindow.yMax-ie.dataWindow.yMin+1,we=_e*ye*4;switch(this.type){case UnsignedByteType:case FloatType:var xe=new Float32Array(we);ie.channels.length<4&&xe.fill(1,0,we);break;case HalfFloatType:xe=new Uint16Array(we);ie.channels.length<4&&xe.fill(15360,0,we);break;default:console.error("THREE.EXRLoader: unsupported type: ",this.type)}for(var be,Te,Ee={R:0,G:1,B:2,A:3},Be={size:0,width:_e,lines:ue,offset:oe,array:ne,viewer:re,type:me,channels:ie.channels.length},Ce={value:0},Se=0;Se<ye/ue;Se++){be=X(re,oe),we=X(re,oe),Be.lines=ye<be+ue?ye-be:ue,Be.offset=oe,Be.size=we,Te=he(Be),oe.value+=we;for(var Me=0;Me<ue;Me++){var Ne=Me+Se*ue;if(ye<=Ne)break;for(var Le=0;Le<ie.channels.length;Le++)for(var Fe=Ee[ie.channels[Le].name],Ue=0;Ue<_e;Ue++){var Re=Me*(ie.channels.length*_e)+Le*_e+Ue;Ce.value=Re*Ae;Re=de(Te,Ce);xe[4*_e*(ye-1-Ne)+4*Ue+Fe]=Re}}}if(this.type===UnsignedByteType){let r,n;const we=xe.length,He=new Uint8Array(we);for(let t=0;t<ye;++t)for(let e=0;e<_e;++e){var Ie,Pe=xe[n=t*_e*4+4*e],Oe=xe[1+n],De=xe[2+n];r=Oe<Pe?Pe:Oe,r=De>r?De:r,r<1e-32?He[n]=He[1+n]=He[2+n]=He[3+n]=0:(Ie=c(r),r=256*Ie[0]/r,He[n]=Pe*r,He[1+n]=Oe*r,He[2+n]=De*r,He[3+n]=Ie[1]+128)}xe=He}me=this.type===UnsignedByteType?RGBEFormat:RGBAFormat;return{header:ie,width:_e,height:ye,data:xe,format:me,type:this.type}},setDataType:function(e){return this.type=e,this},load:function(e,r,t,n){return DataTextureLoader.prototype.load.call(this,e,function(e,t){switch(e.type){case UnsignedByteType:e.encoding=RGBEEncoding,e.minFilter=NearestFilter,e.magFilter=NearestFilter,e.generateMipmaps=!1,e.flipY=!1;break;case FloatType:case HalfFloatType:e.encoding=LinearEncoding,e.minFilter=LinearFilter,e.magFilter=LinearFilter,e.generateMipmaps=!1,e.flipY=!1}r&&r(e,t)},t,n)}});const exrLoader=new EXRLoader;class EXR extends LoadableComponent{constructor(e,t){super(e,t)}async _load(e,t){this._status,this._setContent.bind(this);const n=new URL(e.url.href+this.source[t].path);return this.report({msg:"Loading image from "+n}),new Promise((t,r)=>{exrLoader.setDataType(UnsignedByteType),exrLoader.load(n.href,function(e){t(e)},void 0,function(e){r(e)})})}}EXR._exportName={singular:"exr",plural:"exrs"};class EnvironmentMap extends BuildableComponent{constructor(e,t){checkPropTypes(t,{},{exr:EXR,id:UUIDRegex,name:"string"}),super(e,t)}async _build(e,t){switch(this.report({msg:`Building ${t} `+e}),e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":if(!this.exr)throw new Error("Missing EXR map");if(!this._tree)throw new Error("No ComponentTree set. Environment map needs renderer from Engine->Tree->Component.");if(!this._tree.pmremGenerator)throw new Error("No pmremGenerator in ComponentTree, are you passing a renderer to the tree?");this._tree.pmremGenerator.compileEquirectangularShader();var r=this._tree.pmremGenerator.fromEquirectangular(this.exr.content.main[t]);this._setContent("main",t,r.texture);break;default:this._setContent(e,t,null)}return this}}EnvironmentMap._exportName={singular:"environmentMap",plural:"environmentMaps"};class MaterialSet extends BuildableComponent{constructor(e,t){super(e,t,{autoLinkDependencies:!1}),this.allMaterials=[],this.allMaterialsIndexed={},checkPropTypes(t,{name:"string"},{categories:e=>Array.isArray(e)&&e.every(e=>e instanceof MaterialCategory),materials:e=>Array.isArray(e)&&e.every(e=>e instanceof WrappedMaterial),id:UUIDRegex}),this._dependencies.main={};for(var r of t.materials||[])this.addExportDependency("material-"+r.id,r);for(var n of t.categories||[])this.addExportDependency("category-"+n.name,n);t.thumbnail&&(this._dependencies.UI=[t.thumbnail]),this.collectMaterials()}_onTreeSet(){const t=this;this._tree.on("change",({cls:e=[]})=>{(e.includes(WrappedMaterial)||e.includes(MaterialCategory))&&(t.report({msg:"Materials or material categories changed in package. Rebuilding."}),t._rebuild())},this.id),this._rebuild()}_onTreeUnset(){this._tree.hasListener("change",this.id)&&this._tree.removeListener("change",this.id)}has(e){return!!this.allMaterialsIndexed[e.id]}size(e=0){return this.allMaterials.length}collectMaterials(){var e,t=this._tree?this._tree.materials.filter(e=>(e.settings.categories||[]).some(e=>(this.settings.categories||[]).includes(e))||-1<this._settings.materials.indexOf(e)):this._settings.materials||[];this.allMaterials=t,this.allMaterialsIndexed={};for(e of t)this.allMaterialsIndexed[e.id]=e;this.report({msg:`size ${t.length} materials`})}async _build(e,t){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":this.collectMaterials(),this._setContent("main",t,this.allMaterials);break;default:this._setContent(e,t,null)}return this}}MaterialSet._exportName={singular:"materialSet",plural:"materialSets"};class WrappedMaterial extends BuildableComponent{constructor(e,t,r={}){r.tree&&r.tree.environmentMaps&&(t.envMap||(t.envMap=r.tree.environmentMaps[0])),super(e,t,{parse:{categories:"integral"}}),checkPropTypes(t,{type:e=>void 0!==WrappedMaterial.materialTypes[e]},{alphaMap:WrappedTexture,aoMap:WrappedTexture,envMap:EnvironmentMap,lightMap:WrappedTexture,map:WrappedTexture,specularMap:WrappedTexture,displacementMap:WrappedTexture,emissiveMap:WrappedTexture,bumpMap:WrappedTexture,normalMap:WrappedTexture,clearcoatMap:WrappedTexture,clearcoatNormalMap:WrappedTexture,gradientMap:WrappedTexture,parallaxMap:WrappedTexture}),this.settings.thumbnail&&this.settings.thumbnail.on("usability-changed",e=>{this._UIStatus=e})}getMaterialSets(){return this._tree?(this._tree.materialSets||[]).filter(e=>e.has(this)):[]}get materialSets(){return this.getMaterialSets()}async _build(e,t){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":if("Nodes"===this._settings.type)console.log("node material 123");else{const o=new WrappedMaterial.materialTypes[this._settings.type];o.userData={PB:{origin:this.id}};const a=Object.keys(this._settings).filter(e=>this._settings[e]instanceof WrappedTexture);let e=Object.keys(o).filter(e=>!a.includes(e));var r,n;for(r of[this._settings,...this._settings.categories||[]]){const s=copyProps({from:r,into:o,required:[],optional:e});e=e.filter(e=>!s.includes(e));for(var i of a)r[i]&&!o[i]&&(o[i]=r[i].content.main[t])}!a.environmentMap&&this._tree&&this._tree.environmentMaps&&this._tree.environmentMaps[0]instanceof EnvironmentMap&&("ready"!==(n=this._tree.environmentMaps[0]).status.main[t]?console.warn(`Can not apply ${n.label} to ${this.label}, status should be "ready" but is "${n.status.main[t]}".`):o.envMap=this._tree.environmentMaps[0].content.main[t]),o.needsUpdate=!0,this._setContent("main",t,o)}break;default:this._setContent(e,t,null)}return this}}WrappedMaterial._exportName={singular:"material",plural:"materials"},WrappedMaterial.materialTypes={Nodes:Nodes,LineBasicMaterial:LineBasicMaterial,LineDashedMaterial:LineDashedMaterial,Material:Material,MeshBasicMaterial:MeshBasicMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshMatcapMaterial:MeshMatcapMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshToonMaterial:MeshToonMaterial,PointsMaterial:PointsMaterial,RawShaderMaterial:RawShaderMaterial,ShaderMaterial:ShaderMaterial,ShadowMaterial:ShadowMaterial,SpriteMaterial:SpriteMaterial};var GLTFLoader=function(){function e(e){Loader.call(this,e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new n(e)}),this.register(function(e){return new o(e)}),this.register(function(e){return new a(e)}),this.register(function(e){return new i(e)}),this.register(function(e){return new t(e)}),this.register(function(e){return new s(e)})}function r(){var r={};return{get:function(e){return r[e]},add:function(e,t){r[e]=t},remove:function(e){delete r[e]},removeAll:function(){r={}}}}e.prototype=Object.assign(Object.create(Loader.prototype),{constructor:e,load:function(t,r,e,n){var i=this,o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:LoaderUtils.extractUrlBase(t);this.manager.itemStart(t);function a(e){n?n(e):console.error(e),i.manager.itemError(t),i.manager.itemEnd(t)}var s=new FileLoader(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,function(e){try{i.parse(e,o,function(e){r(e),i.manager.itemEnd(t)},a)}catch(e){a(e)}},e,a)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')},setKTX2Loader:function(e){return this.ktx2Loader=e,this},setMeshoptDecoder:function(e){return this.meshoptDecoder=e,this},register:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this},unregister:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this},parse:function(e,t,r,n){var i,o={},a={};if("string"==typeof e)i=e;else if(LoaderUtils.decodeText(new Uint8Array(e,0,4))===m){try{o[d.KHR_BINARY_GLTF]=new f(e)}catch(e){return void(n&&n(e))}i=o[d.KHR_BINARY_GLTF].content}else i=LoaderUtils.decodeText(new Uint8Array(e));var s=JSON.parse(i);if(void 0===s.asset||s.asset.version[0]<2)n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var l=new k(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(var c=0;c<this.pluginCallbacks.length;c++){var h=this.pluginCallbacks[c](l);o[(a[h.name]=h).name]=!0}if(s.extensionsUsed)for(c=0;c<s.extensionsUsed.length;++c){var u=s.extensionsUsed[c],A=s.extensionsRequired||[];switch(u){case d.KHR_MATERIALS_UNLIT:o[u]=new p;break;case d.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[u]=new _;break;case d.KHR_DRACO_MESH_COMPRESSION:o[u]=new g(s,this.dracoLoader);break;case d.KHR_TEXTURE_TRANSFORM:o[u]=new v;break;case d.KHR_MESH_QUANTIZATION:o[u]=new y;break;default:0<=A.indexOf(u)&&void 0===a[u]&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(o),l.setPlugins(a),l.parse(r,n)}}});var d={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};function t(e){this.parser=e,this.name=d.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function p(){this.name=d.KHR_MATERIALS_UNLIT}function n(e){this.parser=e,this.name=d.KHR_MATERIALS_CLEARCOAT}function i(e){this.parser=e,this.name=d.KHR_MATERIALS_TRANSMISSION}function o(e){this.parser=e,this.name=d.KHR_TEXTURE_BASISU}function a(e){this.parser=e,this.name=d.EXT_TEXTURE_WEBP,this.isSupported=null}function s(e){this.name=d.EXT_MESHOPT_COMPRESSION,this.parser=e}t.prototype._markDefs=function(){for(var e=this.parser,t=this.parser.json.nodes||[],r=0,n=t.length;r<n;r++){var i=t[r];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}},t.prototype._loadLight=function(e){var t=this.parser,r="light:"+e,n=t.cache.get(r);if(n)return n;var i,o=t.json,a=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e],s=new Color(16777215);void 0!==a.color&&s.fromArray(a.color);var l=void 0!==a.range?a.range:0;switch(a.type){case"directional":(i=new DirectionalLight(s)).target.position.set(0,0,-1),i.add(i.target);break;case"point":(i=new PointLight(s)).distance=l;break;case"spot":(i=new SpotLight(s)).distance=l,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,i.angle=a.spot.outerConeAngle,i.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return i.position.set(0,0,0),i.decay=2,void 0!==a.intensity&&(i.intensity=a.intensity),i.name=t.createUniqueName(a.name||"light_"+e),n=Promise.resolve(i),t.cache.add(r,n),n},t.prototype.createNodeAttachment=function(e){var t=this,r=this.parser,e=r.json.nodes[e],n=(e.extensions&&e.extensions[this.name]||{}).light;return void 0===n?null:this._loadLight(n).then(function(e){return r._getNodeRef(t.cache,n,e)})},p.prototype.getMaterialType=function(){return MeshBasicMaterial},p.prototype.extendParams=function(e,t,r){var n=[];e.color=new Color(1,1,1),e.opacity=1;var i=t.pbrMetallicRoughness;return i&&(Array.isArray(i.baseColorFactor)&&(t=i.baseColorFactor,e.color.fromArray(t),e.opacity=t[3]),void 0!==i.baseColorTexture&&n.push(r.assignTexture(e,"map",i.baseColorTexture))),Promise.all(n)},n.prototype.getMaterialType=function(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?MeshPhysicalMaterial:null},n.prototype.extendMaterialParams=function(e,t){var r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var e=[],n=n.extensions[this.name];return void 0!==n.clearcoatFactor&&(t.clearcoat=n.clearcoatFactor),void 0!==n.clearcoatTexture&&e.push(r.assignTexture(t,"clearcoatMap",n.clearcoatTexture)),void 0!==n.clearcoatRoughnessFactor&&(t.clearcoatRoughness=n.clearcoatRoughnessFactor),void 0!==n.clearcoatRoughnessTexture&&e.push(r.assignTexture(t,"clearcoatRoughnessMap",n.clearcoatRoughnessTexture)),void 0!==n.clearcoatNormalTexture&&(e.push(r.assignTexture(t,"clearcoatNormalMap",n.clearcoatNormalTexture)),void 0!==n.clearcoatNormalTexture.scale&&(n=n.clearcoatNormalTexture.scale,t.clearcoatNormalScale=new Vector2(n,-n))),Promise.all(e)},i.prototype.getMaterialType=function(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?MeshPhysicalMaterial:null},i.prototype.extendMaterialParams=function(e,t){var r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();e=[],n=n.extensions[this.name];return void 0!==n.transmissionFactor&&(t.transmission=n.transmissionFactor),void 0!==n.transmissionTexture&&e.push(r.assignTexture(t,"transmissionMap",n.transmissionTexture)),Promise.all(e)},o.prototype.loadTexture=function(e){var t=this.parser,r=t.json,n=r.textures[e];if(!n.extensions||!n.extensions[this.name])return null;var i=n.extensions[this.name],n=r.images[i.source],i=t.options.ktx2Loader;if(i)return t.loadTextureImage(e,n,i);if(r.extensionsRequired&&0<=r.extensionsRequired.indexOf(this.name))throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null},a.prototype.loadTexture=function(t){var r=this.name,n=this.parser,i=n.json,e=i.textures[t];if(!e.extensions||!e.extensions[r])return null;var e=e.extensions[r],o=i.images[e.source],a=n.textureLoader;return!o.uri||null!==(e=n.options.manager.getHandler(o.uri))&&(a=e),this.detectSupport().then(function(e){if(e)return n.loadTextureImage(t,o,a);if(i.extensionsRequired&&0<=i.extensionsRequired.indexOf(r))throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(t)})},a.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise(function(e){var t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported},s.prototype.loadBufferView=function(e){var t=this.parser.json,e=t.bufferViews[e];if(e.extensions&&e.extensions[this.name]){var a=e.extensions[this.name],e=this.parser.getDependency("buffer",a.buffer),s=this.parser.options.meshoptDecoder;if(s&&s.supported)return Promise.all([e,s.ready]).then(function(e){var t=a.byteOffset||0,r=a.byteLength||0,n=a.count,i=a.byteStride,o=new ArrayBuffer(n*i),r=new Uint8Array(e[0],t,r);return s.decodeGltfBuffer(new Uint8Array(o),n,i,r,a.mode,a.filter),o});if(t.extensionsRequired&&0<=t.extensionsRequired.indexOf(this.name))throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return null};var m="glTF",l=12,c={JSON:1313821514,BIN:5130562};function f(e){this.name=d.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,l);if(this.header={magic:LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==m)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var r=this.header.length-l,n=new DataView(e,l),i=0;i<r;){var o=n.getUint32(i,!0);i+=4;var a,s=n.getUint32(i,!0);i+=4,s===c.JSON?(a=new Uint8Array(e,l+i,o),this.content=LoaderUtils.decodeText(a)):s===c.BIN&&(this.body=e.slice(s=l+i,s+o)),i+=o}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function g(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=d.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function v(){this.name=d.KHR_TEXTURE_TRANSFORM}function u(e){MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var r=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),o=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),a=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),s={specular:{value:(new Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=s,this.onBeforeCompile=function(e){for(var t in s)e.uniforms[t]=s[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",r).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",o).replace("#include <lights_physical_fragment>",a)},Object.defineProperties(this,{specular:{get:function(){return s.specular.value},set:function(e){s.specular.value=e}},specularMap:{get:function(){return s.specularMap.value},set:function(e){(s.specularMap.value=e)?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return s.glossiness.value},set:function(e){s.glossiness.value=e}},glossinessMap:{get:function(){return s.glossinessMap.value},set:function(e){(s.glossinessMap.value=e)?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function _(){return{name:d.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return u},extendParams:function(e,t,r){var n=t.extensions[this.name];e.color=new Color(1,1,1),e.opacity=1;var i=[];return Array.isArray(n.diffuseFactor)&&(t=n.diffuseFactor,e.color.fromArray(t),e.opacity=t[3]),void 0!==n.diffuseTexture&&i.push(r.assignTexture(e,"map",n.diffuseTexture)),e.emissive=new Color(0,0,0),e.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,e.specular=new Color(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture&&(n=n.specularGlossinessTexture,i.push(r.assignTexture(e,"glossinessMap",n)),i.push(r.assignTexture(e,"specularMap",n))),Promise.all(i)},createMaterial:function(e){var t=new u(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function y(){this.name=d.KHR_MESH_QUANTIZATION}function B(e,t,r,n){Interpolant.call(this,e,t,r,n)}g.prototype.decodePrimitive=function(e,t){var r,n=this.json,i=this.dracoLoader,o=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,s={},l={},c={};for(r in a){var h=U[r]||r.toLowerCase();s[h]=a[r]}for(r in e.attributes){var u,A,h=U[r]||r.toLowerCase();void 0!==a[r]&&(u=n.accessors[e.attributes[r]],A=M[u.componentType],c[h]=A,l[h]=!0===u.normalized)}return t.getDependency("bufferView",o).then(function(e){return new Promise(function(n){i.decodeDracoFile(e,function(e){for(var t in e.attributes){var r=e.attributes[t],t=l[t];void 0!==t&&(r.normalized=t)}n(e)},s,c)})})},v.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},((u.prototype=Object.create(MeshStandardMaterial.prototype)).constructor=u).prototype.copy=function(e){return MeshStandardMaterial.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},((B.prototype=Object.create(Interpolant.prototype)).constructor=B).prototype.beforeStart_=B.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n*3+n,o=0;o!==n;o++)t[o]=r[i+o];return t},B.prototype.afterEnd_=B.prototype.copySampleValue_,B.prototype.interpolate_=function(e,t,r,n){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,l=3*a,c=n-t,n=(r-t)/c,r=n*n,t=r*n,h=e*l,u=h-l,A=-2*t+3*r,d=t-r,p=1-A,m=d-r+n,f=0;f!==a;f++){var g=o[u+f+a],v=o[u+f+s]*c,_=o[h+f+a],y=o[h+f]*c;i[f]=p*g+m*v+A*_+d*y}return i};var w=0,x=1,b=2,T=3,E=4,C=5,S=6,M={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},N={9728:NearestFilter,9729:LinearFilter,9984:NearestMipmapNearestFilter,9985:LinearMipmapNearestFilter,9986:NearestMipmapLinearFilter,9987:LinearMipmapLinearFilter},L={33071:ClampToEdgeWrapping,33648:MirroredRepeatWrapping,10497:RepeatWrapping},F={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},U={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},R={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},I={CUBICSPLINE:void 0,LINEAR:InterpolateLinear,STEP:InterpolateDiscrete},A="OPAQUE",P="MASK",O="BLEND";function D(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function H(e,t,r){for(var n in r.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=r.extensions[n])}function Q(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function h(e){for(var t="",r=Object.keys(e).sort(),n=0,i=r.length;n<i;n++)t+=r[n]+":"+e[r[n]]+";";return t}function k(e,t){this.json=e||{},this.extensions={},this.plugins={},this.options=t||{},this.cache=new r,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new ImageBitmapLoader(this.options.manager):this.textureLoader=new TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function V(r,e,n){var t,i,o=e.attributes,a=[];for(t in o){var s=U[t]||t.toLowerCase();s in r.attributes||a.push(function(e,t){return n.getDependency("accessor",e).then(function(e){r.setAttribute(t,e)})}(o[t],s))}return void 0===e.indices||r.index||(i=n.getDependency("accessor",e.indices).then(function(e){r.setIndex(e)}),a.push(i)),Q(r,e),function(e,t,r){var n=t.attributes,i=new Box3;if(void 0!==n.POSITION){var o=(A=r.json.accessors[n.POSITION]).min,a=A.max;if(void 0!==o&&void 0!==a){i.set(new Vector3(o[0],o[1],o[2]),new Vector3(a[0],a[1],a[2]));var s=t.targets;if(void 0!==s){for(var l=new Vector3,c=new Vector3,h=0,u=s.length;h<u;h++){var A,d=s[h];void 0!==d.POSITION&&(o=(A=r.json.accessors[d.POSITION]).min,a=A.max,void 0!==o&&void 0!==a?(c.setX(Math.max(Math.abs(o[0]),Math.abs(a[0]))),c.setY(Math.max(Math.abs(o[1]),Math.abs(a[1]))),c.setZ(Math.max(Math.abs(o[2]),Math.abs(a[2]))),l.max(c)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION."))}i.expandByVector(l)}e.boundingBox=i;t=new Sphere;i.getCenter(t.center),t.radius=i.min.distanceTo(i.max)/2,e.boundingSphere=t}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(r,e,n),Promise.all(a).then(function(){return void 0!==e.targets?function(r,e,t){for(var n=!1,i=!1,o=0,a=e.length;o<a;o++)if(void 0!==(h=e[o]).POSITION&&(n=!0),void 0!==h.NORMAL&&(i=!0),n&&i)break;if(!n&&!i)return Promise.resolve(r);for(var s=[],l=[],o=0,a=e.length;o<a;o++){var c,h=e[o];n&&(c=void 0!==h.POSITION?t.getDependency("accessor",h.POSITION):r.attributes.position,s.push(c)),i&&(c=void 0!==h.NORMAL?t.getDependency("accessor",h.NORMAL):r.attributes.normal,l.push(c))}return Promise.all([Promise.all(s),Promise.all(l)]).then(function(e){var t=e[0],e=e[1];return n&&(r.morphAttributes.position=t),i&&(r.morphAttributes.normal=e),r.morphTargetsRelative=!0,r})}(r,e.targets,n):r})}function G(e,t){var r=e.getIndex();if(null===r){var n=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var o=0;o<i.count;o++)n.push(o);e.setIndex(n),r=e.getIndex()}var a=r.count-2,s=[];if(t===TriangleFanDrawMode)for(o=1;o<=a;o++)s.push(r.getX(0)),s.push(r.getX(o)),s.push(r.getX(o+1));else for(o=0;o<a;o++)o%2==0?(s.push(r.getX(o)),s.push(r.getX(o+1)),s.push(r.getX(o+2))):(s.push(r.getX(o+2)),s.push(r.getX(o+1)),s.push(r.getX(o)));s.length/3!=a&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");e=e.clone();return e.setIndex(s),e}return k.prototype.setExtensions=function(e){this.extensions=e},k.prototype.setPlugins=function(e){this.plugins=e},k.prototype.parse=function(r,e){var n=this,i=this.json,o=this.extensions;this.cache.removeAll(),this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(e){var t={scene:e[0][i.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:i.asset,parser:n,userData:{}};H(o,t,i),Q(t,i),Promise.all(n._invokeAll(function(e){return e.afterRoot&&e.afterRoot(t)})).then(function(){r(t)})}).catch(e)},k.prototype._markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],n=0,i=t.length;n<i;n++)for(var o=t[n].joints,a=0,s=o.length;a<s;a++)e[o[a]].isBone=!0;for(var l=0,c=e.length;l<c;l++){var h=e[l];void 0!==h.mesh&&(this._addNodeRef(this.meshCache,h.mesh),void 0!==h.skin&&(r[h.mesh].isSkinnedMesh=!0)),void 0!==h.camera&&this._addNodeRef(this.cameraCache,h.camera)}},k.prototype._addNodeRef=function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)},k.prototype._getNodeRef=function(e,t,r){if(e.refs[t]<=1)return r;r=r.clone();return r.name+="_instance_"+e.uses[t]++,r},k.prototype._invokeOne=function(e){var t=Object.values(this.plugins);t.push(this);for(var r=0;r<t.length;r++){var n=e(t[r]);if(n)return n}},k.prototype._invokeAll=function(e){var t=Object.values(this.plugins);t.unshift(this);for(var r=[],n=0;n<t.length;n++){var i=e(t[n]);i&&r.push(i)}return r},k.prototype.getDependency=function(e,t){var r=e+":"+t,n=this.cache.get(r);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this.loadNode(t);break;case"mesh":n=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this.loadAnimation(t);break;case"camera":n=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,n)}return n},k.prototype.getDependencies=function(r){var n,e,t=this.cache.get(r);return t||(e=(n=this).json[r+("mesh"===r?"es":"s")]||[],t=Promise.all(e.map(function(e,t){return n.getDependency(r,t)})),this.cache.add(r,t)),t},k.prototype.loadBuffer=function(e){var r=this.json.buffers[e],n=this.fileLoader;if(r.type&&"arraybuffer"!==r.type)throw new Error("THREE.GLTFLoader: "+r.type+" buffer type is not supported.");if(void 0===r.uri&&0===e)return Promise.resolve(this.extensions[d.KHR_BINARY_GLTF].body);var i=this.options;return new Promise(function(e,t){n.load(D(r.uri,i.path),e,void 0,function(){t(new Error('THREE.GLTFLoader: Failed to load buffer "'+r.uri+'".'))})})},k.prototype.loadBufferView=function(e){var n=this.json.bufferViews[e];return this.getDependency("buffer",n.buffer).then(function(e){var t=n.byteLength||0,r=n.byteOffset||0;return e.slice(r,r+t)})},k.prototype.loadAccessor=function(e){var g=this,v=this.json,_=this.json.accessors[e];if(void 0===_.bufferView&&void 0===_.sparse)return Promise.resolve(null);e=[];return void 0!==_.bufferView?e.push(this.getDependency("bufferView",_.bufferView)):e.push(null),void 0!==_.sparse&&(e.push(this.getDependency("bufferView",_.sparse.indices.bufferView)),e.push(this.getDependency("bufferView",_.sparse.values.bufferView))),Promise.all(e).then(function(e){var t,r,n,i=e[0],o=F[_.type],a=M[_.componentType],s=a.BYTES_PER_ELEMENT,l=_.byteOffset||0,c=void 0!==_.bufferView?v.bufferViews[_.bufferView].byteStride:void 0,h=!0===_.normalized,u=c&&c!==s*o?(t=Math.floor(l/c),r="InterleavedBuffer:"+_.bufferView+":"+_.componentType+":"+t+":"+_.count,(n=g.cache.get(r))||(n=new InterleavedBuffer(new a(i,t*c,_.count*c/s),c/s),g.cache.add(r,n)),new InterleavedBufferAttribute(n,o,l%c/s,h)):new BufferAttribute(null===i?new a(_.count*o):new a(i,l,_.count*o),o,h);if(void 0!==_.sparse){var s=M[_.sparse.indices.componentType],l=_.sparse.indices.byteOffset||0,h=_.sparse.values.byteOffset||0,A=new s(e[1],l,_.sparse.count*F.SCALAR),d=new a(e[2],h,_.sparse.count*o);null!==i&&(u=new BufferAttribute(u.array.slice(),u.itemSize,u.normalized));for(var p=0,m=A.length;p<m;p++){var f=A[p];if(u.setX(f,d[p*o]),2<=o&&u.setY(f,d[p*o+1]),3<=o&&u.setZ(f,d[p*o+2]),4<=o&&u.setW(f,d[p*o+3]),5<=o)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return u})},k.prototype.loadTexture=function(e){var t=this.json,r=this.options,n=t.textures[e],t=t.images[n.source],n=this.textureLoader;return!t.uri||null!==(r=r.manager.getHandler(t.uri))&&(n=r),this.loadTextureImage(e,t,n)},k.prototype.loadTextureImage=function(r,n,i){var o=this,a=this.json,s=this.options,l=a.textures[r],c=self.URL||self.webkitURL,h=n.uri,u=!1,A=!0;if("image/jpeg"===n.mimeType&&(A=!1),void 0!==n.bufferView)h=o.getDependency("bufferView",n.bufferView).then(function(e){var t;"image/png"===n.mimeType&&(t=new DataView(e,25,1).getUint8(0,!1),A=6===t||4===t||3===t),u=!0;e=new Blob([e],{type:n.mimeType});return h=c.createObjectURL(e)});else if(void 0===n.uri)throw new Error("THREE.GLTFLoader: Image "+r+" is missing URI and bufferView");return Promise.resolve(h).then(function(n){return new Promise(function(t,e){var r=t;!0===i.isImageBitmapLoader&&(r=function(e){t(new CanvasTexture(e))}),i.load(D(n,s.path),r,void 0,e)})}).then(function(e){!0===u&&c.revokeObjectURL(h),e.flipY=!1,l.name&&(e.name=l.name),A||(e.format=RGBFormat);var t=(a.samplers||{})[l.sampler]||{};return e.magFilter=N[t.magFilter]||LinearFilter,e.minFilter=N[t.minFilter]||LinearMipmapLinearFilter,e.wrapS=L[t.wrapS]||RepeatWrapping,e.wrapT=L[t.wrapT]||RepeatWrapping,o.associations.set(e,{type:"textures",index:r}),e})},k.prototype.assignTexture=function(n,i,o){var a=this;return this.getDependency("texture",o.index).then(function(e){var t,r;void 0===o.texCoord||0==o.texCoord||"aoMap"===i&&1==o.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+o.texCoord+" for texture "+i+" not yet supported."),!a.extensions[d.KHR_TEXTURE_TRANSFORM]||(t=void 0!==o.extensions?o.extensions[d.KHR_TEXTURE_TRANSFORM]:void 0)&&(r=a.associations.get(e),e=a.extensions[d.KHR_TEXTURE_TRANSFORM].extendTexture(e,t),a.associations.set(e,r)),n[i]=e})},k.prototype.assignFinalMaterial=function(e){var t,r,n,i=e.geometry,o=e.material,a=void 0!==i.attributes.tangent,s=void 0!==i.attributes.color,l=void 0===i.attributes.normal,c=!0===e.isSkinnedMesh,h=0<Object.keys(i.morphAttributes).length,u=h&&void 0!==i.morphAttributes.normal;e.isPoints?(r="PointsMaterial:"+o.uuid,(t=this.cache.get(r))||(t=new PointsMaterial,Material.prototype.copy.call(t,o),t.color.copy(o.color),t.map=o.map,t.sizeAttenuation=!1,this.cache.add(r,t)),o=t):e.isLine&&(r="LineBasicMaterial:"+o.uuid,(n=this.cache.get(r))||(n=new LineBasicMaterial,Material.prototype.copy.call(n,o),n.color.copy(o.color),this.cache.add(r,n)),o=n),(a||s||l||c||h)&&(r="ClonedMaterial:"+o.uuid+":",o.isGLTFSpecularGlossinessMaterial&&(r+="specular-glossiness:"),c&&(r+="skinning:"),a&&(r+="vertex-tangents:"),s&&(r+="vertex-colors:"),l&&(r+="flat-shading:"),h&&(r+="morph-targets:"),u&&(r+="morph-normals:"),(n=this.cache.get(r))||(n=o.clone(),c&&(n.skinning=!0),s&&(n.vertexColors=!0),l&&(n.flatShading=!0),h&&(n.morphTargets=!0),u&&(n.morphNormals=!0),a&&(n.vertexTangents=!0,n.normalScale&&(n.normalScale.y*=-1),n.clearcoatNormalScale&&(n.clearcoatNormalScale.y*=-1)),this.cache.add(r,n),this.associations.set(n,this.associations.get(o))),o=n),o.aoMap&&void 0===i.attributes.uv2&&void 0!==i.attributes.uv&&i.setAttribute("uv2",i.attributes.uv),e.material=o},k.prototype.getMaterialType=function(){return MeshStandardMaterial},k.prototype.loadMaterial=function(t){var r,e,n=this,i=this.json,o=this.extensions,a=i.materials[t],s={},l=a.extensions||{},c=[];l[d.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]?(i=o[d.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS],r=i.getMaterialType(),c.push(i.extendParams(s,a,n))):l[d.KHR_MATERIALS_UNLIT]?(e=o[d.KHR_MATERIALS_UNLIT],r=e.getMaterialType(),c.push(e.extendParams(s,a,n))):(h=a.pbrMetallicRoughness||{},s.color=new Color(1,1,1),s.opacity=1,Array.isArray(h.baseColorFactor)&&(e=h.baseColorFactor,s.color.fromArray(e),s.opacity=e[3]),void 0!==h.baseColorTexture&&c.push(n.assignTexture(s,"map",h.baseColorTexture)),s.metalness=void 0!==h.metallicFactor?h.metallicFactor:1,s.roughness=void 0!==h.roughnessFactor?h.roughnessFactor:1,void 0!==h.metallicRoughnessTexture&&(c.push(n.assignTexture(s,"metalnessMap",h.metallicRoughnessTexture)),c.push(n.assignTexture(s,"roughnessMap",h.metallicRoughnessTexture))),r=this._invokeOne(function(e){return e.getMaterialType&&e.getMaterialType(t)}),c.push(Promise.all(this._invokeAll(function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,s)})))),!0===a.doubleSided&&(s.side=DoubleSide);var h=a.alphaMode||A;return h===O?(s.transparent=!0,s.depthWrite=!1):(s.transparent=!1,h===P&&(s.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&r!==MeshBasicMaterial&&(c.push(n.assignTexture(s,"normalMap",a.normalTexture)),s.normalScale=new Vector2(1,-1),void 0!==a.normalTexture.scale&&s.normalScale.set(a.normalTexture.scale,-a.normalTexture.scale)),void 0!==a.occlusionTexture&&r!==MeshBasicMaterial&&(c.push(n.assignTexture(s,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(s.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&r!==MeshBasicMaterial&&(s.emissive=(new Color).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&r!==MeshBasicMaterial&&c.push(n.assignTexture(s,"emissiveMap",a.emissiveTexture)),Promise.all(c).then(function(){var e=r===u?o[d.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(s):new r(s);return a.name&&(e.name=a.name),e.map&&(e.map.encoding=sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=sRGBEncoding),Q(e,a),n.associations.set(e,{type:"materials",index:t}),a.extensions&&H(o,e,a),e})},k.prototype.createUniqueName=function(e){for(var t=PropertyBinding.sanitizeNodeName(e||""),r=t,n=1;this.nodeNamesUsed[r];++n)r=t+"_"+n;return this.nodeNamesUsed[r]=!0,r},k.prototype.loadGeometries=function(e){var r=this,n=this.extensions,t=this.primitiveCache;for(var i=[],o=0,a=e.length;o<a;o++){var s=e[o],l=(l=void 0,c=(l=(c=s).extensions&&c.extensions[d.KHR_DRACO_MESH_COMPRESSION])?"draco:"+l.bufferView+":"+l.indices+":"+h(l.attributes):c.indices+":"+h(c.attributes)+":"+c.mode),c=t[l];c?i.push(c.promise):(c=s.extensions&&s.extensions[d.KHR_DRACO_MESH_COMPRESSION]?function(t){return n[d.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,r).then(function(e){return V(e,t,r)})}(s):V(new BufferGeometry,s,r),t[l]={primitive:s,promise:c},i.push(c))}return Promise.all(i)},k.prototype.loadMesh=function(u){for(var A=this,e=this.json,d=this.extensions,p=e.meshes[u],m=p.primitives,t=[],r=0,n=m.length;r<n;r++){var i=void 0===m[r].material?(void 0===(i=this.cache).DefaultMaterial&&(i.DefaultMaterial=new MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:FrontSide})),i.DefaultMaterial):this.getDependency("material",m[r].material);t.push(i)}return t.push(A.loadGeometries(m)),Promise.all(t).then(function(e){for(var t=e.slice(0,e.length-1),r=e[e.length-1],n=[],i=0,o=r.length;i<o;i++){var a,s=r[i],l=m[i],c=t[i];if(l.mode===E||l.mode===C||l.mode===S||void 0===l.mode)!0!==(a=new(!0===p.isSkinnedMesh?SkinnedMesh:Mesh)(s,c)).isSkinnedMesh||a.geometry.attributes.skinWeight.normalized||a.normalizeSkinWeights(),l.mode===C?a.geometry=G(a.geometry,TriangleStripDrawMode):l.mode===S&&(a.geometry=G(a.geometry,TriangleFanDrawMode));else if(l.mode===x)a=new LineSegments(s,c);else if(l.mode===T)a=new Line(s,c);else if(l.mode===b)a=new LineLoop(s,c);else{if(l.mode!==w)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+l.mode);a=new Points(s,c)}0<Object.keys(a.geometry.morphAttributes).length&&function(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var r=0,n=t.weights.length;r<n;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){var i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(r=0,n=i.length;r<n;r++)e.morphTargetDictionary[i[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}(a,p),a.name=A.createUniqueName(p.name||"mesh_"+u),Q(a,p),l.extensions&&H(d,a,l),A.assignFinalMaterial(a),n.push(a)}if(1===n.length)return n[0];for(var h=new Group,i=0,o=n.length;i<o;i++)h.add(n[i]);return h})},k.prototype.loadCamera=function(e){var t,r=this.json.cameras[e],e=r[r.type];if(e)return"perspective"===r.type?t=new PerspectiveCamera(MathUtils.radToDeg(e.yfov),e.aspectRatio||1,e.znear||1,e.zfar||2e6):"orthographic"===r.type&&(t=new OrthographicCamera(-e.xmag,e.xmag,e.ymag,-e.ymag,e.znear,e.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),Q(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},k.prototype.loadSkin=function(e){var e=this.json.skins[e],t={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(t):this.getDependency("accessor",e.inverseBindMatrices).then(function(e){return t.inverseBindMatrices=e,t})},k.prototype.loadAnimation=function(T){for(var E=this.json.animations[T],e=[],t=[],r=[],n=[],i=[],o=0,a=E.channels.length;o<a;o++){var s=E.channels[o],l=E.samplers[s.sampler],c=s.target,h=void 0!==c.node?c.node:c.id,u=void 0!==E.parameters?E.parameters[l.input]:l.input,s=void 0!==E.parameters?E.parameters[l.output]:l.output;e.push(this.getDependency("node",h)),t.push(this.getDependency("accessor",u)),r.push(this.getDependency("accessor",s)),n.push(l),i.push(c)}return Promise.all([Promise.all(e),Promise.all(t),Promise.all(r),Promise.all(n),Promise.all(i)]).then(function(e){for(var t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],a=[],s=0,l=t.length;s<l;s++){var c,h=t[s],u=r[s],A=n[s],d=i[s],p=o[s];if(void 0!==h){switch(h.updateMatrix(),h.matrixAutoUpdate=!0,R[p.path]){case R.weights:c=NumberKeyframeTrack;break;case R.rotation:c=QuaternionKeyframeTrack;break;default:c=VectorKeyframeTrack}var m=h.name||h.uuid,f=void 0!==d.interpolation?I[d.interpolation]:InterpolateLinear,g=[];R[p.path]===R.weights?h.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&g.push(e.name||e.uuid)}):g.push(m);var v,_=A.array;if(A.normalized){if(_.constructor===Int8Array)v=1/127;else if(_.constructor===Uint8Array)v=1/255;else if(_.constructor==Int16Array)v=1/32767;else{if(_.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");v=1/65535}for(var y=new Float32Array(_.length),w=0,x=_.length;w<x;w++)y[w]=_[w]*v;_=y}for(w=0,x=g.length;w<x;w++){var b=new c(g[w]+"."+R[p.path],u.array,_,f);"CUBICSPLINE"===d.interpolation&&(b.createInterpolant=function(e){return new B(this.times,this.values,this.getValueSize()/3,e)},b.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),a.push(b)}}}e=E.name||"animation_"+T;return new AnimationClip(e,void 0,a)})},k.prototype.loadNode=function(o){var t,e=this.json,a=this.extensions,s=this,l=e.nodes[o],c=l.name?s.createUniqueName(l.name):"";return t=[],void 0!==l.mesh&&t.push(s.getDependency("mesh",l.mesh).then(function(e){e=s._getNodeRef(s.meshCache,l.mesh,e);return void 0!==l.weights&&e.traverse(function(e){if(e.isMesh)for(var t=0,r=l.weights.length;t<r;t++)e.morphTargetInfluences[t]=l.weights[t]}),e})),void 0!==l.camera&&t.push(s.getDependency("camera",l.camera).then(function(e){return s._getNodeRef(s.cameraCache,l.camera,e)})),s._invokeAll(function(e){return e.createNodeAttachment&&e.createNodeAttachment(o)}).forEach(function(e){t.push(e)}),Promise.all(t).then(function(e){var t,r=!0===l.isBone?new Bone:1<e.length?new Group:1===e.length?e[0]:new Object3D;if(r!==e[0])for(var n=0,i=e.length;n<i;n++)r.add(e[n]);return l.name&&(r.userData.name=l.name,r.name=c),Q(r,l),l.extensions&&H(a,r,l),void 0!==l.matrix?((t=new Matrix4).fromArray(l.matrix),r.applyMatrix4(t)):(void 0!==l.translation&&r.position.fromArray(l.translation),void 0!==l.rotation&&r.quaternion.fromArray(l.rotation),void 0!==l.scale&&r.scale.fromArray(l.scale)),s.associations.set(r,{type:"nodes",index:o}),r})},k.prototype.loadScene=function(e){var t=this.json,r=this.extensions,e=this.json.scenes[e],n=new Group;e.name&&(n.name=this.createUniqueName(e.name)),Q(n,e),e.extensions&&H(r,n,e);for(var i=e.nodes||[],o=[],a=0,s=i.length;a<s;a++)o.push(function a(e,s,l,c){var h=l.nodes[e];return c.getDependency("node",e).then(function(e){return void 0===h.skin?e:c.getDependency("skin",h.skin).then(function(e){for(var t=[],r=0,n=(s=e).joints.length;r<n;r++)t.push(c.getDependency("node",s.joints[r]));return Promise.all(t)}).then(function(a){return e.traverse(function(e){if(e.isMesh){for(var t=[],r=[],n=0,i=a.length;n<i;n++){var o=a[n];o?(t.push(o),o=new Matrix4,void 0!==s.inverseBindMatrices&&o.fromArray(s.inverseBindMatrices.array,16*n),r.push(o)):console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',s.joints[n])}e.bind(new Skeleton(t,r),e.matrixWorld)}}),e});var s}).then(function(e){s.add(e);var t=[];if(h.children)for(var r=h.children,n=0,i=r.length;n<i;n++){var o=r[n];t.push(a(o,e,l,c))}return Promise.all(t)})}(i[a],n,t,this));return Promise.all(o).then(function(){return n})},e}(),DRACOLoader=function(e){Loader.call(this,e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}};DRACOLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:DRACOLoader,setDecoderPath:function(e){return this.decoderPath=e,this},setDecoderConfig:function(e){return this.decoderConfig=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(e,r,t,n){var i=new FileLoader(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,e=>{var t={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,t).then(r).catch(n)},t,n)},decodeDracoFile:function(e,t,r,n){r={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!r};this.decodeGeometry(e,r).then(t)},decodeGeometry:function(r,n){for(var e in n.attributeTypes){var t=n.attributeTypes[e];void 0!==t.BYTES_PER_ELEMENT&&(n.attributeTypes[e]=t.name)}var i,o=JSON.stringify(n);if(DRACOLoader.taskCache.has(r)){var a=DRACOLoader.taskCache.get(r);if(a.key===o)return a.promise;if(0===r.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var s=this.workerNextTaskID++,a=r.byteLength,a=this._getWorker(s,a).then(e=>(i=e,new Promise((e,t)=>{i._callbacks[s]={resolve:e,reject:t},i.postMessage({type:"decode",id:s,taskConfig:n,buffer:r},[r])}))).then(e=>this._createGeometry(e.geometry));return a.catch(()=>!0).then(()=>{i&&s&&this._releaseTask(i,s)}),DRACOLoader.taskCache.set(r,{key:o,promise:a}),a},_createGeometry:function(e){var t=new BufferGeometry;e.index&&t.setIndex(new BufferAttribute(e.index.array,1));for(var r=0;r<e.attributes.length;r++){var n=e.attributes[r],i=n.name,o=n.array,n=n.itemSize;t.setAttribute(i,new BufferAttribute(o,n))}return t},_loadLibrary:function(r,e){var n=new FileLoader(this.manager);return n.setPath(this.decoderPath),n.setResponseType(e),n.setWithCredentials(this.withCredentials),new Promise((e,t)=>{n.load(r,e,void 0,t)})},preload:function(){return this._initDecoder(),this},_initDecoder:function(){if(this.decoderPending)return this.decoderPending;var r="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,e=[];return r?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then(e=>{var t=e[0];r||(this.decoderConfig.wasmBinary=e[1]);e=DRACOLoader.DRACOWorker.toString(),e=["/* draco decoder */",t,"","/* worker */",e.substring(e.indexOf("{")+1,e.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([e]))}),this.decoderPending},_getWorker:function(e,t){return this._initDecoder().then(()=>{var r;return this.workerPool.length<this.workerLimit?((r=new Worker(this.workerSourceURL))._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(e){var t=e.data;switch(t.type){case"decode":r._callbacks[t.id].resolve(t);break;case"error":r._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},this.workerPool.push(r)):this.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1}),(r=this.workerPool[this.workerPool.length-1])._taskCosts[e]=t,r._taskLoad+=t,r})},_releaseTask:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]},debug:function(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))},dispose:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}),DRACOLoader.DRACOWorker=function(){var r,t;onmessage=function(e){var o=e.data;switch(o.type){case"init":r=o.decoderConfig,t=new Promise(function(t){r.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(r)});break;case"decode":var a=o.buffer,s=o.taskConfig;t.then(e=>{var t=e.draco,r=new t.Decoder,e=new t.DecoderBuffer;e.Init(new Int8Array(a),a.byteLength);try{var n=function(e,t,r,n){var i,o,a=n.attributeIDs,s=n.attributeTypes,l=t.GetEncodedGeometryType(r);if(l===e.TRIANGULAR_MESH)i=new e.Mesh,o=t.DecodeBufferToMesh(r,i);else{if(l!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");i=new e.PointCloud,o=t.DecodeBufferToPointCloud(r,i)}if(!o.ok()||0===i.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+o.error_msg());var c,h,u,A={index:null,attributes:[]};for(c in a){var d=self[s[c]];if(n.useUniqueIDs)u=a[c],h=t.GetAttributeByUniqueId(i,u);else{if(-1===(u=t.GetAttributeId(i,e[a[c]])))continue;h=t.GetAttribute(i,u)}A.attributes.push(function(e,t,r,n,i,o){var a=o.num_components(),s=r.num_points()*a,l=s*i.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,i),h=e._malloc(l);t.GetAttributeDataArrayForAllPoints(r,o,c,l,h);s=new i(e.HEAPF32.buffer,h,s).slice();return e._free(h),{name:n,array:s,itemSize:a}}(e,t,i,c,d,h))}l===e.TRIANGULAR_MESH&&(A.index=function(e,t,r){var n=3*r.num_faces(),i=4*n,o=e._malloc(i);t.GetTrianglesUInt32Array(r,i,o);n=new Uint32Array(e.HEAPF32.buffer,o,n).slice();return e._free(o),{array:n,itemSize:1}}(e,t,i));return e.destroy(i),A}(t,r,e,s),i=n.attributes.map(e=>e.array.buffer);n.index&&i.push(n.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:n},i)}catch(e){console.error(e),self.postMessage({type:"error",id:o.id,error:e.message})}finally{t.destroy(e),t.destroy(r)}})}}},DRACOLoader.taskCache=new WeakMap,DRACOLoader.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},DRACOLoader.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},DRACOLoader.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},DRACOLoader.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")};const dracoLoader=new DRACOLoader;dracoLoader.setDecoderPath("/test/draco/");const gltfLoader=new GLTFLoader;gltfLoader.setDRACOLoader(dracoLoader);class GeometryFile extends LoadableComponent{constructor(e,t){super(e,t),checkPropTypes(t,{geometryNames:e=>Array.isArray(e)&&e.every(e=>"string"==typeof e)},{})}async _load(e,t){const o=this,a=new URL(e.url.href+this._settings.source[t].path);return this.report({msg:"Loading image from "+a}),new Promise((i,t)=>{gltfLoader.load(a.href,function(e){const t={};for(var r of o._settings.geometryNames){var n=e.scene.getObjectByName(r,!0);if(!n)throw new Error(`Missing specified geometry "${r}" in geometry file at `+a);t[r]=n.geometry}i({file:e,geometries:t})},void 0,function(e){t(e)})})}}GeometryFile._exportName={singular:"geometryFile",plural:"geometryFiles"};class Geometry extends BuildableComponent{constructor(e,t){super(e,t,{parse:{file:"alternatives"}}),checkPropTypes(t,{file:e=>Array.isArray(e)?e.every(e=>e instanceof GeometryFile):e instanceof GeometryFile,geometryName:"string"},{})}async _build(e,t,r){switch(this._status[e][t].setState("loading"),e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":this._setContent("main",t,r.file.content.main[t].geometries[this._settings.geometryName]);break;default:this._setContent(e,t,null)}return this}}Geometry._exportName={singular:"geometry",plural:"geometries"};class Environment extends BuildableComponent{constructor(e,t){super(e,t,{parse:{lights:"integral"}}),checkPropTypes(t,{},{envMap:EnvironmentMap,lights:e=>Array.isArray(e)&&e.every(e=>e instanceof Light)}),null!=t.envMap&&(this._envMapEXR=t.envMap._envMap),this._lights=t.lights,this._envMapCube=t.cubeMap}_setEnvironment(){}}class SceneManager extends InformationSource{constructor(e,t){super(e,t),this._scene=new Scene,this.actors=[],checkPropTypes(t,{},{environments:e=>Array.isArray(e)&&e.every(e=>e instanceof Environment)}),null!=t.environments&&(this._environments=t.environments,this._scene.environment=t.environments[0]._envMapEXR)}get scene(){return this._scene}addActor(e){this.report({msg:"Adding "+e.label,level:"notice"}),this.actors.push(e)}}SceneManager.basis="+X+Y+Z";const basesRegex=/^([+-][xyz])([+-][xyz])([+-][xyz])$/i,nameToIndex={x:0,y:1,z:2},orderedVectors=[new Vector3,new Vector3,new Vector3];function stringToAxes(e){return basesRegex.test(e)?(e=e.toLowerCase()).match(basesRegex).splice(1,3).map(e=>{return{negative:"-"===e[0],name:e[1]}}):null}function getBasisTransform(e,t,r){if(!basesRegex.test(e))return null;if(!basesRegex.test(t))return null;var n=stringToAxes(e),i=stringToAxes(t);for(let e=0;e<3;e++){var o=n[e],a=i[e],s=nameToIndex[o.name],o=o.negative===a.negative;const l=orderedVectors[s];l.set(0,0,0),l[a.name]=o?1:-1}r.makeBasis(orderedVectors[0],orderedVectors[1],orderedVectors[2])}const dracoLoader$1=new DRACOLoader,pathToDir=window.location.href.replace(/[^/]*$/,"");dracoLoader$1.setDecoderPath(pathToDir+"draco/");const gltfLoader$1=new GLTFLoader;gltfLoader$1.setDRACOLoader(dracoLoader$1);class GLTF extends LoadableComponent{constructor(e,t){super(e,t),checkPropTypes(t,{meshNames:e=>Array.isArray(e)&&e.every(e=>"string"==typeof e),basis:"string"},{}),this.transformMatrix=new Matrix4,getBasisTransform(t.basis||"+X+Y+Z",SceneManager.basis,this.transformMatrix)}async _load(e,t){const s=this,l=new URL(e.url.href+this._settings.source[t].path);return this.report({msg:"Loading file from "+l}),new Promise((a,t)=>{gltfLoader$1.load(l.href,function(e){const t={};for(var r of s._settings.meshNames){var n=e.scene.getObjectByName(r,!0);const o=new Mesh;o.name=r,o.geometry=n.geometry;var i=new Group;s.transformMatrix.decompose(i.position,i.quaternion,i.scale);i={meshName:r,mesh:o,transformMatrix:s.transformMatrix,transformQuaternion:i.quaternion,basis:s.settings.basis};if(!n)throw new Error(`Missing specified geometry "${r}" in geometry file at `+l);t[r]=i}a({file:e,gltf:t})},void 0,function(e){t(e)})})}}GLTF._exportName={singular:"gltf",plural:"gltfs"};class WrappedMesh extends BuildableComponent{constructor(e,t){super(e,t),checkPropTypes(t,{meshName:"string",gltf:GLTF,defaultMaterial:WrappedMaterial},{materialVariantGroup:MaterialSet,tilingMultiplier:"number",aoMap:WrappedTexture,aoMapIntensity:"number",normalMap:WrappedTexture,normalMapIntensity:"number"}),Object.getOwnPropertyDescriptor(this,"materialVariantGroup")||(this.materialVariantGroup=t.materialVariantGroup),this._tilingMultiplier=t.tilingMultiplier,this._aoMap=t.aoMap,this._aoMapIntensity=t.aoMapIntensity,this._normalMap=t.normalMap,this._normalMapTiling=t.normalMapTiling,this._normalMapScale=t.normalMapIntensity,this._meshObject=null}async buildMeshMaterial(e){const t=this._normalMap.content.main.medium;t.encoding=3e3,t.wrapS=RepeatWrapping,t.wrapT=RepeatWrapping,t.repeat=this._normalMapTiling;var r=this._normalMapTiling,n=new TextureNode(t);const i=buildNodeMaterial(e,n,r);return i.userData={PB:{origin:e.userData.PB.origin}},i.envMap=e.envMap,this._meshObject.mesh.material=i,this._meshObject.mesh.material.normalScale={x:2,y:2},this._meshObject.mesh.material.needsUpdate=!0,i}async _build(e,t,r){switch(this._status[e][t].setState("loading"),e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":if(this._settings.materialVariantGroup&&!this._settings.materialVariantGroup.has(this._settings.defaultMaterial))throw new Error(`Can not construct ${this.label} because def mat ${this._settings.defaultMaterial.name||this._settings.defaultMaterial.id} is not in its matVarGrp `+(settings.materialVariantGroup.name||settings.materialVariantGroup.id));if(this._meshObject=r.gltf.content.main[t].gltf[this._settings.meshName],this._meshObject.mesh.material=r.defaultMaterial.content.main[t],this.tilingMultiplier)for(var n of["bumpMap","emissiveMap","map","specularMap","roughnessMap","metalnessMap","normalMap"])this._meshObject.mesh.material[n]&&(this._meshObject.mesh.material=this._meshObject.mesh.material.clone(),this._meshObject.mesh.material[n]=this._meshObject.mesh.material[n].clone(),this._meshObject.mesh.material[n].repeat.x*=this._settings.tilingMultiplier,this._meshObject.mesh.material[n].repeat.y*=this._settings.tilingMultiplier,this._meshObject.mesh.material[n].needsUpdate=!0);this._aoMap&&(this._meshObject.mesh.material.aoMap=this._aoMap.content.main[t],this._meshObject.mesh.material.aoMap.needsUpdate=!0),this._aoMapIntensity&&(console.log(this._aoMapIntensity),this._meshObject.mesh.material.aoMapIntensity=this._aoMapIntensity,this._meshObject.mesh.material.aoMap.needsUpdate=!0),this._normalMap&&this.buildMeshMaterial(this._meshObject.mesh.material),this._meshObject.mesh.castShadow=!0,this._meshObject.mesh.receiveShadow=!0,this._setContent("main",t,this._meshObject);break;default:this._setContent(e,t,null)}return this}}WrappedMesh._exportName={singular:"mesh",plural:"meshes"};class Export{constructor(){throw this.revision=1,new Error("Not implemented")}}class PositionedComponent extends BuildableComponent{constructor(e,t){t.assignable=!0===t.assignable,super(e,t),checkPropTypes(t,{component:[{test:BuildableComponent,msg:"must be buildable"},{test:e=>!(e instanceof PositionedComponent),msg:"Do not nest positioned components"}],quaternion:Quaternion,position:Vector3},{}),Object.getOwnPropertyDescriptor(this,"component")||(this.component=t.component),Object.getOwnPropertyDescriptor(this,"assignable")||Object.defineProperty(this,"assignable",{get:()=>t.component.assignable})}get materializable(){return void 0!==this.component.settings.materialVariantGroup}async _build(e,t,r){switch(e){case"UI":this._setContent("UI",t,this._settings.component.content.UI[t]);break;case"main":var n=this._settings.component.content.main[t];const i=n instanceof Object3D?n:Object.values(n).find(e=>e instanceof Object3D),o=i.clone();o.castShadow=!0,o.receiveShadow=!0,o.translateX(this._settings.position.x),o.translateY(this._settings.position.y),o.translateZ(this._settings.position.z),n.transformMatrix instanceof Matrix4&&o.setRotationFromMatrix(n.transformMatrix),o.quaternion.multiply(this._settings.quaternion),o.updateMatrixWorld(),o.name=this.id,Object.defineProperty(o.userData,"origin",{get:()=>(console.log("DEPRECATED! Use userData.PB.origin"),this.id)}),o.userData.PB={origin:this.id,type:this.constructor.name},this._setContent("main",t,o);break;default:this._setContent(e,t,null)}return this}}PositionedComponent._exportLevel="inline";class PositionedMesh extends PositionedComponent{constructor(e,t){super(e,t),checkPropTypes(t,{component:WrappedMesh},{})}}PositionedMesh._exportName={singular:"positionedMesh",plural:"positionedMeshes"},PositionedMesh._exportLevel="inline";class MeshGroup extends BuildableComponent{constructor(e,t){super(e,t,{parse:{positionedMeshes:"integral"}}),checkPropTypes(t,{positionedMeshes:[{test:e=>Array.isArray(e),msg:"Value is not an array"},{test:e=>e.every(e=>e instanceof PositionedMesh),msg:"Array element is not a PositionedMesh"}]},{}),this.subAssignables=t.positionedMeshes.filter(e=>!0===e.assignable)}async _build(e,t,r){switch(this._status[e][t].setState("loading"),e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":var n,i=Object.values(this._settings.positionedMeshes);this._debug&&console.log(i);const a=new Group;for(n of i){var o=n.content.main[t].clone();a.add(o),a.castShadow=!0,a.receiveShadow=!0}this._setContent("main",t,a);break;default:this._setContent(e,t,null)}return this}}MeshGroup._exportName={singular:"meshGroup",plural:"meshGroups"};class PositionedMeshGroup extends PositionedComponent{constructor(e,t){super(e,t),checkPropTypes(t,{component:MeshGroup},{})}}PositionedMeshGroup._exportName={singular:"positionedMeshGroup",plural:"positionedMeshGroups"},PositionedMeshGroup._exportLevel="inline";class BlockCategoryType extends BuildableComponent{constructor(e,t){super(e,t),checkPropTypes(t,{name:"string"},{})}_onTreeSet(){const t=this;this._tree.on("change",({cls:e=[]})=>{e.includes(BlockCategory)&&(t.report({msg:"Block categories changed in package. Rebuilding."}),t._rebuild("main"))},this.id),this._rebuild("main")}_onTreeUnset(){this._tree.hasListener("change",this.id)&&this._tree.removeListener("change",this.id)}async _build(e,t){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":var r,n=this._tree?this._tree.blockCategories.filter(e=>e.settings.type===this):[];for(r of Component.qualities)this._setContent("main",r,n);this.report({msg:`Built block category type of ${n.length} block categories.`});break;default:this._setContent(e,t,null)}return this}}BlockCategoryType._exportName={singular:"blockCategoryType",plural:"blockCategoryTypes"};class BlockCategory extends BuildableComponent{constructor(e,t){super(e,t),checkPropTypes(t,{name:"string",type:BlockCategoryType},{id:UUIDRegex})}_onTreeSet(){const t=this;this._tree.on("change",({cls:e=[]})=>{e.includes(Block)&&(t.report({msg:"Blocks changed in package. Rebuilding."}),t._rebuild())},this.id),this._rebuild()}_onTreeUnset(){this._tree.hasListener("change",this.id)&&this._tree.removeListener("change",this.id)}async _build(e,t){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":var r=this._tree?this._tree.blocks.filter(e=>(e.settings.categories||[]).find(e=>e===this)):[];this._setContent("main",t,r),this.report({msg:`Built category of ${r.length} blocks.`});break;default:this._setContent(e,t,null)}return this}}BlockCategory._exportName={singular:"blockCategory",plural:"blockCategories"};class Block extends BuildableComponent{constructor(e,r){if(r.assignable="boolean"!=typeof r.assignable||r.assignable,r.dimensions=void 0!==r.dimensions?r.dimensions:new Vector3(1,1,1),r.dimensionsCenter=void 0!==r.dimensionsCenter?r.dimensionsCenter:new Vector3(.5,.5,.5),super(e,r,{parse:{positionedMeshes:"integral",positionedMeshGroups:"integral",connectors:"integral",categories:"integral"}}),this.distinctPositionedMeshes=void 0,this.distinctMeshes=void 0,this.distinctMVGs=void 0,this.distinctMeshesPerMVG=void 0,this.subAssignables=void 0,this.connectors||(this.connectors=[]),checkPropTypes(r,{},{theme:Theme,connectors:e=>Array.isArray(e)&&e.every(e=>e instanceof Connector),positionedMeshes:e=>Array.isArray(e)&&e.every(e=>e instanceof PositionedMesh),positionedMeshGroups:e=>Array.isArray(e)&&e.every(e=>e instanceof PositionedMeshGroup),categories:e=>Array.isArray(e)&&e.every(e=>e instanceof BlockCategory)}),r.theme){var t=(r.connectors||[]).find(e=>e.themeGroup);if(t)throw new Error(`${this.label} has theme "${r.theme.name}" AND ${t.label} with theme group "${t.themeGroup.name}". This is not allowed.`)}for(var n of r.connectors||[])n.block=this;this.distinctPositionedMeshes=this.allDependencies.filter(e=>e instanceof PositionedMesh).filter(unique),this.distinctMeshes=this.distinctPositionedMeshes.map(e=>e.component).filter(unique),this.distinctMVGs=[],this.distinctMeshesPerMVG={};for(var i of this.distinctMeshes)i.materialVariantGroup&&(this.distinctMVGs.includes(i.materialVariantGroup)||this.distinctMVGs.push(i.materialVariantGroup),this.distinctMeshesPerMVG[i.materialVariantGroup.id]=[i,...this.distinctMeshesPerMVG[i.materialVariantGroup.id]||[]]);this.subAssignables=(r.positionedMeshes||[]).filter(e=>1==e.assignable).map(e=>({positionedMesh:e}));for(let t of r.positionedMeshGroups||[])!0===t.assignable&&this.subAssignables.push({positionedMeshGroup:t}),this.subAssignables.push(...t.assignableDependencies.map(e=>({positionedMeshGroup:t,positionedMesh:e})));for(var o of this.subAssignables)o.assigningComponent=getAssigningComponent(o),o.materialVariantGroups=o.assigningComponent.applicableMaterialVariantGroups,o.id="B:"+this.slug,o.name=this.name||this.slug,o.positionedMeshGroup&&(o.name+=" "+o.positionedMeshGroup.slug,o.id="-MG:"+o.positionedMeshGroup.slug),o.positionedMesh&&(o.name+=" "+o.positionedMesh.name||o.positionedMesh.slug,o.id="-M:"+o.positionedMeshGroup.slug);t=new Vector3(-this.settings.dimensions.x/2,-this.settings.dimensions.y/2,-this.settings.dimensions.z/2),r=new Vector3(this.settings.dimensions.x/2,this.settings.dimensions.y/2,this.settings.dimensions.z/2),t=new Box3(t,r),r=new Float32Array([t.min.x,t.min.y,t.min.z,t.min.x,t.min.y,t.max.z,t.max.x,t.min.y,t.max.z,t.max.x,t.min.y,t.min.z,t.min.x,t.max.y,t.min.z,t.min.x,t.max.y,t.max.z,t.max.x,t.max.y,t.max.z,t.max.x,t.max.y,t.min.z]);const a=new BufferGeometry;a.name="boundingBox",a.visible=!1,a.setAttribute("position",new BufferAttribute(r,3));const s=new Matrix4;t=new Quaternion,r=new Vector3(1,1,1);s.compose(this.settings.dimensionsCenter,t,r),a.applyMatrix4(s),this.boundingBox=a}_onTreeSet(){}async _build(e,t,r){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":const l=new Group;l.castShadow=!0,l.receiveShadow=!0;new AxesHelper(5);const c=new Group;c.name="connectors";const h=new Vector3(0,0,.1);h.normalize();var n=new Vector3(0,0,0);new ArrowHelper(h,n,.15,16711680,.05,.05);if(this._settings.positionedMeshGroups){var i,n=Object.values(this._settings.positionedMeshGroups||{});this._debug&&console.log("PosMeshGroups groups",n);for(i of n){var o=i.content.main[t].clone();l.add(o)}}if(this._settings.positionedMeshes){var a,s=Object.values(this._settings.positionedMeshes);this._debug&&console.log("Positioned meshed",s);for(a of s){const u=a.content.main[t].clone();u.castShadow=!0,u.receiveShadow=!0,l.add(u)}}s={block:l,connectors:this._settings.connectors||[]};this._setContent("main",t,s);break;case"specs":this._settings.dimensionsImage?this._setContent("specs",t,this._settings.dimensionsImage.content.main[t]):this._setContent("specs",t,Project.defaultImages.missing.cloneNode(!0));break;default:this._setContent(e,t,null)}return this}}Block._exportName={singular:"block",plural:"blocks"};class ConnectionType extends BuildableComponent{constructor(e,t){t.connectors||(t.connectors=[]),super(e,t,{parse:{connectorTypes:"integral",connectors:"integral"}}),checkPropTypes(t,{connectorTypes:t=>{if(!Array.isArray(t))return"Not an array";if(2!==t.length)return t.length+" connector types specified, but only 2 are allowed.";for(let e=0;e<t.length;e+=1){var r=t[e];if(!(r instanceof ConnectorType))return`Entry connectorTypes[${e}] is not a ConnectorType, but a `+r.constructor.name}return!0}},{parent:[ConnectorType,e=>!!t.connectorTypes.includes(e)||"Parent connector type is not in allowed connector types."]})}get isEqual(){return void 0===this._settings.parent}async _build(e,t){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":var r=this._settings;this._setContent("main",t,r);break;default:this._setContent(e,t,null)}return this}}ConnectionType._exportName={singular:"connectionType",plural:"connectionTypes"};class ComponentTree$1 extends BuildableComponent{constructor(e,o={},a={}){const t=[],r=a.import||[];for(var n of r){n=n.cls.exportName;void 0!==o[n]&&t.push(...o[n]),o[n]=[]}const i=Object.keys(o).filter(e=>Array.isArray(o[e])&&0<o[e].length);if(0<i.length)throw new Error("Component tree found no import instructions for settings: "+i.join(", "));if(super(e,o,{autoLinkDependencies:void 0===a.autoLinkDependencies||a.autoLinkDependencies,...BuildableComponent.autogenIntegralInstruction(o)}),this._tree=void 0,this._externalTrees=void 0,this._importInlined=void 0,this.loader=void 0,this._componentsById=void 0,this.renderer=void 0,this.pmremGenerator=void 0,(this._tree=this)._componentsById={},a.renderer&&(this.renderer=a.renderer,this.pmremGenerator=new PMREMGenerator(this.renderer)),checkPropTypes(a,{},{externalTrees:t=>{if(!Array.isArray(t))return"Not an array.";for(let e=0;e<t.length;e+=1){var r=t[e];if(!(r instanceof ComponentTree$1))return`Instruction externalTrees[${e}] is not a ComponentTree, but a `+r.constructor.name}return!0},loader:ComponentLoader}),this.addEvent("change"),this.addEvent("import-complete"),this._importInstructions=r,this._importInlined=r.filter(e=>"inline"===e.cls.exportLevel).reduce((e,t)=>Object.assign(e,{[t.cls.exportName]:t.cls}),{}),a.externalTrees){this._externalTrees=a.externalTrees;var s={};for(let i of[...Object.keys(o),...a.externalTrees.map(e=>Object.keys(e.settings)).flat()].filter(unique))Object.defineProperty(s,i,{get:()=>{const e=o[i];var t,r=a.externalTrees.map(e=>e[i]);const n=[];for(t of[e,...r].filter(e=>void 0!==e).filter(unique))Array.isArray(t)?n.push(...t):n.push(t);return n}});this.inclusive=s}this.loader=a.loader||new ComponentLoader(this._reporter),0<t.length&&this.addComponent(...t)}findComponentById(e){var t=this._componentsById[e];if(t)return t;if(Array.isArray(this._externalTrees))for(const n of this._externalTrees){var r=n.findComponentById(e);if(r)return r}}findDependingComponents(e){const t=[];for(var r of Object.values(this.settings).filter(e=>Array.isArray(e)))for(var n of r)if(n instanceof BuildableComponent)for(var i of Component.parts)-1===Object.values(n.dependencies[i]).indexOf(e)||t.push(n);return t}_throwIfDependingComponents(e){const t=this.findDependingComponents(e);if(0<t.length)throw new Error("Component is depended upon by "+t.map(e=>e.constructor.name+" "+e.name||e.id).join(", "))}hasComponent(t){return!!(this._settings[t.exportName]&&-1<this._settings[t.exportName].indexOf(t))||!(!this._externalTrees||!this._externalTrees.find(e=>e[t.exportName]&&-1<e[t.exportName].indexOf(t)))}addComponent(e,...t){this._addComponent(e,...t),this._postChangeHandler([e,...t])}_addComponent(t,...e){this.report({msg:"Adding a "+t.constructor.name,level:"debug"});let r=!0;Array.isArray(e)&&!1===e[0]&&(r=!1,e=void 0);const n=this._settings[t.exportName];if(this._externalTrees&&this._externalTrees.find(e=>e[t.exportName]&&-1<e[t.exportName].indexOf(t)))this.report({msg:"Component already in external tree "+t.label,level:"debug"});else{if(!n)throw new Error(`${this.label} Can not add unknown component class: ${t.constructor.name} -> `+t.exportName);if(!0===r&&t instanceof BuildableComponent||"Block"===t.constructor.name||"MeshGroup"===t.constructor.name)for(var i of Component.parts)for(var[o,a]of Object.entries(t.dependencies[i])||[])if(Array.isArray(a)&&0<a.length){const u=a.filter(e=>!1===this.hasComponent(e));this.report({msg:`Adding ${u.length} new dependencies of ${a.length} total for ${t.constructor.name}.`+o,level:"debug"}),u.forEach(e=>{this._addComponent(e)})}else{if(!(a instanceof Component))throw new Error("Dependency not an instance of Component!");try{!1===this.hasComponent(a)&&(this.report({msg:`Adding dependency: ${t.constructor.name}.`+o,level:"debug"}),this._addComponent(a))}catch(e){throw console.error(e,a),e}}if(-1<n.indexOf(t))this.report({msg:"Component already in tree "+t.label,level:"debug"});else{var s,l=this._componentsById[t.id];if(l)throw new Error("Component id already in tree: "+l.label);n.push(t),(this._componentsById[t.id]=t)instanceof ComponentTree$1||(t.tree=this),this.report({msg:"Added "+t.label,level:"debug"});for(s of Component.parts)for(var c of Component.qualities)"ready"===this._status[s][c].state&&this._status[s][c].setState("partially-loaded")}}if(e)for(var h of e)this._addComponent(h);return!0}_postChangeHandler(e){console.assert(Array.isArray(e),"component_tree._postChangeHandler() expects an array, not a "+e.constructor.name),this._autoLink(this._settings,BuildableComponent.autogenIntegralInstruction(this._settings));e=e.map(e=>e.constructor).filter(unique);this.emit("change",{type:"autolinked-dependencies",tree:this,cls:e})}removeComponent(e,t){const r=this._settings[e.exportName];if(!r)throw new Error("Unknown component class "+e.constructor.name);this._throwIfDependingComponents(e);var n=r.indexOf(e);if(-1===n)throw new Error(e.constructor.name+" is not included in tree");if(r.splice(n,1),delete this._componentsById[e.id],t&&e instanceof BuildableComponent)for(var i of e.dependencies)if(0===this.findDependingComponents(i).length)try{this.removeComponent(i)}catch(e){throw new Error(`Could not remove dependency ${i.name||i.id}. `+e.message)}this._postChangeHandler([e]),this.report({msg:"Removed "+e.label}),this.emit("change",{type:"component-removed",cls:[e.constructor],component:e,tree:this})}static linkSetting(n,i,t){if(Array.isArray(t))return t.map(e=>ComponentTree$1.linkSetting(n,i,e));if("object"==typeof t){const r=Object.keys(t);if(2===r.length&&["x","y"].every(e=>r.includes(e)))return new Vector2(t.x,t.y);if(3===r.length&&["x","y","z"].every(e=>r.includes(e)))return new Vector3(t.x,t.y,t.z);if(4===r.length&&["_x","_y","_z","_w"].every(e=>r.includes(e)))return new Quaternion(t._x,t._y,t._z,t._w);if(3===r.length&&["r","g","b"].every(e=>r.includes(e)))return 1<t.r||1<t.g||1<t.b?new Color(t.r/255,t.g/255,t.b/255):new Color(t.r,t.g,t.b);if(n._importInlined[i]){var e=ComponentTree$1.linkJSONObj(n,t);return new n._importInlined[i](n._reporter,e)}return Object.entries(t).reduce((e,[t,r])=>Object.assign(e,{[t]:ComponentTree$1.linkSetting(n,i,r)}),{})}if(void 0!==t){if("string"==typeof t&&"id"!==i&&null!==t.match(UUIDRegex)){e=n.findComponentById(t);if(!e)throw new Error(`Missing dependency "${i}": `+t);return e}if("string"!=typeof t||null===t.match(URLRegex))return"string"==typeof t&&2===t.length&&t.match(/[\+|-][x|y|z]/)?Project.standardQuaternions[t]:("map"===i.toLowerCase().substr(-3)||"thumbnail"===i?this.report({level:"warning",msg:`Seems like imported property ${i} should be linked, but its value is not a (valid) UUID.`}):"url"===i&&this.report({level:"warning",msg:`Seems like imported property ${i} should be a valid URL, but it isn't recognized as one.`}),t);try{return new URL(t)}catch(e){return t}}}static linkJSONObj(n,e){return Object.entries(e).reduce((e,[t,r])=>{r=ComponentTree$1.linkSetting(n,t,r);return void 0!==r&&(e[t]=r),e},{})}_instantiateLinkedComponentFromJSONObject(t,r){let e=null;try{e=ComponentTree$1.linkJSONObj(this,t)}catch(e){throw console.log(t),e.message+=" while importing "+r.exportName,new Error(e)}return e.source&&e.source.path&&(e.source={medium:e.source}),new r(this._reporter,e,{tree:this})}static createFromJSON(e,t,r,n={}){let i={};for(var o of Object.keys(e))"section"===o.substr(-7).toLowerCase()&&delete e[o];const a=this.importInstructions.map(e=>e.cls.exportName);for(var[s,l]of Object.entries(e))a.includes(s)||(i[s]=l);if(e.pkg){if(!r)throw new Error("Missing pkg argument");if(r.id!==e.pkg)throw new Error("Wrong pkg argument");i=ComponentTree$1.linkJSONObj(r,omit(["pkg"],i)),i.pkg=r}const c=new this(t,i,n);return c.importJSON(e),c}importJSON(e){var t,r=(new Date).getTime(),n=e.id;if(console.debug("Import JSON",n),e.id&&e.id!==this.id)throw new Error(`Look like a complete export. Did you mean to call ${this.constructor.name}.createFromJSON()?`);this.report({msg:"Start importing new JSON object"});let i=null;const o=[],a=[];for(t of this._importInstructions)if(void 0!==e[t.cls.exportName]&&(this.report({msg:`Found ${t.cls.exportName} entry in JSON obj`}),t.cls===Component||t.cls.prototype instanceof Component)){var s=e[t.cls.exportName];if("Configuration"===t.cls.name)for(var l of s)a.push(l);else{console.assert(Array.isArray(s)),this.report({msg:`Importing ${s.length} component`+(1<s.length?"s":"")});for(var c of s)try{var h=this._instantiateLinkedComponentFromJSONObject(c,t.cls);this._addComponent(h,!1),o.push(h)}catch(e){i=e;break}if(i)break}}var u,n=(new Date).getTime();if(null!==i)throw this.report({level:"error",msg:"Basic import failed"}),i;this.report({level:"info",msg:`Basic import complete in ${n-r}ms`}),this._postChangeHandler(o),this.emit("import-complete",{tree:this});for(u of a){const d=ComponentTree$1.Configuration.createFromJSON({...u},this._reporter,this);var A=d.copy();o.push(A),this._settings.configurations=this._settings.configurations||[],this._settings.configurations.push(A)}n=(new Date).getTime();if(null===i)return this.report({level:"notice",msg:`Full import complete in ${n-r}ms`}),o;throw this.report({level:"error",msg:"Full import incomplete"}),i}toJSON(){var e=super.toJSON();const t=this.constructor.importInstructions.map(e=>e.cls);var r=t.map(e=>e.exportName),n=t.filter(e=>"inline"===e.exportLevel),r=pick(r,e);const i={};if(Object.assign(i,e[this.exportName][0]),Object.assign(i,r),"Package"===this.constructor.name)for(var o of n)delete i[o.exportName];return this.pkg&&(i.pkg=this.pkg.id),i}}class BlockSet extends BuildableComponent{constructor(e,t){super(e,t,{autoLinkDependencies:!1}),this.allBlocks=[],checkPropTypes(t,{name:"string"},{categories:e=>Array.isArray(e)&&e.every(e=>e instanceof BlockCategory),blocks:e=>Array.isArray(e)&&e.every(e=>e instanceof Block),id:UUIDRegex}),this._dependencies.main={};for(var r of t.blocks||[])this.addExportDependency("block-"+r.id,r);for(var n of t.categories||[])this.addExportDependency("category-"+n.name,n);t.thumbnail&&(this._dependencies.UI=[t.thumbnail]),this.collectBlocks()}_onTreeSet(){const t=this;this._tree.on("change",({cls:e=[]})=>{e.includes(Block,BlockCategory)&&(t.report({msg:"Blocks or block categories changed in package. Rebuilding."}),t._rebuild())},this.id),this._rebuild()}_onTreeUnset(){this._tree.hasListener("change",this.id)&&this._tree.removeListener("change",this.id)}has(e){return this.allBlocks.includes(e)}size(e=0){return this.allBlocks.length}collectBlocks(){var e=this._tree?this._tree.blocks.filter(e=>(e.settings.categories||[]).some(e=>(this.settings.categories||[]).includes(e))||-1<this._settings.blocks.indexOf(e)):this._settings.blocks||[];this.allBlocks=e,this.report({msg:`size ${e.length} blocks`})}async _build(e,t){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":this.collectBlocks(),this._setContent("main",t,this.allBlocks);break;default:this._setContent(e,t,null)}return this}}BlockSet._exportName={singular:"blockSet",plural:"blockSets"};const emptyConnectorTemplate={connectors:[]};class Connectable extends BuildableComponent{constructor(e,t){if(super(e,t),this.connectorTemplate=void 0,this.connections=void 0,this.equalConnections=void 0,this.unequalConnections=void 0,this.connectedTo=void 0,this.siblings=void 0,this.parentConnection=void 0,this.parent=void 0,this.childConnections=void 0,this.children=void 0,this.childMaterialAssignments=void 0,!this.constructor.connectorTemplateSetting)throw new Error(this.constructor.name+" is missing static property connectorTemplateSetting");checkPropTypes(t,{},{[this.constructor.connectorTemplateSetting]:[BuildableComponent]}),t[this.constructor.connectorTemplateSetting]?this.connectorTemplate=t[this.constructor.connectorTemplateSetting]:this.connectorTemplate=emptyConnectorTemplate}clone(e={}){const t=super.clone(e);return t.connectorTemplate=this.connectorTemplate,t}get siblingChains(){const e=[],t={};for(var r of this.siblings||[]){var n=[r,...Connectable.findSiblings(r,[this,...e])];t[r.id]=n,e.push(...n)}return t}findMaterialAssignments(){return this._tree&&this._tree.materialAssignments?this._tree.materialAssignments.filter(e=>e.blockInstance===this):[]}_updateConnections(){this.materialAssignments=this.findMaterialAssignments(),this.connections=(this._tree.connections||[]).filter(e=>e.from.connectable===this&&this.connectorTemplate.connectors.includes(e.from.connector)||e.to.connectable===this&&this.connectorTemplate.connectors.includes(e.to.connector)),this.equalConnections=this.connections.filter(e=>void 0===e.type.parent),this.unequalConnections=this.connections.filter(e=>void 0!==e.type.parent),this.connectedTo=this.connections.map(e=>(e.from.connectable===this?e.to:e.from).connectable),this.siblings=this.equalConnections.map(e=>(e.from.connectable===this?e.to:e.from).connectable);const t=this.unequalConnections.find(e=>{return e[e.from.connectable===this?"from":"to"].connector===e.type.parent});var e;t&&(e=(this.parentConnection=t).from.connectable===this?"to":"from",this.parent=t[e].connectable);const r=this.unequalConnections.filter(e=>e!==t);r&&(this.childConnections=r,this.children=r.map(e=>e.connectables.find(e=>e!==this)),this.childMaterialAssignments=this.children.map(e=>e.findMaterialAssignments()).flat())}_onTreeSet(){console.assert(this._tree instanceof Configuration,this.constructor.name+" can not be added to a "+this._tree.constructor.name);const t=this;if(!this._tree.findComponentById(this.connectorTemplate.id))throw new Error(`ConnectorTemplate ${this.connectorTemplate.label} not in tree`);this._tree.on("change",({cls:e})=>{e.find(e=>"Connection"===e.name)&&t._updateConnections()},this.id),this._updateConnections()}_onTreeUnset(){this._tree.removeListeners("change",this.id),this.connections=void 0,this.connectedTo=void 0,this.materialAssignments=void 0,this.childMaterialAssignments=void 0}}Connectable.findSiblings=(t,r=[])=>(t.siblings||[]).filter(e=>!r.includes(e)).map(e=>[e,...Connectable.findSiblings(e,[t,...r])]).flat();class BlockInstance extends Connectable{constructor(e,t){checkPropTypes(t,{block:Block}),super(e,t),this.assignableByDefinerId=void 0,this.bestMainContent=void 0,this.bestMainContent=new Group,this.bestMainContent.castShadow=!0,this.bestMainContent.receiveShadow=!0,this.block||(this.block=t.block),this.assignableByDefinerId={},this.assignables=this.block.subAssignables.map(e=>({blockInstance:this,...e})),!0===this.assignable&&this.assignables.push({blockInstance:this,assigningComponent:this,materialVariantGroups:this.applicableMaterialVariantGroups,name:this.block.name||this.block.slug});for(var r of this.assignables){this.assignableByDefinerId[r.assigningComponent.id]=r;var n="BI:"+this.slug;r.id=r.id?n+"-"+r.id:n}this.boundingBox=t.block.boundingBox}get assignable(){return this.block.assignable}get materializable(){return!1}_onTreeSet(){if(!this._tree.findComponentById(this.block.id))throw new Error("Block (template) not in tree");super._onTreeSet()}_onTreeUnset(){super._onTreeUnset()}_setContent(e,t,r){if(this._content[e][t]=r,"main"===e){for(;0<this.bestMainContent.children.length;)this.bestMainContent.remove(this.bestMainContent.children[0]);var n=this._content.main.medium;null!==n&&this.bestMainContent.add(n)}return super._setContent(e,t,r)}get assignedMaterials(){return this._tree?this._tree.materialAssignments.filter(e=>e.blockInstance===this):[]}async _build(e,t,r){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":const i=this._settings.block.content.main[t].block,o=i.clone();o.castShadow=!0,o.receiveShadow=!0,o.name=this.id,o.userData.PB={type:"blockInstance",origin:this.id,blockInstance:this,isAssignable:this.assignable,assignableComponent:!0===this.assignable?{blockInstance:this}:null};var n=o;o.traverse(t=>{t.userData||(t.userData={}),t.userData.PB||(t.userData.PB={}),"PositionedMeshGroup"===t.userData.PB.type?t.userData.PB.positionedMeshGroup=t.userData.PB.origin:t.userData.PB.positionedMeshGroup=t.parent?.userData?.PB?.positionedMeshGroup,"PositionedMesh"===t.userData.PB.type?(t.userData.PB.positionedMesh=t.userData.PB.origin,t.userData.PB.processed=!0):t.userData.PB.positionedMesh=t.parent?.userData?.PB?.positionedMesh,!0===t.userData.PB.isAssignable?t.userData.PB.assignable=this.assignables.find(e=>e.blockInstance===t.userData.PB.blockInstance&&e.positionedMeshGroup===t.userData.PB.positionedMeshGroup&&e.positionedMesh===t.userData.PB.positionedMesh):t.userData.PB.assignable=t.parent?.userData?.PB?.assignable}),this._setContent("main",t,n);break;default:this._setContent(e,t,null)}return this}}BlockInstance._exportName={singular:"blockInstance",plural:"blockInstances"},BlockInstance._exportLevel="inline",BlockInstance.connectorTemplateSetting="block",BlockInstance.treeLock=!1;class Connection extends Connectable{constructor(e,t){t.blockInstances&&delete t.blockInstances,super(e,t),this.connectables=void 0,this.connectors=void 0,this.connectorTypes=void 0,this._tree=void 0,this.type=void 0;for(var r of["from","to"]){if(!t[r])throw new Error(`Missing "${r}" object`);if(!(t[r].connectable instanceof Connectable))throw t[r].connectable?new Error(`${r}.connectable is not a Connectable, but a ${t[r].connectable.constructor.name}.`):new Error(`Missing a ${r}.connectable.`);if(!(t[r].connector instanceof Connector))throw t[r].connector?new Error(`${r}.connector is not a Connector, but a ${t[r].connector.constructor.name}.`):new Error(`Missing ${r}.connector.`);if(!t[r].connectable.block.dependsDirectlyOn(t[r].connector))throw new Error(`Entry ${r} connector is not a dependency of block`);if(t.quaternion&&!t.quaternion instanceof Quaternion)throw new Error(".quaternion is not a Quaternion but a "+t.quaternion.constructor.name)}if(t.quaternion||(this.quaternion=Connection.defaultQuaternion),this.inverseQuaternion=this.quaternion.clone().invert(),t.from.connectable===t.to.connectable)throw new Error("Connections to and from blocks are the same.");this.connectors=[t.from.connector,t.to.connector],this.connectorTypes=[t.from.connector.type,t.to.connector.type],this.connectables=[t.from.connectable,t.to.connectable],this.from||(this.from=t.from),this.to||(this.to=t.to)}_onTreeSet(){for(var e of["from","to"]){var t=this._settings[e].connectable.exportName;if(!this._tree[t]||!this._tree[t].includes(this._settings[e].connectable))throw new Error(`${e} ${t} is not specified in the tree (${this._settings[e].connectable.label}).`)}if(!this._tree.inclusive.connectionTypes)throw new Error("No connection types defined in tree");var r=this._tree.inclusive.connectionTypes.find(e=>e.connectorTypes[0]===this.connectorTypes[0]&&e.connectorTypes[1]===this.connectorTypes[1]||e.connectorTypes[0]===this.connectorTypes[1]&&e.connectorTypes[1]===this.connectorTypes[0]);if(!r)throw console.error(this._tree.inclusive.connectionTypes),new Error(`Missing this connection's type in tree.pkg [${this.connectorTypes[0].label} <-> ${this.connectorTypes[1].label}]`);if(this.type=r,this.type.parent&&this.connectorTypes[0]===this.connectorTypes[1])throw new Error(this.type.label+" defines a parent/child relationship, but both connectors have the same type in "+this.label);this.connectorTemplate=r,super._onTreeSet()}_onTreeUnset(){super._onTreeUnset(),this.type=void 0}connects(e){return e instanceof Connectable?this._settings.from.connectable===e||this._settings.to.connectable===e:e instanceof Connector&&(this._settings.from.connector===e||this._settings.to.connector===e)}_build(e,t,r){this._setContent(e,t,"-")}}Connection._exportName={singular:"connection",plural:"connections"},Connection._exportLevel="inline",Connection.connectorTemplateSetting="connectionType",Connection.baseQuaternion=new Quaternion(0,1,0,0),Connection.defaultQuaternion=new Quaternion(0,0,0,1),Connection.treeLock=!1;class MaterialAssignment extends BuildableComponent{constructor(e,t){if(t.blockInstances&&delete t.blockInstances,super(e,t),this.affectedComponents=void 0,this._relevantMaterialSets=void 0,this._tree=void 0,checkPropTypes(t,{blockInstance:BlockInstance,material:[WrappedMaterial]},{positionedMesh:[PositionedComponent,e=>!0===t.blockInstance.dependsOn(e)||e.label+" is not a dependency of "+t.blockInstance.label]}),this.assigningComponent=getAssigningComponent(t),!0!==this.assigningComponent.assignable)throw new Error(this.assigningComponent.label+" is not assignable");if(this.assigningComponent.applicableMaterialVariantGroups.find(e=>e.has(t.material))||console.warn(this.label+" will affect no components."),t.positionedMesh&&!t.blockInstance.dependsOn(t.positionedMesh))throw new Error(t.positionedMesh.label+" is not a dependency of "+t.blockInstance.label);if(t.positionedMeshGroup){if(!t.blockInstance.dependsOn(t.positionedMeshGroup))throw new Error(t.positionedMeshGroup.label+" is not a dependency of "+t.blockInstance.label);if(t.positionedMesh&&!t.positionedMeshGroup.dependsOn(t.positionedMesh))throw new Error(t.positionedMesh.label+" is not a dependency of "+t.positionedMeshGroup.label)}this._relevantMaterialSets=[],this.materializableComponents=this.assigningComponent.materializable?[this.assigningComponent,...this.assigningComponent.materializableDependencies]:this.assigningComponent.materializableDependencies,this.affectedComponents=this.materializableComponents.filter(e=>e instanceof PositionedComponent&&e.component.materialVariantGroup.has(t.material)),this.blockInstance||(this.blockInstance=t.blockInstance),this.material||(this.material=t.material)}_updateRelevantMaterialSets(){this._tree&&(this._relevantMaterialSets=this._tree.materialSetsByMaterial(this.material))}_onTreeSet(){if(!this._tree.findComponentById(this.blockInstance.block.id))throw new Error(`BlockInstance.block (the BlockInstance's "template") not in tree`);if(!this._tree.findComponentById(this.material.id))throw new Error("Material not in tree");this._tree.on("material-sets-by-material-update",this._updateRelevantMaterialSets.bind(this),this.id)}_onTreeUnset(){this._tree.removeListener("material-sets-by-material-update",this.id)}_build(e,t,r){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":this._setContent("main",t,this._settings.material);break;default:this._setContent(e,t,null)}return this}}MaterialAssignment._exportName={singular:"materialAssignment",plural:"materialAssignments"},MaterialAssignment._exportLevel="inline",MaterialAssignment.treeLock=!1;const findConnection=(t,r,e)=>{let n=null,i=null,o=null,a=null,s=e.find(e=>t.includes(e.from.connectable)&&r.includes(e.to.connectable));return s?(n=s.from,i=s.to,o=t,a=r):(s=e.find(e=>r.includes(e.from.connectable)&&t.includes(e.to.connectable)),s&&(n=s.to,i=s.from,o=r,a=t)),s?{connection:s,from:o,to:a,blockInA:n,blockInB:i}:null},calculatePlacement=t=>{const r={};console.assert(Array.isArray(t.blockInstances)&&0<t.blockInstances.length,"No block instances in configuration"),r[t.blockInstances[0].id]={position:new Vector3,quaternion:new Quaternion,type:"connectable"};const n=t.blockInstances.slice(1,t.blockInstances.length),i=[t.blockInstances[0]];var o=n.length;for(let e=0;e<o;e+=1){var a=findConnection(i,n,t.connections);if(!a)throw new Error("Unbuildable configuration. Missing connection between placed and unplaced block instances.");var s=a.connection;const l=a.blockInA,c=a.blockInB;console.assert(l.connector.quaternion instanceof Quaternion),console.assert(s.quaternion instanceof Quaternion),console.assert(s.inverseQuaternion instanceof Quaternion),console.assert(c.connector.quaternion instanceof Quaternion);const h=l.connector.position.clone();h.applyQuaternion(r[l.connectable.id].quaternion);const u=c.connector.position.clone().negate(),A=new Quaternion;A.copy(r[l.connectable.id].quaternion),A.multiply(l.connector.quaternion),a.from===i?A.multiply(s.quaternion):A.multiply(s.inverseQuaternion),A.multiply(Connection.baseQuaternion),A.multiply(c.connector.quaternion.clone().invert()),u.applyQuaternion(A);const d=r[l.connectable.id].position.clone();d.add(h),d.add(u),r[c.connectable.id]={position:d,quaternion:A,debug:{anchorTo:l,connection:s,anchorToConnectionVector:h,connectionToTargetVector:u},type:"connectable"};a=r[l.connectable.id].position.clone().add(h);r[s.id]={position:a,debug:{anchorTo:l,connection:s,anchorToConnectionVector:h,connectionToTargetVector:u},type:"connection"},i.push(...n.splice(n.indexOf(c.connectable),1))}return r};var findConnectedConnectors=e=>{const n=[];for(let r of e||[])for(let t of["from","to"]){if(void 0!==n.find(e=>e.connectable===r[t].connectable&&e.connector===r[t].connector))throw new Error(`Double usage of ${r[t].connector.label} in `+r.label);n.push(r[t])}return n};const findExtendOptions=e=>{var t=(e.blockInstances||[]).concat(e.connections||[]);const n=[];if(0===t.length)for(var r of e.pkg.blocks||[])n.push({block:r,placement:{position:new Vector3,quaternion:new Quaternion}});else for(let r of t)for(let t of r.connectorTemplate.connectors)if(!(e.connections||[]).find(e=>e.from.connectable===r&&e.from.connector===t||e.to.connectable===r&&e.to.connector===t)){const o=e.placement[r.id];for(var i of t.mate.connectors)n.push({block:i.block,connection:{from:{connectable:r,connector:t},to:{connectable:"new",connector:i}},placement:{position:o.position.clone().add(t.position.clone().applyQuaternion(o.quaternion)),quaternion:t.quaternion.clone().multiply(o.quaternion)}})}return n},findInsertOptions=e=>{const r=[];for(var n of e.connections||[]){var i,o=n.from.connector.mate.connectors||[];const a=n.to.connector.mate.connectors||[];for(let t of o){const s=t.block.connectors.filter(e=>e!==t);for(i of s.filter(e=>-1<a.indexOf(e)))r.push({type:"insert",oldConnection:n,block:t.block,newConnection1:{from:n.from,to:{connectable:"new",connector:t}},newConnection2:{from:{connectable:"new",connector:i},to:n.to},placement:e.placement[n.id]})}}return r},findBlockInstanceOptions=e=>{const t=[],r=[];for(var n of e.blockInstances||[]){var i=n.equalConnections,o={blockInstance:n,oldConnections:i,siblingChains:n.siblingChains,placement:e.placement[n.id]};switch(i.length){case 0:case 1:var a={blockInstance:n,oldConnections:i,placement:e.placement[n.id]};t.push(a);break;case 2:const s=[i[0].from.connectable!==n?i[0].from:i[0].to,i[1].from.connectable!==n?i[1].from:i[1].to];s[0].connector.mate.connectors.includes(s[1].connector)&&t.push({blockInstance:n,oldConnections:i,newConnection:{from:s[0],to:s[1]},placement:e.placement[n.id]}),r.push(o);break;default:r.push(o)}}return{cutOptions:t,splitOptions:r}};function getDimensions(e){e.content.main.medium;var t=new Vector3,r=e.boundingBox.boundingBox.getCenter(t),n=new Vector3(r.x,0,r.z),i=e.boundingBox.boundingBox.min,o=e.boundingBox.boundingBox.max;e.boundingBox.boundingBox.getSize(t);return{center:r,base:n,min:i,max:o,width:Math.round(100*e.boundingBox.boundingBox.getSize(t).x),height:Math.round(100*e.boundingBox.boundingBox.getSize(t).y),depth:Math.round(100*e.boundingBox.boundingBox.getSize(t).z),dimLeft:[{start:new Vector3(i.x,i.y,o.z),end:new Vector3(i.x,i.y,i.z)}],dimBack:[{start:new Vector3(i.x,i.y,i.z),end:new Vector3(o.x,i.y,i.z)}],dimRight:[{start:new Vector3(o.x,i.y,i.z),end:new Vector3(o.x,i.y,o.z)}],dimFront:[{start:new Vector3(i.x,i.y,o.z),end:new Vector3(o.x,i.y,o.z)}],dimHeight:[{start:new Vector3(i.x,i.y,i.z),end:new Vector3(i.x,o.y,i.z)}]}}var CSS2DObject=function(e){Object3D.call(this),this.element=e||document.createElement("div"),this.element.style.position="absolute",this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)})})};CSS2DObject.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:CSS2DObject,copy:function(e,t){return Object3D.prototype.copy.call(this,e,t),this.element=e.element.cloneNode(!0),this}});var CSS2DRenderer=function(){var r,n,s,l,c=this,h=new Vector3,i=new Matrix4,u=new Matrix4,A={objects:new WeakMap},d=document.createElement("div");d.style.overflow="hidden",this.domElement=d,this.getSize=function(){return{width:r,height:n}},this.setSize=function(e,t){s=(r=e)/2,l=(n=t)/2,d.style.width=e+"px",d.style.height=t+"px"};var o,a,p=function(e,t,r){var n,i;e instanceof CSS2DObject&&(e.onBeforeRender(c,t,r),h.setFromMatrixPosition(e.matrixWorld),h.applyMatrix4(u),n=e.element,/apple/i.test(navigator.vendor)?n.style.transform="translate(-50%,-50%) translate("+Math.round(h.x*s+s)+"px,"+Math.round(-h.y*l+l)+"px)":n.style.transform="translate(-50%,-50%) translate("+(h.x*s+s)+"px,"+(-h.y*l+l)+"px)",n.style.display=e.visible&&-1<=h.z&&h.z<=1?"":"none",i={distanceToCameraSquared:m(r,e)},A.objects.set(e,i),n.parentNode!==d&&d.appendChild(n),e.onAfterRender(c,t,r));for(var o=0,a=e.children.length;o<a;o++)p(e.children[o],t,r)},m=(o=new Vector3,a=new Vector3,function(e,t){return o.setFromMatrixPosition(e.matrixWorld),a.setFromMatrixPosition(t.matrixWorld),o.distanceToSquared(a)}),f=function(e){var t=[];return e.traverse(function(e){e instanceof CSS2DObject&&t.push(e)}),t};this.render=function(e,t){!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),i.copy(t.matrixWorldInverse),u.multiplyMatrices(t.projectionMatrix,i),p(e,e,t),function(e){for(var t=f(e).sort(function(e,t){return A.objects.get(e).distanceToCameraSquared-A.objects.get(t).distanceToCameraSquared}),r=t.length,n=0,i=t.length;n<i;n++)t[n].element.style.zIndex=r-n}(e)}},CSS3DObject=function(e){Object3D.call(this),this.element=e||document.createElement("div"),this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)})})};CSS3DObject.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:CSS3DObject,copy:function(e,t){return Object3D.prototype.copy.call(this,e,t),this.element=e.element.cloneNode(!0),this}});var CSS3DSprite=function(e){CSS3DObject.call(this,e)};CSS3DSprite.prototype=Object.create(CSS3DObject.prototype),CSS3DSprite.prototype.constructor=CSS3DSprite;class Timer extends InformationSource{constructor(e,t){super(e,t),this.emitUpdates=!1,this.updateRequests={},this.addEvent("update")}trigger(){!1===this.emitUpdates&&requestAnimationFrame(this.animationFrameTimer.bind(this))}addUpdateRequest(e,t){if(!t)throw new Error("Description required");void 0===this.updateRequests[e]&&(this.updateRequests[e]=t,!1===this.emitUpdates&&(this.report({msg:"start updates"}),this.emitUpdates=!0),requestAnimationFrame(this.animationFrameTimer.bind(this)))}hasRequestId(e){return this.updateRequests[e],!0}removeUpdateRequest(e){delete this.updateRequests[e],0===Object.keys(this.updateRequests).length&&(this.report({msg:"stop updates"}),this.emitUpdates=!1)}animationFrameTimer(e){this.emit("update",e),!0===this.emitUpdates&&requestAnimationFrame(this.animationFrameTimer.bind(this))}}class DimensionFrame{constructor(e,t,r=["front","left"]){this.getAngle=function(e,t){return(360+180*Math.atan2(t,e)/Math.PI)%360},this.configurator=e,this.view=t,this.id=v4(),this.lines=r,this.elems={};for(var n of r){this.elems[n]={};const i=document.createElement("div"),o=document.createElement("div"),a=document.createElement("div");i.appendChild(o),i.appendChild(a),i.id=`dimension-line-${this.id.substr(0,5)}-`+n,o.classList.add("dimension-line"),o.classList.add(n),a.classList.add("dimension-label"),a.classList.add(n),i.style.position="absolute",i.style.left="0px",i.style.top="0px",i.style.transformOrigin="top left",i.style.zIndex=10,this.elems[n]=i,t.domElement.appendChild(i)}this.onSceneUpdate()}onSceneUpdate(){this.configDims=this.configurator.configuration.dimensions,this.linePoints=this.lines.reduce((e,t)=>(e[t]={start:this.configDims["dim"+ucFirst(t)][0].start.clone(),end:this.configDims["dim"+ucFirst(t)][0].end.clone()},console.log(t,e[t]),e),{})}update(){for(var e of this.lines){var t=this.view.project(this.linePoints[e].start.clone()),r=this.view.project(this.linePoints[e].end.clone()),n=new Vector2(t.x,t.y),r=new Vector2(r.x,r.y);const i=(new Vector2).subVectors(r,n);n=this.getAngle(i.x,i.y);this.elems[e].style.width=i.length()+"px",this.elems[e].style.transform="translate3d("+t.x+"px,"+t.y+"px,0px) rotate("+n+"deg)"}}}var defaultCameraSettings={fov:45,aspect:window.innerWidth/window.innerHeight,near:.01,far:1e3},HorizontalBlurShader={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","varying vec2 vUv;","void main() {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","\tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","\tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","\tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","\tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","\tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","\tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","\tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","\tgl_FragColor = sum;","}"].join("\n")},VerticalBlurShader={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","varying vec2 vUv;","void main() {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","\tgl_FragColor = sum;","}"].join("\n")};class ContactShadow extends BuildableComponent{constructor(e,t){super(e,t),checkPropTypes(t,{},{contactShadow:Object,scene:Scene,camera:Camera,renderer:WebGLRenderer}),this.name="ContactShadow",this.planeWidth=30,this.planeHeight=30,this.planeColor="#ffffff",this.planeOpacity=1,this.cameraHeight=.35,this.shadowDarkness=1,this.shadowOpacity=1,this.blurAmount=.25,this.showWireframe=!0,this._scene=t.scene,this._camera=t.camera,this._renderer=t.renderer}async _build(){const e=new PlaneGeometry(this.planeWidth,this.planeHeight).rotateX(Math.PI/2);e.name="ContactShadow Plane";var t=new MeshBasicMaterial({name:"ContactShadow Material",opacity:this.shadowOpacity,transparent:!0,envMap:null});const r=new Mesh(e,t);r.name="ContactShadow Plane",r.scale.y=-1,r.receiveShadow=!0;const n=new Mesh(e);n.name="ContactShadow Blur Plane",n.visible=!1;const i=new OrthographicCamera(-this.planeWidth/2,this.planeHeight/2,this.planeHeight/2,-this.planeHeight/2,0,this.cameraHeight);i.rotation.x=Math.PI/2;const o=new MeshDepthMaterial;o.userData.darkness={value:this.shadowDarkness},o.onBeforeCompile=function(e){e.uniforms.darkness=o.userData.darkness,e.fragmentShader=`
					uniform float darkness;
					${e.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * darkness );")}
				`},o.depthTest=!1,o.depthWrite=!1;const a=new ShaderMaterial(HorizontalBlurShader);a.depthTest=!1;const s=new ShaderMaterial(VerticalBlurShader);s.depthTest=!1;const l=new Group;return l.name="ContactShadow Group",l.position.y=-0,l.children=[r,n,i],l.layers.set(1),l.receiveShadow=!0,this._shadowGroup=l,this._shadowBlurPlane=n,this._horizontalBlurMaterial=a,this._verticalBlurMaterial=s,this._shadowCamera=i,this._depthMaterial=o,this._shadowPlaneMaterial=t,this}_blur(e){return this._shadowBlurPlane.visible=!0,this._shadowPlaneMaterial.map=this._renderTargets[0],this._shadowBlurPlane.material=this._verticalBlurMaterial,this._shadowBlurPlane.material.uniforms.tDiffuse.value=this._renderTargets[0].texture,this._verticalBlurMaterial.uniforms.v.value=+e/256,this._renderer.setRenderTarget(this._renderTargets[1]),this._renderer.render(this._shadowBlurPlane,this._shadowCamera),this._shadowBlurPlane.material=this._horizontalBlurMaterial,this._shadowBlurPlane.material.uniforms.tDiffuse.value=this._renderTargets[1].texture,this._horizontalBlurMaterial.uniforms.h.value=+e/256,this._renderer.setRenderTarget(this._renderTargets[0]),this._renderer.render(this._shadowBlurPlane,this._shadowCamera),this._shadowBlurPlane.visible=!1,this._renderTargets}_update(e){const t=new WebGLRenderTarget(512,512);t.texture.format=RGBAFormat,t.texture.generateMipmaps=!1;const r=new WebGLRenderTarget(512,512);r.texture.generateMipmaps=!1;var n=[t,r];this._renderTargets=n;n=this._scene.background;if(this._scene.background=null,e instanceof Array)for(var i=0;i<e.length;i++)e[i].visible=!1;if(this._scene.overrideMaterial=this._depthMaterial,this._renderer.autoClear=!1,this._renderer.setRenderTarget(t),this._renderer.render(this._scene,this._shadowCamera),this._scene.overrideMaterial=null,e instanceof Array)for(i=0;i<e.length;i++)e[i].visible=!0;this._blur(this.blurAmount),this._blur(.4*this.blurAmount),this._renderer.setRenderTarget(null),this._scene.background=n}}function Pass(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}Object.assign(Pass.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),Pass.FullScreenQuad=function(){var t=new OrthographicCamera(-1,1,1,-1,0,1),r=new BufferGeometry;r.setAttribute("position",new Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),r.setAttribute("uv",new Float32BufferAttribute([0,2,0,0,2,0],2));function e(e){this._mesh=new Mesh(r,e)}return Object.defineProperty(e.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(e.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(e){e.render(this._mesh,t)}}),e}();var RenderPass=function(e,t,r,n,i){Pass.call(this),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=n,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Color};RenderPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:RenderPass,render:function(e,t,r){var n,i,o=e.autoClear;e.autoClear=!1,void 0!==this.overrideMaterial&&(i=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),n=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,n),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=i),e.autoClear=o}});var CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")},ShaderPass=function(e,t){Pass.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=UniformsUtils.clone(e.uniforms),this.material=new ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Pass.FullScreenQuad(this.material)};ShaderPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:ShaderPass,render:function(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil)),this.fsQuad.render(e)}});var MaskPass=function(e,t){Pass.call(this),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1};MaskPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:MaskPass,render:function(e,t,r){var n,i,o=e.getContext(),a=e.state;a.buffers.color.setMask(!1),a.buffers.depth.setMask(!1),a.buffers.color.setLocked(!0),a.buffers.depth.setLocked(!0),i=this.inverse?(n=0,1):(n=1,0),a.buffers.stencil.setTest(!0),a.buffers.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),a.buffers.stencil.setFunc(o.ALWAYS,n,4294967295),a.buffers.stencil.setClear(i),a.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),a.buffers.color.setLocked(!1),a.buffers.depth.setLocked(!1),a.buffers.stencil.setLocked(!1),a.buffers.stencil.setFunc(o.EQUAL,1,4294967295),a.buffers.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),a.buffers.stencil.setLocked(!0)}});var ClearMaskPass=function(){Pass.call(this),this.needsSwap=!1};ClearMaskPass.prototype=Object.create(Pass.prototype),Object.assign(ClearMaskPass.prototype,{render:function(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}});var EffectComposer=function(e,t){var r,n;this.renderer=e,void 0===t?(r={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat},n=e.getSize(new Vector2),this._pixelRatio=e.getPixelRatio(),this._width=n.width,this._height=n.height,(t=new WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,r)).texture.name="EffectComposer.rt1"):(this._pixelRatio=1,this._width=t.width,this._height=t.height),this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===CopyShader&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===ShaderPass&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new ShaderPass(CopyShader),this.clock=new Clock};Object.assign(EffectComposer.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},insertPass:function(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},removePass:function(e){e=this.passes.indexOf(e);-1!==e&&this.passes.splice(e,1)},isLastEnabledPass:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0},render:function(e){void 0===e&&(e=this.clock.getDelta());for(var t,r,n,i=this.renderer.getRenderTarget(),o=!1,a=this.passes.length,s=0;s<a;s++)!1!==(n=this.passes[s]).enabled&&(n.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),n.render(this.renderer,this.writeBuffer,this.readBuffer,e,o),n.needsSwap&&(o&&(t=this.renderer.getContext(),(r=this.renderer.state.buffers.stencil).setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),r.setFunc(t.EQUAL,1,4294967295)),this.swapBuffers()),void 0!==MaskPass&&(n instanceof MaskPass?o=!0:n instanceof ClearMaskPass&&(o=!1)));this.renderer.setRenderTarget(i)},reset:function(e){var t;void 0===e&&(t=this.renderer.getSize(new Vector2),this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)),this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this._width=e,this._height=t;var r=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(r,n),this.renderTarget2.setSize(r,n);for(var i=0;i<this.passes.length;i++)this.passes[i].setSize(r,n)},setPixelRatio:function(e){this._pixelRatio=e,this.setSize(this._width,this._height)}});var Pass$1=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(Pass$1.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),Pass$1.FullScreenQuad=function(){var t=new OrthographicCamera(-1,1,1,-1,0,1),r=new BufferGeometry;r.setAttribute("position",new Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),r.setAttribute("uv",new Float32BufferAttribute([0,2,0,0,2,0],2));function e(e){this._mesh=new Mesh(r,e)}return Object.defineProperty(e.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(e.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(e){e.render(this._mesh,t)}}),e}();var LuminosityHighPassShader={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new Color(0)},defaultOpacity:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tvec3 luma = vec3( 0.299, 0.587, 0.114 );","\tfloat v = dot( texel.xyz, luma );","\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","\tgl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")},UnrealBloomPass=function(e,t,r,n){Pass.call(this),this.strength=void 0!==t?t:1,this.radius=r,this.threshold=n,this.resolution=void 0!==e?new Vector2(e.x,e.y):new Vector2(256,256),this.clearColor=new Color(0,0,0);var i={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetBright=new WebGLRenderTarget(o,a,i),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var s=0;s<this.nMips;s++){var l=new WebGLRenderTarget(o,a,i);l.texture.name="UnrealBloomPass.h"+s,l.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(l);l=new WebGLRenderTarget(o,a,i);l.texture.name="UnrealBloomPass.v"+s,l.texture.generateMipmaps=!1,this.renderTargetsVertical.push(l),o=Math.round(o/2),a=Math.round(a/2)}void 0===LuminosityHighPassShader&&console.error("THREE.UnrealBloomPass relies on LuminosityHighPassShader");e=LuminosityHighPassShader;this.highPassUniforms=UniformsUtils.clone(e.uniforms),this.highPassUniforms.luminosityThreshold.value=n,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,defines:{}}),this.separableBlurMaterials=[];for(var c=[3,5,7,9,11],o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2),s=0;s<this.nMips;s++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(c[s])),this.separableBlurMaterials[s].uniforms.texSize.value=new Vector2(o,a),o=Math.round(o/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new Vector3(1,1,1),new Vector3(1,1,1),new Vector3(1,1,1),new Vector3(1,1,1),new Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===CopyShader&&console.error("THREE.UnrealBloomPass relies on CopyShader");t=CopyShader;this.copyUniforms=UniformsUtils.clone(t.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,blending:AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new Color,this.oldClearAlpha=1,this.basic=new MeshBasicMaterial,this.fsQuad=new Pass.FullScreenQuad(null)};UnrealBloomPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:UnrealBloomPass,dispose:function(){for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()},setSize:function(e,t){var r=Math.round(e/2),n=Math.round(t/2);this.renderTargetBright.setSize(r,n);for(var i=0;i<this.nMips;i++)this.renderTargetsHorizontal[i].setSize(r,n),this.renderTargetsVertical[i].setSize(r,n),this.separableBlurMaterials[i].uniforms.texSize.value=new Vector2(r,n),r=Math.round(r/2),n=Math.round(n/2)},render:function(e,t,r,n,i){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();var o=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),i&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);for(var a=this.renderTargetBright,s=0;s<this.nMips;s++)this.fsQuad.material=this.separableBlurMaterials[s],this.separableBlurMaterials[s].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[s].uniforms.direction.value=UnrealBloomPass.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[s]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[s].uniforms.colorTexture.value=this.renderTargetsHorizontal[s].texture,this.separableBlurMaterials[s].uniforms.direction.value=UnrealBloomPass.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[s]),e.clear(),this.fsQuad.render(e),a=this.renderTargetsVertical[s];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,i&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?e.setRenderTarget(null):e.setRenderTarget(r),this.fsQuad.render(e),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=o},getSeperableBlurMaterial:function(e){return new ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new Vector2(.5,.5)},direction:{value:new Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(e){return new ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),UnrealBloomPass.BlurDirectionX=new Vector2(1,0),UnrealBloomPass.BlurDirectionY=new Vector2(0,1);var SSAARenderPass=function(e,t,r,n){Pass.call(this),this.scene=e,this.camera=t,this.sampleLevel=4,this.unbiased=!0,this.clearColor=void 0!==r?r:0,this.clearAlpha=void 0!==n?n:0,this._oldClearColor=new Color,void 0===CopyShader&&console.error("THREE.SSAARenderPass relies on CopyShader");n=CopyShader;this.copyUniforms=UniformsUtils.clone(n.uniforms),this.copyMaterial=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:AdditiveBlending,depthTest:!1,depthWrite:!1}),this.fsQuad=new Pass.FullScreenQuad(this.copyMaterial)};SSAARenderPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:SSAARenderPass,dispose:function(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null)},setSize:function(e,t){this.sampleRenderTarget&&this.sampleRenderTarget.setSize(e,t)},render:function(e,t,r){this.sampleRenderTarget||(this.sampleRenderTarget=new WebGLRenderTarget(r.width,r.height,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat}),this.sampleRenderTarget.texture.name="SSAARenderPass.sample");var n=SSAARenderPass.JitterVectors[Math.max(0,Math.min(this.sampleLevel,5))],i=e.autoClear;e.autoClear=!1,e.getClearColor(this._oldClearColor);var o=e.getClearAlpha(),a=1/n.length;this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture;for(var s=r.width,l=r.height,c=0;c<n.length;c++){var h=n[c];this.camera.setViewOffset&&this.camera.setViewOffset(s,l,.0625*h[0],.0625*h[1],s,l);h=a;this.unbiased&&(h+=1/32*((c+.5)/n.length-.5)),this.copyUniforms.opacity.value=h,e.setClearColor(this.clearColor,this.clearAlpha),e.setRenderTarget(this.sampleRenderTarget),e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(this.renderToScreen?null:t),0===c&&(e.setClearColor(0,0),e.clear()),this.fsQuad.render(e)}this.camera.clearViewOffset&&this.camera.clearViewOffset(),e.autoClear=i,e.setClearColor(this._oldClearColor,o)}}),SSAARenderPass.JitterVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];var TAARenderPass=function(e,t,r,n){void 0===SSAARenderPass&&console.error("THREE.TAARenderPass relies on SSAARenderPass"),SSAARenderPass.call(this,e,t,r,n),this.sampleLevel=0,this.accumulate=!1};TAARenderPass.JitterVectors=SSAARenderPass.JitterVectors,TAARenderPass.prototype=Object.assign(Object.create(SSAARenderPass.prototype),{constructor:TAARenderPass,render:function(e,t,r,n){if(!this.accumulate)return SSAARenderPass.prototype.render.call(this,e,t,r,n),void(this.accumulateIndex=-1);var i=TAARenderPass.JitterVectors[5];this.sampleRenderTarget||(this.sampleRenderTarget=new WebGLRenderTarget(r.width,r.height,this.params),this.sampleRenderTarget.texture.name="TAARenderPass.sample"),this.holdRenderTarget||(this.holdRenderTarget=new WebGLRenderTarget(r.width,r.height,this.params),this.holdRenderTarget.texture.name="TAARenderPass.hold"),this.accumulate&&-1===this.accumulateIndex&&(SSAARenderPass.prototype.render.call(this,e,this.holdRenderTarget,r,n),this.accumulateIndex=0);var o=e.autoClear;e.autoClear=!1;n=1/i.length;if(0<=this.accumulateIndex&&this.accumulateIndex<i.length){this.copyUniforms.opacity.value=n,this.copyUniforms.tDiffuse.value=t.texture;for(var a=Math.pow(2,this.sampleLevel),s=0;s<a;s++){var l=i[this.accumulateIndex];if(this.camera.setViewOffset&&this.camera.setViewOffset(r.width,r.height,.0625*l[0],.0625*l[1],r.width,r.height),e.setRenderTarget(t),e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(this.sampleRenderTarget),0===this.accumulateIndex&&e.clear(),this.fsQuad.render(e),this.accumulateIndex++,this.accumulateIndex>=i.length)break}this.camera.clearViewOffset&&this.camera.clearViewOffset()}n=this.accumulateIndex*n;0<n&&(this.copyUniforms.opacity.value=1,this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture,e.setRenderTarget(t),e.clear(),this.fsQuad.render(e)),n<1&&(this.copyUniforms.opacity.value=1-n,this.copyUniforms.tDiffuse.value=this.holdRenderTarget.texture,e.setRenderTarget(t),0==n&&e.clear(),this.fsQuad.render(e)),e.autoClear=o}});var GammaCorrectionShader={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 tex = texture2D( tDiffuse, vUv );","\tgl_FragColor = LinearTosRGB( tex );","}"].join("\n")},FXAAShader={uniforms:{tDiffuse:{value:null},resolution:{value:new Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immediates.","    // Immediates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")};class StateTracker extends InformationSource{constructor(e,t){super(e,t),this._stateRegister=void 0,this._cursor=void 0,this.maxStateCount=t.maxStateCount||5,this.addEvent("statechange"),this.resetState()}get cursor(){return this._cursor}get state(){return this._stateRegister[this._cursor]}resetState(){this._stateRegister=[],this._cursor=0}async addState({newState:t,moveCursor:e=!0}){if(this._stateRegister=this._stateRegister.slice(0,this._cursor+1),this._stateRegister.length>this.maxStateCount){console.log(this.label,"too many states",this._stateRegister.length);for(let e=0;e<this._stateRegister.length-this.maxStateCount;e+=1){let e=this._stateRegister.shift();console.log("remove",e.label||e),e.destroy&&e.destroy(),e.configuration&&void 0===this._stateRegister.find(e=>e.configuration===t.configuration)&&(e.configuration.destroy(),e.configuration=void 0,e=void 0)}}this._stateRegister.push(t),!0===e?await this.setCursor(this._stateRegister.length-1):"silent"===e&&(this._cursor=this._stateRegister.length-1)}async setCursor(e){if(!this._stateRegister[e])throw new Error(this.label+" unset cursor position "+e);this._cursor=e,await this.onStateCursorMoved(this._stateRegister[e])}overwritePreviousState(){this._stateRegister.length;var e=this._stateRegister.length-2;this._stateRegister.splice(e,1),this._cursor=e}onStateCursorMoved(e){throw new Error("Interface not implemented in extending class")}undo(e=1){return this.setCursor(Math.max(0,this._cursor-e))}get canUndo(){return 0<this._cursor}redo(e=1){return this.setCursor(Math.min(this._stateRegister.length-1,this._cursor+e))}get canRedo(){return this._cursor<this._stateRegister.length-1}}class Actor extends StateTracker{constructor(e,t){super(e,t),this.visible=void 0,this.body=new Group,this.addEvent("bodychange"),this.hiddenBody=new Group,this.body=new Group,this.body.name="Actor",(this.body.userData.origin=this).body.castShadow=!0,this.body.receiveShadow=!0,this.visible=!0}show(){console.log("show",this.label),this.body.traverse(function(e){e.layers.set(Project.layerMap.visibleActors)}),this.visible=!0}hide(){console.log("hide",this.label),this.body.traverse(function(e){e.layers.set(Project.layerMap.hiddenActors)}),this.visible=!1}clearBody(){for(;0<this.body.children.length;)this.body.remove(this.body.children[0])}async updateBody(e,t,r,n){this.clearBody(),this.body.add(e),t&&this.body.quaternion.copy(t),r&&(n&&n.translation?this.body.position.copy((new Vector3).addVectors(r,n.translation)):this.body.position.copy(r)),await this.emit("bodychange",this.body)}}class Tween extends EventEmitter{constructor(e,t,r,n=0){super(),this.canceled=void 0,this.stepCount=void 0,this.lastFraction=void 0,this.id=v4(),this.stepCount=0,this.startTime=(new Date).getTime(),this.easingFn=r,this.callback=t,this.lengthMs=e,this.steps=n,this.timeStep=e/n,this.canceled=!1,this.lastFraction=0,this.update()}update(){var e,t,r;!1===this.stopped&&(r=(new Date).getTime(),e=Math.max(0,Math.min(1,(r-this.startTime)/this.lengthMs)),t=this.easingFn(e),this.callback(t,t-this.lastFraction,e),this.stepCount+=1,this.lastFraction=t,1===e?(this.emit("complete"),this.stop()):0<this.steps&&(r=this.startTime+this.stepCount*this.timeStep-r,setTimeout(this.update.bind(this),r)))}stop(){this.stopped=!0,this.emit("stop")}}Tween.linear=e=>e,Tween.easeInQuad=e=>e,Tween.easeOutQuad=e=>e*(2-e),Tween.easeInOutQuad=e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,Tween.easeInCubic=e=>e*e*e,Tween.easeOutCubic=e=>-e*e*e+1,Tween.easeInOutCubic=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,Tween.easeInQuart=e=>e*e*e*e,Tween.easeOutQuart=e=>1- --e*e*e*e,Tween.easeInOutQuart=e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e,Tween.easeInQuint=e=>e*e*e*e*e,Tween.easeOutQuint=e=>1+--e*e*e*e*e,Tween.staticeaseInOutQuint=e=>e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e;var ACTION,extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function __extends(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function isPerspectiveCamera(e){return e.isPerspectiveCamera}function isOrthographicCamera(e){return e.isOrthographicCamera}!function(e){e[e.NONE=0]="NONE",e[e.ROTATE=1]="ROTATE",e[e.TRUCK=2]="TRUCK",e[e.OFFSET=3]="OFFSET",e[e.DOLLY=4]="DOLLY",e[e.ZOOM=5]="ZOOM",e[e.TOUCH_ROTATE=6]="TOUCH_ROTATE",e[e.TOUCH_TRUCK=7]="TOUCH_TRUCK",e[e.TOUCH_OFFSET=8]="TOUCH_OFFSET",e[e.TOUCH_DOLLY=9]="TOUCH_DOLLY",e[e.TOUCH_ZOOM=10]="TOUCH_ZOOM",e[e.TOUCH_DOLLY_TRUCK=11]="TOUCH_DOLLY_TRUCK",e[e.TOUCH_DOLLY_OFFSET=12]="TOUCH_DOLLY_OFFSET",e[e.TOUCH_ZOOM_TRUCK=13]="TOUCH_ZOOM_TRUCK",e[e.TOUCH_ZOOM_OFFSET=14]="TOUCH_ZOOM_OFFSET"}(ACTION=ACTION||{});var PI_2=2*Math.PI,PI_HALF=Math.PI/2,FPS_60=60,EPSILON=1e-5;function approxZero(e){return Math.abs(e)<EPSILON}function approxEquals(e,t){return approxZero(e-t)}function roundToStep(e,t){return Math.round(e/t)*t}function infinityToMaxNumber(e){return isFinite(e)?e:e<0?-Number.MAX_VALUE:Number.MAX_VALUE}function maxNumberToInfinity(e){return Math.abs(e)<Number.MAX_VALUE?e:e*(1/0)}function isTouchEvent(e){return"TouchEvent"in window&&e instanceof TouchEvent}function extractClientCoordFromEvent(e,t){if(t.set(0,0),isTouchEvent(e)){for(var r=e,n=0;n<r.touches.length;n++)t.x+=r.touches[n].clientX,t.y+=r.touches[n].clientY;return t.x/=r.touches.length,t.y/=r.touches.length,t}return t.set(e.clientX,e.clientY),t}function notSupportedInOrthographicCamera(e,t){return!!isOrthographicCamera(e)&&(console.warn(t+" is not supported in OrthographicCamera"),!0)}function quatInvertCompat(e){return e.invert?e.invert():e.inverse(),e}var THREE$1,_ORIGIN,_AXIS_Y,_AXIS_Z,_v2$4,_v3A,_v3B,_v3C,_xColumn,_yColumn,_zColumn,_sphericalA,_sphericalB,_box3A,_box3B,_sphere$4,_quaternionA,_quaternionB,_rotationMatrix,_raycaster,EventDispatcher$1=function(){function e(){this._listeners={}}return e.prototype.addEventListener=function(e,t){var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},e.prototype.removeEventListener=function(e,t){e=this._listeners[e];void 0===e||-1!==(t=e.indexOf(t))&&e.splice(t,1)},e.prototype.removeAllEventListeners=function(e){e?Array.isArray(this._listeners[e])&&(this._listeners[e].length=0):this._listeners={}},e.prototype.dispatchEvent=function(e){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var r=t.slice(0),n=0,i=r.length;n<i;n++)r[n].call(this,e)}},e}(),isBrowser="undefined"!=typeof window,isMac=isBrowser&&/Mac/.test(navigator.platform),readonlyACTION=Object.freeze(ACTION),TOUCH_DOLLY_FACTOR=1/8,CameraControls=function(m){function e(e,t){var s,l,c,r,n,i,o,a,h,u,A,d,p=m.call(this)||this;return p.minPolarAngle=0,p.maxPolarAngle=Math.PI,p.minAzimuthAngle=-1/0,p.maxAzimuthAngle=1/0,p.minDistance=0,p.maxDistance=1/0,p.infinityDolly=!1,p.minZoom=.01,p.maxZoom=1/0,p.dampingFactor=.05,p.draggingDampingFactor=.25,p.azimuthRotateSpeed=1,p.polarRotateSpeed=1,p.dollySpeed=1,p.truckSpeed=2,p.dollyToCursor=!1,p.dragToOffset=!1,p.verticalDragToForward=!1,p.boundaryFriction=0,p.colliderMeshes=[],p.cancel=function(){},p._enabled=!0,p._state=ACTION.NONE,p._viewport=null,p._dollyControlAmount=0,p._boundaryEnclosesCamera=!1,p._needsUpdate=!0,p._updatedLastTime=!1,p._truckInternal=function(e,t,r){var n,i;isPerspectiveCamera(p._camera)?(i=_v3A.copy(p._camera.position).sub(p._target),n=p._camera.getEffectiveFOV()*THREE$1.MathUtils.DEG2RAD,i=i.length()*Math.tan(.5*n),n=p.truckSpeed*e*i/p._elementRect.w,i=p.truckSpeed*t*i/p._elementRect.w,p.verticalDragToForward?(r?p.setFocalOffset(p._focalOffsetEnd.x+n,p._focalOffsetEnd.y,p._focalOffsetEnd.z,!0):p.truck(n,0,!0),p.forward(-i,!0)):r?p.setFocalOffset(p._focalOffsetEnd.x+n,p._focalOffsetEnd.y+i,p._focalOffsetEnd.z,!0):p.truck(n,i,!0)):isOrthographicCamera(p._camera)&&(n=e*((e=p._camera).right-e.left)/e.zoom/p._elementRect.z,i=t*(e.top-e.bottom)/e.zoom/p._elementRect.w,r?p.setFocalOffset(p._focalOffsetEnd.x+n,p._focalOffsetEnd.y+i,p._focalOffsetEnd.z,!0):p.truck(n,i,!0))},p._rotateInternal=function(e,t){e=PI_2*p.azimuthRotateSpeed*e/p._elementRect.w,t=PI_2*p.polarRotateSpeed*t/p._elementRect.w;p.rotate(e,t,!0)},p._dollyInternal=function(e,t,r){var n=Math.pow(.95,-e*p.dollySpeed),e=p._sphericalEnd.radius*n,n=p._sphericalEnd.radius;p.dollyTo(e),p.infinityDolly&&e<p.minDistance&&(p._camera.getWorldDirection(_v3A),p._targetEnd.add(_v3A.normalize().multiplyScalar(n)),p._target.add(_v3A.normalize().multiplyScalar(n))),p.dollyToCursor&&(p._dollyControlAmount+=p._sphericalEnd.radius-n,p.infinityDolly&&e<p.minDistance&&(p._dollyControlAmount-=n),p._dollyControlCoord.set(t,r))},p._zoomInternal=function(e,t,r){e=Math.pow(.95,e*p.dollySpeed);p.zoomTo(p._zoom*e),p.dollyToCursor&&(p._dollyControlAmount=p._zoomEnd,p._dollyControlCoord.set(t,r))},void 0===THREE$1&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),p._camera=e,p._yAxisUpSpace=(new THREE$1.Quaternion).setFromUnitVectors(p._camera.up,_AXIS_Y),p._yAxisUpSpaceInverse=quatInvertCompat(p._yAxisUpSpace.clone()),p._state=ACTION.NONE,p._domElement=t,p._target=new THREE$1.Vector3,p._targetEnd=p._target.clone(),p._focalOffset=new THREE$1.Vector3,p._focalOffsetEnd=p._focalOffset.clone(),p._spherical=(new THREE$1.Spherical).setFromVector3(_v3A.copy(p._camera.position).applyQuaternion(p._yAxisUpSpace)),p._sphericalEnd=p._spherical.clone(),p._zoom=p._camera.zoom,p._zoomEnd=p._zoom,p._nearPlaneCorners=[new THREE$1.Vector3,new THREE$1.Vector3,new THREE$1.Vector3,new THREE$1.Vector3],p._updateNearPlaneCorners(),p._boundary=new THREE$1.Box3(new THREE$1.Vector3(-1/0,-1/0,-1/0),new THREE$1.Vector3(1/0,1/0,1/0)),p._target0=p._target.clone(),p._position0=p._camera.position.clone(),p._zoom0=p._zoom,p._focalOffset0=p._focalOffset.clone(),p._dollyControlAmount=0,p._dollyControlCoord=new THREE$1.Vector2,p.mouseButtons={left:ACTION.ROTATE,middle:ACTION.DOLLY,right:ACTION.TRUCK,wheel:isPerspectiveCamera(p._camera)?ACTION.DOLLY:isOrthographicCamera(p._camera)?ACTION.ZOOM:ACTION.NONE},p.touches={one:ACTION.TOUCH_ROTATE,two:isPerspectiveCamera(p._camera)?ACTION.TOUCH_DOLLY_TRUCK:isOrthographicCamera(p._camera)?ACTION.TOUCH_ZOOM_TRUCK:ACTION.NONE,three:ACTION.TOUCH_TRUCK},p._elementRect=new THREE$1.Vector4,p._domElement&&(s=new THREE$1.Vector2,l=new THREE$1.Vector2,c=new THREE$1.Vector2,r=function(){p._state=ACTION.NONE,document.removeEventListener("mousemove",A),document.removeEventListener("touchmove",A,{passive:!1}),document.removeEventListener("mouseup",d),document.removeEventListener("touchend",d)},i=function(e){if(p._enabled){switch(r(),e.touches.length){case 1:p._state=p.touches.one;break;case 2:p._state=p.touches.two;break;case 3:p._state=p.touches.three}u(e)}},o=-1,a=function(e){if(p._enabled&&p.mouseButtons.wheel!==ACTION.NONE){e.preventDefault(),!p.dollyToCursor&&p.mouseButtons.wheel!==ACTION.ROTATE&&p.mouseButtons.wheel!==ACTION.TRUCK||(t=performance.now(),o-t<1e3&&p._getClientRect(p._elementRect),o=t);var t=isMac?-1:-3,r=1===e.deltaMode?e.deltaY/t:e.deltaY/(10*t),n=p.dollyToCursor?(e.clientX-p._elementRect.x)/p._elementRect.z*2-1:0,i=p.dollyToCursor?(e.clientY-p._elementRect.y)/p._elementRect.w*-2+1:0;switch(p.mouseButtons.wheel){case ACTION.ROTATE:p._rotateInternal(e.deltaX,e.deltaY);break;case ACTION.TRUCK:p._truckInternal(e.deltaX,e.deltaY,!1);break;case ACTION.OFFSET:p._truckInternal(e.deltaX,e.deltaY,!0);break;case ACTION.DOLLY:p._dollyInternal(-r,n,i);break;case ACTION.ZOOM:p._zoomInternal(-r,n,i)}p.dispatchEvent({type:"control",originalEvent:e})}},h=function(e){p._enabled&&e.preventDefault()},u=function(e){var t,r,n;p._enabled&&(extractClientCoordFromEvent(e,_v2$4),p._getClientRect(p._elementRect),s.copy(_v2$4),l.copy(_v2$4),isTouchEvent(e)&&2<=e.touches.length&&(t=_v2$4.x-(n=e).touches[1].clientX,r=_v2$4.y-n.touches[1].clientY,r=Math.sqrt(t*t+r*r),c.set(0,r),r=.5*(n.touches[0].clientX+n.touches[1].clientX),n=.5*(n.touches[0].clientY+n.touches[1].clientY),l.set(r,n)),document.addEventListener("mousemove",A),document.addEventListener("touchmove",A,{passive:!1}),document.addEventListener("mouseup",d),document.addEventListener("touchend",d),p.dispatchEvent({type:"controlstart",originalEvent:e}))},A=function(e){if(p._enabled){e.cancelable&&e.preventDefault(),extractClientCoordFromEvent(e,_v2$4);var t=l.x-_v2$4.x,r=l.y-_v2$4.y;switch(l.copy(_v2$4),p._state){case ACTION.ROTATE:case ACTION.TOUCH_ROTATE:p._rotateInternal(t,r);break;case ACTION.DOLLY:case ACTION.ZOOM:var n=p.dollyToCursor?(s.x-p._elementRect.x)/p._elementRect.z*2-1:0,i=p.dollyToCursor?(s.y-p._elementRect.y)/p._elementRect.w*-2+1:0;p._state===ACTION.DOLLY?p._dollyInternal(r*TOUCH_DOLLY_FACTOR,n,i):p._zoomInternal(r*TOUCH_DOLLY_FACTOR,n,i);break;case ACTION.TOUCH_DOLLY:case ACTION.TOUCH_ZOOM:case ACTION.TOUCH_DOLLY_TRUCK:case ACTION.TOUCH_ZOOM_TRUCK:case ACTION.TOUCH_DOLLY_OFFSET:case ACTION.TOUCH_ZOOM_OFFSET:var o=_v2$4.x-e.touches[1].clientX,a=_v2$4.y-e.touches[1].clientY,o=Math.sqrt(o*o+a*a),a=c.y-o;c.set(0,o);n=p.dollyToCursor?(l.x-p._elementRect.x)/p._elementRect.z*2-1:0,i=p.dollyToCursor?(l.y-p._elementRect.y)/p._elementRect.w*-2+1:0;p._state===ACTION.TOUCH_DOLLY||p._state===ACTION.TOUCH_DOLLY_TRUCK?p._dollyInternal(a*TOUCH_DOLLY_FACTOR,n,i):p._zoomInternal(a*TOUCH_DOLLY_FACTOR,n,i),p._state===ACTION.TOUCH_DOLLY_TRUCK||p._state===ACTION.TOUCH_ZOOM_TRUCK?p._truckInternal(t,r,!1):p._state!==ACTION.TOUCH_DOLLY_OFFSET&&p._state!==ACTION.TOUCH_ZOOM_OFFSET||p._truckInternal(t,r,!0);break;case ACTION.TRUCK:case ACTION.TOUCH_TRUCK:p._truckInternal(t,r,!1);break;case ACTION.OFFSET:case ACTION.TOUCH_OFFSET:p._truckInternal(t,r,!0)}p.dispatchEvent({type:"control",originalEvent:e})}},d=function(e){p._enabled&&(r(),p.dispatchEvent({type:"controlend",originalEvent:e}))},p._domElement.addEventListener("mousedown",n=function(e){if(p._enabled){switch(r(),e.button){case THREE$1.MOUSE.LEFT:p._state=p.mouseButtons.left;break;case THREE$1.MOUSE.MIDDLE:p._state=p.mouseButtons.middle;break;case THREE$1.MOUSE.RIGHT:p._state=p.mouseButtons.right}u(e)}}),p._domElement.addEventListener("touchstart",i,{passive:!0}),p._domElement.addEventListener("wheel",a,{passive:!1}),p._domElement.addEventListener("contextmenu",h),p._removeAllEventListeners=function(){p._domElement.removeEventListener("mousedown",n),p._domElement.removeEventListener("touchstart",i,{passive:!0}),p._domElement.removeEventListener("wheel",a,{passive:!1}),p._domElement.removeEventListener("contextmenu",h),document.removeEventListener("mousemove",A),document.removeEventListener("touchmove",A,{passive:!1}),document.removeEventListener("mouseup",d),document.removeEventListener("touchend",d)},p.cancel=function(){r(),p.dispatchEvent({type:"controlend",originalEvent:null})}),p.update(0),p}return __extends(e,m),e.install=function(e){THREE$1=e.THREE,_ORIGIN=Object.freeze(new THREE$1.Vector3(0,0,0)),_AXIS_Y=Object.freeze(new THREE$1.Vector3(0,1,0)),_AXIS_Z=Object.freeze(new THREE$1.Vector3(0,0,1)),_v2$4=new THREE$1.Vector2,_v3A=new THREE$1.Vector3,_v3B=new THREE$1.Vector3,_v3C=new THREE$1.Vector3,_xColumn=new THREE$1.Vector3,_yColumn=new THREE$1.Vector3,_zColumn=new THREE$1.Vector3,_sphericalA=new THREE$1.Spherical,_sphericalB=new THREE$1.Spherical,_box3A=new THREE$1.Box3,_box3B=new THREE$1.Box3,_sphere$4=new THREE$1.Sphere,_quaternionA=new THREE$1.Quaternion,_quaternionB=new THREE$1.Quaternion,_rotationMatrix=new THREE$1.Matrix4,_raycaster=new THREE$1.Raycaster},Object.defineProperty(e,"ACTION",{get:function(){return readonlyACTION},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){(this._enabled=e)||this.cancel()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentAction",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._spherical.radius},set:function(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"azimuthAngle",{get:function(){return this._spherical.theta},set:function(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"polarAngle",{get:function(){return this._spherical.phi},set:function(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundaryEnclosesCamera",{get:function(){return this._boundaryEnclosesCamera},set:function(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0},enumerable:!1,configurable:!0}),e.prototype.addEventListener=function(e,t){m.prototype.addEventListener.call(this,e,t)},e.prototype.removeEventListener=function(e,t){m.prototype.removeEventListener.call(this,e,t)},e.prototype.rotate=function(e,t,r){this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,r=void 0===r?!1:r)},e.prototype.rotateTo=function(e,t,r){void 0===r&&(r=!1);e=THREE$1.MathUtils.clamp(e,this.minAzimuthAngle,this.maxAzimuthAngle),t=THREE$1.MathUtils.clamp(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=e,this._sphericalEnd.phi=t,this._sphericalEnd.makeSafe(),r||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi),this._needsUpdate=!0},e.prototype.dolly=function(e,t){this.dollyTo(this._sphericalEnd.radius-e,t=void 0===t?!1:t)},e.prototype.dollyTo=function(e,t){void 0===t&&(t=!1),this._sphericalEnd.radius=THREE$1.MathUtils.clamp(e,this.minDistance,this.maxDistance),t||(this._spherical.radius=this._sphericalEnd.radius),this._needsUpdate=!0},e.prototype.zoom=function(e,t){this.zoomTo(this._zoomEnd+e,t=void 0===t?!1:t)},e.prototype.zoomTo=function(e,t){void 0===t&&(t=!1),this._zoomEnd=THREE$1.MathUtils.clamp(e,this.minZoom,this.maxZoom),t||(this._zoom=this._zoomEnd),this._needsUpdate=!0},e.prototype.pan=function(e,t,r){void 0===r&&(r=!1),console.log("`pan` has been renamed to `truck`"),this.truck(e,t,r)},e.prototype.truck=function(e,t,r){void 0===r&&(r=!1),this._camera.updateMatrix(),_xColumn.setFromMatrixColumn(this._camera.matrix,0),_yColumn.setFromMatrixColumn(this._camera.matrix,1),_xColumn.multiplyScalar(e),_yColumn.multiplyScalar(-t);t=_v3A.copy(_xColumn).add(_yColumn);this._encloseToBoundary(this._targetEnd,t,this.boundaryFriction),r||this._target.copy(this._targetEnd),this._needsUpdate=!0},e.prototype.forward=function(e,t){void 0===t&&(t=!1),_v3A.setFromMatrixColumn(this._camera.matrix,0),_v3A.crossVectors(this._camera.up,_v3A),_v3A.multiplyScalar(e),this._encloseToBoundary(this._targetEnd,_v3A,this.boundaryFriction),t||this._target.copy(this._targetEnd),this._needsUpdate=!0},e.prototype.moveTo=function(e,t,r,n){void 0===n&&(n=!1),this._targetEnd.set(e,t,r),n||this._target.copy(this._targetEnd),this._needsUpdate=!0},e.prototype.fitToBox=function(e,t,r){var n,i=void 0===r?{}:r,o=i.paddingLeft,a=void 0===o?0:o,s=i.paddingRight,l=void 0===s?0:s,c=i.paddingBottom,r=void 0===c?0:c,o=i.paddingTop,s=void 0===o?0:o,c=e.isBox3?_box3A.copy(e):_box3A.setFromObject(e);c.isEmpty()?console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"):(i=roundToStep(this._sphericalEnd.theta,PI_HALF),o=roundToStep(this._sphericalEnd.phi,PI_HALF),this.rotateTo(i,o,t),e=_v3A.setFromSpherical(this._sphericalEnd).normalize(),o=_quaternionA.setFromUnitVectors(e,_AXIS_Z),approxEquals(Math.abs(e.y),1)&&o.multiply(_quaternionB.setFromAxisAngle(_AXIS_Y,i)),i=_box3B.makeEmpty(),_v3B.copy(c.min).applyQuaternion(o),i.expandByPoint(_v3B),_v3B.copy(c.min).setX(c.max.x).applyQuaternion(o),i.expandByPoint(_v3B),_v3B.copy(c.min).setY(c.max.y).applyQuaternion(o),i.expandByPoint(_v3B),_v3B.copy(c.max).setZ(c.min.z).applyQuaternion(o),i.expandByPoint(_v3B),_v3B.copy(c.min).setZ(c.max.z).applyQuaternion(o),i.expandByPoint(_v3B),_v3B.copy(c.max).setY(c.min.y).applyQuaternion(o),i.expandByPoint(_v3B),_v3B.copy(c.max).setX(c.min.x).applyQuaternion(o),i.expandByPoint(_v3B),_v3B.copy(c.max).applyQuaternion(o),i.expandByPoint(_v3B),o.setFromUnitVectors(_AXIS_Z,e),i.min.x-=a,i.min.y-=r,i.max.x+=l,i.max.y+=s,s=i.getSize(_v3A),i=i.getCenter(_v3B).applyQuaternion(o),isPerspectiveCamera(this._camera)?(n=this.getDistanceToFitBox(s.x,s.y,s.z),this.moveTo(i.x,i.y,i.z,t),this.dollyTo(n,t),this.setFocalOffset(0,0,0,t)):isOrthographicCamera(this._camera)&&(n=(o=this._camera).right-o.left,o=o.top-o.bottom,s=Math.min(n/s.x,o/s.y),this.moveTo(i.x,i.y,i.z,t),this.zoomTo(s,t),this.setFocalOffset(0,0,0,t)))},e.prototype.fitTo=function(e,t,r){void 0===r&&(r={}),console.warn("camera-controls: fitTo() has been renamed to fitToBox()"),this.fitToBox(e,t,r)},e.prototype.fitToSphere=function(e,t){var r,n=e instanceof THREE$1.Sphere?_sphere$4.copy(e):createBoundingSphere(e,_sphere$4);this.moveTo(n.center.x,n.center.y,n.center.z,t),isPerspectiveCamera(this._camera)?(r=this.getDistanceToFitSphere(n.radius),this.dollyTo(r,t)):isOrthographicCamera(this._camera)&&(e=this._camera.right-this._camera.left,r=this._camera.top-this._camera.bottom,n=2*n.radius,n=Math.min(e/n,r/n),this.zoomTo(n,t)),this.setFocalOffset(0,0,0,t)},e.prototype.setLookAt=function(e,t,r,n,i,o,a){void 0===a&&(a=!1);r=_v3A.set(e,t,r),o=_v3B.set(n,i,o);this._targetEnd.copy(o),this._sphericalEnd.setFromVector3(r.sub(o).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},e.prototype.lerpLookAt=function(e,t,r,n,i,o,a,s,l,c,h,u,A,d){void 0===d&&(d=!1);r=_v3A.set(e,t,r),o=_v3B.set(n,i,o);_sphericalA.setFromVector3(r.sub(o).applyQuaternion(this._yAxisUpSpace));u=_v3A.set(c,h,u);this._targetEnd.copy(o).lerp(u,A);s=_v3B.set(a,s,l);_sphericalB.setFromVector3(s.sub(u).applyQuaternion(this._yAxisUpSpace));l=_sphericalB.theta-_sphericalA.theta,s=_sphericalB.phi-_sphericalA.phi,u=_sphericalB.radius-_sphericalA.radius;this._sphericalEnd.set(_sphericalA.radius+u*A,_sphericalA.phi+s*A,_sphericalA.theta+l*A),this.normalizeRotations(),d||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd)),this._needsUpdate=!0},e.prototype.setPosition=function(e,t,r,n){this.setLookAt(e,t,r,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,n=void 0===n?!1:n)},e.prototype.setTarget=function(e,t,r,n){void 0===n&&(n=!1);var i=this.getPosition(_v3A);this.setLookAt(i.x,i.y,i.z,e,t,r,n)},e.prototype.setFocalOffset=function(e,t,r,n){void 0===n&&(n=!1),this._focalOffsetEnd.set(e,t,r),n||this._focalOffset.copy(this._focalOffsetEnd),this._needsUpdate=!0},e.prototype.setBoundary=function(e){if(!e)return this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),void(this._needsUpdate=!0);this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0},e.prototype.setViewport=function(e,t,r,n){null!==e?(this._viewport=this._viewport||new THREE$1.Vector4,"number"==typeof e?this._viewport.set(e,t,r,n):this._viewport.copy(e)):this._viewport=null},e.prototype.getDistanceToFitBox=function(e,t,r){if(notSupportedInOrthographicCamera(this._camera,"getDistanceToFitBox"))return this._spherical.radius;var n=e/t,i=this._camera.getEffectiveFOV()*THREE$1.MathUtils.DEG2RAD,o=this._camera.aspect;return.5*(n<o?t:e/o)/Math.tan(.5*i)+.5*r},e.prototype.getDistanceToFit=function(e,t,r){return console.warn("camera-controls: getDistanceToFit() has been renamed to getDistanceToFitBox()"),this.getDistanceToFitBox(e,t,r)},e.prototype.getDistanceToFitSphere=function(e){if(notSupportedInOrthographicCamera(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;var t=this._camera.getEffectiveFOV()*THREE$1.MathUtils.DEG2RAD,r=2*Math.atan(Math.tan(.5*t)*this._camera.aspect),r=1<this._camera.aspect?t:r;return e/Math.sin(.5*r)},e.prototype.getTarget=function(e){return(e&&e.isVector3?e:new THREE$1.Vector3).copy(this._targetEnd)},e.prototype.getPosition=function(e){return(e&&e.isVector3?e:new THREE$1.Vector3).setFromSpherical(this._sphericalEnd).applyQuaternion(this._yAxisUpSpaceInverse).add(this._targetEnd)},e.prototype.getFocalOffset=function(e){return(e&&e.isVector3?e:new THREE$1.Vector3).copy(this._focalOffsetEnd)},e.prototype.normalizeRotations=function(){this._sphericalEnd.theta=this._sphericalEnd.theta%PI_2,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=PI_2),this._spherical.theta+=PI_2*Math.round((this._sphericalEnd.theta-this._spherical.theta)/PI_2)},e.prototype.reset=function(e){this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e=void 0===e?!1:e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)},e.prototype.saveState=function(){this._target0.copy(this._target),this._position0.copy(this._camera.position),this._zoom0=this._zoom},e.prototype.updateCameraUp=function(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,_AXIS_Y),quatInvertCompat(this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace))},e.prototype.update=function(e){var t,r,n,i,o=this._state===ACTION.NONE?this.dampingFactor:this.draggingDampingFactor,a=1-Math.exp(-o*e*FPS_60),s=this._sphericalEnd.theta-this._spherical.theta,l=this._sphericalEnd.phi-this._spherical.phi,c=this._sphericalEnd.radius-this._spherical.radius,o=_v3A.subVectors(this._targetEnd,this._target),e=_v3B.subVectors(this._focalOffsetEnd,this._focalOffset);approxZero(s)&&approxZero(l)&&approxZero(c)&&approxZero(o.x)&&approxZero(o.y)&&approxZero(o.z)&&approxZero(e.x)&&approxZero(e.y)&&approxZero(e.z)?(this._spherical.copy(this._sphericalEnd),this._target.copy(this._targetEnd),this._focalOffset.copy(this._focalOffsetEnd)):(this._spherical.set(this._spherical.radius+c*a,this._spherical.phi+l*a,this._spherical.theta+s*a),this._target.add(o.multiplyScalar(a)),this._focalOffset.add(e.multiplyScalar(a)),this._needsUpdate=!0),0!==this._dollyControlAmount&&(isPerspectiveCamera(this._camera)?(h=this._camera,n=_v3A.setFromSpherical(this._sphericalEnd).applyQuaternion(this._yAxisUpSpaceInverse).normalize().negate(),0===(i=_v3B.copy(n).cross(h.up).normalize()).lengthSq()&&(i.x=1),t=_v3C.crossVectors(i,n),r=this._sphericalEnd.radius*Math.tan(h.getEffectiveFOV()*THREE$1.MathUtils.DEG2RAD*.5),n=(this._sphericalEnd.radius-this._dollyControlAmount-this._sphericalEnd.radius)/this._sphericalEnd.radius,i=_v3A.copy(this._targetEnd).add(i.multiplyScalar(this._dollyControlCoord.x*r*h.aspect)).add(t.multiplyScalar(this._dollyControlCoord.y*r)),this._targetEnd.lerp(i,n),this._target.copy(this._targetEnd)):isOrthographicCamera(this._camera)&&(h=this._camera,t=_v3A.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(h.near+h.far)/(h.near-h.far)).unproject(h),n=approxZero(n=(r=_v3B.set(0,0,-1).applyQuaternion(h.quaternion)).dot(h.up))?-t.dot(h.up):-t.dot(h.up)/n,i=_v3C.copy(t).add(r.multiplyScalar(n)),this._targetEnd.lerp(i,1-h.zoom/this._dollyControlAmount),this._target.copy(this._targetEnd)),this._dollyControlAmount=0);var h=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,h),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),approxZero(this._focalOffset.x)&&approxZero(this._focalOffset.y)&&approxZero(this._focalOffset.z)||(this._camera.updateMatrix(),_xColumn.setFromMatrixColumn(this._camera.matrix,0),_yColumn.setFromMatrixColumn(this._camera.matrix,1),_zColumn.setFromMatrixColumn(this._camera.matrix,2),_xColumn.multiplyScalar(this._focalOffset.x),_yColumn.multiplyScalar(-this._focalOffset.y),_zColumn.multiplyScalar(this._focalOffset.z),_v3A.copy(_xColumn).add(_yColumn).add(_zColumn),this._camera.position.add(_v3A)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),_v3A.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);h=this._zoomEnd-this._zoom;this._zoom+=h*a,this._camera.zoom!==this._zoom&&(approxZero(h)&&(this._zoom=this._zoomEnd),this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0);h=this._needsUpdate;return h&&!this._updatedLastTime?(this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):h?this.dispatchEvent({type:"update"}):!h&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._updatedLastTime=h,this._needsUpdate=!1,h},e.prototype.toJSON=function(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:infinityToMaxNumber(this.maxDistance),minZoom:this.minZoom,maxZoom:infinityToMaxNumber(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:infinityToMaxNumber(this.maxPolarAngle),minAzimuthAngle:infinityToMaxNumber(this.minAzimuthAngle),maxAzimuthAngle:infinityToMaxNumber(this.maxAzimuthAngle),dampingFactor:this.dampingFactor,draggingDampingFactor:this.draggingDampingFactor,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:_v3A.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})},e.prototype.fromJSON=function(e,t){void 0===t&&(t=!1);var r=JSON.parse(e),e=_v3A.fromArray(r.position);this.enabled=r.enabled,this.minDistance=r.minDistance,this.maxDistance=maxNumberToInfinity(r.maxDistance),this.minZoom=r.minZoom,this.maxZoom=maxNumberToInfinity(r.maxZoom),this.minPolarAngle=r.minPolarAngle,this.maxPolarAngle=maxNumberToInfinity(r.maxPolarAngle),this.minAzimuthAngle=maxNumberToInfinity(r.minAzimuthAngle),this.maxAzimuthAngle=maxNumberToInfinity(r.maxAzimuthAngle),this.dampingFactor=r.dampingFactor,this.draggingDampingFactor=r.draggingDampingFactor,this.dollySpeed=r.dollySpeed,this.truckSpeed=r.truckSpeed,this.dollyToCursor=r.dollyToCursor,this.verticalDragToForward=r.verticalDragToForward,this._target0.fromArray(r.target0),this._position0.fromArray(r.position0),this._zoom0=r.zoom0,this._focalOffset0.fromArray(r.focalOffset0),this.moveTo(r.target[0],r.target[1],r.target[2],t),_sphericalA.setFromVector3(e.sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(_sphericalA.theta,_sphericalA.phi,t),this.zoomTo(r.zoom,t),this.setFocalOffset(r.focalOffset[0],r.focalOffset[1],r.focalOffset[2],t),this._needsUpdate=!0},e.prototype.dispose=function(){this._removeAllEventListeners()},e.prototype._encloseToBoundary=function(e,t,r){var n=t.lengthSq();if(0===n)return e;var i=_v3B.copy(t).add(e),o=this._boundary.clampPoint(i,_v3C).sub(i),i=o.lengthSq();if(0===i)return e.add(t);if(i===n)return e;if(0===r)return e.add(t).add(o);i=1+r*i/t.dot(o);return e.add(_v3B.copy(t).multiplyScalar(i)).add(o.multiplyScalar(1-r))},e.prototype._updateNearPlaneCorners=function(){var e,t,r,n,i;isPerspectiveCamera(this._camera)?(t=(e=this._camera).near,i=e.getEffectiveFOV()*THREE$1.MathUtils.DEG2RAD,r=(n=Math.tan(.5*i)*t)*e.aspect,this._nearPlaneCorners[0].set(-r,-n,0),this._nearPlaneCorners[1].set(r,-n,0),this._nearPlaneCorners[2].set(r,n,0),this._nearPlaneCorners[3].set(-r,n,0)):isOrthographicCamera(this._camera)&&(i=1/(e=this._camera).zoom,t=e.left*i,r=e.right*i,n=e.top*i,i=e.bottom*i,this._nearPlaneCorners[0].set(t,n,0),this._nearPlaneCorners[1].set(r,n,0),this._nearPlaneCorners[2].set(r,i,0),this._nearPlaneCorners[3].set(t,i,0))},e.prototype._collisionTest=function(){var e=1/0;if(!(1<=this.colliderMeshes.length))return e;if(notSupportedInOrthographicCamera(this._camera,"_collisionTest"))return e;var e=this._spherical.radius,t=_v3A.setFromSpherical(this._spherical).divideScalar(e);_rotationMatrix.lookAt(_ORIGIN,t,this._camera.up);for(var r=0;r<4;r++){var n=_v3B.copy(this._nearPlaneCorners[r]);n.applyMatrix4(_rotationMatrix);n=_v3C.addVectors(this._target,n);_raycaster.set(n,t),_raycaster.far=e;n=_raycaster.intersectObjects(this.colliderMeshes);0!==n.length&&n[0].distance<e&&(e=n[0].distance)}return e},e.prototype._getClientRect=function(e){var t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.z=this._viewport.z,e.w=this._viewport.w):(e.z=t.width,e.w=t.height),e},e.prototype._removeAllEventListeners=function(){},e}(EventDispatcher$1);function createBoundingSphere(e,t){var t=t,a=t.center;e.traverse(function(e){e.isMesh&&_box3A.expandByObject(e)}),_box3A.getCenter(a);var s=0;return e.traverse(function(e){if(e.isMesh){var t=e,e=t.geometry.clone();if(e.applyMatrix4(t.matrixWorld),e.isBufferGeometry)for(var r=0,n=(i=e.attributes.position).count;r<n;r++)_v3A.fromBufferAttribute(i,r),s=Math.max(s,a.distanceToSquared(_v3A));else for(var i=e.attributes.position,o=new THREE$1.Vector3,r=0,n=i.count;r<n;r++)o.fromBufferAttribute(i,r),s=Math.max(s,a.distanceToSquared(o))}}),t.radius=Math.sqrt(s),t}class Configurator extends Actor{constructor(e,t){super(e,t),this._loadingQuality="medium",checkPropTypes(t,{pkg:Package},{configuration:Configuration,position:Vector3,quaternion:Quaternion}),this.pkg=t.pkg;const r=new Group;r.name="Configurator Group";const n=t.configuration||new Configuration(this._reporter,{pkg:t.pkg,name:"Configurator autogenerated initial config",blockInstances:[]});n.build().then(()=>{this.updateBody(n.content.main.medium)}),this._stateRegister=[{configuration:n,position:t.position||new Vector3,quaternion:t.quaternion||new Quaternion}],this.body.position.copy(this.state.position),this.body.quaternion.copy(this.state.quaternion)}async onStateCursorMoved(e){return"ready"!==e.configuration.status.main[this._loadingQuality]&&await e.configuration.build({part:"main",quality:this._loadingQuality,highPriority:!0}),this.updateBody(e.configuration.content.main[this._loadingQuality],e.quaternion,e.position,e.modTransform)}get options(){const e={...this.configuration.options,...this.configuration.instructions};return this._cursor<this._stateRegister.length-1&&(e.redo=this.redo.bind(this)),0<this._cursor&&(e.undo=this.undo.bind(this)),e}get configuration(){return this._stateRegister[this._cursor]?.configuration}get position(){return this._stateRegister[this._cursor].position}get quaternion(){return this._stateRegister[this._cursor].quaternion}async insert(e){var t=this.configuration.insert(e);return await this.update(t,`Inserted ${e.block.label} in step `+this.configuration.step),{...this.state}}async extend(e){var t=this.configuration.extend(e);return await this.update(t,`Extended with ${e.block.label} in step `+this.configuration.step),{...this.state}}async cut(e){var t={position:this.state.position,quaternion:this.state.quaternion},r=this.configuration.cut(e);const n=this.calcPosCorrection(r.cut,this.configuration);return await this.update(r.main,`${this.configuration.label} after cutting out ${e.blockInstance.label} in step `+this.configuration.step),{main:this.state,cut:{configuration:r.cut,position:n.position.add(t.position),quaternion:n.quaternion.multiply(t.quaternion),description:`Cut out ${e.blockInstance.label} of ${this.configuration.label} step `+this.configuration.step}}}async split(e){const r={position:this.state.position,quaternion:this.state.quaternion},n=this.configuration.split(e),t=this.calcPosCorrection(n.cut,this.configuration);var i=n.split.map(e=>{const t=this.calcPosCorrection(e,this.configuration);return{configuration:n.cut,position:t.position.add(r.position),quaternion:t.quaternion.multiply(r.quaternion),description:`Sibling chain of splitting ${this.configuration.label} step `+this.configuration.step}});return{cut:{configuration:n.cut,position:t.position.add(r.position),quaternion:t.quaternion.multiply(r.quaternion),description:`Cut out ${e.blockInstance.label} when splitting ${this.configuration.label} step `+this.configuration.step},split:i}}async assignMaterial(e){this.state.position,this.state.quaternion;var t=this.configuration.assignMaterial(e);return await this.update(t,`${this.configuration.label} after assigning ${e.material.label} to ${e.blockInstance.label} in step `+this.configuration.step),t}async setTheme(e){var t=this.configuration.setTheme(e);return await this.update(t,`${this.configuration.label} after setting ${e.label} in step `+this.configuration.step),t}static get defaultPlacementObject(){return{position:new Vector3,quaternion:new Quaternion}}calcPosCorrection(e,t){const r=Configurator.defaultPlacementObject,n=[[new Quaternion,0]];for(var i of e.blockInstances)if(t.placement[i.id]){const c=(new Quaternion).copy(t.placement[i.id].quaternion).conjugate().multiply(e.placement[i.id].quaternion),h=n.find(e=>e[0].equals(c));h?h[1]+=1:n.push([c,1])}var o,a=n.sort((e,t)=>t[1]-e[1])[0][0];const s=[[new Vector3,0]];for(o of e.blockInstances)if(t.placement[o.id]){const u=(new Vector3).subVectors(t.placement[o.id].position.clone().applyQuaternion(a),e.placement[o.id].position.clone().applyQuaternion(a)),A=s.find(e=>e[0].equals(u));A?A[1]+=1:s.push([u,1])}var l=s.sort((e,t)=>t[1]-e[1])[0][0];return r.position=l,r.quaternion=a,r}async update(e,t,r={}){if(!(e instanceof Configuration))throw new Error("Configurator update parameter is not an instance of Configuration");if(e.pkg!==this.pkg)throw new Error("Configuration is of a different package");const n=this.calcPosCorrection(e,this.configuration);return await this.addState({newState:{configuration:e,position:n.position.add(this.position),quaternion:n.quaternion.multiply(this.quaternion),modTransform:r,description:t},moveCursor:!0}),this.options}merge(e,t,r){}async move(e,t){return await this.addState({newState:{configuration:this.configuration,position:e||this.position,quaternion:t||this.quaternion,description:"Moved configuration"},moveCursor:!0}),this.options}}CameraControls.install({THREE:THREE});class View extends InformationSource{constructor(e,t){super(e,t),this.cameraControlsAwake=!1,this.lastPointerDown={x:0,y:0,timestamp:0},this.lastPointerUp={x:0,y:0,timestamp:0},this.lastPointerMove={x:0,y:0},this.lastPerspectiveCameraPosition=new Vector3,this.lastPerspectiveCameraQuaternion=new Quaternion,this.scene=void 0,this.perspectiveCamera=void 0,this.rayCaster=new Raycaster,this.renderer=void 0,this.passes=void 0,this.renderPass=void 0,this.timer=void 0,this.domElement=void 0,this.domElementDimensions=void 0,this.tweens=void 0,this.camTween=void 0,this.selectionActive=!1,this.hideShadowOnDrag=!1,this.mouseoverMesh=void 0,this.mouseoverBlockInstance=void 0,this.mouseoverActor=void 0,this.intersect=function(e,t){e=Math.max(0,Math.min(1,(e-this.domElementDimensions.left)/this.domElementDimensions.width)),t=Math.max(0,Math.min(1,(t-this.domElementDimensions.top)/this.domElementDimensions.height)),t=new Vector2(2*e-1,2*-t+1);return this.rayCaster.setFromCamera(t,this.perspectiveCamera),this.rayCaster.intersectObjects(this.scene.children,!0)},this.dimensionsVisible=!1,checkPropTypes(t,{scene:Scene,renderer:WebGLRenderer,rendererOrtho:WebGLRenderer,timer:Timer},{rendererSettings:Object,cameraSettings:Object,passes:t=>{if(!Array.isArray(t))return"Not an array";for(let e=0;e<t.length;e+=1){var r=t[e];if(!(r instanceof Pass))return`Entry ${e} is not a Pass but a `+r.constructor.name}return!0}}),this.markers={},this.dimensionFrames={},this.domElementDimensions,this.camTween=null,this.tweens={},this.scene=t.scene,this.renderer=t.renderer,this.rendererOrtho=t.rendererOrtho,this.timer=t.timer,this.cameraSettings={...defaultCameraSettings,...t.cameraSettings||{}},this.perspectiveCamera=new PerspectiveCamera(this.cameraSettings.fov,this.cameraSettings.aspect,this.cameraSettings.near,this.cameraSettings.far),this.perspectiveCamera.layers.enable(Project.layerMap.visibleActors),this.perspectiveCamera.layers.disable(Project.layerMap.hiddenActors),this.orthographicCamera=new OrthographicCamera,this.domElement=document.createElement("div"),this.domElement.classList=["canvas-container"],this.domElement.appendChild(this.renderer.domElement),this.renderPass=new RenderPass(this.scene,this.perspectiveCamera),this.renderPass.name="Default Render Pass",this.renderPass.clearAlpha=1,this.passes=[this.renderPass,...t.passes||[]],this.scene.add(this.perspectiveCamera),this.scene.add(this.orthographicCamera),this.css2dRenderer=new CSS2DRenderer,this.css2dRenderer.domElement.style.position="absolute",this.css2dRenderer.domElement.style.top="0px",this.css2dRenderer.domElement.style.outline="none",this.css2dRenderer.id="css2dRenderer",this.on("dimensionsupdate",e=>{this.css2dRenderer.setSize(e.width,e.height)}),this.domElement.appendChild(this.css2dRenderer.domElement),this.clock=new Clock,this.cameraControls=new CameraControls(this.perspectiveCamera,this.domElement);var r=this.cameraSettings?.maxPolarAngle??180;this.cameraControls.maxPolarAngle=MathUtils.degToRad(r),this.cameraControls.normalizeRotations(),this.cameraControls.addEventListener("control",e=>{this.timer.addUpdateRequest(this.id,"Camera controls control")}),this.cameraControls.addEventListener("controlstart",e=>{this.timer.addUpdateRequest(this.id,"Camera controls start")}),this.cameraControls.addEventListener("wake",e=>{this.cameraControlsAwake=!0,this.timer.addUpdateRequest(this.id,"Camera controls wake")}),this.cameraControls.addEventListener("sleep",e=>{this.cameraControlsAwake=!1,this.timer.removeUpdateRequest(this.id)}),this.cameraControls.setLookAt(-2,1,6,0,.3,0,!1),this.shadow=new ContactShadow(e,{scene:this.scene,camera:this.perspectiveCamera,renderer:this.renderer}),this.shadow._build(),this.scene.add(this.shadow._shadowGroup),this.scene.castShadow=!0,this.scene.receiveShadow=!0,this.shadow._update(),this.findConfigurator=t.findConfigurator,this.addConfigurator=t.addConfigurator,this.findComponentById=t.findComponentById,this.addEvent("touchstart"),this.addEvent("touchmove"),this.addEvent("touchend"),this.addEvent("touchcancel"),this.addEvent("click"),this.addEvent("dblclick"),this.addEvent("fastclick"),this.addEvent("pointerdown"),this.addEvent("pointerup"),this.addEvent("pointermove"),this.addEvent("dragenter"),this.addEvent("dragover"),this.addEvent("dragleave"),this.addEvent("drop"),this.addEvent("dragend"),this.addEvent("componentDragEnter"),this.addEvent("componentDragLeave"),this.addEvent("blockinstancehover"),this.addEvent("componenthoverstart"),this.addEvent("componenthoverend"),this.addEvent("dimensionsupdate");const n=this.emitIntersectedBlocks.bind(this,["componenthoverstart","componenthoverend"]);this.emitIntersectedBlocks.bind(this,["componentdragenter","componentdragleave"]);this.on("listenerChange",({event:e,listenerObject:t})=>{switch(e){case"blockinstancehover":case"componenthoverstart":case"componenthoverend":0<Object.keys(t).length?this.domElement.addEventListener("pointermove",n):this.domElement.removeEventListener("pointermove",n)}}),this.domElement.addEventListener("touchstart",this.onTouchStart.bind(this)),this.domElement.addEventListener("touchmove",this.onTouchMove.bind(this)),this.domElement.addEventListener("touchend",this.onTouchEnd.bind(this)),this.domElement.addEventListener("touchcancel",this.onTouchCancel.bind(this)),this.domElement.addEventListener("click",this.onClick.bind(this)),this.domElement.addEventListener("dblclick",this.onDoubleClick.bind(this)),this.domElement.addEventListener("fastclick",e=>{console.log("fast click")}),document.addEventListener("pointerup",this.onPointerUp.bind(this)),document.addEventListener("pointerdown",this.onPointerDown.bind(this)),document.addEventListener("pointermove",this.onPointerMove.bind(this)),this.domElement.addEventListener("dragenter",this.onDragEnter.bind(this)),this.domElement.addEventListener("dragover",this.onDragOver.bind(this)),document.addEventListener("drop",this.onDrop.bind(this)),document.addEventListener("dragleave",this.onDragLeave.bind(this)),document.addEventListener("dragend",this.onDragEnd.bind(this)),document.addEventListener("componentdragenter",this.onComponentDragEnter.bind(this)),document.addEventListener("componentdragleave",this.onComponentDragLeave.bind(this)),window.addEventListener("resize",this.updateDOMElementDimensions.bind(this)),document.addEventListener("keyup",this.onKeyUp.bind(this)),this.rebuildComposer(),setTimeout(this.updateDOMElementDimensions.bind(this),1)}updateDOMElementDimensions(){const e=this.domElement.getBoundingClientRect();e.width=e.right-e.left,e.halfWidth=e.width/2,e.height=e.bottom-e.top,e.halfHeight=e.height/2,this.domElementDimensions=e,this.perspectiveCamera.aspect=e.width/e.height,this.perspectiveCamera.updateProjectionMatrix(),this.orthographicCamera.left=e.width/-2,this.orthographicCamera.right=e.width/2,this.orthographicCamera.top=e.height/2,this.orthographicCamera.bottom=e.height/-2,this.orthographicCamera.near=.1,this.orthographicCamera.far=1e3,this.orthographicCamera.position.set(0,0,10),this.renderer.setSize(e.width,e.height),this.rendererOrtho.setSize(e.width,e.height),this.shadow._update(),this.rebuildComposer(),this.timer.trigger(),this.emit("dimensionsupdate",this.domElementDimensions)}prependPass(e){this.passes=[e,...this.passes],this.rebuildComposer()}appendPass(e){this.passes=[...this.passes,e],this.rebuildComposer()}rebuildComposer(){this.composer=new EffectComposer(this.renderer);for(var e of this.passes)this.composer.addPass(e)}tween(e,t=250,r=Tween.easeInOutCubic){this.camTween instanceof Tween&&(this.camTween.stop(),this.camTween=null);const n=new Tween(t,e,r);this.camTween=n,n.on("stop",()=>{delete this.tweens[n.id]})}focusOn(e,t,r,n){}onSceneUpdate(e){Object.values(this.markers).forEach(e=>e.relinkObject3D());for(var t of Object.values(this.dimensionFrames))t.onSceneUpdate();this.update()}update(){this.lastPerspectiveCameraPosition.copy(this.perspectiveCamera.position),this.lastPerspectiveCameraQuaternion.copy(this.perspectiveCamera.quaternion);var e,t,r,n=this.clock.getDelta(),n=this.cameraControls.update(n);for(e of Object.values(this.tweens))e.update();this.render();for(t of Object.values(this.markers))t.update();for(r of Object.values(this.dimensionFrames))r.update();1e-4<this.lastPerspectiveCameraPosition.distanceTo(this.perspectiveCamera.position)||n?this.timer.hasRequestId(this.id)||this.timer.addUpdateRequest(this.id):this.timer.hasRequestId(this.id)&&this.timer.removeUpdateRequest(this.id)}render(){this.composer.render(this.scene,this.perspectiveCamera),this.css2dRenderer.render(this.scene,this.perspectiveCamera)}renderOrtho(){this.composer.render(this.scene,this.orthographicCamera),this.css2dRenderer.render(this.scene,this.orthographicCamera)}onTouchStart(e){console.log("touch start")}onTouchMove(e){}onTouchEnd(e){}onTouchCancel(e){}onClick(e){if(this.dragActive=!1,0<Object.keys(this._events.click).length){const t=this.findFirstIntersectedBlockInstance()||{};t.event=e,this.emit("click",t)}}onDoubleClick(e){if(console.log("double click"),0<Object.keys(this._events.click).length){const t=this.findFirstIntersectedBlockInstance()||{};t.event=e,this.emit("dblClick",t)}}onPointerDown(e){}onPointerMove(e){}onPointerUp(e){}async onDragEnter(e){}async onDragOver(e){}async onDrop(e){}onDragLeave(e){}onDragEnd(){}onComponentDragEnter(e){console.log("componentdragenter")}onComponentDragLeave(e){Object.keys(listenerObject).length}onKeyUp(e){}emitIntersectedBlocks([e,t]){var r,n=this.findFirstIntersectedBlockInstance();n?(r=n.blockInstance,this.mouseoverActor!==r.tree&&(this.mouseoverActor&&this.emit(t,{component:this.mouseoverActor}),this.mouseoverActor=r.tree,this.emit(e,{component:r.tree})),this.mouseoverBlockInstance!==r&&(this.mouseoverBlockInstance&&this.emit(t,{component:this.mouseoverBlockInstance}),this.mouseoverBlockInstance=r,this.emit(e,{component:r,...n})),this.emit("blockinstancehover",r)):(void 0!==this.mouseoverActor&&(this.emit(t,{component:this.mouseoverActor}),this.mouseoverActor=void 0),void 0!==this.mouseoverBlockInstance&&(this.emit(t,{component:this.mouseoverBlockInstance}),this.mouseoverBlockInstance=void 0),void 0!==this.mouseoverMesh&&(this.emit(t,{component:this.mouseoverMesh}),this.mouseoverMesh=void 0))}findFirstIntersectedBlockInstance(){var e=this.intersect(this.lastPointerMove.x,this.lastPointerMove.y);return View.findBlockInstanceParent(e)}findFirstIntersectedConfiguration(){var e=this.intersect(this.lastPointerMove.x,this.lastPointerMove.y);return View.findConfigurationParent(e)}static findBlockInstanceParent(e,t=0){for(var r of e)if(r.object.userData.PB){if("blockInstance"===r.object.parent.userData.PB.type)return{blockInstanceId:r.object.parent.userData.PB.origin,blockInstance:r.object.parent.userData.PB.blockInstance,intersection:r};if(r.object.parent.parent.userData.PB&&"blockInstance"===r.object.parent.parent.userData.PB.type)return{blockInstanceId:r.object.parent.parent.userData.PB.origin,blockInstance:r.object.parent.parent.userData.PB.blockInstance,intersection:r}}}findConfigurationParent(e,t=0){for(var r of e)r.object.userData.PB&&r.object.parent.userData.PB.type}async addMarker({position:e,HTMLElement:t,blockInstance:r}){r=new Marker({position:e,HTMLElement:t,blockInstance:r,view:this});return this.markers[r.id]=r,await new Promise(e=>{this.timer.once("update",e),this.timer.trigger()}),r}async adddimensionFrame(e){e=new DimensionFrame(e,this);return this.dimensionFrames[e.id]=e,await new Promise(e=>{this.timer.once("update",e),this.timer.trigger()}),e}removeMarker(e){console.assert(e instanceof Marker,"Argument is not an instance of Marker",e),e.clear(),delete this.markers[e.id]}removeAllMarkers(){Object.values(this.markers).forEach(this.removeMarker.bind(this))}expectDrag(e){}rotateTo(e){var t=.1667*Math.PI,r=.25*Math.PI,n=.4*Math.PI,i=.5*Math.PI,o=Math.PI;switch(e){case"front":this.cameraControls.rotateTo(0,i,!0);break;case"back":this.cameraControls.rotateTo(o,i,!0);break;case"top":this.cameraControls.rotateTo(0,0,!0);break;case"bottom":this.cameraControls.rotateTo(0,o,!0);break;case"right":this.cameraControls.rotateTo(i,i,!0);break;case"left":this.cameraControls.rotateTo(-i,i,!0);break;case"front-angle":this.cameraControls.rotateTo(0,r,!0);break;case"right-angle":this.cameraControls.rotateTo(t,n,!0);break;case"left-angle":this.cameraControls.rotateTo(-t,n,!0)}}zoomBlock(e){}zoomConfiguration(e){}getAllActors(){const t=[];return this.scene.traverse(function(e){"Actor"===e.name&&e.traverse(function(e){e.isMesh&&t.push(e)})}),t}zoomExtents(e=!0){this.update();const t=this.getAllActors(),r=new Box3;t.forEach(e=>r.expandByObject(e));var n=this.cameraControls.polarAngle;const i=MathUtils.radToDeg(this.cameraControls.azimuthAngle)%360;this.timer.trigger(),this.cameraControls.reset(e),this.cameraControls.fitToBox(r,e,{paddingTop:.3,paddingLeft:.3,paddingBottom:.3,paddingRight:.3}),this.cameraControls.rotateTo(MathUtils.degToRad(i<0&&-180<i?i:i<0&&i<-180?i+360:0<i&&i<180?i:0<i&&180<i?i-360:0),n,e)}zoomScene(){this.update();var e=this.getAllActors();const t=new Box3;for(var r=0;r<e.length;r++)t.expandByObject(e[r]);var n=(new Vector3).subVectors(t.max,t.min),n=new Mesh(new BoxGeometry(n.x,n.y,n.z),new MeshBasicMaterial({color:16763989}));this.timer.trigger(),this.cameraControls.fitToSphere(n,!0)}zoomTop(){this.update();var e=this.getAllActors();const t=new Box3;for(var r=0;r<e.length;r++)t.expandByObject(e[r]);this.timer.trigger(),this.cameraControls.reset(!0),this.rotateTo("top"),this.cameraControls.rotateTo(0,0,!0),this.cameraControls.fitToBox(t,!0,{paddingTop:.3,paddingLeft:.3,paddingBottom:.3,paddingRight:.3})}toggleBoundingBoxes(){this.perspectiveCamera.layers.toggle(2),this.update()}showBoundingBoxes(e){this.scene.traverse(function(e){e instanceof Box3Helper&&(e.visible=!1),"Vertex Helper"===e.name&&(e.visible=!1)});for(var t of e.content.main.medium.children)t instanceof Box3Helper&&(t.visible=!0);this.perspectiveCamera.layers.enable(2),this.update()}hideBoundingBoxes(){this.perspectiveCamera.layers.disable(2),this.update()}toggleDimensions(){let t;return this.perspectiveCamera.layers.toggle(3),this.scene.traverse(function(e){e instanceof CSS2DObject&&"dimLabel"===e.name&&(t=!1===e.visible?e.visible=!0:e.visible=!1)}),this.update(),t}showDimensions(){this.perspectiveCamera.layers.enable(3),this.scene.traverse(function(e){e instanceof CSS2DObject&&"dimLabel"===e.name&&!1===e.visible&&(e.visible=!0)}),this.dimensionsVisible=!0,this.update()}hideDimensions(){this.perspectiveCamera.layers.disable(3),this.scene.traverse(function(e){e instanceof CSS2DObject&&"dimLabel"===e.name&&!0===e.visible&&(e.visible=!1)}),this.dimensionsVisible=!1,this.update()}project(e,t){t=void 0!==t?t:this.perspectiveCamera,console.assert(e instanceof Vector3,"Position should be a THREE.Vector3"),console.assert(t instanceof Camera,"Camera should be a THREE.Camera instance");e=e.project(this.perspectiveCamera);return{x:(e.x+1)/2*this.domElementDimensions.width,y:-(e.y-1)/2*this.domElementDimensions.height}}}class Marker extends EventEmitter{constructor(e){super(),this.id=void 0,this.HTMLElement=void 0,this._position=void 0,this._distance=void 0,this._occlusion=void 0,checkPropTypes(e,{position:Vector3,HTMLElement:HTMLElement,view:View},{blockInstance:BlockInstance}),this.addEvent("occlusionchange"),this.id=v4(),e.blockInstance&&(this._blockInstance=e.blockInstance),this._position=e.position,this.view=e.view,this.HTMLElement=e.HTMLElement,this.CSS2DObject=new CSS2DObject(this.HTMLElement),this.CSS2DObject.position.copy(this._position),this.CSS2DObject.name="marker",this.CSS2DObject.visible=!0,this.relinkObject3D()}get position(){return this._position}get distance(){return this._distance}get occlusion(){return this._occlusion}relinkObject3D(){if(this._blockInstance){var e=this.view.scene.getObjectByName(this._blockInstance.id);if(!e)return console.warn("Could not find scene object for "+this._blockInstance.label),this.clear();this.sceneParent=e}else this.sceneParent=this.view.scene;this.sceneParent.add(this.CSS2DObject)}update(){var e=this.view.perspectiveCamera.position.clone().sub(this._position).normalize();this.view.rayCaster.set(this._position,e),this._distance=this._position.distanceTo(this.view.perspectiveCamera.position);e=0<this.view.rayCaster.intersectObjects(this.view.scene.children,!0).length;e!==this._occlusion&&(this._occlusion=e,this.emit("occlusionchange",this.occlusion))}clear(){this.sceneParent.remove(this.CSS2DObject)}}function drawDimensionsLine(e,t,r,n){var i=Project.layerMap.dimLines;switch(n){case"left":var o=new Vector3(-r,-.01,0);break;case"back":o=new Vector3(0,-.01,-r);break;case"right":o=new Vector3(r,-.01,0);break;case"front":o=new Vector3(0,-.01,r);break;case"height":o=new Vector3(-r,-.01,-r)}for(var a=[],s=0;s<t.length;s++)a.push(t[s].start),a.push(t[s].end);var l=new Group;l.name="dimLine";var c=(new BufferGeometry).setFromPoints(a),h=document.createElement("canvas");h.width=128,h.height=128;n=h.getContext("2d");n.arc(64,64,64,0,2*Math.PI),n.fillStyle="#000000",n.fill();h=new CanvasTexture(h),h=new Points(c,new PointsMaterial({size:.03,map:h,transparent:!1,alphaTest:.5})),c=new Line(c,new LineBasicMaterial({color:0,linewidth:1}));c.layers.set(i),h.layers.set(i),l.add(c),l.add(h);for(var u=new Vector3,s=0;s<t.length;s++){var A=new Line3(t[s].start,t[s].end),d=document.createElement("div");d.className="label",d.textContent=Math.round(100*A.distance())+" cm",d.style.marginTop="-1em";d=new CSS2DObject(d);d.name="dimLabel",d.visible=!1,d.position.copy(A.getCenter(u)),d.layers.set(i),l.add(d),e.add(l)}l.position.add(o)}class Configuration extends ComponentTree$1{constructor(r,n){n.step=n.step||1,n.blockInstances=n.blockInstances||[],n.connections=n.connections||[],n.materialAssignments=n.materialAssignments||[],n.themes=n.themes||{},checkPropTypes(n,{pkg:Package},{blockInstances:t=>{if(!Array.isArray(t))return"Not an array";for(let e=0;e<t.length;e+=1){var r=t[e];if(!(r instanceof BlockInstance))return`Entry blockInstances[${e}] is not a BlockInstance, but a `+r.constructor.name}return t.filter(unique).length===t.length||"Duplicate blockInstances specified"},connections:t=>{if(!Array.isArray(t))return"Not an array";for(let e=0;e<t.length;e+=1){var r=t[e];if(!(r instanceof Connection))return`Entry connections[${e}] is not a Connection, but a `+r.constructor.name}return t.filter(unique).length===t.length||"Duplicate connections specified"},materialAssignments:t=>{if(!Array.isArray(t))return"Value is not an array";for(let e=0;e<t.length;e+=1){var r=t[e];if(!(r instanceof MaterialAssignment))return`Entry materialAssignments[${e}] is not a MaterialAssignment, but a `+r.constructor.name}return t.filter(unique).length===t.length||"Duplicate materialAssignments specified"}});const i=(n.blockInstances||[]).reduce((e,t)=>[...e,...(t.block.connectors||[]).map(e=>({connectable:t,connector:e}))],[]);for(let e=0,t=n.pkg.themeGroups.length||0;e<t;e+=1){const x=n.pkg.themeGroups[e],b=n.themes[x.id]||n.pkg.themes.find(e=>e.group===x),T=i.filter(e=>e.connector.themeGroup===x),E=T.map(e=>e.connector),B=[],C=[...T];for(let t of Object.values(n.connections)){var o=T.find(e=>e.connector===t.from.connector&&e.connectable===t.from.connectable),a=T.find(e=>e.connector===t.to.connector&&e.connectable===t.to.connectable);if(o){if(E.includes(t.to.connector))throw new Error(`Both sides of ${t.label} have a connector with ${x.label}: ${t.to.connector.label}, `+t.from.connector.label);t.to.connector.block.theme===b?C.splice(C.indexOf(o),1):(n.connections.splice(n.connections.indexOf(t),1),B.push(t.to.connectable.id),n.blockInstances.splice(n.blockInstances.indexOf(t.to.connectable),1))}else if(a){if(E.includes(t.from.connector))throw new Error(`Both sides of ${t.label} have a connector with ${x.label}: ${t.to.connector.label}, `+t.from.connector.label);t.from.connector.block.theme===b?C.splice(C.indexOf(a),1):(n.connections.splice(n.connections.indexOf(t),1),B.push(t.from.connectable.id),n.blockInstances.splice(n.blockInstances.indexOf(t.from.connectable),1))}}n.materialAssignments=n.materialAssignments.filter(e=>!B.includes(e.blockInstance.id));for(const S of C){if(B.includes(S.connectable.id))throw new Error(`Can't create a new connection for ${S.connectable.label} - it was removed`);var s=n.pkg.connectors.find(e=>e.block.theme===b&&S.connector.mate.connectors.includes(e)),l=new BlockInstance(r,{block:s.block});n.blockInstances.push(l);l=new Connection(r,{from:S,to:{connector:s,connectable:l}});n.connections.push(l)}}super(r,omit(["pkg"],n),{import:Configuration.importInstructions,externalTrees:[n.pkg]}),this.allMeshes=void 0,this.applicableMatVarGroups=void 0,this.applicableMaterials=void 0,this.connectors=void 0,this.extendOptions=void 0,this.insertOptions=void 0,this.options=void 0,this.instructions=void 0,this.assignedMaterials=void 0,this.preparedComponentClones=void 0,this.options={blocks:[],blockInstances:[],materials:[]},this.instructions={},this.clonedAssets=[],this.clonedComponents=[],Object.getOwnPropertyDescriptor(this,"blockInstances")||(this.blockInstances=[]),Object.getOwnPropertyDescriptor(this,"materialAssignments")||(this.materialAssignments=[]),Object.getOwnPropertyDescriptor(this,"connections")||(this.connections=[]),this.pkg=n.pkg,this.pkg.loader&&(this.loader=this.pkg.loader),this.connectors=i,this.connectedConnectors=findConnectedConnectors(n.connections),Array.isArray(n.blockInstances)&&0<n.blockInstances.length?this.placement=calculatePlacement(this):(this.placement={},console.warn("Empty configuration detected, no block instances defined.")),this.assignables=this.blockInstances.map(e=>e.assignables).flat(),this.assignedMaterials={},this.options={extend:[],insert:[],replace:[],cut:[],split:[],blocks:[],blockInstances:[],materials:[],materialVariantGroups:[]},this.options.extend=findExtendOptions(this),this.options.insert=findInsertOptions(this),this.options.extend.forEach(e=>this._addBlockAddOption(e,"extend")),this.options.insert.forEach(e=>this._addBlockAddOption(e,"insert"));var e,{cutOptions:t,splitOptions:c}=findBlockInstanceOptions(this);this.options.cut=t,this.options.split=c,this.options.cut.forEach(e=>this._addBlockInstanceRemoveOption(e,"cut")),this.options.split.forEach(e=>this._addBlockInstanceRemoveOption(e,"split"));for(e of this.blockInstances)for(var h of e.block.distinctMVGs)this.options.materialVariantGroups.includes(h)||(this.options.materialVariantGroups.push(h),this.options[h.id]=[]),this.options[h.id].push(e);var u,t=this.options.materialVariantGroups.map(e=>e.id).sort().join("-");Configuration.materialCache[t]||(c=this.options.materialVariantGroups.map(e=>e.allMaterials).flat().filter(unique),Configuration.materialCache[t]=c),this.options.materials=Configuration.materialCache[t],this.options.material=r=>{console.assert(r instanceof WrappedMaterial,`${r.label||typeof r} is not an instance of WrappedMaterial`);const e=this.assignables.filter(e=>e.materialVariantGroups.find(e=>r.materialSets.includes(e)));return e.map(e=>{getAssigningComponent(e);const t={position:(new Vector3).copy(this.placement[e.blockInstance.id].position),quaternion:(new Quaternion).copy(this.placement[e.blockInstance.id].quaternion)};return e.positionedMeshGroup&&(t.position.add(e.positionedMeshGroup.position),t.quaternion.multiply(e.positionedMeshGroup.quaternion)),e.positionedMesh&&(t.position.add(e.positionedMesh.position),t.quaternion.multiply(e.positionedMesh.quaternion)),{assignable:e,material:r,placement:t}})},this.boundingBoxes=new Map;const A=[];for(u of n.blockInstances||[]){const M=u.boundingBox.clone();this.clonedAssets.push(M);const N=new Matrix4;var d=this.placement[u.id].position,p=this.placement[u.id].quaternion,m=new Vector3(1,1,1);N.compose(d,p,m),M.applyMatrix4(N),u.boundingBox=M,this.boundingBoxes.set(u.id,M),u.boundingBox.computeBoundingBox(),u.boundingBox.computeBoundingSphere();var f=M.attributes.position;const L=new Vector3;for(let e=0,t=f.count;e<t;e++){L.fromBufferAttribute(f,e);var g=L.clone();this.clonedAssets.push(g),A.push(g)}}var v,_=new Vector3,y=new Vector3;for(v of A)_.min(v),y.max(v);t=new Box3(_,y),t=new Float32Array([t.min.x,t.min.y,t.min.z,t.min.x,t.min.y,t.max.z,t.max.x,t.min.y,t.max.z,t.max.x,t.min.y,t.min.z,t.min.x,t.max.y,t.min.z,t.min.x,t.max.y,t.max.z,t.max.x,t.max.y,t.max.z,t.max.x,t.max.y,t.min.z]);const w=new BufferGeometry;w.name="boundingBox",w.visible=!1,w.setAttribute("position",new BufferAttribute(t,3)),w.computeBoundingBox(),w.computeBoundingSphere(),this.boundingBox=w,this.dimensions=getDimensions(this)}_addBlockAddOption(e,t){var r=e.block;-1===this.options.blocks.indexOf(r)&&this.options.blocks.push(r),this.options[r.id]||(this.options[r.id]={extend:[],insert:[]}),this.options[r.id][t].push(e)}_addBlockInstanceRemoveOption(e,t){var r=e.blockInstance;-1===this.options.blockInstances.indexOf(r)&&this.options.blockInstances.push(r),this.options[r.id]||(this.options[r.id]={cut:[],split:[],replace:[],materialize:[]}),this.options[r.id][t].push(e)}prepareComponentClones(){this.preparedComponentClones=null,this.cloneComponents()}cloneComponents(e=!0){if(this.preparedComponentClones){console.log("use prepared component clones");var t=this.preparedComponentClones;return this.preparedComponentClones=null,t}let r={},n={},i={};for(var o of this.blockInstances){var a=o.clone(!0===e?{id:o.id}:{});r[o.id]=a}for(var s of this.materialAssignments){var l=new MaterialAssignment(this._reporter,{...s.settings,blockInstance:r[s.blockInstance.id]});n[s.id]=l}for(var c of this.connections){var h=new Connection(this._reporter,{from:{connectable:r[c.from.connectable.id],connector:c.from.connector},to:{connectable:r[c.to.connectable.id],connector:c.to.connector},quaternion:c.quaternion});i[c.id]=h}return{blockInstanceClones:r,materialAssignmentClones:n,connectionClones:i}}_createClonedComponentConnection(e,t,r){return new Connection(this._reporter,{from:{connectable:"new"===e.from.connectable?r:t[e.from.connectable.id],connector:e.from.connector},to:{connectable:"new"===e.to.connectable?r:t[e.to.connectable.id],connector:e.to.connector}})}_createNewConfiguration(e,t,r,n={}){const i={};return Object.assign(i,this.settings),i.id=v4(),Object.assign(i,n),i.blockInstances=e,i.materialAssignments=t,i.connections=r,i.pkg=this.pkg,i.step=(Number(i.step)||0)+1,new Configuration(this._reporter,i)}_createLastAssignedMAsForBlockInstance(e){const t={};if(this.lastAssignedMaterials){var r,n=pick(e.applicableMaterialVariantGroups.map(e=>e.id),this.lastAssignedMaterials);for(r of Object.values(n)){var i=new MaterialAssignment(this._reporter,{blockInstance:e,material:r});t[i.id]=i}}return t}add(){}extend(e,t={}){console.log("extend option",e);let{blockInstanceClones:r,materialAssignmentClones:n,connectionClones:i}=this.cloneComponents();var o=new BlockInstance(this._reporter,{block:e.block});return r[o.id]=o,e.connection&&(e=this._createClonedComponentConnection(e.connection,r,o),i[e.id]=e),!0===t.repeatLastAssignment&&Object.assign(n,this._createLastAssignedMAsForBlockInstance(o)),this._createNewConfiguration(Object.values(r),Object.values(n),Object.values(i))}insert(e,t={}){let{blockInstanceClones:r,materialAssignmentClones:n,connectionClones:i}=this.cloneComponents();var o=new BlockInstance(this._reporter,{block:e.block});r[o.id]=o;var a=this._createClonedComponentConnection(e.newConnection1,r,o);i[a.id]=a;a=this._createClonedComponentConnection(e.newConnection2,r,o);return i[a.id]=a,delete i[e.oldConnection.id],!0===t.repeatLastAssignment&&Object.assign(n,this._createLastAssignedMAsForBlockInstance(o)),this._createNewConfiguration(Object.values(r),Object.values(n),Object.values(i))}replace(){}copy(e=!0){var{blockInstanceClones:t,materialAssignmentClones:r,connectionClones:e}=this.cloneComponents(e);return this._createNewConfiguration(Object.values(t),Object.values(r),Object.values(e))}_cut(e){let{blockInstanceClones:t,materialAssignmentClones:r,connectionClones:n}=this.cloneComponents();const i={blockInstances:[],materialAssignments:[],connections:[]};i.blockInstances.push(t[e.blockInstance.id]),delete t[e.blockInstance.id];for(var o of e.blockInstance.children)i.blockInstances.push(t[o.id]),delete t[o.id];for(var a of[...e.blockInstance.materialAssignments,...e.blockInstance.childMaterialAssignments||[]])i.materialAssignments.push(r[a.id]),delete r[a.id];for(var s of e.blockInstance.childConnections)i.connections.push(n[s.id]),delete n[s.id];for(var l of e.oldConnections)delete n[l.id];return{cutConfigurationComponents:i,blockInstanceClones:t,materialAssignmentClones:r,connectionClones:n}}cut(e){const{cutConfigurationComponents:t,blockInstanceClones:r,materialAssignmentClones:n,connectionClones:i}=this._cut(e);return e.newConnection&&(e=this._createClonedComponentConnection(e.newConnection,r),i[e.id]=e),{main:this._createNewConfiguration(Object.values(r),Object.values(n),Object.values(i)),cut:this._createNewConfiguration(t.blockInstances,t.materialAssignments,t.connections)}}split(n){const{cutConfigurationComponents:e,blockInstanceClones:t,materialAssignmentClones:r,connectionClones:i}=this._cut(n),o=[];for(var a of Object.values(n.siblingChains)){const s=a.reduce((e,t)=>{var r;e.blockInstances.push(t,...t.children||[]),t.materialAssignments&&0<t.materialAssignments.length&&e.materialAssignments.push(...t.materialAssignments),t.childMaterialAssignments&&0<t.childMaterialAssignments.length&&e.materialAssignments.push(...t.childMaterialAssignments),t.childConnections&&0<t.childConnections.length&&e.connections.push(...t.childConnections);for(r of t.equalConnections.filter(e=>!n.oldConnections.includes(e)))-1===e.connections.indexOf(r)&&e.connections.push(r);return t.childConnections&&0<t.childConnections.length&&e.connections.push(...t.childConnections),e},{blockInstances:[],materialAssignments:[],connections:[]});s.blockInstances=s.blockInstances.map(e=>t[e.id]),s.materialAssignments=s.materialAssignments.map(e=>r[e.id]),s.connections=s.connections.map(e=>i[e.id]),o.push(this._createNewConfiguration(s.blockInstances,s.materialAssignments,s.connections,this.step+1))}return{cut:this._createNewConfiguration(e.blockInstances,e.materialAssignments,e.connections),split:o}}merge(e,t,r,n){const i=r.tree;if(i.pkg!==this.pkg)throw new Error(`Can not merge configuration for ${this.pkg.label} with configurator for ${i.pkg.label} `);var o=this.cloneComponents(),a=i.cloneComponents(),n=this._createClonedComponentConnection({from:{connectable:e,connector:t},to:{connectable:r,connector:n}},{...o.blockInstanceClones,...a.blockInstanceClones}),n={blockInstances:[...Object.values(o.blockInstanceClones||{}),...Object.values(a.blockInstanceClones||{})],materialAssignments:[...Object.values(o.materialAssignments||{}),...Object.values(a.materialAssignments||{})],connections:[...Object.values(o.connectionClones||{}),...Object.values(a.connectionClones||{}),n]};return this._createNewConfiguration(n.blockInstances,n.materialAssignments,n.connections)}findMergeOptions(e){}assignMaterial(e){let{blockInstanceClones:t,materialAssignmentClones:r,connectionClones:n}=this.cloneComponents();const i={};i.blockInstance=t[e.assignable.blockInstance.id],e.assignable.positionedMeshGroup&&(i.positionedMeshGroup=e.assignable.positionedMeshGroup),e.assignable.positionedMesh&&(i.positionedMesh=e.assignable.positionedMesh),i.material=e.material;const o=new MaterialAssignment(this._reporter,i);var a,s=e.assignable.assigningComponent;for(let[e,t]of Object.entries(r))t.assigningComponent.id===s.id&&(o.affectedComponents.length!==t.affectedComponents.length||o.affectedComponents.find(e=>void 0===t.affectedComponents.includes(e))||delete r[e]);r[o.id]=o;const l=this.lastAssignedMaterials||{};for(a of i.material.materialSets)l[a.id]=i.material;return this._createNewConfiguration(Object.values(t),Object.values(r),Object.values(n),{lastAssignedMaterials:l})}setDefaultMaterial(e){var t,{blockInstanceClones:r,materialAssignmentClones:n,connectionClones:i}=this.cloneComponents();const o=this.defaultMaterials||{};for(t of e.materialSets)o[t.id]=e;return this._createNewConfiguration(Object.values(r),Object.values(n),Object.values(i),{defaultMaterials:o})}clearMaterialAssignments(){var{blockInstanceClones:e,connectionClones:t}=this.cloneComponents();return this._createNewConfiguration(Object.values(e),[],Object.values(t))}applyTheme(e){if(!(e instanceof Theme))throw new Error(e+" is not a Theme");var{blockInstanceClones:t,materialAssignmentClones:r,connectionClones:n}=this.cloneComponents(),i=this._settings.themes||{};const o={};return Object.assign(o,i),o[e.group.id]=e,this._createNewConfiguration(Object.values(t),Object.values(r),Object.values(n),{themes:o})}destroy(){for(var e of this.pkg.configurations)if(this.id===e.id)return;for(var t of this.blockInstances)t.destroy();for(var r of this.materialAssignments)r.destroy();for(var n of this.connections)n.destroy();for(var i of this.clonedAssets)i.dispose&&i.dispose();super.destroy&&super.destroy()}async _build(e,t,r){switch(e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":const g=new Group;g.castShadow=!0,g.receiveShadow=!0;var n=Project.layerMap.boundingBoxes;g.name="Build of "+this.label;var i=Object.values(this.defaultMaterials||{}).filter(unique);for(let o of this.blockInstances){console.assert(o.bestMainContent instanceof Object3D);const v=o.bestMainContent;v.position.copy(this.placement[o.id].position),v.quaternion.copy(this.placement[o.id].quaternion);const _=(this.materialAssignments||[]).filter(e=>e.blockInstance===o);var a,s=_.sort((e,t)=>e.affectedComponents.length-t.affectedComponents.length);const y=[];for(let t of i)y.push({material:t,affectedComponents:o.materializableDependencies.filter(e=>e instanceof PositionedComponent&&e.component.materialVariantGroup.has(t))});const w=[];for(a of[...s,...y])for(var l of a.affectedComponents)if(!w.includes(l.id)){w.push(l.id);const b=v.getObjectByName(l.id);var c=this._tree.findComponentById(b.userData.PB.origin);const T=c.dependencies.main.component;if(!c)throw console.warn("Tree referenced in upcoming error",this._tree),new Error(`Could not find positioned mesh with id ${b.userData.PB.origin} in tree`);var h,u=null;for(h of c._allDependencies)h instanceof WrappedMesh&&(u=h._tilingMultiplier);var A,l=b.material.aoMap,c=b.material.aoMapIntensity,d=null;a.material.content.main[t].normalMap instanceof Texture&&(d=a.material.content.main[t].normalMap.repeat),T._normalMap?(console.log("node material"),b.material=await T.buildMeshMaterial(a.material.content.main[t].clone()),b.material.needsUpdate=!0):b.material=a.material.content.main[t].clone(),b.material.aoMap=l,b.material.aoMapIntensity=c,b.material.aoMap instanceof Texture&&(b.material.aoMap.needsUpdate=!0);for(A of["bumpMap","emissiveMap","map","specularMap","roughnessMap","metalnessMap","normalMap"]){if(b.material[A]instanceof Texture){const E=b.material[A].clone();this.clonedAssets.push(E),E.repeat.x=E.repeat.x*u,E.repeat.y=E.repeat.y*u,E.needsUpdate=!0,b.material[A]=E}b.material.normalMap instanceof Texture&&(b.material.normalMap.repeat=d)}b.material.needsUpdate=!0}this.assignedMaterials[o.id]=o.assignables.map(e=>({assignable:e,materials:[],mvg:e.materialVariantGroups.reduce((e,t)=>Object.assign(e,{[t.id]:null}),{})})),v.traverse(e=>{if(e.material){const n=e.userData.PB.assignable;e.material.userData.PB.origin;if(!n)throw console.error(e),new Error("Missing assignable on Object3D "+e.id);var t=this._tree.findComponentById(e.material.userData.PB.origin);const i=this.assignedMaterials[o.id].find(e=>e.assignable===n);if(!i)throw console.error(n),new Error("Could not find assigned materials list entry");if(-1===i.materials.indexOf(t)){i.materials.push(t);for(var r of t.materialSets)i.mvg[r.id]=t}}});const x=new Object3D;x.castShadow=!0,x.receiveShadow=!0,x.name=o.label+"-transform-wrapper",x.add(v),g.add(x),g.userData.PB={origin:this.id};var p,s=this.boundingBoxes.get(o.id);if((p=new Box3Helper(o.boundingBox.boundingBox,16711680)).layers.set(n),g.add(p),s){var m=s.attributes.position;const B=new Vector3;var f=new Mesh(new BoxGeometry(.02,.02,.02),new MeshBasicMaterial({color:16711680}));f.name="Vertex Helper";for(let e=0,t=m.count;e<t;e++){B.fromBufferAttribute(m,e);const C=f.clone();this.clonedAssets.push(C),C.layers.set(n),C.position.copy(B),g.add(C)}}}(p=new Box3Helper(this.boundingBox.boundingBox,16711680)).layers.set(n),g.add(p);0!==this.boundingBox.boundingBox.max.z&&(drawDimensionsLine(g,this.dimensions.dimFront,.25,"front"),drawDimensionsLine(g,this.dimensions.dimLeft,.25,"left")),this._setContent("main",t,g);setTimeout(this.prepareComponentClones.bind(this),10);break;default:this._setContent(e,t,null)}return this}}Configuration._exportName={singular:"configuration",plural:"configurations"},Configuration.importInstructions=[{cls:BlockInstance},{cls:Connection},{cls:MaterialAssignment}],Configuration.materialCache={},ComponentTree$1.Configuration=Configuration;class Package extends ComponentTree$1{constructor(e,t,r={}){super(e,t,{import:Package.importInstructions,...r}),this.connectorTypeMateMap=new Map,this.connectorsByType={},this.materialSetsByMaterial={},this.addEvent("mate-map-update"),this.addEvent("connectors-by-type-update"),this.addEvent("material-sets-by-material-update"),r.loader&&(this.loader=r.loader),this.on("change",({cls:e})=>{e.includes(Connector)||e.includes(ConnectorType)||e.includes(ConnectionType)?this.updateConnectorTypeMateMap():[WrappedMaterial,MaterialSet,MaterialCategory].includes(e)&&this.updateMaterialSetsByMaterial()}),this.updateConnectorTypeMateMap(),this.updateMaterialSetsByMaterial()}_autoLink(){const e=["blocks","connectionTypes"],t={};for(var[r,n]of Object.entries(this._settings))e.includes(r)?t[r]=n:Array.isArray(n)&&(this._exportOnlyDependencies[r]=n);super._autoLink(t,BuildableComponent.autogenIntegralInstruction(t))}updateConnectorTypeMateMap(){return this.report({msg:"Updating mate map"}),this.connectorTypeMateMap=buildMateMap(this._settings),this.emit("mate-map-update",this.connectorTypeMateMap),this.connectorTypeMateMap}updateConnectorsByType(){for(let t of this.connectorTypes)this.connectorsByType=this.connectors.filter(e=>e.settings.type===t);this.emit("connectors-by-type-update",this.connectorsByType)}updateMaterialSetsByMaterial(){const e={};for(var t of this.materials){e[t]=[];for(var r of this.materialSets)r.has(t)&&e[t].push(r)}this.materialSetsByMaterial=e,this.emit("material-sets-by-material-update",this.materialSetsByMaterial)}async _build(e,t,r){switch(this._status[e][t].setState("loading"),e){case"UI":this._settings.thumbnail?this._setContent("UI",t,this._settings.thumbnail.content.main[t]):await this._setContent("UI",t,Project.defaultImages.missing.cloneNode(!0));break;case"main":this._setContent(e,t,r);break;default:this._setContent(e,t,null)}return this}}Package._exportName={singular:"package",plural:"packages"},Package.importInstructions=[{cls:WrappedImage},{cls:EXR},{cls:WrappedTexture},{cls:EnvironmentMap},{cls:MaterialCategoryType},{cls:MaterialCategory},{cls:WrappedMaterial},{cls:MaterialSet},{cls:GeometryFile},{cls:GLTF},{cls:Geometry},{cls:WrappedMesh},{cls:PositionedMesh},{cls:MeshGroup},{cls:PositionedMeshGroup},{cls:ThemeGroup},{cls:Theme},{cls:ConnectorType},{cls:Connector},{cls:BlockCategoryType},{cls:BlockCategory},{cls:Block},{cls:BlockSet},{cls:ConnectionType},{cls:Configuration}];var GammaCorrectionShader$1={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 tex = texture2D( tDiffuse, vUv );","\tgl_FragColor = LinearTosRGB( tex );","}"].join("\n")};const fxaaShader=new ShaderPass(FXAAShader),gammaCorrectionShader=new ShaderPass(GammaCorrectionShader$1);class DefaultView extends View{constructor(e,t){super(e,{...t,rendererSettings:{antialias:!1,alpha:!0,preserveDrawingBuffer:!0,precision:"highp",premultipliedAlpha:!0,stencil:!1,logarithmicDepthBuffer:!1,toneMapping:CineonToneMapping,toneMappingExposure:1,toneMappingWhitePoint:1,gammaFactor:2.2,outputEncoding:CineonToneMapping,physicallyCorrectLights:!0,minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,stencilBuffer:!1,type:FloatType,"shadowMap.enabled":!0},cameraSettings:{fov:30,aspect:window.innerWidth/window.innerHeight,near:.5,far:100},passes:[fxaaShader,gammaCorrectionShader]}),this.eventHandlerStates={_onPointerDownActive:!1,get active(){return this._active},set onPointerDownActive(e){this._onPointerDownActive=e}},this.dragState={_active:!1,get active(){return this._active},set active(e){this._active=e},_enter:!1,get enter(){return this._enter},set enter(e){this._enter=e},_leave:!1,get leave(){return this._leave},set leave(e){this._leave=e},_over:!1,get over(){return this._over},set over(e){this._over=e}},this.expectedComponentDrag=null,this.matOptions=[],checkPropTypes(t,{scene:Scene,renderer:WebGLRenderer,timer:Timer},{rendererSettings:Object,cameraSettings:Object,passes:t=>{if(!Array.isArray(t))return"Not an array";for(let e=0;e<t.length;e+=1){var r=t[e];if(!r instanceof Pass)return`Entry ${e} is not a Pass but a `+r.constructor.name}return!0}}),this.dragObject=null,this.dragging=!1,this.allMeshes=[],this.layerMap=Project.layerMap,this.onMouseDownActive=!1,this.shift=new Vector3,this.intersects=new Vector3,this.exrBackground=null,this.pixelRatio=this.renderer.getPixelRatio(),this.on("dimensionsupdate",e=>{fxaaShader.uniforms.resolution.value.x=1/(e.width*this.pixelRatio),fxaaShader.uniforms.resolution.value.y=1/(e.height*this.pixelRatio)}),fxaaShader.name="FXAA Pass",gammaCorrectionShader.name="Gamma Correction Pass",this.renderer.setClearColor(16777215,1),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=PCFSoftShadowMap,this.renderer.antialias=!1,this.renderer.gammaFactor=1.8,this.renderer.physicallyCorrectLights=!0,this.renderer.toneMapping=4,this.renderer.toneMappingExposure=.5,this.renderer.logarithmicDepthBuffer=!0,this.perspectiveCamera.position.set(-2,1,5),this.directionalLight=new DirectionalLight(16777215,3),this.directionalLight.position.set(-30,65,50),this.directionalLight.shadow.mapSize.width=512,this.directionalLight.shadow.mapSize.height=512,this.directionalLight.shadow.camera.near=.5,this.directionalLight.shadow.camera.far=500;this.directionalLight2=this.directionalLight.clone(),this.directionalLight.castShadow=!0,this.directionalLight2.castShadow=!1,this.directionalLight.intensity=2.7,this.directionalLight2.intensity=3.3,this.directionalLightLeft=this.directionalLight.clone(),this.directionalLightLeft.position.set(50,50,40),this.directionalLightLeft.castShadow=!0,this.directionalLightLeft.intensity=1.8,this.directionalLightBack=this.directionalLight.clone(),this.directionalLightBack.position.set(0,50,-50),this.directionalLightBack.castShadow=!1,this.directionalLightBack.intensity=1.5,this.scene.add(this.directionalLight),this.scene.add(this.directionalLight2),this.scene.add(this.directionalLightLeft),this.scene.add(this.directionalLightBack),this.mouse=new Vector2,this.intersectionPlane=new Plane,this.intersectionPlane.setFromCoplanarPoints(new Vector3,new Vector3(1,0,0),new Vector3(0,0,1)),this.intersectionPlaneNormal=new Vector3(0,1,0),this.pointOfIntersection=new Vector3,this.dragPlane=new Plane,this.dragPlane.setFromCoplanarPoints(new Vector3,new Vector3(1,0,0),new Vector3(0,0,1)),this.dragPlaneNormal=new Vector3(0,1,0),this.shift=new Vector3,this.dragging=!1,this.dragObject=null,this.pointOfIntersection=new Vector3,this.onPointerDownActive=!1,this.onTouchStartActive=!1}onTouchStart(e){var t;this.dragState.active||(this.onPointerDownActive=!1,this.onTouchStartActive=!0,this.lastPointerMove={x:e.touches[0].clientX,y:e.touches[0].clientY,timestamp:(new Date).getTime()},(t=this.findFirstIntersectedBlockInstance()||{}).event=e,this.emit("pointerdown",t),e=this.intersect(this.lastPointerMove.x,this.lastPointerMove.y),t.blockInstance instanceof BlockInstance?(this.selectionActive=!0,this.cameraControls.enabled=!1,t=this.findConfigurator(t.blockInstance.tree),this.dragObject=t,this.dragPlane.setFromNormalAndCoplanarPoint(this.dragPlaneNormal,e[0].point),this.shift.subVectors(this.dragObject.body.position,e[0].point)):(this.dragObject=null,this.hideBoundingBoxes(),this.selectionActive=!1,this.cameraControls.enabled=!0),this.update())}onTouchMove(e){console.log("touch move"),this.dragState.active||(this.lastPointerMove.x=e.touches[0].clientX,this.lastPointerMove.y=e.touches[0].clientY,void 0===this.domElementDimensions&&this.updateDOMElementDimensions(),this.intersect(this.lastPointerMove.x,this.lastPointerMove.y),this.onTouchStartActive?this.dragObject instanceof Configurator&&(!1===this.hideShadowOnDrag&&(this.shadow._update([this.dragObject.body]),this.hideShadowOnDrag=!0),this.rayCaster.ray.intersectPlane(this.dragPlane,this.pointOfIntersection),this.dragObject.body.position.copy(this.pointOfIntersection).add(this.shift),this.dragObject.body.position.setY(0),this.update()):this.hideShadowOnDrag=!1)}onTouchEnd(e){if(console.log("touch end"),!this.dragState.active){if(this.hideShadowOnDrag=!1,this.onPointerDownActive=!1,this.onTouchStartActive=!1,this.cameraControls.enabled=!0,this.lastPointerUp={x:this.lastPointerMove.x,y:this.lastPointerMove.y,timestamp:(new Date).getTime()},this.dragObject instanceof Configurator){this.selectionActive=!0;const t=this.dragObject;t.position.copy(this.dragObject.body.position),t.position.setY(0)}else this.selectionActive=!1,this.dragObject=null;this.dragObject=null,this.shadow._update(),this.update()}}onTouchCancel(e){console.log("touch cancel"),this.onTouchCancelActive=!0}onClick(e){this.dragState.active=!1,this.onPointerDownActive=!1,super.onClick()}onDoubleClick(e){console.log("double click"),this.dragState.active=!1,this.onPointerDownActive=!1,super.onDoubleClick()}onPointerDown(e){var t;console.log("viewport pointer down"),this.dragState.active||(this.onPointerDownActive=!0,this.lastPointerDown={x:this.lastPointerMove.x,y:this.lastPointerMove.y,timestamp:(new Date).getTime()},(t=this.findFirstIntersectedBlockInstance()||{}).event=e,this.emit("pointerdown",t),e=this.intersect(this.lastPointerDown.x,this.lastPointerDown.y),t.blockInstance instanceof BlockInstance?(this.selectionActive=!0,this.cameraControls.enabled=!1,t=this.findConfigurator(t.blockInstance.tree),this.dragObject=t,this.dragPlane.setFromNormalAndCoplanarPoint(this.dragPlaneNormal,e[0].point),void 0!==e[0]&&void 0!==this.dragObject&&this.shift.subVectors(this.dragObject.body.position,e[0].point)):(this.dragObject=null,this.hideBoundingBoxes(),this.selectionActive=!1,this.cameraControls.enabled=!0),this.update())}onPointerMove(e){this.dragState.active||(this.lastPointerMove.x=e.clientX,this.lastPointerMove.y=e.clientY,void 0===this.domElementDimensions&&this.updateDOMElementDimensions(),this.intersect(this.lastPointerMove.x,this.lastPointerMove.y),this.onPointerDownActive?this.dragObject instanceof Configurator&&(!1===this.hideShadowOnDrag&&(this.shadow._update([this.dragObject.body]),this.hideShadowOnDrag=!0),this.rayCaster.ray.intersectPlane(this.dragPlane,this.pointOfIntersection),this.shift.y=0,this.pointOfIntersection.y=0,this.dragObject.body.position.copy(this.pointOfIntersection).add(this.shift),this.dragObject.body.position.setY(0),this.update()):this.hideShadowOnDrag=!1)}onPointerUp(e){if(!this.dragState.active){if(this.hideShadowOnDrag=!1,this.onPointerDownActive=!1,this.cameraControls.enabled=!0,this.lastPointerUp={x:this.lastPointerMove.x,y:this.lastPointerMove.y,timestamp:(new Date).getTime()},this.dragObject instanceof Configurator){this.selectionActive=!0;const t=this.dragObject;t.position.copy(this.dragObject.body.position),t.position.setY(0)}else this.selectionActive=!1,this.dragObject=null;this.shadow._update(),this.update()}}expectComponentDrag(e){this.dragState.active=!0,this.dragState.leave=!1,this.dragState.over=!1,console.assert(e instanceof Component,"expectComponentDrag -> entered component needs to be an instance of the class Component!"),this.expectedComponentDrag&&(console.warn("Another component drag is still being expected... cancelling that one"),this.expectedComponentDrag.reject("A newer component expectation has made this one obsolete"));let r,n=null;const t=new Promise((e,t)=>{r=e,n=t});t.catch(e=>{console.error("Error in expected component drag chain:",e)}).finally(()=>{this.expectedComponentDrag=null}),this.expectedComponentDrag={component:e,promise:t,resolve:r,reject:n};const i=this;return this.expectedComponentDrag&&(this.expectedComponentDrag.timeout=setTimeout(function(){i.expectedComponentDrag.reject("Timeout")},2e3)),t}checkDrag(e){}async onDragEnter(e){if(e.preventDefault(),this.shift=new Vector3,this.hideDimensions(),this.dragState.active)if(this.dragState.leave)this.lastPointerMove.x=e.clientX,this.lastPointerMove.y=e.clientY,this.dragState.leave=!1,this.dragState.over=!1;else{this.dragState.enter=!0,this.dragState.leave=!1,this.dragState.over=!1,this.onPointerDownActive,this.cameraControls.enabled=!1,this.lastPointerMove.x=e.clientX,this.lastPointerMove.y=e.clientY;const n=this.expectedComponentDrag.component;if(n)switch(n.build(),clearTimeout(this.expectedComponentDrag.timeout),n.constructor){case WrappedMaterial:var t=n;this.dragObject=t;break;case Block:const i=new Configuration(new Reporter,{pkg:n.tree,blockInstances:[new BlockInstance(new Reporter,{block:n})]});await i.build();var r=await this.addConfigurator({pkg:n.tree,configuration:i});this.dragObject=r,this.expectedComponentDrag.createdConfigurator=r,this.expectedComponentDrag.promise.catch(e=>{throw new Error(e)});r=this.intersect(this.lastPointerMove.x,this.lastPointerMove.y);void 0!==r[0]&&this.dragPlane.setFromNormalAndCoplanarPoint(this.dragPlaneNormal,r[0].point),this.rayCaster.ray.intersectPlane(this.dragPlane,this.pointOfIntersection),this.dragObject.body.position.copy(this.pointOfIntersection),this.dragObject.body.position.setY(0),this.scene.add(this.dragObject.body),this.shadow._update([this.dragObject.body]),this.update();break;case Configuration:await n.build();r=await this.addConfigurator({pkg:n.tree.pkg,configuration:n});this.dragObject=r,this.expectedComponentDrag.createdConfigurator=r,this.expectedComponentDrag.promise.catch(e=>{throw new Error(e)});r=this.intersect(this.lastPointerMove.x,this.lastPointerMove.y);this.dragPlane.setFromNormalAndCoplanarPoint(this.dragPlaneNormal,r[0].point),this.rayCaster.ray.intersectPlane(this.dragPlane,this.pointOfIntersection),this.dragObject.body.position.copy(this.pointOfIntersection),this.dragObject.body.position.setY(0),this.scene.add(this.dragObject.body),this.shadow._update([this.dragObject.body]),this.update();break;default:this.expectedComponentDrag.reject("Unknown onDragEnter expected component constructor "+this.expectedComponentDrag.component.constructor.name)}}else console.warn("DragEnter event received, but dragState = ",this.dragState)}async onDragOver(e){this.dragState.active&&(e.preventDefault(),this.lastPointerMove.x=e.clientX,this.lastPointerMove.y=e.clientY,!1===this.dragState.over&&(this.dragState.enter&&this.shadow._update([this.dragObject.body]),this.update(),this.dragState.over=!0),this.intersect(this.lastPointerMove.x,this.lastPointerMove.y),this.rayCaster.ray.intersectPlane(this.dragPlane,this.pointOfIntersection),this.dragObject instanceof Configurator&&(this.dragObject.body.position.copy(this.pointOfIntersection),this.dragObject.body.position.setY(0)),this.update())}async onDrop(t){if(this.dragState.active){t.preventDefault();t.dataTransfer.getData("text");if(this.onPointerDownActive=!1,this.cameraControls.enabled=!0,this.dragObject)switch(this.dragObject.constructor){case WrappedMaterial:const n=this.findFirstIntersectedBlockInstance()||{};n.event=t;const i=this.findConfigurator(n.blockInstance.tree);this.matOptions=i.configuration.options.material(this.dragObject);const o=n.intersection?.object?.userData?.PB?.assignable;let e=null;o?(e=this.matOptions.find(e=>e.assignable===o),e?this.domElement.style.cursor="cell":this.domElement.style.cursor="no-drop"):this.domElement.style.cursor="no-drop";var r=i.configuration.assignMaterial(e);await i.update(r),this.expectedComponentDrag.resolve(r);break;case Configurator:this.intersect(this.lastPointerMove.x,this.lastPointerMove.y),this.rayCaster.ray.intersectPlane(this.dragPlane,this.pointOfIntersection),this.pointOfIntersection.y=0,this.dragObject.body.position.copy(this.pointOfIntersection),this.dragObject.position.copy(this.dragObject.body.position),this.expectedComponentDrag.resolve(this.expectedComponentDrag.createdConfigurator.configuration);break;default:this.expectedComponentDrag.reject("Unknown onDrop expected component constructor "+this.expectedComponentDrag.component.constructor.name)}this.shadow._update(),this.update(),this.dragState.active=!1,this.dragState.enter=!1,this.dragState.leave=!1,this.dragState.over=!1,this.selectionActive=!0}}onDragLeave(e){this.dragState.active&&(e.preventDefault(),this.dragState.enter&&(this.dragState.enter=!1,this.dragState.leave=!0,this.dragState.over=!1),this.update())}onDragEnd(){this.dragState.active&&(this.cameraControls.enabled=!0,this.dragObject?this.selectionActive=!0:(this.selectionActive=!1,this.dragObject=null),this.dragState.leave&&this.expectedComponentDrag.reject("The drag event has left the window with a drop event"),this.dragState.active=!1,this.dragState.enter=!1,this.dragState.over=!1,this.dragState.leave=!1,this.shadow._update(),this.update())}onComponentDragLeave(e){Object.keys(listenerObject).length}onKeyUp(e){var t=e.which||e.keyCode;e.shiftKey&&67===t&&this.dragObject&&this.rotateSelection(this.dragObject),67===t&&this.toggleConnectorHelpers()}rotateSelection(e){if(e instanceof Configurator){const t=e;t.move(t.body.position,t.quaternion.multiply((new Quaternion).setFromEuler(new Euler(0,Math.PI/2,0)))),this.shadow._update(),this.update()}else if(e instanceof Block){const r=this.findConfigurator(e.tree);r.move(r.body.position,r.quaternion.multiply((new Quaternion).setFromEuler(new Euler(0,Math.PI/2,0)))),this.shadow._update(),this.update()}}update(){super.update()}onSceneUpdate(...e){this.dragState.active||this.shadow._update(),super.onSceneUpdate(...e)}toggleConnectorHelpers(){this.scene.traverse(function(e){if("Actor"===e.name)for(var t of e.userData.origin.configuration.connectors){t=t.connector._settings.position;const r=new Mesh(new BoxGeometry(.1,.1,.1),new MeshBasicMaterial);r.position.copy(t),scene.add(r)}})}}var defaultRendererSettings={antialias:!1,alpha:!0,preserveDrawingBuffer:!0,precision:"highp",premultipliedAlpha:!0,stencil:!1,logarithmicDepthBuffer:!1,toneMapping:LinearToneMapping,toneMappingExposure:1,toneMappingWhitePoint:1,gammaFactor:1,outputEncoding:LinearEncoding,physicallyCorrectLights:!0,minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,stencilBuffer:!1,type:FloatType};class SingleBlockInstance extends Actor{constructor(e,t){super(e,t),checkPropTypes(t,{blockInstance:BlockInstance,loader:ComponentLoader},{position:Vector3,quaternion:Quaternion}),this.blockInstance=t.blockInstance,this.block=t.blockInstance.block,this.blockInstance.build({componentLoader:t.loader}).then(()=>{this.updateBody(t.blockInstance.content.main.medium),t.position&&this.body.position.copy(t.position),t.quaternion&&this.body.quaternion.copy(t.quaternion)}),this._stateRegister=[{position:this.body.position.clone(),quaternion:this.body.quaternion.clone()}]}toJSON(){return{block:this.block.id,position:Component.unlink(this.body.position),quaternion:Component.unlink(this.body.quaternion)}}async onStateCursorMoved(e){}}class Transform extends InformationSource{constructor(e,t={}){super(e,t),this.targets=[],this.timer=t.timer,this.scene=t.scene,this.realtime=t.realtime}addByReference(e,t){return this.addById(e.id,t.id)}addById(e,t){if(console.log("add",e),this.has(e,t))throw new Error("Target already being transformed");const r=Transform.findTargetInScene(this.scene,e,t);var n=r.userData.PB.blockInstance;r.userData.PB.blockInstance="";const i=r.clone();r.userData.PB.blockInstance=n,i.userData.PB.blockInstance=n;t={blockInstanceId:e,subComponentId:t,object3DToTransform:r,startTime:(new Date).getTime(),originalPosition:r.position.clone(),originalQuaternion:r.quaternion.clone(),originalObject3DClone:i};this.targets.push(t),"function"==typeof this.onTransformStart&&this.onTransformStart(t),!0===this.realtime?(this.timer.addUpdateRequest(this.id,this.label+" update method"),1===this.targets.length&&this.timer.on("update",this._onTimerUpdate.bind(this),this.id)):this.timer.trigger()}relinkObject3Ds(){for(var e of this.targets){var t=Transform.findTargetInScene(this.scene,e.blockInstanceId,e.subComponentId);null===t?(console.warn(`Removing ${this.label}, target object not in scene`),this.removeById(e.blockInstanceId,e.subComponentId,!1)):(e.object3DToTransform=t,this.onRelink(e))}}onRelink(e){}static findTargetInScene(e,t,r){const n=e.getObjectByName(t);if(!n)return null;if(void 0===r)return n;r=n.getObjectByName(r);return r||null}_onTimerUpdate(e){for(var t of this.targets)this.onTransformUpdate(t,e)}has(t,r){return!!this.targets.find(e=>e.blockInstanceId===t&&e.subComponentId===r)}removeById(t,r,e=!0){var n=this.targets.findIndex(e=>e.blockInstanceId===t&&e.subComponentId===r);if(-1===n)throw new Error("Unknown target "+t);if(!0===e){const i=this.targets[n];i.object3DToTransform.parent.children.findIndex(e=>e===i.object3DToTransform);const o=i.object3DToTransform.parent;o.remove(i.object3DToTransform),o.add(i.originalObject3DClone)}this.targets.splice(n,1),console.log(this.targets),this.timer.hasListener("update",this.id)?0===this.targets.length&&this.timer.removeListener("update",this.id):this.timer.trigger()}removeAllListeners(e){var t,r;for([t,r]of this.targets.map(e=>[e.blockInstanceId,e.subComponentId]))console.log(this.targets.length,t,r),this.removeById(t,r,e),console.log(this.targets.length);console.log(this.targets)}}class Composer{constructor(e,t){this._renderer=new WebGLRenderer({antialias:!1,alpha:!0,preserveDrawingBuffer:!0,precision:"highp",premultipliedAlpha:!0,stencil:!1,logarithmicDepthBuffer:!1,toneMapping:LinearToneMapping,toneMappingExposure:1,toneMappingWhitePoint:1,gammaFactor:1,outputEncoding:LinearEncoding,physicallyCorrectLights:!0,minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,stencilBuffer:!1,type:FloatType}),checkPropTypes(t,{},{scene:Scene,camera:Camera}),this._scene=t.scene,this._camera=t.camera,this._renderer.setPixelRatio(window.devicePixelRatio)}async build(e){console.log(e);const t=new RenderPass(this._scene,this._camera);t.name=" Render Pass",t.clearAlpha=1;var r=e.getPixelRatio(),n=new ShaderPass(FXAAShader);n.uniforms.resolution.value.x=1/(window.innerWidth*r),n.uniforms.resolution.value.y=1/(window.innerHeight*r),n.name="FXAA Pass",new ShaderPass(GammaCorrectionShader).name="Gamma Corretion Pass";e=new EffectComposer(e);return e.addPass(t),e.addPass(n),this._composer=e,this}}var extendStatics$1=function(e,t){return(extendStatics$1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function __extends$1(e,t){function r(){this.constructor=e}extendStatics$1(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function __awaiter(o,a,s,l){return new(s=s||Promise)(function(e,t){function r(e){try{i(l.next(e))}catch(e){t(e)}}function n(e){try{i(l.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(r,n)}i((l=l.apply(o,a||[])).next())})}function __generator(r,n){var i,o,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,(t=a?[2&t[0],a.value]:t)[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=n.call(r,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}for(var Bounds=function(){function i(e,t,r,n){this.left=e,this.top=t,this.width=r,this.height=n}return i.prototype.add=function(e,t,r,n){return new i(this.left+e,this.top+t,this.width+r,this.height+n)},i.fromClientRect=function(e){return new i(e.left,e.top,e.width,e.height)},i}(),parseBounds=function(e){return Bounds.fromClientRect(e.getBoundingClientRect())},parseDocumentSize=function(e){var t=e.body,r=e.documentElement;if(!t||!r)throw new Error("Unable to get document size");e=Math.max(Math.max(t.scrollWidth,r.scrollWidth),Math.max(t.offsetWidth,r.offsetWidth),Math.max(t.clientWidth,r.clientWidth)),r=Math.max(Math.max(t.scrollHeight,r.scrollHeight),Math.max(t.offsetHeight,r.offsetHeight),Math.max(t.clientHeight,r.clientHeight));return new Bounds(0,0,e,r)},toCodePoints=function(e){for(var t=[],r=0,n=e.length;r<n;){var i,o=e.charCodeAt(r++);55296<=o&&o<=56319&&r<n?56320==(64512&(i=e.charCodeAt(r++)))?t.push(((1023&o)<<10)+(1023&i)+65536):(t.push(o),r--):t.push(o)}return t},fromCodePoint=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var r=e.length;if(!r)return"";for(var n=[],i=-1,o="";++i<r;){var a=e[i];a<=65535?n.push(a):(a-=65536,n.push(55296+(a>>10),a%1024+56320)),(i+1===r||16384<n.length)&&(o+=String.fromCharCode.apply(String,n),n.length=0)}return o},chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup="undefined"==typeof Uint8Array?[]:new Uint8Array(256),i$1=0;i$1<chars.length;i$1++)lookup[chars.charCodeAt(i$1)]=i$1;var TokenType,decode=function(e){var t,r,n,i,o=.75*e.length,a=e.length,s=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);for(var o=new("undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?ArrayBuffer:Array)(o),l=Array.isArray(o)?o:new Uint8Array(o),c=0;c<a;c+=4)t=lookup[e.charCodeAt(c)],r=lookup[e.charCodeAt(c+1)],n=lookup[e.charCodeAt(c+2)],i=lookup[e.charCodeAt(c+3)],l[s++]=t<<2|r>>4,l[s++]=(15&r)<<4|n>>2,l[s++]=(3&n)<<6|63&i;return o},polyUint16Array=function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r.push(e[n+1]<<8|e[n]);return r},polyUint32Array=function(e){for(var t=e.length,r=[],n=0;n<t;n+=4)r.push(e[n+3]<<24|e[n+2]<<16|e[n+1]<<8|e[n]);return r},UTRIE2_SHIFT_2=5,UTRIE2_SHIFT_1=11,UTRIE2_INDEX_SHIFT=2,UTRIE2_SHIFT_1_2=UTRIE2_SHIFT_1-UTRIE2_SHIFT_2,UTRIE2_LSCP_INDEX_2_OFFSET=65536>>UTRIE2_SHIFT_2,UTRIE2_DATA_BLOCK_LENGTH=1<<UTRIE2_SHIFT_2,UTRIE2_DATA_MASK=UTRIE2_DATA_BLOCK_LENGTH-1,UTRIE2_LSCP_INDEX_2_LENGTH=1024>>UTRIE2_SHIFT_2,UTRIE2_INDEX_2_BMP_LENGTH=UTRIE2_LSCP_INDEX_2_OFFSET+UTRIE2_LSCP_INDEX_2_LENGTH,UTRIE2_UTF8_2B_INDEX_2_OFFSET=UTRIE2_INDEX_2_BMP_LENGTH,UTRIE2_UTF8_2B_INDEX_2_LENGTH=32,UTRIE2_INDEX_1_OFFSET=UTRIE2_INDEX_2_BMP_LENGTH+UTRIE2_UTF8_2B_INDEX_2_LENGTH,UTRIE2_OMITTED_BMP_INDEX_1_LENGTH=65536>>UTRIE2_SHIFT_1,UTRIE2_INDEX_2_BLOCK_LENGTH=1<<UTRIE2_SHIFT_1_2,UTRIE2_INDEX_2_MASK=UTRIE2_INDEX_2_BLOCK_LENGTH-1,slice16=function(e,t,r){return e.slice?e.slice(t,r):new Uint16Array(Array.prototype.slice.call(e,t,r))},slice32=function(e,t,r){return e.slice?e.slice(t,r):new Uint32Array(Array.prototype.slice.call(e,t,r))},createTrieFromBase64=function(e){var t=decode(e),r=Array.isArray(t)?polyUint32Array(t):new Uint32Array(t),e=Array.isArray(t)?polyUint16Array(t):new Uint16Array(t),t=slice16(e,12,r[4]/2),e=2===r[5]?slice16(e,(24+r[4])/2):slice32(r,Math.ceil((24+r[4])/4));return new Trie(r[0],r[1],r[2],r[3],t,e)},Trie=function(){function e(e,t,r,n,i,o){this.initialValue=e,this.errorValue=t,this.highStart=r,this.highValueIndex=n,this.index=i,this.data=o}return e.prototype.get=function(e){var t;if(0<=e){if(e<55296||56319<e&&e<=65535)return t=this.index[e>>UTRIE2_SHIFT_2],this.data[t=(t<<UTRIE2_INDEX_SHIFT)+(e&UTRIE2_DATA_MASK)];if(e<=65535)return t=this.index[UTRIE2_LSCP_INDEX_2_OFFSET+(e-55296>>UTRIE2_SHIFT_2)],this.data[t=(t<<UTRIE2_INDEX_SHIFT)+(e&UTRIE2_DATA_MASK)];if(e<this.highStart)return t=this.index[t=UTRIE2_INDEX_1_OFFSET-UTRIE2_OMITTED_BMP_INDEX_1_LENGTH+(e>>UTRIE2_SHIFT_1)],t=this.index[t+=e>>UTRIE2_SHIFT_2&UTRIE2_INDEX_2_MASK],this.data[t=(t<<UTRIE2_INDEX_SHIFT)+(e&UTRIE2_DATA_MASK)];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),base64="KwAAAAAAAAAACA4AIDoAAPAfAAACAAAAAAAIABAAGABAAEgAUABYAF4AZgBeAGYAYABoAHAAeABeAGYAfACEAIAAiACQAJgAoACoAK0AtQC9AMUAXgBmAF4AZgBeAGYAzQDVAF4AZgDRANkA3gDmAOwA9AD8AAQBDAEUARoBIgGAAIgAJwEvATcBPwFFAU0BTAFUAVwBZAFsAXMBewGDATAAiwGTAZsBogGkAawBtAG8AcIBygHSAdoB4AHoAfAB+AH+AQYCDgIWAv4BHgImAi4CNgI+AkUCTQJTAlsCYwJrAnECeQKBAk0CiQKRApkCoQKoArACuALAAsQCzAIwANQC3ALkAjAA7AL0AvwCAQMJAxADGAMwACADJgMuAzYDPgOAAEYDSgNSA1IDUgNaA1oDYANiA2IDgACAAGoDgAByA3YDfgOAAIQDgACKA5IDmgOAAIAAogOqA4AAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAK8DtwOAAIAAvwPHA88D1wPfAyAD5wPsA/QD/AOAAIAABAQMBBIEgAAWBB4EJgQuBDMEIAM7BEEEXgBJBCADUQRZBGEEaQQwADAAcQQ+AXkEgQSJBJEEgACYBIAAoASoBK8EtwQwAL8ExQSAAIAAgACAAIAAgACgAM0EXgBeAF4AXgBeAF4AXgBeANUEXgDZBOEEXgDpBPEE+QQBBQkFEQUZBSEFKQUxBTUFPQVFBUwFVAVcBV4AYwVeAGsFcwV7BYMFiwWSBV4AmgWgBacFXgBeAF4AXgBeAKsFXgCyBbEFugW7BcIFwgXIBcIFwgXQBdQF3AXkBesF8wX7BQMGCwYTBhsGIwYrBjMGOwZeAD8GRwZNBl4AVAZbBl4AXgBeAF4AXgBeAF4AXgBeAF4AXgBeAGMGXgBqBnEGXgBeAF4AXgBeAF4AXgBeAF4AXgB5BoAG4wSGBo4GkwaAAIADHgR5AF4AXgBeAJsGgABGA4AAowarBrMGswagALsGwwbLBjAA0wbaBtoG3QbaBtoG2gbaBtoG2gblBusG8wb7BgMHCwcTBxsHCwcjBysHMAc1BzUHOgdCB9oGSgdSB1oHYAfaBloHaAfaBlIH2gbaBtoG2gbaBtoG2gbaBjUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHbQdeAF4ANQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQd1B30HNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1B4MH2gaKB68EgACAAIAAgACAAIAAgACAAI8HlwdeAJ8HpweAAIAArwe3B14AXgC/B8UHygcwANAH2AfgB4AA6AfwBz4B+AcACFwBCAgPCBcIogEYAR8IJwiAAC8INwg/CCADRwhPCFcIXwhnCEoDGgSAAIAAgABvCHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIhAiLCI4IMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAANQc1BzUHNQc1BzUHNQc1BzUHNQc1B54INQc1B6II2gaqCLIIugiAAIAAvgjGCIAAgACAAIAAgACAAIAAgACAAIAAywiHAYAA0wiAANkI3QjlCO0I9Aj8CIAAgACAAAIJCgkSCRoJIgknCTYHLwk3CZYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiAAIAAAAFAAXgBeAGAAcABeAHwAQACQAKAArQC9AJ4AXgBeAE0A3gBRAN4A7AD8AMwBGgEAAKcBNwEFAUwBXAF4QkhCmEKnArcCgAHHAsABz4LAAcABwAHAAd+C6ABoAG+C/4LAAcABwAHAAc+DF4MAAcAB54M3gweDV4Nng3eDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEeDqABVg6WDqABoQ6gAaABoAHXDvcONw/3DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DncPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB7cPPwlGCU4JMACAAIAAgABWCV4JYQmAAGkJcAl4CXwJgAkwADAAMAAwAIgJgACLCZMJgACZCZ8JowmrCYAAswkwAF4AXgB8AIAAuwkABMMJyQmAAM4JgADVCTAAMAAwADAAgACAAIAAgACAAIAAgACAAIAAqwYWBNkIMAAwADAAMADdCeAJ6AnuCR4E9gkwAP4JBQoNCjAAMACAABUK0wiAAB0KJAosCjQKgAAwADwKQwqAAEsKvQmdCVMKWwowADAAgACAALcEMACAAGMKgABrCjAAMAAwADAAMAAwADAAMAAwADAAMAAeBDAAMAAwADAAMAAwADAAMAAwADAAMAAwAIkEPQFzCnoKiQSCCooKkAqJBJgKoAqkCokEGAGsCrQKvArBCjAAMADJCtEKFQHZCuEK/gHpCvEKMAAwADAAMACAAIwE+QowAIAAPwEBCzAAMAAwADAAMACAAAkLEQswAIAAPwEZCyELgAAOCCkLMAAxCzkLMAAwADAAMAAwADAAXgBeAEELMAAwADAAMAAwADAAMAAwAEkLTQtVC4AAXAtkC4AAiQkwADAAMAAwADAAMAAwADAAbAtxC3kLgAuFC4sLMAAwAJMLlwufCzAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAApwswADAAMACAAIAAgACvC4AAgACAAIAAgACAALcLMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAvwuAAMcLgACAAIAAgACAAIAAyguAAIAAgACAAIAA0QswADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAANkLgACAAIAA4AswADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACJCR4E6AswADAAhwHwC4AA+AsADAgMEAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMACAAIAAGAwdDCUMMAAwAC0MNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQw1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHPQwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADUHNQc1BzUHNQc1BzUHNQc2BzAAMAA5DDUHNQc1BzUHNQc1BzUHNQc1BzUHNQdFDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAgACAAIAATQxSDFoMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAF4AXgBeAF4AXgBeAF4AYgxeAGoMXgBxDHkMfwxeAIUMXgBeAI0MMAAwADAAMAAwAF4AXgCVDJ0MMAAwADAAMABeAF4ApQxeAKsMswy7DF4Awgy9DMoMXgBeAF4AXgBeAF4AXgBeAF4AXgDRDNkMeQBqCeAM3Ax8AOYM7Az0DPgMXgBeAF4AXgBeAF4AXgBeAF4AXgBeAF4AXgBeAF4AXgCgAAANoAAHDQ4NFg0wADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAeDSYNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIAAgACAAIAAgACAAC4NMABeAF4ANg0wADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAD4NRg1ODVYNXg1mDTAAbQ0wADAAMAAwADAAMAAwADAA2gbaBtoG2gbaBtoG2gbaBnUNeg3CBYANwgWFDdoGjA3aBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gaUDZwNpA2oDdoG2gawDbcNvw3HDdoG2gbPDdYN3A3fDeYN2gbsDfMN2gbaBvoN/g3aBgYODg7aBl4AXgBeABYOXgBeACUG2gYeDl4AJA5eACwO2w3aBtoGMQ45DtoG2gbaBtoGQQ7aBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gZJDjUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1B1EO2gY1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQdZDjUHNQc1BzUHNQc1B2EONQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHaA41BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1B3AO2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gY1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1B2EO2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gZJDtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBkkOeA6gAKAAoAAwADAAMAAwAKAAoACgAKAAoACgAKAAgA4wADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAD//wQABAAEAAQABAAEAAQABAAEAA0AAwABAAEAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAKABMAFwAeABsAGgAeABcAFgASAB4AGwAYAA8AGAAcAEsASwBLAEsASwBLAEsASwBLAEsAGAAYAB4AHgAeABMAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAFgAbABIAHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYADQARAB4ABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkAFgAaABsAGwAbAB4AHQAdAB4ATwAXAB4ADQAeAB4AGgAbAE8ATwAOAFAAHQAdAB0ATwBPABcATwBPAE8AFgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwArAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAAQABAANAA0ASwBLAEsASwBLAEsASwBLAEsASwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUAArACsABABQAAQABAAEAAQABAAEAAQAKwArAAQABAArACsABAAEAAQAUAArACsAKwArACsAKwArACsABAArACsAKwArAFAAUAArAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAGgAaAFAAUABQAFAAUABMAB4AGwBQAB4AKwArACsABAAEAAQAKwBQAFAAUABQAFAAUAArACsAKwArAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUAArAFAAUAArACsABAArAAQABAAEAAQABAArACsAKwArAAQABAArACsABAAEAAQAKwArACsABAArACsAKwArACsAKwArAFAAUABQAFAAKwBQACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwAEAAQAUABQAFAABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUAArACsABABQAAQABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQAKwArAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwAeABsAKwArACsAKwArACsAKwBQAAQABAAEAAQABAAEACsABAAEAAQAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwArAAQABAArACsABAAEAAQAKwArACsAKwArACsAKwArAAQABAArACsAKwArAFAAUAArAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwAeAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwAEAFAAKwBQAFAAUABQAFAAUAArACsAKwBQAFAAUAArAFAAUABQAFAAKwArACsAUABQACsAUAArAFAAUAArACsAKwBQAFAAKwArACsAUABQAFAAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQAKwArACsABAAEAAQAKwAEAAQABAAEACsAKwBQACsAKwArACsAKwArAAQAKwArACsAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAB4AHgAeAB4AHgAeABsAHgArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABAArACsAKwArACsAKwArAAQABAArAFAAUABQACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAB4AUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABAArACsAKwArACsAKwArAAQABAArACsAKwArACsAKwArAFAAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwArAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAKwBcAFwAKwBcACsAKwBcACsAKwArACsAKwArAFwAXABcAFwAKwBcAFwAXABcAFwAXABcACsAXABcAFwAKwBcACsAXAArACsAXABcACsAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgArACoAKgBcACsAKwBcAFwAXABcAFwAKwBcACsAKgAqACoAKgAqACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAFwAXABcAFwAUAAOAA4ADgAOAB4ADgAOAAkADgAOAA0ACQATABMAEwATABMACQAeABMAHgAeAB4ABAAEAB4AHgAeAB4AHgAeAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUAANAAQAHgAEAB4ABAAWABEAFgARAAQABABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAAQABAAEAAQABAANAAQABABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsADQANAB4AHgAeAB4AHgAeAAQAHgAeAB4AHgAeAB4AKwAeAB4ADgAOAA0ADgAeAB4AHgAeAB4ACQAJACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgAeAB4AHgBcAFwAXABcAFwAXAAqACoAKgAqAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAKgAqACoAKgAqACoAKgBcAFwAXAAqACoAKgAqAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAXAAqAEsASwBLAEsASwBLAEsASwBLAEsAKgAqACoAKgAqACoAUABQAFAAUABQAFAAKwBQACsAKwArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQACsAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwAEAAQABAAeAA0AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAEQArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAADQANAA0AUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAA0ADQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQACsABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoADQANABUAXAANAB4ADQAbAFwAKgArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAB4AHgATABMADQANAA4AHgATABMAHgAEAAQABAAJACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAUABQAFAAUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwAeACsAKwArABMAEwBLAEsASwBLAEsASwBLAEsASwBLAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwBcAFwAXABcAFwAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcACsAKwArACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwAeAB4AXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgArACsABABLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKgAqACoAKgAqACoAKgBcACoAKgAqACoAKgAqACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAUABQAFAAUABQAFAAUAArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4ADQANAA0ADQAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAHgAeAB4AHgBQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwANAA0ADQANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwBQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsABAAEAAQAHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAABABQAFAAUABQAAQABAAEAFAAUAAEAAQABAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAKwBQACsAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAKwArAB4AHgAeAB4AHgAeACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAUABQAFAAKwAeAB4AHgAeAB4AHgAeAA4AHgArAA0ADQANAA0ADQANAA0ACQANAA0ADQAIAAQACwAEAAQADQAJAA0ADQAMAB0AHQAeABcAFwAWABcAFwAXABYAFwAdAB0AHgAeABQAFAAUAA0AAQABAAQABAAEAAQABAAJABoAGgAaABoAGgAaABoAGgAeABcAFwAdABUAFQAeAB4AHgAeAB4AHgAYABYAEQAVABUAFQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgANAB4ADQANAA0ADQAeAA0ADQANAAcAHgAeAB4AHgArAAQABAAEAAQABAAEAAQABAAEAAQAUABQACsAKwBPAFAAUABQAFAAUAAeAB4AHgAWABEATwBQAE8ATwBPAE8AUABQAFAAUABQAB4AHgAeABYAEQArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAGwAbABsAGwAbABsAGwAaABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAaABsAGwAbABsAGgAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgBQABoAHgAdAB4AUAAeABoAHgAeAB4AHgAeAB4AHgAeAB4ATwAeAFAAGwAeAB4AUABQAFAAUABQAB4AHgAeAB0AHQAeAFAAHgBQAB4AUAAeAFAATwBQAFAAHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AUABQAFAAUABPAE8AUABQAFAAUABQAE8AUABQAE8AUABPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAE8ATwBPAE8ATwBPAE8ATwBPAE8AUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAATwAeAB4AKwArACsAKwAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB0AHQAeAB4AHgAdAB0AHgAeAB0AHgAeAB4AHQAeAB0AGwAbAB4AHQAeAB4AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB0AHgAdAB4AHQAdAB0AHQAdAB0AHgAdAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAdAB0AHQAdAB4AHgAdAB0AHgAeAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABQAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAlACUAHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBQAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAeAB4AHgAeAB0AHQAeAB4AHgAeAB0AHQAdAB4AHgAdAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB0AHQAeAB4AHQAeAB4AHgAeAB0AHQAeAB4AHgAeACUAJQAdAB0AJQAeACUAJQAlACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAHgAeAB4AHgAdAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHQAdAB0AHgAdACUAHQAdAB4AHQAdAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHQAdAB0AHQAlAB4AJQAlACUAHQAlACUAHQAdAB0AJQAlAB0AHQAlAB0AHQAlACUAJQAeAB0AHgAeAB4AHgAdAB0AJQAdAB0AHQAdAB0AHQAlACUAJQAlACUAHQAlACUAIAAlAB0AHQAlACUAJQAlACUAJQAlACUAHgAeAB4AJQAlACAAIAAgACAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeABcAFwAXABcAFwAXAB4AEwATACUAHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwArACUAJQBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAKwArACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAE8ATwBPAE8ATwBPAE8ATwAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeACsAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUAArACsAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQBQAFAAUABQACsAKwArACsAUABQAFAAUABQAFAAUABQAA0AUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQACsAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgBQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAABAAEAAQAKwAEAAQAKwArACsAKwArAAQABAAEAAQAUABQAFAAUAArAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsABAAEAAQAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsADQANAA0ADQANAA0ADQANAB4AKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AUABQAFAAUABQAFAAUABQAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAUABQAFAAUABQAA0ADQANAA0ADQANABQAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwANAA0ADQANAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAeAAQABAAEAB4AKwArAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLACsADQArAB4AKwArAAQABAAEAAQAUABQAB4AUAArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwAEAAQABAAEAAQABAAEAAQABAAOAA0ADQATABMAHgAeAB4ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0AUABQAFAAUAAEAAQAKwArAAQADQANAB4AUAArACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXABcAA0ADQANACoASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUAArACsAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANACsADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEcARwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQACsAKwAeAAQABAANAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAEAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUAArACsAUAArACsAUABQACsAKwBQAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AKwArAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAeAB4ADQANAA0ADQAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAArAAQABAArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAEAAQABAAEAAQABAAEACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAFgAWAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAKwBQACsAKwArACsAKwArAFAAKwArACsAKwBQACsAUAArAFAAKwBQAFAAUAArAFAAUAArAFAAKwArAFAAKwBQACsAUAArAFAAKwBQACsAUABQACsAUAArACsAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAUABQAFAAUAArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUAArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAlACUAJQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeACUAJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeACUAJQAlACUAJQAeACUAJQAlACUAJQAgACAAIAAlACUAIAAlACUAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIQAhACEAIQAhACUAJQAgACAAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIAAgACAAIAAlACUAJQAlACAAJQAgACAAIAAgACAAIAAgACAAIAAlACUAJQAgACUAJQAlACUAIAAgACAAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeACUAHgAlAB4AJQAlACUAJQAlACAAJQAlACUAJQAeACUAHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIAAgACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIAAlACUAJQAlACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAIAAgACAAJQAlACUAIAAgACAAIAAgAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFwAXABcAFQAVABUAHgAeAB4AHgAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIAAgACAAJQAlACUAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAlACAAIAAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsA",LETTER_NUMBER_MODIFIER=50,BK=1,CR=2,LF=3,CM=4,NL=5,WJ=7,ZW=8,GL=9,SP=10,ZWJ=11,B2=12,BA=13,BB=14,HY=15,CB=16,CL=17,CP=18,EX=19,IN=20,NS=21,OP=22,QU=23,IS=24,NU=25,PO=26,PR=27,SY=28,AI=29,AL=30,CJ=31,EB=32,EM=33,H2=34,H3=35,HL=36,ID=37,JL=38,JV=39,JT=40,RI=41,SA=42,XX=43,BREAK_MANDATORY="!",BREAK_NOT_ALLOWED="×",BREAK_ALLOWED="÷",UnicodeTrie=createTrieFromBase64(base64),ALPHABETICS=[AL,HL],HARD_LINE_BREAKS=[BK,CR,LF,NL],SPACE=[SP,ZW],PREFIX_POSTFIX=[PR,PO],LINE_BREAKS=HARD_LINE_BREAKS.concat(SPACE),KOREAN_SYLLABLE_BLOCK=[JL,JV,JT,H2,H3],HYPHEN=[HY,BA],codePointsToCharacterClasses=function(e,n){void 0===n&&(n="strict");var i=[],o=[],a=[];return e.forEach(function(e,t){var r=UnicodeTrie.get(e);if(LETTER_NUMBER_MODIFIER<r?(a.push(!0),r-=LETTER_NUMBER_MODIFIER):a.push(!1),-1!==["normal","auto","loose"].indexOf(n)&&-1!==[8208,8211,12316,12448].indexOf(e))return o.push(t),i.push(CB);if(r!==CM&&r!==ZWJ)return o.push(t),r===CJ?i.push("strict"===n?NS:ID):r===SA||r===AI?i.push(AL):r===XX?131072<=e&&e<=196605||196608<=e&&e<=262141?i.push(ID):i.push(AL):void i.push(r);if(0===t)return o.push(t),i.push(AL);r=i[t-1];return-1===LINE_BREAKS.indexOf(r)?(o.push(o[t-1]),i.push(r)):(o.push(t),i.push(AL))}),[o,i,a]},isAdjacentWithSpaceIgnored=function(e,t,r,n){var i=n[r];if(Array.isArray(e)?-1!==e.indexOf(i):e===i)for(var o=r;o<=n.length;){if((s=n[++o])===t)return!0;if(s!==SP)break}if(i===SP)for(o=r;0<o;){var a=n[--o];if(Array.isArray(e)?-1!==e.indexOf(a):e===a)for(var s,l=r;l<=n.length;){if((s=n[++l])===t)return!0;if(s!==SP)break}if(a!==SP)break}return!1},previousNonSpaceClassType=function(e,t){for(var r=e;0<=r;){var n=t[r];if(n!==SP)return n;r--}return 0},_lineBreakAtIndex=function(e,t,r,n,i){if(0===r[n])return BREAK_NOT_ALLOWED;var o=n-1;if(Array.isArray(i)&&!0===i[o])return BREAK_NOT_ALLOWED;var a=o-1,s=1+o,l=t[o],n=0<=a?t[a]:0,i=t[s];if(l===CR&&i===LF)return BREAK_NOT_ALLOWED;if(-1!==HARD_LINE_BREAKS.indexOf(l))return BREAK_MANDATORY;if(-1!==HARD_LINE_BREAKS.indexOf(i))return BREAK_NOT_ALLOWED;if(-1!==SPACE.indexOf(i))return BREAK_NOT_ALLOWED;if(previousNonSpaceClassType(o,t)===ZW)return BREAK_ALLOWED;if(UnicodeTrie.get(e[o])===ZWJ&&(i===ID||i===EB||i===EM))return BREAK_NOT_ALLOWED;if(l===WJ||i===WJ)return BREAK_NOT_ALLOWED;if(l===GL)return BREAK_NOT_ALLOWED;if(-1===[SP,BA,HY].indexOf(l)&&i===GL)return BREAK_NOT_ALLOWED;if(-1!==[CL,CP,EX,IS,SY].indexOf(i))return BREAK_NOT_ALLOWED;if(previousNonSpaceClassType(o,t)===OP)return BREAK_NOT_ALLOWED;if(isAdjacentWithSpaceIgnored(QU,OP,o,t))return BREAK_NOT_ALLOWED;if(isAdjacentWithSpaceIgnored([CL,CP],NS,o,t))return BREAK_NOT_ALLOWED;if(isAdjacentWithSpaceIgnored(B2,B2,o,t))return BREAK_NOT_ALLOWED;if(l===SP)return BREAK_ALLOWED;if(l===QU||i===QU)return BREAK_NOT_ALLOWED;if(i===CB||l===CB)return BREAK_ALLOWED;if(-1!==[BA,HY,NS].indexOf(i)||l===BB)return BREAK_NOT_ALLOWED;if(n===HL&&-1!==HYPHEN.indexOf(l))return BREAK_NOT_ALLOWED;if(l===SY&&i===HL)return BREAK_NOT_ALLOWED;if(i===IN&&-1!==ALPHABETICS.concat(IN,EX,NU,ID,EB,EM).indexOf(l))return BREAK_NOT_ALLOWED;if(-1!==ALPHABETICS.indexOf(i)&&l===NU||-1!==ALPHABETICS.indexOf(l)&&i===NU)return BREAK_NOT_ALLOWED;if(l===PR&&-1!==[ID,EB,EM].indexOf(i)||-1!==[ID,EB,EM].indexOf(l)&&i===PO)return BREAK_NOT_ALLOWED;if(-1!==ALPHABETICS.indexOf(l)&&-1!==PREFIX_POSTFIX.indexOf(i)||-1!==PREFIX_POSTFIX.indexOf(l)&&-1!==ALPHABETICS.indexOf(i))return BREAK_NOT_ALLOWED;if(-1!==[PR,PO].indexOf(l)&&(i===NU||-1!==[OP,HY].indexOf(i)&&t[1+s]===NU)||-1!==[OP,HY].indexOf(l)&&i===NU||l===NU&&-1!==[NU,SY,IS].indexOf(i))return BREAK_NOT_ALLOWED;if(-1!==[NU,SY,IS,CL,CP].indexOf(i))for(var c=o;0<=c;){if((h=t[c])===NU)return BREAK_NOT_ALLOWED;if(-1===[SY,IS].indexOf(h))break;c--}if(-1!==[PR,PO].indexOf(i))for(var h,c=-1!==[CL,CP].indexOf(l)?a:o;0<=c;){if((h=t[c])===NU)return BREAK_NOT_ALLOWED;if(-1===[SY,IS].indexOf(h))break;c--}if(JL===l&&-1!==[JL,JV,H2,H3].indexOf(i)||-1!==[JV,H2].indexOf(l)&&-1!==[JV,JT].indexOf(i)||-1!==[JT,H3].indexOf(l)&&i===JT)return BREAK_NOT_ALLOWED;if(-1!==KOREAN_SYLLABLE_BLOCK.indexOf(l)&&-1!==[IN,PO].indexOf(i)||-1!==KOREAN_SYLLABLE_BLOCK.indexOf(i)&&l===PR)return BREAK_NOT_ALLOWED;if(-1!==ALPHABETICS.indexOf(l)&&-1!==ALPHABETICS.indexOf(i))return BREAK_NOT_ALLOWED;if(l===IS&&-1!==ALPHABETICS.indexOf(i))return BREAK_NOT_ALLOWED;if(-1!==ALPHABETICS.concat(NU).indexOf(l)&&i===OP||-1!==ALPHABETICS.concat(NU).indexOf(i)&&l===CP)return BREAK_NOT_ALLOWED;if(l===RI&&i===RI){for(var u=r[o],A=1;0<u&&t[--u]===RI;)A++;if(A%2!=0)return BREAK_NOT_ALLOWED}return l===EB&&i===EM?BREAK_NOT_ALLOWED:BREAK_ALLOWED},cssFormattedClasses=function(r,e){var t=codePointsToCharacterClasses(r,(e=e||{lineBreak:"normal",wordBreak:"normal"}).lineBreak),n=t[0],i=t[1],t=t[2];return[n,i="break-all"===e.wordBreak||"break-word"===e.wordBreak?i.map(function(e){return-1!==[NU,AL,SA].indexOf(e)?ID:e}):i,"keep-all"===e.wordBreak?t.map(function(e,t){return e&&19968<=r[t]&&r[t]<=40959}):void 0]},Break=function(){function e(e,t,r,n){this.codePoints=e,this.required=t===BREAK_MANDATORY,this.start=r,this.end=n}return e.prototype.slice=function(){return fromCodePoint.apply(void 0,this.codePoints.slice(this.start,this.end))},e}(),LineBreaker=function(e,t){var r=toCodePoints(e),t=cssFormattedClasses(r,t),n=t[0],i=t[1],o=t[2],a=r.length,s=0,l=0;return{next:function(){if(a<=l)return{done:!0,value:null};for(var e=BREAK_NOT_ALLOWED;l<a&&(e=_lineBreakAtIndex(r,i,n,++l,o))===BREAK_NOT_ALLOWED;);if(e===BREAK_NOT_ALLOWED&&l!==a)return{done:!0,value:null};var t=new Break(r,e,s,l);return s=l,{value:t,done:!1}}}};!function(e){e[e.STRING_TOKEN=0]="STRING_TOKEN",e[e.BAD_STRING_TOKEN=1]="BAD_STRING_TOKEN",e[e.LEFT_PARENTHESIS_TOKEN=2]="LEFT_PARENTHESIS_TOKEN",e[e.RIGHT_PARENTHESIS_TOKEN=3]="RIGHT_PARENTHESIS_TOKEN",e[e.COMMA_TOKEN=4]="COMMA_TOKEN",e[e.HASH_TOKEN=5]="HASH_TOKEN",e[e.DELIM_TOKEN=6]="DELIM_TOKEN",e[e.AT_KEYWORD_TOKEN=7]="AT_KEYWORD_TOKEN",e[e.PREFIX_MATCH_TOKEN=8]="PREFIX_MATCH_TOKEN",e[e.DASH_MATCH_TOKEN=9]="DASH_MATCH_TOKEN",e[e.INCLUDE_MATCH_TOKEN=10]="INCLUDE_MATCH_TOKEN",e[e.LEFT_CURLY_BRACKET_TOKEN=11]="LEFT_CURLY_BRACKET_TOKEN",e[e.RIGHT_CURLY_BRACKET_TOKEN=12]="RIGHT_CURLY_BRACKET_TOKEN",e[e.SUFFIX_MATCH_TOKEN=13]="SUFFIX_MATCH_TOKEN",e[e.SUBSTRING_MATCH_TOKEN=14]="SUBSTRING_MATCH_TOKEN",e[e.DIMENSION_TOKEN=15]="DIMENSION_TOKEN",e[e.PERCENTAGE_TOKEN=16]="PERCENTAGE_TOKEN",e[e.NUMBER_TOKEN=17]="NUMBER_TOKEN",e[e.FUNCTION=18]="FUNCTION",e[e.FUNCTION_TOKEN=19]="FUNCTION_TOKEN",e[e.IDENT_TOKEN=20]="IDENT_TOKEN",e[e.COLUMN_TOKEN=21]="COLUMN_TOKEN",e[e.URL_TOKEN=22]="URL_TOKEN",e[e.BAD_URL_TOKEN=23]="BAD_URL_TOKEN",e[e.CDC_TOKEN=24]="CDC_TOKEN",e[e.CDO_TOKEN=25]="CDO_TOKEN",e[e.COLON_TOKEN=26]="COLON_TOKEN",e[e.SEMICOLON_TOKEN=27]="SEMICOLON_TOKEN",e[e.LEFT_SQUARE_BRACKET_TOKEN=28]="LEFT_SQUARE_BRACKET_TOKEN",e[e.RIGHT_SQUARE_BRACKET_TOKEN=29]="RIGHT_SQUARE_BRACKET_TOKEN",e[e.UNICODE_RANGE_TOKEN=30]="UNICODE_RANGE_TOKEN",e[e.WHITESPACE_TOKEN=31]="WHITESPACE_TOKEN",e[e.EOF_TOKEN=32]="EOF_TOKEN"}(TokenType=TokenType||{});var FLAG_UNRESTRICTED=1,FLAG_ID=2,FLAG_INTEGER=4,FLAG_NUMBER=8,LINE_FEED=10,SOLIDUS=47,REVERSE_SOLIDUS=92,CHARACTER_TABULATION=9,SPACE$1=32,QUOTATION_MARK=34,EQUALS_SIGN=61,NUMBER_SIGN=35,DOLLAR_SIGN=36,PERCENTAGE_SIGN=37,APOSTROPHE=39,LEFT_PARENTHESIS=40,RIGHT_PARENTHESIS=41,LOW_LINE=95,HYPHEN_MINUS=45,EXCLAMATION_MARK=33,LESS_THAN_SIGN=60,GREATER_THAN_SIGN=62,COMMERCIAL_AT=64,LEFT_SQUARE_BRACKET=91,RIGHT_SQUARE_BRACKET=93,CIRCUMFLEX_ACCENT=61,LEFT_CURLY_BRACKET=123,QUESTION_MARK=63,RIGHT_CURLY_BRACKET=125,VERTICAL_LINE=124,TILDE=126,CONTROL=128,REPLACEMENT_CHARACTER=65533,ASTERISK=42,PLUS_SIGN=43,COMMA=44,COLON=58,SEMICOLON=59,FULL_STOP=46,NULL=0,BACKSPACE=8,LINE_TABULATION=11,SHIFT_OUT=14,INFORMATION_SEPARATOR_ONE=31,DELETE=127,EOF=-1,ZERO=48,a=97,e=101,f$1=102,u=117,z=122,A$1=65,E=69,F$1=70,U=85,Z=90,isDigit=function(e){return ZERO<=e&&e<=57},isSurrogateCodePoint=function(e){return 55296<=e&&e<=57343},isHex=function(e){return isDigit(e)||A$1<=e&&e<=F$1||a<=e&&e<=f$1},isLowerCaseLetter=function(e){return a<=e&&e<=z},isUpperCaseLetter=function(e){return A$1<=e&&e<=Z},isLetter=function(e){return isLowerCaseLetter(e)||isUpperCaseLetter(e)},isNonASCIICodePoint=function(e){return CONTROL<=e},isWhiteSpace=function(e){return e===LINE_FEED||e===CHARACTER_TABULATION||e===SPACE$1},isNameStartCodePoint=function(e){return isLetter(e)||isNonASCIICodePoint(e)||e===LOW_LINE},isNameCodePoint=function(e){return isNameStartCodePoint(e)||isDigit(e)||e===HYPHEN_MINUS},isNonPrintableCodePoint=function(e){return NULL<=e&&e<=BACKSPACE||e===LINE_TABULATION||SHIFT_OUT<=e&&e<=INFORMATION_SEPARATOR_ONE||e===DELETE},isValidEscape=function(e,t){return e===REVERSE_SOLIDUS&&t!==LINE_FEED},isIdentifierStart=function(e,t,r){return e===HYPHEN_MINUS?isNameStartCodePoint(t)||isValidEscape(t,r):!!isNameStartCodePoint(e)||!(e!==REVERSE_SOLIDUS||!isValidEscape(e,t))},isNumberStart=function(e,t,r){return e===PLUS_SIGN||e===HYPHEN_MINUS?!!isDigit(t)||t===FULL_STOP&&isDigit(r):isDigit(e===FULL_STOP?t:e)},stringToNumber=function(t){var r=0,n=1;t[r]!==PLUS_SIGN&&t[r]!==HYPHEN_MINUS||(t[r]===HYPHEN_MINUS&&(n=-1),r++);for(var i=[];isDigit(t[r]);)i.push(t[r++]);var o=i.length?parseInt(fromCodePoint.apply(void 0,i),10):0;t[r]===FULL_STOP&&r++;for(var a=[];isDigit(t[r]);)a.push(t[r++]);var s=a.length,l=s?parseInt(fromCodePoint.apply(void 0,a),10):0;t[r]!==E&&t[r]!==e||r++;var c=1;t[r]!==PLUS_SIGN&&t[r]!==HYPHEN_MINUS||(t[r]===HYPHEN_MINUS&&(c=-1),r++);for(var h=[];isDigit(t[r]);)h.push(t[r++]);var u=h.length?parseInt(fromCodePoint.apply(void 0,h),10):0;return n*(o+l*Math.pow(10,-s))*Math.pow(10,c*u)},LEFT_PARENTHESIS_TOKEN={type:TokenType.LEFT_PARENTHESIS_TOKEN},RIGHT_PARENTHESIS_TOKEN={type:TokenType.RIGHT_PARENTHESIS_TOKEN},COMMA_TOKEN={type:TokenType.COMMA_TOKEN},SUFFIX_MATCH_TOKEN={type:TokenType.SUFFIX_MATCH_TOKEN},PREFIX_MATCH_TOKEN={type:TokenType.PREFIX_MATCH_TOKEN},COLUMN_TOKEN={type:TokenType.COLUMN_TOKEN},DASH_MATCH_TOKEN={type:TokenType.DASH_MATCH_TOKEN},INCLUDE_MATCH_TOKEN={type:TokenType.INCLUDE_MATCH_TOKEN},LEFT_CURLY_BRACKET_TOKEN={type:TokenType.LEFT_CURLY_BRACKET_TOKEN},RIGHT_CURLY_BRACKET_TOKEN={type:TokenType.RIGHT_CURLY_BRACKET_TOKEN},SUBSTRING_MATCH_TOKEN={type:TokenType.SUBSTRING_MATCH_TOKEN},BAD_URL_TOKEN={type:TokenType.BAD_URL_TOKEN},BAD_STRING_TOKEN={type:TokenType.BAD_STRING_TOKEN},CDO_TOKEN={type:TokenType.CDO_TOKEN},CDC_TOKEN={type:TokenType.CDC_TOKEN},COLON_TOKEN={type:TokenType.COLON_TOKEN},SEMICOLON_TOKEN={type:TokenType.SEMICOLON_TOKEN},LEFT_SQUARE_BRACKET_TOKEN={type:TokenType.LEFT_SQUARE_BRACKET_TOKEN},RIGHT_SQUARE_BRACKET_TOKEN={type:TokenType.RIGHT_SQUARE_BRACKET_TOKEN},WHITESPACE_TOKEN={type:TokenType.WHITESPACE_TOKEN},EOF_TOKEN={type:TokenType.EOF_TOKEN},Tokenizer=function(){function t(){this._value=[]}return t.prototype.write=function(e){this._value=this._value.concat(toCodePoints(e))},t.prototype.read=function(){for(var e=[],t=this.consumeToken();t!==EOF_TOKEN;)e.push(t),t=this.consumeToken();return e},t.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case QUOTATION_MARK:return this.consumeStringToken(QUOTATION_MARK);case NUMBER_SIGN:var t=this.peekCodePoint(0),r=this.peekCodePoint(1),n=this.peekCodePoint(2);if(isNameCodePoint(t)||isValidEscape(r,n)){var i=isIdentifierStart(t,r,n)?FLAG_ID:FLAG_UNRESTRICTED,o=this.consumeName();return{type:TokenType.HASH_TOKEN,value:o,flags:i}}break;case DOLLAR_SIGN:if(this.peekCodePoint(0)===EQUALS_SIGN)return this.consumeCodePoint(),SUFFIX_MATCH_TOKEN;break;case APOSTROPHE:return this.consumeStringToken(APOSTROPHE);case LEFT_PARENTHESIS:return LEFT_PARENTHESIS_TOKEN;case RIGHT_PARENTHESIS:return RIGHT_PARENTHESIS_TOKEN;case ASTERISK:if(this.peekCodePoint(0)===EQUALS_SIGN)return this.consumeCodePoint(),SUBSTRING_MATCH_TOKEN;break;case PLUS_SIGN:if(isNumberStart(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case COMMA:return COMMA_TOKEN;case HYPHEN_MINUS:var i=e,a=this.peekCodePoint(0),s=this.peekCodePoint(1);if(isNumberStart(i,a,s))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(isIdentifierStart(i,a,s))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(a===HYPHEN_MINUS&&s===GREATER_THAN_SIGN)return this.consumeCodePoint(),this.consumeCodePoint(),CDC_TOKEN;break;case FULL_STOP:if(isNumberStart(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case SOLIDUS:if(this.peekCodePoint(0)===ASTERISK)for(this.consumeCodePoint();;){var l=this.consumeCodePoint();if(l===ASTERISK&&(l=this.consumeCodePoint())===SOLIDUS)return this.consumeToken();if(l===EOF)return this.consumeToken()}break;case COLON:return COLON_TOKEN;case SEMICOLON:return SEMICOLON_TOKEN;case LESS_THAN_SIGN:if(this.peekCodePoint(0)===EXCLAMATION_MARK&&this.peekCodePoint(1)===HYPHEN_MINUS&&this.peekCodePoint(2)===HYPHEN_MINUS)return this.consumeCodePoint(),this.consumeCodePoint(),CDO_TOKEN;break;case COMMERCIAL_AT:var a=this.peekCodePoint(0),s=this.peekCodePoint(1),c=this.peekCodePoint(2);if(isIdentifierStart(a,s,c)){o=this.consumeName();return{type:TokenType.AT_KEYWORD_TOKEN,value:o}}break;case LEFT_SQUARE_BRACKET:return LEFT_SQUARE_BRACKET_TOKEN;case REVERSE_SOLIDUS:if(isValidEscape(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case RIGHT_SQUARE_BRACKET:return RIGHT_SQUARE_BRACKET_TOKEN;case CIRCUMFLEX_ACCENT:if(this.peekCodePoint(0)===EQUALS_SIGN)return this.consumeCodePoint(),PREFIX_MATCH_TOKEN;break;case LEFT_CURLY_BRACKET:return LEFT_CURLY_BRACKET_TOKEN;case RIGHT_CURLY_BRACKET:return RIGHT_CURLY_BRACKET_TOKEN;case u:case U:c=this.peekCodePoint(0),o=this.peekCodePoint(1);return c!==PLUS_SIGN||!isHex(o)&&o!==QUESTION_MARK||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case VERTICAL_LINE:if(this.peekCodePoint(0)===EQUALS_SIGN)return this.consumeCodePoint(),DASH_MATCH_TOKEN;if(this.peekCodePoint(0)===VERTICAL_LINE)return this.consumeCodePoint(),COLUMN_TOKEN;break;case TILDE:if(this.peekCodePoint(0)===EQUALS_SIGN)return this.consumeCodePoint(),INCLUDE_MATCH_TOKEN;break;case EOF:return EOF_TOKEN}return isWhiteSpace(e)?(this.consumeWhiteSpace(),WHITESPACE_TOKEN):isDigit(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):isNameStartCodePoint(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:TokenType.DELIM_TOKEN,value:fromCodePoint(e)}},t.prototype.consumeCodePoint=function(){var e=this._value.shift();return void 0===e?-1:e},t.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},t.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},t.prototype.consumeUnicodeRangeToken=function(){for(var e=[],t=this.consumeCodePoint();isHex(t)&&e.length<6;)e.push(t),t=this.consumeCodePoint();for(var r=!1;t===QUESTION_MARK&&e.length<6;)e.push(t),t=this.consumeCodePoint(),r=!0;if(r){var n=parseInt(fromCodePoint.apply(void 0,e.map(function(e){return e===QUESTION_MARK?ZERO:e})),16),i=parseInt(fromCodePoint.apply(void 0,e.map(function(e){return e===QUESTION_MARK?F$1:e})),16);return{type:TokenType.UNICODE_RANGE_TOKEN,start:n,end:i}}n=parseInt(fromCodePoint.apply(void 0,e),16);if(this.peekCodePoint(0)===HYPHEN_MINUS&&isHex(this.peekCodePoint(1))){this.consumeCodePoint();for(var t=this.consumeCodePoint(),o=[];isHex(t)&&o.length<6;)o.push(t),t=this.consumeCodePoint();i=parseInt(fromCodePoint.apply(void 0,o),16);return{type:TokenType.UNICODE_RANGE_TOKEN,start:n,end:i}}return{type:TokenType.UNICODE_RANGE_TOKEN,start:n,end:n}},t.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return"url"===e.toLowerCase()&&this.peekCodePoint(0)===LEFT_PARENTHESIS?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===LEFT_PARENTHESIS?(this.consumeCodePoint(),{type:TokenType.FUNCTION_TOKEN,value:e}):{type:TokenType.IDENT_TOKEN,value:e}},t.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===EOF)return{type:TokenType.URL_TOKEN,value:""};var t=this.peekCodePoint(0);if(t===APOSTROPHE||t===QUOTATION_MARK){t=this.consumeStringToken(this.consumeCodePoint());return t.type===TokenType.STRING_TOKEN&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===EOF||this.peekCodePoint(0)===RIGHT_PARENTHESIS)?(this.consumeCodePoint(),{type:TokenType.URL_TOKEN,value:t.value}):(this.consumeBadUrlRemnants(),BAD_URL_TOKEN)}for(;;){var r=this.consumeCodePoint();if(r===EOF||r===RIGHT_PARENTHESIS)return{type:TokenType.URL_TOKEN,value:fromCodePoint.apply(void 0,e)};if(isWhiteSpace(r))return this.consumeWhiteSpace(),this.peekCodePoint(0)===EOF||this.peekCodePoint(0)===RIGHT_PARENTHESIS?(this.consumeCodePoint(),{type:TokenType.URL_TOKEN,value:fromCodePoint.apply(void 0,e)}):(this.consumeBadUrlRemnants(),BAD_URL_TOKEN);if(r===QUOTATION_MARK||r===APOSTROPHE||r===LEFT_PARENTHESIS||isNonPrintableCodePoint(r))return this.consumeBadUrlRemnants(),BAD_URL_TOKEN;if(r===REVERSE_SOLIDUS){if(!isValidEscape(r,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),BAD_URL_TOKEN;e.push(this.consumeEscapedCodePoint())}else e.push(r)}},t.prototype.consumeWhiteSpace=function(){for(;isWhiteSpace(this.peekCodePoint(0));)this.consumeCodePoint()},t.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(e===RIGHT_PARENTHESIS||e===EOF)return;isValidEscape(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},t.prototype.consumeStringSlice=function(e){for(var t="";0<e;){var r=Math.min(6e4,e);t+=fromCodePoint.apply(void 0,this._value.splice(0,r)),e-=r}return this._value.shift(),t},t.prototype.consumeStringToken=function(e){for(var t="",r=0;;){var n,i=this._value[r];if(i===EOF||void 0===i||i===e)return t+=this.consumeStringSlice(r),{type:TokenType.STRING_TOKEN,value:t};if(i===LINE_FEED)return this._value.splice(0,r),BAD_STRING_TOKEN;i!==REVERSE_SOLIDUS||(n=this._value[r+1])!==EOF&&void 0!==n&&(n===LINE_FEED?(t+=this.consumeStringSlice(r),r=-1,this._value.shift()):isValidEscape(i,n)&&(t+=this.consumeStringSlice(r),t+=fromCodePoint(this.consumeEscapedCodePoint()),r=-1)),r++}},t.prototype.consumeNumber=function(){var t=[],r=FLAG_INTEGER;for((n=this.peekCodePoint(0))!==PLUS_SIGN&&n!==HYPHEN_MINUS||t.push(this.consumeCodePoint());isDigit(this.peekCodePoint(0));)t.push(this.consumeCodePoint());var n=this.peekCodePoint(0),i=this.peekCodePoint(1);if(n===FULL_STOP&&isDigit(i))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),r=FLAG_NUMBER;isDigit(this.peekCodePoint(0));)t.push(this.consumeCodePoint());n=this.peekCodePoint(0);var i=this.peekCodePoint(1),o=this.peekCodePoint(2);if((n===E||n===e)&&((i===PLUS_SIGN||i===HYPHEN_MINUS)&&isDigit(o)||isDigit(i)))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),r=FLAG_NUMBER;isDigit(this.peekCodePoint(0));)t.push(this.consumeCodePoint());return[stringToNumber(t),r]},t.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],r=e[1],n=this.peekCodePoint(0),i=this.peekCodePoint(1),e=this.peekCodePoint(2);if(isIdentifierStart(n,i,e)){e=this.consumeName();return{type:TokenType.DIMENSION_TOKEN,number:t,flags:r,unit:e}}return n===PERCENTAGE_SIGN?(this.consumeCodePoint(),{type:TokenType.PERCENTAGE_TOKEN,number:t,flags:r}):{type:TokenType.NUMBER_TOKEN,number:t,flags:r}},t.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(isHex(e)){for(var t=fromCodePoint(e);isHex(this.peekCodePoint(0))&&t.length<6;)t+=fromCodePoint(this.consumeCodePoint());isWhiteSpace(this.peekCodePoint(0))&&this.consumeCodePoint();var r=parseInt(t,16);return 0===r||isSurrogateCodePoint(r)||1114111<r?REPLACEMENT_CHARACTER:r}return e===EOF?REPLACEMENT_CHARACTER:e},t.prototype.consumeName=function(){for(var e="";;){var t=this.consumeCodePoint();if(isNameCodePoint(t))e+=fromCodePoint(t);else{if(!isValidEscape(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),e;e+=fromCodePoint(this.consumeEscapedCodePoint())}}},t}(),Parser=function(){function r(e){this._tokens=e}return r.create=function(e){var t=new Tokenizer;return t.write(e),new r(t.read())},r.parseValue=function(e){return r.create(e).parseComponentValue()},r.parseValues=function(e){return r.create(e).parseComponentValues()},r.prototype.parseComponentValue=function(){for(var e=this.consumeToken();e.type===TokenType.WHITESPACE_TOKEN;)e=this.consumeToken();if(e.type===TokenType.EOF_TOKEN)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);for(var t=this.consumeComponentValue();(e=this.consumeToken()).type===TokenType.WHITESPACE_TOKEN;);if(e.type===TokenType.EOF_TOKEN)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},r.prototype.parseComponentValues=function(){for(var e=[];;){var t=this.consumeComponentValue();if(t.type===TokenType.EOF_TOKEN)return e;e.push(t),e.push()}},r.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case TokenType.LEFT_CURLY_BRACKET_TOKEN:case TokenType.LEFT_SQUARE_BRACKET_TOKEN:case TokenType.LEFT_PARENTHESIS_TOKEN:return this.consumeSimpleBlock(e.type);case TokenType.FUNCTION_TOKEN:return this.consumeFunction(e)}return e},r.prototype.consumeSimpleBlock=function(e){for(var t={type:e,values:[]},r=this.consumeToken();;){if(r.type===TokenType.EOF_TOKEN||isEndingTokenFor(r,e))return t;this.reconsumeToken(r),t.values.push(this.consumeComponentValue()),r=this.consumeToken()}},r.prototype.consumeFunction=function(e){for(var t={name:e.value,values:[],type:TokenType.FUNCTION};;){var r=this.consumeToken();if(r.type===TokenType.EOF_TOKEN||r.type===TokenType.RIGHT_PARENTHESIS_TOKEN)return t;this.reconsumeToken(r),t.values.push(this.consumeComponentValue())}},r.prototype.consumeToken=function(){var e=this._tokens.shift();return void 0===e?EOF_TOKEN:e},r.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},r}(),isDimensionToken=function(e){return e.type===TokenType.DIMENSION_TOKEN},isNumberToken=function(e){return e.type===TokenType.NUMBER_TOKEN},isIdentToken=function(e){return e.type===TokenType.IDENT_TOKEN},isStringToken=function(e){return e.type===TokenType.STRING_TOKEN},isIdentWithValue=function(e,t){return isIdentToken(e)&&e.value===t},nonWhiteSpace=function(e){return e.type!==TokenType.WHITESPACE_TOKEN},nonFunctionArgSeparator=function(e){return e.type!==TokenType.WHITESPACE_TOKEN&&e.type!==TokenType.COMMA_TOKEN},parseFunctionArgs=function(e){var t=[],r=[];return e.forEach(function(e){if(e.type===TokenType.COMMA_TOKEN){if(0===r.length)throw new Error("Error parsing function args, zero tokens for arg");return t.push(r),void(r=[])}e.type!==TokenType.WHITESPACE_TOKEN&&r.push(e)}),r.length&&t.push(r),t},isEndingTokenFor=function(e,t){return t===TokenType.LEFT_CURLY_BRACKET_TOKEN&&e.type===TokenType.RIGHT_CURLY_BRACKET_TOKEN||(t===TokenType.LEFT_SQUARE_BRACKET_TOKEN&&e.type===TokenType.RIGHT_SQUARE_BRACKET_TOKEN||t===TokenType.LEFT_PARENTHESIS_TOKEN&&e.type===TokenType.RIGHT_PARENTHESIS_TOKEN)},isLength=function(e){return e.type===TokenType.NUMBER_TOKEN||e.type===TokenType.DIMENSION_TOKEN},isLengthPercentage=function(e){return e.type===TokenType.PERCENTAGE_TOKEN||isLength(e)},parseLengthPercentageTuple=function(e){return 1<e.length?[e[0],e[1]]:[e[0]]},ZERO_LENGTH={type:TokenType.NUMBER_TOKEN,number:0,flags:FLAG_INTEGER},FIFTY_PERCENT={type:TokenType.PERCENTAGE_TOKEN,number:50,flags:FLAG_INTEGER},HUNDRED_PERCENT={type:TokenType.PERCENTAGE_TOKEN,number:100,flags:FLAG_INTEGER},getAbsoluteValueForTuple=function(e,t,r){var n=e[0],e=e[1];return[getAbsoluteValue(n,t),getAbsoluteValue(void 0!==e?e:n,r)]},getAbsoluteValue=function(e,t){if(e.type===TokenType.PERCENTAGE_TOKEN)return e.number/100*t;if(isDimensionToken(e))switch(e.unit){case"rem":case"em":return 16*e.number;default:return e.number}return e.number},DEG="deg",GRAD="grad",RAD="rad",TURN="turn",angle={name:"angle",parse:function(e){if(e.type===TokenType.DIMENSION_TOKEN)switch(e.unit){case DEG:return Math.PI*e.number/180;case GRAD:return Math.PI/200*e.number;case RAD:return e.number;case TURN:return 2*Math.PI*e.number}throw new Error("Unsupported angle type")}},isAngle=function(e){return e.type===TokenType.DIMENSION_TOKEN&&(e.unit===DEG||e.unit===GRAD||e.unit===RAD||e.unit===TURN)},parseNamedSide=function(e){switch(e.filter(isIdentToken).map(function(e){return e.value}).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return[ZERO_LENGTH,ZERO_LENGTH];case"to top":case"bottom":return deg(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[ZERO_LENGTH,HUNDRED_PERCENT];case"to right":case"left":return deg(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[HUNDRED_PERCENT,HUNDRED_PERCENT];case"to bottom":case"top":return deg(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[HUNDRED_PERCENT,ZERO_LENGTH];case"to left":case"right":return deg(270)}return 0},deg=function(e){return Math.PI*e/180},color={name:"color",parse:function(e){if(e.type===TokenType.FUNCTION){var t=SUPPORTED_COLOR_FUNCTIONS[e.name];if(void 0===t)throw new Error('Attempting to parse an unsupported color function "'+e.name+'"');return t(e.values)}if(e.type===TokenType.HASH_TOKEN){if(3===e.value.length){var r=e.value.substring(0,1),n=e.value.substring(1,2),i=e.value.substring(2,3);return pack(parseInt(r+r,16),parseInt(n+n,16),parseInt(i+i,16),1)}if(4===e.value.length){var r=e.value.substring(0,1),n=e.value.substring(1,2),i=e.value.substring(2,3),o=e.value.substring(3,4);return pack(parseInt(r+r,16),parseInt(n+n,16),parseInt(i+i,16),parseInt(o+o,16)/255)}if(6===e.value.length){r=e.value.substring(0,2),n=e.value.substring(2,4),i=e.value.substring(4,6);return pack(parseInt(r,16),parseInt(n,16),parseInt(i,16),1)}if(8===e.value.length){r=e.value.substring(0,2),n=e.value.substring(2,4),i=e.value.substring(4,6),o=e.value.substring(6,8);return pack(parseInt(r,16),parseInt(n,16),parseInt(i,16),parseInt(o,16)/255)}}if(e.type===TokenType.IDENT_TOKEN){e=COLORS[e.value.toUpperCase()];if(void 0!==e)return e}return COLORS.TRANSPARENT}},isTransparent=function(e){return 0==(255&e)},asString=function(e){var t=255&e,r=255&e>>8,n=255&e>>16,e=255&e>>24;return t<255?"rgba("+e+","+n+","+r+","+t/255+")":"rgb("+e+","+n+","+r+")"},pack=function(e,t,r,n){return(e<<24|t<<16|r<<8|Math.round(255*n)<<0)>>>0},getTokenColorValue=function(e,t){if(e.type===TokenType.NUMBER_TOKEN)return e.number;if(e.type!==TokenType.PERCENTAGE_TOKEN)return 0;var r=3===t?1:255;return 3===t?e.number/100*r:Math.round(e.number/100*r)},rgb=function(e){e=e.filter(nonFunctionArgSeparator);if(3===e.length){var t=e.map(getTokenColorValue),r=t[0],n=t[1],t=t[2];return pack(r,n,t,1)}if(4!==e.length)return 0;e=e.map(getTokenColorValue),r=e[0],n=e[1],t=e[2],e=e[3];return pack(r,n,t,e)};function hue2rgb$1(e,t,r){return r<0&&(r+=1),1<=r&&--r,r<1/6?(t-e)*r*6+e:r<.5?t:r<2/3?6*(t-e)*(2/3-r)+e:e}var PropertyDescriptorParsingType,BACKGROUND_CLIP,hsl=function(e){var t=e.filter(nonFunctionArgSeparator),r=t[0],n=t[1],i=t[2],o=t[3],e=(r.type===TokenType.NUMBER_TOKEN?deg(r.number):angle.parse(r))/(2*Math.PI),t=isLengthPercentage(n)?n.number/100:0,r=isLengthPercentage(i)?i.number/100:0,n=void 0!==o&&isLengthPercentage(o)?getAbsoluteValue(o,1):1;if(0==t)return pack(255*r,255*r,255*r,1);i=r<=.5?r*(1+t):r+t-r*t,o=2*r-i,t=hue2rgb$1(o,i,e+1/3),r=hue2rgb$1(o,i,e),e=hue2rgb$1(o,i,e-1/3);return pack(255*t,255*r,255*e,n)},SUPPORTED_COLOR_FUNCTIONS={hsl:hsl,hsla:hsl,rgb:rgb,rgba:rgb},COLORS={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199};!function(e){e[e.VALUE=0]="VALUE",e[e.LIST=1]="LIST",e[e.IDENT_VALUE=2]="IDENT_VALUE",e[e.TYPE_VALUE=3]="TYPE_VALUE",e[e.TOKEN_VALUE=4]="TOKEN_VALUE"}(PropertyDescriptorParsingType=PropertyDescriptorParsingType||{}),function(e){e[e.BORDER_BOX=0]="BORDER_BOX",e[e.PADDING_BOX=1]="PADDING_BOX",e[e.CONTENT_BOX=2]="CONTENT_BOX"}(BACKGROUND_CLIP=BACKGROUND_CLIP||{});var CSSImageType,backgroundClip={name:"background-clip",initialValue:"border-box",prefix:!1,type:PropertyDescriptorParsingType.LIST,parse:function(e){return e.map(function(e){if(isIdentToken(e))switch(e.value){case"padding-box":return BACKGROUND_CLIP.PADDING_BOX;case"content-box":return BACKGROUND_CLIP.CONTENT_BOX}return BACKGROUND_CLIP.BORDER_BOX})}},backgroundColor={name:"background-color",initialValue:"transparent",prefix:!1,type:PropertyDescriptorParsingType.TYPE_VALUE,format:"color"},parseColorStop=function(e){var t=color.parse(e[0]),e=e[1];return e&&isLengthPercentage(e)?{color:t,stop:e}:{color:t,stop:null}},processColorStops=function(e,r){var t=e[0],n=e[e.length-1];null===t.stop&&(t.stop=ZERO_LENGTH),null===n.stop&&(n.stop=HUNDRED_PERCENT);for(var i=[],o=0,a=0;a<e.length;a++){var s=e[a].stop;null!==s?(o<(s=getAbsoluteValue(s,r))?i.push(s):i.push(o),o=s):i.push(null)}for(var l=null,a=0;a<i.length;a++){var c=i[a];if(null===c)null===l&&(l=a);else if(null!==l){for(var h=a-l,u=(c-i[l-1])/(1+h),A=1;A<=h;A++)i[l+A-1]=u*A;l=null}}return e.map(function(e,t){return{color:e.color,stop:Math.max(Math.min(1,i[t]/r),0)}})},getAngleFromCorner=function(e,t,r){var n=t/2,i=r/2,n=getAbsoluteValue(e[0],t)-n,r=i-getAbsoluteValue(e[1],r);return(Math.atan2(r,n)+2*Math.PI)%(2*Math.PI)},calculateGradientDirection=function(e,t,r){var n="number"==typeof e?e:getAngleFromCorner(e,t,r),i=Math.abs(t*Math.sin(n))+Math.abs(r*Math.cos(n)),o=t/2,e=r/2,t=i/2,r=Math.sin(n-Math.PI/2)*t,t=Math.cos(n-Math.PI/2)*t;return[i,o-t,o+t,e-r,e+r]},distance=function(e,t){return Math.sqrt(e*e+t*t)},findCorner=function(e,t,i,o,a){return[[0,0],[0,t],[e,0],[e,t]].reduce(function(e,t){var r=t[0],n=t[1],n=distance(i-r,o-n);return(a?n<e.optimumDistance:n>e.optimumDistance)?{optimumCorner:t,optimumDistance:n}:e},{optimumDistance:a?1/0:-1/0,optimumCorner:null}).optimumCorner},calculateRadius=function(e,t,r,n,i){var o,a,s,l,c=0,h=0;switch(e.size){case CSSRadialExtent.CLOSEST_SIDE:e.shape===CSSRadialShape.CIRCLE?c=h=Math.min(Math.abs(t),Math.abs(t-n),Math.abs(r),Math.abs(r-i)):e.shape===CSSRadialShape.ELLIPSE&&(c=Math.min(Math.abs(t),Math.abs(t-n)),h=Math.min(Math.abs(r),Math.abs(r-i)));break;case CSSRadialExtent.CLOSEST_CORNER:e.shape===CSSRadialShape.CIRCLE?c=h=Math.min(distance(t,r),distance(t,r-i),distance(t-n,r),distance(t-n,r-i)):e.shape===CSSRadialShape.ELLIPSE&&(o=Math.min(Math.abs(r),Math.abs(r-i))/Math.min(Math.abs(t),Math.abs(t-n)),s=(a=findCorner(n,i,t,r,!0))[0],l=a[1],h=o*(c=distance(s-t,(l-r)/o)));break;case CSSRadialExtent.FARTHEST_SIDE:e.shape===CSSRadialShape.CIRCLE?c=h=Math.max(Math.abs(t),Math.abs(t-n),Math.abs(r),Math.abs(r-i)):e.shape===CSSRadialShape.ELLIPSE&&(c=Math.max(Math.abs(t),Math.abs(t-n)),h=Math.max(Math.abs(r),Math.abs(r-i)));break;case CSSRadialExtent.FARTHEST_CORNER:e.shape===CSSRadialShape.CIRCLE?c=h=Math.max(distance(t,r),distance(t,r-i),distance(t-n,r),distance(t-n,r-i)):e.shape===CSSRadialShape.ELLIPSE&&(o=Math.max(Math.abs(r),Math.abs(r-i))/Math.max(Math.abs(t),Math.abs(t-n)),s=(a=findCorner(n,i,t,r,!1))[0],l=a[1],h=o*(c=distance(s-t,(l-r)/o)))}return Array.isArray(e.size)&&(c=getAbsoluteValue(e.size[0],n),h=2===e.size.length?getAbsoluteValue(e.size[1],i):c),[c,h]},linearGradient=function(e){var r=deg(180),n=[];return parseFunctionArgs(e).forEach(function(e,t){if(0===t){t=e[0];if(t.type===TokenType.IDENT_TOKEN&&"to"===t.value)return void(r=parseNamedSide(e));if(isAngle(t))return void(r=angle.parse(t))}e=parseColorStop(e);n.push(e)}),{angle:r,stops:n,type:CSSImageType.LINEAR_GRADIENT}},prefixLinearGradient=function(e){var r=deg(180),n=[];return parseFunctionArgs(e).forEach(function(e,t){if(0===t){t=e[0];if(t.type===TokenType.IDENT_TOKEN&&-1!==["top","left","right","bottom"].indexOf(t.value))return void(r=parseNamedSide(e));if(isAngle(t))return void(r=(angle.parse(t)+deg(270))%deg(360))}e=parseColorStop(e);n.push(e)}),{angle:r,stops:n,type:CSSImageType.LINEAR_GRADIENT}},testRangeBounds=function(e){if(e.createRange){var t=e.createRange();if(t.getBoundingClientRect){var r=e.createElement("boundtest");r.style.height="123px",r.style.display="block",e.body.appendChild(r),t.selectNode(r);t=t.getBoundingClientRect(),t=Math.round(t.height);if(e.body.removeChild(r),123===t)return!0}}return!1},testCORS=function(){return void 0!==(new Image).crossOrigin},testResponseType=function(){return"string"==typeof(new XMLHttpRequest).responseType},testSVG=function(e){var t=new Image,r=e.createElement("canvas"),e=r.getContext("2d");if(!e)return!1;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{e.drawImage(t,0,0),r.toDataURL()}catch(e){return!1}return!0},isGreenPixel=function(e){return 0===e[0]&&255===e[1]&&0===e[2]&&255===e[3]},testForeignObject=function(r){var e=r.createElement("canvas");e.width=100,e.height=100;var n=e.getContext("2d");if(!n)return Promise.reject(!1);n.fillStyle="rgb(0, 255, 0)",n.fillRect(0,0,100,100);var t=new Image,i=e.toDataURL();t.src=i;t=createForeignObjectSVG(100,100,0,0,t);return n.fillStyle="red",n.fillRect(0,0,100,100),loadSerializedSVG(t).then(function(e){n.drawImage(e,0,0);var t=n.getImageData(0,0,100,100).data;n.fillStyle="red",n.fillRect(0,0,100,100);e=r.createElement("div");return e.style.backgroundImage="url("+i+")",e.style.height="100px",isGreenPixel(t)?loadSerializedSVG(createForeignObjectSVG(100,100,0,0,e)):Promise.reject(!1)}).then(function(e){return n.drawImage(e,0,0),isGreenPixel(n.getImageData(0,0,100,100).data)}).catch(function(){return!1})},createForeignObjectSVG=function(e,t,r,n,i){var o="http://www.w3.org/2000/svg",a=document.createElementNS(o,"svg"),o=document.createElementNS(o,"foreignObject");return a.setAttributeNS(null,"width",e.toString()),a.setAttributeNS(null,"height",t.toString()),o.setAttributeNS(null,"width","100%"),o.setAttributeNS(null,"height","100%"),o.setAttributeNS(null,"x",r.toString()),o.setAttributeNS(null,"y",n.toString()),o.setAttributeNS(null,"externalResourcesRequired","true"),a.appendChild(o),o.appendChild(i),a},loadSerializedSVG=function(n){return new Promise(function(e,t){var r=new Image;r.onload=function(){return e(r)},r.onerror=t,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(n))})},FEATURES={get SUPPORT_RANGE_BOUNDS(){var e=testRangeBounds(document);return Object.defineProperty(FEATURES,"SUPPORT_RANGE_BOUNDS",{value:e}),e},get SUPPORT_SVG_DRAWING(){var e=testSVG(document);return Object.defineProperty(FEATURES,"SUPPORT_SVG_DRAWING",{value:e}),e},get SUPPORT_FOREIGNOBJECT_DRAWING(){var e="function"==typeof Array.from&&"function"==typeof window.fetch?testForeignObject(document):Promise.resolve(!1);return Object.defineProperty(FEATURES,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:e}),e},get SUPPORT_CORS_IMAGES(){var e=testCORS();return Object.defineProperty(FEATURES,"SUPPORT_CORS_IMAGES",{value:e}),e},get SUPPORT_RESPONSE_TYPE(){var e=testResponseType();return Object.defineProperty(FEATURES,"SUPPORT_RESPONSE_TYPE",{value:e}),e},get SUPPORT_CORS_XHR(){var e="withCredentials"in new XMLHttpRequest;return Object.defineProperty(FEATURES,"SUPPORT_CORS_XHR",{value:e}),e}},Logger$1=function(){function r(e){var t=e.id,e=e.enabled;this.id=t,this.enabled=e,this.start=Date.now()}return r.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.debug?console.debug.apply(console,[this.id,this.getTime()+"ms"].concat(e)):this.info.apply(this,e))},r.prototype.getTime=function(){return Date.now()-this.start},r.create=function(e){r.instances[e.id]=new r(e)},r.destroy=function(e){delete r.instances[e]},r.getInstance=function(e){var t=r.instances[e];if(void 0===t)throw new Error("No logger instance found with id "+e);return t},r.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&"undefined"!=typeof window&&window.console&&"function"==typeof console.info&&console.info.apply(console,[this.id,this.getTime()+"ms"].concat(e))},r.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.error?console.error.apply(console,[this.id,this.getTime()+"ms"].concat(e)):this.info.apply(this,e))},r.instances={},r}(),CacheStorage=function(){function r(){}return r.create=function(e,t){return r._caches[e]=new Cache$1(e,t)},r.destroy=function(e){delete r._caches[e]},r.open=function(e){var t=r._caches[e];if(void 0!==t)return t;throw new Error('Cache with key "'+e+'" not found')},r.getOrigin=function(e){var t=r._link;return t?(t.href=e,t.href=t.href,t.protocol+t.hostname+t.port):"about:blank"},r.isSameOrigin=function(e){return r.getOrigin(e)===r._origin},r.setContext=function(e){r._link=e.document.createElement("a"),r._origin=r.getOrigin(e.location.href)},r.getInstance=function(){var e=r._current;if(null===e)throw new Error("No cache instance attached");return e},r.attachInstance=function(e){r._current=e},r.detachInstance=function(){r._current=null},r._caches={},r._origin="about:blank",r._current=null,r}(),Cache$1=function(){function e(e,t){this.id=e,this._options=t,this._cache={}}return e.prototype.addImage=function(e){var t=Promise.resolve();return this.has(e)||(isBlobImage(e)||isRenderable(e))&&(this._cache[e]=this.loadImage(e)),t},e.prototype.match=function(e){return this._cache[e]},e.prototype.loadImage=function(a){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o=this;return __generator(this,function(e){switch(e.label){case 0:return(t=CacheStorage.isSameOrigin(a),n=!isInlineImage(a)&&!0===this._options.useCORS&&FEATURES.SUPPORT_CORS_IMAGES&&!t,r=!isInlineImage(a)&&!t&&"string"==typeof this._options.proxy&&FEATURES.SUPPORT_CORS_XHR&&!n,t||!1!==this._options.allowTaint||isInlineImage(a)||r||n)?(i=a,r?[4,this.proxy(i)]:[3,2]):[2];case 1:i=e.sent(),e.label=2;case 2:return Logger$1.getInstance(this.id).debug("Added image "+a.substring(0,256)),[4,new Promise(function(e,t){var r=new Image;r.onload=function(){return e(r)},r.onerror=t,(isInlineBase64Image(i)||n)&&(r.crossOrigin="anonymous"),r.src=i,!0===r.complete&&setTimeout(function(){return e(r)},500),0<o._options.imageTimeout&&setTimeout(function(){return t("Timed out ("+o._options.imageTimeout+"ms) loading image")},o._options.imageTimeout)})];case 3:return[2,e.sent()]}})})},e.prototype.has=function(e){return void 0!==this._cache[e]},e.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},e.prototype.proxy=function(o){var a=this,s=this._options.proxy;if(!s)throw new Error("No proxy defined");var l=o.substring(0,256);return new Promise(function(t,r){var e,n=FEATURES.SUPPORT_RESPONSE_TYPE?"blob":"text",i=new XMLHttpRequest;i.onload=function(){var e;200===i.status?"text"==n?t(i.response):((e=new FileReader).addEventListener("load",function(){return t(e.result)},!1),e.addEventListener("error",function(e){return r(e)},!1),e.readAsDataURL(i.response)):r("Failed to proxy resource "+l+" with status code "+i.status)},i.onerror=r,i.open("GET",s+"?url="+encodeURIComponent(o)+"&responseType="+n),"text"!=n&&i instanceof XMLHttpRequest&&(i.responseType=n),a._options.imageTimeout&&(e=a._options.imageTimeout,i.timeout=e,i.ontimeout=function(){return r("Timed out ("+e+"ms) proxying "+l)}),i.send()})},e}(),INLINE_SVG=/^data:image\/svg\+xml/i,INLINE_BASE64=/^data:image\/.*;base64,/i,INLINE_IMG=/^data:image\/.*/i,isRenderable=function(e){return FEATURES.SUPPORT_SVG_DRAWING||!isSVG(e)},isInlineImage=function(e){return INLINE_IMG.test(e)},isInlineBase64Image=function(e){return INLINE_BASE64.test(e)},isBlobImage=function(e){return"blob"===e.substr(0,4)},isSVG=function(e){return"svg"===e.substr(-3).toLowerCase()||INLINE_SVG.test(e)},webkitGradient=function(e){var t=deg(180),n=[],i=CSSImageType.LINEAR_GRADIENT,r=CSSRadialShape.CIRCLE,o=CSSRadialExtent.FARTHEST_CORNER;return parseFunctionArgs(e).forEach(function(e,t){var r,e=e[0];if(0===t){if(isIdentToken(e)&&"linear"===e.value)return void(i=CSSImageType.LINEAR_GRADIENT);if(isIdentToken(e)&&"radial"===e.value)return void(i=CSSImageType.RADIAL_GRADIENT)}e.type===TokenType.FUNCTION&&("from"===e.name?(r=color.parse(e.values[0]),n.push({stop:ZERO_LENGTH,color:r})):"to"===e.name?(r=color.parse(e.values[0]),n.push({stop:HUNDRED_PERCENT,color:r})):"color-stop"!==e.name||2===(e=e.values.filter(nonFunctionArgSeparator)).length&&(r=color.parse(e[1]),e=e[0],isNumberToken(e)&&n.push({stop:{type:TokenType.PERCENTAGE_TOKEN,number:100*e.number,flags:e.flags},color:r})))}),i===CSSImageType.LINEAR_GRADIENT?{angle:(t+deg(180))%deg(360),stops:n,type:i}:{size:o,shape:r,stops:n,position:[],type:i}},CLOSEST_SIDE="closest-side",FARTHEST_SIDE="farthest-side",CLOSEST_CORNER="closest-corner",FARTHEST_CORNER="farthest-corner",CIRCLE="circle",ELLIPSE="ellipse",COVER="cover",CONTAIN="contain",radialGradient=function(e){var i=CSSRadialShape.CIRCLE,o=CSSRadialExtent.FARTHEST_CORNER,a=[],s=[];return parseFunctionArgs(e).forEach(function(e,t){var r,n=!0;0===t&&(r=!1,n=e.reduce(function(e,t){if(r)if(isIdentToken(t))switch(t.value){case"center":return s.push(FIFTY_PERCENT),e;case"top":case"left":return s.push(ZERO_LENGTH),e;case"right":case"bottom":return s.push(HUNDRED_PERCENT),e}else(isLengthPercentage(t)||isLength(t))&&s.push(t);else if(isIdentToken(t))switch(t.value){case CIRCLE:return i=CSSRadialShape.CIRCLE,!1;case ELLIPSE:return i=CSSRadialShape.ELLIPSE,!1;case"at":return!(r=!0);case CLOSEST_SIDE:return o=CSSRadialExtent.CLOSEST_SIDE,!1;case COVER:case FARTHEST_SIDE:return o=CSSRadialExtent.FARTHEST_SIDE,!1;case CONTAIN:case CLOSEST_CORNER:return o=CSSRadialExtent.CLOSEST_CORNER,!1;case FARTHEST_CORNER:return o=CSSRadialExtent.FARTHEST_CORNER,!1}else if(isLength(t)||isLengthPercentage(t))return(o=!Array.isArray(o)?[]:o).push(t),!1;return e},n)),n&&(e=parseColorStop(e),a.push(e))}),{size:o,shape:i,stops:a,position:s,type:CSSImageType.RADIAL_GRADIENT}},prefixRadialGradient=function(e){var n=CSSRadialShape.CIRCLE,i=CSSRadialExtent.FARTHEST_CORNER,o=[],a=[];return parseFunctionArgs(e).forEach(function(e,t){var r=!0;0===t?r=e.reduce(function(e,t){if(isIdentToken(t))switch(t.value){case"center":return a.push(FIFTY_PERCENT),!1;case"top":case"left":return a.push(ZERO_LENGTH),!1;case"right":case"bottom":return a.push(HUNDRED_PERCENT),!1}else if(isLengthPercentage(t)||isLength(t))return a.push(t),!1;return e},r):1===t&&(r=e.reduce(function(e,t){if(isIdentToken(t))switch(t.value){case CIRCLE:return n=CSSRadialShape.CIRCLE,!1;case ELLIPSE:return n=CSSRadialShape.ELLIPSE,!1;case CONTAIN:case CLOSEST_SIDE:return i=CSSRadialExtent.CLOSEST_SIDE,!1;case FARTHEST_SIDE:return i=CSSRadialExtent.FARTHEST_SIDE,!1;case CLOSEST_CORNER:return i=CSSRadialExtent.CLOSEST_CORNER,!1;case COVER:case FARTHEST_CORNER:return i=CSSRadialExtent.FARTHEST_CORNER,!1}else if(isLength(t)||isLengthPercentage(t))return(i=!Array.isArray(i)?[]:i).push(t),!1;return e},r)),r&&(e=parseColorStop(e),o.push(e))}),{size:i,shape:n,stops:o,position:a,type:CSSImageType.RADIAL_GRADIENT}};!function(e){e[e.URL=0]="URL",e[e.LINEAR_GRADIENT=1]="LINEAR_GRADIENT",e[e.RADIAL_GRADIENT=2]="RADIAL_GRADIENT"}(CSSImageType=CSSImageType||{});var CSSRadialShape,CSSRadialExtent,isLinearGradient=function(e){return e.type===CSSImageType.LINEAR_GRADIENT},isRadialGradient=function(e){return e.type===CSSImageType.RADIAL_GRADIENT};!function(e){e[e.CIRCLE=0]="CIRCLE",e[e.ELLIPSE=1]="ELLIPSE"}(CSSRadialShape=CSSRadialShape||{}),function(e){e[e.CLOSEST_SIDE=0]="CLOSEST_SIDE",e[e.FARTHEST_SIDE=1]="FARTHEST_SIDE",e[e.CLOSEST_CORNER=2]="CLOSEST_CORNER",e[e.FARTHEST_CORNER=3]="FARTHEST_CORNER"}(CSSRadialExtent=CSSRadialExtent||{});var image={name:"image",parse:function(e){if(e.type===TokenType.URL_TOKEN){var t={url:e.value,type:CSSImageType.URL};return CacheStorage.getInstance().addImage(e.value),t}if(e.type!==TokenType.FUNCTION)throw new Error("Unsupported image type");t=SUPPORTED_IMAGE_FUNCTIONS[e.name];if(void 0===t)throw new Error('Attempting to parse an unsupported image function "'+e.name+'"');return t(e.values)}};function isSupportedImage(e){return e.type!==TokenType.FUNCTION||SUPPORTED_IMAGE_FUNCTIONS[e.name]}var BACKGROUND_REPEAT,SUPPORTED_IMAGE_FUNCTIONS={"linear-gradient":linearGradient,"-moz-linear-gradient":prefixLinearGradient,"-ms-linear-gradient":prefixLinearGradient,"-o-linear-gradient":prefixLinearGradient,"-webkit-linear-gradient":prefixLinearGradient,"radial-gradient":radialGradient,"-moz-radial-gradient":prefixRadialGradient,"-ms-radial-gradient":prefixRadialGradient,"-o-radial-gradient":prefixRadialGradient,"-webkit-radial-gradient":prefixRadialGradient,"-webkit-gradient":webkitGradient},backgroundImage={name:"background-image",initialValue:"none",type:PropertyDescriptorParsingType.LIST,prefix:!1,parse:function(e){if(0===e.length)return[];var t=e[0];return t.type===TokenType.IDENT_TOKEN&&"none"===t.value?[]:e.filter(function(e){return nonFunctionArgSeparator(e)&&isSupportedImage(e)}).map(image.parse)}},backgroundOrigin={name:"background-origin",initialValue:"border-box",prefix:!1,type:PropertyDescriptorParsingType.LIST,parse:function(e){return e.map(function(e){if(isIdentToken(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},backgroundPosition={name:"background-position",initialValue:"0% 0%",type:PropertyDescriptorParsingType.LIST,prefix:!1,parse:function(e){return parseFunctionArgs(e).map(function(e){return e.filter(isLengthPercentage)}).map(parseLengthPercentageTuple)}};!function(e){e[e.REPEAT=0]="REPEAT",e[e.NO_REPEAT=1]="NO_REPEAT",e[e.REPEAT_X=2]="REPEAT_X",e[e.REPEAT_Y=3]="REPEAT_Y"}(BACKGROUND_REPEAT=BACKGROUND_REPEAT||{});var BACKGROUND_SIZE,backgroundRepeat={name:"background-repeat",initialValue:"repeat",prefix:!1,type:PropertyDescriptorParsingType.LIST,parse:function(e){return parseFunctionArgs(e).map(function(e){return e.filter(isIdentToken).map(function(e){return e.value}).join(" ")}).map(parseBackgroundRepeat)}},parseBackgroundRepeat=function(e){switch(e){case"no-repeat":return BACKGROUND_REPEAT.NO_REPEAT;case"repeat-x":case"repeat no-repeat":return BACKGROUND_REPEAT.REPEAT_X;case"repeat-y":case"no-repeat repeat":return BACKGROUND_REPEAT.REPEAT_Y;default:return BACKGROUND_REPEAT.REPEAT}};!function(e){e.AUTO="auto",e.CONTAIN="contain",e.COVER="cover"}(BACKGROUND_SIZE=BACKGROUND_SIZE||{});var BORDER_STYLE,backgroundSize={name:"background-size",initialValue:"0",prefix:!1,type:PropertyDescriptorParsingType.LIST,parse:function(e){return parseFunctionArgs(e).map(function(e){return e.filter(isBackgroundSizeInfoToken)})}},isBackgroundSizeInfoToken=function(e){return isIdentToken(e)||isLengthPercentage(e)},borderColorForSide=function(e){return{name:"border-"+e+"-color",initialValue:"transparent",prefix:!1,type:PropertyDescriptorParsingType.TYPE_VALUE,format:"color"}},borderTopColor=borderColorForSide("top"),borderRightColor=borderColorForSide("right"),borderBottomColor=borderColorForSide("bottom"),borderLeftColor=borderColorForSide("left"),borderRadiusForSide=function(e){return{name:"border-radius-"+e,initialValue:"0 0",prefix:!1,type:PropertyDescriptorParsingType.LIST,parse:function(e){return parseLengthPercentageTuple(e.filter(isLengthPercentage))}}},borderTopLeftRadius=borderRadiusForSide("top-left"),borderTopRightRadius=borderRadiusForSide("top-right"),borderBottomRightRadius=borderRadiusForSide("bottom-right"),borderBottomLeftRadius=borderRadiusForSide("bottom-left");!function(e){e[e.NONE=0]="NONE",e[e.SOLID=1]="SOLID"}(BORDER_STYLE=BORDER_STYLE||{});var FLOAT,borderStyleForSide=function(e){return{name:"border-"+e+"-style",initialValue:"solid",prefix:!1,type:PropertyDescriptorParsingType.IDENT_VALUE,parse:function(e){return"none"===e?BORDER_STYLE.NONE:BORDER_STYLE.SOLID}}},borderTopStyle=borderStyleForSide("top"),borderRightStyle=borderStyleForSide("right"),borderBottomStyle=borderStyleForSide("bottom"),borderLeftStyle=borderStyleForSide("left"),borderWidthForSide=function(e){return{name:"border-"+e+"-width",initialValue:"0",type:PropertyDescriptorParsingType.VALUE,prefix:!1,parse:function(e){return isDimensionToken(e)?e.number:0}}},borderTopWidth=borderWidthForSide("top"),borderRightWidth=borderWidthForSide("right"),borderBottomWidth=borderWidthForSide("bottom"),borderLeftWidth=borderWidthForSide("left"),color$1={name:"color",initialValue:"transparent",prefix:!1,type:PropertyDescriptorParsingType.TYPE_VALUE,format:"color"},display={name:"display",initialValue:"inline-block",prefix:!1,type:PropertyDescriptorParsingType.LIST,parse:function(e){return e.filter(isIdentToken).reduce(function(e,t){return e|parseDisplayValue(t.value)},0)}},parseDisplayValue=function(e){switch(e){case"block":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0};!function(e){e[e.NONE=0]="NONE",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.INLINE_START=3]="INLINE_START",e[e.INLINE_END=4]="INLINE_END"}(FLOAT=FLOAT||{});var LINE_BREAK,float={name:"float",initialValue:"none",prefix:!1,type:PropertyDescriptorParsingType.IDENT_VALUE,parse:function(e){switch(e){case"left":return FLOAT.LEFT;case"right":return FLOAT.RIGHT;case"inline-start":return FLOAT.INLINE_START;case"inline-end":return FLOAT.INLINE_END}return FLOAT.NONE}},letterSpacing={name:"letter-spacing",initialValue:"0",prefix:!1,type:PropertyDescriptorParsingType.VALUE,parse:function(e){return!(e.type===TokenType.IDENT_TOKEN&&"normal"===e.value||e.type!==TokenType.NUMBER_TOKEN&&e.type!==TokenType.DIMENSION_TOKEN)?e.number:0}};!function(e){e.NORMAL="normal",e.STRICT="strict"}(LINE_BREAK=LINE_BREAK||{});var LIST_STYLE_POSITION,lineBreak={name:"line-break",initialValue:"normal",prefix:!1,type:PropertyDescriptorParsingType.IDENT_VALUE,parse:function(e){return"strict"!==e?LINE_BREAK.NORMAL:LINE_BREAK.STRICT}},lineHeight={name:"line-height",initialValue:"normal",prefix:!1,type:PropertyDescriptorParsingType.TOKEN_VALUE},computeLineHeight=function(e,t){return isIdentToken(e)&&"normal"===e.value?1.2*t:e.type===TokenType.NUMBER_TOKEN?t*e.number:isLengthPercentage(e)?getAbsoluteValue(e,t):t},listStyleImage={name:"list-style-image",initialValue:"none",type:PropertyDescriptorParsingType.VALUE,prefix:!1,parse:function(e){return e.type===TokenType.IDENT_TOKEN&&"none"===e.value?null:image.parse(e)}};!function(e){e[e.INSIDE=0]="INSIDE",e[e.OUTSIDE=1]="OUTSIDE"}(LIST_STYLE_POSITION=LIST_STYLE_POSITION||{});var LIST_STYLE_TYPE,listStylePosition={name:"list-style-position",initialValue:"outside",prefix:!1,type:PropertyDescriptorParsingType.IDENT_VALUE,parse:function(e){return"inside"!==e?LIST_STYLE_POSITION.OUTSIDE:LIST_STYLE_POSITION.INSIDE}};!function(e){e[e.NONE=-1]="NONE",e[e.DISC=0]="DISC",e[e.CIRCLE=1]="CIRCLE",e[e.SQUARE=2]="SQUARE",e[e.DECIMAL=3]="DECIMAL",e[e.CJK_DECIMAL=4]="CJK_DECIMAL",e[e.DECIMAL_LEADING_ZERO=5]="DECIMAL_LEADING_ZERO",e[e.LOWER_ROMAN=6]="LOWER_ROMAN",e[e.UPPER_ROMAN=7]="UPPER_ROMAN",e[e.LOWER_GREEK=8]="LOWER_GREEK",e[e.LOWER_ALPHA=9]="LOWER_ALPHA",e[e.UPPER_ALPHA=10]="UPPER_ALPHA",e[e.ARABIC_INDIC=11]="ARABIC_INDIC",e[e.ARMENIAN=12]="ARMENIAN",e[e.BENGALI=13]="BENGALI",e[e.CAMBODIAN=14]="CAMBODIAN",e[e.CJK_EARTHLY_BRANCH=15]="CJK_EARTHLY_BRANCH",e[e.CJK_HEAVENLY_STEM=16]="CJK_HEAVENLY_STEM",e[e.CJK_IDEOGRAPHIC=17]="CJK_IDEOGRAPHIC",e[e.DEVANAGARI=18]="DEVANAGARI",e[e.ETHIOPIC_NUMERIC=19]="ETHIOPIC_NUMERIC",e[e.GEORGIAN=20]="GEORGIAN",e[e.GUJARATI=21]="GUJARATI",e[e.GURMUKHI=22]="GURMUKHI",e[e.HEBREW=22]="HEBREW",e[e.HIRAGANA=23]="HIRAGANA",e[e.HIRAGANA_IROHA=24]="HIRAGANA_IROHA",e[e.JAPANESE_FORMAL=25]="JAPANESE_FORMAL",e[e.JAPANESE_INFORMAL=26]="JAPANESE_INFORMAL",e[e.KANNADA=27]="KANNADA",e[e.KATAKANA=28]="KATAKANA",e[e.KATAKANA_IROHA=29]="KATAKANA_IROHA",e[e.KHMER=30]="KHMER",e[e.KOREAN_HANGUL_FORMAL=31]="KOREAN_HANGUL_FORMAL",e[e.KOREAN_HANJA_FORMAL=32]="KOREAN_HANJA_FORMAL",e[e.KOREAN_HANJA_INFORMAL=33]="KOREAN_HANJA_INFORMAL",e[e.LAO=34]="LAO",e[e.LOWER_ARMENIAN=35]="LOWER_ARMENIAN",e[e.MALAYALAM=36]="MALAYALAM",e[e.MONGOLIAN=37]="MONGOLIAN",e[e.MYANMAR=38]="MYANMAR",e[e.ORIYA=39]="ORIYA",e[e.PERSIAN=40]="PERSIAN",e[e.SIMP_CHINESE_FORMAL=41]="SIMP_CHINESE_FORMAL",e[e.SIMP_CHINESE_INFORMAL=42]="SIMP_CHINESE_INFORMAL",e[e.TAMIL=43]="TAMIL",e[e.TELUGU=44]="TELUGU",e[e.THAI=45]="THAI",e[e.TIBETAN=46]="TIBETAN",e[e.TRAD_CHINESE_FORMAL=47]="TRAD_CHINESE_FORMAL",e[e.TRAD_CHINESE_INFORMAL=48]="TRAD_CHINESE_INFORMAL",e[e.UPPER_ARMENIAN=49]="UPPER_ARMENIAN",e[e.DISCLOSURE_OPEN=50]="DISCLOSURE_OPEN",e[e.DISCLOSURE_CLOSED=51]="DISCLOSURE_CLOSED"}(LIST_STYLE_TYPE=LIST_STYLE_TYPE||{});var OVERFLOW,listStyleType={name:"list-style-type",initialValue:"none",prefix:!1,type:PropertyDescriptorParsingType.IDENT_VALUE,parse:function(e){switch(e){case"disc":return LIST_STYLE_TYPE.DISC;case"circle":return LIST_STYLE_TYPE.CIRCLE;case"square":return LIST_STYLE_TYPE.SQUARE;case"decimal":return LIST_STYLE_TYPE.DECIMAL;case"cjk-decimal":return LIST_STYLE_TYPE.CJK_DECIMAL;case"decimal-leading-zero":return LIST_STYLE_TYPE.DECIMAL_LEADING_ZERO;case"lower-roman":return LIST_STYLE_TYPE.LOWER_ROMAN;case"upper-roman":return LIST_STYLE_TYPE.UPPER_ROMAN;case"lower-greek":return LIST_STYLE_TYPE.LOWER_GREEK;case"lower-alpha":return LIST_STYLE_TYPE.LOWER_ALPHA;case"upper-alpha":return LIST_STYLE_TYPE.UPPER_ALPHA;case"arabic-indic":return LIST_STYLE_TYPE.ARABIC_INDIC;case"armenian":return LIST_STYLE_TYPE.ARMENIAN;case"bengali":return LIST_STYLE_TYPE.BENGALI;case"cambodian":return LIST_STYLE_TYPE.CAMBODIAN;case"cjk-earthly-branch":return LIST_STYLE_TYPE.CJK_EARTHLY_BRANCH;case"cjk-heavenly-stem":return LIST_STYLE_TYPE.CJK_HEAVENLY_STEM;case"cjk-ideographic":return LIST_STYLE_TYPE.CJK_IDEOGRAPHIC;case"devanagari":return LIST_STYLE_TYPE.DEVANAGARI;case"ethiopic-numeric":return LIST_STYLE_TYPE.ETHIOPIC_NUMERIC;case"georgian":return LIST_STYLE_TYPE.GEORGIAN;case"gujarati":return LIST_STYLE_TYPE.GUJARATI;case"gurmukhi":return LIST_STYLE_TYPE.GURMUKHI;case"hebrew":return LIST_STYLE_TYPE.HEBREW;case"hiragana":return LIST_STYLE_TYPE.HIRAGANA;case"hiragana-iroha":return LIST_STYLE_TYPE.HIRAGANA_IROHA;case"japanese-formal":return LIST_STYLE_TYPE.JAPANESE_FORMAL;case"japanese-informal":return LIST_STYLE_TYPE.JAPANESE_INFORMAL;case"kannada":return LIST_STYLE_TYPE.KANNADA;case"katakana":return LIST_STYLE_TYPE.KATAKANA;case"katakana-iroha":return LIST_STYLE_TYPE.KATAKANA_IROHA;case"khmer":return LIST_STYLE_TYPE.KHMER;case"korean-hangul-formal":return LIST_STYLE_TYPE.KOREAN_HANGUL_FORMAL;case"korean-hanja-formal":return LIST_STYLE_TYPE.KOREAN_HANJA_FORMAL;case"korean-hanja-informal":return LIST_STYLE_TYPE.KOREAN_HANJA_INFORMAL;case"lao":return LIST_STYLE_TYPE.LAO;case"lower-armenian":return LIST_STYLE_TYPE.LOWER_ARMENIAN;case"malayalam":return LIST_STYLE_TYPE.MALAYALAM;case"mongolian":return LIST_STYLE_TYPE.MONGOLIAN;case"myanmar":return LIST_STYLE_TYPE.MYANMAR;case"oriya":return LIST_STYLE_TYPE.ORIYA;case"persian":return LIST_STYLE_TYPE.PERSIAN;case"simp-chinese-formal":return LIST_STYLE_TYPE.SIMP_CHINESE_FORMAL;case"simp-chinese-informal":return LIST_STYLE_TYPE.SIMP_CHINESE_INFORMAL;case"tamil":return LIST_STYLE_TYPE.TAMIL;case"telugu":return LIST_STYLE_TYPE.TELUGU;case"thai":return LIST_STYLE_TYPE.THAI;case"tibetan":return LIST_STYLE_TYPE.TIBETAN;case"trad-chinese-formal":return LIST_STYLE_TYPE.TRAD_CHINESE_FORMAL;case"trad-chinese-informal":return LIST_STYLE_TYPE.TRAD_CHINESE_INFORMAL;case"upper-armenian":return LIST_STYLE_TYPE.UPPER_ARMENIAN;case"disclosure-open":return LIST_STYLE_TYPE.DISCLOSURE_OPEN;case"disclosure-closed":return LIST_STYLE_TYPE.DISCLOSURE_CLOSED;default:return LIST_STYLE_TYPE.NONE}}},marginForSide=function(e){return{name:"margin-"+e,initialValue:"0",prefix:!1,type:PropertyDescriptorParsingType.TOKEN_VALUE}},marginTop=marginForSide("top"),marginRight=marginForSide("right"),marginBottom=marginForSide("bottom"),marginLeft=marginForSide("left");!function(e){e[e.VISIBLE=0]="VISIBLE",e[e.HIDDEN=1]="HIDDEN",e[e.SCROLL=2]="SCROLL",e[e.AUTO=3]="AUTO"}(OVERFLOW=OVERFLOW||{});var OVERFLOW_WRAP,overflow={name:"overflow",initialValue:"visible",prefix:!1,type:PropertyDescriptorParsingType.LIST,parse:function(e){return e.filter(isIdentToken).map(function(e){switch(e.value){case"hidden":return OVERFLOW.HIDDEN;case"scroll":return OVERFLOW.SCROLL;case"auto":return OVERFLOW.AUTO;default:return OVERFLOW.VISIBLE}})}};!function(e){e.NORMAL="normal",e.BREAK_WORD="break-word"}(OVERFLOW_WRAP=OVERFLOW_WRAP||{});var TEXT_ALIGN,overflowWrap={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:PropertyDescriptorParsingType.IDENT_VALUE,parse:function(e){return"break-word"!==e?OVERFLOW_WRAP.NORMAL:OVERFLOW_WRAP.BREAK_WORD}},paddingForSide=function(e){return{name:"padding-"+e,initialValue:"0",prefix:!1,type:PropertyDescriptorParsingType.TYPE_VALUE,format:"length-percentage"}},paddingTop=paddingForSide("top"),paddingRight=paddingForSide("right"),paddingBottom=paddingForSide("bottom"),paddingLeft=paddingForSide("left");!function(e){e[e.LEFT=0]="LEFT",e[e.CENTER=1]="CENTER",e[e.RIGHT=2]="RIGHT"}(TEXT_ALIGN=TEXT_ALIGN||{});var POSITION,textAlign={name:"text-align",initialValue:"left",prefix:!1,type:PropertyDescriptorParsingType.IDENT_VALUE,parse:function(e){switch(e){case"right":return TEXT_ALIGN.RIGHT;case"center":case"justify":return TEXT_ALIGN.CENTER;default:return TEXT_ALIGN.LEFT}}};!function(e){e[e.STATIC=0]="STATIC",e[e.RELATIVE=1]="RELATIVE",e[e.ABSOLUTE=2]="ABSOLUTE",e[e.FIXED=3]="FIXED",e[e.STICKY=4]="STICKY"}(POSITION=POSITION||{});var TEXT_TRANSFORM,position={name:"position",initialValue:"static",prefix:!1,type:PropertyDescriptorParsingType.IDENT_VALUE,parse:function(e){switch(e){case"relative":return POSITION.RELATIVE;case"absolute":return POSITION.ABSOLUTE;case"fixed":return POSITION.FIXED;case"sticky":return POSITION.STICKY}return POSITION.STATIC}},textShadow={name:"text-shadow",initialValue:"none",type:PropertyDescriptorParsingType.LIST,prefix:!1,parse:function(e){return 1===e.length&&isIdentWithValue(e[0],"none")?[]:parseFunctionArgs(e).map(function(e){for(var t={color:COLORS.TRANSPARENT,offsetX:ZERO_LENGTH,offsetY:ZERO_LENGTH,blur:ZERO_LENGTH},r=0,n=0;n<e.length;n++){var i=e[n];isLength(i)?(0===r?t.offsetX=i:1===r?t.offsetY=i:t.blur=i,r++):t.color=color.parse(i)}return t})}};!function(e){e[e.NONE=0]="NONE",e[e.LOWERCASE=1]="LOWERCASE",e[e.UPPERCASE=2]="UPPERCASE",e[e.CAPITALIZE=3]="CAPITALIZE"}(TEXT_TRANSFORM=TEXT_TRANSFORM||{});var VISIBILITY,textTransform={name:"text-transform",initialValue:"none",prefix:!1,type:PropertyDescriptorParsingType.IDENT_VALUE,parse:function(e){switch(e){case"uppercase":return TEXT_TRANSFORM.UPPERCASE;case"lowercase":return TEXT_TRANSFORM.LOWERCASE;case"capitalize":return TEXT_TRANSFORM.CAPITALIZE}return TEXT_TRANSFORM.NONE}},transform={name:"transform",initialValue:"none",prefix:!0,type:PropertyDescriptorParsingType.VALUE,parse:function(e){if(e.type===TokenType.IDENT_TOKEN&&"none"===e.value)return null;if(e.type!==TokenType.FUNCTION)return null;var t=SUPPORTED_TRANSFORM_FUNCTIONS[e.name];if(void 0===t)throw new Error('Attempting to parse an unsupported transform function "'+e.name+'"');return t(e.values)}},matrix=function(e){e=e.filter(function(e){return e.type===TokenType.NUMBER_TOKEN}).map(function(e){return e.number});return 6===e.length?e:null},matrix3d=function(e){var t=e.filter(function(e){return e.type===TokenType.NUMBER_TOKEN}).map(function(e){return e.number}),r=t[0],n=t[1],i=(t[2],t[3],t[4]),o=t[5],a=(t[6],t[7],t[8],t[9],t[10],t[11],t[12]),e=t[13];t[14],t[15];return 16===t.length?[r,n,i,o,a,e]:null},SUPPORTED_TRANSFORM_FUNCTIONS={matrix:matrix,matrix3d:matrix3d},DEFAULT_VALUE={type:TokenType.PERCENTAGE_TOKEN,number:50,flags:FLAG_INTEGER},DEFAULT=[DEFAULT_VALUE,DEFAULT_VALUE],transformOrigin={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:PropertyDescriptorParsingType.LIST,parse:function(e){e=e.filter(isLengthPercentage);return 2!==e.length?DEFAULT:[e[0],e[1]]}};!function(e){e[e.VISIBLE=0]="VISIBLE",e[e.HIDDEN=1]="HIDDEN",e[e.COLLAPSE=2]="COLLAPSE"}(VISIBILITY=VISIBILITY||{});var WORD_BREAK,visibility={name:"visible",initialValue:"none",prefix:!1,type:PropertyDescriptorParsingType.IDENT_VALUE,parse:function(e){switch(e){case"hidden":return VISIBILITY.HIDDEN;case"collapse":return VISIBILITY.COLLAPSE;default:return VISIBILITY.VISIBLE}}};!function(e){e.NORMAL="normal",e.BREAK_ALL="break-all",e.KEEP_ALL="keep-all"}(WORD_BREAK=WORD_BREAK||{});var FONT_STYLE,wordBreak={name:"word-break",initialValue:"normal",prefix:!1,type:PropertyDescriptorParsingType.IDENT_VALUE,parse:function(e){switch(e){case"break-all":return WORD_BREAK.BREAK_ALL;case"keep-all":return WORD_BREAK.KEEP_ALL;default:return WORD_BREAK.NORMAL}}},zIndex={name:"z-index",initialValue:"auto",prefix:!1,type:PropertyDescriptorParsingType.VALUE,parse:function(e){if(e.type===TokenType.IDENT_TOKEN)return{auto:!0,order:0};if(isNumberToken(e))return{auto:!1,order:e.number};throw new Error("Invalid z-index number parsed")}},opacity={name:"opacity",initialValue:"1",type:PropertyDescriptorParsingType.VALUE,prefix:!1,parse:function(e){return isNumberToken(e)?e.number:1}},textDecorationColor={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:PropertyDescriptorParsingType.TYPE_VALUE,format:"color"},textDecorationLine={name:"text-decoration-line",initialValue:"none",prefix:!1,type:PropertyDescriptorParsingType.LIST,parse:function(e){return e.filter(isIdentToken).map(function(e){switch(e.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(e){return 0!==e})}},fontFamily={name:"font-family",initialValue:"",prefix:!1,type:PropertyDescriptorParsingType.LIST,parse:function(e){var t=[],r=[];return e.forEach(function(e){switch(e.type){case TokenType.IDENT_TOKEN:case TokenType.STRING_TOKEN:t.push(e.value);break;case TokenType.NUMBER_TOKEN:t.push(e.number.toString());break;case TokenType.COMMA_TOKEN:r.push(t.join(" ")),t.length=0}}),t.length&&r.push(t.join(" ")),r.map(function(e){return-1===e.indexOf(" ")?e:"'"+e+"'"})}},fontSize={name:"font-size",initialValue:"0",prefix:!1,type:PropertyDescriptorParsingType.TYPE_VALUE,format:"length"},fontWeight={name:"font-weight",initialValue:"normal",type:PropertyDescriptorParsingType.VALUE,prefix:!1,parse:function(e){return isNumberToken(e)?e.number:!isIdentToken(e)||"bold"!==e.value?400:700}},fontVariant={name:"font-variant",initialValue:"none",type:PropertyDescriptorParsingType.LIST,prefix:!1,parse:function(e){return e.filter(isIdentToken).map(function(e){return e.value})}};!function(e){e.NORMAL="normal",e.ITALIC="italic",e.OBLIQUE="oblique"}(FONT_STYLE=FONT_STYLE||{});var PseudoElementType,fontStyle={name:"font-style",initialValue:"normal",prefix:!1,type:PropertyDescriptorParsingType.IDENT_VALUE,parse:function(e){switch(e){case"oblique":return FONT_STYLE.OBLIQUE;case"italic":return FONT_STYLE.ITALIC;default:return FONT_STYLE.NORMAL}}},contains=function(e,t){return 0!=(e&t)},content={name:"content",initialValue:"none",type:PropertyDescriptorParsingType.LIST,prefix:!1,parse:function(e){if(0===e.length)return[];var t=e[0];return t.type===TokenType.IDENT_TOKEN&&"none"===t.value?[]:e}},counterIncrement={name:"counter-increment",initialValue:"none",prefix:!0,type:PropertyDescriptorParsingType.LIST,parse:function(e){if(0===e.length)return null;var t=e[0];if(t.type===TokenType.IDENT_TOKEN&&"none"===t.value)return null;for(var r=[],n=e.filter(nonWhiteSpace),i=0;i<n.length;i++){var o=n[i],a=n[i+1];o.type===TokenType.IDENT_TOKEN&&(a=a&&isNumberToken(a)?a.number:1,r.push({counter:o.value,increment:a}))}return r}},counterReset={name:"counter-reset",initialValue:"none",prefix:!0,type:PropertyDescriptorParsingType.LIST,parse:function(e){if(0===e.length)return[];for(var t=[],r=e.filter(nonWhiteSpace),n=0;n<r.length;n++){var i=r[n],o=r[n+1];isIdentToken(i)&&"none"!==i.value&&(o=o&&isNumberToken(o)?o.number:0,t.push({counter:i.value,reset:o}))}return t}},quotes={name:"quotes",initialValue:"none",prefix:!0,type:PropertyDescriptorParsingType.LIST,parse:function(e){if(0===e.length)return null;var t=e[0];if(t.type===TokenType.IDENT_TOKEN&&"none"===t.value)return null;var r=[],n=e.filter(isStringToken);if(n.length%2!=0)return null;for(var i=0;i<n.length;i+=2){var o=n[i].value,a=n[i+1].value;r.push({open:o,close:a})}return r}},getQuote=function(e,t,r){if(!e)return"";e=e[Math.min(t,e.length-1)];return e?r?e.open:e.close:""},boxShadow={name:"box-shadow",initialValue:"none",type:PropertyDescriptorParsingType.LIST,prefix:!1,parse:function(e){return 1===e.length&&isIdentWithValue(e[0],"none")?[]:parseFunctionArgs(e).map(function(e){for(var t={color:255,offsetX:ZERO_LENGTH,offsetY:ZERO_LENGTH,blur:ZERO_LENGTH,spread:ZERO_LENGTH,inset:!1},r=0,n=0;n<e.length;n++){var i=e[n];isIdentWithValue(i,"inset")?t.inset=!0:isLength(i)?(0===r?t.offsetX=i:1===r?t.offsetY=i:2===r?t.blur=i:t.spread=i,r++):t.color=color.parse(i)}return t})}},CSSParsedDeclaration=function(){function e(e){this.backgroundClip=parse$1(backgroundClip,e.backgroundClip),this.backgroundColor=parse$1(backgroundColor,e.backgroundColor),this.backgroundImage=parse$1(backgroundImage,e.backgroundImage),this.backgroundOrigin=parse$1(backgroundOrigin,e.backgroundOrigin),this.backgroundPosition=parse$1(backgroundPosition,e.backgroundPosition),this.backgroundRepeat=parse$1(backgroundRepeat,e.backgroundRepeat),this.backgroundSize=parse$1(backgroundSize,e.backgroundSize),this.borderTopColor=parse$1(borderTopColor,e.borderTopColor),this.borderRightColor=parse$1(borderRightColor,e.borderRightColor),this.borderBottomColor=parse$1(borderBottomColor,e.borderBottomColor),this.borderLeftColor=parse$1(borderLeftColor,e.borderLeftColor),this.borderTopLeftRadius=parse$1(borderTopLeftRadius,e.borderTopLeftRadius),this.borderTopRightRadius=parse$1(borderTopRightRadius,e.borderTopRightRadius),this.borderBottomRightRadius=parse$1(borderBottomRightRadius,e.borderBottomRightRadius),this.borderBottomLeftRadius=parse$1(borderBottomLeftRadius,e.borderBottomLeftRadius),this.borderTopStyle=parse$1(borderTopStyle,e.borderTopStyle),this.borderRightStyle=parse$1(borderRightStyle,e.borderRightStyle),this.borderBottomStyle=parse$1(borderBottomStyle,e.borderBottomStyle),this.borderLeftStyle=parse$1(borderLeftStyle,e.borderLeftStyle),this.borderTopWidth=parse$1(borderTopWidth,e.borderTopWidth),this.borderRightWidth=parse$1(borderRightWidth,e.borderRightWidth),this.borderBottomWidth=parse$1(borderBottomWidth,e.borderBottomWidth),this.borderLeftWidth=parse$1(borderLeftWidth,e.borderLeftWidth),this.boxShadow=parse$1(boxShadow,e.boxShadow),this.color=parse$1(color$1,e.color),this.display=parse$1(display,e.display),this.float=parse$1(float,e.cssFloat),this.fontFamily=parse$1(fontFamily,e.fontFamily),this.fontSize=parse$1(fontSize,e.fontSize),this.fontStyle=parse$1(fontStyle,e.fontStyle),this.fontVariant=parse$1(fontVariant,e.fontVariant),this.fontWeight=parse$1(fontWeight,e.fontWeight),this.letterSpacing=parse$1(letterSpacing,e.letterSpacing),this.lineBreak=parse$1(lineBreak,e.lineBreak),this.lineHeight=parse$1(lineHeight,e.lineHeight),this.listStyleImage=parse$1(listStyleImage,e.listStyleImage),this.listStylePosition=parse$1(listStylePosition,e.listStylePosition),this.listStyleType=parse$1(listStyleType,e.listStyleType),this.marginTop=parse$1(marginTop,e.marginTop),this.marginRight=parse$1(marginRight,e.marginRight),this.marginBottom=parse$1(marginBottom,e.marginBottom),this.marginLeft=parse$1(marginLeft,e.marginLeft),this.opacity=parse$1(opacity,e.opacity);var t=parse$1(overflow,e.overflow);this.overflowX=t[0],this.overflowY=t[1<t.length?1:0],this.overflowWrap=parse$1(overflowWrap,e.overflowWrap),this.paddingTop=parse$1(paddingTop,e.paddingTop),this.paddingRight=parse$1(paddingRight,e.paddingRight),this.paddingBottom=parse$1(paddingBottom,e.paddingBottom),this.paddingLeft=parse$1(paddingLeft,e.paddingLeft),this.position=parse$1(position,e.position),this.textAlign=parse$1(textAlign,e.textAlign),this.textDecorationColor=parse$1(textDecorationColor,e.textDecorationColor||e.color),this.textDecorationLine=parse$1(textDecorationLine,e.textDecorationLine),this.textShadow=parse$1(textShadow,e.textShadow),this.textTransform=parse$1(textTransform,e.textTransform),this.transform=parse$1(transform,e.transform),this.transformOrigin=parse$1(transformOrigin,e.transformOrigin),this.visibility=parse$1(visibility,e.visibility),this.wordBreak=parse$1(wordBreak,e.wordBreak),this.zIndex=parse$1(zIndex,e.zIndex)}return e.prototype.isVisible=function(){return 0<this.display&&0<this.opacity&&this.visibility===VISIBILITY.VISIBLE},e.prototype.isTransparent=function(){return isTransparent(this.backgroundColor)},e.prototype.isTransformed=function(){return null!==this.transform},e.prototype.isPositioned=function(){return this.position!==POSITION.STATIC},e.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},e.prototype.isFloating=function(){return this.float!==FLOAT.NONE},e.prototype.isInlineLevel=function(){return contains(this.display,4)||contains(this.display,33554432)||contains(this.display,268435456)||contains(this.display,536870912)||contains(this.display,67108864)||contains(this.display,134217728)},e}(),CSSParsedPseudoDeclaration=function(e){this.content=parse$1(content,e.content),this.quotes=parse$1(quotes,e.quotes)},CSSParsedCounterDeclaration=function(e){this.counterIncrement=parse$1(counterIncrement,e.counterIncrement),this.counterReset=parse$1(counterReset,e.counterReset)},parse$1=function(e,t){var r=new Tokenizer,t=null!=t?t.toString():e.initialValue;r.write(t);var n=new Parser(r.read());switch(e.type){case PropertyDescriptorParsingType.IDENT_VALUE:var i=n.parseComponentValue();return e.parse(isIdentToken(i)?i.value:e.initialValue);case PropertyDescriptorParsingType.VALUE:return e.parse(n.parseComponentValue());case PropertyDescriptorParsingType.LIST:return e.parse(n.parseComponentValues());case PropertyDescriptorParsingType.TOKEN_VALUE:return n.parseComponentValue();case PropertyDescriptorParsingType.TYPE_VALUE:switch(e.format){case"angle":return angle.parse(n.parseComponentValue());case"color":return color.parse(n.parseComponentValue());case"image":return image.parse(n.parseComponentValue());case"length":var o=n.parseComponentValue();return isLength(o)?o:ZERO_LENGTH;case"length-percentage":o=n.parseComponentValue();return isLengthPercentage(o)?o:ZERO_LENGTH}}throw new Error("Attempting to parse unsupported css format type "+e.format)},ElementContainer=function(e){this.styles=new CSSParsedDeclaration(window.getComputedStyle(e,null)),this.textNodes=[],this.elements=[],null!==this.styles.transform&&isHTMLElementNode(e)&&(e.style.transform="none"),this.bounds=parseBounds(e),this.flags=0},TextBounds=function(e,t){this.text=e,this.bounds=t},parseTextBounds=function(e,r,n){var e=breakText(e,r),i=[],o=0;return e.forEach(function(e){var t;r.textDecorationLine.length||0<e.trim().length?FEATURES.SUPPORT_RANGE_BOUNDS?i.push(new TextBounds(e,getRangeBounds(n,o,e.length))):(t=n.splitText(e.length),i.push(new TextBounds(e,getWrapperBounds(n))),n=t):FEATURES.SUPPORT_RANGE_BOUNDS||(n=n.splitText(e.length)),o+=e.length}),i},getWrapperBounds=function(e){var t=e.ownerDocument;if(t){var r=t.createElement("html2canvaswrapper");r.appendChild(e.cloneNode(!0));t=e.parentNode;if(t){t.replaceChild(r,e);e=parseBounds(r);return r.firstChild&&t.replaceChild(r.firstChild,r),e}}return new Bounds(0,0,0,0)},getRangeBounds=function(e,t,r){var n=e.ownerDocument;if(!n)throw new Error("Node has no owner document");n=n.createRange();return n.setStart(e,t),n.setEnd(e,t+r),Bounds.fromClientRect(n.getBoundingClientRect())},breakText=function(e,t){return 0!==t.letterSpacing?toCodePoints(e).map(function(e){return fromCodePoint(e)}):breakWords(e,t)},breakWords=function(e,t){for(var r,n=LineBreaker(e,{lineBreak:t.lineBreak,wordBreak:t.overflowWrap===OVERFLOW_WRAP.BREAK_WORD?"break-word":t.wordBreak}),i=[];!(r=n.next()).done;)r.value&&i.push(r.value.slice());return i},TextContainer=function(e,t){this.text=transform$1(e.data,t.textTransform),this.textBounds=parseTextBounds(this.text,t,e)},transform$1=function(e,t){switch(t){case TEXT_TRANSFORM.LOWERCASE:return e.toLowerCase();case TEXT_TRANSFORM.CAPITALIZE:return e.replace(CAPITALIZE,capitalize);case TEXT_TRANSFORM.UPPERCASE:return e.toUpperCase();default:return e}},CAPITALIZE=/(^|\s|:|-|\(|\))([a-z])/g,capitalize=function(e,t,r){return 0<e.length?t+r.toUpperCase():e},ImageElementContainer=function(r){function e(e){var t=r.call(this,e)||this;return t.src=e.currentSrc||e.src,t.intrinsicWidth=e.naturalWidth,t.intrinsicHeight=e.naturalHeight,CacheStorage.getInstance().addImage(t.src),t}return __extends$1(e,r),e}(ElementContainer),CanvasElementContainer=function(r){function e(e){var t=r.call(this,e)||this;return t.canvas=e,t.intrinsicWidth=e.width,t.intrinsicHeight=e.height,t}return __extends$1(e,r),e}(ElementContainer),SVGElementContainer=function(n){function e(e){var t=n.call(this,e)||this,r=new XMLSerializer;return t.svg="data:image/svg+xml,"+encodeURIComponent(r.serializeToString(e)),t.intrinsicWidth=e.width.baseVal.value,t.intrinsicHeight=e.height.baseVal.value,CacheStorage.getInstance().addImage(t.svg),t}return __extends$1(e,n),e}(ElementContainer),LIElementContainer=function(r){function e(e){var t=r.call(this,e)||this;return t.value=e.value,t}return __extends$1(e,r),e}(ElementContainer),OLElementContainer=function(r){function e(e){var t=r.call(this,e)||this;return t.start=e.start,t.reversed="boolean"==typeof e.reversed&&!0===e.reversed,t}return __extends$1(e,r),e}(ElementContainer),CHECKBOX_BORDER_RADIUS=[{type:TokenType.DIMENSION_TOKEN,flags:0,unit:"px",number:3}],RADIO_BORDER_RADIUS=[{type:TokenType.PERCENTAGE_TOKEN,flags:0,number:50}],reformatInputBounds=function(e){return e.width>e.height?new Bounds(e.left+(e.width-e.height)/2,e.top,e.height,e.height):e.width<e.height?new Bounds(e.left,e.top+(e.height-e.width)/2,e.width,e.width):e},getInputValue=function(e){var t=e.type===PASSWORD?new Array(e.value.length+1).join("•"):e.value;return 0===t.length?e.placeholder||"":t},CHECKBOX="checkbox",RADIO="radio",PASSWORD="password",INPUT_COLOR=707406591,InputElementContainer=function(r){function e(e){var t=r.call(this,e)||this;switch(t.type=e.type.toLowerCase(),t.checked=e.checked,t.value=getInputValue(e),t.type!==CHECKBOX&&t.type!==RADIO||(t.styles.backgroundColor=3739148031,t.styles.borderTopColor=t.styles.borderRightColor=t.styles.borderBottomColor=t.styles.borderLeftColor=2779096575,t.styles.borderTopWidth=t.styles.borderRightWidth=t.styles.borderBottomWidth=t.styles.borderLeftWidth=1,t.styles.borderTopStyle=t.styles.borderRightStyle=t.styles.borderBottomStyle=t.styles.borderLeftStyle=BORDER_STYLE.SOLID,t.styles.backgroundClip=[BACKGROUND_CLIP.BORDER_BOX],t.styles.backgroundOrigin=[0],t.bounds=reformatInputBounds(t.bounds)),t.type){case CHECKBOX:t.styles.borderTopRightRadius=t.styles.borderTopLeftRadius=t.styles.borderBottomRightRadius=t.styles.borderBottomLeftRadius=CHECKBOX_BORDER_RADIUS;break;case RADIO:t.styles.borderTopRightRadius=t.styles.borderTopLeftRadius=t.styles.borderBottomRightRadius=t.styles.borderBottomLeftRadius=RADIO_BORDER_RADIUS}return t}return __extends$1(e,r),e}(ElementContainer),SelectElementContainer=function(r){function e(e){var t=r.call(this,e)||this,e=e.options[e.selectedIndex||0];return t.value=e&&e.text||"",t}return __extends$1(e,r),e}(ElementContainer),TextareaElementContainer=function(r){function e(e){var t=r.call(this,e)||this;return t.value=e.value,t}return __extends$1(e,r),e}(ElementContainer),parseColor=function(e){return color.parse(Parser.create(e).parseComponentValue())},IFrameElementContainer=function(i){function e(e){var t,r,n=i.call(this,e)||this;n.src=e.src,n.width=parseInt(e.width,10)||0,n.height=parseInt(e.height,10)||0,n.backgroundColor=n.styles.backgroundColor;try{e.contentWindow&&e.contentWindow.document&&e.contentWindow.document.documentElement&&(n.tree=parseTree(e.contentWindow.document.documentElement),t=e.contentWindow.document.documentElement?parseColor(getComputedStyle(e.contentWindow.document.documentElement).backgroundColor):COLORS.TRANSPARENT,r=e.contentWindow.document.body?parseColor(getComputedStyle(e.contentWindow.document.body).backgroundColor):COLORS.TRANSPARENT,n.backgroundColor=isTransparent(t)?isTransparent(r)?n.styles.backgroundColor:r:t)}catch(e){}return n}return __extends$1(e,i),e}(ElementContainer),LIST_OWNERS=["OL","UL","MENU"],parseNodeTree=function(e,t,r){for(var n=e.firstChild;n;n=o){var i,o=n.nextSibling;isTextNode(n)&&0<n.data.trim().length?t.textNodes.push(new TextContainer(n,t.styles)):!isElementNode(n)||(i=createContainer(n)).styles.isVisible()&&(createsRealStackingContext(n,i,r)?i.flags|=4:createsStackingContext(i.styles)&&(i.flags|=2),-1!==LIST_OWNERS.indexOf(n.tagName)&&(i.flags|=8),t.elements.push(i),isTextareaElement(n)||isSVGElement(n)||isSelectElement(n)||parseNodeTree(n,i,r))}},createContainer=function(e){return new(isImageElement(e)?ImageElementContainer:isCanvasElement(e)?CanvasElementContainer:isSVGElement(e)?SVGElementContainer:isLIElement(e)?LIElementContainer:isOLElement(e)?OLElementContainer:isInputElement(e)?InputElementContainer:isSelectElement(e)?SelectElementContainer:isTextareaElement(e)?TextareaElementContainer:isIFrameElement(e)?IFrameElementContainer:ElementContainer)(e)},parseTree=function(e){var t=createContainer(e);return t.flags|=4,parseNodeTree(e,t,t),t},createsRealStackingContext=function(e,t,r){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||isBodyElement(e)&&r.styles.isTransparent()},createsStackingContext=function(e){return e.isPositioned()||e.isFloating()},isTextNode=function(e){return e.nodeType===Node.TEXT_NODE},isElementNode=function(e){return e.nodeType===Node.ELEMENT_NODE},isHTMLElementNode=function(e){return isElementNode(e)&&void 0!==e.style&&!isSVGElementNode(e)},isSVGElementNode=function(e){return"object"==typeof e.className},isLIElement=function(e){return"LI"===e.tagName},isOLElement=function(e){return"OL"===e.tagName},isInputElement=function(e){return"INPUT"===e.tagName},isHTMLElement=function(e){return"HTML"===e.tagName},isSVGElement=function(e){return"svg"===e.tagName},isBodyElement=function(e){return"BODY"===e.tagName},isCanvasElement=function(e){return"CANVAS"===e.tagName},isImageElement=function(e){return"IMG"===e.tagName},isIFrameElement=function(e){return"IFRAME"===e.tagName},isStyleElement=function(e){return"STYLE"===e.tagName},isScriptElement=function(e){return"SCRIPT"===e.tagName},isTextareaElement=function(e){return"TEXTAREA"===e.tagName},isSelectElement=function(e){return"SELECT"===e.tagName},CounterState=function(){function e(){this.counters={}}return e.prototype.getCounterValue=function(e){e=this.counters[e];return e&&e.length?e[e.length-1]:1},e.prototype.getCounterValues=function(e){e=this.counters[e];return e||[]},e.prototype.pop=function(e){var t=this;e.forEach(function(e){return t.counters[e].pop()})},e.prototype.parse=function(e){var r=this,t=e.counterIncrement,e=e.counterReset,n=!0;null!==t&&t.forEach(function(e){var t=r.counters[e.counter];t&&0!==e.increment&&(n=!1,t[Math.max(0,t.length-1)]+=e.increment)});var i=[];return n&&e.forEach(function(e){var t=r.counters[e.counter];i.push(e.counter),(t=t||(r.counters[e.counter]=[])).push(e.reset)}),i},e}(),ROMAN_UPPER={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},ARMENIAN={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["Ք","Փ","Ւ","Ց","Ր","Տ","Վ","Ս","Ռ","Ջ","Պ","Չ","Ո","Շ","Ն","Յ","Մ","Ճ","Ղ","Ձ","Հ","Կ","Ծ","Խ","Լ","Ի","Ժ","Թ","Ը","Է","Զ","Ե","Դ","Գ","Բ","Ա"]},HEBREW={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["י׳","ט׳","ח׳","ז׳","ו׳","ה׳","ד׳","ג׳","ב׳","א׳","ת","ש","ר","ק","צ","פ","ע","ס","נ","מ","ל","כ","יט","יח","יז","טז","טו","י","ט","ח","ז","ו","ה","ד","ג","ב","א"]},GEORGIAN={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["ჵ","ჰ","ჯ","ჴ","ხ","ჭ","წ","ძ","ც","ჩ","შ","ყ","ღ","ქ","ფ","ჳ","ტ","ს","რ","ჟ","პ","ო","ჲ","ნ","მ","ლ","კ","ი","თ","ჱ","ზ","ვ","ე","დ","გ","ბ","ა"]},createAdditiveCounter=function(n,e,t,i,r,o){return n<e||t<n?createCounterText(n,r,0<o.length):i.integers.reduce(function(e,t,r){for(;t<=n;)n-=t,e+=i.values[r];return e},"")+o},createCounterStyleWithSymbolResolver=function(e,t,r,n){for(var i="";r||e--,i=n(e)+i,t<=(e/=t)*t;);return i},createCounterStyleFromRange=function(e,t,r,n,i){var o=r-t+1;return(e<0?"-":"")+(createCounterStyleWithSymbolResolver(Math.abs(e),o,n,function(e){return fromCodePoint(Math.floor(e%o)+t)})+i)},createCounterStyleFromSymbols=function(e,t,r){void 0===r&&(r=". ");var n=t.length;return createCounterStyleWithSymbolResolver(Math.abs(e),n,!1,function(e){return t[Math.floor(e%n)]})+r},CJK_ZEROS=1,CJK_TEN_COEFFICIENTS=2,CJK_TEN_HIGH_COEFFICIENTS=4,CJK_HUNDRED_COEFFICIENTS=8,createCJKCounter=function(e,t,r,n,i,o){if(e<-9999||9999<e)return createCounterText(e,LIST_STYLE_TYPE.CJK_DECIMAL,0<i.length);var a=Math.abs(e),s=i;if(0===a)return t[0]+s;for(var l=0;0<a&&l<=4;l++){var c=a%10;0==c&&contains(o,CJK_ZEROS)&&""!==s?s=t[c]+s:1<c||1==c&&0===l||1==c&&1===l&&contains(o,CJK_TEN_COEFFICIENTS)||1==c&&1===l&&contains(o,CJK_TEN_HIGH_COEFFICIENTS)&&100<e||1==c&&1<l&&contains(o,CJK_HUNDRED_COEFFICIENTS)?s=t[c]+(0<l?r[l-1]:"")+s:1==c&&0<l&&(s=r[l-1]+s),a=Math.floor(a/10)}return(e<0?n:"")+s},CHINESE_INFORMAL_MULTIPLIERS="十百千萬",CHINESE_FORMAL_MULTIPLIERS="拾佰仟萬",JAPANESE_NEGATIVE="マイナス",KOREAN_NEGATIVE="마이너스",createCounterText=function(e,t,r){var n=r?". ":"",i=r?"、":"",o=r?", ":"",a=r?" ":"";switch(t){case LIST_STYLE_TYPE.DISC:return"•"+a;case LIST_STYLE_TYPE.CIRCLE:return"◦"+a;case LIST_STYLE_TYPE.SQUARE:return"◾"+a;case LIST_STYLE_TYPE.DECIMAL_LEADING_ZERO:var s=createCounterStyleFromRange(e,48,57,!0,n);return s.length<4?"0"+s:s;case LIST_STYLE_TYPE.CJK_DECIMAL:return createCounterStyleFromSymbols(e,"〇一二三四五六七八九",i);case LIST_STYLE_TYPE.LOWER_ROMAN:return createAdditiveCounter(e,1,3999,ROMAN_UPPER,LIST_STYLE_TYPE.DECIMAL,n).toLowerCase();case LIST_STYLE_TYPE.UPPER_ROMAN:return createAdditiveCounter(e,1,3999,ROMAN_UPPER,LIST_STYLE_TYPE.DECIMAL,n);case LIST_STYLE_TYPE.LOWER_GREEK:return createCounterStyleFromRange(e,945,969,!1,n);case LIST_STYLE_TYPE.LOWER_ALPHA:return createCounterStyleFromRange(e,97,122,!1,n);case LIST_STYLE_TYPE.UPPER_ALPHA:return createCounterStyleFromRange(e,65,90,!1,n);case LIST_STYLE_TYPE.ARABIC_INDIC:return createCounterStyleFromRange(e,1632,1641,!0,n);case LIST_STYLE_TYPE.ARMENIAN:case LIST_STYLE_TYPE.UPPER_ARMENIAN:return createAdditiveCounter(e,1,9999,ARMENIAN,LIST_STYLE_TYPE.DECIMAL,n);case LIST_STYLE_TYPE.LOWER_ARMENIAN:return createAdditiveCounter(e,1,9999,ARMENIAN,LIST_STYLE_TYPE.DECIMAL,n).toLowerCase();case LIST_STYLE_TYPE.BENGALI:return createCounterStyleFromRange(e,2534,2543,!0,n);case LIST_STYLE_TYPE.CAMBODIAN:case LIST_STYLE_TYPE.KHMER:return createCounterStyleFromRange(e,6112,6121,!0,n);case LIST_STYLE_TYPE.CJK_EARTHLY_BRANCH:return createCounterStyleFromSymbols(e,"子丑寅卯辰巳午未申酉戌亥",i);case LIST_STYLE_TYPE.CJK_HEAVENLY_STEM:return createCounterStyleFromSymbols(e,"甲乙丙丁戊己庚辛壬癸",i);case LIST_STYLE_TYPE.CJK_IDEOGRAPHIC:case LIST_STYLE_TYPE.TRAD_CHINESE_INFORMAL:return createCJKCounter(e,"零一二三四五六七八九",CHINESE_INFORMAL_MULTIPLIERS,"負",i,CJK_TEN_COEFFICIENTS|CJK_TEN_HIGH_COEFFICIENTS|CJK_HUNDRED_COEFFICIENTS);case LIST_STYLE_TYPE.TRAD_CHINESE_FORMAL:return createCJKCounter(e,"零壹貳參肆伍陸柒捌玖",CHINESE_FORMAL_MULTIPLIERS,"負",i,CJK_ZEROS|CJK_TEN_COEFFICIENTS|CJK_TEN_HIGH_COEFFICIENTS|CJK_HUNDRED_COEFFICIENTS);case LIST_STYLE_TYPE.SIMP_CHINESE_INFORMAL:return createCJKCounter(e,"零一二三四五六七八九",CHINESE_INFORMAL_MULTIPLIERS,"负",i,CJK_TEN_COEFFICIENTS|CJK_TEN_HIGH_COEFFICIENTS|CJK_HUNDRED_COEFFICIENTS);case LIST_STYLE_TYPE.SIMP_CHINESE_FORMAL:return createCJKCounter(e,"零壹贰叁肆伍陆柒捌玖",CHINESE_FORMAL_MULTIPLIERS,"负",i,CJK_ZEROS|CJK_TEN_COEFFICIENTS|CJK_TEN_HIGH_COEFFICIENTS|CJK_HUNDRED_COEFFICIENTS);case LIST_STYLE_TYPE.JAPANESE_INFORMAL:return createCJKCounter(e,"〇一二三四五六七八九","十百千万",JAPANESE_NEGATIVE,i,0);case LIST_STYLE_TYPE.JAPANESE_FORMAL:return createCJKCounter(e,"零壱弐参四伍六七八九","拾百千万",JAPANESE_NEGATIVE,i,CJK_ZEROS|CJK_TEN_COEFFICIENTS|CJK_TEN_HIGH_COEFFICIENTS);case LIST_STYLE_TYPE.KOREAN_HANGUL_FORMAL:return createCJKCounter(e,"영일이삼사오육칠팔구","십백천만",KOREAN_NEGATIVE,o,CJK_ZEROS|CJK_TEN_COEFFICIENTS|CJK_TEN_HIGH_COEFFICIENTS);case LIST_STYLE_TYPE.KOREAN_HANJA_INFORMAL:return createCJKCounter(e,"零一二三四五六七八九","十百千萬",KOREAN_NEGATIVE,o,0);case LIST_STYLE_TYPE.KOREAN_HANJA_FORMAL:return createCJKCounter(e,"零壹貳參四五六七八九","拾百千",KOREAN_NEGATIVE,o,CJK_ZEROS|CJK_TEN_COEFFICIENTS|CJK_TEN_HIGH_COEFFICIENTS);case LIST_STYLE_TYPE.DEVANAGARI:return createCounterStyleFromRange(e,2406,2415,!0,n);case LIST_STYLE_TYPE.GEORGIAN:return createAdditiveCounter(e,1,19999,GEORGIAN,LIST_STYLE_TYPE.DECIMAL,n);case LIST_STYLE_TYPE.GUJARATI:return createCounterStyleFromRange(e,2790,2799,!0,n);case LIST_STYLE_TYPE.GURMUKHI:return createCounterStyleFromRange(e,2662,2671,!0,n);case LIST_STYLE_TYPE.HEBREW:return createAdditiveCounter(e,1,10999,HEBREW,LIST_STYLE_TYPE.DECIMAL,n);case LIST_STYLE_TYPE.HIRAGANA:return createCounterStyleFromSymbols(e,"あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわゐゑをん");case LIST_STYLE_TYPE.HIRAGANA_IROHA:return createCounterStyleFromSymbols(e,"いろはにほへとちりぬるをわかよたれそつねならむうゐのおくやまけふこえてあさきゆめみしゑひもせす");case LIST_STYLE_TYPE.KANNADA:return createCounterStyleFromRange(e,3302,3311,!0,n);case LIST_STYLE_TYPE.KATAKANA:return createCounterStyleFromSymbols(e,"アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヰヱヲン",i);case LIST_STYLE_TYPE.KATAKANA_IROHA:return createCounterStyleFromSymbols(e,"イロハニホヘトチリヌルヲワカヨタレソツネナラムウヰノオクヤマケフコエテアサキユメミシヱヒモセス",i);case LIST_STYLE_TYPE.LAO:return createCounterStyleFromRange(e,3792,3801,!0,n);case LIST_STYLE_TYPE.MONGOLIAN:return createCounterStyleFromRange(e,6160,6169,!0,n);case LIST_STYLE_TYPE.MYANMAR:return createCounterStyleFromRange(e,4160,4169,!0,n);case LIST_STYLE_TYPE.ORIYA:return createCounterStyleFromRange(e,2918,2927,!0,n);case LIST_STYLE_TYPE.PERSIAN:return createCounterStyleFromRange(e,1776,1785,!0,n);case LIST_STYLE_TYPE.TAMIL:return createCounterStyleFromRange(e,3046,3055,!0,n);case LIST_STYLE_TYPE.TELUGU:return createCounterStyleFromRange(e,3174,3183,!0,n);case LIST_STYLE_TYPE.THAI:return createCounterStyleFromRange(e,3664,3673,!0,n);case LIST_STYLE_TYPE.TIBETAN:return createCounterStyleFromRange(e,3872,3881,!0,n);default:LIST_STYLE_TYPE.DECIMAL;return createCounterStyleFromRange(e,48,57,!0,n)}},IGNORE_ATTRIBUTE="data-html2canvas-ignore",DocumentCloner=function(){function e(e,t){if(this.options=t,this.scrolledElements=[],this.referenceElement=e,this.counters=new CounterState,this.quoteDepth=0,!e.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(e.ownerDocument.documentElement)}return e.prototype.toIFrame=function(e,r){var t=this,n=createIFrameContainer(e,r);if(!n.contentWindow)return Promise.reject("Unable to find iframe window");var i=e.defaultView.pageXOffset,o=e.defaultView.pageYOffset,a=n.contentWindow,s=a.document,e=iframeLoader(n).then(function(){return __awaiter(t,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this.scrolledElements.forEach(restoreNodeScroll),a&&(a.scrollTo(r.left,r.top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||a.scrollY===r.top&&a.scrollX===r.left||(s.documentElement.style.top=-r.top+"px",s.documentElement.style.left=-r.left+"px",s.documentElement.style.position="absolute")),t=this.options.onclone,void 0===this.clonedReferenceElement?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:s.fonts&&s.fonts.ready?[4,s.fonts.ready]:[3,2];case 1:e.sent(),e.label=2;case 2:return"function"==typeof t?[2,Promise.resolve().then(function(){return t(s)}).then(function(){return n})]:[2,n]}})})});return s.open(),s.write(serializeDoctype(document.doctype)+"<html></html>"),restoreOwnerScroll(this.referenceElement.ownerDocument,i,o),s.replaceChild(s.adoptNode(this.documentElement),s.documentElement),s.close(),e},e.prototype.createElementClone=function(e){if(isCanvasElement(e))return this.createCanvasClone(e);if(isStyleElement(e))return this.createStyleClone(e);e=e.cloneNode(!1);return isImageElement(e)&&"lazy"===e.loading&&(e.loading="eager"),e},e.prototype.createStyleClone=function(e){try{var t=e.sheet;if(t&&t.cssRules){var r=[].slice.call(t.cssRules,0).reduce(function(e,t){return t&&"string"==typeof t.cssText?e+t.cssText:e},""),n=e.cloneNode(!1);return n.textContent=r,n}}catch(e){if(Logger$1.getInstance(this.options.id).error("Unable to access cssRules property",e),"SecurityError"!==e.name)throw e}return e.cloneNode(!1)},e.prototype.createCanvasClone=function(e){if(this.options.inlineImages&&e.ownerDocument){var t=e.ownerDocument.createElement("img");try{return t.src=e.toDataURL(),t}catch(e){Logger$1.getInstance(this.options.id).info("Unable to clone canvas contents, canvas is tainted")}}t=e.cloneNode(!1);try{t.width=e.width,t.height=e.height;var r=e.getContext("2d"),n=t.getContext("2d");return n&&(r?n.putImageData(r.getImageData(0,0,e.width,e.height),0,0):n.drawImage(e,0,0)),t}catch(e){}return t},e.prototype.cloneNode=function(e){if(isTextNode(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var t=e.ownerDocument.defaultView;if(t&&isElementNode(e)&&(isHTMLElementNode(e)||isSVGElementNode(e))){var r=this.createElementClone(e),n=t.getComputedStyle(e),i=t.getComputedStyle(e,":before"),o=t.getComputedStyle(e,":after");this.referenceElement===e&&isHTMLElementNode(r)&&(this.clonedReferenceElement=r),isBodyElement(r)&&createPseudoHideStyles(r);for(var t=this.counters.parse(new CSSParsedCounterDeclaration(n)),i=this.resolvePseudoContent(e,r,i,PseudoElementType.BEFORE),a=e.firstChild;a;a=a.nextSibling)isElementNode(a)&&(isScriptElement(a)||a.hasAttribute(IGNORE_ATTRIBUTE)||"function"==typeof this.options.ignoreElements&&this.options.ignoreElements(a))||this.options.copyStyles&&isElementNode(a)&&isStyleElement(a)||r.appendChild(this.cloneNode(a));i&&r.insertBefore(i,r.firstChild);o=this.resolvePseudoContent(e,r,o,PseudoElementType.AFTER);return o&&r.appendChild(o),this.counters.pop(t),n&&(this.options.copyStyles||isSVGElementNode(e))&&!isIFrameElement(e)&&copyCSSStyles(n,r),0===e.scrollTop&&0===e.scrollLeft||this.scrolledElements.push([r,e.scrollLeft,e.scrollTop]),(isTextareaElement(e)||isSelectElement(e))&&(isTextareaElement(r)||isSelectElement(r))&&(r.value=e.value),r}return e.cloneNode(!1)},e.prototype.resolvePseudoContent=function(s,e,t,r){var l=this;if(t){var n=t.content,c=e.ownerDocument;if(c&&n&&"none"!==n&&"-moz-alt-content"!==n&&"none"!==t.display){this.counters.parse(new CSSParsedCounterDeclaration(t));var h=new CSSParsedPseudoDeclaration(t),u=c.createElement("html2canvaspseudoelement");copyCSSStyles(t,u),h.content.forEach(function(e){if(e.type===TokenType.STRING_TOKEN)u.appendChild(c.createTextNode(e.value));else if(e.type===TokenType.URL_TOKEN){var t=c.createElement("img");t.src=e.value,t.style.opacity="1",u.appendChild(t)}else if(e.type===TokenType.FUNCTION){var r,n,i,o,a;"attr"===e.name?(t=e.values.filter(isIdentToken)).length&&u.appendChild(c.createTextNode(s.getAttribute(t[0].value)||"")):"counter"===e.name?(i=(n=e.values.filter(nonFunctionArgSeparator))[0],n=n[1],i&&isIdentToken(i)&&(r=l.counters.getCounterValue(i.value),a=n&&isIdentToken(n)?listStyleType.parse(n.value):LIST_STYLE_TYPE.DECIMAL,u.appendChild(c.createTextNode(createCounterText(r,a,!1))))):"counters"===e.name&&(i=(r=e.values.filter(nonFunctionArgSeparator))[0],a=r[1],n=r[2],i&&isIdentToken(i)&&(i=l.counters.getCounterValues(i.value),o=n&&isIdentToken(n)?listStyleType.parse(n.value):LIST_STYLE_TYPE.DECIMAL,a=a&&a.type===TokenType.STRING_TOKEN?a.value:"",a=i.map(function(e){return createCounterText(e,o,!1)}).join(a),u.appendChild(c.createTextNode(a))))}else if(e.type===TokenType.IDENT_TOKEN)switch(e.value){case"open-quote":u.appendChild(c.createTextNode(getQuote(h.quotes,l.quoteDepth++,!0)));break;case"close-quote":u.appendChild(c.createTextNode(getQuote(h.quotes,--l.quoteDepth,!1)));break;default:u.appendChild(c.createTextNode(e.value))}}),u.className=PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+" "+PSEUDO_HIDE_ELEMENT_CLASS_AFTER;r=r===PseudoElementType.BEFORE?" "+PSEUDO_HIDE_ELEMENT_CLASS_BEFORE:" "+PSEUDO_HIDE_ELEMENT_CLASS_AFTER;return isSVGElementNode(e)?e.className.baseValue+=r:e.className+=r,u}}},e.destroy=function(e){return!!e.parentNode&&(e.parentNode.removeChild(e),!0)},e}();!function(e){e[e.BEFORE=0]="BEFORE",e[e.AFTER=1]="AFTER"}(PseudoElementType=PseudoElementType||{});var PathType,createIFrameContainer=function(e,t){var r=e.createElement("iframe");return r.className="html2canvas-container",r.style.visibility="hidden",r.style.position="fixed",r.style.left="-10000px",r.style.top="0px",r.style.border="0",r.width=t.width.toString(),r.height=t.height.toString(),r.scrolling="no",r.setAttribute(IGNORE_ATTRIBUTE,"true"),e.body.appendChild(r),r},iframeLoader=function(i){return new Promise(function(t,e){var r=i.contentWindow;if(!r)return e("No window assigned for iframe");var n=r.document;r.onload=i.onload=n.onreadystatechange=function(){r.onload=i.onload=n.onreadystatechange=null;var e=setInterval(function(){0<n.body.childNodes.length&&"complete"===n.readyState&&(clearInterval(e),t(i))},50)}})},copyCSSStyles=function(e,t){for(var r=e.length-1;0<=r;r--){var n=e.item(r);"content"!==n&&t.style.setProperty(n,e.getPropertyValue(n))}return t},serializeDoctype=function(e){var t="";return e&&(t+="<!DOCTYPE ",e.name&&(t+=e.name),e.internalSubset&&(t+=e.internalSubset),e.publicId&&(t+='"'+e.publicId+'"'),e.systemId&&(t+='"'+e.systemId+'"'),t+=">"),t},restoreOwnerScroll=function(e,t,r){e&&e.defaultView&&(t!==e.defaultView.pageXOffset||r!==e.defaultView.pageYOffset)&&e.defaultView.scrollTo(t,r)},restoreNodeScroll=function(e){var t=e[0],r=e[1],e=e[2];t.scrollLeft=r,t.scrollTop=e},PSEUDO_BEFORE=":before",PSEUDO_AFTER=":after",PSEUDO_HIDE_ELEMENT_CLASS_BEFORE="___html2canvas___pseudoelement_before",PSEUDO_HIDE_ELEMENT_CLASS_AFTER="___html2canvas___pseudoelement_after",PSEUDO_HIDE_ELEMENT_STYLE='{\n    content: "" !important;\n    display: none !important;\n}',createPseudoHideStyles=function(e){createStyles(e,"."+PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+PSEUDO_BEFORE+PSEUDO_HIDE_ELEMENT_STYLE+"\n         ."+PSEUDO_HIDE_ELEMENT_CLASS_AFTER+PSEUDO_AFTER+PSEUDO_HIDE_ELEMENT_STYLE)},createStyles=function(e,t){var r=e.ownerDocument;r&&((r=r.createElement("style")).textContent=t,e.appendChild(r))};!function(e){e[e.VECTOR=0]="VECTOR",e[e.BEZIER_CURVE=1]="BEZIER_CURVE"}(PathType=PathType||{});var CORNER,equalPath=function(e,r){return e.length===r.length&&e.some(function(e,t){return e===r[t]})},transformPath=function(e,r,n,i,o){return e.map(function(e,t){switch(t){case 0:return e.add(r,n);case 1:return e.add(r+i,n);case 2:return e.add(r+i,n+o);case 3:return e.add(r,n+o)}return e})},Vector=function(){function r(e,t){this.type=PathType.VECTOR,this.x=e,this.y=t}return r.prototype.add=function(e,t){return new r(this.x+e,this.y+t)},r}(),lerp=function(e,t,r){return new Vector(e.x+(t.x-e.x)*r,e.y+(t.y-e.y)*r)},BezierCurve=function(){function a(e,t,r,n){this.type=PathType.BEZIER_CURVE,this.start=e,this.startControl=t,this.endControl=r,this.end=n}return a.prototype.subdivide=function(e,t){var r=lerp(this.start,this.startControl,e),n=lerp(this.startControl,this.endControl,e),i=lerp(this.endControl,this.end,e),o=lerp(r,n,e),n=lerp(n,i,e),e=lerp(o,n,e);return t?new a(this.start,r,o,e):new a(e,n,i,this.end)},a.prototype.add=function(e,t){return new a(this.start.add(e,t),this.startControl.add(e,t),this.endControl.add(e,t),this.end.add(e,t))},a.prototype.reverse=function(){return new a(this.end,this.endControl,this.startControl,this.start)},a}(),isBezierCurve=function(e){return e.type===PathType.BEZIER_CURVE},BoundCurves=function(e){var t=e.styles,r=e.bounds,n=(f=getAbsoluteValueForTuple(t.borderTopLeftRadius,r.width,r.height))[0],i=f[1],o=(g=getAbsoluteValueForTuple(t.borderTopRightRadius,r.width,r.height))[0],a=g[1],s=(v=getAbsoluteValueForTuple(t.borderBottomRightRadius,r.width,r.height))[0],l=v[1],c=(_=getAbsoluteValueForTuple(t.borderBottomLeftRadius,r.width,r.height))[0],h=_[1];(y=[]).push((n+o)/r.width),y.push((c+s)/r.width),y.push((i+h)/r.height),y.push((a+l)/r.height),1<(w=Math.max.apply(Math,y))&&(n/=w,i/=w,o/=w,a/=w,s/=w,l/=w,c/=w,h/=w);var u=r.width-o,A=r.height-l,d=r.width-s,p=r.height-h,m=t.borderTopWidth,f=t.borderRightWidth,g=t.borderBottomWidth,v=t.borderLeftWidth,_=getAbsoluteValue(t.paddingTop,e.bounds.width),y=getAbsoluteValue(t.paddingRight,e.bounds.width),w=getAbsoluteValue(t.paddingBottom,e.bounds.width),e=getAbsoluteValue(t.paddingLeft,e.bounds.width);this.topLeftBorderBox=0<n||0<i?getCurvePoints(r.left,r.top,n,i,CORNER.TOP_LEFT):new Vector(r.left,r.top),this.topRightBorderBox=0<o||0<a?getCurvePoints(r.left+u,r.top,o,a,CORNER.TOP_RIGHT):new Vector(r.left+r.width,r.top),this.bottomRightBorderBox=0<s||0<l?getCurvePoints(r.left+d,r.top+A,s,l,CORNER.BOTTOM_RIGHT):new Vector(r.left+r.width,r.top+r.height),this.bottomLeftBorderBox=0<c||0<h?getCurvePoints(r.left,r.top+p,c,h,CORNER.BOTTOM_LEFT):new Vector(r.left,r.top+r.height),this.topLeftPaddingBox=0<n||0<i?getCurvePoints(r.left+v,r.top+m,Math.max(0,n-v),Math.max(0,i-m),CORNER.TOP_LEFT):new Vector(r.left+v,r.top+m),this.topRightPaddingBox=0<o||0<a?getCurvePoints(r.left+Math.min(u,r.width+v),r.top+m,u>r.width+v?0:o-v,a-m,CORNER.TOP_RIGHT):new Vector(r.left+r.width-f,r.top+m),this.bottomRightPaddingBox=0<s||0<l?getCurvePoints(r.left+Math.min(d,r.width-v),r.top+Math.min(A,r.height+m),Math.max(0,s-f),l-g,CORNER.BOTTOM_RIGHT):new Vector(r.left+r.width-f,r.top+r.height-g),this.bottomLeftPaddingBox=0<c||0<h?getCurvePoints(r.left+v,r.top+p,Math.max(0,c-v),h-g,CORNER.BOTTOM_LEFT):new Vector(r.left+v,r.top+r.height-g),this.topLeftContentBox=0<n||0<i?getCurvePoints(r.left+v+e,r.top+m+_,Math.max(0,n-(v+e)),Math.max(0,i-(m+_)),CORNER.TOP_LEFT):new Vector(r.left+v+e,r.top+m+_),this.topRightContentBox=0<o||0<a?getCurvePoints(r.left+Math.min(u,r.width+v+e),r.top+m+_,u>r.width+v+e?0:o-v+e,a-(m+_),CORNER.TOP_RIGHT):new Vector(r.left+r.width-(f+y),r.top+m+_),this.bottomRightContentBox=0<s||0<l?getCurvePoints(r.left+Math.min(d,r.width-(v+e)),r.top+Math.min(A,r.height+m+_),Math.max(0,s-(f+y)),l-(g+w),CORNER.BOTTOM_RIGHT):new Vector(r.left+r.width-(f+y),r.top+r.height-(g+w)),this.bottomLeftContentBox=0<c||0<h?getCurvePoints(r.left+v+e,r.top+p,Math.max(0,c-(v+e)),h-(g+w),CORNER.BOTTOM_LEFT):new Vector(r.left+v+e,r.top+r.height-(g+w))};!function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_RIGHT=1]="TOP_RIGHT",e[e.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",e[e.BOTTOM_LEFT=3]="BOTTOM_LEFT"}(CORNER=CORNER||{});var getCurvePoints=function(e,t,r,n,i){var o=(Math.sqrt(2)-1)/3*4,a=r*o,s=n*o,l=e+r,c=t+n;switch(i){case CORNER.TOP_LEFT:return new BezierCurve(new Vector(e,c),new Vector(e,c-s),new Vector(l-a,t),new Vector(l,t));case CORNER.TOP_RIGHT:return new BezierCurve(new Vector(e,t),new Vector(e+a,t),new Vector(l,c-s),new Vector(l,c));case CORNER.BOTTOM_RIGHT:return new BezierCurve(new Vector(l,t),new Vector(l,t+s),new Vector(e+a,c),new Vector(e,c));default:CORNER.BOTTOM_LEFT;return new BezierCurve(new Vector(l,c),new Vector(l-a,c),new Vector(e,t+s),new Vector(e,t))}},calculateBorderBoxPath=function(e){return[e.topLeftBorderBox,e.topRightBorderBox,e.bottomRightBorderBox,e.bottomLeftBorderBox]},calculateContentBoxPath=function(e){return[e.topLeftContentBox,e.topRightContentBox,e.bottomRightContentBox,e.bottomLeftContentBox]},calculatePaddingBoxPath=function(e){return[e.topLeftPaddingBox,e.topRightPaddingBox,e.bottomRightPaddingBox,e.bottomLeftPaddingBox]},TransformEffect=function(e,t,r){this.type=0,this.offsetX=e,this.offsetY=t,this.matrix=r,this.target=6},ClipEffect=function(e,t){this.type=1,this.target=t,this.path=e},isTransformEffect=function(e){return 0===e.type},isClipEffect=function(e){return 1===e.type},StackingContext=function(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]},ElementPaint=function(){function e(e,t){var r,n;this.container=e,this.effects=t.slice(0),this.curves=new BoundCurves(e),null!==e.styles.transform&&(r=e.bounds.left+e.styles.transformOrigin[0].number,t=e.bounds.top+e.styles.transformOrigin[1].number,n=e.styles.transform,this.effects.push(new TransformEffect(r,t,n))),e.styles.overflowX!==OVERFLOW.VISIBLE&&(n=calculateBorderBoxPath(this.curves),e=calculatePaddingBoxPath(this.curves),equalPath(n,e)?this.effects.push(new ClipEffect(n,6)):(this.effects.push(new ClipEffect(n,2)),this.effects.push(new ClipEffect(e,4))))}return e.prototype.getParentEffects=function(){var e,t,r=this.effects.slice(0);return this.container.styles.overflowX!==OVERFLOW.VISIBLE&&(e=calculateBorderBoxPath(this.curves),t=calculatePaddingBoxPath(this.curves),equalPath(e,t)||r.push(new ClipEffect(t,6))),r},e}(),parseStackTree=function(c,h,u,A){c.container.elements.forEach(function(e){var t=contains(e.flags,4),r=contains(e.flags,2),n=new ElementPaint(e,c.getParentEffects());contains(e.styles.display,2048)&&A.push(n);var i,o,a,s,l=contains(e.flags,8)?[]:A;t||r?(i=t||e.styles.isPositioned()?u:h,r=new StackingContext(n),e.styles.isPositioned()||e.styles.opacity<1||e.styles.isTransformed()?(o=e.styles.zIndex.order)<0?(a=0,i.negativeZIndex.some(function(e,t){return o>e.element.container.styles.zIndex.order?(a=t,!1):0<a}),i.negativeZIndex.splice(a,0,r)):0<o?(s=0,i.positiveZIndex.some(function(e,t){return o>=e.element.container.styles.zIndex.order?(s=t+1,!1):0<s}),i.positiveZIndex.splice(s,0,r)):i.zeroOrAutoZIndexOrTransformedOrOpacity.push(r):(e.styles.isFloating()?i.nonPositionedFloats:i.nonPositionedInlineLevel).push(r),parseStackTree(n,r,t?r:u,l)):((e.styles.isInlineLevel()?h.inlineLevel:h.nonInlineLevel).push(n),parseStackTree(n,h,u,l)),contains(e.flags,8)&&processListItems(e,l)})},processListItems=function(e,t){for(var r=e instanceof OLElementContainer?e.start:1,n=e instanceof OLElementContainer&&e.reversed,i=0;i<t.length;i++){var o=t[i];o.container instanceof LIElementContainer&&"number"==typeof o.container.value&&0!==o.container.value&&(r=o.container.value),o.listValue=createCounterText(r,o.container.styles.listStyleType,!0),r+=n?-1:1}},parseStackingContexts=function(e){var t=new ElementPaint(e,[]),r=new StackingContext(t),e=[];return parseStackTree(t,r,r,e),processListItems(t.container,e),r},parsePathForBorder=function(e,t){switch(t){case 0:return createPathFromCurves(e.topLeftBorderBox,e.topLeftPaddingBox,e.topRightBorderBox,e.topRightPaddingBox);case 1:return createPathFromCurves(e.topRightBorderBox,e.topRightPaddingBox,e.bottomRightBorderBox,e.bottomRightPaddingBox);case 2:return createPathFromCurves(e.bottomRightBorderBox,e.bottomRightPaddingBox,e.bottomLeftBorderBox,e.bottomLeftPaddingBox);default:return createPathFromCurves(e.bottomLeftBorderBox,e.bottomLeftPaddingBox,e.topLeftBorderBox,e.topLeftPaddingBox)}},createPathFromCurves=function(e,t,r,n){var i=[];return isBezierCurve(e)?i.push(e.subdivide(.5,!1)):i.push(e),isBezierCurve(r)?i.push(r.subdivide(.5,!0)):i.push(r),isBezierCurve(n)?i.push(n.subdivide(.5,!0).reverse()):i.push(n),isBezierCurve(t)?i.push(t.subdivide(.5,!1).reverse()):i.push(t),i},paddingBox=function(e){var t=e.bounds,e=e.styles;return t.add(e.borderLeftWidth,e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth),-(e.borderTopWidth+e.borderBottomWidth))},contentBox=function(e){var t=e.styles,r=e.bounds,n=getAbsoluteValue(t.paddingLeft,r.width),i=getAbsoluteValue(t.paddingRight,r.width),o=getAbsoluteValue(t.paddingTop,r.width),e=getAbsoluteValue(t.paddingBottom,r.width);return r.add(n+t.borderLeftWidth,o+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+n+i),-(t.borderTopWidth+t.borderBottomWidth+o+e))},calculateBackgroundPositioningArea=function(e,t){return 0===e?t.bounds:(2===e?contentBox:paddingBox)(t)},calculateBackgroundPaintingArea=function(e,t){return e===BACKGROUND_CLIP.BORDER_BOX?t.bounds:(e===BACKGROUND_CLIP.CONTENT_BOX?contentBox:paddingBox)(t)},calculateBackgroundRendering=function(e,t,r){var n=calculateBackgroundPositioningArea(getBackgroundValueForIndex(e.styles.backgroundOrigin,t),e),i=calculateBackgroundPaintingArea(getBackgroundValueForIndex(e.styles.backgroundClip,t),e),o=calculateBackgroundSize(getBackgroundValueForIndex(e.styles.backgroundSize,t),r,n),a=o[0],s=o[1],r=getAbsoluteValueForTuple(getBackgroundValueForIndex(e.styles.backgroundPosition,t),n.width-a,n.height-s);return[calculateBackgroundRepeatPath(getBackgroundValueForIndex(e.styles.backgroundRepeat,t),r,o,n,i),Math.round(n.left+r[0]),Math.round(n.top+r[1]),a,s]},isAuto=function(e){return isIdentToken(e)&&e.value===BACKGROUND_SIZE.AUTO},hasIntrinsicValue=function(e){return"number"==typeof e},calculateBackgroundSize=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=e[0],s=e[1];if(isLengthPercentage(a)&&s&&isLengthPercentage(s))return[getAbsoluteValue(a,r.width),getAbsoluteValue(s,r.height)];var l=hasIntrinsicValue(o);if(isIdentToken(a)&&(a.value===BACKGROUND_SIZE.CONTAIN||a.value===BACKGROUND_SIZE.COVER))return hasIntrinsicValue(o)?r.width/r.height<o!=(a.value===BACKGROUND_SIZE.COVER)?[r.width,r.width/o]:[r.height*o,r.height]:[r.width,r.height];var c=hasIntrinsicValue(n),t=hasIntrinsicValue(i),e=c||t;if(isAuto(a)&&(!s||isAuto(s)))return c&&t?[n,i]:l||e?e&&l?[c?n:i*o,t?i:n/o]:[c?n:r.width,t?i:r.height]:[r.width,r.height];if(l){var h=0,u=0;return isLengthPercentage(a)?h=getAbsoluteValue(a,r.width):isLengthPercentage(s)&&(u=getAbsoluteValue(s,r.height)),isAuto(a)?h=u*o:s&&!isAuto(s)||(u=h/o),[h,u]}h=null,u=null;if(isLengthPercentage(a)?h=getAbsoluteValue(a,r.width):s&&isLengthPercentage(s)&&(u=getAbsoluteValue(s,r.height)),null!==(h=null!==(u=null!==h&&(!s||isAuto(s))?c&&t?h/n*i:r.height:u)&&isAuto(a)?c&&t?u/i*n:r.width:h)&&null!==u)return[h,u];throw new Error("Unable to calculate background-size for element")},getBackgroundValueForIndex=function(e,t){t=e[t];return void 0===t?e[0]:t},calculateBackgroundRepeatPath=function(e,t,r,n,i){var o=t[0],a=t[1],s=r[0],l=r[1];switch(e){case BACKGROUND_REPEAT.REPEAT_X:return[new Vector(Math.round(n.left),Math.round(n.top+a)),new Vector(Math.round(n.left+n.width),Math.round(n.top+a)),new Vector(Math.round(n.left+n.width),Math.round(l+n.top+a)),new Vector(Math.round(n.left),Math.round(l+n.top+a))];case BACKGROUND_REPEAT.REPEAT_Y:return[new Vector(Math.round(n.left+o),Math.round(n.top)),new Vector(Math.round(n.left+o+s),Math.round(n.top)),new Vector(Math.round(n.left+o+s),Math.round(n.height+n.top)),new Vector(Math.round(n.left+o),Math.round(n.height+n.top))];case BACKGROUND_REPEAT.NO_REPEAT:return[new Vector(Math.round(n.left+o),Math.round(n.top+a)),new Vector(Math.round(n.left+o+s),Math.round(n.top+a)),new Vector(Math.round(n.left+o+s),Math.round(n.top+a+l)),new Vector(Math.round(n.left+o),Math.round(n.top+a+l))];default:return[new Vector(Math.round(i.left),Math.round(i.top)),new Vector(Math.round(i.left+i.width),Math.round(i.top)),new Vector(Math.round(i.left+i.width),Math.round(i.height+i.top)),new Vector(Math.round(i.left),Math.round(i.height+i.top))]}},SMALL_IMAGE="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",SAMPLE_TEXT="Hidden Text",FontMetrics=function(){function e(e){this._data={},this._document=e}return e.prototype.parseMetrics=function(e,t){var r=this._document.createElement("div"),n=this._document.createElement("img"),i=this._document.createElement("span"),o=this._document.body;r.style.visibility="hidden",r.style.fontFamily=e,r.style.fontSize=t,r.style.margin="0",r.style.padding="0",o.appendChild(r),n.src=SMALL_IMAGE,n.width=1,n.height=1,n.style.margin="0",n.style.padding="0",n.style.verticalAlign="baseline",i.style.fontFamily=e,i.style.fontSize=t,i.style.margin="0",i.style.padding="0",i.appendChild(this._document.createTextNode(SAMPLE_TEXT)),r.appendChild(i),r.appendChild(n);t=n.offsetTop-i.offsetTop+2;r.removeChild(i),r.appendChild(this._document.createTextNode(SAMPLE_TEXT)),r.style.lineHeight="normal",n.style.verticalAlign="super";n=n.offsetTop-r.offsetTop+2;return o.removeChild(r),{baseline:t,middle:n}},e.prototype.getMetrics=function(e,t){var r=e+" "+t;return void 0===this._data[r]&&(this._data[r]=this.parseMetrics(e,t)),this._data[r]},e}(),MASK_OFFSET=1e4,CanvasRenderer$1=function(){function d(e){this._activeEffects=[],this.canvas=e.canvas||document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),(this.options=e).canvas||(this.canvas.width=Math.floor(e.width*e.scale),this.canvas.height=Math.floor(e.height*e.scale),this.canvas.style.width=e.width+"px",this.canvas.style.height=e.height+"px"),this.fontMetrics=new FontMetrics(document),this.ctx.scale(this.options.scale,this.options.scale),this.ctx.translate(-e.x+e.scrollX,-e.y+e.scrollY),this.ctx.textBaseline="bottom",this._activeEffects=[],Logger$1.getInstance(e.id).debug("Canvas renderer initialized ("+e.width+"x"+e.height+" at "+e.x+","+e.y+") with scale "+e.scale)}return d.prototype.applyEffects=function(e,t){for(var r=this;this._activeEffects.length;)this.popEffect();e.filter(function(e){return contains(e.target,t)}).forEach(function(e){return r.applyEffect(e)})},d.prototype.applyEffect=function(e){this.ctx.save(),isTransformEffect(e)&&(this.ctx.translate(e.offsetX,e.offsetY),this.ctx.transform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this.ctx.translate(-e.offsetX,-e.offsetY)),isClipEffect(e)&&(this.path(e.path),this.ctx.clip()),this._activeEffects.push(e)},d.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},d.prototype.renderStack=function(r){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return(t=r.element.container.styles).isVisible()?(this.ctx.globalAlpha=t.opacity,[4,this.renderStackContent(r)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},d.prototype.renderNode=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return t.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(t)]:[3,3];case 1:return e.sent(),[4,this.renderNodeContent(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},d.prototype.renderTextWithLetterSpacing=function(r,e){var n=this;0===e?this.ctx.fillText(r.text,r.bounds.left,r.bounds.top+r.bounds.height):toCodePoints(r.text).map(function(e){return fromCodePoint(e)}).reduce(function(e,t){return n.ctx.fillText(t,e,r.bounds.top+r.bounds.height),e+n.ctx.measureText(t).width},r.bounds.left)},d.prototype.createFontStyle=function(e){var t=e.fontVariant.filter(function(e){return"normal"===e||"small-caps"===e}).join(""),r=e.fontFamily.join(", "),n=isDimensionToken(e.fontSize)?""+e.fontSize.number+e.fontSize.unit:e.fontSize.number+"px";return[[e.fontStyle,t,e.fontWeight,n,r].join(" "),r,n]},d.prototype.renderTextNode=function(a,s){return __awaiter(this,void 0,void 0,function(){var t,r,n,i,o=this;return __generator(this,function(e){return t=this.createFontStyle(s),r=t[0],n=t[1],i=t[2],this.ctx.font=r,a.textBounds.forEach(function(r){o.ctx.fillStyle=asString(s.color),o.renderTextWithLetterSpacing(r,s.letterSpacing);var e=s.textShadow;e.length&&r.text.trim().length&&(e.slice(0).reverse().forEach(function(e){o.ctx.shadowColor=asString(e.color),o.ctx.shadowOffsetX=e.offsetX.number*o.options.scale,o.ctx.shadowOffsetY=e.offsetY.number*o.options.scale,o.ctx.shadowBlur=e.blur.number,o.ctx.fillText(r.text,r.bounds.left,r.bounds.top+r.bounds.height)}),o.ctx.shadowColor="",o.ctx.shadowOffsetX=0,o.ctx.shadowOffsetY=0,o.ctx.shadowBlur=0),s.textDecorationLine.length&&(o.ctx.fillStyle=asString(s.textDecorationColor||s.color),s.textDecorationLine.forEach(function(e){switch(e){case 1:var t=o.fontMetrics.getMetrics(n,i).baseline;o.ctx.fillRect(r.bounds.left,Math.round(r.bounds.top+t),r.bounds.width,1);break;case 2:o.ctx.fillRect(r.bounds.left,Math.round(r.bounds.top),r.bounds.width,1);break;case 3:t=o.fontMetrics.getMetrics(n,i).middle;o.ctx.fillRect(r.bounds.left,Math.ceil(r.bounds.top+t),r.bounds.width,1)}}))}),[2]})})},d.prototype.renderReplacedElement=function(e,t,r){var n;r&&0<e.intrinsicWidth&&0<e.intrinsicHeight&&(n=contentBox(e),t=calculatePaddingBoxPath(t),this.path(t),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(r,0,0,e.intrinsicWidth,e.intrinsicHeight,n.left,n.top,n.width,n.height),this.ctx.restore())},d.prototype.renderNodeContent=function(A){return __awaiter(this,void 0,void 0,function(){var t,r,n,i,o,a,s,l,c,h,u;return __generator(this,function(e){switch(e.label){case 0:this.applyEffects(A.effects,4),t=A.container,r=A.curves,n=t.styles,i=0,o=t.textNodes,e.label=1;case 1:return i<o.length?(a=o[i],[4,this.renderTextNode(a,n)]):[3,4];case 2:e.sent(),e.label=3;case 3:return i++,[3,1];case 4:if(!(t instanceof ImageElementContainer))return[3,8];e.label=5;case 5:return e.trys.push([5,7,,8]),[4,this.options.cache.match(t.src)];case 6:return c=e.sent(),this.renderReplacedElement(t,r,c),[3,8];case 7:return e.sent(),Logger$1.getInstance(this.options.id).error("Error loading image "+t.src),[3,8];case 8:if(t instanceof CanvasElementContainer&&this.renderReplacedElement(t,r,t.canvas),!(t instanceof SVGElementContainer))return[3,12];e.label=9;case 9:return e.trys.push([9,11,,12]),[4,this.options.cache.match(t.svg)];case 10:return c=e.sent(),this.renderReplacedElement(t,r,c),[3,12];case 11:return e.sent(),Logger$1.getInstance(this.options.id).error("Error loading svg "+t.svg.substring(0,255)),[3,12];case 12:return t instanceof IFrameElementContainer&&t.tree?[4,new d({id:this.options.id,scale:this.options.scale,backgroundColor:t.backgroundColor,x:0,y:0,scrollX:0,scrollY:0,width:t.width,height:t.height,cache:this.options.cache,windowWidth:t.width,windowHeight:t.height}).render(t.tree)]:[3,14];case 13:s=e.sent(),t.width&&t.height&&this.ctx.drawImage(s,0,0,t.width,t.height,t.bounds.left,t.bounds.top,t.bounds.width,t.bounds.height),e.label=14;case 14:if(t instanceof InputElementContainer&&(s=Math.min(t.bounds.width,t.bounds.height),t.type===CHECKBOX?t.checked&&(this.ctx.save(),this.path([new Vector(t.bounds.left+.39363*s,t.bounds.top+.79*s),new Vector(t.bounds.left+.16*s,t.bounds.top+.5549*s),new Vector(t.bounds.left+.27347*s,t.bounds.top+.44071*s),new Vector(t.bounds.left+.39694*s,t.bounds.top+.5649*s),new Vector(t.bounds.left+.72983*s,t.bounds.top+.23*s),new Vector(t.bounds.left+.84*s,t.bounds.top+.34085*s),new Vector(t.bounds.left+.39363*s,t.bounds.top+.79*s)]),this.ctx.fillStyle=asString(INPUT_COLOR),this.ctx.fill(),this.ctx.restore()):t.type===RADIO&&t.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(t.bounds.left+s/2,t.bounds.top+s/2,s/4,0,2*Math.PI,!0),this.ctx.fillStyle=asString(INPUT_COLOR),this.ctx.fill(),this.ctx.restore())),isTextInputElement(t)&&t.value.length){switch(this.ctx.font=this.createFontStyle(n)[0],this.ctx.fillStyle=asString(n.color),this.ctx.textBaseline="middle",this.ctx.textAlign=canvasTextAlign(t.styles.textAlign),u=contentBox(t),l=0,t.styles.textAlign){case TEXT_ALIGN.CENTER:l+=u.width/2;break;case TEXT_ALIGN.RIGHT:l+=u.width}h=u.add(l,0,0,-u.height/2+1),this.ctx.save(),this.path([new Vector(u.left,u.top),new Vector(u.left+u.width,u.top),new Vector(u.left+u.width,u.top+u.height),new Vector(u.left,u.top+u.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new TextBounds(t.value,h),n.letterSpacing),this.ctx.restore(),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"}if(!contains(t.styles.display,2048))return[3,20];if(null===t.styles.listStyleImage)return[3,19];if((h=t.styles.listStyleImage).type!==CSSImageType.URL)return[3,18];c=void 0,h=h.url,e.label=15;case 15:return e.trys.push([15,17,,18]),[4,this.options.cache.match(h)];case 16:return c=e.sent(),this.ctx.drawImage(c,t.bounds.left-(c.width+10),t.bounds.top),[3,18];case 17:return e.sent(),Logger$1.getInstance(this.options.id).error("Error loading list-style-image "+h),[3,18];case 18:return[3,20];case 19:A.listValue&&t.styles.listStyleType!==LIST_STYLE_TYPE.NONE&&(this.ctx.font=this.createFontStyle(n)[0],this.ctx.fillStyle=asString(n.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",u=new Bounds(t.bounds.left,t.bounds.top+getAbsoluteValue(t.styles.paddingTop,t.bounds.width),t.bounds.width,computeLineHeight(n.lineHeight,n.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new TextBounds(A.listValue,u),n.letterSpacing),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),e.label=20;case 20:return[2]}})})},d.prototype.renderStackContent=function(f){return __awaiter(this,void 0,void 0,function(){var t,r,n,i,o,a,s,l,c,h,u,A,d,p,m;return __generator(this,function(e){switch(e.label){case 0:return[4,this.renderNodeBackgroundAndBorders(f.element)];case 1:e.sent(),t=0,r=f.negativeZIndex,e.label=2;case 2:return t<r.length?(m=r[t],[4,this.renderStack(m)]):[3,5];case 3:e.sent(),e.label=4;case 4:return t++,[3,2];case 5:return[4,this.renderNodeContent(f.element)];case 6:e.sent(),n=0,i=f.nonInlineLevel,e.label=7;case 7:return n<i.length?(m=i[n],[4,this.renderNode(m)]):[3,10];case 8:e.sent(),e.label=9;case 9:return n++,[3,7];case 10:o=0,a=f.nonPositionedFloats,e.label=11;case 11:return o<a.length?(m=a[o],[4,this.renderStack(m)]):[3,14];case 12:e.sent(),e.label=13;case 13:return o++,[3,11];case 14:s=0,l=f.nonPositionedInlineLevel,e.label=15;case 15:return s<l.length?(m=l[s],[4,this.renderStack(m)]):[3,18];case 16:e.sent(),e.label=17;case 17:return s++,[3,15];case 18:c=0,h=f.inlineLevel,e.label=19;case 19:return c<h.length?(m=h[c],[4,this.renderNode(m)]):[3,22];case 20:e.sent(),e.label=21;case 21:return c++,[3,19];case 22:u=0,A=f.zeroOrAutoZIndexOrTransformedOrOpacity,e.label=23;case 23:return u<A.length?(m=A[u],[4,this.renderStack(m)]):[3,26];case 24:e.sent(),e.label=25;case 25:return u++,[3,23];case 26:d=0,p=f.positiveZIndex,e.label=27;case 27:return d<p.length?(m=p[d],[4,this.renderStack(m)]):[3,30];case 28:e.sent(),e.label=29;case 29:return d++,[3,27];case 30:return[2]}})})},d.prototype.mask=function(e){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(e.slice(0).reverse()),this.ctx.closePath()},d.prototype.path=function(e){this.ctx.beginPath(),this.formatPath(e),this.ctx.closePath()},d.prototype.formatPath=function(e){var n=this;e.forEach(function(e,t){var r=isBezierCurve(e)?e.start:e;0===t?n.ctx.moveTo(r.x,r.y):n.ctx.lineTo(r.x,r.y),isBezierCurve(e)&&n.ctx.bezierCurveTo(e.startControl.x,e.startControl.y,e.endControl.x,e.endControl.y,e.end.x,e.end.y)})},d.prototype.renderRepeat=function(e,t,r,n){this.path(e),this.ctx.fillStyle=t,this.ctx.translate(r,n),this.ctx.fill(),this.ctx.translate(-r,-n)},d.prototype.resizeImage=function(e,t,r){if(e.width===t&&e.height===r)return e;var n=this.canvas.ownerDocument.createElement("canvas");return n.width=t,n.height=r,n.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t,r),n},d.prototype.renderBackgroundImage=function(w){return __awaiter(this,void 0,void 0,function(){var _,t,y,r,n,i;return __generator(this,function(e){switch(e.label){case 0:_=w.styles.backgroundImage.length-1,t=function(t){var r,n,i,o,a,s,l,c,h,u,A,d,p,m,f,g,v;return __generator(this,function(e){switch(e.label){case 0:if(t.type!==CSSImageType.URL)return[3,5];r=void 0,n=t.url,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,y.options.cache.match(n)];case 2:return r=e.sent(),[3,4];case 3:return e.sent(),Logger$1.getInstance(y.options.id).error("Error loading background-image "+n),[3,4];case 4:return r&&(i=calculateBackgroundRendering(w,_,[r.width,r.height,r.width/r.height]),s=i[0],A=i[1],d=i[2],h=i[3],u=i[4],a=y.ctx.createPattern(y.resizeImage(r,h,u),"repeat"),y.renderRepeat(s,a,A,d)),[3,6];case 5:isLinearGradient(t)?(v=calculateBackgroundRendering(w,_,[null,null,null]),s=v[0],A=v[1],d=v[2],h=v[3],u=v[4],f=calculateGradientDirection(t.angle,h,u),m=f[0],i=f[1],l=f[2],g=f[3],c=f[4],(v=document.createElement("canvas")).width=h,v.height=u,f=v.getContext("2d"),o=f.createLinearGradient(i,g,l,c),processColorStops(t.stops,m).forEach(function(e){return o.addColorStop(e.stop,asString(e.color))}),f.fillStyle=o,f.fillRect(0,0,h,u),0<h&&0<u&&(a=y.ctx.createPattern(v,"repeat"),y.renderRepeat(s,a,A,d))):isRadialGradient(t)&&(g=calculateBackgroundRendering(w,_,[null,null,null]),s=g[0],l=g[1],c=g[2],h=g[3],u=g[4],m=0===t.position.length?[FIFTY_PERCENT]:t.position,A=getAbsoluteValue(m[0],h),d=getAbsoluteValue(m[m.length-1],u),f=calculateRadius(t,A,d,h,u),v=f[0],g=f[1],0<v&&(p=y.ctx.createRadialGradient(l+A,c+d,0,l+A,c+d,v),processColorStops(t.stops,2*v).forEach(function(e){return p.addColorStop(e.stop,asString(e.color))}),y.path(s),y.ctx.fillStyle=p,v!==g?(m=w.bounds.left+.5*w.bounds.width,f=w.bounds.top+.5*w.bounds.height,v=1/(g=g/v),y.ctx.save(),y.ctx.translate(m,f),y.ctx.transform(1,0,0,g,0,0),y.ctx.translate(-m,-f),y.ctx.fillRect(l,v*(c-f)+f,h,u*v),y.ctx.restore()):y.ctx.fill())),e.label=6;case 6:return _--,[2]}})},y=this,r=0,n=w.styles.backgroundImage.slice(0).reverse(),e.label=1;case 1:return r<n.length?(i=n[r],[5,t(i)]):[3,4];case 2:e.sent(),e.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},d.prototype.renderBorder=function(t,r,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.path(parsePathForBorder(n,r)),this.ctx.fillStyle=asString(t),this.ctx.fill(),[2]})})},d.prototype.renderNodeBackgroundAndBorders=function(c){return __awaiter(this,void 0,void 0,function(){var t,r,n,i,o,a,s,l=this;return __generator(this,function(e){switch(e.label){case 0:return(this.applyEffects(c.effects,2),t=c.container.styles,r=!isTransparent(t.backgroundColor)||t.backgroundImage.length,n=[{style:t.borderTopStyle,color:t.borderTopColor},{style:t.borderRightStyle,color:t.borderRightColor},{style:t.borderBottomStyle,color:t.borderBottomColor},{style:t.borderLeftStyle,color:t.borderLeftColor}],s=calculateBackgroundCurvedPaintingArea(getBackgroundValueForIndex(t.backgroundClip,0),c.curves),r||t.boxShadow.length)?(this.ctx.save(),this.path(s),this.ctx.clip(),isTransparent(t.backgroundColor)||(this.ctx.fillStyle=asString(t.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(c.container)]):[3,2];case 1:e.sent(),this.ctx.restore(),t.boxShadow.slice(0).reverse().forEach(function(e){l.ctx.save();var t=calculateBorderBoxPath(c.curves),r=e.inset?0:MASK_OFFSET,n=transformPath(t,-r+(e.inset?1:-1)*e.spread.number,(e.inset?1:-1)*e.spread.number,e.spread.number*(e.inset?-2:2),e.spread.number*(e.inset?-2:2));e.inset?(l.path(t),l.ctx.clip(),l.mask(n)):(l.mask(t),l.ctx.clip(),l.path(n)),l.ctx.shadowOffsetX=e.offsetX.number+r,l.ctx.shadowOffsetY=e.offsetY.number,l.ctx.shadowColor=asString(e.color),l.ctx.shadowBlur=e.blur.number,l.ctx.fillStyle=e.inset?asString(e.color):"rgba(0,0,0,1)",l.ctx.fill(),l.ctx.restore()}),e.label=2;case 2:o=i=0,a=n,e.label=3;case 3:return o<a.length?(s=a[o]).style===BORDER_STYLE.NONE||isTransparent(s.color)?[3,5]:[4,this.renderBorder(s.color,i,c.curves)]:[3,7];case 4:e.sent(),e.label=5;case 5:i++,e.label=6;case 6:return o++,[3,3];case 7:return[2]}})})},d.prototype.render=function(r){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=asString(this.options.backgroundColor),this.ctx.fillRect(this.options.x-this.options.scrollX,this.options.y-this.options.scrollY,this.options.width,this.options.height)),t=parseStackingContexts(r),[4,this.renderStack(t)];case 1:return e.sent(),this.applyEffects([],2),[2,this.canvas]}})})},d}(),isTextInputElement=function(e){return e instanceof TextareaElementContainer||(e instanceof SelectElementContainer||e instanceof InputElementContainer&&e.type!==RADIO&&e.type!==CHECKBOX)},calculateBackgroundCurvedPaintingArea=function(e,t){switch(e){case BACKGROUND_CLIP.BORDER_BOX:return calculateBorderBoxPath(t);case BACKGROUND_CLIP.CONTENT_BOX:return calculateContentBoxPath(t);default:BACKGROUND_CLIP.PADDING_BOX;return calculatePaddingBoxPath(t)}},canvasTextAlign=function(e){switch(e){case TEXT_ALIGN.CENTER:return"center";case TEXT_ALIGN.RIGHT:return"right";default:TEXT_ALIGN.LEFT;return"left"}},ForeignObjectRenderer=function(){function e(e){this.canvas=e.canvas||document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.options=e,this.canvas.width=Math.floor(e.width*e.scale),this.canvas.height=Math.floor(e.height*e.scale),this.canvas.style.width=e.width+"px",this.canvas.style.height=e.height+"px",this.ctx.scale(this.options.scale,this.options.scale),this.ctx.translate(-e.x+e.scrollX,-e.y+e.scrollY),Logger$1.getInstance(e.id).debug("EXPERIMENTAL ForeignObject renderer initialized ("+e.width+"x"+e.height+" at "+e.x+","+e.y+") with scale "+e.scale)}return e.prototype.render=function(r){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t=createForeignObjectSVG(Math.max(this.options.windowWidth,this.options.width)*this.options.scale,Math.max(this.options.windowHeight,this.options.height)*this.options.scale,this.options.scrollX*this.options.scale,this.options.scrollY*this.options.scale,r),[4,loadSerializedSVG$1(t)];case 1:return t=e.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=asString(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(t,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},e}(),loadSerializedSVG$1=function(n){return new Promise(function(e,t){var r=new Image;r.onload=function(){e(r)},r.onerror=t,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(n))})},_this=void 0,parseColor$1=function(e){return color.parse(Parser.create(e).parseComponentValue())},html2canvas=function(e,t){return renderElement(e,t=void 0===t?{}:t)};"undefined"!=typeof window&&CacheStorage.setContext(window);var renderElement=function(p,m){return __awaiter(_this,void 0,void 0,function(){var t,r,n,i,o,a,s,l,c,h,u,A,d;return __generator(this,function(e){switch(e.label){case 0:if(!(t=p.ownerDocument))throw new Error("Element is not attached to a Document");if(!(r=t.defaultView))throw new Error("Document is not attached to a Window");return n=(Math.round(1e3*Math.random())+Date.now()).toString(16),l=isBodyElement(p)||isHTMLElement(p)?parseDocumentSize(t):parseBounds(p),o=l.width,a=l.height,i=l.left,s=l.top,l=__assign({},{allowTaint:!1,imageTimeout:15e3,proxy:void 0,useCORS:!1},m),s={backgroundColor:"#ffffff",cache:m.cache||CacheStorage.create(n,l),logging:!0,removeContainer:!0,foreignObjectRendering:!1,scale:r.devicePixelRatio||1,windowWidth:r.innerWidth,windowHeight:r.innerHeight,scrollX:r.pageXOffset,scrollY:r.pageYOffset,x:i,y:s,width:Math.ceil(o),height:Math.ceil(a),id:n},o=__assign({},s,l,m),a=new Bounds(o.scrollX,o.scrollY,o.windowWidth,o.windowHeight),Logger$1.create({id:n,enabled:o.logging}),Logger$1.getInstance(n).debug("Starting document clone"),s=new DocumentCloner(p,{id:n,onclone:o.onclone,ignoreElements:o.ignoreElements,inlineImages:o.foreignObjectRendering,copyStyles:o.foreignObjectRendering}),(l=s.clonedReferenceElement)?[4,s.toIFrame(t,a)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return(c=e.sent(),u=t.documentElement?parseColor$1(getComputedStyle(t.documentElement).backgroundColor):COLORS.TRANSPARENT,h=t.body?parseColor$1(getComputedStyle(t.body).backgroundColor):COLORS.TRANSPARENT,d=m.backgroundColor,d="string"==typeof d?parseColor$1(d):null===d?COLORS.TRANSPARENT:4294967295,h=p===t.documentElement?isTransparent(u)?isTransparent(h)?d:h:u:d,u={id:n,cache:o.cache,canvas:o.canvas,backgroundColor:h,scale:o.scale,x:o.x,y:o.y,scrollX:o.scrollX,scrollY:o.scrollY,width:o.width,height:o.height,windowWidth:o.windowWidth,windowHeight:o.windowHeight},o.foreignObjectRendering)?(Logger$1.getInstance(n).debug("Document cloned, using foreign object rendering"),[4,new ForeignObjectRenderer(u).render(l)]):[3,3];case 2:return A=e.sent(),[3,5];case 3:return Logger$1.getInstance(n).debug("Document cloned, using computed rendering"),CacheStorage.attachInstance(o.cache),Logger$1.getInstance(n).debug("Starting DOM parsing"),d=parseTree(l),CacheStorage.detachInstance(),h===d.styles.backgroundColor&&(d.styles.backgroundColor=COLORS.TRANSPARENT),Logger$1.getInstance(n).debug("Starting renderer"),[4,new CanvasRenderer$1(u).render(d)];case 4:A=e.sent(),e.label=5;case 5:return!0===o.removeContainer&&(DocumentCloner.destroy(c)||Logger$1.getInstance(n).error("Cannot detach cloned iframe as it is not in the DOM anymore")),Logger$1.getInstance(n).debug("Finished rendering"),Logger$1.destroy(n),CacheStorage.destroy(n),[2,A]}})})};class ImageExporter{constructor(e,t){this.revision=1,checkPropTypes(t,{view:View||DefaultView},{}),this._view=t.view}_dataURIToBlob(e){const t=window.atob(e.split(",")[1]);var r=t.length;const n=new Uint8Array(r);for(let e=0;e<r;e++)n[e]=t.charCodeAt(e);return new window.Blob([n])}_saveDataURI(e,t){const r=this._dataURIToBlob(t),n=document.createElement("a");n.download=e,n.href=window.URL.createObjectURL(r),n.onclick=()=>{window.setTimeout(()=>{window.URL.revokeObjectURL(r),n.removeAttribute("href")},500)},n.click()}_defaultFileName(e){const t=(new Date).toLocaleDateString()+" at "+(new Date).toLocaleTimeString()+e;return t.replace(/\//g,"-").replace(/:/g,".")}async export(e,t,{saveToFile:r,transparent:n,html:i,extension:o}={}){o=o??"png",this._view.perspectiveCamera.aspect=(e=e||800)/(t=t||600),this._view.perspectiveCamera.updateProjectionMatrix(),n&&this._view.renderer.setClearColor(16777215,0),await this._view.update(),this._view.renderer.setSize(e,t),this._view.composer.setSize(e,t),this._view.css2dRenderer.setSize(e,t),this._view.composer.render(this._view.scene,this._view.perspectiveCamera,null,!1);var a=null;if(i){console.log("save html");this._view.domElement;const s=document.createElement("div");s.style.width=e.toString()+"px",s.style.height=t.toString()+"px",s.id="htmlCanvas",s.style.zIndex="-10",s.style.background="white",s.appendChild(this._view.renderer.domElement),s.appendChild(this._view.css2dRenderer.domElement),document.getElementsByClassName("canvas-container")[0].appendChild(s),this._view.renderer.setClearColor(16777215,1),this._view.composer.render(this._view.scene,this._view.perspectiveCamera,null,!1),this._view.css2dRenderer.render(this._view.scene,this._view.perspectiveCamera,null,!1),await html2canvas(document.querySelector("#htmlCanvas")).then(e=>{a=e.toDataURL("image/"+o),r&&this._saveDataURI(this._defaultFileName("."+o),a)}),this._view.domElement.appendChild(this._view.renderer.domElement),this._view.domElement.appendChild(this._view.css2dRenderer.domElement),s.remove()}else console.log("save renderer"),a=this._view.renderer.domElement.toDataURL("image/"+o),r&&this._saveDataURI(this._defaultFileName("."+o),a);return n&&this._view.renderer.setClearColor(16777215,1),this._view.updateDOMElementDimensions(),a}}class Project extends StateTracker{constructor(e,t={}){super(e,t),this.bodyChangeHandlePromise=null,this.bodyChangeHandlePromiseResolver=null,this.timer=void 0,this.scene=void 0,this.renderer=void 0,this.server=void 0,this.pkgs=void 0,this.projectIOPromiseChain=Promise.resolve(),this.singleBlockInstances=[],this.configurators=void 0,this.views=[],this.messageApiSubscriptions={},this.allowedIFrameAPIOrigins=[],this.addEvent("price"),window.onerror=(e,t,r,n,i)=>{this.report({msg:"Uncaught error: "+e,level:"error"}),console.error(i)},Object.defineProperty(window,"uuid",{get:InformationSource.uuid});const r=this;this.frontEndClientEventListener=t.onEvent||(()=>""),this.allowedIFrameAPIOrigins=t.allowedIFrameOrigins,this.exportConfig=function(){var e,t=this;window.exportConfig=function(){e=JSON.stringify(pick(["info","blockInstances","connections","materialAssignments","themes"],t.configurators[0].configuration.toJSON())),console.debug("Exported config",e)}},this.exportConfig(),this.rendererSettings={...defaultRendererSettings,...t.rendererSettings||{}},this.renderer=new WebGLRenderer(this.rendererSettings),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setClearColor(0,0),this.rendererOrtho=new WebGLRenderer(this.rendererSettings),this.rendererOrtho.setPixelRatio(window.devicePixelRatio),Project.maxAnisotropy=this.renderer.capabilities.getMaxAnisotropy(),this.timer=new Timer(this._reporter),this.timer.on("update",async()=>{if(null===this.bodyChangeHandlePromise)for(var e of this.views)e.update();else{for(var r of this.views){var n=this.configurators.map(e=>({boundingBox:e.configuration.boundingBox,configurationId:e.configuration.id,id:e.id}));r.hideDimensions(),r.onSceneUpdate(n)}let e=!1,t={};for(var i of this.actors)!1!==i.visible&&(t[i.slug]=i.cursor,void 0!==this.state?.[i.slug]&&this.state[i.slug]===t[i.slug]||(e=!0));e&&await this.addState({newState:t,moveCursor:"silent"}),this.bodyChangeHandlePromiseResolver(),this.bodyChangeHandlePromise=null,this.bodyChangeHandlePromiseResolver=null}}),t.server&&(this.server=new ServerConnection(e,{url:t.server||new URL("wss://backend.productbuilder.nl"),reconnectTime:t.reconnectTime||5}));const n=this.loadFromLocalStorage("autosave");n&&(this.autosave={age:((new Date).getTime()-n.meta.time)/1e3,data:n,restore:async()=>(console.log("Restoring autosave"),r.buildProjectFromExport(n))}),this.reset(),this.initIFrameAPI()}async addPackage(e){return this.projectIOPromiseChain=this.projectIOPromiseChain.then(()=>this._addPackage(e)).catch(e=>new Error(e)),this.projectIOPromiseChain}async _addPackage(e){this.report({msg:"Load package "+e,level:"notice"}),console.assert(e instanceof URL);var t=`${e.href}${"/"!==e.href.substr(-1)?"/":""}index.json?r=`+Math.random();this.report({msg:"Loading index from "+t});const r=await fetch(t);if(!r.ok)throw console.warn(r),new Error("Load package failed");t=await r.json(),e=new LoadingBase(this._reporter,{name:"Package URL base",url:e}),e=new ComponentLoader(this._reporter,{name:"PackageURLLoader",bases:[e]}),e=Package.createFromJSON(t,this._reporter,null,{loader:e,renderer:this.renderer});return Object.freeze(e),this._addPackageObject(e),this.report({msg:"Package load complete: "+e.label,level:"notice"}),this.triggerWindowAPIEvent("pkg-loaded",e.id),e}_addPackageObject(e){this.report({msg:"Adding "+e.label,level:"notice"}),this.pkgs.push(e)}get actors(){return[...this.configurators,...this.singleBlockInstances]}addActor(e,t,r=!1){console.assert(e instanceof Actor),this.report({msg:"Adding "+e.label,level:"notice"}),t.push(e),this.scene.add(e.body),e.on("bodychange",async(e=0)=>{null===this.bodyChangeHandlePromise&&(this.bodyChangeHandlePromise=new Promise(e=>this.bodyChangeHandlePromiseResolver=e),this.timer.trigger()),await this.bodyChangeHandlePromise,!0===r&&(this.overwritePreviousState(),r=!1),this.timer.trigger()}),this.timer.trigger()}addSingleBlockInstance(e,t,r){if(-1===this.pkgs.indexOf(e.tree))throw new Error("Block belongs to unknown tree");var n=new BlockInstance(this._reporter,{block:e}),r=new SingleBlockInstance(this._reporter,{blockInstance:n,loader:e.tree.loader,position:t||new Vector3,quaternion:r||new Quaternion});return this.addActor(r,this.singleBlockInstances),r}async addConfigurator(e,t=!1){if(-1===this.pkgs.indexOf(e.pkg))throw new Error("Unknown package");e=new Configurator(this._reporter,e);return this.addActor(e,this.configurators,t),e}findConfigurator(t){return this.configurators.find(e=>e.configuration===t)}addView(e){return e=e||new DefaultView(this._reporter,{scene:this.scene,renderer:this.renderer,rendererOrtho:this.rendererOrtho,timer:this.timer,findConfigurator:this.findConfigurator.bind(this),addConfigurator:this.addConfigurator.bind(this),findComponentById:this.findComponentById.bind(this)}),this.views.push(e),e.onSceneUpdate(),e}onStateCursorMoved(e){for(var t of this.actors)void 0===e[t.slug]&&!0===t.visible&&t.hide();for(var r of this.actors)void 0!==e[r.slug]&&(!0!==r.visible&&r.show(),r.setCursor(e[r.slug]))}undo(e=1){for(var t of this.views)t.removeAllMarkers();return super.undo(e)}redo(e=1){for(var t of this.views)t.removeAllMarkers();return super.redo(e)}removeConfigurator(e){var t=this.configurators.indexOf(e);if(-1===t)throw new Error("Unknown configurator");this.scene&&this.scene.remove(e.body),e.removeAllListeners(),e.clearBody(),e.resetState(),this.configurators.splice(t,1)}reset(e=!1){if(this.report({msg:"Project reset",level:"notice"}),this.resetState(),this.removeAllListeners(),this.configurators)for(var t of this.configurators)this.removeConfigurator(t);if(this.configurators=[],this.pkgs&&!0===e)for(var r of this.pkgs)r.removeAllListeners();this.pkgs&&!0!==e||(this.pkgs=[]),this.scene||(this.scene=new Scene);for(var n of Object.keys(this.timer.updateRequests))this.timer.removeUpdateRequest(n);this.boundingBox=null}async load(e){return this.projectIOPromiseChain=this.projectIOPromiseChain.then(()=>this._load(e)).catch(e=>new Error(e)),this.projectIOPromiseChain}async _load(e){if(this.report({msg:"Loading project "+e,level:"notice"}),!this.server||!this.server.connected)throw new Error("Unable to load project, not connected to server.");e=await this.server.request({endpoint:"project",method:"read",data:{identifier:e}}),e=JSON.parse(e.data.export);this.report({msg:"Project data load success",level:"notice"});e=this.buildProjectFromExport(e);return this.report({msg:`Project ${this.id} load complete`,level:"notice"}),e}loadFromLocalStorage(e){let t=null;return!localStorage||(e=localStorage.getItem(e))&&(t=JSON.parse(e)),t}async buildProjectFromExport(e){this.report({msg:"Building project "+e.meta?.id,level:"notice"}),this.reset();for(let t of e.packages){var r=this.pkgs.find(e=>e.id===t.id);r?console.debug(r.label,"already loaded, not loading again"):await this.addPackage(new URL(t.url))}var t=await Promise.all(e.configurations.map(async t=>{var e=this.pkgs.find(e=>e.id===t.configuration.pkg);const r=Configuration.createFromJSON(t.configuration,this._reporter,e);var n=r.copy();const i=await this.addConfigurator({pkg:e,position:new Vector3(t.position.x,t.position.y,t.position.z),quaternion:new Quaternion(t.quaternion.x,t.quaternion.y,t.quaternion.z,t.quaternion.w),configuration:n});return await i.update(n),this.timer.trigger(),i}));return this.id=e.meta.id,t}async share(){return this.projectIOPromiseChain=this.projectIOPromiseChain.then(()=>this._save({copy:!0})).catch(e=>new Error(e)),this.projectIOPromiseChain}async save(e){return this.projectIOPromiseChain=this.projectIOPromiseChain.then(()=>this._save(e)).catch(e=>new Error(e)),this.projectIOPromiseChain}async _save({copy:e=!1,metadata:t=void 0}={}){this.report({msg:`Save project ${this.id}, copy=`+e,level:"notice"}),await Promise.all(this.configurators.map(e=>e.configuration.build()));var r,n,i,o={meta:{id:this.id,time:(new Date).getTime()},packages:this.pkgs.map(e=>({id:e.id,url:e.loader.loadingBases[0].url.href})),configurations:this.configurators.map(e=>({configuration:e.configuration.toJSON(),position:e.state.position,quaternion:e.state.quaternion}))},a=JSON.stringify(o);localStorage&&localStorage.setItem("autosave",a);let s={export:o};if(!this.server||!this.server.connected)throw new Error("Unable to save project to server, not connected.");try{!0===e?(r={endpoint:"project",method:"create",data:{name:"",description:"",export:a,readonly:!0,metadata:t?JSON.stringify(t):void 0}},(n=await this.server.request(r)).data?(this.report({msg:"Project shared as "+n.data.slug,level:"notice"}),s.slug=n.data.slug,s.id=n.data.id):this.report({msg:"Project could not be shared: "+n.errors[0]?.description,level:"error"})):((i=await this.server.request({endpoint:"project",method:"update",data:{id:this.id||"<no id>",name:"",description:"",export:a,metadata:t?JSON.stringify(t):void 0}})).data?(this.report({msg:"Project saved",level:"notice"}),s.id=this.id,this.slug=s.slug=i.data.slug,this.price=s.price=i.data.price):(this.report({msg:"Project could not be saved: "+i.errors[0]?.description,level:"error"}),this.price=void 0),this.emit("price",this.price))}catch(e){console.error("Error while saving project:",e)}return s}findComponentById(e){let t=void 0;for(var r of this.pkgs)if(t=r.findComponentById(e),t)break;if(void 0===t)for(var n of this.configurators)if(t=n.configuration.findComponentById(e),t)break;return t}setTheme(r){for(let e=0,t=this.configurators.length;e<t;e+=1)this.configurators[e].setTheme(r),0<e&&this.overwritePreviousState()}registerUI({name:e="Unnamed UI",onEvent:t}){this.UI={name:e,onEvent:t}}makeMsgApiObject({id:e,type:t,error:r=!1,data:n=""}={}){return{id:e,type:t,target:"pb",error:r,data:n,apiVersion:1}}getEntityArray(e){switch(e){case"preset":return this.pkgs.reduce((e,t)=>[...e,...t.configurations],[]);case"actor":return this.actors;case"configurator":return this.configurators;case"pkg":return this.pkgs;default:throw new Error("Unknown entity type "+e)}}findEntityById(e,t){const r=this.getEntityArray(e);if(!t)throw new Error("Can not find ${entityType} without id");var n=r.find(e=>e.id===t);if(n)return n;throw new Error(`Unknown ${e} id `+t)}async messageApiRequest(e){switch(e.method){case"set-locale":if(this.server&&this.server.connected){var t=await this.server.request({endpoint:"locale",method:"update",data:{locale:e.locale}});if(t.data)return this.report({msg:"Locale updated",level:"notice"}),!0;t="Locale could not be updated: "+t.errors[0]?.description;throw this.report({msg:t,level:"error"}),new Error(t)}response=makeResponse(!0,"Unable to set locale, not connected.");break;case"project-id":return this.id;case"project-slug":return this.slug;case"share-project":return this.share();case"save":case"save-project":var r=await this.save();if(r instanceof Error)throw r;return r;case"load-project":var n=await this.load(e.data.identifier);if(n instanceof Error)throw n;return{id:this.id,slug:this.slug};case"list-available-packages":break;case"list-loaded-packages":return this.pkgs.map(e=>({id:e.id}));case"list-configurators":return this.configurators.map(e=>({id:e.id,pkgId:e.pkg.id}));case"list-presets":return this.pkgs.reduce((e,t)=>[...e,...t.configurations.map(e=>({id:e.id,pkgId:t.id}))],[]);case"screenshot":const o=new ImageExporter(this.reporter,{view:this.views[0]});return await o.export(600,400);case"configuration-summary":break;case"select-preset":r=e.data?.configuratorId;if(!r)throw new Error("Missing configuratorId property");n=e.data?.presetId;if(!n)throw new Error("Missing presetId property");const a=this.findEntityById("configurator",r),s=this.findEntityById("preset",n);n={part:"main",highPriority:!0};try{var i=await s.build(n);await a.update(i);return!0}catch(e){throw new Error("Could not select preset. ",e)}case"ui":return this.frontEndClientEventListener(e.data);case"price":return this.price;default:throw new Error("Unknown Window API method name: "+e.method)}}triggerWindowAPIEvent(e,t){for(var[r,n]of Object.entries(this.messageApiSubscriptions))n.source.postMessage(this.makeMsgApiObject({id:InformationSource.uuid(),type:e,data:t}),r)}enableWindowAPI(e){return console.debug("Set allowed origins for IFrame API",e),this.allowedIFrameAPIOrigins=e,!0}setAllowedIFrameOrigins(e){return this.enableWindowAPI(e)}initIFrameAPI(){const i=this;this.on("price",function(e){i.triggerWindowAPIEvent("price",e)}),window.addEventListener("message",async e=>{var t=this.allowedIFrameAPIOrigins.includes(e.origin);if("pbping"!==e.data){if(t){let t=e.data,r=null;if("object"==typeof t&&"pb"===t.target){if(t.id||(t.id=InformationSource.uuid()),"subscribe"===t.method)this.messageApiSubscriptions[e.origin]={source:e.source},r=i.makeMsgApiObject({id:t.id,type:"response",error:!1,data:!0});else if("unsubscribe"===t.method)delete this.messageApiSubscriptions[e.origin],r=i.makeMsgApiObject({id:t.id,type:"response",error:!1,data:!0});else try{var n=await i.messageApiRequest(t);r=i.makeMsgApiObject({id:t.id,type:"response",error:!1,data:n})}catch(e){console.log(e),r=i.makeMsgApiObject({id:t.id,type:"response",error:!0,data:e.message})}e.source.postMessage(r,e.origin)}}}else{t={target:"pb",type:"pbinfo",originAllowed:t,origin:e.origin};e.source.postMessage(t,e.origin)}})}}Project.layerMap={grid:1,boundingBoxes:2,dimLines:3,connectorHelpers:4,lightHelpers:5,visibleActors:6,hiddenActors:7},Project.maxAnisotropy=void 0,Project.standardQuaternions={"+x":(new Quaternion).setFromEuler(new Euler(Math.PI,0,0)),"-x":(new Quaternion).setFromEuler(new Euler(-Math.PI,0,0)),"+y":(new Quaternion).setFromEuler(new Euler(0,Math.PI,0)),"-y":(new Quaternion).setFromEuler(new Euler(0,-Math.PI,0)),"+z":(new Quaternion).setFromEuler(new Euler(0,0,Math.PI)),"-z":(new Quaternion).setFromEuler(new Euler(0,0,-Math.PI))},Project.defaultImages={missing:makeImage(128,128,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAEzklEQVR4nO3dsW7bSBCAYRVJe5DTOEiRGK4CuNEj6BHYEJxZN2pOCFKm8iPcA6W4IkHUB4HdnZtAblLHb5Brdn3rxeYkWTtLkfo/wI2L3SVnSJGzS3IyAQAAAAAAAAAAAAAAAAAAAAAAAEoSkYWqXjdNM+17LE/VNM1UVa9FZNH3WAbFB/+X/xtkEoTgh+0gCbaUBH+QSZAGnyTYUib4d0NLgkzw70iCLYjIWbqjmqaZishN9P9V3+PcRFVX0Tbc+G1YJNt21vc4D1LYUfFREpJARO6dc7Meh7cV59xMRO5D8MP/c9uGjNzR0TTNdAjBD5xzs9zPFUc+AHAqzDiafWJxMdR13QdVPS3V3ib+juV9wfaO4wLR4nZIVa98e7c1kkBEzkRk7cf/rkR7R1EnyAR/sW+by+XyeVJ0+ccyCeLg+234Op/PnxVot/i+OSiWG+icO0mS4NY596ZU+0Em+N/atn1RsP3xJkFczRORdemSbiYJ7komgXXwJ5OHglfcx03J9nuVKekWr+tbJUHbti9rBD+ZObwZwrzHTmongYj8cM6d79umiLxS1e/hGoPg7yFOAqvavnPuREQ+qepFwTbPVfVz27YvS7UZtT0TkfvRBz/wGb8aUm3fmnNupqqr0QcfAIANLH8Lc6uNa6ze5fd9SyLyl1VdX1Wb9DY0s4avKd1vVEi6Kt32qIjIn3FJt/RtV64WYX0PnlYRu65rS7Y/Kqp66o/+hyQofSbIJIFZ8GtUEUenjySwCr6fnXyYqST4W/JJcF0jCSoGv3gVcdQykzt/l+4jXASWbldEPlpeyxyNkASlJnZqcc6di8gPjvwCfBIUm9ipRVXfEnwAAOyoatNHnd2XkIuXjbGDaCVt1XcHxPMHo1q9OzTWawxzcmv4rPvEb9RYaJr2dzQLOIeiVhIQ/ANVKzC1zzbYQu2jkiQ4MNZTujm5JLDuE78RPVdf9fc4ecBlUatfZFAIAgBgnPz6urd9j2NXqnrhnDvpexyDFhZXDnhJ2DVJ8EQ++LfRff7H0n1YLQrV6IXRJMET1FhWHVURLd5U8iZ5toEk2Fbl4JuVdDMPuJAEm7Rt+6KH4JMEh6Lrujb6zV+3bfu6ZPu5ySPryZ3MtcyiZPujo6pXIrK2eHmyRo+Hh/mDzORO8fJudCbg8fBtWL8gIp08ip4TXFj1e3l5+YdV2wAADIH/vf3CiyL/498W+mX0y8uS27CfFkngb7s+l5w7UNULEflkcQ/v3xL6c/RrDGss4EyqiN9F5NW+bUYTOyaFnKNYaFop+I+qiL6QtHcV0df1H33CliTYUbJxdxbBF5FvcfBLFpJqJUHaR8n2e2X5ORTr4AfWSTDqT8ZMJjYbOJ/Pn4nIV+vgB7kkWC6Xz/dtd/TBDyw+Gyci72oEP0jm+veu7R/NZ+MCMfhIoqq+rxH8qL/Trus+lGrPYp8ctJrBGgr2CQBkT4VN00yHNHfgnJvlah2c5jfIXQxFVUSTuYPSotr+o2re0V3o7Sp3O5RZwLnqe5ybaPJMgC/zFr/9HaXMjoo/tjCId/JkvkWwThO77zEetDQJhhT84H++SrLoe2yDECfB0IIfZM4Ei77HNCi51btDU2O1MQAAAAAAAAAAAAAAAAAAAAAAAI7UvxmoXFiIe/GjAAAAAElFTkSuQmCC")},Project.basis="+X+Y+Z";class PositionedBlock extends PositionedComponent{constructor(e,t){super(e,t),checkPropTypes(t,{component:Block},{})}}PositionedBlock._exportName={singular:"positionedBlock",plural:"positionedBlocks"},PositionedBlock._exportLevel="inline";class ConnectorInstance extends InformationSource{constructor(e,t,r){super(e),this.blockInstance=t,this.connector=r}toJSON(){return{UUID:this.UUID,connector:this.connector.UUID,blockInstance:this.blockInstance.UUID}}}class ConfigurationSettings extends Component{constructor(e,t){super(e,t)}get blockInsert(){return this._blockInsert}set blockInsert(e){this.report({msg:"set blockInsert="+e}),this._blockInsert=e,this._dispatchChangeEvent()}get blockExtend(){return this._blockExtend}set blockExtend(e){this.report({msg:"set blockExtend="+e}),this._blockExtend=e,this._dispatchChangeEvent()}get blockReplace(){return this._blockReplace}set blockReplace(e){this.report({msg:"set blockReplace="+e}),this._blockReplace=e,this._dispatchChangeEvent()}}ConfigurationSettings._exportName={singular:"configurationSetting",plural:"configurationSettings"};class NavigationSettings extends Component{constructor(e,t){super(e,t),this._library=t?.library||[]}_dispatchChangeEvent(){this.emit("change",this)}get library(){return this._library}addItem(e,t){this.report({msg:`add ${e} item `+t.label}),this["_"+e].push(t),this._dispatchChangeEvent()}removeItem(e,t){this.report({msg:`remove ${e} item `+t}),this["_"+e]=this["_"+e].filter(e=>e.label!==t),this._dispatchChangeEvent()}}class Preset extends Configuration{constructor(e,t){super(e,t)}}Preset._exportName={singular:"preset",plural:"presets"};const fxaaShader$1=new ShaderPass(FXAAShader),gammaCorrectionShader$1=new ShaderPass(GammaCorrectionShader$1);class MoooiView extends View{constructor(e,t){super(e,{...t,rendererSettings:{antialias:!1,alpha:!0,preserveDrawingBuffer:!0,precision:"highp",premultipliedAlpha:!0,stencil:!1,logarithmicDepthBuffer:!1,toneMapping:CineonToneMapping,toneMappingExposure:1,toneMappingWhitePoint:1,gammaFactor:2.2,outputEncoding:CineonToneMapping,physicallyCorrectLights:!0,minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,stencilBuffer:!1,type:FloatType,"shadowMap.enabled":!0},cameraSettings:{fov:30,aspect:window.innerWidth/window.innerHeight,near:.5,far:100,maxPolarAngle:90},passes:[fxaaShader$1,gammaCorrectionShader$1]}),this.dragState={_active:!1,get active(){return this._active},set active(e){console.log(`Setting dragState.active [${this._active}] => [${e}]`),this._active=e},_enter:!1,get enter(){return this._enter},set enter(e){console.log(`Setting dragState.enter [${this._enter}] => [${e}]`),this._enter=e},_leave:!1,get leave(){return this._leave},set leave(e){console.log(`Setting dragState.leave [${this._leave}] => [${e}]`),this._leave=e},_over:!1,get over(){return this._over},set over(e){console.log(`Setting dragState.over [${this._over}] => [${e}]`),this._over=e}},this.expectedComponentDrag=null,this.matOptions=[],checkPropTypes(t,{scene:Scene,renderer:WebGLRenderer,timer:Timer},{rendererSettings:Object,cameraSettings:Object,passes:t=>{if(!Array.isArray(t))return"Not an array";for(let e=0;e<t.length;e+=1){var r=t[e];if(!r instanceof Pass)return`Entry ${e} is not a Pass but a `+r.constructor.name}return!0}}),this.dragObject=null,this.dragging=!1,this.allMeshes=[],this.layerMap=Project.layerMap,this.onMouseDownActive=!1,this.shift=new Vector3,this.intersects=new Vector3,this.exrBackground=null,this.pixelRatio=this.renderer.getPixelRatio(),this.on("dimensionsupdate",e=>{fxaaShader$1.uniforms.resolution.value.x=1/(e.width*this.pixelRatio),fxaaShader$1.uniforms.resolution.value.y=1/(e.height*this.pixelRatio)}),fxaaShader$1.name="FXAA Pass",gammaCorrectionShader$1.name="Gamma Correction Pass",this.renderer.setClearColor(16777215,1),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=PCFSoftShadowMap,this.renderer.shadowMap.needsUpdate=!0,this.renderer.antialias=!1,this.renderer.gammaFactor=1.8,this.renderer.physicallyCorrectLights=!0,this.renderer.toneMapping=4,this.renderer.toneMappingExposure=.5,this.renderer.logarithmicDepthBuffer=!0,this.perspectiveCamera.position.set(-2,1,5),this.directionalLight=new DirectionalLight(16777215,3),this.directionalLight.position.set(-40,65,50),this.directionalLight.shadow.mapSize.width=1024,this.directionalLight.shadow.mapSize.height=1024,this.directionalLight.shadow.camera.near=.5,this.directionalLight.shadow.camera.far=500,this.directionalLight.shadow.bias=1e-4;this.directionalLight2=this.directionalLight.clone(),this.directionalLight.castShadow=!0,this.directionalLight2.castShadow=!1,this.directionalLight.intensity=2.2,this.directionalLight2.intensity=4-2.2,this.directionalLight2.shadow.bias=1e-4,this.directionalLightLeft=this.directionalLight.clone(),this.directionalLightLeft.position.set(50,50,50),this.directionalLightLeft.castShadow=!0,this.directionalLightLeft.intensity=1.8,this.directionalLightLeft.shadow.bias=1e-4,this.directionalLightBack=this.directionalLight.clone(),this.directionalLightBack.position.set(0,50,-50),this.directionalLightBack.castShadow=!1,this.directionalLightBack.intensity=1.5,this.directionalLightBack.shadow.bias=1e-4,this.scene.add(this.directionalLight),this.scene.add(this.directionalLight2),this.scene.add(this.directionalLightBack),this.scene.add(this.directionalLightLeft),this.mouse=new Vector2,this.intersectionPlane=new Plane,this.intersectionPlane.setFromCoplanarPoints(new Vector3,new Vector3(1,0,0),new Vector3(0,0,1)),this.intersectionPlaneNormal=new Vector3(0,1,0),this.pointOfIntersection=new Vector3,this.dragPlane=new Plane,this.dragPlane.setFromCoplanarPoints(new Vector3,new Vector3(1,0,0),new Vector3(0,0,1)),this.dragPlaneNormal=new Vector3(0,1,0),this.shift=new Vector3,this.dragging=!1,this.dragObject=null,this.pointOfIntersection=new Vector3,this.onPointerDownActive=!1}onTouchStart(e){var t;this.dragState.active||(this.onPointerDownActive=!1,this.onTouchStartActive=!0,this.lastPointerMove={x:e.touches[0].clientX,y:e.touches[0].clientY,timestamp:(new Date).getTime()},t=this.findFirstIntersectedBlockInstance()||{},console.log(t),t.event=e,this.emit("pointerdown",t),e=this.intersect(this.lastPointerMove.x,this.lastPointerMove.y),console.log(e),t.blockInstance instanceof BlockInstance?(this.selectionActive=!0,this.cameraControls.enabled=!1,t=this.findConfigurator(t.blockInstance.tree),this.dragObject=t,this.dragPlane.setFromNormalAndCoplanarPoint(this.dragPlaneNormal,e[0].point),this.shift.subVectors(this.dragObject.body.position,e[0].point)):(this.dragObject=null,this.hideBoundingBoxes(),this.selectionActive=!1,this.cameraControls.enabled=!0),this.update())}onTouchStart(e){this.onPointerDownActive=!1,this.onTouchStartActive=!0,this.lastPointerMove={x:e.touches[0].clientX,y:e.touches[0].clientY,timestamp:(new Date).getTime()};var t=this.findFirstIntersectedBlockInstance()||{};t.event=e,this.emit("pointerdown",t);this.intersect(this.lastPointerDown.x,this.lastPointerDown.y)}onTouchMove(e){console.log("touch move"),this.dragState.active||(this.lastPointerMove.x=e.touches[0].clientX,this.lastPointerMove.y=e.touches[0].clientY,void 0===this.domElementDimensions&&this.updateDOMElementDimensions(),this.intersect(this.lastPointerMove.x,this.lastPointerMove.y),this.onTouchStartActive?this.dragObject instanceof Configurator&&(!1===this.hideShadowOnDrag&&(this.shadow._update([this.dragObject.body]),this.hideShadowOnDrag=!0),this.rayCaster.ray.intersectPlane(this.dragPlane,this.pointOfIntersection),this.dragObject.body.position.copy(this.pointOfIntersection).add(this.shift),this.dragObject.body.position.setY(0),this.update()):this.hideShadowOnDrag=!1)}onTouchEnd(e){if(console.log("touch end"),!this.dragState.active){if(this.hideShadowOnDrag=!1,this.onPointerDownActive=!1,this.onTouchStartActive=!1,this.cameraControls.enabled=!0,this.lastPointerUp={x:this.lastPointerMove.x,y:this.lastPointerMove.y,timestamp:(new Date).getTime()},this.dragObject instanceof Configurator){this.selectionActive=!0;const t=this.dragObject;t.position.copy(this.dragObject.body.position),t.position.setY(0)}else this.selectionActive=!1,this.dragObject=null;this.dragObject=null,console.log(this.dragObject),this.shadow._update(),this.update()}}onTouchCancel(e){console.log("touch cancel"),this.onTouchCancelActive=!0}onClick(e){console.log("click"),this.dragState.active=!1,this.onPointerDownActive=!1,super.onClick()}onDoubleClick(e){console.log("double click"),this.dragState.active=!1,this.onPointerDownActive=!1,super.onDoubleClick()}onPointerDown(e){var t=this.findFirstIntersectedBlockInstance()||{};t.event=e,this.emit("pointerdown",t)}onPointerMove(e){this.dragState.active||(this.lastPointerMove.x=e.clientX,this.lastPointerMove.y=e.clientY,void 0===this.domElementDimensions&&this.updateDOMElementDimensions(),this.intersect(this.lastPointerMove.x,this.lastPointerMove.y),this.onPointerDownActive?this.dragObject instanceof Configurator&&(!1===this.hideShadowOnDrag&&(this.shadow._update([this.dragObject.body]),this.hideShadowOnDrag=!0),this.rayCaster.ray.intersectPlane(this.dragPlane,this.pointOfIntersection),this.dragObject.body.position.copy(this.pointOfIntersection).add(this.shift),this.dragObject.body.position.setY(0),this.update()):this.hideShadowOnDrag=!1)}onPointerUp(e){if(!this.dragState.active){if(this.hideShadowOnDrag=!1,this.onPointerDownActive=!1,this.cameraControls.enabled=!0,this.lastPointerUp={x:this.lastPointerMove.x,y:this.lastPointerMove.y,timestamp:(new Date).getTime()},this.dragObject instanceof Configurator){this.selectionActive=!0;const t=this.dragObject;t.position.copy(this.dragObject.body.position),t.position.setY(0)}else console.log("selection de-activated"),this.selectionActive=!1,this.dragObject=null;this.shadow._update(),this.update()}}expectComponentDrag(e){this.dragState.active=!0,this.dragState.leave=!1,this.dragState.over=!1,console.assert(e instanceof Component,"expectComponentDrag -> entered component needs to be an instance of the class Component!"),this.expectedComponentDrag&&(console.warn("Another component drag is still being expected... cancelling that one"),this.expectedComponentDrag.reject("A newer component expectation has made this one obsolete"));let r,n=null;const t=new Promise((e,t)=>{r=e,n=t});t.catch(e=>{console.error("Error in expected component drag chain:",e)}).finally(()=>{console.log("Drag promise fulfilled"),this.expectedComponentDrag=null}),this.expectedComponentDrag={component:e,promise:t,resolve:r,reject:n},console.log(this.expectedComponentDrag);const i=this;return this.expectedComponentDrag&&(this.expectedComponentDrag.timeout=setTimeout(function(){console.log("Reject expected drag after timeout"),i.expectedComponentDrag.reject("Timeout")},2e3)),t}checkDrag(e){}async onDragEnter(e){if(e.preventDefault(),this.hideDimensions(),this.dragState.active)if(this.dragState.leave)console.log("drag re-enter"),this.lastPointerMove.x=e.clientX,this.lastPointerMove.y=e.clientY,this.dragState.leave=!1,this.dragState.over=!1;else{this.dragState.enter=!0,this.dragState.leave=!1,this.dragState.over=!1,console.log("drag enter"),this.onPointerDownActive,this.cameraControls.enabled=!1,this.lastPointerMove.x=e.clientX,this.lastPointerMove.y=e.clientY;const r=this.expectedComponentDrag.component;if(r)switch(r.build(),clearTimeout(this.expectedComponentDrag.timeout),r.constructor){case WrappedMaterial:console.log("drag enter wrapped material");var t=r;this.dragObject=t;break;case Block:console.log("drag enter block");const n=new Configuration(new Reporter,{pkg:r.tree,blockInstances:[new BlockInstance(new Reporter,{block:r})]});await n.build();t=await this.addConfigurator({pkg:r.tree,configuration:n});this.dragObject=t,this.expectedComponentDrag.createdConfigurator=t,this.expectedComponentDrag.promise.catch(e=>{throw new Error(e)});t=this.intersect(this.lastPointerMove.x,this.lastPointerMove.y);this.dragPlane.setFromNormalAndCoplanarPoint(this.dragPlaneNormal,t[0].point),this.shift.subVectors(this.dragObject.body.position,t[0].point),this.rayCaster.ray.intersectPlane(this.dragPlane,this.pointOfIntersection),console.log(this.pointOfIntersection),this.dragObject.body.position.copy(this.pointOfIntersection),this.dragObject.body.position.setY(0),console.log(this.dragObject.body),this.scene.add(this.dragObject.body),this.shadow._update([this.dragObject.body]),this.update();break;default:this.expectedComponentDrag.reject("Unknown onDragEnter expected component constructor "+this.expectedComponentDrag.component.constructor.name)}}else console.warn("DragEnter event received, but dragState = ",this.dragState)}async onDragOver(e){this.dragState.active&&(console.log("drag over"),e.preventDefault(),this.lastPointerMove.x=e.clientX,this.lastPointerMove.y=e.clientY,!1===this.dragState.over&&(this.dragState.enter&&(console.log("disable shadow"),console.log(this.dragObject.body),this.shadow._update([this.dragObject.body])),this.update(),this.dragState.over=!0),this.intersect(this.lastPointerMove.x,this.lastPointerMove.y),this.rayCaster.ray.intersectPlane(this.dragPlane,this.pointOfIntersection),this.dragObject instanceof Configurator&&(this.dragObject.body.position.copy(this.pointOfIntersection),this.dragObject.body.position.setY(0)),this.update())}async onDrop(t){if(this.dragState.active){console.log("drop"),t.preventDefault();t.dataTransfer.getData("text");if(this.onPointerDownActive=!1,this.cameraControls.enabled=!0,this.dragObject)switch(this.dragObject.constructor){case WrappedMaterial:console.log("drop wrapped material");const n=this.findFirstIntersectedBlockInstance()||{};n.event=t;const i=this.findConfigurator(n.blockInstance.tree);this.matOptions=i.configuration.options.material(this.dragObject),console.log(this.matOptions);const o=n.intersection?.object?.userData?.PB?.assignable;let e=null;o?(e=this.matOptions.find(e=>e.assignable===o),e?this.domElement.style.cursor="cell":this.domElement.style.cursor="no-drop"):this.domElement.style.cursor="no-drop";var r=i.configuration.assignMaterial(e);await i.update(r),this.expectedComponentDrag.resolve(r);break;case Configurator:console.log("drop configurator"),this.intersect(this.lastPointerMove.x,this.lastPointerMove.y),this.rayCaster.ray.intersectPlane(this.dragPlane,this.pointOfIntersection),this.dragObject.body.position.copy(this.pointOfIntersection),this.dragObject.position.copy(this.dragObject.body.position),this.dragObject.position.setY(0),this.expectedComponentDrag.resolve(this.expectedComponentDrag.createdConfigurator.configuration);break;default:this.expectedComponentDrag.reject("Unknown onDrop expected component constructor "+this.expectedComponentDrag.component.constructor.name)}this.shadow._update(),this.update(),this.dragState.active=!1,this.dragState.enter=!1,this.dragState.leave=!1,this.dragState.over=!1,this.selectionActive=!0}}onDragLeave(e){this.dragState.active&&(e.preventDefault(),console.log("drag leave"),this.dragState.enter&&(this.dragState.enter=!1,this.dragState.leave=!0,this.dragState.over=!1),this.update())}onDragEnd(){this.dragState.active&&(console.log("drag end"),this.cameraControls.enabled=!0,this.dragObject?this.selectionActive=!0:(this.selectionActive=!1,this.dragObject=null),this.dragState.leave&&this.expectedComponentDrag.reject("The drag event has left the window with a drop event"),this.dragState.active=!1,this.dragState.enter=!1,this.dragState.over=!1,this.dragState.leave=!1,this.shadow._update(),this.update())}onComponentDragLeave(e){Object.keys(listenerObject).length}onKeyUp(e){var t=e.which||e.keyCode;e.shiftKey&&67===t&&(console.log("rotate selection"),this.dragObject&&(console.log("rotate selection 2"),this.rotateSelection(this.dragObject))),67===t&&(console.log("connectors"),this.toggleConnectorHelpers())}rotateSelection(e){if(e instanceof Configurator){const t=e;t.move(t.body.position,t.quaternion.multiply((new Quaternion).setFromEuler(new Euler(0,Math.PI/2,0)))),this.shadow._update(),this.update()}else if(e instanceof Block){const r=this.findConfigurator(e.tree);r.move(r.body.position,r.quaternion.multiply((new Quaternion).setFromEuler(new Euler(0,Math.PI/2,0)))),this.shadow._update(),this.update()}}update(){super.update()}onSceneUpdate(...e){this.dragState.active||this.shadow._update(),super.onSceneUpdate(...e)}toggleConnectorHelpers(){console.log("connector helpers"),console.log(this),this.scene.traverse(function(e){if("Actor"===e.name){console.log(e.userData.origin.configuration.connectors);for(var t of e.userData.origin.configuration.connectors){t=t.connector._settings.position;console.log(t);const r=new Mesh(new BoxGeometry(.1,.1,.1),new MeshBasicMaterial);r.position.copy(t),scene.add(r)}}})}}class DefaultSelectionTransform extends Transform{constructor(e,t){super(e,{realtime:!0,...t})}onTransformStart(e){}onTransformUpdate({object3DToTransform:e,startTime:t,originalPosition:r},n){e.position.y=r.y-.1*Math.pow(Math.cos(Math.pow(Math.sin((n-t)/500),3)),10)}}class USDZExporter{async parse(e){var t=buildHeader();const i=[],o=[],a={},s={};var l=0;e.traverse(function(e){if(e.isMesh){console.log(e);var t=l,r=e.matrix;console.log(r);r=e.matrixWorld;console.log(r),console.log(r.elements[12]),console.log(r.elements[13]),console.log(r.elements[14]);const n=e.geometry.clone();e=e.material;n.rotateX(-Math.PI/2);n.toNonIndexed();null!==(a[e.uuid]=e).map&&(s[e.map.uuid]=e.map,s[e.map.uuid].name="diffuse"),null!==e.normalMap&&(s[e.normalMap.uuid]=e.normalMap,s[e.normalMap.uuid].name="normal"),null!==e.aoMap&&(s[e.aoMap.uuid]=e.aoMap,s[e.aoMap.uuid].name="ao"),null!==e.roughnessMap&&(s[e.roughnessMap.uuid]=e.roughnessMap,s[e.roughnessMap.uuid].name="roughness"),null!==e.metalnessMap&&(s[e.metalnessMap.uuid]=e.metalnessMap,s[e.metalnessMap.uuid].name="metalness"),null!==e.emissiveMap&&(s[e.emissiveMap.uuid]=e.emissiveMap,s[e.emissiveMap.uuid].name="emissive"),o.push(buildMesh(t,n,e)),i.push(buildInstancedMesh(t,r,e))}l++}),t+=buildInstancedMeshes(i),t+=buildMeshes(o),t+=buildMaterials(a),t+=buildTextures(s),console.log(t);const r={"model.usda":or(t)};for(const A in s){var n=s[A];r["textures/Texture_"+n.id+".jpg"]=await imgToU8(n.image)}let c=0;for(const d in r){var h=r[d],u=34+d.length;c+=u;var u=63&c;4!=u&&(u=new Uint8Array(64-u),r[d]=[h,{extra:{12345:u}}]),c=h.length}return vt(r,{level:0})}}async function imgToU8(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var t=1024/Math.max(e.width,e.height);const r=document.createElement("canvas");r.width=e.width*Math.min(1,t),r.height=e.height*Math.min(1,t);const n=r.getContext("2d");n.drawImage(e,0,0,r.width,r.height);const i=await new Promise(e=>r.toBlob(e,"image/jpeg",1));return new Uint8Array(await i.arrayBuffer())}}function buildHeader(){return`#usda 1.0
    (
        customLayerData = {
            string copyright = "Copyright (c) 2021 Three.js & Product Builder v.o.f. All rights reserved."
            string creator = "Three.js USDZExporter / Product Builder GTLF2USD"
        }
        metersPerUnit = 1
        upAxis = "Y"
    )

    `}function buildInstancedMeshes(e){return`def "InstancedMeshes"
        {
			${e.join("")}
        } 
		`}function buildInstancedMesh(e,t,r){var n="InstancedMesh_"+e,i="Geometry_"+e;const o=new Euler;o.setFromRotationMatrix(t),console.log(o);MathUtils.radToDeg(o.x),MathUtils.radToDeg(o.y);e=MathUtils.radToDeg(o.z);t.elements;return`def Xform "${n}"
        {

			float3 xformOp:rotateXYZ = (0, ${e}, 0  )
			float3 xformOp:scale = (1, 1, 1)
			double3 xformOp:translate = (${t.elements[12]}, ${t.elements[13]}, ${t.elements[14]})
			uniform token[] xformOpOrder = [ "xformOp:translate", "xformOp:rotateXYZ", "xformOp:scale" ]

			def "${i}" ( 
				instanceable = true 
				references = </Assets/Meshes/${i}>
			)
			{
				rel material:binding = </Materials/Material_${r.id}>
			}
        } 
		`}function buildMeshes(e){return`over "Assets"
    { 
        def Scope "Meshes"
        {
            ${e.join("")}
        }   
    }

    `}function buildMesh(e,t,r){var n="Geometry_"+e,i=t.attributes,o=i.position.count,e=t.toNonIndexed().attributes.position.count;return"uv2"in i&&console.warn("THREE.USDZExporter: uv2 not supported yet."),`def Mesh "${n}"
    {
        int[] faceVertexCounts = [${buildMeshVertexCount(t)}]
        int[] faceVertexIndices = [${buildMeshVertexIndices(t)}]
        rel material:binding = </Materials/Material_${r.id}>
        normal3f[] normals = [${buildVector3Array(i.normal,o)}] 
        point3f[] points = [${buildVector3Array(i.position,o)}]
        float2[] primvars:Texture_uv = [${buildVector2Array(t,e)}] (
            interpolation = "faceVarying"
        )
        uniform token subdivisionScheme = "none"
    }
    `}function buildMeshVertexCount(e){e=null!==e.index?e.index.array.length:e.attributes.position.count;return Array(e/3).fill(3).join(", ")}function buildMeshVertexIndices(e){if(null!==e.index)return e.index.array.join(", ");const t=[];var r=e.attributes.position.count;for(let e=0;e<r;e++)t.push(e);return t.join(", ")}function buildVector3Array(e,t){if(void 0===e)return console.warn("USDZExporter: Normals missing."),Array(t).fill("(0, 0, 0)").join(", ");const r=[];var n=e.array;for(let e=0;e<n.length;e+=3)r.push(`(${n[e+0]}, ${n[e+1]}, ${n[e+2]})`);return r.join(", ")}function buildVector2Array(e,t){e=e.toNonIndexed().attributes.uv;if(void 0===e)return console.warn("USDZExporter: UVs missing."),Array(t).fill("(0, 0)").join(", ");const r=[];var n=e.array;for(let e=0;e<n.length;e+=2)r.push(`(${n[e+0]}, ${1-n[e+1]})`);return r.join(", ")}function buildMaterials(e){const t=[];for(const n in e){var r=e[n];t.push(buildMaterial(r))}return`def "Materials"
{
${t.join("")}
}

`}function buildMaterial(e){var t="            ";const r=[];return null!==e.map?r.push(t+`color3f inputs:diffuseColor.connect = </Textures/Texture_${e.map.id}.outputs:rgb>`):r.push(t+"color3f inputs:diffuseColor = "+buildColor(e.color)),null!==e.emissiveMap?r.push(t+`color3f inputs:emissiveColor.connect = </Textures/Texture_${e.emissiveMap.id}.outputs:rgb>`):0<e.emissive&&(console.log(e.emissive),r.push(t+"color3f inputs:emissiveColor = "+buildColor(e.emissive))),null!==e.normalMap&&r.push(t+`normal3f inputs:normal.connect = </Textures/Texture_${e.normalMap.id}.outputs:rgb>`),null!==e.aoMap&&r.push(t+`float inputs:occlusion.connect = </Textures/Texture_${e.aoMap.id}.outputs:r>`),null!==e.roughnessMap?r.push(t+`float inputs:roughness.connect = </Textures/Texture_${e.roughnessMap.id}.outputs:g>`):r.push(t+"float inputs:roughness = "+e.roughness),null!==e.metalnessMap?r.push(t+`float inputs:metallic.connect = </Textures/Texture_${e.metalnessMap.id}.outputs:b>`):r.push(t+"float inputs:metallic = "+e.metalness),`
    def Material "Material_${e.id}"
    {
        token outputs:surface.connect = </Materials/Material_${e.id}/PreviewSurface.outputs:surface>

        def Shader "PreviewSurface"
        {
            uniform token info:id = "UsdPreviewSurface"
${r.join("\n")}
            int inputs:useSpecularWorkflow = 0
            token outputs:surface
        }
    }
`}function buildTextures(e){const t=[];for(const n in e){var r=e[n];t.push(buildUvPrimvar(r)),t.push(buildTextureTransform(r)),t.push(buildTexture(r))}return`def "Textures"
{
${t.join("")}
}

`}function buildTexture(e){return`
    def Shader "Texture_${e.id}"
    {
		uniform token info:id = "UsdUVTexture"
        asset inputs:file = @textures/Texture_${e.id}.jpg@
        float2 inputs:st.connect = </Textures/UsdTransform2d_${e.id}.outputs:result>
        token inputs:wrapS = "repeat"
        token inputs:wrapT = "repeat"
        float3 outputs:rgb
    }
`}function buildTextureTransform(e){return console.log(e),`
    def Shader "UsdTransform2d_${e.id}"
    {
        uniform token info:id = "UsdTransform2d"
		float2 inputs:in.connect = </Textures/UvPrimvarFloat2Shader_${e.id}.outputs:result>
		float inputs:rotation = 0.0
		float2 inputs:scale = (${e.repeat.x}, ${e.repeat.y})
		float2 inputs:translation = (0.0, 0.0)
		float2 outputs:result
    }
`}function buildUvPrimvar(e){return`
	def Shader "UvPrimvarFloat2Shader_${e.id}"
	{
		uniform token info:id = "UsdPrimvarReader_float2"
		token inputs:varname = "Texture_uv"
		float2 outputs:result
	}
`}function buildColor(e){return`(${e.r}, ${e.g}, ${e.b})`}class UsdzExporter{constructor(e,t){this.revision=1,this.exporter=new USDZExporter,checkPropTypes(t,{},{})}async export(s){return new Promise(async(e,t)=>{console.log(s);var r,n=new Group,i=[];for(r in s.traverse(function(e){e.isMesh&&"Vertex Helper"!==e.name&&"ContactShadow Plane"!==e.name&&"ContactShadow Blur Plane"!==e.name&&i.push(e)}),i){var o=i[r].clone();n.add(o)}var a=await this.exporter.parse(n);e(new Blob([a],{type:"application/octet-stream"}))})}}class PDF extends Export{constructor(){throw super(),this.revision=1,new Error("Not implemented")}}var extendThree=Object.freeze({__proto__:null,ShaderPass:ShaderPass,FXAAShader:FXAAShader,GammaCorrectionShader:GammaCorrectionShader$1,Pass:Pass});export{Actor,Atom,Block,BlockCategory,BlockCategoryType,BlockInstance,BlockSet,BoxGeometry,BufferGeometry,BuildableComponent,CacheLogger,Component,ComponentLoader,ComponentTree$1 as ComponentTree,Composer,Configuration,ConfigurationSettings,Configurator,Connectable,Connection,ConnectionType,Connector,ConnectorInstance,ConnectorType,ConsoleLogger,ContactShadow,DefaultSelectionTransform,DefaultView,DirectionalLight,EXR,extendThree as EXTENDTHREE,Environment,EnvironmentMap,Euler,Export,GLTF,Geometry,GeometryFile,ImageExporter,InformationSource,Line,LineBasicMaterial,LineSegments,LoadableComponent,LoadingBase,Marker,MaterialAssignment,MaterialCategory,MaterialCategoryType,MaterialSet,Mesh,MeshBasicMaterial,MeshGroup,MeshStandardMaterial,MoooiView,NavigationSettings,Object3D,PDF,PMREMGenerator,Package,PerspectiveCamera,PlaneGeometry as PlaneBufferGeometry,PositionedBlock,PositionedComponent,PositionedMesh,PositionedMeshGroup,Preset,Project,Quaternion,Raycaster,Reporter,Scene,SceneManager,ServerConnection,ServerLogger,SingleBlockInstance,THREE,Theme,ThemeGroup,Timer,Transform,Tween,URLRegex,UUIDRegex,UsdzExporter,Vector3,View,WebGLRenderer,WireframeGeometry,WrappedImage,WrappedMaterial,WrappedMesh,WrappedTexture,buildMateMap,checkPropTypes,copyProps,eqArr,getAssigningComponent,makeImage,omit,pause,pick,semverRegex,sum,ucFirst,unique};
